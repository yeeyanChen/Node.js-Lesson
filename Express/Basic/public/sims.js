/*
 MIT
 https://mths.be/codepointat v0.2.0 by @mathias  @overview es6-promise - a tiny implementation of Promises/A+.
 @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 @license   Licensed under MIT license, See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 @version   v4.2.5+7f2b526d
 @license (C) Andrea Giammarchi - Mit Style License
 @source https://github.com/WebReflection/dom4
 ctrl.loadingSubForm &&  @license MIT license: https://github.com/iamkun/dayjs/blob/dev/LICENSE  @source  moment-jdateformatparser, https://github.com/MadMG/moment-jdateformatparser
 @license MIT license: https://github.com/MadMG/moment-jdateformatparser/blob/master/LICENSE
 @copyright Copyright (C) 2011 Patrick Gillespie, http://patorjk.com/.
 @license   MIT Licensed.
 @copyright Copyright ? 2011 David Durman, https://github.com/DavidDurman/FlexiColorPicker.
 @license   MIT Licensed.
 This plugin is based on the following projects.

 nzh v1.0.4
 @source http://cnwhy.github.io/nzh
 @license License BSD-2-Clause

 js-written-number
 @source https://github.com/yamadapc/js-written-number
 @license MIT License
 FileSaver.js
  A saveAs() FileSaver implementation.
  2014-01-24

  By Eli Grey, http://eligrey.com
  License: X11/MIT
    See LICENSE.md
 @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js  JSZip v3.5.0 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
 mailcheck v1.1.2 @licence MIT */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){a=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(l){this.reject_(l);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)f.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(m){c.reject(m)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(v){f(v)}}:b}var d,f,g=new e(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return g};
e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(c)};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())c(f.value).callWhenSettled_(b,
d)})};e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){g[b]=c;k--;0==k&&a(g)}}var g=[],k=0;do g.push(void 0),k++,c(d.value).callWhenSettled_(f(g.length-1),e),d=b.next();while(!d.done)})};return e},"es6","es3");$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(d,e){function f(a){a.done?d(a.value):Promise.resolve(a.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.polyfill("globalThis",function(a){return a||$jscomp.global},"es_next","es3");$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=b[c];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.polyfill("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}},"es6","es3");$jscomp.polyfill("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}},"es6","es3");$jscomp.polyfill("Number.isNaN",function(a){return a?a:function(a){return"number"===typeof a&&isNaN(a)}},"es6","es3");
$jscomp.polyfill("Array.prototype.entries",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return[a,c]})}},"es6","es3");$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,c,d){c=null!=c?c:function(a){return a};var b=[],f="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof f){a=f.call(a);for(var g=0;!(f=a.next()).done;)b.push(c.call(d,f.value,g++))}else for(f=a.length,g=0;g<f;g++)b.push(c.call(d,a[g],g));return b}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var e=b.length,f=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var g=0;g<f&&c<e;)if(b[c++]!=a[g++])return!1;return g>=f}},"es6","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.polyfill("Object.getOwnPropertySymbols",function(a){return a?a:function(){return[]}},"es6","es5");$jscomp.polyfill("Reflect.ownKeys",function(a){return a?a:function(a){var b=[],d=Object.getOwnPropertyNames(a);a=Object.getOwnPropertySymbols(a);for(var e=0;e<d.length;e++)("jscomp_symbol_"==d[e].substring(0,14)?a:b).push(d[e]);return b.concat(a)}},"es6","es5");
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.polyfill("Object.entries",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push([d,a[d]]);return b}},"es8","es3");$jscomp.polyfill("Object.values",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push(a[d]);return b}},"es8","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var e=a.length;0<e&&0<c;)if(b[--c]!=a[--e])return!1;return 0>=e}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};
$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d.delete(b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(r){return!1}}function c(){}function d(a){var b=typeof a;return"object"===b&&null!==a||"function"===b}function e(a){if(!$jscomp.owns(a,g)){var b=new c;$jscomp.defineProperty(a,g,{value:b})}}function f(a){var b=Object[a];b&&(Object[a]=function(a){if(a instanceof
c)return a;e(a);return b(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var g="$jscomp_hidden_"+Math.random();f("freeze");f("preventExtensions");f("seal");var k=0,l=function(a){this.id_=(k+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};l.prototype.set=function(a,b){if(!d(a))throw Error("Invalid WeakMap key");e(a);if(!$jscomp.owns(a,g))throw Error("WeakMap key fail: "+
a);a[g][this.id_]=b;return this};l.prototype.get=function(a){return d(a)&&$jscomp.owns(a,g)?a[g][this.id_]:void 0};l.prototype.has=function(a){return d(a)&&$jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_)};l.prototype.delete=function(a){return d(a)&&$jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_)?delete a[g][this.id_]:!1};return l},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done?!1:!0}catch(r){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var c=new WeakMap,d=function(a){this.data_={};this.head_=g();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};d.prototype.set=function(a,b){a=0===a?0:a;var c=e(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};d.prototype.delete=function(a){a=e(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};d.prototype.has=function(a){return!!e(this,a).entry};
d.prototype.get=function(a){return(a=e(this,a).entry)&&a.value};d.prototype.entries=function(){return f(this,function(a){return[a.key,a.value]})};d.prototype.keys=function(){return f(this,function(a){return a.key})};d.prototype.values=function(){return f(this,function(a){return a.value})};d.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(a,b){var d=b&&typeof b;"object"==
d||"function"==d?c.has(b)?d=c.get(b):(d=""+ ++k,c.set(b,d)):d="p_"+b;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(a=0;a<e.length;a++){var f=e[a];if(b!==b&&f.key!==f.key||b===f.key)return{id:d,list:e,index:a,entry:f}}return{id:d,list:e,index:-1,entry:void 0}},f=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},g=function(){var a={};return a.previous=
a.next=a.head=a},k=0;return d},"es6","es3");$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).i}},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([b]));if(!c.has(b)||1!=c.size||c.add(b)!=c||1!=c.size||c.add({x:4})!=c||2!=c.size)return!1;var f=c.entries(),g=f.next();if(g.done||g.value[0]!=b||g.value[1]!=b)return!1;g=f.next();return g.done||g.value[0]==b||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:f.next().done}catch(k){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var c=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};c.prototype.add=function(a){a=0===a?0:a;this.map_.set(a,a);this.size=this.map_.size;return this};c.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};c.prototype.clear=function(){this.map_.clear();
this.size=0};c.prototype.has=function(a){return this.map_.has(a)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};return c},"es6","es3");
$jscomp.polyfill("Array.prototype.flat",function(a){return a?a:function(a){a=void 0===a?1:a;for(var b=[],d=0;d<this.length;d++){var e=this[d];Array.isArray(e)&&0<a?(e=Array.prototype.flat.call(e,a-1),b.push.apply(b,e)):b.push(e)}return b}},"es9","es5");$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es8","es3");
$jscomp.polyfill("Promise.prototype.finally",function(a){return a?a:function(a){return this.then(function(b){return Promise.resolve(a()).then(function(){return b})},function(b){return Promise.resolve(a()).then(function(){throw b;})})}},"es9","es3");$jscomp.polyfill("Number.parseFloat",function(a){return a||parseFloat},"es6","es3");
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");
$jscomp.polyfill("String.prototype.codePointAt",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"codePointAt"),d=b.length;a=Number(a)||0;if(0<=a&&a<d){a|=0;var e=b.charCodeAt(a);if(55296>e||56319<e||a+1===d)return e;a=b.charCodeAt(a+1);return 56320>a||57343<a?e:1024*(e-55296)+a+9216}}},"es6","es3");
$jscomp.polyfill("String.prototype.matchAll",function(a){if(a)return a;$jscomp.initSymbolIterator();return function(a){if(a instanceof RegExp&&!a.global)throw new TypeError("RegExp passed into String.prototype.matchAll() must have global tag.");var b=new RegExp(a,a instanceof RegExp?void 0:"g"),d=this,e=!1,f={next:function(){var a={},c=b.lastIndex;if(e)return{value:void 0,done:!0};var f=b.exec(d);if(!f)return e=!0,{value:void 0,done:!0};b.lastIndex===c&&(b.lastIndex+=1);a.value=f;a.done=!1;return a}};
f[Symbol.iterator]=function(){return f};return f}},"es_next","es3");
var KEYCODE={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,BREAK:19,CAPSLOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,NUMBER_0:48,NUMBER_1:49,NUMBER_2:50,NUMBER_3:51,NUMBER_4:52,NUMBER_5:53,NUMBER_6:54,NUMBER_7:55,NUMBER_8:56,NUMBER_9:57,FIREFOX_SEMICOLON:59,FIREFOX_EQUAL:61,CHAR_A:65,CHAR_B:66,CHAR_C:67,CHAR_D:68,CHAR_E:69,CHAR_F:70,CHAR_G:71,CHAR_H:72,CHAR_I:73,CHAR_J:74,CHAR_K:75,CHAR_L:76,
CHAR_M:77,CHAR_N:78,CHAR_O:79,CHAR_P:80,CHAR_Q:81,CHAR_R:82,CHAR_S:83,CHAR_T:84,CHAR_U:85,CHAR_V:86,CHAR_W:87,CHAR_X:88,CHAR_Y:89,CHAR_Z:90,LEFT_WIN:91,RIGHT_WIN:92,SELECT:93,TURNOFF_SPECIAL:94,SLEEP_SPECIAL:95,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:13,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,
F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,FIREFOX_DASH:173,SEMICOLON:186,EQUAL:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,GRAVE_ACCENT:192,LEFT_BRACKET:219,BACK_SLASH:220,RIGHT_BRACKET:221,QUOTE:222,COMMAND:224,KEY_229:229,WAKEUP_SPECIAL:255,isArrowKey:function(a){return a===this.UP||a===this.RIGHT||a===this.DOWN||a===this.LEFT},isSEMICOLON:function(a){return a===this.SEMICOLON||a===this.FIREFOX_SEMICOLON},isEQUAL:function(a){return a===this.EQUAL||a===this.FIREFOX_EQUAL},isDASH:function(a){return a===
this.DASH||a===this.FIREFOX_DASH}};Object.freeze(KEYCODE);
var SELECTOR="L",TYPER="D",SELECTION="S",UPLOADER="U",GRAPHICS="G",MSELECTOR="M",FREE="F",BUTTON="BTN",HEADER=1,DATA=2,BUILDER=1,UPDATE=2,BROWSE=5,FILTER_OPERAND={EQN:-1,EQ:1,GTE:2,LTE:3,GT:4,LT:5,RANGE:6,IRANGE:7,LIKE:8,SS:9,FTS:10,REGEX:11,SORT_ASC:21,SORT_DESC:22,SECONDARY_SORT_ASC:23,SECONDARY_SORT_DESC:24,isSortingFilter:function(a){return this.isMainSortingFilter(a)||this.isSecondarySortingFilter(a)},isMainSortingFilter:function(a){return a===this.SORT_ASC||a===this.SORT_DESC},isSecondarySortingFilter:function(a){return a===
this.SECONDARY_SORT_ASC||a===this.SECONDARY_SORT_DESC}},REMOVE_ALL_FILTER=-11,REMOVE_ALL_PURE_FILER=-12,REMOVE_ALL_SORT_FILTER=-13,SORT_NODIR=0,SORT_ASC=1,SORT_DESC=2,FILTER_NUMBER="N",FILTER_DATE="D",FILTER_SELECT="S",FILTER_TEXT="T",FILTER_USER="U",LOCALSTORAGE_PRIORITY=1,NORMAL_PRIORITY=2,FIXED_PRIORITY=3,OVER_FIXED_PRIORITY=4,NODOMAIN=-1,ROC_ERA_FULL=1,ROC_ERA_SHORT=2,JAPANESE_ERA_FULL=3,JAPANESE_ERA_MEDIUM=4,JAPANESE_ERA_SHORT=5,SMART_DATE_FORMATS=["y/M/d y-M-d y.M.d y.MM.dd y/MM/dd y-MM-dd yy/M/d yy-M-d yy.M.d yy.MM.dd yy/MM/dd yy-MM-dd yMd yMMdd yyMMdd MMdd Md d".split(" "),
"d/M/y d-M-y d.M.y dd.MM.y dd/MM/y dd-MM-y d/M/yy d-M-yy d.M.yy dd.MM.yy dd/MM/yy dd-MM-yy dMy ddMMy ddMMyy ddMM dM d".split(" "),"M/d/y M-d-y M.d.y MM.dd.y MM/dd/y MM-dd-y M/d/yy M-d-yy M.d.yy MM.dd.yy MM/dd/yy MM-dd-yy Mdy MMddy MMddyy MMdd Md d".split(" "),"HH:mm:ss;HH:mm;hh:mm a;H:mm;HH:m;H:m;HHmm;Hm;H".split(";"),"y/MM/dd HH:mm:ss;y/MM/dd H:m:s;y/MM/dd HH:mm;y/MM/dd H:m;y/MM/dd hh:mm a;y/MM/dd h:m a;y/MM/dd hh:mm:ss a;y/MM/dd h:m:s a;y/MM/dd hh:mm;y/MM/dd h:m;y/MM/dd hh:mm:ss;y/MM/dd h:m:s;yMdHms;yMMddHHmmss;yMdHm;yMMddHHmm;yMdhms;yMdhm;yyMdHms;yyMMddHHmmss;yyMdHm;yyMMddHHmm;yyMdhms;yyMdhm;y/M/d HH:mm:ss;y/M/d H:m:s;y/M/d HH:mm;y/M/d H:m;y/M/d hh:mm:ss a;y/M/d hh:mm a;y/M/d h:m:s a;y/M/d h:m a;y/M/d;y-M-d;y.M.d;y/MM/dd;y-MM-dd;y-MMM-d;yMd;yMMdd;yyMMdd;MMdd;Md;d".split(";"),
"MM-dd-y HH:mm:ss;MM-dd-y H:m:s;MM-dd-y HH:mm;MM-dd-y H:m;MM-dd-y hh:mm a;MM-dd-y h:m a;MM-dd-y hh:mm:ss a;MM-dd-y h:m:s a;MM-dd-yy HH:mm:ss;MM-dd-yy H:m:s;MM-dd-yy HH:mm;MM-dd-yy H:m;MM-dd-yy hh:mm a;MM-dd-yy h:m a;MM-dd-yy hh:mm:ss a;MM-dd-yy h:m:s a;M-d-y HH:mm:ss;M-d-y H:m:s;M-d-y HH:mm;M-d-y H:m;M-d-y hh:mm a;M-d-y h:m a;M-d-y hh:mm:ss a;M-d-y h:m:s a;M-d-yy HH:mm:ss;M-d-yy H:m:s;M-d-yy HH:mm;M-d-yy H:m;M-d-yy hh:mm a;M-d-yy h:m a;M-d-yy hh:mm:ss a;M-d-yy h:m:s a;MdyHms;Mdyhms;MdyHm;Mdyhm;MdyyHms;Mdyyhms;MdyyHm;Mdyyhm;M/d/y;M-d-y;M.d.y;MM/dd/y;MM-dd-y;MM.dd.y;MMM-d-y;Mdy;MMddy;MMddyy;MMdd;Md;d".split(";"),
["MM","CMM"],["d","Cdd"],"y RGRy RGRCy Ry RCy JGJy JGJCy Jy JCy".split(" "),"RGRy\u5e74MM\u6708dd\u65e5 RGRy\u5e74M\u6708d\u65e5 RGRCy\u5e74CMM\u6708Cdd\u65e5 Ry\u5e74MM\u6708dd\u65e5 Ry\u5e74M\u6708d\u65e5 RCy\u5e74CMM\u6708Cdd\u65e5 RGRy/MM/dd RGRy/M/d RGRy.MM.dd RGRy.M.d Ry/MM/dd Ry/M/d Ry.MM.dd Ry.M.d".split(" "),"RGRy\u5e74MM\u6708dd\u65e5 HH:mm:ss;RGRy\u5e74M\u6708d\u65e5 HH:mm:ss;RGRCy\u5e74CMM\u6708Cdd\u65e5 HH:mm:ss;Ry\u5e74MM\u6708dd\u65e5 HH:mm:ss;Ry\u5e74M\u6708d\u65e5 HH:mm:ss;RCy\u5e74CMM\u6708Cdd\u65e5 HH:mm:ss;RGRy/MM/dd HH:mm:ss;RGRy/M/d HH:mm:ss;RGRy.MM.dd HH:mm:ss;RGRy.M.d HH:mm:ss;Ry/MM/dd HH:mm:ss;Ry/M/d HH:mm:ss;Ry.MM.dd HH:mm:ss;Ry.M.d HH:mm:ss".split(";"),
"RGRy\u5e74MM\u6708dd\u65e5 a hh:mm:ss;RGRy\u5e74M\u6708d\u65e5 a hh:mm:ss;RGRCy\u5e74CMM\u6708Cdd\u65e5 a hh:mm:ss;Ry\u5e74MM\u6708dd\u65e5 a hh:mm:ss;Ry\u5e74M\u6708d\u65e5 a hh:mm:ss;RCy\u5e74CMM\u6708Cdd\u65e5 a hh:mm:ss;RGRy/MM/dd a hh:mm:ss;RGRy/M/d a hh:mm:ss;RGRy.MM.dd a hh:mm:ss;RGRy.M.d a hh:mm:ss;Ry/MM/dd a hh:mm:ss;Ry/M/d a hh:mm:ss;Ry.MM.dd a hh:mm:ss;Ry.M.d a hh:mm:ss".split(";"),"RGRy\u5e74MM\u6708dd\u65e5 EEEE a hh:mm:ss;RGRy\u5e74M\u6708d\u65e5 EEEE a hh:mm:ss;RGRCy\u5e74CMM\u6708Cdd\u65e5 EEEE a hh:mm:ss;Ry\u5e74MM\u6708dd\u65e5 EEEE a hh:mm:ss;Ry\u5e74M\u6708d\u65e5 EEEE a hh:mm:ss;RCy\u5e74CMM\u6708Cdd\u65e5 EEEE a hh:mm:ss;RGRy/MM/dd EEEE a hh:mm:ss;RGRy/M/d EEEE a hh:mm:ss;RGRy.MM.dd EEEE a hh:mm:ss;RGRy.M.d EEEE a hh:mm:ss;Ry/MM/dd EEEE a hh:mm:ss;Ry/M/d EEEE a hh:mm:ss;Ry.MM.dd EEEE a hh:mm:ss;Ry.M.d EEEE a hh:mm:ss".split(";"),
["JGJy\u5e74MM\u6708dd\u65e5","JGJy\u5e74M\u6708d\u65e5","JGJCy\u5e74CMM\u6708Cdd\u65e5"],["JGJy\u5e74MM\u6708dd\u65e5 HH:mm:ss","JGJy\u5e74M\u6708d\u65e5 HH:mm:ss","JGJCy\u5e74CMM\u6708Cdd\u65e5 HH:mm:ss"],["JGJy\u5e74MM\u6708dd\u65e5 a hh:mm:ss","JGJy\u5e74M\u6708d\u65e5 a hh:mm:ss","JGJCy\u5e74CMM\u6708Cdd\u65e5 a hh:mm:ss"],["JGJy\u5e74MM\u6708dd\u65e5 EEEE a hh:mm:ss","JGJy\u5e74M\u6708d\u65e5 EEEE a hh:mm:ss","JGJCy\u5e74CMM\u6708Cdd\u65e5 EEEE a hh:mm:ss"]],ROC_SUGGEST_FORMATS="RGGGRyy\u5e74MM\u6708dd\u65e5 HH:mm:ss;RGGGRCyy\u5e74CMM\u6708Cdd\u65e5 HH:mm:ss;RGGGRyy\u5e74MM\u6708dd\u65e5 a hh:mm:ss;RGGGRCyy\u5e74CMM\u6708Cdd\u65e5 a hh:mm:ss;RGGGRyy\u5e74MM\u6708dd\u65e5 EEEE a hh:mm:ss;RGGGRCyy\u5e74CMM\u6708Cdd\u65e5 EEEE a hh:mm:ss;RGRyy\u5e74MM\u6708dd\u65e5 HH:mm:ss;RGRCyy\u5e74CMM\u6708Cdd\u65e5 HH:mm:ss;RGRyy\u5e74MM\u6708dd\u65e5 a hh:mm:ss;RGRCyy\u5e74CMM\u6708Cdd\u65e5 a hh:mm:ss;RGRyy\u5e74MM\u6708dd\u65e5 EEEE a hh:mm:ss;RGRCyy\u5e74CMM\u6708Cdd\u65e5 EEEE a hh:mm:ss;Ryy\u5e74MM\u6708dd\u65e5 HH:mm:ss;RCyy\u5e74CMM\u6708Cdd\u65e5 HH:mm:ss;Ryy\u5e74MM\u6708dd\u65e5 a hh:mm:ss;RCyy\u5e74CMM\u6708Cdd\u65e5 a hh:mm:ss;Ryy\u5e74MM\u6708dd\u65e5 EEEE a hh:mm:ss;RCyy\u5e74CMM\u6708Cdd\u65e5 EEEE a hh:mm:ss;RGGGRy/MM/dd HH:mm:ss;RGGGRy.MM.dd HH:mm:ss;RGGGRy/MM/dd a hh:mm:ss;RGGGRy.MM.dd a hh:mm:ss;RGGGRy/MM/dd EEEE a hh:mm:ss;RGGGRy.MM.dd EEEE a hh:mm:ss;RGRy/MM/dd HH:mm:ss;RGRy.MM.dd HH:mm:ss;RGRy/MM/dd a hh:mm:ss;RGRy.MM.dd a hh:mm:ss;RGRy/MM/dd EEEE a hh:mm:ss;RGRy.MM.dd EEEE a hh:mm:ss;Ry/MM/dd HH:mm:ss;Ry.MM.dd HH:mm:ss;Ry/MM/dd a hh:mm:ss;Ry.MM.dd a hh:mm:ss;Ry/MM/dd EEEE a hh:mm:ss;Ry.MM.dd EEEE a hh:mm:ss;RGGGRyy\u5e74MM\u6708dd\u65e5;RGGGRCyy\u5e74CMM\u6708Cdd\u65e5;RGRyy\u5e74MM\u6708dd\u65e5;RGRCyy\u5e74CMM\u6708Cdd\u65e5;Ryy\u5e74MM\u6708dd\u65e5;RCyy\u5e74CMM\u6708Cdd\u65e5;RGGGRy/MM/dd;RGGGRy.MM.dd;RGRy/MM/dd;RGRy.MM.dd;Ry/MM/dd;Ry.MM.dd".split(";"),
JAPANESE_SUGGEST_FORMATS="JGGGJyy\u5e74MM\u6708dd\u65e5 HH:mm:ss;JGGGJCyy\u5e74CMM\u6708Cdd\u65e5 HH:mm:ss;JGGGJyy\u5e74MM\u6708dd\u65e5 a hh:mm:ss;JGGGJCyy\u5e74CMM\u6708Cdd\u65e5 a hh:mm:ss;JGGGJyy\u5e74MM\u6708dd\u65e5 EEEE a hh:mm:ss;JGGGJCyy\u5e74CMM\u6708Cdd\u65e5 EEEE a hh:mm:ss;JGGJyy\u5e74MM\u6708dd\u65e5 HH:mm:ss;JGGJCyy\u5e74CMM\u6708Cdd\u65e5 HH:mm:ss;JGGJyy\u5e74MM\u6708dd\u65e5 a hh:mm:ss;JGGJCyy\u5e74CMM\u6708Cdd\u65e5 a hh:mm:ss;JGGJyy\u5e74MM\u6708dd\u65e5 EEEE a hh:mm:ss;JGGJCyy\u5e74CMM\u6708Cdd\u65e5 EEEE a hh:mm:ss;JGJyy\u5e74MM\u6708dd\u65e5 HH:mm:ss;JGJCyy\u5e74CMM\u6708Cdd\u65e5 HH:mm:ss;JGJyy\u5e74MM\u6708dd\u65e5 a hh:mm:ss;JGJCyy\u5e74CMM\u6708Cdd\u65e5 a hh:mm:ss;JGJyy\u5e74MM\u6708dd\u65e5 EEEE a hh:mm:ss;JGJCyy\u5e74CMM\u6708Cdd\u65e5 EEEE a hh:mm:ss;JGGGJyy\u5e74MM\u6708dd\u65e5;JGGGJCyy\u5e74CMM\u6708Cdd\u65e5;JGGJyy\u5e74MM\u6708dd\u65e5;JGGJCyy\u5e74CMM\u6708Cdd\u65e5;JGJyy\u5e74MM\u6708dd\u65e5;JGJCyy\u5e74CMM\u6708Cdd\u65e5".split(";"),
japaneseDate={eraAbbrev:{Meiji:"M","\u660e\u6cbb":"M","\u660e":"M",Taisho:"T","\u5927\u6b63":"T","\u5927":"T",Showa:"S","\u662d\u548c":"S","\u662d":"S",Heisei:"H","\u5e73\u6210":"H","\u5e73":"H",Reiwa:"R","\u4ee4\u548c":"R","\u4ee4":"R"},eraStartYear:{M:1868,T:1912,S:1926,H:1989,R:2019},weekday:{0:"\u65e5\u66dc\u65e5",1:"\u6708\u66dc\u65e5",2:"\u706b\u66dc\u65e5",3:"\u6c34\u66dc\u65e5",4:"\u6728\u66dc\u65e5",5:"\u91d1\u66dc\u65e5",6:"\u571f\u66dc\u65e5"}},RagicStorage={storage:null,debugMode:!1,localStorage:{setItem:function(a,
b){RagicStorage.storage=window.localStorage;RagicStorage.accessor.setItem(a,b)},getItem:function(a,b){RagicStorage.storage=window.localStorage;return RagicStorage.accessor.getItem(a,b)},setObjectItem:function(a,b){RagicStorage.storage=window.localStorage;RagicStorage.accessor.setObjectItem(a,b)},getObjectItem:function(a,b){RagicStorage.storage=window.localStorage;return RagicStorage.accessor.getObjectItem(a,b)},removeItem:function(a){RagicStorage.storage=window.localStorage;RagicStorage.accessor.removeItem(a)},
length:function(){RagicStorage.storage=window.localStorage;return RagicStorage.accessor.length()},key:function(a){RagicStorage.storage=window.localStorage;return RagicStorage.accessor.key(a)}},sessionStorage:{setItem:function(a,b){RagicStorage.storage=window.sessionStorage;RagicStorage.accessor.setItem(a,b)},getItem:function(a,b){RagicStorage.storage=window.sessionStorage;return RagicStorage.accessor.getItem(a,b)},setObjectItem:function(a,b){RagicStorage.storage=window.sessionStorage;RagicStorage.accessor.setObjectItem(a,
b)},getObjectItem:function(a,b){RagicStorage.storage=window.sessionStorage;return RagicStorage.accessor.getObjectItem(a,b)},removeItem:function(a){RagicStorage.storage=window.sessionStorage;RagicStorage.accessor.removeItem(a)},length:function(){RagicStorage.storage=window.sessionStorage;return RagicStorage.accessor.length()},key:function(a){RagicStorage.storage=window.sessionStorage;return RagicStorage.accessor.key(a)}},accessor:{setItem:function(a,b){RagicStorage.debugMode&&console.log("Web Storage setItem '"+
a+"' to '"+b);try{this.storageSupport()&&RagicStorage.storage.setItem(a,b)}catch(c){this.exceptionProcess(c,"Web Storage setItem '"+a+"' to '"+b+"' error")}},getItem:function(a,b){RagicStorage.debugMode&&console.log("Web Storage getItem '"+a+"'");try{return this.storageSupport()&&this.isKeyExist(a)?RagicStorage.storage.getItem(a):void 0===b?null:b}catch(c){this.exceptionProcess(c,"Web Storage getItem '"+a+"' error")}},setObjectItem:function(a,b){RagicStorage.debugMode&&console.log("Web Storage setObjectItem '"+
a+"' to '"+b);try{this.storageSupport()&&this.setItem(a,JSON.stringify(b))}catch(c){this.exceptionProcess(c,"Web Storage setObjectItem '"+a+"' to '"+b+"' error")}},getObjectItem:function(a,b){RagicStorage.debugMode&&console.log("Web Storage getObjectItem '"+a+"'");try{return this.storageSupport()&&this.isKeyExist(a)?JSON.parse(this.getItem(a)):void 0===b?null:b}catch(c){this.exceptionProcess(c,"Web Storage getObjectItem '"+a+"' error")}},removeItem:function(a){RagicStorage.debugMode&&console.log("Web Storage removeItem '"+
a+"'");try{this.storageSupport()&&this.isKeyExist(a)&&RagicStorage.storage.removeItem(a)}catch(b){this.exceptionProcess(b,"Web Storage removeItem '"+a+"' error")}},isKeyExist:function(a){try{if(null!==RagicStorage.storage.getItem(a))return!0;RagicStorage.debugMode&&console.warn("Web Storage Key '"+a+"' does not exist");return!1}catch(b){this.exceptionProcess(b,"Web Storage isKeyExist '"+a+"' error")}},storageSupport:function(){return RagicStorage.storage&&RagicStorage.storage.getItem},length:function(){try{return RagicStorage.storage.length}catch(a){this.exceptionProcess(a,
"Web Storage length error")}},key:function(a){try{return RagicStorage.storage.key(a)}catch(b){this.exceptionProcess(b,"Web Storage key error")}},exceptionProcess:function(a,b){console.error(b);"function"===typeof processJSExceptionObj&&processJSExceptionObj(a)}}};
Array.prototype.find||(Array.prototype.find=function(a,b){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!==typeof a)throw new TypeError("predicate must be a function");for(var c=Object(this),d=c.length>>>0,e,f=0;f<d;f++)if(e=c[f],a.call(b,e,f,c))return e});Array.of||(Array.of=function(){return Array.prototype.slice.call(arguments)});
Array.prototype.flat||(Array.prototype.flat=function(a){var b=arguments.callee;void 0===a&&(a=1);return this.reduce(function(c,d){if(0<a&&Array.isArray(d))return c.concat(b.call(d,a-1));c.push(d);return c},[])});
Array.from||(Array.from=function(){var a=Object.prototype.toString,b=function(b){return"function"===typeof b||"[object Function]"===a.call(b)},c=Math.pow(2,53)-1;return function(a){var d=Object(a);if(null==a)throw new TypeError("Array.from requires an array-like object - not null or undefined");var f=1<arguments.length?arguments[1]:void 0,g;if("undefined"!==typeof f){if(!b(f))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(g=arguments[2])}var k=
Number(d.length);k=isNaN(k)?0:0!==k&&isFinite(k)?(0<k?1:-1)*Math.floor(Math.abs(k)):k;k=Math.min(Math.max(k,0),c);for(var l=b(this)?Object(new this(k)):Array(k),m=0,n;m<k;)n=d[m],l[m]=f?"undefined"===typeof g?f(n,m):f.call(g,n,m):n,m+=1;l.length=k;return l}}());
Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(a,b){if(null==this)throw new TypeError('"this" is null or not defined');var c=Object(this),d=c.length>>>0;if(0===d)return!1;b|=0;for(b=Math.max(0<=b?b:d-Math.abs(b),0);b<d;){var e=c[b],f=a;if(e===f||"number"===typeof e&&"number"===typeof f&&isNaN(e)&&isNaN(f))return!0;b++}return!1}});
Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(a,b){if(null==this)throw new TypeError('"this" is null or not defined');var c=Object(this),d=c.length>>>0;if("function"!==typeof a)throw new TypeError("predicate must be a function");for(var e=0;e<d;){if(a.call(b,c[e],e,c))return e;e++}return-1}});
Object.values||(Object.values=function(a){return Object.keys(a).reduce(function(b,c){return b.concat("string"===typeof c&&a.propertyIsEnumerable(c)?[a[c]]:[])},[])});Object.entries||(Object.entries=function(a){for(var b=Object.keys(a),c=b.length,d=Array(c);c--;)d[c]=[b[c],a[b[c]]];return d});
"function"!==typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(a,b){if(null===a||void 0===a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1;d<arguments.length;d++){var e=arguments[d];if(null!==e&&void 0!==e)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(c[f]=e[f])}return c},writable:!0,configurable:!0});String.prototype.startsWith||(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a});
String.prototype.endsWith||(String.prototype.endsWith=function(a){return this.slice(-a.length)==a});String.prototype.includes||(String.prototype.includes=function(a,b){"number"!==typeof b&&(b=0);return b+a.length>this.length?!1:-1!==this.indexOf(a,b)});
String.prototype.repeat||(String.prototype.repeat=function(a){if(null==this)throw new TypeError("can't convert "+this+" to object");var b=""+this;a=+a;a!=a&&(a=0);if(0>a)throw new RangeError("repeat count must be non-negative");if(Infinity==a)throw new RangeError("repeat count must be less than infinity");a=Math.floor(a);if(0==b.length||0==a)return"";if(268435456<=b.length*a)throw new RangeError("repeat count must not overflow maximum string size");for(var c="";;){1==(a&1)&&(c+=b);a>>>=1;if(0==a)break;
b+=b}return c});String.prototype.codePointAt||function(){var a=function(){try{var a={},b=Object.defineProperty,e=b(a,a,a)&&b}catch(f){}return e}(),b=function(a){if(null==this)throw TypeError();var b=String(this),c=b.length,f=a?Number(a):0;f!=f&&(f=0);if(!(0>f||f>=c))return a=b.charCodeAt(f),55296<=a&&56319>=a&&c>f+1&&(b=b.charCodeAt(f+1),56320<=b&&57343>=b)?1024*(a-55296)+b-56320+65536:a};a?a(String.prototype,"codePointAt",{value:b,configurable:!0,writable:!0}):String.prototype.codePointAt=b}();
String.fromCodePoint||function(a){var b=function(b){for(var c=[],e,f="",g=0,k=arguments.length;g!==k;++g){e=+arguments[g];if(!(1114111>e&&e>>>0===e))throw RangeError("Invalid code point: "+e);65535>=e?e=c.push(e):(e-=65536,e=c.push((e>>10)+55296,e%1024+56320));16383<=e&&(f+=a.apply(null,c),c.length=0)}return f+a.apply(null,c)};try{Object.defineProperty(String,"fromCodePoint",{value:b,configurable:!0,writable:!0})}catch(c){String.fromCodePoint=b}}(String.fromCharCode);
String.prototype.replaceAll||(String.prototype.replaceAll=function(a,b){if("[object regexp]"===Object.prototype.toString.call(a).toLowerCase()){if(void 0!==a.flags&&!a.flags.includes("g"))throw TypeError("String.prototype.replaceAll called with a non-global RegExp argument");return this.replace(a,b)}return this.replace(new RegExp(RegExp.quote(a),"g"),b)});String.prototype.splitIgnoreEmpty||(String.prototype.splitIgnoreEmpty=function(a){return this.split(a).filter(function(a){return 0<a.length})});
Number.isInteger=Number.isInteger||function(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a};Number.isNaN=Number.isNaN||function(a){return a!==a};
(function(a,b){a.ES6Promise=b()})(this,function(){function a(){return function(){return process.nextTick(f)}}function b(){return"undefined"!==typeof B?function(){B(f)}:e()}function c(){var a=0,b=new M(f),c=document.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function d(){var a=new MessageChannel;a.port1.onmessage=f;return function(){return a.port2.postMessage(0)}}function e(){var a=setTimeout;return function(){return a(f,1)}}function f(){for(var a=0;a<L;a+=
2)(0,P[a])(P[a+1]),P[a]=void 0,P[a+1]=void 0;L=0}function g(){try{var a=Function("return this")().require("vertx");B=a.runOnLoop||a.runOnContext;return b()}catch(X){return e()}}function k(a,b){var c=this,d=new this.constructor(m);void 0===d[R]&&C(d);var e=c._state;if(e){var f=arguments[e-1];O(function(){return w(e,d,f,c._result)})}else D(c,d,a,b);return d}function l(a){if(a&&"object"===typeof a&&a.constructor===this)return a;var b=new this(m);v(b,a);return b}function m(){}function n(a){try{return a.then}catch(X){return U.error=
X,U}}function q(a,b,c,d){try{a.call(b,c,d)}catch(ja){return ja}}function r(a,b,c){O(function(a){var d=!1,e=q(c,b,function(c){d||(d=!0,b!==c?v(a,c):x(a,c))},function(b){d||(d=!0,E(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,E(a,e))},a)}function p(a,b){b._state===H?x(a,b._result):b._state===I?E(a,b._result):D(b,void 0,function(b){return v(a,b)},function(b){return E(a,b)})}function t(a,b,c){b.constructor===a.constructor&&c===k&&b.constructor.resolve===l?p(a,b):c===U?(E(a,U.error),
U.error=null):void 0===c?x(a,b):"function"===typeof c?r(a,b,c):x(a,b)}function v(a,b){if(a===b)E(a,new TypeError("You cannot resolve a promise with itself"));else{var c=typeof b;null===b||"object"!==c&&"function"!==c?x(a,b):t(a,b,n(b))}}function u(a){a._onerror&&a._onerror(a._result);A(a)}function x(a,b){a._state===N&&(a._result=b,a._state=H,0!==a._subscribers.length&&O(A,a))}function E(a,b){a._state===N&&(a._state=I,a._result=b,O(u,a))}function D(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=
null;e[f]=b;e[f+H]=c;e[f+I]=d;0===f&&a._state&&O(A,a)}function A(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?w(c,d,e,f):e(f);a._subscribers.length=0}}function w(a,b,c,d){var e="function"===typeof c,f=void 0,g=void 0,k=void 0,l=void 0;if(e){try{f=c(d)}catch(da){U.error=da,f=U}f===U?(l=!0,g=f.error,f.error=null):k=!0;if(b===f){E(b,new TypeError("A promises callback cannot return that same promise."));return}}else f=d,k=!0;b._state===
N&&(e&&k?v(b,f):l?E(b,g):a===H?x(b,f):a===I&&E(b,f))}function F(a,b){try{b(function(b){v(a,b)},function(b){E(a,b)})}catch(ba){E(a,ba)}}function C(a){a[R]=T++;a._state=void 0;a._result=void 0;a._subscribers=[]}var z=void 0,J=z=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},L=0,B=void 0,y=void 0,O=function(a,b){P[L]=a;P[L+1]=b;L+=2;2===L&&(y?y(f):G())},K=(z="undefined"!==typeof window?window:void 0)||{},M=K.MutationObserver||K.WebKitMutationObserver;
K="undefined"===typeof self&&"undefined"!==typeof process&&"[object process]"==={}.toString.call(process);var Q="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,P=Array(1E3),G=void 0;G=K?a():M?c():Q?d():void 0===z&&"function"===typeof require?g():e();var R=Math.random().toString(36).substring(2),N=void 0,H=1,I=2,U={error:null},T=0,V=function(){function a(a,b){this._instanceConstructor=a;this.promise=new a(m);this.promise[R]||C(this.promise);
J(b)?(this._remaining=this.length=b.length,this._result=Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(b),0===this._remaining&&x(this.promise,this._result))):E(this.promise,Error("Array Methods must be provided an Array"))}a.prototype._enumerate=function(a){for(var b=0;this._state===N&&b<a.length;b++)this._eachEntry(a[b],b)};a.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;d===l?(d=n(a),d===k&&a._state!==
N?this._settledAt(a._state,b,a._result):"function"!==typeof d?(this._remaining--,this._result[b]=a):c===S?(c=new c(m),t(c,a,d),this._willSettleAt(c,b)):this._willSettleAt(new c(function(b){return b(a)}),b)):this._willSettleAt(d(a),b)};a.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===N&&(this._remaining--,a===I?E(d,c):this._result[b]=c);0===this._remaining&&x(d,this._result)};a.prototype._willSettleAt=function(a,b){var c=this;D(a,void 0,function(a){return c._settledAt(H,b,a)},function(a){return c._settledAt(I,
b,a)})};return a}(),S=function(){function a(b){this[R]=T++;this._result=this._state=void 0;this._subscribers=[];if(m!==b){if("function"!==typeof b)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(this instanceof a)F(this,b);else throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");}}a.prototype["catch"]=function(a){return this.then(null,a)};a.prototype["finally"]=
function(a){var b=this.constructor;return"function"===typeof a?this.then(function(c){return b.resolve(a()).then(function(){return c})},function(c){return b.resolve(a()).then(function(){throw c;})}):this.then(a,a)};return a}();S.prototype.then=k;S.all=function(a){return(new V(this,a)).promise};S.race=function(a){var b=this;return J(a)?new b(function(c,d){for(var e=a.length,f=0;f<e;f++)b.resolve(a[f]).then(c,d)}):new b(function(a,b){return b(new TypeError("You must pass an array to race."))})};S.resolve=
l;S.reject=function(a){var b=new this(m);E(b,a);return b};S._setScheduler=function(a){y=a};S._setAsap=function(a){O=a};S._asap=O;S.polyfill=function(){var a=void 0;if("undefined"!==typeof global)a=global;else if("undefined"!==typeof self)a=self;else try{a=Function("return this")()}catch(fa){throw Error("polyfill failed because global object is unavailable in this environment");}var b=a.Promise;if(b){var c=null;try{c=Object.prototype.toString.call(b.resolve())}catch(fa){}if("[object Promise]"===c&&
!b.cast)return}a.Promise=S};S.Promise=S;S.polyfill();return S});
(function(a){function b(a){"string"!==typeof a&&(a=String(a));if(/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(a)||""===a)throw new TypeError("Invalid character in header field name");return a.toLowerCase()}function c(a){"string"!==typeof a&&(a=String(a));return a}function d(a){var b={next:function(){var b=a.shift();return{done:void 0===b,value:b}}};x.iterable&&($jscomp.initSymbol(),$jscomp.initSymbolIterator(),b[Symbol.iterator]=function(){return b});return b}function e(a){this.map={};a instanceof e?a.forEach(function(a,
b){this.append(b,a)},this):Array.isArray(a)?a.forEach(function(a){this.append(a[0],a[1])},this):a&&Object.getOwnPropertyNames(a).forEach(function(b){this.append(b,a[b])},this)}function f(a){if(a.bodyUsed)return Promise.reject(new TypeError("Already read"));a.bodyUsed=!0}function g(a){return new Promise(function(b,c){a.onload=function(){b(a.result)};a.onerror=function(){c(a.error)}})}function k(a){var b=new FileReader,c=g(b);b.readAsArrayBuffer(a);return c}function l(a){a=new Uint8Array(a);for(var b=
Array(a.length),c=0;c<a.length;c++)b[c]=String.fromCharCode(a[c]);return b.join("")}function m(a){if(a.slice)return a.slice(0);var b=new Uint8Array(a.byteLength);b.set(new Uint8Array(a));return b.buffer}function n(){this.bodyUsed=!1;this._initBody=function(a){(this._bodyInit=a)?"string"===typeof a?this._bodyText=a:x.blob&&Blob.prototype.isPrototypeOf(a)?this._bodyBlob=a:x.formData&&FormData.prototype.isPrototypeOf(a)?this._bodyFormData=a:x.searchParams&&URLSearchParams.prototype.isPrototypeOf(a)?
this._bodyText=a.toString():x.arrayBuffer&&x.blob&&a&&DataView.prototype.isPrototypeOf(a)?(this._bodyArrayBuffer=m(a.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):x.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(a)||D(a))?this._bodyArrayBuffer=m(a):this._bodyText=a=Object.prototype.toString.call(a):this._bodyText="";this.headers.get("content-type")||("string"===typeof a?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",
this._bodyBlob.type):x.searchParams&&URLSearchParams.prototype.isPrototypeOf(a)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))};x.blob&&(this.blob=function(){var a=f(this);if(a)return a;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=
function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(k)});this.text=function(){var a=f(this);if(a)return a;if(this._bodyBlob){a=this._bodyBlob;var b=new FileReader,c=g(b);b.readAsText(a);return c}if(this._bodyArrayBuffer)return Promise.resolve(l(this._bodyArrayBuffer));if(this._bodyFormData)throw Error("could not read FormData body as text");return Promise.resolve(this._bodyText)};x.formData&&(this.formData=function(){return this.text().then(r)});
this.json=function(){return this.text().then(JSON.parse)};return this}function q(a,b){b=b||{};var c=b.body;if(a instanceof q){if(a.bodyUsed)throw new TypeError("Already read");this.url=a.url;this.credentials=a.credentials;b.headers||(this.headers=new e(a.headers));this.method=a.method;this.mode=a.mode;this.signal=a.signal;c||null==a._bodyInit||(c=a._bodyInit,a.bodyUsed=!0)}else this.url=String(a);this.credentials=b.credentials||this.credentials||"same-origin";if(b.headers||!this.headers)this.headers=
new e(b.headers);a=b.method||this.method||"GET";var d=a.toUpperCase();this.method=-1<A.indexOf(d)?d:a;this.mode=b.mode||this.mode||null;this.signal=b.signal||this.signal;this.referrer=null;if(("GET"===this.method||"HEAD"===this.method)&&c)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(c)}function r(a){var b=new FormData;a.trim().split("&").forEach(function(a){if(a){var c=a.split("=");a=c.shift().replace(/\+/g," ");c=c.join("=").replace(/\+/g," ");b.append(decodeURIComponent(a),
decodeURIComponent(c))}});return b}function p(a){var b=new e;a.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(a){var c=a.split(":");if(a=c.shift().trim())c=c.join(":").trim(),b.append(a,c)});return b}function t(a,b){b||(b={});this.type="default";this.status=void 0===b.status?200:b.status;this.ok=200<=this.status&&300>this.status;this.statusText="statusText"in b?b.statusText:"OK";this.headers=new e(b.headers);this.url=b.url||"";this._initBody(a)}if(!a.fetch){$jscomp.initSymbol();var v=
"Symbol"in a&&"iterator"in Symbol,u;if(u="FileReader"in a&&"Blob"in a)try{new Blob,u=!0}catch(C){u=!1}var x={searchParams:"URLSearchParams"in a,iterable:v,blob:u,formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};if(x.arrayBuffer)var E="[object Int8Array];[object Uint8Array];[object Uint8ClampedArray];[object Int16Array];[object Uint16Array];[object Int32Array];[object Uint32Array];[object Float32Array];[object Float64Array]".split(";"),D=ArrayBuffer.isView||function(a){return a&&-1<E.indexOf(Object.prototype.toString.call(a))};
e.prototype.append=function(a,d){a=b(a);d=c(d);var e=this.map[a];this.map[a]=e?e+", "+d:d};e.prototype["delete"]=function(a){delete this.map[b(a)]};e.prototype.get=function(a){a=b(a);return this.has(a)?this.map[a]:null};e.prototype.has=function(a){return this.map.hasOwnProperty(b(a))};e.prototype.set=function(a,d){this.map[b(a)]=c(d)};e.prototype.forEach=function(a,b){for(var c in this.map)this.map.hasOwnProperty(c)&&a.call(b,this.map[c],c,this)};e.prototype.keys=function(){var a=[];this.forEach(function(b,
c){a.push(c)});return d(a)};e.prototype.values=function(){var a=[];this.forEach(function(b){a.push(b)});return d(a)};e.prototype.entries=function(){var a=[];this.forEach(function(b,c){a.push([c,b])});return d(a)};x.iterable&&($jscomp.initSymbol(),$jscomp.initSymbolIterator(),e.prototype[Symbol.iterator]=e.prototype.entries);var A="DELETE GET HEAD OPTIONS POST PUT".split(" ");q.prototype.clone=function(){return new q(this,{body:this._bodyInit})};n.call(q.prototype);n.call(t.prototype);t.prototype.clone=
function(){return new t(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new e(this.headers),url:this.url})};t.error=function(){var a=new t(null,{status:0,statusText:""});a.type="error";return a};var w=[301,302,303,307,308];t.redirect=function(a,b){if(-1===w.indexOf(b))throw new RangeError("Invalid status code");return new t(null,{status:b,headers:{location:a}})};var F=a.DOMException;try{new F}catch(C){F=function(a,b){this.message=a;this.name=b;this.stack=Error(a).stack},F.prototype=
Object.create(Error.prototype),F.prototype.constructor=F}a.Headers=e;a.Request=q;a.Response=t;a.fetch=function(a,b){return new Promise(function(c,d){function e(){g.abort()}var f=new q(a,b);if(f.signal&&f.signal.aborted)return d(new F("Aborted","AbortError"));var g=new XMLHttpRequest;g.onload=function(){var a={status:g.status,statusText:g.statusText,headers:p(g.getAllResponseHeaders()||"")};a.url="responseURL"in g?g.responseURL:a.headers.get("X-Request-URL");c(new t("response"in g?g.response:g.responseText,
a))};g.onerror=function(){d(new TypeError("Network request failed"))};g.ontimeout=function(){d(new TypeError("Network request failed"))};g.onabort=function(){d(new F("Aborted","AbortError"))};g.open(f.method,f.url,!0);"include"===f.credentials?g.withCredentials=!0:"omit"===f.credentials&&(g.withCredentials=!1);"responseType"in g&&x.blob&&(g.responseType="blob");f.headers.forEach(function(a,b){g.setRequestHeader(b,a)});f.signal&&(f.signal.addEventListener("abort",e),g.onreadystatechange=function(){4===
g.readyState&&f.signal.removeEventListener("abort",e)});g.send("undefined"===typeof f._bodyInit?null:f._bodyInit)})};a.fetch.polyfill=!0}})(this);
(function(a){function b(a,b){if(!a)throw Error("Failed to construct "+b+": 1 argument required, but only 0 present.");}function c(a){if(1===a.length)return d(a[0]);for(var b=f.createDocumentFragment(),c=L.call(a),e=0;e<a.length;e++)b.appendChild(d(c[e]));return b}function d(a){return"object"===typeof a?a:f.createTextNode(a)}var e,f=a.document,g=Object.prototype.hasOwnProperty,k=Object.defineProperty||function(a,b,c){g.call(c,"value")?a[b]=c.value:(g.call(c,"get")&&a.__defineGetter__(b,c.get),g.call(c,
"set")&&a.__defineSetter__(b,c.set));return a},l=[].indexOf||function(a){for(var b=this.length;b--&&this[b]!==a;);return b},m=function(a){if(!a)throw"SyntaxError";if(p.test(a))throw"InvalidCharacterError";return a},n=function(a){var b="undefined"===typeof a.className,c=b?a.getAttribute("class")||"":a.className,d=b||"object"===typeof c;b=(d?b?c:c.baseVal:c).replace(r,"");b.length&&J.push.apply(this,b.split(p));this._isSVG=d;this._=a};var q={get:function(){return new n(this)},set:function(){}};var r=
/^\s+|\s+$/g,p=/\s+/,t=function(a,b){if(this.contains(a))b||this.remove(a);else if(void 0===b||b)b=!0,this.add(a);return!!b};var v=a.DocumentFragment&&DocumentFragment.prototype;var u=a.Node,x=(u||Element).prototype,E=a.CharacterData||u,D=E&&E.prototype,A=a.DocumentType,w=A&&A.prototype,F=(a.Element||u||a.HTMLElement).prototype;u=a.HTMLSelectElement||f.createElement("select").constructor;for(var C=u.prototype.remove,z=a.SVGElement,J=["matches",F.matchesSelector||F.webkitMatchesSelector||F.khtmlMatchesSelector||
F.mozMatchesSelector||F.msMatchesSelector||F.oMatchesSelector||function(a){var b=this.parentNode;return!!b&&-1<l.call(b.querySelectorAll(a),this)},"closest",function(a){for(var b=this,c;(c=b&&b.matches)&&!b.matches(a);)b=b.parentNode;return c?b:null},"prepend",function(){var a=this.firstChild,b=c(arguments);a?this.insertBefore(b,a):this.appendChild(b)},"append",function(){this.appendChild(c(arguments))},"before",function(){var a=this.parentNode;a&&a.insertBefore(c(arguments),this)},"after",function(){var a=
this.parentNode,b=this.nextSibling,d=c(arguments);a&&(b?a.insertBefore(d,b):a.appendChild(d))},"toggleAttribute",function(a,b){var c=this.hasAttribute(a);1<arguments.length?c&&!b?this.removeAttribute(a):b&&!c&&this.setAttribute(a,""):c?this.removeAttribute(a):this.setAttribute(a,"");return this.hasAttribute(a)},"replace",function(){this.replaceWith.apply(this,arguments)},"replaceWith",function(){var a=this.parentNode;a&&a.replaceChild(c(arguments),this)},"remove",function(){var a=this.parentNode;
a&&a.removeChild(this)}],L=J.slice,B=J.length;B;B-=2){var y=J[B-2];y in F||(F[y]=J[B-1]);"remove"!==y||C._dom4||((u.prototype[y]=function(){return 0<arguments.length?C.apply(this,arguments):F.remove.call(this)})._dom4=!0);/^(?:before|after|replace|replaceWith|remove)$/.test(y)&&(!E||y in D||(D[y]=J[B-1]),!A||y in w||(w[y]=J[B-1]));if(/^(?:append|prepend)$/.test(y))if(v)y in v||(v[y]=J[B-1]);else try{f.createDocumentFragment().constructor.prototype[y]=J[B-1]}catch(O){}}f.createElement("a").matches("a")||
(F[y]=function(a){return function(b){return a.call(this.parentNode?this:f.createDocumentFragment().appendChild(this),b)}}(F[y]));n.prototype={length:0,add:function(){for(var a=0,b;a<arguments.length;a++)b=arguments[a],this.contains(b)||J.push.call(this,y);this._isSVG?this._.setAttribute("class",""+this):this._.className=""+this},contains:function(a){return function(b){B=a.call(this,y=m(b));return-1<B}}([].indexOf||function(a){for(B=this.length;B--&&this[B]!==a;);return B}),item:function(a){return this[a]||
null},remove:function(){for(var a=0,b;a<arguments.length;a++)b=arguments[a],this.contains(b)&&J.splice.call(this,B,1);this._isSVG?this._.setAttribute("class",""+this):this._.className=""+this},toggle:t,toString:function(){return J.join.call(this," ")}};!z||"classList"in z.prototype||k(z.prototype,"classList",q);"classList"in f.documentElement?(q=f.createElement("div").classList,q.add("a","b","a"),"a b"!=q&&(q=q.constructor.prototype,"add"in q||(q=a.TemporaryTokenList.prototype),v=function(a){return function(){for(var b=
0;b<arguments.length;)a.call(this,arguments[b++])}},q.add=v(q.add),q.remove=v(q.remove),q.toggle=t)):k(F,"classList",q);"contains"in x||k(x,"contains",{value:function(a){for(;a&&a!==this;)a=a.parentNode;return this===a}});"head"in f||k(f,"head",{get:function(){return e||(e=f.getElementsByTagName("head")[0])}});(function(){for(var b,c=a.requestAnimationFrame,d=a.cancelAnimationFrame,e=["o","ms","moz","webkit"],f=e.length;!d&&f--;)c=c||a[e[f]+"RequestAnimationFrame"],d=a[e[f]+"CancelAnimationFrame"]||
a[e[f]+"CancelRequestAnimationFrame"];d||(c?(b=c,c=function(a){var c=!0;b(function(){c&&a.apply(this,arguments)});return function(){c=!1}},d=function(a){a()}):(c=function(a){return setTimeout(a,15,15)},d=function(a){clearTimeout(a)}));a.requestAnimationFrame=c;a.cancelAnimationFrame=d})();try{new a.CustomEvent("?")}catch(O){a.CustomEvent=function(a,b){function c(a,b,c,d){this.initEvent(a,b,c);this.detail=d}return function(d,e){var g=f.createEvent(a);if("string"!=typeof d)throw Error("An event name must be provided");
"Event"==a&&(g.initCustomEvent=c);null==e&&(e=b);g.initCustomEvent(d,e.bubbles,e.cancelable,e.detail);return g}}(a.CustomEvent?"CustomEvent":"Event",{bubbles:!1,cancelable:!1,detail:null})}try{new Event("_")}catch(O){O=function(a){function c(a,c){b(arguments.length,"Event");var d=f.createEvent("Event");c||(c={});d.initEvent(a,!!c.bubbles,!!c.cancelable);return d}c.prototype=a.prototype;return c}(a.Event||function(){}),k(a,"Event",{value:O}),Event!==O&&(Event=O)}try{new KeyboardEvent("_",{})}catch(O){O=
function(c){function d(c,d){b(arguments.length,"KeyboardEvent");var k=d||{},m=g;for(n in m)m.hasOwnProperty(n)&&!m.hasOwnProperty.call(k,n)&&(k[n]=m[n]);d=k;k=f.createEvent(l);m=d.ctrlKey;var n=d.shiftKey;var q=d.altKey,p=d.metaKey,r=d.altGraphKey;if(3<e){var t=d;for(var u=[],x="ctrlKey Control shiftKey Shift altKey Alt metaKey Meta altGraphKey AltGraph".split(" "),v=0;v<x.length;v+=2)t[x[v]]&&u.push(x[v+1]);t=u.join(" ")}else t=null;u=String(d.key);var w=String(d.char);x=d.location;v=d.keyCode||
(d.keyCode=u)&&u.charCodeAt(0)||0;w=d.charCode||(d.charCode=w)&&w.charCodeAt(0)||0;var E=d.bubbles,D=d.cancelable,J=d.repeat,A=d.locale,F=d.view||a;d.which||(d.which=d.keyCode);if("initKeyEvent"in k)k.initKeyEvent(c,E,D,F,m,q,n,p,v,w);else if(0<e&&"initKeyboardEvent"in k){E=[c,E,D,F];switch(e){case 1:E.push(u,x,m,n,q,p,r);break;case 2:E.push(m,q,n,p,v,w);break;case 3:E.push(u,x,m,q,n,p,r);break;case 4:E.push(u,x,t,J,A);break;default:E.push(char,u,x,t,J,A)}k.initKeyboardEvent.apply(k,E)}else k.initEvent(c,
E,D);for(u in k)if(g.hasOwnProperty(u)&&k[u]!==d[u])try{k[u]=d[u]}catch(pa){}return k}var e=0,g={char:"",key:"",location:0,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,altGraphKey:!1,repeat:!1,locale:navigator.language,detail:0,bubbles:!1,cancelable:!1,keyCode:0,charCode:0,which:0};try{var k=f.createEvent("KeyboardEvent");k.initKeyboardEvent("keyup",!1,!1,a,"+",3,!0,!1,!0,!1,!1);e="+"==(k.keyIdentifier||k.key)&&3==(k.keyLocation||k.location)&&(k.ctrlKey?k.altKey?1:3:k.shiftKey?2:4)||9}catch(N){}var l=
0<e?"KeyboardEvent":"Event";d.prototype=c.prototype;return d}(a.KeyboardEvent||function(){}),k(a,"KeyboardEvent",{value:O}),KeyboardEvent!==O&&(KeyboardEvent=O)}try{new MouseEvent("_",{})}catch(O){O=function(c){function d(c,d){b(arguments.length,"MouseEvent");var e=f.createEvent("MouseEvent");d||(d={});e.initMouseEvent(c,!!d.bubbles,!!d.cancelable,d.view||a,d.detail||1,d.screenX||0,d.screenY||0,d.clientX||0,d.clientY||0,!!d.ctrlKey,!!d.altKey,!!d.shiftKey,!!d.metaKey,d.button||0,d.relatedTarget||
null);return e}d.prototype=c.prototype;return d}(a.MouseEvent||function(){}),k(a,"MouseEvent",{value:O}),MouseEvent!==O&&(MouseEvent=O)}f.querySelectorAll("*").forEach||function(){function a(a){var b=a.querySelectorAll;a.querySelectorAll=function(a){a=b.call(this,a);a.forEach=Array.prototype.forEach;return a}}a(f);a(Element.prototype)}();try{f.querySelector(":scope *")}catch(O){(function(){function a(a,c,d){a.setAttribute(b,null);c=c.call(a,String(d).replace(/(^|,\s*)(:scope([ >]|$))/g,function(a,
c,d,e){return c+"["+b+"]"+(e||" ")}));a.removeAttribute(b);return c}var b="data-scope-"+(1E9*Math.random()>>>0),c=Element.prototype,d=c.querySelector,e=c.querySelectorAll;c.querySelector=function(b){return a(this,d,b)};c.querySelectorAll=function(b){return a(this,e,b)}})()}})(window);
(function(a){function b(){}function c(a,b,d){function e(a){e.once&&(a.currentTarget.removeEventListener(a.type,b,e),e.removed=!0);e.passive&&(a.preventDefault=c.preventDefault);"function"===typeof e.callback?e.callback.call(this,a):e.callback&&e.callback.handleEvent(a);e.passive&&delete a.preventDefault}e.type=a;e.callback=b;e.capture=!!d.capture;e.passive=!!d.passive;e.once=!!d.once;e.removed=!1;return e}var d=a.WeakMap||function(){function a(a,b,c){g=c;f=!1;k=void 0;a.dispatchEvent(b)}function b(a){this.value=
a}function c(){d++;this.__ce__=new e("@DOMMap:"+d+Math.random())}var d=0,f=!1,g=!1,k;b.prototype.handleEvent=function(a){f=!0;g?a.currentTarget.removeEventListener(a.type,this,!1):k=this.value};c.prototype={constructor:c,"delete":function(b){return a(b,this.__ce__,!0),f},get:function(b){a(b,this.__ce__,!1);b=k;k=void 0;return b},has:function(b){return a(b,this.__ce__,!1),f},set:function(c,d){a(c,this.__ce__,!0);c.addEventListener(this.__ce__.type,new b(d),!1);return this}};return c}();b.prototype=
(Object.create||Object)(null);c.preventDefault=function(){};var e=a.CustomEvent,f=a.dispatchEvent,g=a.addEventListener,k=a.removeEventListener,l=0,m=function(){l++},n=[].indexOf||function(a){for(var b=this.length;b--&&this[b]!==a;);return b},q=function(a){return"".concat(a.capture?"1":"0",a.passive?"1":"0",a.once?"1":"0")},r;try{g("_",m,{once:!0}),f(new e("_")),f(new e("_")),k("_",m,{once:!0})}catch(p){}1!==l&&function(){function e(a){return function(d,e,f){if(f&&"boolean"!==typeof f){var k=g.get(this),
l=q(f);k||g.set(this,k=new b);d in k||(k[d]={handler:[],wrap:[]});var m=k[d];k=n.call(m.handler,e);0>k?(k=m.handler.push(e)-1,m.wrap[k]=k=new b):k=m.wrap[k];l in k||(k[l]=c(d,e,f),a.call(this,d,k[l],k[l].capture))}else a.call(this,d,e,f)}}function f(a){return function(b,c,d){if(d&&"boolean"!==typeof d){var e=g.get(this);if(e&&b in e){var f=e[b];c=n.call(f.handler,c);if(-1<c){d=q(d);var k=f.wrap[c];if(d in k){a.call(this,b,k[d],k[d].capture);delete k[d];for(d in k)return;f.handler.splice(c,1);f.wrap.splice(c,
1);0===f.handler.length&&delete e[b]}}}}else a.call(this,b,c,d)}}var g=new d;r=function(a){a&&(a=a.prototype,a.addEventListener=e(a.addEventListener),a.removeEventListener=f(a.removeEventListener))};a.EventTarget?r(EventTarget):(r(a.Text),r(a.Element||a.HTMLElement),r(a.HTMLDocument),r(a.Window||{prototype:a}),r(a.XMLHttpRequest))}()})(self);var __doc=document;function $(a){return __doc.getElementById(a)}function $$(a,b){b=b||__doc;return Array.from(b.querySelectorAll(a))}
function node(a,b,c,d){a=__doc.createElement(a);b&&(a.id=b);c&&(a.className=c);void 0!==d&&("string"===typeof d&&(d=__doc.createTextNode(d)),d instanceof Node&&a.appendChild(d),Array.isArray(d)&&appendChildren(a,d));return a}function initButtonNode(a,b){var c=node("div",a,"topButtonWhole topButtonWholeLight");c.innerText=b.name;c.actionButton=b;c.actionButtonId=a;return c}
function checkButtonShow(a,b){return!((void 0===b?0:b)||!0!==a.hideButton&&"true"!==a.hideButton)||a.checkIfUserCanEdit&&!checkIfUserCanEdit(!0,!0)||!checkUserGroups(a.userGroups)?!1:!0}
function setButtonAction(a,b){var c=a.actionButton,d=a.actionButtonId,e=_needLockButton(c,b);e.lock&&(a.className="topButtonWhole topButtonWholeGrey",a.title=e.msg);a.onmousedown=function(a){(a||window.event).stopPropagation();e.lock?promptButtonLockMsg(e.msg):"B"===c.type?execActionScript(d,!1,b):"F"===c.type?callURLActionButton(d,!1,b):c.type.startsWith("T")&&execToolAction(d,!1,b)}}function text(a){return __doc.createTextNode(a)}
Node.prototype.attr=function(a){if(isPlainObject(a))for(var b in a)a.hasOwnProperty(b)&&(this.style[b]=a[b]);else"string"===typeof a&&this.setAttribute("style",a)};function insertAfter(a,b){if(void 0!==b){var c=b.parentNode;c.lastChild==b?c.appendChild(a):c.insertBefore(a,b.nextSibling)}}function setAttributes(a,b){for(var c in b)a.setAttribute(c,b[c])}
function appendChildren(a,b){if(a&&b){var c=__doc.createDocumentFragment();Array.isArray(b)||(b=[b]);b.forEach(function(a){if(a||0===a)a instanceof Node||(a=String(a)),"string"===typeof a?insertHtmlAt(c,a,2):a instanceof Node&&c.appendChild(a)});a.appendChild(c)}}
function createElement(a,b,c){if(!a||"string"!==typeof a)return null;a=node(a);if(b)if(isPlainObject(b))b.attrs&&setAttributes(a,b.attrs),b.id&&(a.id=b.id),b.class&&addClasses(a,b.class),b.style&&a.attr(b.style),b.children&&appendChildren(a,b.children),b.callback&&b.callback.call(b,a);else if("string"===typeof b||Array.isArray(b)||b instanceof Node)c=b;c&&appendChildren(a,c);return a}var h=createElement;function isPlainObject(a){return"[object Object]"===Object.prototype.toString.call(a)}
function addClasses(a,b){if(b&&("string"===typeof b&&(b=b.split(" ")),Array.isArray(b)))for(var c=0,d=b.length,e;c<d;c++)e=b[c],"string"===typeof e&&e&&a.classList.add(e)}
function insertHtmlAt(a,b,c){if(!a||"string"!==typeof b||!isNumeric(c)||0>c||3<c)return!1;var d=["beforebegin","afterbegin","beforeend","afterend"];if(a.insertAdjacentHTML)a.insertAdjacentHTML(d[c],b);else switch(b=document.createRange().createContextualFragment(b),c){case 0:a.parentNode.insertBefore(b,a);break;case 1:a.insertBefore(b,a.childNodes[0]);break;case 2:a.appendChild(b);break;case 3:c=a.parentNode,c.lastElementChild===a?c.appendChild(b):c.insertBefore(b,a.nextSibling)}return!0}
function equalIgnoreCase(a,b){return a.toUpperCase()===b.toUpperCase()}function ArrayContainsIgnoreCase(a,b){return a.some(function(a){return equalIgnoreCase(a,b)})}function deepCopy(a,b){void 0===b&&(b=[]);if(null===a||"object"!==typeof a)return a;var c=b.find(function(b){return b.original===a});if(c)return c.copy;var d=Array.isArray(a)?[]:{};b.push({original:a,copy:d});("undefined"===typeof Reflect?Object.keys(a):Reflect.ownKeys(a)).forEach(function(c){d[c]=deepCopy(a[c],b)});return d}
function triggerEvent(a,b){var c=document.createEvent("Event");c.initEvent(b,!0,!1);a.dispatchEvent(c)}function e_target(a){if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);return b}function evalJS(a){eval(a.responseText)}function rm(a){if(!a)return a;for(;a.firstChild;)a.removeChild(a.firstChild);return a}function debugObject(a){var b="",c;for(c in a)b+=c+":"+a[c]+"<br/>";return b}
function read(a,b,c,d){var e=new Date;if(b==ctrl.lastReadUrl){if(ctrl.lastReadCount++,10<ctrl.lastReadCount&&1E3>e.getTime()-ctrl.lastReadTime)return}else ctrl.lastReadUrl=b,ctrl.lastReadCount=0,ctrl.lastReadTime=e.getTime();var f=new XMLHttpRequest;c||(f.onreadystatechange=function(){if(4==f.readyState){if(200!=f.status&&!d)return!1;if(a)try{a(f)}catch(g){throw g.message+=", executed file:"+b,g;}}});try{f.open("GET",b,!c),f.send(null)}catch(g){return floatWinLoading(lm.saveRetry),setTimeout(function(){ctrl.readRetry=
!0;read(a,b,c,d)},5E3),!1}if(c){if(200!=f.status&&!d)return!1;ctrl.readRetry&&(ctrl.readRetry=!1,floatWinSuccess(lm.reconnected),setTimeout(function(){floatWinClose()},2E3));if(a)try{a(f)}catch(g){throw g.message+=", executed file:"+b,g;}}return!0}function delay(a,b){return new Promise(function(c){setTimeout(c,a,b)})}function nativePromptPromise(a,b){return new Promise(function(c,d){var e=prompt(a,b);return e.length?c(e):d(!1)})}
function promptPromise(a,b){return new Promise(function(c,d){var e=document.createElement("DIV"),f=document.createElement("DIV"),g=document.createElement("INPUT"),k=document.createElement("DIV"),l=document.createElement("DIV");f.textContent=a;k.textContent=lm.confirm_ok;l.textContent=lm.confirm_cancel;g.type="text";g.style.width="100%";g.style.marginTop="5px";g.style.marginBottom="15px";b&&(g.value=b);k.classList.add("topButtonWhole");k.style.float="right";k.addEventListener("click",function(){c(g.value);
$("floatingWinCloseIcon").click()});l.classList.add("topButtonWhole");l.style.float="right";l.addEventListener("click",function(){d(!1);$("floatingWinCloseIcon").click()});e.appendChild(f);e.appendChild(g);e.appendChild(l);e.appendChild(k);floatWin(function(){$("floatingWinCloseIcon").addEventListener("mousedown",d.bind(null,!1),{once:!0})},e,"",!0)})}function nativeConfirmPromise(a){return new Promise(function(b,c){return confirm(a)?b(!0):c(!1)})}
function confirmPromise(a){return new Promise(function(b,c){floatWinConfirmV3(a,function(){b(!0);floatWinClose()},null,function(){c(!1);floatWinClose()})})}
function createPromiseRequest(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open(a.method,a.url);d.onload=function(){200<=this.status&&300>this.status?b(d.response):c({status:this.status,statusText:d.statusText,response:d.response})};d.onerror=function(){c({status:this.status,statusText:d.statusText})};a.hasOwnProperty("headers")&&Object.keys(a.headers).forEach(function(b){d.setRequestHeader(b,a.headers[b])});a.hasOwnProperty("responseType")&&(d.responseType=a.responseType);d.send(a.data||
null)})}function getPromise(a,b){"string"==typeof b?a+="?"+b:(b=b||{},b=Object.entries(b).reduce(function(a,b){var c=b[0];b=b[1];if(Array.isArray(b))return a.concat(b.map(function(a){return encodeURIComponent(c)+"="+encodeURIComponent(a)}));a.push(encodeURIComponent(c)+"="+encodeURIComponent(b));return a},[]),b.length&&(a+="?"+b.join("&")));return createPromiseRequest({method:"GET",url:a})}var curriedGetPromise=curry(getPromise),getAutogenGuess=curriedGetPromise("/sims/autogenGuess.jsp"),getSeq=curriedGetPromise("/sims/seq.jsp");
function postPromise(a,b){b=b||{};b=Object.entries(b).reduce(function(a,b){var c=b[0];b=b[1];if(Array.isArray(b))return a.concat(b.map(function(a){return encodeURIComponent(c)+"="+encodeURIComponent(a)}));a.push(encodeURIComponent(c)+"="+encodeURIComponent(b));return a},[]).join("&").replace(/%20/g,"+");return createPromiseRequest({method:"POST",url:a,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:b})}
function postFormDataPromise(a,b){return createPromiseRequest({method:"POST",url:a,data:b})}function readBlobAsDataURL(a){return new Promise(function(b,c){var d=new FileReader;d.onloadend=function(a){return b(a.target.result)};d.onerror=c;d.readAsDataURL(a)})}var floatingWinUrlFunc;
function floatTinyWin(a,b,c){b||(b="null/undefined");$("floatingTinyWin").style.display="";c?$("floatingTinyWinContent").innerHTML=b+"<br>":$("floatingTinyWinContent").innerHTML+=b+"<br>";a&&($("floatingTinyWin").onclick=a)}function floatMouseWin(a,b){var c=$("floatingMouseWin");c.innerHTML=b;c.style.top=a.clientY+"px";c.style.left=a.clientX+12+"px";c.style.zIndex="62";c.style.display=""}var emptyFunction=function(){};
function compose(){var a=arguments;return function(b){for(var c=0;c<a.length;c++)b=a[c].call(this,b);return b}}String.prototype.replaceAt=function(a,b){return this.substr(0,a)+b+this.substr(a+b.length)};String.prototype.format=function(){var a=arguments;return this.replace(/\{(\d+)\}/g,function(b,c){return a[c]})};
function newModulePromptV2(a,b){var c="",d='<div style="margin:8px 0 25px 25px;float:left;_width:500px;"><div id="newModuleDiv1"><div><div id="modDivContainer" style="white-space:nowrap;overflow:hidden;width:470px;margin:0 5px;">',e=Object.keys(accountProfile);preInitTabColorList();e.sort(function(a,b){return accountProfile[a].order-accountProfile[b].order});e.forEach(function(a){var b=accountProfile[a];a.includes("/ragic-setup")||a.includes("Report")||(c=a,d+='<div id="module'+a+'" onclick="appPicker(\''+
a+'\')" class="moduleDiv">'+b.realName.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</div>")});path&&!isPathTaken(path)&&"/ragic-setup"!==path&&"Report"!==path&&(c=path);d+='</div><div id="moduleHR" class="v6TabHR" style="background:#333333;position:relative;top: 0px;"></div></div><div id="ctrlBtns" style="margin:0 10px;"><i id="moduleScrollLeft" style="font-size:30px;font-weight: bold;line-height:40px;" onmousedown="scrollTabMove(this, $(\'modDivContainer\'), \'L\');" class="fa fa-angle-left tabScrollBtn"></i><i id="moduleScrollRight" style="font-size:30px;font-weight: bold;line-height:40px;" onmousedown="scrollTabMove(this, $(\'modDivContainer\'), \'R\');" class="fa fa-angle-right tabScrollBtn"></i></div></div>';
d+='<div id="newModuleDiv2">'+(b?'<div style="margin:30px 0 0 0;"><input id="newSheetRadio1" name="newSheetRadio" style="float:left;margin:1px 0 0 12px;font-size:16px;" type="radio" disabled="true" /><div style="font-weight:bold;color:#aaa;margin:0 0 0 12px;float:left;font-size:16px;"><label for="newSheetRadio1">'+lm.designNewSheet+'</label></div><div style="float:left;clear:left;margin:8px 0 5px 39px;width:398px;font-size:16px;color:#aaaaaa;">'+lm.noMoreCustomSheets.format(window.maxSheets)+"</div></div>":
'<div id="newSheetOption1" style="margin:30px 0 0 0;"><input id="newSheetRadio1" name="newSheetRadio" style="float:left;margin:1px 0 0 12px;font-size:16px;" type="radio" checked="true" /><div style="font-weight:bold;color:#555;margin:0 0 0 12px;float:left;font-size:16px;"><label for="newSheetRadio1">'+lm.designNewSheet+'</label></div><div style="float:left;clear:left;margin:5px 0 5px 35px;"><input id="floatWinPromptInput" placeholder="'+lm.sheetName+'" type="text" style="border:1px solid #aaa;font-size:16px;width:355px;" onfocus="ctrl.enterSubmitBox=this;ctrl.enterSubmitButton=$(\'floatWinPromptSubmit\');$(\'newSheetRadio1\').checked=true;" onblur="ctrl.enterSubmitBox=null;ctrl.enterSubmitButton=null;" id=floatWinPromptInput value="" autocomplete="off" /></div><div id=newUrlShow style="float:left;clear:left;color:#888888;margin:0 0 0 35px;"></div><span id="chkImportFormSpan" style="float:left;clear:left;font-size:16px;margin:2px 0 0 35px"><input type="checkbox" id="chkImportForm" value="1" style="margin:0 10px 0 0;font-size:18px;line-height:20px;"/><label for="chkImportForm" style="font-size:16px;line-height:20px;">'+
lm.Excel_create+"</label></span></div>")+'<div id="newSheetOption2" style="margin:30px 0 0 0;"><input id="newSheetRadio2" name="newSheetRadio" style="float:left;margin:1px 0 0 12px;font-size:16px;" '+(b?'checked="true"':"")+' type="radio" /><div style="font-weight:bold;color:#555;margin:0 0 0 12px;font-size:16px;float:left;"><label for="newSheetRadio2">'+lm.installTemplate+'</label></div></div><input type=button id="floatWinPromptSubmit" onclick="_createModule();" class="topButtonWhole" style="clear:left;float:left;padding:8px 25px;margin:30px 0 0 35px;font-size:16px;" value="'+
lm.create+'" /></div>';floatWin(function(){moduleContainerResize(c);if(0<e.length)a?appPicker(a):appPicker(c);else if($("moduleInsArrow")){var b=$("addAppBtn").getBoundingClientRect().right-$("modDivContainer").getBoundingClientRect().left;$("moduleInsArrow").style.marginLeft=b-18+"px"}},d,lm.newSheet,!0)}
function moduleContainerResize(a){var b=$("modDivContainer"),c=$("ctrlBtns"),d=$("addAppBtn"),e=$("moduleScrollRight");d||(d=document.createElement("div"),d.id="addAppBtn",d.className="moduleDiv",d.onclick=addModuleApp,d.innerHTML='<i class="fa fa-plus" style="font-size:12px;margin:3px 0 0 0;"></i>');b.style.width="430px";b.scrollWidth===b.clientWidth?(c.style.display="none",$("moduleScrollLeft").style.color="#ccc",$("modDivContainer").appendChild(d),b.style.width="470px"):(c.appendChild(d),b.style.width=
"380px",a?(b.scrollLeft=$("module"+a).getBoundingClientRect().left-b.getBoundingClientRect().left,5>=Math.abs(b.scrollWidth-b.clientWidth-b.scrollLeft)?(c.style.display="",e.style.color="#ccc"):(c.style.display=0===b.scrollLeft?"#ccc":"",e.style.color="")):(e.style.color="#ccc",c.style.display="",b.scrollLeft+=b.scrollWidth-b.clientWidth))}
function addModuleApp(){var a=$("modDivContainer");"none"===$("ctrlBtns").style.display&&a.removeChild($("addAppBtn"));if("add"!==a.dataset.status){a.dataset.status="add";var b=document.createElement("div"),c=document.createElement("input"),d=document.createElement("button");b.appendChild(c);c.type="text";c.style.width="110px";c.id="moduleInput";c.onfocus=function(){ctrl.createTab=!0};c.onblur=function(){ctrl.createTab=!1};d.textContent=lm.save;d.id="moduleSaveBtn";b.appendChild(d);b.className="moduleDiv";
b.id="newModuleDiv";b.style.maxWidth="400px";b.style.padding="7px";a.appendChild(b);moduleContainerResize();scrollTabMove($("moduleScrollRight"),a,"R");setTimeout(function(){c.value=lm.newTab;c.select();a.dataset.status="input"},200);$("moduleSaveBtn").addEventListener("click",createCurrentTabName,!1)}}
function createCurrentTabName(){ctrl.createTab=!1;var a=$("modDivContainer"),b=$("moduleInput"),c=$("newModuleDiv");""!==a.dataset.status&&(a.dataset.status="",b=b.value.trim(),b.length?(tutorial.getEnabled()&&tutorial.setTuDbName(b),postPromise("/sims/appUpdate.jsp",{a:ap,nn:b,msi:menuSetIndex}).then(eval)):(a.removeChild(c),moduleContainerResize()))}
function appPicker(a){var b=$("module"+ctrl.createPath),c=accountProfile["/ragic-setup"];b&&b.removeAttribute("style");var d=Object.keys(accountProfile).filter(function(a){return"/ragic-setup"!==a})[0];ctrl.createPath=a;b=accountProfile[a];d=$("module"+a)||$("module"+d);var e="#cc0000 #236FBD #049d57 #56458C #b0710a #00bbcc #cc00a8".split(" ");c=e[(b&&b.order?b.order-1-(c&&c.order<b.order?1:0):0)%e.length];tabColorList&&tabColorList[a]&&(c=tabColorList[a].color);$("moduleHR").style.backgroundColor=
c;d&&(d.style.backgroundColor=c,d.style.color="white");$("floatWinPromptInput")&&$("floatWinPromptInput").focus()}function indexOf(a,b){if(!b||!a&&0!==a)return-1;for(var c=0;c<b.length;c++)if(b[c]==a)return c;return-1}var prod=location.hostname.includes(".ragic.com");function getCookie(a){for(var b=document.cookie.split("; "),c=0;c<b.length;c++){var d=b[c].split("=");if(a==d[0])return decodeURIComponent(d[1])}return null}
function removeCookie(a){prod?(document.cookie=a+"=;path=/;domain=.ragic.com; expires=Sat, 01-Jan-2000 00:00:00 GMT",document.cookie=a+"=;path=/;domain=www.ragic.com; expires=Sat, 01-Jan-2000 00:00:00 GMT"):document.cookie=a+"=;path=/; expires=Sat, 01-Jan-2000 00:00:00 GMT"}
function setCookie(a,b,c,d){prod&&getCookie(a)&&removeCookie(a);c=c?new Date((new Date).getTime()+c):new Date((new Date).getTime()+31536E7);a=a+"="+encodeURIComponent(b)+";";a=a+" path=/ ; expires="+(c.toGMTString()+";");document.cookie=a+(d?" secure;":"")}function getStorage(a){var b=getCookie(a);b&&(removeCookie(a),RagicStorage.localStorage.setItem(a,b));return RagicStorage.localStorage.getItem(a)}function noUnit(a){return a?a.toString().substring(0,a.length-2):""}function dummy(a){}
function makeButton(a){a.className="topButtonWhole";a.onmouseover=function(){buttover(this)};a.onmouseout=function(){buttout(this)};a.onmousedown=function(){this.style.backgroundPosition="0 21px"};a.onmouseup=function(){this.style.backgroundPosition="0 0"}}function buttover(a){a&&(a.style.border="1px solid #bdbdbd",-1==window.location.search.indexOf("webview")&&showTooltip(a,3))}
function buttout(a){a&&(a.style.border="1px solid #dbdbdb",a.style.backgroundPosition="0 0",-1==window.location.search.indexOf("webview")&&hideTinyTooltip())}function showTooltip(a,b,c){tutorial.getEnabled()||(lm["tt_"+a.id]&&tooltipTiny(a,lm["tt_"+a.id]),lm["tt_"+a.className]?tooltipTiny(a,lm["tt_"+a.className]):c&&tooltipV2(a,c,b))}
function hideTooltip(){if(!ctrl.tooltipLock&&!tutorial.getEnabled()){ctrl.buttoutTimer&&clearTimeout(ctrl.buttoutTimer);var a=$("tutorial");a&&(1==a.style.opacity&&(ctrl.tooltipAnim=!0),a.style.opacity=0,setTimeout(function(){ctrl.tooltipAnim=!1},100),ctrl.buttoutTimer=setTimeout(function(){$("tutorial").style.display="none";ctrl.tooltipAnim=!1},500));isFunction(ctrl.tooltipCloseCallback)&&setTimeout(function(){ctrl.tooltipCloseCallback();ctrl.tooltipCloseCallback=null},1E3)}}
function panelover(a){a&&(a.style.backgroundColor="#CCC9B8")}function panelout(a){a&&(a.style.backgroundColor="")}function rightMenuOver(a){a&&(a.style.backgroundColor="#CCCCCC")}function rightMenuOut(a){a&&(a.style.backgroundColor="")}function topDropOver(a){a&&(a.style.backgroundColor="#666666")}function topDropOut(a){a&&(a.style.backgroundColor="")}function __setBorderClasswebby(a,b,c){a&&(c=a.id.split("_"),parseInt(c[1]),parseInt(c[2]),b&&1!=b&&(a.style.background=b))}var setBorderClass=__setBorderClasswebby;
function __setBorderClassdefault(a,b,c){if(a){var d=parseInt(a.id.split("_")[1]),e=parseInt(a.id.split("_")[2]),f=nui;if(b)1!=b&&(a.style.background=b);else if(b=biffdata.tAttr)for(var g in b)a.style[g]=b[g];else a.style.backgroundColor="#E0E7EF";a.style.borderBottom="1px solid #999";a.style.borderRight="1px solid #999";a=f._getcell(d,e-1);g=f._getcell(d-1,e);a&&(a.style.borderBottom="1px solid #999");g&&(g.style.borderRight="1px solid #999");if(c)for(c=parseInt(c),g=1;g<c;g++)if(a=f._getcell(d+g,
e-1))a.style.borderBottom="1px solid #999"}}function removeBorderClass(a,b){var c=parseInt(a.id.split("_")[1]),d=parseInt(a.id.split("_")[2]);a.style.backgroundImage="";a.style.backgroundColor="";a.className=b;a.style.borderBottom="1px solid #EEE";a.style.borderRight="1px solid #EEE";a=nui._getcell(c,d-1);c=nui._getcell(c-1,d);a&&(a.style.borderBottom="1px solid #EEE");c&&(c.style.borderRight="1px solid #EEE")}
function changeLang(a){a=a.options[a.selectedIndex].value;setCookie("lang",a);ajaxget(window.location.origin+"/api/internal/main_setPreferredLang.jsp",{email:"",lang:a},function(){location.reload(!0)})}
function changeHomeLang(a){var b=a.options[a.selectedIndex].value;setCookie("lang",b);ajaxget(window.location.origin+"/api/internal/main_setPreferredLang.jsp",{email:"",lang:b},function(){var a=location.toString().substr(0,location.toString().length-location.hash.length);a=a.split("/");4>=a.length?location.reload():(a[4]=b,a=a.join("/"),window.location=a)})}
function defaultSelectElement(a,b,c,d){if(a&&b)for(c&&(a.options[c].selected=!0),c=a.options.length-1;0<=c;c--)if(a.options[c].value==b&&(!d||a.options[c].innerText===d)){a.options[c].selected=!0;break}}function prefSettingChange(a){"userpref_showLinkNLoadAsLink"===a.target.id&&($("userpref_clickLinkFieldToOpenEntry").checked=!1);"userpref_clickLinkFieldToOpenEntry"===a.target.id&&($("userpref_showLinkNLoadAsLink").checked=!1)}
function changePrefSettingTab(a,b){var c;var d=document.getElementsByClassName("userpref_tabcontent");for(c=0;c<d.length;c++)d[c].style.display="none";d=document.getElementsByClassName("userpref_tablinks");for(c=0;c<d.length;c++)d[c].className="userpref_tablinks";$(b).style.display="";a.target.className+=" userpref_tablinksOn"}
function getPrefSetting(){floatWin(null,lm.prop_loading,lm.personalSetting,!0);postPromise("/sims/reg/getPersonalSetting.jsp",{a:ap}).then(function(a){floatWin(null,a,lm.personalSetting,!0);setUserAvatar();a=$("floatingWin");var b=a.querySelector("#userpref_fontSizeRate"),c=ctrl.fontSizeRate;b.value=c;b.dataset.originalValue=c;updatePersonalSettingFontSize(c,!0);a.querySelector("#floatingWinCloseIcon").addEventListener("click",function(){var a=b.dataset.originalValue;b.value!==a&&updatePersonalSettingFontSize(a);
$("floatingWinAvatarPicker").style.display="none"},{once:!0})})}
function savePrefSetting(a){var b={},c={},d=a.getElementsByTagName("input");c.ap=ap;if("changeInfoForm"==a.id){d=$("userpref_picture");var e=d.getAttribute("src");if(e&&e.startsWith("data:image")||!e)b.picture=e,b.pictureName=d.dataset.imgname;if($("userpref_sign").src&&$("userpref_sign").src.startsWith("data:image")||!$("userpref_sign").src)b.sign=$("userpref_sign").src;if($("deputyBarSelect"))try{var f=BarSelectAgent.getSelector("deputyBarSelect").getOption();f&&(b.deputy=f.value)}catch(l){}b.name=
$("userpref_name").value;b.phone=$("userpref_phone").value;b.auto_notify_deputy=$("userpref_auto_notify_deputy").checked;b["2fa"]=$("userpref_2fa").checked;c[a.id]=b;a.querySelector("input[name=json]").value=JSON.stringify(c);a.submit()}else for(f=0;f<d.length;f++){e=d[f];if("checkbox"==e.type)"userpref_fpHoverDisabled"==e.id||"userpref_pathTabHoverShowDropWin"==e.id?b[e.id.replace("userpref_","")]=e.checked?"false":"true":b[e.id.replace("userpref_","")]=e.checked?"true":"false";else if("text"==e.type){var g=
e.id.replace("userpref_","");e=e.value;if("rowsPerPage"==g){if(25>Number(e)||isNaN(Number(e)))e="25";changeEPP(Number(e));b[g]=e}}else if("range"===e.type){g=e.id.replace("userpref_","");var k=e.value;"fontSizeRate"===g&&(b[g]=k,e.dataset.originalValue=k,ctrl.fontSizeRate=k,getCookie("fontSizeCookie")&&removeCookie("fontSizeCookie"))}f==d.length-1&&(c[a.id]=b,a.querySelector("input[type=hidden]").value=JSON.stringify(c),a.submit())}}
function openPwdSetting(){getPromise("/sims/reg/changePwd.jsp",{selfApname:ap}).then(function(a){for(var b=document.querySelectorAll(".userpref_tabcontent"),c=0;c<b.length;c++)b[c].style.display="none";b=$("personal_changePwd");b.innerHTML=a;a=node("div");a.style.overflow="hidden";a.style.margin="15px 10px 15px 5px";c=node("a");c.href="javascript:void(0)";c.textContent=lm.back;c.onclick=function(){$("personal_info_link").click();$("floatingWinHeader").textContent=lm.personalSetting};a.appendChild(c);
c=b.querySelector("table");c.style.marginLeft="5px";b.insertBefore(a,c);b.style.display="";$("floatingWinHeader").textContent=lm.changePassword})}function prefSettingChangeSign(){for(var a=document.getElementsByClassName("userpref_tabcontent"),b=0;b<a.length;b++)a[b].style.display="none";$("personal_changeSign").style.display="";$("floatingWinHeader").textContent=lm.changeSign;a=$("sigcanvas");loadSigScript(a);ctrl.isIE&&ctrl.isObsoleteIE||setSignatureBackgroundBox($("sigBackgroundDiv"))}
function prefSettingSaveSign(){for(var a=document.getElementsByClassName("userpref_tabcontent"),b=0;b<a.length;b++)a[b].style.display="none";$("personal_info").style.display="";!ctrl.signaturePad.isEmpty()||void 0!=ctrl.signaturePad._isBackGroundEmpty&&!ctrl.signaturePad._isBackGroundEmpty?$("userpref_sign").src=ctrl.signaturePad.toDataURL():$("userpref_sign").removeAttribute("src");$("floatingWinHeader").textContent=lm.personalSetting}
function loadPrefSettingPic(){var a=$("userpref_getpicture").files[0];a&&readBlobAsDataURL(a).then(function(a){$("userpref_picture").src=a})}
function setUserAvatar(){var a=$("avatar_default_pics_link"),b=$("avatar_upload_pic_link"),c=$("avatar_remove_pic_link"),d=$("floatingWinAvatarPickerContent"),e=$("userpref_picture");(function(){a&&b&&d&&e&&(imageOrientationRotate(e),a.onclick=function(){getPromise("/sims/defaultAvatarPickerContent.jsp").then(function(a){d.innerHTML=a;$("floatingWinAvatarPicker").style.display=""})},b.onclick=function(){var a=node("FORM"),b=node("INPUT");a.appendChild(b);b.accept="image/*";b.type="file";b.onchange=
function(){var a=this.files[0];a&&readBlobAsDataURL(a).then(function(a){e.src=a;e.dataset.imgname="Avatar.png";imageOrientationRotate(e)})};b.click()},d.onclick=function(a){function b(a,b,c){var d=new Image;d.crossOrigin="Anonymous";d.onload=function(){var a=document.createElement("CANVAS"),d=a.getContext("2d");a.height=this.naturalHeight;a.width=this.naturalWidth;d.drawImage(this,0,0);a=a.toDataURL(c);b(a)};d.src=a}a=a.target;"IMG"==a.tagName.toUpperCase()&&b(a.src,function(a){e.src=a;e.dataset.imgname=
"Avatar.png";e.style.transform="rotate(0deg)"})},c.onclick=function(a){e.src="";delete e.dataset.imgname})})()}function loadDeputySelector(a){if(a){a.style.display="none";var b=a.parentElement,c=node("I","","fas fa-spinner fa-spin");b.appendChild(c);getPromise("/sims/getDeputyOptions.jsp",{a:ap}).then(function(a){var d=node("SELECT");a&&(d.innerHTML=a);BarSelectAgent.modifiedSelector("deputyBarSelect",d,$("deputySelectorContainer"),{barSelectStyles:{"font-size":"13px"}});b.removeChild(c)})}}
function pwdcheck(){return 6>$("pwd").value.length?($("pwdMsg").innerHTML='<span style="color:#ff0000">'+lm.pwdShort+"</span>",!1):$("pwd").value!=$("cpwd").value?($("pwdMsg").innerHTML='<span style="color:#ff0000">'+lm.pwdNotMatch+"</span>",!1):!0}
function passwordStrengthCheck(a,b){var c=/^(?=.{8,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\W).*$/g,d=/^(?=.{7,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$/g,e=/(?=.{6,}).*/g;0==a.value.length?rm(b):0==e.test(a.value)?b.textContent="Not long enough.":c.test(a.value)?b.innerHTML='<span style="color:green">Strong</span>':d.test(a.value)?b.innerHTML='<span style="color:orange">Medium</span>':b.innerHTML='<span style="color:red">Weak</span>'}
function genRandom(a,b){b=_genRandom(a,b);for(var c=0;b.startsWith("0");){b=_genRandom(a);if(1E3<c)break;c++}return b}
function _genRandom(a,b){if(b){b="";for(var c=0;c<a;c++)switch(Math.floor(3*Math.random())){case 0:b+=Math.floor(10*Math.random());break;case 1:b+="abcdefghijklmnopqrstuvwxyz"[Math.floor(26*Math.random())];break;case 2:b+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(26*Math.random())]}return b}b=Math.round(Math.random()*Math.pow(10,a));b=""+b;a-=b.length;for(c=0;c<a;c++)b="0"+b;return b}function toggle(a){if("none"!=a.style.display)return a.style.display="none",!1;a.style.display="";return!0}
function toggleMore(a,b){toggle(a)?b.innerHTML="Less":b.innerHTML="More"}function checkEntryRights(a,b,c){var d={};ajaxget("/sims/rightsChecker.jsp",{ap:ap,path:a,si:b,ni:c},function(a){d=JSON.parse(a)},!0);return d}function checkFormRights(a,b){var c={};ajaxget("/sims/rightsChecker.jsp",{ap:ap,path:a,si:b},function(a){c=JSON.parse(a)},!0);return c}
function exitDesigner(){ctrl.designSavingMain?setTimeout(exitDesigner,200):(builder.doingCopyStyle=!1,builder.copiedStyles={},builder.keepCopying=!1,clearTimeout(ctrl.designModeReloadTimer),resetHotspot(),closeDesignModeHelper(),$("floatingFormRules").style.display="none",$("floatingApprovalRules").style.display="none",$("addRefHardLinkDiv").style.display="none",$("addRefSubtableDiv").style.display="none",$("floatingEntryUpdater").style.display="none",Object.keys(builderModeEmailTemplateEditors).forEach(function(a){builderModeEmailTemplateEditors[a].initStatus=
BuilderModeEmailTemplateEditor.prototype.STATUS.INIT}),builder.createNUI()!==builder.startNUI?floatWinConfirmV3(lm.saveDesignBeforeExit,"ctrl.exitAfterDesignerSave=true;saveBuilder();",lm.saveAndExit,"_exitDesigner();",lm.exitWithoutSaving):_exitDesigner())}
function _exitDesigner(){builder.removeLinkAndLoadActions();builder.isSheetNew?(mode=BROWSE,path&&ap&&postPromise("/sims/menu/menusetQuery.jsp",{path:path,a:ap}).then(function(a){location.href="/"+ap+"/home/"+a}),location.href="/"+ap):(inNUI(),backToBrowse(!0))}function resetHotspot(){ctrl.dropWinLock=!1;ctrl.dropWin=!1;ctrl.hotspot&&(ctrl.hotspot.style.display="none")}
function backToBrowse(a){window.mvpMode||(!biffdata.changed||biffdata.autoSave||a?(mode===UPDATE&&(biffdata.deleteDraft(),ctrl.hidNodes=null,a={a:ap,p:path,fn:sheet,unlock:""},biffdata.ifListingPage()?a.sl="":a.ni=biffdata.rootNodeId,postPromise("/sims/lockEntry.jsp",a)),biffdata.txnId=(new Date).getTime(),a=mode===UPDATE&&0>biffdata.rootNodeId,modeBrowse(),nui.main.scrollTop=0,nui.main.scrollLeft=0,nui.fcol=-1,nui.frow=-1,nui._updateFocus(),a&&browseBack(),builder.isSheetNew&&location.reload(),ctrl.hotspot&&
(ctrl.hotspot.style.display="none")):confirmPromise(lm.away).then(backToBrowse.bind(null,!0)).catch(emptyFunction))}function findPos(a){if(!a)return null;for(var b=a.offsetLeft,c=a.offsetTop,d=a.classList&&a.classList.contains("tooltipQ"),e=a;a=a.offsetParent;)b+=a.offsetLeft,c+=a.offsetTop;for(a=e.parentNode;d&&null!=a;)0<a.scrollTop&&(c-=a.scrollTop),a=a.parentNode;return[b,c]}function recoverMenu(a,b){postPromise("/sims/undo.jsp",{a:a,hid:b}).then(eval)}
function deleteMenuPerm(a,b){confirmPromise(lm.deleteMenuPermMsg).then(function(){return postPromise("/sims/delPerm.jsp",{a:a,hid:b})}).then(eval).catch(emptyFunction)}function readMoreDeleted(a,b,c,d){var e=$("container_"+b),f={};c||(c=0);f.a=ap;f[b]=c;f.filterClickMore=d||"";getPromise("/sims/recovery.jsp",f).then(function(b){a.style.display="none";e.innerHTML+=b})}function recoverEntry(a,b){setTimeout(updateSystemTaskProgress,1E3);postPromise("/sims/undo.jsp",{a:a,t:b}).then(eval)}
function deleteEntryPerm(a,b){confirm(lm.deletePermMsg)&&postPromise("/sims/delPerm.jsp",{a:a,t:b}).then(eval)}function emptyBin(a){confirm(lm.emptyBinMsg)&&postPromise("/sims/delPerm.jsp",{a:a,t:0}).then(eval)}
function deleteEntry(a,b,c){a={a:ap,d:a,n:b,p:path,fn:sheet,rpn:biffdata.rootNodeId,rd:biffdata.rootDomainId,ds:biffdata.ds};c&&!isNaN(c)&&(a.toolButtonSeq=c);postPromise("/sims/delv6.jsp",a).then(eval).then(function(){ctrl.currentController.resetBrowseLeft();clearListingPageCheckbox();prepareListingPageCheckboxes();browseBack()})}function cancelDelete(){floatWinClose()}
function submitNUIForm(){if(!window.mvpMode&&!ctrl.submitSemaphore){ctrl.submitSemaphore=!0;ctrl.submittingNUIForm=!0;var a=nui._curcell();if(a&&a.ip)try{a.ip.blur(),!biffdata.ifListingPage()&&biffdata.ifSubtableDataBiff(a.ip.biff)&&updateSameSubtableRowBiffsFormulaEngine(a.ip.biff,!0)}catch(f){processJSExceptionObj(f)}biffdata.globalConst&&biffdata.globalConst._ragic_formula_recalc_onsave&&formulaBuilder.updateAll();a=biffdata.biffs;for(var b=a.length,c=0;c<b;c++){var d=a[c],e=d.ip;if(e&&e.IPType===
UPLOADER&&e.currentUploadXhr){e.currentUploadXhr.addEventListener("load",submitNUIForm,!1);ctrl.submitSemaphore=!1;return}!d||d.IPType!==UPLOADER&&d.IPType!==GRAPHICS||(e=$("IX"+d.x+"Y"+d.y),d.hasAttribute("multipleImages")||d.hasAttribute("multipleFiles")||!e||"file"!==e.type||(e.type="hidden"))}biffdata.loadAllLastEditTimeDefaultValues();d=validateAll();a=d.toString();RagicInteractiveRules.execute(!0);0<a.length?(c=b=-1,d.hasOwnProperty("errorFields")&&(d=Object.values(d.errorFields),d.length&&
(d=Object.values(d[0]),d.length&&d[0].errValues&&(c=Object.keys(d[0].errValues)[0].split(","),b=parseInt(c[1]),c=parseInt(c[2])))),0<b&&0<c&&nui._focus(b,c),a="<div>"+a+'</div><div class="dropdownOptionv6" style="clear:both;padding:20px 0 0 0;font-weight:700;color:grey;" onclick="displayErrorExplanationDetail()">'+(lm.errorExplanationTitle_validate_all+'<i class="fa fa-search-plus"></i></div><div id="errorExplanationDetailDiv" style="display:none;color:#888;">'+lm.errorExplanationDetail_validate_all+
"<div>"),floatWin(null,a),ctrl.submitSemaphore=!1):(floatWinLoading(lm.entrySaving),$("bSave").className="topButtonWholeGrey",$("bSave").disabled=!0,_submitNUIForm())}}function submitNUIFormCallback(){ctrl.outOfNUI=!1;ctrl.submitSemaphore=!1;$("bSave").className="topButtonWhole";$("bSave").removeAttribute("disabled");biffdata.deleteDraft()}
function _submitNUIForm(){if(500>formulaBuilder.getIdle())setTimeout(_submitNUIForm,250);else{if(ctrl.hidNodes&&0<ctrl.hidNodes.length){for(var a=0;a<ctrl.hidNodes.length;a++)$("nuiform").appendChild(ctrl.hidNodes[a]);ctrl.hidNodes=null}biffdata.txnId=(new Date).getTime();ctrl.submittingNUIForm=!1;setTimeout(function(){$("nuiiframe").onload=nuiiframeReturn;$("nuiiframe").onerror=nuiiframeReturn;$("nuiform").submit()},300)}}
function nuiiframeReturn(a){ctrl.submitSemaphore&&(0<ctrl.saveRetryCount&&floatWinLoading(lm.saveRetry),ctrl.saveRetryCount++,setTimeout(_submitNUIForm,5E3))}function displayErrorExplanationDetail(){var a=$("errorExplanationDetailDiv");a.style.display="none"==a.style.display?"":"none"}function nuiformOnsubmit(){return!ctrl.submitSemaphore}function createModule(a,b){b?newModulePromptV2(a,b):newModulePromptV2(a)}
function _createModule(){if($("newSheetRadio2")&&$("newSheetRadio2").checked)floatWinClose(),initTemplateLibrary();else if($("chkImportForm")&&$("chkImportForm").checked)floatWinClose(),showFloatingMain("excelImport"),wizardReload(ap,!0);else{var a=$("floatWinPromptInput").value.trim();if(a&&0!=a.length){var b=$("newSheetRightSel");b&&setCookie("newSheetRight",b.options[b.selectedIndex].value);b=Promise.resolve();ctrl.createPath||(b=postPromise("/sims/appUpdate.jsp",{a:ap,nn:a,msi:menuSetIndex}).then(eval));
b.then(function(){setCookie("newSheet",a);window.location="/"+ap+ctrl.createPath})}else $("newUrlShow").textContent=lm.pleaseInputName}}function motd(){ctrl.isIE&&(getStorage("motd")||RagicStorage.localStorage.setItem("motd","1",2592E5))}
function refreshV6Search(a){var b=$("v6QueryItemBar");if(b){var c=b.children,d=!1;0<c.length&&(d="More"===c[c.length-1].textContent);read(function(a){b.innerHTML=a.responseText;biffdata.filterStatus.v6ApplyFilter()},"/sims/queryItemBar.jsp?"+(d?"more&":"")+"a="+ap+"&p="+encodeURIComponent(path)+"&n="+encodeURIComponent(sheet),a)}}
function mmailLoadEmail(a){a=a.split("\n");var b,c="";for(b=0;b<a.length;b++){var d=a[b].split("|");2>d.length||(c+='<a href="javascript:void(0);">'+d[1]+"</a>&nbsp;")}return c}function setCaretTo(a,b){window.ifMobile||(a.createTextRange?(a=a.createTextRange(),a.move("character",b),a.select()):(a.focus(),a.setSelectionRange(b,b)))}
function switchBanner(){var a=$("customBanner");"none"==a.style.display?(a.style.display="",removeBannerOff(ap+path)):(a.style.display="none",setBannerOff(ap+path));eventWindowResize()}function getBannerOff(a){var b=getStorage("bannerOff").split(","),c;for(c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}function removeBannerOff(a){var b=getStorage("bannerOff");if(b){b=b.split(",");var c;for(c=0;c<b.length;c++)b[c]==a&&b.splice(c,1);RagicStorage.localStorage.setItem("bannerOff",b.join(","))}}
function setBannerOff(a){var b=getStorage("bannerOff");b?getBannerOff(a)||RagicStorage.localStorage.setItem("bannerOff",b+","+a):RagicStorage.localStorage.setItem("bannerOff",a)}function ticketRefDisplay(a){a=document.getElementsByName(a);for(var b=0;b<a.length;b++){var c=a[b];""==c.style.display?c.style.display="none":"none"==c.style.display&&(c.style.display="")}}function ticketRefEllipsisMouseover(a){a.style["background-color"]="#d9d9d9";a.firstChild.style.color="black"}
function ticketRefEllipsisMouseout(a){a.style["background-color"]="#e8e8e8";a.firstChild.style.color="#888"}
function dropWin(a,b,c,d,e){a&&b&&(""===b.style.display?d?(b.style.display="none",ctrl.dropWin=!0):clearDropWin():(b.style.display="",b.dataset.originalHeight&&(b.style.height=b.dataset.originalHeight,delete b.dataset.originalHeight),a.clientX&&a.clientY?(b.style.top=a.clientY+"px",b.style.left=a.clientX+b.offsetWidth>document.body.clientWidth?a.clientX-b.offsetWidth+"px":a.clientX+"px"):(d||clearDropWin(),d=a.getBoundingClientRect(),d.top+b.offsetHeight+a.offsetHeight>document.body.clientHeight&&
d.top>b.offsetHeight?b.style.top=d.top-b.offsetHeight-(e?e:0)+"px":(b.style.top=d.top+a.offsetHeight-(e?e:0)+"px",d.top+a.offsetHeight+b.offsetHeight>document.body.clientHeight&&(getComputedStyle&&(b.dataset.originalHeight=getComputedStyle(b).height),b.style.height=document.body.clientHeight-d.top-a.offsetHeight-30+"px")),b.classList.contains("ragic_color_picker_wrapper")&&d.left+b.offsetWidth>document.body.clientWidth&&d.left+d.width>=b.offsetWidth&&(c=!0),b.style.left=c?d.left-b.offsetWidth+a.offsetWidth+
"px":d.left+"px"),floatingPanels.push(b),ctrl.dropWin=!0,b.colorPicker&&ctrl.dropWinColorPickerNotConfirmed.push(b)))}var dropWinTimer,timedDropper,currentDrop,timedOpenDropper,timedOpenAnchor,dropWinOpenTimer;
function mDropWin(a,b,c,d,e,f,g){if(!ctrl.dropMenuLocked&&a&&b){e||(e=100);if(c){if(ctrl.dropmenuoutDisabled){ctrl.dropmenuoutDisabled=!1;return}timedDropper=b;dropWinTimer=setTimeout(function(){timedDropper.style.display="none";timedDropper.style.maxHeight=0},e);clearTimeout(dropWinOpenTimer);ctrl.dropWinOpenFunc=null}else timedDropper&&timedDropper.id==b.id&&clearTimeout(dropWinTimer);c||"none"!=b.style.display||(clearTimeout(dropWinTimer),clearTimeout(dropWinOpenTimer),timedDropper&&(timedDropper.style.display=
"none",timedDropper.style.maxHeight=0),timedOpenDropper=b,timedOpenAnchor=a,ctrl.dropWinOpenFunc=mDropWin_display.bind(null,d,f,g),dropWinOpenTimer=setTimeout(ctrl.dropWinOpenFunc,e))}}function closeDropWin(a){!ctrl.dropMenuLocked&&timedDropper&&a&&a.id!=timedDropper.id&&(clearTimeout(dropWinTimer),ctrl.dropWinOpenFunc=null,timedDropper.style.display="none",timedDropper.style.maxHeight=0)}
function mDropWinClick(a,b,c,d,e){var f=a.getBoundingClientRect();b.style.display="";b.style.zIndex=101;b.style.maxHeight=null;var g=document.body.clientHeight-f.top-a.offsetHeight-30,k=b.scrollHeight,l=g<k;b.style.maxHeight=0;b.style.top=f.top+getBodyScrolltop()+a.offsetHeight+(0===d?0:d?d:5)+"px";b.style.left=c?f.left-b.offsetWidth+a.offsetWidth+(e?parseInt(e):0)+"px":f.left+(e?parseInt(e):0)+"px";l?(b.style.maxHeight=g+"px",b.style.overflowY="auto"):b.style.maxHeight=k+"px";ctrl.dropWinScrollLock=
!0;floatingPanels.push(b)}
function mDropWin_display(a,b,c){if(!ctrl.dropMenuLocked||""!=timedOpenDropper.style.display){var d=timedOpenAnchor.getBoundingClientRect();timedOpenDropper.style.display="";timedOpenDropper.style.maxHeight=null;var e=document.body.clientHeight-d.top-timedOpenAnchor.offsetHeight-30,f=timedOpenDropper.scrollHeight,g=e<timedOpenDropper.clientHeight;timedOpenDropper.style.maxHeight=0;timedOpenDropper.style.top=d.top+getBodyScrolltop()+timedOpenAnchor.offsetHeight+(0===b?0:b?b:5)+"px";timedOpenDropper.style.left=
a?d.left-timedOpenDropper.offsetWidth+timedOpenAnchor.offsetWidth+(c?parseInt(c):0)+window.pageXOffset+"px":d.left+(c?parseInt(c):0)+window.pageXOffset+"px";g?(timedOpenDropper.style.maxHeight=e+"px",timedOpenDropper.style.overflowY="auto"):timedOpenDropper.style.maxHeight=f+"px";floatingPanels.push(timedOpenDropper)}}
function disableSelection(a){a&&("undefined"!=typeof a.onselectstart&&(a.onselectstart=function(a){a||(a=window.event);if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);return"hin"==b.id||b.closest(".nuiFreeCell")?!0:!1}),"undefined"!=typeof a.style.MozUserSelect&&(a.style.MozUserSelect="none"),a.style.cursor="default")}
function enableSelection(a){a&&("undefined"!=typeof a.onselectstart?a.onselectstart=null:"undefined"!=typeof a.style.MozUserSelect?a.style.MozUserSelect=null:a.onmousedown=null,a.style.cursor="")}$("dockBarRight")&&disableSelection($("dockBarRight"));var pickedHeader=0;
function pickExcelHeader(a){for(;(!$("headerRow"+pickedHeader)||"pickedRow"!=$("headerRow"+pickedHeader).className)&&10>pickedHeader;)pickedHeader++;$("headerRow"+pickedHeader)&&($("headerRow"+pickedHeader).className="");$("pickHeader"+pickedHeader)&&($("pickHeader"+pickedHeader).checked=!1);$("headerRow"+a)&&($("headerRow"+a).className="pickedRow");$("pickHeader"+a)&&($("pickHeader"+a).checked=!0);pickedHeader=a}
function assignExcelHeader(a,b){if(a.checked)pickExcelHeader(0),$("headerRowInssert")&&$("headerRowParent").removeChild($("headerRowInssert"));else{$("headerRow0").className="";a=document.createElement("TR");a.id="headerRowInssert";a.className="pickedRow";for(var c="",d=1;d<=b;d++)c=c+"<td>Field"+d+"</td>";a.innerHTML=c;$("headerRowParent").prepend(a)}}
function pickExcelCell(a){-1!=a&&($("pickCell"+a).checked?($("headerCell"+a).className="",$("pickCell"+a).checked=!1):($("headerCell"+a).className="pickedCell",$("pickCell"+a).checked=!0))}var domainPickerFunc=function(a,b){};function updateDomainSelect(a){a&&domainPicker(!1,a.options[a.selectedIndex].value,"")}
function domainPicker(a,b,c){a&&(domainPickerFunc=function(b,c,d,k,l){ctrl.outOfNUI=!1;$("domainPickerWin").style.display="none";a(b,c,d,k,l)});var d=$("domainPickerWin");d.style.display="";d.style.top="15%";d.style.left="30%";b={a:ap,p:b?b:path,fn:c||""==c?c:sheet};builder&&builder.delta&&(b.delta=builder.delta);getPromise("/sims/domainPicker.jsp",b).then(function(a){$("domainPickerContent").innerHTML=a})}function calculate_time_zone(){return-1*(new Date).getTimezoneOffset()/60}
setCookie("tz",calculate_time_zone(),null,window.sslEnabled);function closeUL(a){var b;for(b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];1==a.childNodes[b].nodeType&&"UL"===c.tagName.toUpperCase()&&(c.style.display="none"===c.style.display?"":"none")}}function displaySwitch(a){a=document.querySelector(a).style;a.display=""===a.display?"none":""}
function clearHistoryFilter(){var a=document.querySelector("#reloadHistoryRecords"),b=$("startTime"),c=$("endTime"),d=$("editor"),e=$("containField");b.value="";c.value="";d&&(d.selectedIndex=0);e.selectedIndex=0;"red"===b.style.borderColor&&(b.style.borderColor="#CCC");"red"===c.style.borderColor&&(c.style.borderColor="#CCC");loadHistoryInfo();a.style.display="none"}
function massUpdateRollback(a,b,c,d,e,f){e?(floatWin(null,"<div>"+lm.massRollbackMsg+'</div><span style="margin:12px 5px 12px 8px;" class="topButtonWhole"  onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.ok+'</span><span style="margin:12px 8px 12px 8px;" class="topButtonWhole"  onclick="$(\'floatingWin\').style.display=\'none\'" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.cancel+"</span>","",!0),f&&($("floatingWin").style.top=findPos(f)[1]+30+"px"),$("floatingWin").querySelector(".topButtonWhole").onclick=function(){massUpdateRollback(a,b,c,d,!1)}):ajaxpost("/sims/massRollback.jsp",{ap:a,path:b,si:c,fileName:d},function(){$("floatingWin").style.display="none";location.href="/"+a+b+"/"+c})}
function loadPartnerWin(){var a=$("partnerInfos");rm(a);var b=$("partnerLogo").partnerInfo;if(b){var c="Yes"===b["Paid app?"],d=document.createElement("DIV");d.classList.add("partnerInfoFlexContainer");var e=document.createElement("DIV"),f=document.createElement("DIV"),g=document.createElement("DIV"),k=document.createElement("DIV"),l=document.createElement("DIV");e.classList.add("partnerInfoItem");f.classList.add("partnerInfoItem");g.classList.add("partnerInfoItem");k.classList.add("partnerInfoItem");
l.classList.add("partnerInfoItem");c||(l.style.display="none");c=document.createElement("DIV");var m=document.createElement("DIV"),n=document.createElement("DIV"),q=document.createElement("DIV"),r=document.createElement("DIV"),p=document.createTextNode(lm.partnerName),t=document.createTextNode(lm.partnerSupport),v=document.createTextNode(lm.partnerWebsite),u=document.createTextNode(lm.partnerUserManualHeader),x=document.createTextNode(lm.partnerUserManualURL),E=b["Partner Support E-mail"],D=b["Partner Support URL"],
A=b["Partner User Manual"],w=b["Partner User Manual URL"],F=b["Partner Website"];b=document.createTextNode(b["Partner Company Name"]);var C=document.createTextNode(lm.partnerCenter_enterAuthorizationCodeDesc),z=document.createTextNode(lm.authorizationCode),J=document.createTextNode(E),L=document.createTextNode(F),B=document.createTextNode(D),y=document.createTextNode(lm.partnerUserManual),O=document.createTextNode(lm.partnerUserManualURL),K=document.createElement("DIV"),M=document.createElement("DIV"),
Q=document.createElement("DIV"),P=document.createElement("DIV"),G=document.createElement("A"),R=document.createElement("A"),N=document.createElement("A"),H=document.createElement("A"),I=document.createElement("A"),U=document.createElement("A"),T=document.createElement("DIV"),V=document.createElement("DIV");d.appendChild(e);d.appendChild(f);d.appendChild(g);d.appendChild(k);d.appendChild(l);c.appendChild(p);m.appendChild(t);n.appendChild(v);q.appendChild(u);r.appendChild(x);K.appendChild(b);M.appendChild(I);
M.appendChild(N);Q.appendChild(R);P.appendChild(H);P.appendChild(G);I.appendChild(J);G.href=w;R.href=F;N.href=D;U.href="javascript:void(0)";H.href="https://www.ragic.com/sims/file.jsp?a=kb&force&f="+A;I.href="mailto:"+E;G.appendChild(O);R.appendChild(L);N.appendChild(B);H.appendChild(y);l.appendChild(T);l.appendChild(V);U.appendChild(C);V.appendChild(U);T.appendChild(z);U.onclick=function(){enterAuthorizationCodeFloatWin(biffdata.partnerTemplateId)};e.appendChild(c);e.appendChild(K);f.appendChild(m);
f.appendChild(M);g.appendChild(n);g.appendChild(Q);k.appendChild(q);k.appendChild(P);a.appendChild(d)}else console.log("UP"),getPromise("/api/http/templateInfo.jsp",{id:sec[1]}).then(JSON.parse).then(function(a){})}function loadPaymentWin(){rm($("paymentMain"));var a={a:ap,p:path,fn:sheet,listing:biffdata.ifListingPage(),kf:biffdata.rootDomainId,rn:biffdata.rootNeId};getPromise("/sims/payment/bottomRight.jsp",a).then(function(a){$("paymentMain").innerHTML=a})}
function loadEnterCreditCard(a){rm($("paymentMain"));var b=biffdata.findBiff(biffdata.paymentAmountField);getPromise("/sims/payment/bottomRight.jsp",{a:ap,kf:biffdata.rootDomainId,rn:biffdata.rootNodeId,action:"enterCC",amount:1==b.length?b[0].value:-1,currency:biffdata.paymentCurrency,stripeUserId:biffdata.stripeUserId}).then(function(b){initStripePayment(a);$("paymentMain").innerHTML=b})}
function initStripePayment(a){ctrl.StripePublicKey=a;loadScript("https://js.stripe.com/v3/",_initStripePayment)}
function _initStripePayment(){function a(a){ajaxpost(d.action,{a:ap,kf:$("keyField").value,rn:$("rootNodeId").value,paymentAmount:$("paymentAmount").value,paymentCurrency:$("paymentCurrency").value,stripeUserId:$("stripeUserId").value,stripeToken:a.id},function(a){loadPaymentWin()})}var b=Stripe(ctrl.StripePublicKey),c=b.elements().create("card",{style:{base:{color:"#32325d",lineHeight:"18px",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},
invalid:{color:"#fa755a",iconColor:"#fa755a"}}});c.mount("#card-element");c.addEventListener("change",function(a){document.getElementById("card-errors").textContent=a.error?a.error.message:""});var d=document.getElementById("payment-form");d.addEventListener("submit",function(d){d.preventDefault();b.createToken(c,{name:$("nameOnCard").value}).then(function(b){b.error?document.getElementById("card-errors").textContent=b.error.message:a(b.token)})})}
function loadEmailEditor(a){if(biffdata&&$("emailEditor")){$("emailEditor").innerHTML='<i class="fa fa-spinner fa-spin" style="margin:25px;"></i>';var b={a:ap,p:path,si:sheetIndex,ni:biffdata.rootNodeId,timeStamp:(new Date).getTime()};a&&(b.expand=a);ajaxpost("/sims/mmailer/conversation.jsp",b,function(a){$("emailEditor").innerHTML=a;if(a=RagicStorage.localStorage.getItem("RAGIC_TEXT_"+ap+path+"/"+sheetIndex+"/"+biffdata.rootNodeId+"/email"))$("emailTemplateContent").value=a})}}
function loadCellComment(a,b){a||b||(a=ctrl.savedCellCommentX,b=ctrl.savedCellCommentY);if(a||b){$("cellCommentDiv")&&document.body.removeChild($("cellCommentDiv"));var c=nui._getcell(a,b);if(c&&!c.classList.contains("hide")){var d=c.ip;if(d){var e=d.biff,f=findPos(c),g=nui.main,k=nui.main_outer;if(0>e.nodeId)floatWin(null,"You cannot insert cell comment to a cell that has not been saved.("+e.nodeId+")");else{d=node("div");d.id="cellCommentDiv";d.className="cellCommentDiv";d.style.top=f[1]-g.scrollTop+
"px";d.style.left=f[0]+c.offsetWidth-k.scrollLeft-g.scrollLeft+3+"px";var l=node("form");l.id="cellCommentDivContent";l.method="POST";l.action="/sims/comment.jsp?multipart&a="+ap+"&p="+path+"&fn="+sheet+"&n="+biffdata.rootNodeId;l.enctype="multipart/form-data";l.className="cellCommentDivContent";l.target="nuiiframe";d.appendChild(l);l.innerHTML='<input type="hidden" name="cellLoc" value="'+e.domainId+"_"+e.nodeId+'" />';c=node("div");c.className="commentScrollDiv";l.appendChild(c);if(biffdata.cellLocCommentJSON)for(f=
biffdata.cellLocCommentJSON.length-1;0<=f;f--){var m=biffdata.cellLocCommentJSON[f];g=m.nodeId;if(m.domainId==e.domainId&&g==e.nodeId){g=m.content;k=m.userName;var n=m.date;m=m.ts;var q=node("div");q.className="commentDiv";q.innerHTML='<div class="close2" onclick="deleteCellComment('+biffdata.rootDomainId+","+biffdata.rootNodeId+","+m+');"><i class="fa fa-times"></i></div><div><span class="commentUser">'+k+'</span><span class="commentDate">'+n+"</span></div><div>"+g+"</div>";c.appendChild(q)}}e=node("textarea");
e.name="c";e.onfocus=outNUI;e.onblur=inNUI;l.appendChild(e);f=node("div");f.className="topButtonWhole";f.style.clear="left";f.textContent=lm.save;f.onclick=function(){ctrl.savedCellCommentX=a;ctrl.savedCellCommentY=b;l.submit()};l.appendChild(f);f=node("div");f.className="topButtonWhole";f.textContent=lm.cancel;f.onclick=function(){document.body.removeChild($("cellCommentDiv"))};l.appendChild(f);d.onmouseenter=function(){clearTimeout(ctrl.tempTimer)};d.onmouseleave=function(){ctrl.tempTimer=setTimeout(function(){$("cellCommentDiv")&&
document.body.removeChild($("cellCommentDiv"))},500)};document.body.appendChild(d);c.scrollTop=c.clientHeight;e.focus()}}}}}function deleteComment(a,b,c){confirm(lm.promptDeleteComment)&&postPromise("/sims/comment.jsp",{a:ap,p:path,fn:sheet,f:a,n:b,t:c,"delete":!0}).then(loadComments).then(function(){var a=$("commentCount");rm(a);$("nuiiframe").src="";biffdata&&0<--biffdata.commentSize&&a.appendChild(document.createTextNode("("+biffdata.commentSize+")"))})}
function deleteCellComment(a,b,c){confirm(lm.promptDeleteComment)&&ajaxget("/sims/comment.jsp",{a:ap,p:path,fn:sheet,f:a,n:b,t:c,"delete":!0,cellComment:!0},function(a){document.body.removeChild($("cellCommentDiv"));ctrl.currentController.load("","")})}
function loadAllCellComments(a){ajaxget("/sims/comment.jsp",{a:ap,p:path,fn:sheet,f:biffdata.rootDomainId,n:biffdata.rootNodeId,si:sheetIndex,gclc:"true"},function(a){a=JSON.parse(a);for(var b=0;b<a.length;b++){var d=a[b];if(d=biffdata.findData(d.domainId,d.nodeId))d=nui._getcell(d.x,d.y),d.classList.add("commentCell"),d.onmouseenter=function(){loadCellComment(this.ip.biff.x,this.ip.biff.y)},d.onmouseleave=function(){ctrl.tempTimer=setTimeout(function(){$("cellCommentDiv")&&document.body.removeChild($("cellCommentDiv"))},
500)}}biffdata.cellLocCommentJSON=a},a)}
var loadComments=throttledFn(1E3,function(){if(biffdata&&!ctrl.doingSilentReload)return $("comments").innerHTML='<i class="fa fa-spinner fa-spin" style="margin:25px;"></i>',getPromise("/sims/comment.jsp",{a:ap,p:path,fn:sheet,f:biffdata.rootDomainId,n:biffdata.rootNodeId,timeStamp:(new Date).getTime()}).then(function(a){$("comments").innerHTML=a;processComments();initJSAvatar();ctrl.openNewComment&&(focusComment(),ctrl.openNewComment=!1);var b=RagicStorage.localStorage.getItem("RAGIC_TEXT_"+ap+path+
"/"+sheetIndex+"/"+biffdata.rootNodeId+"/comment");if(b){var c=$("commentTextarea");c&&(ctrl.editingTextArea=c,c.rows=3,"textareaDisabled"==c.className&&(c.className="textareaEnabled"),$("commentSubmitDiv").style.display="",c.value=b)}return a})}),loadHistory=throttledFn(1E3,function(){biffdata&&!ctrl.doingSilentReload&&(rm($("historyMain")),getPromise("/sims/infohistory.jsp",{a:ap,d:biffdata.rootDomainId,n:biffdata.rootNodeId}).then(function(a){$("historyMain").innerHTML=a}))}),loadInfo=throttledFn(1E3,
function(){biffdata&&!ctrl.doingSilentReload&&(rm($("infoMain")),getPromise("/sims/info.jsp",{a:ap,d:biffdata.rootDomainId,n:biffdata.rootNodeId,si:sheetIndex,path:path}).then(function(a){$("infoMain").innerHTML=a}))}),loadHistoryInfo=throttledFn(300,function(a,b,c,d){var e={a:ap,d:biffdata.rootDomainId,n:biffdata.rootNodeId,si:sheetIndex,path:path};a&&(e.startTime=a);b&&(e.finishTime=b);c&&(e.editor=c);d&&(e.fieldID=d);biffdata&&!ctrl.doingSilentReload&&(rm($("historyRecordLists")),getPromise("/sims/infohistory.jsp",
e).then(function(a){$("historyRecordLists").innerHTML=a}))});
function _loadHistoryInfo(){var a=$("startTime"),b=$("endTime"),c=$("editor"),d=$("containField"),e=0<a.value.length?getDateFromFormat(a.value,"yyyy/MM/dd HH:mm:ss"):"",f=0<b.value.length?getDateFromFormat(b.value,"yyyy/MM/dd HH:mm:ss"):"";0<a.value.length&&!e?a.style.borderColor="red":0<b.value.length&&!f?b.style.borderColor="red":(e||(e=""),f||(f=""),"red"===a.style.borderColor&&(a.style.borderColor="#CCC"),"red"===b.style.borderColor&&(b.style.borderColor="#CCC"),$("reloadHistoryRecords").style.display=
"",loadHistoryInfo(e,f,c?c.value:null,d.value))}
function submitHistoryFilter(a){var b=$("historySheetFilter"),c=$("historyDateFilter"),d=$("historyEditorFilter");a.innerText="";a.appendChild(node("i",null,"fas fa-spinner fa-spin"));a.classList.remove("topButtonWholeLight");a.style.pointerEvents="none";(a=0<c.value.length?getDateFromFormat(c.value,"yyyy/MM/dd"):"")||(a="");location.href="/"+ap+"/data?latest"+(""!==b.value?"&ps="+b.value:"")+(0<a.toString().length?"&dt="+a:"")+(""!==d.value?"&editor="+d.value:"")}
function loadActionButtons(){if(biffdata){for(var a='<div style="margin:7px 0 0 0">',b=0;b<biffdata.buttons.length;b++){var c=biffdata.buttons[b];if((!c||!c.id||-1==c.id.indexOf("_"))&&checkButtonShow(c)){var d=_needLockButton(c);d.lock?a+='<div id="actionButton_'+c.id+'" class="topButtonWhole topButtonWholeGrey" title="'+d.msg+'" onclick="promptButtonLockMsg(\''+d.msg+'\')" style="_white-space:nowrap;padding-left:12px;padding-right:12px;">'+encHTML(c.name)+"</div>":"F"==c.type?a+='<div id="actionButton_'+
c.id+'" class="topButtonWhole topButtonWholeLight" style="_white-space:nowrap;padding-left:12px;padding-right:12px;" onclick="callURLActionButton('+c.id+', false);"onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+encHTML(c.name)+"</div>":"B"==c.type?(biffdata.ifListingPage(),a+='<div id="actionButton_'+c.id+'" class="topButtonWhole topButtonWholeLight" style="_white-space:nowrap;padding-left:12px;padding-right:12px;" onclick="execActionScript('+
c.id+', false);"onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+encHTML(c.name)+"</div>"):c.type&&c.type.startsWith("T_")&&(a+='<div id="actionButton_'+c.id+'" data-action="'+c.url+'" data-seq="'+c.id+'" class="topButtonWhole topButtonWholeLight" style="_white-space:nowrap;padding-left:12px;padding-right:12px;"onclick="execToolAction('+c.id+', false)"onmouseover="buttover(this);" onmouseout="buttout(this);"  onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
encHTML(c.name)+"</div>")}}for(b=0;b<biffdata.templates.length;b++)(c=biffdata.templates[b])&&c.displayButton&&(c.userGroups&&0<c.userGroups.length&&!checkUserGroups(c.userGroups)||(a+='<div class="topButtonWhole topButtonWholeLight" style="_white-space:nowrap;padding-left:12px;padding-right:12px;" onclick="viewCusReport('+c.id+');"onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
c.name+"</div>"));b="/ragic-setup"===path&&5===sheetIndex;if("/ragic-setup"===path&&1===sheetIndex||b)a+='<div class="topButtonWhole topButtonWholeLight" style="_white-space:nowrap;padding-left:12px;padding-right:12px;" onclick="editModeEmailTemplateEditors.newUser.open()"onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.customEmail_edit+"</div>",b&&(a+='<div class="topButtonWhole topButtonWholeLight" style="_white-space:nowrap;padding-left:12px;padding-right:12px;" onclick="setInternalUser()"onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.setInternalUser+"</div>");a+="</div>";$("actionButtonMain").innerHTML=a}}function promptButtonLockMsg(a){alert(a)}function _needLockButton(a,b){return _checkButtonApproval(a,b)}function _checkButtonApproval(a,b){var c={lock:!1,msg:""};a=!0===a.needApproval||"true"===a.needApproval;b=biffdata.ifListingPage()&&b&&0<=b?biffdata.wfStatuses[b]:biffdata.wfStatus;b=a&&"F"!==b;a="";b&&(a=lm.action_need_approval);c.lock=b;c.msg=a;return c}
function checkUserGroups(a){if(ArrayContainsIgnoreCase(groupNodeIds,"SYSADMIN")||null==a)return!0;for(var b=0;b<a.length;b++)if(equalIgnoreCase(a[b],"EVERYONE")||ArrayContainsIgnoreCase(groupNodeIds,a[b]))return!0;return!1}function getButtonUpdateRootNodeId(a){if(a){a+="";var b=biffdata.rootNodeId;0>b&&-1!=a.indexOf("_")&&(a=a.split("_"),2<=a.length&&(b=a[1]));return b}}
function execOnFormPage(a,b){biffdata.ifListingPage()?(a="&dm=index&ni="+getButtonUpdateRootNodeId(a),ctrl.currentController.load(a,"",function(){placeEditIcon(null);b()},nuiController.RIGHT)):b()}
function execToolAction(a,b,c){if(b){b=biffdata.buttons.find(function(b){return b.id==a});if(!b)throw Error("Button not found");switch(b.url){case "editEntry":modeUpdate(a);break;case "clone":execOnFormPage(a,function(){cloneEntry()});break;case "downloadExcel":download(".xlsx",!0);break;case "downloadExcelorCSV":downloadExcelOrCSV();break;case "downloadPDF":downloadPDF(!0);break;case "downloadHTML":downloadHTML(!0);break;case "massEmail":editModeEmailTemplateEditors.massEmail.open();break;case "emailThisEntry":access.singleEmail?
editModeEmailTemplateEditors.sendEntry.open(void 0,void 0,c):alert(lm.noAccess);break;case "recalThisEntry":case "lockThisEntry":case "unlockThisEntry":triggerActionButton(a,function(a){a=JSON.parse(a);"ERROR"==a.status?floatWin(null,unicodeToChar(a.msg.replaceAll("\\\\u","\\u"))):ctrl.currentController.load("&reset","",function(){mode==BROWSE&&(browse._init(),browse._focus())})});break;case "deleteThisEntry":deleteEntry(biffdata.rootDomainId,getButtonUpdateRootNodeId(a));break;case "massDelete":deleteMultipleEntry();
break;case "loadAllListenFields":triggerActionButton(a,function(a){a=JSON.parse(a);"ERROR"==a.status?floatWin(null,unicodeToChar(a.msg.replaceAll("\\\\u","\\u"))):ctrl.currentController.load("&reset","",function(){mode==BROWSE&&(browse._init(),browse._focus())})})}}else(b=biffdata.buttons.find(function(b){return b.id===a+""&&b.formRuleLockActionButton}))?floatWinWarning(b.lockMessage,!0):biffdata.buttons.some(function(b){return b.id==a&&b.confirmBeforeAction})?(c={a:ap,p:path,si:sheetIndex,bid:a},
biffdata.ifListingPage()&&(c.listing=!0),getPromise("/sims/actionButtonConfirm.jsp",c).then(function(a){floatWin(null,a,null,!0)})):execToolAction(a,!0,c)}function unicodeToChar(a){return a.replace(/\\u[\dA-F]{4}/gi,function(a){return String.fromCharCode(parseInt(a.replace(/\\u/g,""),16))})}
function execActionScript(a,b,c){var d=0<=c,e={a:ap,p:path,si:sheetIndex,bid:a,nodeId:d?c:biffdata.rootNodeId};biffdata.ifListingPage()&&!d&&(e.listing=!0);if(b){if(c=$("actionButton_"+a))c.onclick=function(){},c.classList.remove("topButtonWholeLight"),c.classList.add("topButtonWholeGrey");getPromise("/sims/actionButton.jsp",e).then(function(a){eval(a)})}else(b=biffdata.buttons.find(function(b){return b.id===a+""&&b.formRuleLockActionButton}))?floatWinWarning(b.lockMessage,!0):biffdata.buttons.some(function(b){return b.id==
a&&b.confirmBeforeAction})?getPromise("/sims/actionButtonConfirm.jsp",e).then(function(a){floatWin(null,a,null,!0)}):execActionScript(a,!0,c)}function replaceFieldValue(a,b){if(!a)return a;if(-1!=a.indexOf("{")&&-1!=a.indexOf("}"))for(var c=a.match(/{(.*?)}/gim),d=0;d<c.length;d++){var e=c[d];"{id}"===e&&(a=a.replace(e,b+""));var f=1==e.indexOf("@"),g=e.substring(f?2:1,e.length-1);(g=biffdata.getFieldValue(g,b))&&(a=a.replace(e,f?encodeURIComponent(g):g))}return a}
function callURLActionButton(a,b,c){if(b){b=biffdata.buttons.find(function(b){return b.id==a});if(!b)throw Error("Button not found");b=b.url;b=unformatNUIAttr(b);b=replaceFieldValue(b,c);-1<b.toString().indexOf("saveClose")?ctrl.newWinCallbackFunction=doubleReloadSheet:ctrl.newWinCallbackFunction=reloadSheet;c=window.open();var d=/^https:\/\/[^\/]+/,e=window.location.toString().match(d);b.match(d)&&-1==b.search(e)?c.location=b:(d=-1<b.toString().indexOf("?"),e=location.search.substring(1),c.location=
b+(d?"&":"?")+"a="+ap+"&"+(e?"&"+e:""))}else(b=biffdata.buttons.find(function(b){return b.id===a+""&&b.formRuleLockActionButton}))?floatWinWarning(b.lockMessage,!0):biffdata.buttons.some(function(b){return b.id==a&&b.confirmBeforeAction})?(b={a:ap,p:path,si:sheetIndex,bid:a},biffdata.ifListingPage()&&(b.listing=!0),getPromise("/sims/actionButtonConfirm.jsp",b).then(function(a){floatWin(null,a,null,!0)})):callURLActionButton(a,!0,c)}
function switchRightDock(a,b,c,d){1==d||3==d&&"none"==a.style.display||5==d&&""==a.style.display?(!c||3===d&&"actionButtonWin"===a.id||c(),a.style.display=""):a.style.display="none"}function ifShowActionButtonWin(){return biffdata.hasButtons()&&("true"!==RagicStorage.localStorage.getItem("hide_actionButtonWin"+path+"/"+sheetIndex)||biffdata.ifListingPage())}
function focusComment(){outNUI();var a=$("commentTextarea");ctrl.editingTextArea=a;a.rows=3;"textareaDisabled"==a.className&&(a.value="",a.className="textareaEnabled");$("commentSubmitDiv").style.display="";a.focus()}function blurComment(){inNUI();ctrl.editingTextArea=null;$("commentTextarea")}
function dragFloatingWinStart(a){if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);if("floatingWinHeader"==b.className)b=b.parentNode;else if(b.parentNode&&"floatingWinHeader"==b.parentNode.className)b=b.parentNode.parentNode;else if("floatingWin"!=b.className)return;ctrl.dragWin=b;ctrl.dragStartX=a.clientX;ctrl.dragStartY=a.clientY;b.style.left=b.offsetLeft+"px";b.style.top=b.offsetTop+"px";ctrl.winStartX=parseInt(b.offsetLeft);ctrl.winStartY=parseInt(b.offsetTop);
disableSelection(document.body)}function dragFloatingWin(a){var b=ctrl.dragWin,c=ctrl.winStartX+(a.clientX-ctrl.dragStartX);a=ctrl.winStartY+(a.clientY-ctrl.dragStartY);0>a&&(a=0);b.style.left=c+"px";b.style.top=a+"px"}function dragFloatWinEnd(){ctrl.dragWin=null;ctrl.dragStartX=null;ctrl.dragStartY=null;enableSelection(document.body)}
function openTab(a,b,c,d,e){a&&b&&!e&&(ctrl.currentTabContainer=a.id,ctrl.currentTabContent=b.id);c&&Array.from(c.querySelectorAll(".activeTab")).forEach(function(a){a.classList.remove("activeTab")});if(d)for(e=0;e<d.childNodes.length;e++){var f=d.childNodes[e];1==f.nodeType&&""==f.style.display&&(f.style.display="none")}a&&(a.className="activeTab");b&&(b.style.display="");c&&1<c.childNodes.length&&c.appendChild(a.parentNode)}
function disableWizardButton(a){a.disabled=!0;a.onclick=null;a.classList.add("import-btn-disabled")}function enableWizardButton(a){a.disabled=!1;a.onclick=wizardNext;a.classList.remove("import-btn-disabled")}
function wizardReload(a,b,c,d,e,f){a={a:a};e=e||this.path;f=f||this.sheet;b&&(a.init="",ctrl.createPath&&(a.path=ctrl.createPath));c&&(a.listing="",a.path=e,a.sheet=f);b=$("floatWinPromptInput");c=$("newSheetRightSel");e=$("newFolderPicker");b&&(a.sn=b.value);c&&(a.sr=c.value);e&&(a.sp=e.value);d&&(a.act=d);$("excelContent").innerHTML='<div style="font-size:28px;width:50px;margin:150px 0 0 25px;"><i class="fa fa-spin fa-spinner"></i></div>';return getPromise("/sims/import/index.jsp",a).then(function(a){$("excelContent").innerHTML=
a;a.includes("<NONEXT/>")?disableWizardButton($("bNextStep")):($("bNextStep").disabled=!1,$("bNextStep").onclick=wizardNext,$("bNextStep").className="import-btn");a.includes("<NOBACK/>")?disableWizardButton($("bBackStep")):($("bBackStep").disabled=!1,$("bBackStep").onclick=wizardBack,$("bBackStep").className="import-btn");a.includes("<FINISH/>")&&(document.querySelector(".import-btn-wrap").style.display="none");window.innerHeight&&($("excelContent").style.width=window.innerWidth-270+"px");return delay(300)}).then(ctrl.currentController.resize.bind(ctrl.currentController))}
function changeSubtable(a){getPromise("/sims/import/index.jsp",{act:"changeSubtable",a:ap,subtableKey:a.options[a.selectedIndex].value}).then(function(){$("reloadExcelImport").click()})}
function wizardNext(){disableWizardButton($("bNextStep"));if($("importAct"))if("4a_mapFields"==$("importAct").value){if(!importRagicMappingCheck())return enableWizardButton($("bNextStep")),!1;$("mappingSelect_0")&&$("mappingSelect_0").removeAttribute("disabled")}else if("5b_inputType"==$("importAct").value&&!importCreateCheck())return enableWizardButton($("bNextStep")),!1;$("excelTableForm")?$("excelTableForm").submit():$("excelUploadForm")&&$("excelUploadForm").submit()}
function wizardBack(){getPromise("/sims/import/index.jsp",{act:"back",a:ap}).then(function(){$("reloadExcelImport").click()})}function wizardReset(a){getPromise("/sims/import/index.jsp",{act:"reset",a:a}).then(function(){$("reloadExcelImport").click()})}function importUploadFileDuplicatedChecked(){return createPromiseRequest({method:"GET",url:$("excelUploadForm").action+"&noCheckDup"}).then(function(){$("floatingWinCloseIcon").click();$("reloadExcelImport").click()})}
function importUploadFileDuplicatedHelpDisplay(){var a=$("Excel1_firstColumnDuplication_help_content");a.style.display="none"==a.style.display?"":"none"}function editImportConfig(a){var b={};a&&(b.configKey=a);postPromise("/sims/import/editImportConfig.jsp",b).then(function(a){floatWin(null,a,null,!0)})}
function saveImportConfig(a){var b={};a&&(b.configKey=a);a=$("importConfigName").value;var c=$("importConfigDesc").value;a?(b.configName=a,c&&(b.configDesc=c),postPromise("/sims/import/saveImportConfig.jsp",b).then(function(a){a=JSON.parse(a);if("SUCCESS"==a.status)floatWin(null,lm.ImportConfig_configSaved,null,!0),wizardReload(ap);else{var b=a.message;"DUPLICATED_CONFIG_NAME"==a.status&&(b=lm.ImportConfig_saveConfigError_duplicatedConfigName);window.alert(b)}})):window.alert(lm.ImportConfig_saveConfigError_noConfigName)}
function setImportConfig(a){var b={act:"setImportConfig"};a&&(b.configKey=a);getPromise("/sims/import/index.jsp",b).then(function(){wizardReload(ap)})}function deleteImportConfig(a,b){a&&(b?postPromise("/sims/import/deleteImportConfig.jsp",{configKey:a}).then(function(a){a=JSON.parse(a);"SUCCESS"==a.status?wizardReload(ap):window.alert(a.message)}):floatWinConfirmV3(lm.ImportConfig_deleteConfirm,"deleteImportConfig('"+a+"', true);"))}
function setImportStepToAccountUpgrade(){getPromise("/sims/import/index.jsp",{act:"setImportStepToAccountUpgrade"}).then(function(){wizardReload(ap)})}
function executeImportRevertFile(a,b,c,d){if(!(a&&b&&c&&d))throw Error("missing param");floatWinConfirmV3(lm.revertImport_confirmMessage,function(){checkRunningServiceByAp(function(){getPromise("/sims/import/executeImportRevertFile.jsp",{a:a,p:b,sn:c,ts:d}).then(function(a){location.reload();updateSystemTaskProgress()})})});cancelEventBubble(event)}
function forceStopImport(a){a?getPromise("/sims/import/forceStopImport.jsp",{a:ap}).then(function(a){a=JSON.parse(a);floatWin(null,a.isSuccess?lm.serviceRunning_stopImport_successMessage:a.message)}):floatWinConfirmV3(lm.serviceRunning_stopImport_confirmMessage,function(){forceStopImport(!0)})}function switchDisplay(a){a.style.display="none"===a.style.display?"":"none";ctrl.currentController.resize()}
function showFloatingMain(a,b,c,d){var e=$("v5SidebarTD");e&&"none"===e.style.display&&(e.style.display="");e=$("dockBarRight");var f=$("dockWinRight");e&&"none"===e.style.display&&(e.style.display="");f&&"none"===f.style.display&&(f.style.display="");$("stickyHeader")&&document.body.removeChild($("stickyHeader"));hideListingPageStuff();$("focus").style.display="none";$("focusDot").style.display="none";$("bbcodeImageEdit").style.display="none";for(var g=$("v5BodyRow").childNodes,k=0;k<g.length;k++){var l=
g[k];"v5SidebarTD"!=l.id&&1==l.nodeType&&(l.style.display="none")}if(a){a=$(a);a.style.display="";for(k=0;k<a.childNodes.length;k++)if(d=a.childNodes[k],1==d.nodeType){d.getAttribute("bg")&&(d.style.background="url("+d.getAttribute("bg")+")");break}e&&(e.style.display="none");f&&(f.style.display="none")}else window.scrollTo(0,0),$("v5Content").style.display="",d&&($("v5SidebarTD").style.display="none"),biffdata&&biffdata.ifListingPage()&&prepareListingPageCheckboxes();b&&c&&(k=$(c),"IFRAME"===k.tagName?
($("mfEmbed").style.height=document.body.clientHeight-$("v5Header").scrollHeight+"px",k.src=b):(rm(k),read(function(a){$(c).innerHTML=a.responseText},b,!0)),e&&(e.style.display="none"),f&&(f.style.display="none"));resetHotspot()}function search(){showFloatingMain("mfSearch","/sims/search.jsp?a="+ap+"&q="+encodeURIComponent($("searchbox").value),"mfSearchContent")}
function copyDesignFromTools(){window.noMoreCreate?quickBillChangePlan():"/ragic-setup"===path?floatWin(null,"Multiple version disabled for system sheets."):floatWin(null,"<div><input id='copyLink' checked='checked' type='checkbox' value='linked' /><label for='copyLink'> &nbsp;"+lm.copySheetLinking+"</label></div><div id='copySheetButton' class='topButtonWhole' style='margin:10px 0 0 8px;padding-left:25px;padding-right:25px;' onclick=\"copyDesignFromToolsExec();\">"+lm.copySheet+"</div>","",!0)}
function copyDesignFromToolsExec(){var a=prompt(lm.newSheetName,builder.newName+" copy"||"");a&&(a={tools:"",a:ap,si:sheetIndex,p:path,newName:a},$("copyLink").checked||(a.cnf=""),postPromise("/sims/copySheet.jsp",a).then(function(a){window.open(a,"_blank");return getPromise("/sims/v5frame/v6Tabs.jsp",{a:ap,p:path,si:sheetIndex?sheetIndex:-1,forceReload:!0})}).then(function(a){a&&($("tabsContainer").parentNode.innerHTML=a,ctrl.currentController.resize())}),floatWinClose())}
function copyDesign(a){if(ifFreePack())quickBillChangePlan();else{var b=a.getAttribute("itemId");if(window.noMoreCreate)quickBillChangePlan();else{var c=a.getAttribute("oldname")?unescapeHTML(decodeURIComponent(a.getAttribute("oldname"))):"";floatWin(function(){var d=a.getAttribute("path");b&&$("copySheetButton").addEventListener("click",function(){var a=$("copyLink").checked,f=prompt(lm.newSheetName,c+" copy"||"");f&&(f={a:ap,si:b,p:d,newName:f},a||(f.cnf=""),postPromise("/sims/copySheet.jsp",f).then(function(a){location.href=
a}).catch(function(){floatWin(null,"Failed to duplicate sheet.");setTimeout(function(){location.reload()},2E3)}))},!1)},"<div style='padding-left:10px;'><input id='copyLink' checked='checked' type='checkbox' value='linked' /><label for='copyLink'> &nbsp;"+lm.copySheetLinking+"</label></div><div id='copySheetButton' class='topButtonWhole' style='margin:10px 0 0 8px;padding-left:25px;padding-right:25px;'>"+lm.copySheet+"</div>","",!0)}}}
function copyTabDesignPrompt(a){if(ifFreePack())quickBillChangePlan();else{var b=a.getAttribute("path"),c=accountProfile[b].nuiFiles,d=Object.keys(c).map(function(a){return{value:a.split("_")[0],text:c[a],selected:!0}});a=document.createElement("DIV");var e=document.createElement("DIV");e.appendChild(document.createTextNode(lm.copyTabDesc));e.style.marginBottom="5px";a.appendChild(e);e=document.createElement("DIV");a.appendChild(e);MultiSelectComboAgent.createMultiSelectCombo("duplicateSelect",d,
e).render();a.appendChild(document.createElement("BR"));d=document.createElement("INPUT");d.type="button";d.id="floatWinPromptSubmit";d.value=lm.submit;d.style.marginTop="20px";d.addEventListener("click",throttledFn(400,function(){var a=MultiSelectComboAgent.getMultiSelectCombo("duplicateSelect").getValues();0!==a.length&&getPromise("/sims/copyTabPreCheck.jsp",{a:ap,p:b,selected:a}).then(JSON.parse).then(function(c){if(c.length){var d=lm.copyTabHint,e=accountProfile[b].nuiFiles;d=c.reduce(function(a,
b){return a+"\n"+e[b+"_Sheet"+b]},d);if(!window.confirm(d))return}copyTabDesign(b,a)}).catch(function(a){403===a.status?quickBillChangePlan():(a=JSON.parse(a.response),floatWin(null,a.msg))})}));a.appendChild(d);floatWin(null,a,"",!0)}}
function copyTabDesign(a,b){0!==b.length&&(ifFreePack()?quickBillChangePlan():promptPromise(lm.newTabName).then(function(a){if(!a)throw Error("No Tab Name");return postPromise("/sims/appUpdate.jsp",{a:ap,nn:a,noPrompt:"",msi:menuSetIndex})}).then(eval).then(function(){return postPromise("/sims/copyTab.jsp",{a:ap,p:a,np:path,selected:b})}).then(JSON.parse).then(function(a){window.location.href=a.url}).catch(function(a){a.response&&(a=JSON.parse(a.response),floatWin(null,a.msg))}))}
function importToExistingSheet(){showFloatingMain("excelImport");wizardReload(ap,!0,!0)}function importNewSheet(){window.noMoreCreate?quickBillChangePlan():(showFloatingMain("excelImport"),wizardReload(ap,!0,!1))}function createMassFilesImport(){showFloatingMain("massFileImport","/sims/importMassFile/massFilesInfo.jsp?a="+ap+"&p="+path+"&si="+sheetIndex,"massFileUploadContent");wizardReload(ap,!0,!0)}
function downloadMassFileMapping(){var a=1E4;if($("dlPart").checked){var b=$("dlSize").value;!isNaN(b)&&""!==b&&b<a&&(a=b)}b=$("templateKey").value;window.open("/sims/importMassFile/genMassFileTemplate.jsp?a="+ap+"&p="+path+"&sheet="+sheet+"&ds="+a+"&key="+b)}
function importMassFiles(){var a=$("mappingFile"),b=$("fileZip");0!==a.files.length&&0!==b.files.length&&(a.files[0].name.endsWith("xlsx")?b.files[0].name.endsWith("zip")?b.files[0].size>Math.pow(1024,3)?floatWin(null,b.files[0].name+" is larger than 1GB"):(a=$("massImportForm"),a.action+="&key="+$("templateKey").value,a.submit(),setTimeout(importMassTrace,1E3)):floatWin(null,b.files[0].name+" is not a Zip(.zip) file"):floatWin(null,a.files[0].name+" is not a xlsx file"))}
function importMassTrace(){"none"!==$("massFileImport").style.display&&read(function(a){a=a.responseText.trim();"F"===a.charAt(0)?a=a.substring(1):setTimeout(importMassTrace,1E3);$("massFileUploadContent").innerHTML=a},"/sims/importMassFile/importStatus.jsp?a="+ap+"&p="+path+"&si="+sheetIndex,!0)}function checkUrlImportSync(a,b,c){a||(a=this.ap);b||(b=this.path);c||(c=this.sheetIndex);getPromise("/sims/import/checkImportUrl.jsp",{apname:a,path:b,sheetIndex:c}).then(eval)}
function importUrlToExistingSheet(a,b,c){a||(a=this.ap);b||(b=this.path);c||(c=this.sheetIndex);var d=this.sheet?this.sheet:c+"_Sheet"+c;read(function(){showFloatingMain("excelImport");wizardReload(a,!0,!0,"0_to_upload_url_page",b,d)},"/"+a+"/data")}
function executeImportUrl(a,b,c){a||(a=this.ap);b||(b=this.path);c||(c=this.sheetIndex);a={apname:a,path:b,sheetIndex:c,manual:"true"};$("executeImportUrl").removeEventListener("click",executeImportUrl);ajaxpost("/sims/import/executeImportUrl.jsp",a,function(a){floatWin(null,a,null,!1,null)});setTimeout(updateSystemTaskProgress,1E3)}
function removeImportUrl(a,b,c,d){a||(a=this.ap);b||(b=this.path);c||(c=this.sheetIndex);read(function(){floatWin(null,lm.displayImportUrl_removeImportUrlSuccess,null,!1,null);d&&location.reload()},"/sims/import/removeImportUrl.jsp?apname="+encodeURIComponent(a)+"&path="+encodeURIComponent(b)+"&sheetIndex="+c)}
function stopImportUrl(a,b,c){a||(a=this.ap);b||(b=this.path);c||(c=this.sheetIndex);read(evalJS,"/sims/import/updateImportUrl.jsp?apname="+encodeURIComponent(a)+"&path="+encodeURIComponent(b)+"&sheetIndex="+c+"&stop=true")}function startImportUrl(a,b,c){a||(a=this.ap);b||(b=this.path);c||(c=this.sheetIndex);read(evalJS,"/sims/import/updateImportUrl.jsp?apname="+encodeURIComponent(a)+"&path="+encodeURIComponent(b)+"&sheetIndex="+c+"&stop=false")}
function findRoles(){for(var a=0,b=$("roles"),c="";a<b.childNodes.length;a++){var d=b.childNodes[a];d&&"checkbox"==d.type&&d.checked&&(c+="|"+d.value)}return c}function tryBanner(a,b){b||(b=a);$("tryBanner").style.backgroundImage="url("+a+")";$("bannerValue").value=b}function tryIcon(a,b){b||(b=a);$("sampleIcon").src=a;$("sampleIconSmall").src=a;$("iconValue").value=b}
function tryText(a,b){b||(b=a);var c=document.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("href",a);document.getElementsByTagName("head")[0].appendChild(c);$("cssValue").value=b}
function hinFocus(){var a=$("hin");if(window.ifMobile){if(a&&!a.hinFocus){var b=nui._curcell();b&&b.ip&&b.ip.biff&&b.ip.biff&&b.ip.biff.attr&&b.ip.biff.attr.hasOwnProperty("fmt_n")?a.inputMode="decimal":a.inputMode=""}}else a&&!a.hinFocus&&(a.hinFocus=!0,a.focus(),a.select())}function hinBlur(){window.ifMobile||($("hin").blur(),$("hin").hinFocus=!1)}function hinBlurEvent(){if(mode==BUILDER){var a=nui._curcell();a&&a.ip&&a.ip.typing&&nui._blur()}}
function deleteMultipleEntry(){var a=biffdata.ds&&2===parseInt(biffdata.ds)?2:1,b=$("quicklyDeleteCheckbox")&&$("quicklyDeleteCheckbox").checked;read(evalJS,"/sims/massActionv62.jsp?isPop=true&act=del&a="+encodeURIComponent(ap)+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+"&d="+biffdata.rootDomainId+"&ds="+a+(b?"&quickMode":""),!0);ctrl.currentController.load("","",null)}
function deleteSelectedEntry(){var a=biffdata.ds&&2===parseInt(biffdata.ds)?2:1;ajaxget("/sims/massActionv62.jsp",{isPop:"true",act:"del",a:ap,p:path,fn:sheet,d:biffdata.rootDomainId,ds:a,nodes:JSON.stringify(getCheckedRootNodeIds())},function(a){clearListingPageCheckbox();eval(a);prepareListingPageCheckboxes();$("bDeleteSelected").style.display="none";$("bSaveAsView").style.display="none";$("bBatchExecSelected").style.display="none";$("bMassEditSelected").style.display="none"})}
function smsMultipleEntry(){var a=biffdata.biffs,b,c=[];for(b=0;b<a.length;b++){var d=a[b],e=d&&d.attr&&d.attr.phone;d.dataType!=HEADER||d.IPType!=TYPER&&d.IPType!=SELECTOR&&d.IPType!=MSELECTOR||c.push(d.domainId+"|"+encodeURIComponent(d.value)+(e?"|1":""))}floatWin(function(){return"/sims/mmailer/index.jsp?type=sms&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+"&d="+c.join(",")},null,lm.massSMS,!0)}
function mailMultipleEntry(){floatWin(null,lm.prop_loading,"",!0);getPromise("/sims/getNumOfEntries.jsp",{a:ap,p:path,fn:sheet}).then(function(a){a=parseInt(a);if(1E4<a)floatWin(null,getBundleString("mailMultipleEntryOverLimit",[a]),"Mass e-mailer",!0);else{var b=biffdata.biffs.filter(function(a){return a&&a.dataType===HEADER&&(a.IPType===TYPER||a.IPType===SELECTOR||a.IPType===MSELECTOR)}).map(function(a){return a.domainId+"|"+a.value+(a.attr&&(a.attr.em||a.attr.email)?"|1":"")});floatWin(function(){return"/sims/mmailer/index.jsp?type=email&a="+
ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+"&d="+b.join(",")},null,"Mass e-mailer",!0)}})}
function mailMultipleEntryRealSend(){$("mmailto")&&0==$("mmailto").selectedIndex?window.alert(lm.mailMultipleEntryReceiversNotSelected):$("mmailerSubject")&&0==$("mmailerSubject").value.length?window.alert(lm.mailMultipleEntrySubjectEmpty):$("mmailerContent")&&0==$("mmailerContent").value.length?window.alert(lm.mailMultipleEntryContentEmpty):($("realsend").value="true",$("mmailerForm").submit())}
function setFormNotification(a){a=a||"";"none"===$("floatingWin").style.display&&floatWin(null,"loading","Notification");read(function(a){$("floatingWinContent").innerHTML=a.responseText;a=$("floatingWinContent").getElementsByTagName("input");a[0].onclick=a[0].checked?function(){setFormNotification("dv")}:function(){setFormNotification("v")};a[1].onclick=a[1].checked?function(){setFormNotification("di")}:function(){setFormNotification("i")};a[2].onclick=a[2].checked?function(){setFormNotification("du")}:
function(){setFormNotification("u")}},"/sims/notifyReg.jsp?in&a="+ap+"&p="+path+"&sh="+sheet+"&act="+a,!0)}function installApp(a,b){read(function(a){eval(a.responseText)},"/sims/appInstall.jsp?appId="+a+"&a="+ap+(b?"&update":""))}function resizeFit(a,b){a&&b&&(a.style.height=b.clientHeight+"px",a.style.width=b.clientWidth+"px")}function currentControllerResize(){ctrl.currentController.resize()}
function editWorkflow(a,b){if(mode===BUILDER)floatWin(null,"Please leave design mode first to avoid conflicts in sheet design changes.");else{var c="/sims/accountWorkflow.jsp?a="+ap,d=a&&b;d&&(c+="&sheet="+encodeURIComponent(a+"/"+b));showFloatingMain("mfWorkflow",c,"mfWorkflowContent");document.body.style.overflowY="hidden";ctrl.currentController.resize();d&&loadWorkflowEditor()}}
function loadWorkflowEditor(){var a=$("loc"),b=$("sec");a=a.options[a.selectedIndex].value;var c=b.options[b.selectedIndex].value;a.endsWith(".nui")?0===b.selectedIndex&&(c=b.selectedIndex=2):(b.selectedIndex=0,c=-1);$("txtiframe").src="/sims/txtedit.jsp?paramLoc="+encodeURIComponent(a)+"&sec="+c}
function dayAgo(a,b,c){var d=dayjs();a=dayjs(a);if(!d.isValid()||!a.isValid())return"";if(b){b=parseInt(getCookie("tz"));if(!b||isNaN(b))b=0;a=a.add(b,"hour")}b=d.startOf("day");a=a.startOf("day");d=b.diff(a,"day");b=b.year()===a.year();var e=0===d,f=1===d,g=-1===d;if(c)return 0>=d?(d*=-1,e&&lm.today||g&&lm.tomorrow||14>d&&lm["in"]+d+lm.dInDays||60>d&&lm["in"]+Math.floor(d/7)+lm.dInWeeks||720>d&&lm["in"]+Math.floor(d/30)+lm.dInMonths||lm["in"]+Math.floor(d/365)+lm.dInYears):f&&lm.yesterday||14>d&&
getBundleString("dDaysAgoWithNum",[d])||60>d&&getBundleString("dWeeksAgoWithNum",[Math.floor(d/7)])||720>d&&getBundleString("dMonthsAgoWithNum",[Math.floor(d/30)])||getBundleString("dYearsAgoWithNum",[Math.floor(d/365)]);c=a.toDate();return 0>=d?e?lm.today:g?lm.tomorrow:b?"en"==lm.lang?formatDate(c,"MMMM d"):formatDate(c,"M\u6708d\u65e5"):"en"==lm.lang?formatDate(c,"MMMM d, yyyy"):formatDate(c,"yyyy\u5e74M\u6708d\u65e5"):f?lm.yesterday:b?"en"==lm.lang?formatDate(c,"MMMM d"):formatDate(c,"M\u6708d\u65e5"):
"en"==lm.lang?formatDate(c,"MMMM d, yyyy"):formatDate(c,"yyyy\u5e74M\u6708d\u65e5")}
function timeAgo(a,b,c){a=new Date(a);var d=((new Date).getTime()-a.getTime())/1E3;if(b){b=parseInt(getCookie("tz"));if(!b||isNaN(b))b=0;a.setHours(a.getHours()+b);d-=3600*b}b=0<=d?Math.floor(d/86400):Math.ceil(d/86400);if(isNaN(b))return"";if(c)return 0>d?(b*=-1,d*=-1,60>d&&lm.justNow||120>d&&lm.dInOneMin||3600>d&&lm["in"]+Math.floor(d/60)+lm.dInMins||7200>d&&lm.dInOneHour||86400>d&&lm["in"]+Math.floor(d/3600)+lm.dInHours||1==b&&lm.tomorrow||14>b&&lm["in"]+b+lm.dInDays||60>b&&lm["in"]+Math.floor(b/
7)+lm.dInWeeks||720>b&&lm["in"]+Math.floor(b/30)+lm.dInMonths||lm["in"]+Math.floor(b/365)+lm.dInYears):0==b&&(60>d&&lm.justNow||120>d&&lm.dOneMinAgo||3600>d&&getBundleString("dMinsAgoWithNum",[Math.floor(d/60)])||7200>d&&lm.dOneHourAgo||86400>d&&getBundleString("dHoursAgoWithNum",[Math.floor(d/3600)]))||1==b&&lm.yesterday||14>b&&getBundleString("dDaysAgoWithNum",[b])||60>b&&getBundleString("dWeeksAgoWithNum",[Math.floor(b/7)])||720>b&&getBundleString("dMonthsAgoWithNum",[Math.floor(b/30)])||getBundleString("dYearsAgoWithNum",
[Math.floor(b/365)]);c=a.getFullYear()==(new Date).getFullYear();var e=formatDate(new Date,"yyyyMMdd"),f=!1,g=!1;formatDate(new Date(a.getFullYear(),a.getMonth(),a.getDate()+1),"yyyyMMdd")===e?f=!0:formatDate(new Date(a.getFullYear(),a.getMonth(),a.getDate()-1),"yyyyMMdd")===e&&(g=!0);if(0>d){b*=-1;d*=-1;if(0==b){if(60>d)return lm.justNow;if(3600>d)return lm["in"]+Math.floor(d/60)+lm.dInMins;if(86400>d)return lm["in"]+Math.floor(d/3600)+lm.dInHours}if(g)return"en"==lm.lang?lm.tomorrow+" at "+formatDate(a,
"hh:mm a"):"AM"==formatDate(a,"a")?lm.tomorrow+"\u4e0a\u5348"+formatDate(a,"hh:mm"):lm.tomorrow+"\u4e0b\u5348"+formatDate(a,"hh:mm")}else{if(0==b){if(60>d)return lm.justNow;if(3600>d)return Math.floor(d/60)+lm.dMinsAgo;if(86400>d)return Math.floor(d/3600)+lm.dHoursAgo}if(f)return"en"==lm.lang?lm.yesterday+" at "+formatDate(a,"hh:mm a"):"AM"==formatDate(a,"a")?lm.yesterday+"\u4e0a\u5348"+formatDate(a,"hh:mm"):lm.yesterday+"\u4e0b\u5348"+formatDate(a,"hh:mm")}return 30>b?"en"==lm.lang?formatDate(a,
"MMMM d")+" at "+formatDate(a,"hh:mm a"):"AM"==formatDate(a,"a")?formatDate(a,"M\u6708d\u65e5")+"\u4e0a\u5348"+formatDate(a,"hh:mm"):formatDate(a,"M\u6708d\u65e5")+"\u4e0b\u5348"+formatDate(a,"hh:mm"):c?"en"==lm.lang?formatDate(a,"MMMM d"):formatDate(a,"M\u6708d\u65e5"):"en"==lm.lang?formatDate(a,"MMMM d, yyyy"):formatDate(a,"yyyy\u5e74M\u6708d\u65e5")}function selectionValue(a){a=$(a);return a.options[a.selectedIndex].value}
function hideHomeMessage(a){setCookie("hmprog",a);setCookie("hmlastAccess",(new Date).getTime());$("homeMessage")&&($("homeMessage").style.display="none")}
function showEmbed(){var a=!$("embedOption1")||$("embedOption1").checked,b=$("embedOption2")&&$("embedOption2").checked,c=!$("embedOption3")||$("embedOption3").checked;a='<iframe src="'+urlAddParam("embed"+(a?"&new":"")+(b?"&sidebar":"")+(c?"":"&hidetop"))+'" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-top-navigation" style="border:none;overflow-x:hidden;overflow-y:hidden;height:600px;width:100%;"></iframe>';"none"==$("floatingWin").style.display?floatWin(null,
'<textarea id="embedCode" style="border:3px solid #888888;margin:3px 8px 8px 3px;padding:3px;" cols=70 onclick="this.select();">'+a+'</textarea><div style="margin:0 8px">'+lm.embedDesc+'</div><div style="margin:12px 18px 12px 18px;"><div style="float:left;margin-right:25px;"><input type=checkbox id="embedOption1" onclick="showEmbed();" checked="checked" style="margin:0 8px 0 0;"><label for="embedOption1">'+lm.embedOption1+'</label><br/><input type=checkbox id="embedOption2" onclick="showEmbed();" style="margin:0 8px 0 0;"><label for="embedOption2">'+
lm.embedOption2+'</label><br/><input type=checkbox id="embedOption3" onclick="showEmbed();" checked="checked" style="margin:0 8px 0 0;"><label for="embedOption3">'+lm.embedOption3+"</label><br/></div><div><span>"+lm.entrySavedCustomMessageHow+'</span><a href="javascript:void(0);" onclick="showSingleTooltip(this,\'HELP_EACM2\',false,true,false,true);" class="tooltipQ" style="float:none;"><i class="fas fa-question"></i></a></div></div>',"",!0,lm.close):$("embedCode").value=a}
function urlHashResolve(a){if(location.hash&&-1!=location.hash.toString().indexOf("!")){var b=location.toString().split("#"),c=b[0].split("?"),d=1<c.length?"?"+c[1]:"";c=c[0].split("/");return"/"+c[3]+"/"+c[4]+b[1].substr(1)+(a?"":d)}b=location.pathname;return 3==b.split("/").length?b+"/"+sheetIndex+(a?"":location.search):location.pathname+(a?"":location.search)}
function createCustFieldsSet(a){if(a){var b=$("listingFieldOptions"),c=$("dlFieldTable"),d=b.options.length,e=[];a=1;for(var f=0;f<d;f++)e.push(b.options[f].value);d=JSON.stringify(e);(b=$("custFieldsSetName").value)?($("custFieldsSetName").value="",postPromise("/sims/saveCustFieldsSet.jsp",{c:1,a:ap,p:path,s:sheet,order:d,name:b}),(e=biffdata.custFieldsSets)&&0<e.length&&(f=e[e.length-1])&&(a=parseInt(f.id)+1),e.push(new CustFieldsSet(a,b,d)),d=c.rows.length,4<=c.rows[d-1].cells.length?(c=c.insertRow(d),
c.insertCell(0),c.innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+a+'"><label for="cfSet_'+a+'">'+b+'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'):c.rows[d-1].innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+a+'"><label for="cfSet_'+a+'">'+b+'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'):
alert(lm.newCustFieldMsg)}else a=$("createCustFieldsDiv"),a.style.display="none"==a.style.display?"":"none"}
function deleteCustFieldsSet(a){if(confirm(lm.deleteCustFieldMsg)){var b=a.target.parentNode.querySelector("input").id.split("cfSet_")[1],c=-1;for(a=0;a<biffdata.custFieldsSets.length;a++)if(biffdata.custFieldsSets[a].id==b){c=a;break}if(0<=c)for(biffdata.custFieldsSets.splice(c,1),postPromise("/sims/saveCustFieldsSet.jsp",{r:1,a:ap,p:path,s:sheet,tid:b}),$("dlFieldTable").innerHTML='<tr><td style="font-weight:bold;">'+lm.downloadField+':</td><td><input type="radio" name="dlField" id="dlField1" /><label for=dlField1>'+
lm.downloadField1+'</label></td><td><input type="radio" name="dlField" id="dlField2" /><label for=dlField2>'+lm.downloadField2+'</label></td><td><input type="radio" name="dlField" id="dlField3" /><label for=dlField3>'+lm.downloadField3+"</label></td></tr></table>",b=$("dlFieldTable"),a=0;a<biffdata.custFieldsSets.length;a++)c=b.rows.length,4<=b.rows[c-1].cells.length?(c=b.insertRow(c),c.insertCell(0),c.innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+
biffdata.custFieldsSets[a].id+'"><label for="cfSet_'+biffdata.custFieldsSets[a].id+'">'+biffdata.custFieldsSets[a].name+'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'):b.rows[c-1].innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+biffdata.custFieldsSets[a].id+'"><label for="cfSet_'+biffdata.custFieldsSets[a].id+'">'+biffdata.custFieldsSets[a].name+
'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'}}function showDeleteIcon(a){("TD"==a.target.tagName?a.target:a.target.parentNode).getElementsByTagName("i")[0].style.visibility="visible"}function hideDeleteIcon(a){("TD"==a.target.tagName?a.target:a.target.parentNode).getElementsByTagName("i")[0].style.visibility="hidden"}
function changeFieldSelector(a){a=a.target.id;if(!(0>a.indexOf("cfSet_"))){a=a.split("cfSet_")[1];var b,c;for(b=0;b<biffdata.custFieldsSets.length;b++)if(biffdata.custFieldsSets[b].id==a){var d=[];try{d=JSON.parse(biffdata.custFieldsSets[b].domainIdArray.replace(/;/g,","))}catch(k){d=JSON.parse(biffdata.custFieldsSets[b].domainIdArray.replace(/&#34;/g,'"').replace(/;/g,","))}var e=$("formFieldOptions");var f=$("listingFieldOptions");for(c=0;c<e.options.length;c++){var g=e.options[c];-1!=d.indexOf(g.value)&&
(e.removeChild(g),f.appendChild(g),c--)}for(c=0;c<f.options.length;c++)g=f.options[c],-1==d.indexOf(g.value)&&(f.removeChild(g),e.appendChild(g),c--);for(c=0;c<d.length;c++)if(f.options[c]&&f.options[c].value!=d[c])for(e=c;e<f.options.length;e++)if(f.options[e].value==d[c]){e=f.options[e];f.removeChild(e);f.insertBefore(e,f.options[c]);break}}}}
function showFieldSelector(a,b){if($("dlField1").checked||$("dlField2").checked)$("listingFieldSelectorTableContent").style.display="none";else{if($("listingFieldSelectorTable"))changeFieldSelector(a);else{var c=$("floatingWinOuterContent"),d=node("DIV");d.style.width=c.offsetWidth+"px";d.style.height=c.offsetHeight+"px";d.style.backgroundColor="#fff";d.style.position="absolute";d.style.top="0";d.style.left="0";d.style.opacity="0.5";d.style.display="flex";d.style.justifyContent="center";d.style.alignItems=
"center";d.innerHTML='<i class="fas fa-spinner fa-spin"></i>';d.classList.add("fa-3x");c.appendChild(d);c.style.position="relative";read(function(b){var e=$("listingFieldSelectorTableContent");$("savedCustFieldsSets");clearDropWin();e.innerHTML+=b.responseText;e.innerHTML+='<div style="padding:6px 0; width: 150px"><a href="javascript:void(0);" onClick="createCustFieldsSet(false);"><i style="padding: 0 8px 0 2px;" class="fa fa-plus-circle fa"></i>'+lm.createCustField+'</a><br></div><div id="createCustFieldsDiv" style="display:none;"><form name="tempForm" id="tempForm" method="POST" enctype="multipart/form-data">'+
lm.custFieldName+'<input style="margin-left:5px;" size="17" type="text" id="custFieldsSetName" name="custFieldsSetName"/><span style="" class="topButtonWholeRight" onclick="createCustFieldsSet(true);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.save+"</span></form></div>";b=$("fieldFilter1");e=$("fieldFilter2");b&&(b.onfocus=null,b.onblur=null);e&&(e.onfocus=null,e.onblur=
null);changeFieldSelector(a);positionFloatWin();c.removeChild(d);c.style.position=null},"/sims/listingFieldSelector.jsp?a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+"&callback=(function(){})&noClose"+(b?"&type="+b:""))}$("listingFieldSelectorTableContent").style.display=""}}
function saveCustQueryItems(a,b,c,d){for(var e=$("listingFieldOptions").options,f="",g=0;g<e.length;g++){var k=e[g].value;f=g<e.length-1?f+(k+"|"):f+k}postPromise("/sims/saveCustQueryItems.jsp",{a:a,p:b,si:c,qi:f}).then(function(){return getPromise("/sims/queryItemBar.jsp",{a:a,p:b,n:d})}).then(function(a){$("v6QueryItemBar").innerHTML=a})}function selectedHidingDomain(a){var b=$("visibleDomainOptions"),c=$("hidingDomainOptions");a?exchangeOptions(b,c):exchangeOptions(c,b)}
function exchangeOptions(a,b){for(var c=0;c<a.options.length;c++)if(a.options[c].selected){var d=a.options[c];a.removeChild(d);b.appendChild(d);c--}}function selectedQueryItems(a){var b=$("formFieldOptions"),c=$("listingFieldOptions");a?exchangeQueryItems(b,c):exchangeQueryItems(c,b)}
function exchangeQueryItems(a,b){for(var c={},d=0;d<a.options.length;d++)a.options[d].selected&&(c[a.options[d].value]=a.options[d],a.removeChild(a.options[d]),d--);for(d in c){a=-2;for(var e=parseInt(c[d].getAttribute("key")),f=JSON.parse(c[d].getAttribute("loc")),g=0;g<b.options.length;g++){var k=parseInt(b.options[g].getAttribute("key"));if(!(k<e)){if(k==e){a=g-1;for(var l=g;l<b.options.length;l++){var m=parseInt(b.options[l].getAttribute("key")),n=JSON.parse(b.options[l].getAttribute("loc"));
if(m>e||0<compareCellLocation(n,f))break;a=l}}if(-2!=a){-1!=a?b.options[a].parentNode.insertBefore(c[d],b.options[a+1]):b.options[0].parentNode.insertBefore(c[d],b.options[0]);delete c[d];break}if(k>e&&(a=g-1,-2!=a)){-1!=a?b.options[a].parentNode.insertBefore(c[d],b.options[a+1]):b.options[0].parentNode.insertBefore(c[d],b.options[0]);delete c[d];break}}}-2==a&&(b.appendChild(c[d]),delete c[d])}}function compareCellLocation(a,b){return a.Y!=b.Y?a.Y-b.Y:a.X-b.X}
function moveQueryItems(a){for(var b=$("listingFieldOptions"),c=[],d=!0,e=!0,f=0;f<b.options.length;f++)b.options[f].selected&&(c.push(f),0==f&&(d=!1),f==b.options.length-1&&(e=!1));if(a){if(e)for(f=0;f<c.length;f++){a=b.options[c[f]+1];d=b.options[c[f]];e=parseInt(d.getAttribute("key"));var g=parseInt(a.getAttribute("key"));e==g&&a.parentNode.insertBefore(a,d)}}else if(d)for(f=0;f<c.length;f++)d=b.options[c[f]-1],a=b.options[c[f]],e=parseInt(d.getAttribute("key")),g=parseInt(a.getAttribute("key")),
e==g&&a.parentNode.insertBefore(a,d)}
function sendEntryByEmail(a,b){var c=$("id_receiver_address").value,d=$("id_cc_address").value,e=$("id_mail_subject").value,f=$("id_mail_content").value;a={a:ap,r:c,cc:d,d:a,id:b,i:sheetIndex,p:path,s:e,c:f,attExcel:$("attachExcel").checked};$("attachMailMerges").checked&&(a.attMM=JSON.stringify(ctrl.attachMailMergesActionBuilder.result.result));c&&(c.trim?c.trim():1)?postPromise("/sims/sendEntryByEmail.jsp",a).then(function(a){floatWin(null,a);ctrl.outOfNUI=!1;return delay(1500)}).then(function(){$("floatingWin").style.display=
"none";window.location.reload()}):alert(lm.recipients+" is empty")}function publishURLs(a,b){var c=location.origin+"/"+ap+path+"/"+sheetIndex;floatWin(null,lm.prop_loading,lm.publishWeb,!0);c={a:ap,p:path,si:sheetIndex,url:c};if(a||0===a)c.r=a;b&&(c.ak=1);postPromise("/sims/publishURLs.jsp",c).then(function(a){$("floatingWinContent").innerHTML=a}).then(function(){return changePublishType(b)})}
function stopPublishing(){$("setRight1").checked?publishURLs(0,null):$("setRight2").checked&&publishURLs(1,null)}
function changePublishType(a){if(a){var b=$("apikey").value;if(!b)return Promise.resolve()}var c=window.origin+urlHashResolve(!0),d=Promise.resolve();-1===biffdata.totalEntry&&(d=getPromise("/sims/getNumOfEntries.jsp",{a:ap,p:path,fn:sheet}).then(updateTotalEntry));return d.then(function(){var d=$("plViewSel");if(d&&d.options)var f=d.options[d.selectedIndex].value;d=c;var g=c+".csv",k=c+"?api",l=c+".xlsx",m="";a&&(m+="APIKey="+b);m&&(g+="?"+m,l+="?"+m,k+="&"+m);f&&(d+="?view="+f,g+=(m?"&":"?")+"view="+
f,l+=(m?"&":"?")+"view="+f,k+="&filterId="+f);$("plWebPage")&&($("plWebPage").value=d);$("plListing")&&$("plListing").checked?($("plCSV").value=g,$("plJSON").value=k+"&listing",biffdata.totalEntry>ctrl.ExcelExportLimit||-1===biffdata.totalEntry?$("plExcel").value=g:$("plExcel").value=l):$("plAll")&&$("plAll").checked&&($("plCSV").value=g+(a||f?"&f=all":"?f=all"),$("plJSON").value=k,biffdata.totalEntry>ctrl.ExcelExportLimit||-1===biffdata.totalEntry?$("plExcel").value=g+(a||f?"&f=all":"?f=all"):$("plExcel").value=
l+(a||f?"&f=all":"?f=all"))})}function urlAddParam(a){var b=urlHashResolve(),c=location.search&&0<location.search.length;return c||a?this.location.protocol+"//"+this.location.host+b+(c?"&":"?")+a:this.location.protocol+"//"+this.location.host+b}
function importRagicMappingCheck(){var a=[];$("importRootDomainId");for(var b,c=$("subtableKeySelectForImport")&&"-1"!=$("subtableKeySelectForImport").options[$("subtableKeySelectForImport").selectedIndex].value,d=!1,e,f=0;$("mappingSelect_"+f);f++){b=$("mappingSelect_"+f);var g=b.options[b.selectedIndex],k=g.value;if(c&&!d){if(!e)for(var l=0;l<b.options.length;l++){var m=b.options[l];m.getAttribute("data-link-to-parent")&&(e=m.innerHTML)}g.getAttribute("data-link-to-parent")&&(d=!0)}if(a.includes(k))return floatWin(null,
"The field <b>"+g.innerText+"</b> was selected more than once."),!1;0!==b.selectedIndex&&a.push(k)}return c&&!d?(floatWin(null,lm.import_Subtable_error_notmap[0]+e+lm.import_Subtable_error_notmap[1]),!1):!0}
function importCreateCheck(){for(var a=document.getElementsByName("headerCell"),b=[/.+number$/,/\u7de8\u865f$/,/\u7f16\u53f7$/,/\u5e8f\u865f$/],c=[],d=0;d<a.length;d++){var e=null;try{e=a[d].getElementsByTagName("div")[0].innerText.trim()}catch(k){}if(null!=e)for(var f=0;f<b.length;f++)if(b[f].test(e.toLowerCase())){var g=a[d].getElementsByTagName("select")[0];if("NUMBER"==g.options[g.selectedIndex].value){c.push(e);break}}}if(0<c.length&&(1==c.length?!window.confirm(getBundleString("Excel5b_confirm_number_field",
[c.toString()])):!window.confirm(getBundleString("Excel5b_confirm_number_fields",[c.toString()]))))return!1;a=document.querySelectorAll("[name=headerCell] input[type=checkbox]");if(2>a.length)return window.alert(lm.atLeastFields),!1;for(d=b=0;d<a.length&&2>b;d++)a[d].checked&&b++;return 2>b?(window.alert(lm.atLeastFields),!1):!0}var RAGIC={},lastWidgetUrl;
function widgetLoader(a){a||(a=lastWidgetUrl);lastWidgetUrl=a;return createPromiseRequest({method:"GET",url:a}).then(JSON.parse).then(function(a){RAGIC.widgetConfig=a;RAGIC.widgetConfig.sysApiUrl="http://"+apiUrl+RAGIC.widgetConfig.sysApiPath;$("v5AddonContentIFrame").src="/sims/widgets/"+RAGIC.widgetConfig.sysSource+"/index.html"})}
function selectWidgetType(a){$("widgetType").value=a;$("currentWidgetFormName").innerHTML=$("widget"+a+"Name").innerHTML;$("currentWidgetFormIcon").style.backgroundImage=$("widget"+a+"Icon").style.backgroundImage}function fadeShow(a){var b=$(a);b&&(b.style.opacity=0,b.style.filter="alpha(opacity = 0)",requestAnimationFrame(function(){_show(a)}))}
function _show(a){var b=$(a);.7>b.style.opacity?(b.style.opacity=parseFloat(b.style.opacity)+.05,b.style.filter="alpha(opacity = "+100*(parseFloat(b.style.opacity)+.05)+")",requestAnimationFrame(function(){_show(a)})):setTimeout(_hide,5E3,a)}function _hide(a){var b=$(a);.1<b.style.opacity?(b.style.opacity=parseFloat(b.style.opacity)-.05,b.style.filter="alpha(opacity = "+100*(parseFloat(b.style.opacity)-.05)+")",requestAnimationFrame(function(){_hide(a)})):b.parentNode.removeChild(b)}
function addCSS(a){if(a){switch(a){case 1:var b="/sims/css/xdense.css";break;case 2:b="/sims/css/dense.css";break;case 3:b="/sims/css/normal.css";break;case 4:b="/sims/css/sparse.css";break;case 5:b="/sims/css/xsparse.css"}setCookie("addCSS",a);$("fontSizeCSS").href=b;nui&&nui._updateFocus()}}function openid_login(a){read(function(a){location.href=a.responseText},"/sims/reg/openidDiscovery.jsp?type="+a)}
function loginSubmit(){$("loginForm")&&($("u").value=$("email").value,$("p").value=$("pwd").value,$("auto").value=$("fauto").checked,$("loginForm").action="/"+document.getElementById("u").value+"?login",$("loginForm").submit())}var confirmedFunction=emptyFunction,confirmedFunctionConfirmed=!1;
function processIntro(){var a=biffdata.intro;if(a&&mode===BROWSE&&biffdata.ifListingPage()){var b=window.groupNodeIds;b&&ArrayContainsIgnoreCase(b,a.group)&&"1"==a.type&&(floatWin(null,lm.prop_loading,"",!0),getPromise("/sims/getNumOfEntries.jsp",{a:ap,p:path,fn:sheet,ignoreFilter:!0,countTo:1}).then(function(b){$("floatingWin").style.display="none";b=parseInt(b);!isNaN(b)&&3>b&&(RagicStorage.localStorage.getItem("lbshrink"+ap+path+"/"+sheet)&&showMinimizedIntro(),lightbox("/intl/"+lm.lang+"/msg/"+
a.source+".jsp?a="+ap+"&p="+path+"&si="+sheetIndex,!1,lightboxShrink))}))}}
function lightboxJS(a){if(!$("overlay")&&!$("lightbox")){var b=node("div","overlay"),c=node("div","overlayHeader");b.onclick=function(a){a.target!==b&&a.target!==c||lightboxClose()};var d=node("div","lightbox"),e=node("div","lightPanel"),f=node("div","lbcontent"),g=node("div","closeButtonlb","overlayHeaderIcon");g.innerHTML='<i class="fa fa-times"></i>';g.onclick=lightboxClose;document.body.appendChild(b);b.appendChild(c);b.appendChild(d);e.appendChild(f);tutorial.enabled||c.appendChild(g);d.appendChild(e);
$("minDiv")&&document.body.removeChild($("minDiv"));$("lbcontent").innerHTML+=a;var k=document.body.style.overflowY;document.body.style.overflowY="hidden";g.addEventListener("click",function(){document.body.style.overflowY=k})}}
function lightbox(a,b,c,d,e){if(!$("overlay")&&!$("lightbox")){var f=node("div","overlay"),g=node("div","overlayHeader");f.onclick=function(a){if(r&&"none"!==r.style.display)r.style.display="none";else if(a.target===f||a.target===g)c?c():lightboxClose()};var k=node("div","lightbox"),l=node("div","lightPanel"),m=node("div","lbcontent"),n=node("div",null,"overlayHeaderIcon");n.innerHTML='<i class="fa fa-times"></i>';var q=d&&"true"===d.attr.fixImageMax,r=$("lightBoxSettings");n.onclick=function(){c?
c():lightboxClose()};document.body.appendChild(f);f.appendChild(g);f.appendChild(k);l.appendChild(m);k.appendChild(l);$("minDiv")&&document.body.removeChild($("minDiv"));if(b){k.onclick=function(a){r&&"none"!==r.style.display?r.style.display="none":"IMG"===a.target.tagName||a.target.closest(".image-carousel")||(c?c():lightboxClose())};Array.isArray(a)||(a=[a]);var p=[];a.forEach(function(a,b){a=h("img",{style:"max-width:100%; max-height:95%;",attrs:{src:a}});p.push(h("div",{style:"flex:1; padding: 0px 5px; height: 100%;"},
a));imageOrientationRotate(a)});m.appendChild(h("div",{class:"lbcontent-img-base",style:(q?"":"display: flex; align-items: baseline;")+"height: 100%;"},p));b=new ImageCarousel(a,{currentIndex:e});m.appendChild(b.render());1<a.length&&RagicStorage.localStorage.getItem("lightbox-img-carousel:"+ap+path+"/"+sheetIndex)?($("lightBoxImgCarousel").checked=!0,m.classList.add("lbcontent-img-carousel-mode")):($("lightBoxImgCarousel").checked=!1,m.classList.add("lbcontent-img-base-mode"));m=node("div",1<a.length?
"downloadMultiImages":"downloadTheImage","overlayHeaderIcon");m.innerHTML='<i class="fa fa-arrow-to-bottom"></i>';var t=node("div",null,"overlayHeaderIcon");t.innerHTML='<i class="fa fa-ellipsis-v"></i>';t.addEventListener("click",cancelEventBubble);t.addEventListener("pointerdown",function(){"none"!==r.style.display?r.style.display="none":dropWin(t,r,!0,!0)});m.addEventListener("mousedown",downloadAllFiles.bind(m,d));m.addEventListener("touchstart",function(a){1===a.touches.length&&downloadAllFiles(d)});
m.addEventListener("mouseenter",showTooltip.bind(null,m));m.addEventListener("mouseleave",hideTinyTooltip);g.appendChild(m);1<a.length&&g.appendChild(t)}else m.innerHTML='<div id="lbiframeDiv" class="lbiframeDiv"><iframe id="lbiframe" src="'+a+'" class="lbiframe" /></div>',setTimeout(function(){$("lbiframeDiv").style.top="50px"},50);g.appendChild(n)}}
function toggleLightBoxImgCarousel(a){ctrl.dropWin=!0;a.checked?(RagicStorage.localStorage.setItem("lightbox-img-carousel:"+ap+path+"/"+sheetIndex,!0),$("lbcontent").classList.add("lbcontent-img-carousel-mode"),$("lbcontent").classList.remove("lbcontent-img-base-mode")):(RagicStorage.localStorage.removeItem("lightbox-img-carousel:"+ap+path+"/"+sheetIndex),$("lbcontent").classList.add("lbcontent-img-base-mode"),$("lbcontent").classList.remove("lbcontent-img-carousel-mode"))}
function lightboxShrink(){$("lightbox")&&(ctrl.dropWin=!0,RagicStorage.localStorage.setItem("lbshrink"+ap+path+"/"+sheet,!0),showMinimizedIntro(),$("minDiv").style.visibility="hidden",$("lbiframeDiv").style.left=$("minDiv").offsetLeft-$("minDiv").offsetWidth,$("lbiframeDiv").style.top=$("minDiv").offsetTop,$("lbiframeDiv").style.height="0px",$("lbiframeDiv").style.width="0px",setTimeout(function(){try{document.body.removeChild($("overlay")),$("minDiv").style.visibility="visible"}catch(a){}},300))}
function showMinimizedIntro(){if(!$("minDiv")){var a=node("div");a.id="minDiv";a.className="minDiv";var b=node("div");b.id="minContent";b.className="minContent";b.innerHTML='<i class="fa fa-question"></i>';a.appendChild(b);a.style.background=$("v6TabHR").style.background;a.onclick=function(){lightbox("/intl/"+lm.lang+"/msg/"+biffdata.intro.source+".jsp?a="+ap+"&p="+path+"&si="+sheetIndex,!1,lightboxShrink)};document.body.appendChild(a)}}
function lightboxClose(){if($("lightbox")){ctrl.dropWin=!0;document.body.removeChild($("overlay"));var a=$("lightBoxSettings");a&&(a.style.display="none");rtppasted=!1}}function lightboxImg(a){a||(a=window.event);if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);b&&b.src&&lightbox(b.src,!0)}
var searchableDocs=Object.freeze(["doc","user","api","kb","course"]),searchDropSelector={qt:"",selectedIndex:-1,keywords:null,options:null,searchbox:$("searchbox"),searchFunc:v6FTSButton,openFunc:searchOpenUrl,searchap:window.ap,searchpath:window.path,searchsheet:window.sheet,lastTimestamp:null,searchFrom:null,loadOptions:function(){this.qt&&this.qt==this.searchbox.value?searchDropSelector.renderOptions():(this.qt=this.searchbox.value)&&0!=this.qt.length?(ctrl.searchDropSelectorTimeout&&clearTimeout(ctrl.searchDropSelectorTimeout),
ctrl.searchDropSelectorTimeout=setTimeout("searchDropSelector.loadOptionsExec()",1)):$("searchDropSelector")&&($("searchDropSelector").style.display="none")},loadOptionsExec:function(){var a=window.embed?"&embed":"",b=("kb"==this.searchap?"https://www.ragic.com":"")+"/sims/searchPrefix.jsp?a="+this.searchap+"&q="+encodeURIComponent(this.qt)+"&p="+(this.searchpath?encodeURIComponent(this.searchpath):"")+"&sheet="+(this.searchsheet?encodeURIComponent(this.searchsheet):"")+(ctrl.mvpStf?"&stf="+ctrl.mvpStf:
"")+"&t="+(new Date).getTime()+a+(mvpMode?"&mvp"+(ctrl.tmpMvpFilter?ctrl.tmpMvpFilter:""):"");a=window.langv5||"en";0<=searchableDocs.indexOf(this.searchFrom)&&(b=$("kbsearch-searchAll").checked,b="/intl/en/doc_search.jsp?q="+encodeURIComponent(this.qt)+"&t="+(new Date).getTime()+"&searchfrom="+this.searchFrom+(b?"&all":"")+"&lang="+a+"&realtime=true");read(function(a){if(a&&""!==a){a=JSON.parse(a.responseText);var b=a.ts;b<this.lastTimestamp||(this.lastTimestamp=b,searchDropSelector.options=a.i||
[],searchDropSelector.keywords=a.k||[],searchDropSelector.total=a.total||0,searchDropSelector.renderOptions())}},b)},openOption:function(){var a=searchDropSelector,b=a.selectedIndex;if(a&&a.keywords){var c=a.keywords.length;0==a.options.length&&0==a.keywords.length||0>b||(b<c?(a.searchbox.value=searchDropSelector.keywords[b].w,a.searchFunc()):a.openFunc(b-c))}},move:function(a){this.selectedIndex+=a;a=Math.max(1,this.options.length+this.keywords.length);0>this.selectedIndex?this.selectedIndex=-1:
this.selectedIndex>=a&&(this.selectedIndex=a-1);this.searchbox.value=this.keywords.length>this.selectedIndex&&this.keywords[this.selectedIndex]&&this.keywords[this.selectedIndex].w?this.keywords[this.selectedIndex].w:this.userInput;this.renderOptions()},renderOptions:function(){if(this.keywords&&this.options&&this.searchbox){var a=$("searchDropSelector"),b=!!window.embed;a?(a.style.display="",rm(a)):(a=node("div"),a.className="searchDropSelector",0<=searchableDocs.indexOf(this.searchFrom)&&a.classList.add("kbSearchDropSelector"),
a.id="searchDropSelector");floatingPanels.push(a);var c=this.searchbox,d=this,e=findPos(c);a.style.minWidth=c.offsetWidth+"px";a.style.maxHeight="300px";a.onmouseover=function(){0<=searchableDocs.indexOf(d.searchFrom)||(document.body.style.overflow="hidden")};a.onmouseout=function(){0<=searchableDocs.indexOf(d.searchFrom)||(b?(document.body.style.overflow="",document.body.style["overflow-y"]="hidden"):document.body.style.overflow="auto")};for(var f=0,g=0;g<this.keywords.length;g++){var k=node("div");
k.className="searchDropdiv";k.setAttribute("index",f);k.onmouseenter=focusOnFTSOption;k.onmouseleave=blurOnFTSOption;k.onclick=searchDropSelector.openOption;var l=node("span");k.appendChild(l);f==this.selectedIndex&&(searchDropSelector.selectedOption=k,k.className="searchDropdivSelected");l.innerHTML=this.keywords[g].d;a.appendChild(k);f++}for(g=0;g<this.options.length;g++){k=node("div");k.className="searchDropdiv";k.setAttribute("index",f);k.onmouseenter=focusOnFTSOption;k.onmouseleave=blurOnFTSOption;
l=node("span");k.appendChild(l);l.className="titleSpan";var m=node("span");k.appendChild(m);m.className="sheetNameSpan";var n=node("span");k.appendChild(n);f==this.selectedIndex&&(searchDropSelector.selectedOption=k,k.className="searchDropdivSelected");l.innerHTML=this.options[g].name||"&nbsp;";n.innerHTML=" - "+(this.options[g].term+"..."||"&nbsp;");m.innerHTML=" - "+this.options[g].fn;0<=searchableDocs.indexOf(this.searchFrom)&&(n.style.display="none",m.style.display="none");k.json=this.options[g];
k.onclick=searchDropSelector.openOption;a.appendChild(k);f++}0==f&&(k=node("div"),k.className="searchDropdiv",k.innerHTML=c.value+" - Search",k.setAttribute("index",f),k.onmouseover=focusOnFTSOption,k.onclick=searchDropSelector.openOption,f==this.selectedIndex&&(searchDropSelector.selectedOption=k,k.className="searchDropdivSelected"),0<=searchableDocs.indexOf(this.searchFrom)&&(k.onclick=kbbutton),a.appendChild(k),f++);document.body.appendChild(a);a.style.top=e[1]+(this.dropup?-1*a.clientHeight:c.offsetHeight)+
"px";a.style.left=e[0]+1+"px";0<=searchableDocs.indexOf(this.searchFrom)&&(a.style.top=parseInt(a.style.top)-2+"px",a.style.left=c.getBoundingClientRect().left+"px")}}};
function mvpSearchFocus(){searchDropSelector.searchbox=$("searchboxMVP");searchDropSelector.searchFunc=mvpSearchButton;searchDropSelector.openFunc=mvpSearchOpenUrl;searchDropSelector.searchpath=path;searchDropSelector.searchsheet=sheet;outNUI();ctrl.enterSubmitButton=$("mvpSearchEnterSubmit");ctrl.enterSubmitBox=$("searchboxMVP")}function mvpSearchBlur(){searchDropSelector.searchpath=path;searchDropSelector.searchsheet=sheet;inNUI();ctrl.enterSubmitButton=null;ctrl.enterSubmitBox=null}
function mvpSearchButton(){ctrl.currentController.load("","&fts="+searchDropSelector.searchbox.value+(ctrl.tmpMvpFilter?ctrl.tmpMvpFilter:""),function(){mode==BROWSE&&(browse._init(),browse._focus());$("bMvpClearFilter").style.display=""});clearDropWin()}
function mvpSearchOpenUrl(a){searchDropSelector.options[a]&&(a=searchDropSelector.options[a].url.split("/")[3],ctrl.currentController.load("","&filterNodeId="+a,function(){mode==BROWSE&&(browse._init(),browse._focus());$("bMvpClearFilter").style.display=""}));clearDropWin()}
function kbfocus(a){searchDropSelector.searchbox=$("kbsearchbox");searchDropSelector.searchFunc=kbbutton;searchDropSelector.openFunc=kbOpenUrl;searchDropSelector.searchap="kb";searchDropSelector.searchpath=null;searchDropSelector.searchsheet=null;a&&(searchDropSelector.searchFrom=a.dataset.searchfrom);outNUI();ctrl.enterSubmitButton=$("kbEnterSubmit");ctrl.enterSubmitBox=$("kbsearchbox")}
function embedSearchButtonClick(){$("ragicEmbedSearchBox").value?embedFTSKeywordSearch():($("embedSearchBody").classList.add("embedSearchBodyShow"),$("ragicEmbedSearchBox").focus())}function embedSearchOpenUrl(a){biffdata.filterStatus.removeFilter(REMOVE_ALL_FILTER);window.location="/"+searchDropSelector.searchap+searchDropSelector.options[a].url+"?embed&hidetop"}
function embedSearchFocus(){outNUI();searchDropSelector.searchbox=$("ragicEmbedSearchBox");searchDropSelector.searchFunc=embedFTSButton;searchDropSelector.openFunc=embedSearchOpenUrl;searchDropSelector.searchsheet=sheet;ctrl.enterSubmitButton=$("ragicEmbedSearchButton");ctrl.enterSubmitBox=$("ragicEmbedSearchBox")}
function embedSearchBlur(){inNUI();ctrl.enterSubmitButton=null;ctrl.enterSubmitBox=null;$("ragicEmbedSearchBox").value.trim()||($("ragicEmbedSearchBox").value="",$("embedSearchBody").classList.remove("embedSearchBodyShow"))}function embedSearchKeyup(a){a||(a=window.event);13!=a.keyCode&&38!=a.keyCode&&40!=a.keyCode&&(searchDropSelector.loadOptions(),searchDropSelector.userInput=searchDropSelector.searchbox.value)}
function searchFocus(){outNUI();searchDropSelector.searchbox=$("searchbox");searchDropSelector.searchFunc=v6FTSButton;searchDropSelector.openFunc=searchOpenUrl;searchDropSelector.searchsheet=sheet;ctrl.enterSubmitButton=$("ragicSearch");ctrl.enterSubmitBox=$("searchbox");searchDropSelector.searchbox.style.border="1px solid #08c"}function searchBlur(){inNUI();ctrl.enterSubmitButton=null;ctrl.enterSubmitBox=null;searchDropSelector.searchbox.style.border="1px solid #cccccc"}
function searchKeyup(a){a||(a=window.event);13!=a.keyCode&&38!=a.keyCode&&40!=a.keyCode&&(searchDropSelector.loadOptions(),searchDropSelector.userInput=searchDropSelector.searchbox.value);mvpMode&&"Enter"===a.key&&mvpSearchButton()}function kbsearch(){0>searchDropSelector.selectedIndex||searchDropSelector.selectedIndex+1>searchDropSelector.options.length?kbbutton():searchDropSelector.openFunc(searchDropSelector.selectedIndex)}
function kbbutton(){var a=searchDropSelector.searchFrom;if(0<=searchableDocs.indexOf(a)){var b=$("kbsearch-searchAll").checked;a="/intl/"+window.langv5+"/"+("kb"===a||"user"===a||"api"===a?"doc-":"")+a+"?q="+encodeURIComponent($("kbsearchbox").value)+(b?"&all":"");window.location.href=a}else window.open("/"+ap+"/start?q="+encodeURIComponent($("kbsearchbox").value),"_blank")}
function kbblur(){searchDropSelector.searchap="kb";searchDropSelector.searchpath=null;searchDropSelector.searchsheet=null;searchDropSelector.dropup=!1;ctrl.outOfNUI=!1;ctrl.enterSubmitButton=null;ctrl.enterSubmitBox=null}function searchOpenUrl(a){biffdata&&biffdata.ifListingPage()&&biffdata.filterStatus.removeFilter(REMOVE_ALL_FILTER);window.location="/"+searchDropSelector.searchap+searchDropSelector.options[a].url}
function kbOpenUrl(a){var b=searchDropSelector.searchbox.formAction.split("/")[4];a=searchDropSelector.options[a].url;var c=a.split("/"),d=c[2];c=c[3];(b=(new Map([["1","/intl/en/doc/"],["8","/intl/en/doc-api/"],["7","/intl/en/doc-kb/"],["26","/intl/es/doc-kb/"],["27","/intl/ja/doc-kb/"],["9","/intl/en/doc-app/"],["10","/intl/"+b+"/doc/"],["11","/intl/"+b+"/doc-kb/"]])).get(d))?window.open(b+c,"_blank"):a&&window.open(a,"_blank")}
function focusOnFTSOption(){searchDropSelector.selectedIndex=parseInt(this.getAttribute("index"));searchDropSelector.selectedOption&&(searchDropSelector.selectedOption.className="searchDropdiv")}function blurOnFTSOption(){searchDropSelector.selectedIndex=-1}function debugConsole(a){var b=$("debugConsole");b||(b=node("div"),b.id="debugConsole",document.body.appendChild(b));"none"==b.style.display&&(b.style.display="");b.innerHTML+=a}
function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(window.location.search);return null==a?"":decodeURIComponent(a[1].replace(/\+/g," "))}
function ifTextInputKeycode(a){var b=a.keyCode,c=a.altKey,d=a.ctrlKey;a=a.metaKey;return c&&b==KEYCODE.ENTER||(d||a)&&b==KEYCODE.CHAR_X?!0:c||d||a?!1:!(b>=KEYCODE.PAGE_UP&&b<=KEYCODE.DOWN)&&!(b>=KEYCODE.SHIFT&&b<=KEYCODE.CAPSLOCK)&&b!=KEYCODE.TAB&&b!=KEYCODE.ENTER&&b!=KEYCODE.PRINT_SCREEN&&b!=KEYCODE.INSERT&&b!=KEYCODE.TURNOFF_SPECIAL&&b!=KEYCODE.SLEEP_SPECIAL&&b!=KEYCODE.WAKEUP_SPECIAL&&!(b>=KEYCODE.F1&&b<=KEYCODE.F12&&b!=KEYCODE.F2)&&b!=KEYCODE.LEFT_WIN&&b!=KEYCODE.SELECT&&b!=KEYCODE.NUM_LOCK&&
b!=KEYCODE.SCROLL_LOCK&&b!=KEYCODE.ESC}function embedFTSKeywordSearch(){var a=$("ragicEmbedSearchBox").value;a&&(path&&sheet?getPromise("/sims/searchv6.jsp",{a:ap,q:a,p:path,fn:sheet}).then(eval):search(),clearDropWin())}
function embedFTSButton(){if(mode!=UPDATE&&mode!=BUILDER||confirm(lm.away)){var a=searchDropSelector.selectedIndex;if(0<=a&&searchDropSelector&&searchDropSelector.keywords){var b=searchDropSelector.keywords.length;0==searchDropSelector.options.length||0>a||(a<b?(searchDropSelector.searchbox.value=searchDropSelector.keywords[a].w,embedFTSKeywordSearch()):searchDropSelector.openFunc(a-b))}}}
function v6FTSButton(){var a=searchDropSelector;if(mode!=UPDATE&&mode!=BUILDER||confirm(lm.away)){var b=a.selectedIndex;if(0<=b){if(a&&a.keywords){var c=a.keywords.length;0==a.options.length&&0==a.keywords.length||0>b?v6FTSKeywordSearch():b<c?(a.searchbox.value=a.keywords[b].w,v6FTSKeywordSearch()):a.openFunc(b-c)}}else v6FTSKeywordSearch()}}
function v6FTSKeywordSearch(){var a=$("searchbox").value;a&&(path&&sheet?getPromise("/sims/searchv6.jsp",{a:ap,q:a,p:path,fn:sheet}).then(eval):search(),clearDropWin())}
function scrollTabMove(a,b,c){var d=Array.from(b.children).filter(function(a){return"DIV"==a.tagName.toUpperCase()&&"none"!==a.style.display}).reduce(function(a,b,c){b=Math.ceil(b.getBoundingClientRect().width);0===c?a.push(b):a.push(b+a[c-1]);return a},[]),e=b.scrollWidth-b.clientWidth;c="R"===c;_scrollTabMove(a,b,d,e,c);a=setInterval(_scrollTabMove,150,a,b,d,e,c);window.addEventListener("mouseup",clearInterval.bind(null,a),{once:!0})}
function _scrollTabMove(a,b,c,d,e){var f=Math.ceil(b.scrollLeft);if(!e||f!==d)if(e||0!==f){d=c.findIndex(function(a){return f<a});if(e){a.previousElementSibling.style.color="";var g=d.length===d+1?0:c[d+1]-c[d];var k=g%10;var l=function(){10<=g?(g-=10,b.scrollLeft+=10,requestAnimationFrame(l)):(g-=k,b.scrollLeft+=k,0===g&&(a.style.color="#ccc"))}}else a.nextElementSibling.style.color="",g=0===d?0:c[d]-c[d-1],k=g%10,l=function(){0!==k?(g-=k,b.scrollLeft-=k,k=0,requestAnimationFrame(l)):0<=g&&(g-=10,
b.scrollLeft-=10,0===g?a.style.color="#ccc":requestAnimationFrame(l))};requestAnimationFrame(l)}}
function Position(a,b){this.X=a?a:0;this.Y=b?b:0;this.add=function(a){a&&(isNaN(a.X)||(this.X+=a.X),isNaN(a.Y)||(this.Y+=a.Y));return this};this.subtract=function(a){a&&(isNaN(a.X)||(this.X-=a.X),isNaN(a.Y)||(this.Y-=a.Y));return this};this.apply=function(a,b){a&&(isNaN(this.X)||b&&("horizontal"!=b.orientation||b.upperLimit&&this.X>b.upperLimit||b.lowerLimit&&this.X<b.lowerLimit)||(a.style.left=this.X+"px"),isNaN(this.Y)||b&&("vertical"!=b.orientation||b.upperLimit&&this.Y>b.upperLimit||b.lowerLimit&&
this.Y<b.lowerLimit)||(a.style.top=this.Y+"px"))}}function absoluteCursorPosition(a){return new Position(a.clientX+window.pageXOffset,a.clientY+window.pageYOffset)}
function DragObject(a,b,c,d){function e(c){c=c||window.event;c.which&&1!=c.which||c.button&&1!=c.button||n||(n=!0,b&&(q=b(c,a)),k=absoluteCursorPosition(c),l=a.getBoundingClientRect(),m=new Position(l.left-a.parentNode.scrollLeft,parseInt(a.style.top)),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1))}function f(b){if(n){if(!a.hasAttribute("status"))a.setAttribute("status","sleep"),setTimeout(function(){a.removeAttribute("status")},40);else if("sleep"===a.getAttribute("status"))return;
absoluteCursorPosition(b).add(m).subtract(k).apply(a,q);c&&c(b,a)}}function g(b){n&&(n=!1,m=k=null,d&&d(b,a),document.removeEventListener("mousemove",f,!1),document.removeEventListener("mouseup",g,!1))}if(a){var k,l,m,n=!1,q;a.addEventListener("mousedown",e,!1);this.dispose=function(){a.removeEventListener("mousedown",e,!1)}}}var sourceList,placeHolder,sourceLinks,undragLinks,dragArray,oldLinks;
function sortTabs(){if(ifFreePack())quickBillChangePlan();else{if(dragArray)return floatWin(null,lm.sortWarning,"",!0);nuiController.resize();sourceList=document.getElementById("topTabs");sourceLinks=Array.from(document.querySelectorAll(".undragTab"));dragArray=sourceLinks.map(function(a){return new DragObject(a,tabDragBegin,tabMoved,tabDragEnd)});placeHolder=document.createElement("DIV");placeHolder.className="v6TopTab";placeHolder.style.backgroundColor="rgb(225,225,225)";var a=$("sideCreateNewApp");
a.textContent=lm.saveSort;a.style.color=a.parentNode.classList.contains("v6TopTabWBanner")?"#FFC080":"#08c";a.style.textDecoration="underline";a.style.fontSize="12px";a.onclick=saveTabOrder}}
function tabDragBegin(a,b){cancelEventBubble(a);a=b.offsetLeft;b.style.top=b.offsetTop+"px";b.style.left=a+"px";b.className=b.className.replace("undragTab","drag");undragLinks=document.querySelectorAll(".undragTab");sourceList.insertBefore(placeHolder,b);placeHolder.innerHTML=b.innerHTML.replace('style="visibility: visible;"',"");placeHolder.style.visibility="hidden";return{orientation:"horizontal",upperLimit:$("sideCreateNewApp").getBoundingClientRect().left-10,lowerLimit:sourceList.getBoundingClientRect().left}}
function tabMoved(a,b){cancelEventBubble(a);var c=b.getBoundingClientRect();a=c.left;c=c.right;for(var d=placeHolder.getBoundingClientRect(),e=a>=d.left,f,g,k=0;k<undragLinks.length;k++)if(f=undragLinks[k].getBoundingClientRect(),g=undragLinks[k].offsetWidth,e){if(!(f.right<=d.left)&&c>f.left+.5*g){sourceList.insertBefore(undragLinks[k],placeHolder);break}}else if(f.right-.5*g>a){sourceList.insertBefore(placeHolder,undragLinks[k]);break}d=sourceList.scrollWidth-sourceList.clientWidth;c>$("sideCreateNewApp").getBoundingClientRect().left?
(scrollTabMove($("moduleScrollRight"),$("topTabs"),"R"),sourceList.scrollLeft==d&&sourceList.appendChild(placeHolder)):a-.5*b.offsetWidth<sourceList.getBoundingClientRect().left&&(scrollTabMove($("moduleScrollLeft"),$("topTabs"),"L"),0===sourceList.scrollLeft&&sourceList.insertBefore(placeHolder,undragLinks[0]))}function tabDragEnd(a,b){cancelEventBubble(a);sourceList.replaceChild(b,placeHolder);b.className=b.className.replace("drag","undragTab");b.style.top=0;b.style.left=0}
function sortSharedViews(){function a(a,b){cancelEventBubble(a);a=b.offsetTop;var c=b.offsetLeft,d=f.getBoundingClientRect();b.style.top=a+"px";b.style.left=c+"px";b.classList.remove("undragView");b.classList.add("drag");e=f.querySelectorAll(".undragView");Array.from(g.children).forEach(function(a){g.removeChild(a)});Array.from(b.children).forEach(function(a){g.appendChild(a.cloneNode(!0))});g.style.visibility="hidden";f.insertBefore(g,b);return{orientation:"vertical",upperLimit:d.bottom-d.top-20,
lowerLimit:1}}function b(a,b){cancelEventBubble(a);b=b.getBoundingClientRect();a=b.top;b=b.bottom;for(var c=g.getBoundingClientRect(),d=f.getBoundingClientRect(),l=a<c.top,m,n=0;n<e.length;n++)if(m=e[n].getBoundingClientRect(),l){if(m.bottom-.5*e[n].offsetHeight>a){f.insertBefore(g,e[n]);break}}else if(!(parseFloat(m.bottom.toFixed(1))<=parseFloat(c.top.toFixed(1)))&&b>m.top+.5*e[n].offsetHeight){f.insertBefore(e[n],g);break}b>d.bottom?f.insertBefore(g,k):a<d.top&&f.insertBefore(g,e[0])}function c(a,
b){cancelEventBubble(a);f.replaceChild(b,g);b.classList.remove("drag");b.classList.add("undragView");b.style.top=0;b.style.left=0}function d(){var a={reorder:"",a:ap,p:path,fn:sheet,v:uiversion},b=Array.from(f.querySelectorAll("li a[seq]"),function(a){return a.getAttribute("seq")});a.order=b.join(",");ajaxpost("/sims/saveDesignerQuery.jsp",a,function(){location.reload()})}var e;var f=$("v6SystemQueries");f.onmouseout=null;f.style.display="";f.style.maxHeight=document.body.offsetHeight-f.getBoundingClientRect().top+
"px";Array.from(f.getElementsByTagName("li"),function(d){var e=new DragObject(d,a,b,c);e.href=d.href;e.element=d;d.href="javascript:void(0);";return e});var g=document.createElement("LI");g.className="v6RecentItem";g.style.backgroundColor="rgb(225,225,225)";if(!k){var k=document.createElement("LI");k.className="v6RecentItem";k.id="sortCompleteSignal";k.href="javascript:void(0);";k.textContent=lm.saveSort;k.style.color="#08c";k.style.textDecoration="underline";k.onclick=d}f.appendChild(k);var l=document.createElement("DIV"),
m=document.createElement("DIV");l.className="reorderBorder";m.className="reorderBorder";f.parentNode.insertBefore(l,f);f.parentNode.appendChild(m);$("sideCreateSearch").style.display="none"}var reorderReportSignal;
function sortReports(a,b){if(ifFreePack())quickBillChangePlan();else{cancelEventBubble(a);if(dragArray)return floatWin(null,lm.sortWarning,"",!0);b.style.display="none";sourceList=$("pathDropReport");sourceList.onmouseout=null;sourceList.style.display="";sourceList.style.maxHeight=document.body.offsetHeight-sourceList.getBoundingClientRect().top+"px";sourceLinks=Array.from(sourceList.getElementsByTagName("a"));sourceLinks.splice(sourceLinks.length-1,1);dragArray=[];for(a=0;a<sourceLinks.length;a++)b=
new DragObject(sourceLinks[a],reportDragBegin,reportMoved,reportDragEnd),b.href=sourceLinks[a].href,b.element=sourceLinks[a],sourceLinks[a].href="javascript:void(0);",dragArray.push(b);reorderReportSignal||(reorderReportSignal=document.createElement("a"),reorderReportSignal.className="pathDropItem",reorderReportSignal.id="reorderReportSignal",reorderReportSignal.href="javascript:void(0);",reorderReportSignal.textContent=lm.saveSort,reorderReportSignal.style.color="#08c",reorderReportSignal.style.textDecoration=
"underline",reorderReportSignal.onclick=saveReportOrder);placeHolder=document.createElement("a");sourceList.appendChild(reorderReportSignal);placeHolder.className="pathDropItem";placeHolder.style.backgroundColor="rgb(225,225,225)";a=$("pathTabReport");a.removeAttribute("onmouseout");a.removeAttribute("onmouseover");b=document.querySelectorAll(".undragTab");document.addEventListener("click",displayPathDrop,!1);for(a=0;a<b.length;a++)b[a].addEventListener("mouseout",displayPathDrop,!1),b[a].addEventListener("mouseover",
displayPathDrop,!1);$("addNewReportLink").style.display="none"}}function saveReportOrder(){floatWinConfirmV3(lm.saveSort+"?",function(){var a={ap:ap},b=$("pathDropReport");b=Array.from(b.querySelectorAll("A")).filter(function(a){return a.hasAttribute("data-id")}).map(function(a){return a.dataset.id});a.order=b.join(",");ajaxpost("/sims/resortReport.jsp",a,function(){location.reload()})},lm.yes,function(){floatWinClose();location.reload()},lm.no)}
function reportDragBegin(a,b){cancelEventBubble(a);a=b.offsetTop;var c=b.offsetLeft,d=sourceList.getBoundingClientRect();b.style.top=a+"px";b.style.left=c+"px";b.className=b.className.replace("undragPathItem","drag");undragLinks=sourceList.querySelectorAll(".undragPathItem");sourceList.insertBefore(placeHolder,b);placeHolder.innerHTML=b.innerHTML.trim().replace('style="visibility: visible;"',"");placeHolder.style.visibility="hidden";return{orientation:"vertical",upperLimit:d.bottom-d.top-60,lowerLimit:1}}
function reportMoved(a,b){a=a||window.event;cancelEventBubble(a);b=b.getBoundingClientRect();a=b.top;b=b.bottom;for(var c=placeHolder.getBoundingClientRect(),d=a<c.top,e,f=0;f<undragLinks.length;f++)if(e=undragLinks[f].getBoundingClientRect(),d){if(e.bottom-.5*undragLinks[f].offsetHeight>a){sourceList.insertBefore(placeHolder,undragLinks[f]);break}}else if(!(parseFloat(e.bottom.toFixed(1))<=parseFloat(c.top.toFixed(1)))&&b>e.top+.5*undragLinks[f].offsetHeight){sourceList.insertBefore(undragLinks[f],
placeHolder);break}b>sourceList.getBoundingClientRect().bottom?sourceList.insertBefore(placeHolder,completeSignal):a<sourceList.getBoundingClientRect().top&&sourceList.insertBefore(placeHolder,undragLinks[0])}function reportDragEnd(a,b){cancelEventBubble(a);sourceList.replaceChild(b,placeHolder);b.className=b.className.replace("drag","undragPathItem");b.style.top=0;b.style.left=0}var completeSignal,moveSheetSignal;
function sortSheets(a,b){if(ifFreePack())quickBillChangePlan();else{cancelEventBubble(a);if(dragArray)return floatWin(null,lm.sortWarning,"",!0);b.style.display="none";sourceList=document.getElementById("pathDrop"+b.getAttribute("path"));sourceList.onmouseout=null;sourceList.style.display="";sourceList.style.maxHeight=document.body.offsetHeight-sourceList.getBoundingClientRect().top+"px";sourceLinks=sourceList.getElementsByTagName("a");dragArray=[];for(a=0;a<sourceLinks.length;a++){var c=new DragObject(sourceLinks[a],
sheetDragBegin,sheetMoved,sheetDragEnd);c.href=sourceLinks[a].href;c.element=sourceLinks[a];sourceLinks[a].href="javascript:void(0);";dragArray.push(c)}completeSignal||(completeSignal=document.createElement("a"),completeSignal.className="pathDropItem",completeSignal.id="completeSignal",completeSignal.href="javascript:void(0);",completeSignal.textContent=lm.saveSort,completeSignal.style.color="#08c",completeSignal.style.textDecoration="underline",completeSignal.onclick=saveSheetOrder.bind(this,b.getAttribute("path")));
moveSheetSignal||(moveSheetSignal=document.createElement("a"),moveSheetSignal.className="pathDropItem",moveSheetSignal.href="javascript:void(0);",moveSheetSignal.textContent=lm.moveSheet,moveSheetSignal.style.color="#08c",moveSheetSignal.style.textDecoration="underline");moveSheetSignal.onclick=function(){moveDesign(b)};placeHolder=document.createElement("a");sourceList.appendChild(completeSignal);sourceList.appendChild(moveSheetSignal);placeHolder.className="pathDropItem";placeHolder.style.backgroundColor=
"rgb(225,225,225)";a=$("pathTab"+b.getAttribute("path"));a.removeAttribute("onmouseout");a.removeAttribute("onmouseover");c=document.querySelectorAll(".undragTab ");document.addEventListener("click",displayPathDrop,!1);for(a=0;a<c.length;a++)c[a].addEventListener("mouseout",displayPathDrop,!1),c[a].addEventListener("mouseover",displayPathDrop,!1)}}
function displayPathDrop(){sourceList.style.display="";sourceList.style.maxHeight=document.body.offsetHeight-sourceList.getBoundingClientRect().top+"px";var a=floatingPanels.indexOf(sourceList);0<=a&&floatingPanels.splice(a,1)}
function sheetDragBegin(a,b){cancelEventBubble(a);a=b.offsetTop;var c=b.offsetLeft;sourceList.getBoundingClientRect();b.style.top=a+"px";b.style.left=c+"px";b.className=b.className.replace("undragPathItem","drag");undragLinks=sourceList.querySelectorAll(".undragPathItem");sourceList.insertBefore(placeHolder,b);placeHolder.innerHTML=b.innerHTML.trim().replace('style="visibility: visible;"',"");placeHolder.style.visibility="hidden";return{orientation:"vertical",upperLimit:sourceList.scrollHeight-60,
lowerLimit:1}}
function sheetMoved(a,b){a=a||window.event;cancelEventBubble(a);b=b.getBoundingClientRect();a=b.top;b=b.bottom;for(var c=placeHolder.getBoundingClientRect(),d=a<c.top,e,f=0;f<undragLinks.length;f++)if(e=undragLinks[f].getBoundingClientRect(),d){if(e.bottom-.5*undragLinks[f].offsetHeight>a){sourceList.insertBefore(placeHolder,undragLinks[f]);break}}else if(!(parseFloat(e.bottom.toFixed(1))<=parseFloat(c.top.toFixed(1)))&&b>e.top+.5*undragLinks[f].offsetHeight){sourceList.insertBefore(undragLinks[f],placeHolder);
break}b>sourceList.getBoundingClientRect().bottom?sourceList.insertBefore(placeHolder,completeSignal):a<sourceList.getBoundingClientRect().top&&sourceList.insertBefore(placeHolder,undragLinks[0])}function sheetDragEnd(a,b){cancelEventBubble(a);sourceList.replaceChild(b,placeHolder);b.className=b.className.replace("drag","undragPathItem");b.style.top=0;b.style.left=0}var myTimeout;function showFpClick(a,b){mode!=BUILDER&&mode!=UPDATE&&(ctrl.showMsgManual=!0,showXHTMLMsg(a,b))}
function showFp(a,b,c){0>c||b&&(myTimeout=setTimeout(showXHTMLMsg,1E3,b,c))}
function showXHTMLMsg(a,b){a=b||0===b?"/"+a+"/"+b+".xhtml?t="+(new Date).getTime()+"&pop=1":"/"+a+".xhtml?t="+(new Date).getTime()+"&pop=1";var c=!0,d=a.split("/");if(5<=d.length){var e="/"+d[2],f=d[3],g=checkFormRights(e,f);g&&0===g.userRight&&!g.multiVersionRight?c=!1:g&&0===g.userRight&&g.redirectSheetJo.path?(d[2]=g.redirectSheetJo.path,d[3]=g.redirectSheetJo.si,a=d.join("/")):g&&1===g.userRight&&(d[4]=d[4].substring(0,d[4].indexOf(".")),c=checkEntryRights(e,f,d[4]).entryManager)}b||0===b?c&&
showMsg(a):showMsg(a)}function showFilePreview(a,b,c){if("false"!==window.userProperties.fileHoverShowFp){var d=[];a.value.split("|").forEach(function(a){var b=getFileDownloadURL(a);d.push(b===a?b:"/sims/embedPreview.jsp?url="+encodeURIComponent(b))});myTimeout=setTimeout(showMsg,1E3,d,!1,!1,!1,b,parseInt(c),a)}}function cancelPreview(){clearTimeout(myTimeout)}
function addNewSignerRow(a){var b=a.closest("tr"),c=a.closest("tbody");b=b.cloneNode(!0);var d=b.querySelector(".barSelect");if(d){var e=b.querySelector("[name=wfSigner]");BarSelectAgent.modifiedSelector("",e,d.parentNode,{}).setAfterSelectOption(function(a){var b=Array.from(e.options).find(function(b){return b.textContent===a.text});b&&(b.selected=a.selected)});d.parentNode.removeChild(d)}c.insertBefore(b,c.querySelector(".submitTr"));a.classList.remove("fa-plus","addedRowIcon");a.classList.add("fa-minus",
"deleteRowIcon")}function deleteNewSignerRow(a){a=a.closest("tr");a.parentNode.removeChild(a)}function addHiddenInputInForm(a,b,c){var d=document.createElement("INPUT");d.setAttribute("type","hidden");d.setAttribute("name",b);d.setAttribute("value",c);a.appendChild(d)}
function initApprovalUpdForm(a,b,c){var d=document.createElement("FORM");d.action="/sims/wf_index.jsp";d.method="POST";d.target="nuiiframe";d.id="approvalupdForm";addHiddenInputInForm(d,"a",ap);addHiddenInputInForm(d,"p",path);addHiddenInputInForm(d,"fn",sheet);addHiddenInputInForm(d,"n",biffdata.rootNodeId);addHiddenInputInForm(d,"act",a);addHiddenInputInForm(d,"wfId",biffdata.wfId);addHiddenInputInForm(d,"stepIndex",b);b=document.createElement("TABLE");var e=document.createElement("THEAD"),f=document.createElement("TBODY");
b.appendChild(e);b.appendChild(f);e=e.insertRow(0);var g=document.createElement("TH");e.appendChild(g);g.colSpan=2;g.style.width="45%";g.appendChild(document.createTextNode(lm.approvalTransactor));g=document.createElement("TH");e.appendChild(g);g.style.width="55%";e=f.insertRow(0);var k=e.insertCell(0);k.colSpan=2;e=e.insertCell(1);"changeSigner"!==a&&(g=document.createElement("I"),g.classList.add("fal","fa-plus","addedRowIcon"),e.appendChild(g),e.style.float="right",e.style.margin="0 20px 0 0");
f.onclick=function(a){a=a.target;a.classList.contains("addedRowIcon")?addNewSignerRow(a):a.classList.contains("deleteRowIcon")&&deleteNewSignerRow(a)};e=f.insertRow(1);e.classList.add("submitTr");e=e.insertCell(0);e.colSpan=3;g=document.createElement("A");g.href="javascript:void(0);";g.appendChild(document.createTextNode(lm.confirm_cancel));var l=document.createElement("A");l.href="javascript:void(0);";l.appendChild(document.createTextNode(lm.confirm_ok));e.appendChild(g);e.appendChild(l);l.onclick=
function(){Array.from(document.querySelectorAll("input[name=wfSigner]")).forEach(function(a){var b=a.value.trim(),c=a.list;c&&((c=Array.from(c.options).find(function(a){return a.dataset.value.split("|")[1].trim()===b||a.textContent.trim()===b}))&&addHiddenInputInForm(d,a.name,c.dataset.value),a.name="")});d.submit();l.onclick=emptyFunction};g.onclick=function(){var a=document.querySelector(".hiddenStep");a&&a.classList.remove("hiddenStep");a=d.closest("tr");a.parentNode.removeChild(a)};e=c.originalSigner;
var m=c.alreadyApprovedSigner,n=[];e&&e.forEach(function(b){var c=b.email,e=b.name,g=f.insertRow(0),k=g.insertCell(0);k.dataset.email=c;k.colSpan=2;k.style.width="45%";"changeSigner"===a&&m&&(-1<m.indexOf(b)?(k.classList.add("fixedSignedTd"),addHiddenInputInForm(d,"wfSigner",c+"|"+e)):k.classList.add("beChangedSignedTd"),n.push(b));b=g.insertCell(1);b.style.width="55%";b.style.float="right";b.style.margin="0 12px 0 0";k.appendChild(document.createTextNode(e))});d.appendChild(b);c={ap:ap,path:path,
si:sheetIndex};"changeSigner"===a?getPromise("/sims/approvalDynamicStep.jsp",c).then(JSON.parse).then(function(a){var b=document.createElement("SELECT");b.id="wfSignerPlus";b.style.display="none";var c=document.createElement("OPTGROUP");c.label=lm.ragicSetupUsers;b.appendChild(c);var d=document.createElement("OPTGROUP");d.label=lm.ragicSetupExternalUsers;b.appendChild(d);a.users.forEach(function(a){var e=document.createElement("OPTION");e.value=a.email+"|"+a.userName;e.appendChild(document.createTextNode(a.userName));
"internal"===a.type?c.appendChild(e):"external"===a.type?d.appendChild(e):b.appendChild(e)});f.appendChild(b);Array.from(f.querySelectorAll(".beChangedSignedTd")).forEach(function(a,c){var d=a.dataset.email+"|"+a.textContent;a.textContent="";a.closest("tr");var e=b.cloneNode(!0);k.appendChild(e);e.name="wfSigner";e.id="wf"+c;e.value=d;a=BarSelectAgent.modifiedSelector("",e,a,{});a.setBeforeSelectOption(function(a){var b=e.value;return 1<=Array.from(document.querySelectorAll("select[name='wfSigner']")).filter(function(b){return b.value===
a.value}).length&&b!==a.value?(alert(lm.selectSameApproversInStepWarning),!1):!0});a.setAfterSelectOption(function(a){var b=Array.from(e.options).find(function(b){return b.textContent===a.text});b&&(b.selected=a.selected)})})}):getPromise("/sims/approvalDynamicStep.jsp",c).then(JSON.parse).then(function(a){var b=document.createElement("SELECT");b.id="wfSignerPlus";b.style.display="none";a=a.users;var c=document.createElement("OPTGROUP");c.label=lm.ragicSetupUsers;b.appendChild(c);var d=document.createElement("OPTGROUP");
d.label=lm.ragicSetupExternalUsers;b.appendChild(d);a.forEach(function(a){var e=document.createElement("OPTION");e.value=a.email+"|"+a.userName;e.appendChild(document.createTextNode(a.userName.replace(" ","\u00a0")));"internal"===a.type?c.appendChild(e):"external"===a.type?d.appendChild(e):b.appendChild(e)});f.appendChild(b);var e=document.getElementById("wfSignerPlus").cloneNode(!0);e.id="";k.appendChild(e);e.name="wfSigner";BarSelectAgent.modifiedSelector("",e,k,{}).setAfterSelectOption(function(a){var b=
Array.from(e.options).find(function(b){return b.textContent===a.text});b&&(b.selected=a.selected)})});return d}
function initModifyUserForm(a,b){var c=document.getElementById("approvalupdForm");c&&(c=c.closest("tr"),c.parentNode.removeChild(c),Array.from($("dockbarApproval").querySelectorAll("tr.hiddenStep")).forEach(function(a){a.classList.remove("hiddenStep")}));var d=$("wfMain").querySelector("table").querySelector("tbody");c=document.createElement("TR");d.insertBefore(c,b.closest("tr").nextSibling);b=b.closest("tr");d=b.querySelector(".signerTd");var e=d.querySelectorAll("span.signerSpan"),f={},g=[],k=
[];0<e.length?Array.from(e).forEach(function(a){var b={email:a.dataset.email,name:a.textContent};k.push(b);(a=a.parentNode.querySelector(".fa-check"))&&a.classList.contains("approvedCheck")&&g.push(b)}):k.push({email:d.dataset.email,name:d.textContent});f.alreadyApprovedSigner=g;f.originalSigner=k;a=initApprovalUpdForm("changeSigner",a,f);b.parentNode.insertBefore(c,b);b.classList.add("hiddenStep");c=c.insertCell(0);c.colSpan=3;c.style.padding="0";c.style["background-color"]="#fff";c.appendChild(a)}
function initAddNewStepForm(a,b,c){var d=document.getElementById("approvalupdForm");d&&(d=d.closest("tr"),d.parentNode.removeChild(d));d=$("wfMain").querySelector("table").querySelector("tbody");var e=document.createElement("TR");"before"===c?d.insertBefore(e,b.closest("tr")):"after"===c&&d.insertBefore(e,b.closest("tr").nextSibling);b=e.insertCell(0);b.colSpan=3;b.style.padding="0";b.style["background-color"]="#fff";a=initApprovalUpdForm("addStep",a,{});b.appendChild(a)}
function initAddedNewSignerForm(a,b){var c=document.getElementById("approvalupdForm");c&&(c=c.closest("tr"),c.parentNode.removeChild(c));b=b.closest("tr");c=document.createElement("TR");var d=b.querySelector(".signerTd"),e=d.querySelectorAll("span.signerSpan"),f={},g=[],k=[];0<e.length?Array.from(e).forEach(function(a){var b={email:a.dataset.email,name:a.textContent};k.push(b);(a=a.parentNode.querySelector(".fa-check"))&&a.classList.contains("approvedCheck")&&g.push(b)}):k.push({email:d.dataset.email,
name:d.textContent});f.alreadyApprovedSigner=g;f.originalSigner=k;a=initApprovalUpdForm("addSigner",a,f);b.parentNode.insertBefore(c,b);b.classList.add("hiddenStep");b=c.insertCell(0);b.colSpan=3;b.style.padding="0";b.style["background-color"]="#fff";b.appendChild(a)}
function initApprovalPlus(a){var b=[],c=a.classList.contains("addStep"),d=a.classList.contains("mUser");c&&(b.push({name:lm.addStepBefore,func:function(){initAddNewStepForm(Number(a.dataset.index),a,"before")}}),b.push({name:lm.addSignerInTheStep,func:function(){initAddedNewSignerForm(Number(a.dataset.index),a)}}),b.push({name:lm.addStepAfter,func:function(){initAddNewStepForm(Number(a.dataset.index)+1,a,"after")}}));d&&b.push({name:lm.changeApprovers,func:function(){initModifyUserForm(Number(a.dataset.index),
a)}});a.classList.remove("addStep","mUser");(new DMenu(b,null)).attach(a,1)}
function showMsg(a,b,c,d,e,f,g){function k(e,f,k,m){m=m||0;var n=!1;if(f){var q=f.value.split("|");n=1===q.length&&f.hasAttribute("officeFilePreviewOnly")&&isOfficeFile(f.value)||1===q.length&&f.hasAttribute("pdfFilePreviewOnly")&&isPDFFile(f.value)}l.innerHTML='<div id="fpTitle" style="display:flex; width: 100%;height: 40px"><div id="fpThumbnail"></div><div id="fpIcon" style="display: flex; justify-content: flex-end">'+(user.endsWith("@ragic.com")&&f&&isPDFFile(f.value)?'<div id="fpRefreshPDF"><i style="font-weight:900" class="far fa-sync"></i></div>':
"")+(f?'<div id="fpDownloadAll"><i style="font-weight:900" class="far fa-arrow-to-bottom "></i></div>':"")+'<div id="fpConfig"><i class="fas fa-cog"></i></div><div id="expandRightPopButton" onclick="expandRightPop();"><i class="fa fa-expand"></i></div><div id="fpClose" onclick="_hideMsg();"><i class="fa fa-times"></i></div></div></div><div id="fpMain" style="margin:0;">'+e+'<h3 id="fpError" style="display: none">'+lm.filePreviewError+'</h3><span id="fpImageName"></span></div>';l.onclick=function(){ctrl.dropWin=
!0};if(e=$("fpRefreshPDF"))e.onclick=function(){var e=document.querySelector(".pdfImgContainer"),l=e.parentNode;l.removeChild(e);e=document.createElement("div");e.classList.add("loadingIconContainer");l.appendChild(e);l=document.createElement("i");l.classList.add("far","fa-spinner","fa-spin");e.appendChild(l);postPromise("/sims/pdfProcess.jsp",{a:ap,refresh:!0,f:f.value}).then(function(){showMsg(a,b,c,d,k,m,g)})};var p=$("fpDownloadAll");n&&(p.style.color="#e2e2e2",$("fpDownloadAll").id="disableDownloadAll");
p&&(p.addEventListener("mousedown",downloadAllFiles.bind(p,f)),p.addEventListener("touchstart",function(a){1===a.touches.length&&downloadAllFiles(f)}),p.addEventListener("mouseenter",function(){showTooltip.call(null,p);n||(this.style.backgroundColor="#f3f3f3",this.style.color="black")}),p.addEventListener("mouseleave",function(){hideTinyTooltip();n||(this.style.backgroundColor="",this.style.color="")}));var r=$("fpThumbnail"),t=$("fpError"),w=$("fpMain"),v=$("fpImageName");if(k&&void 0!==m){var C,
z,J;Array.from(document.querySelectorAll("#fpMain > *:not(#fpError):not(#fpImageName)")).filter(function(a){return!(a.closest(".pdfImgContainer")&&!a.classList.contains("pdfImgContainer"))&&!a.classList.contains("pdfImgTitle")}).forEach(function(a,b){var c=node("div",null,"fpThumbNailChild"),d=node("span"),e=k[b];if(e){var f=e.icon,g=e.originalFileName,l=e.iconName,n="film"===l||"sound"===l||"text"===l||"picture"===l||"acrobat"===l||"word"===l||g.endsWith(".xls")||g.endsWith(".xlsx")||"powerpoint"===
l||"code"===l;d.attr({maxWidth:"120px",overflow:"hidden",whiteSpace:"noWrap",textOverflow:"ellipsis",textAlign:"center"});e="DIV"===a.tagName&&a.dataset.filmsound;if("IFRAME"===a.tagName||e)c.appendChild(f.cloneNode(!0)),d.appendChild(text(g)),c.appendChild(d);else if("IMG"===a.tagName)c.classList.add("fpThumbNailImage"),c.innerHTML="<img style='max-width:100%; height: 30px;' src='"+a.src+"' />",imageOrientationRotate(a),imageOrientationRotate(c.children[0]);else if(a.hasAttribute("pdf")&&a.hasAttribute("pdf")&&
a.dataset.url){ctrl.lockPDFPageNum=!1;var q=a.querySelector("#pageSelector");q.onfocus=function(){ctrl.outOfNUI=!0};q.onblur=function(){ctrl.outOfNUI=!1};q.addEventListener("keyup",function(b){13===b.keyCode&&(b.preventDefault(),moveToPDFLargePicImg(q.value,a))});getPromise(a.dataset.url,{}).then(JSON.parse).then(function(b){node("DIV").classList.add("pdfImgTitle");var d=a.querySelector("#pageLength"),e=document.createTextNode("/"+b.pageCount);d.appendChild(e);0<b.page.length&&appendPDFImg(0,a,b);
var f=setInterval(function(){var b=a.querySelector("img");b&&b&&(c.classList.add("fpThumbNailImage"),c.innerHTML="<img style='max-width:100%; height: 100%' src='"+b.src+"' />",clearInterval(f))},1E3),g=a.querySelector(".pdfPicContainer");g.onscroll=throttledFn(500,function(b){b=a.querySelector("#pageSelector");for(var c=g.offsetTop+g.scrollTop,d=Array.from(g.querySelectorAll(".pdfLargePic")),e=0;e<d.length;e++){var f=parseInt(d[e].getAttribute("top"));if(e<d.length-1){var k=parseInt(d[e+1].getAttribute("top"));
if(c>f&&k>c&&c>(f+k)/2){b.value=e+2;break}else if(c>f&&k>c){b.value=e+1;break}}else b.value=e+1}})})}r.appendChild(c);b===m?(C=b,z=c,z.classList.add("fpFocus"),J=a,J.classList.add("fpFocus-Main"),a.hasAttribute("pdf")?v.style.display="none":v.innerHTML=g,n?a.style.display=e?"flex":"picture"===l?"block":"":(a.style.display="none",t.style.display="")):a.style.display="none";c.addEventListener("click",function(){var a=w.children[b];w.children[C]&&(w.children[C].style.display="none");t.style.display=
"none";z&&z.classList.remove("fpFocus");J&&J.classList.remove("fpFocus-Main");n&&!a.dataset.loadError?(C=b,a.style.display="DIV"===a.tagName&&a.dataset.filmsound?"flex":"picture"===l?"block":"",t.style.display="none"):t.style.display="";this.classList.add("fpFocus");a.classList.add("fpFocus-Main");z=this;J=a;v.innerHTML=g});1===k.length&&(c.style.display="none")}})}else e=w.children[0],q=e.src,e&&q&&imageOrientationRotate(q,e);(new DMenu([{name:lm.turnOffFlyIn,func:function(){ajaxpost("/sims/sharedProperties.jsp",
{fpHoverDisabled:"true",subtableHoverShowFp:"false",fileHoverShowFp:"false"},function(){window.userProperties.fpHoverDisabled="true";window.userProperties.subtableHoverShowFp="false";window.userProperties.fileHoverShowFp="false";floatWin(null,lm.turnOffFlyInPrompt)})}}],null)).attach($("fpConfig"),4);$("expandRightPopButton").style.display=c?"none":""}var l=$("fpDiv");l||(l=node("div"),l.id="fpDiv",l.onmouseover=function(){ctrl.triangle=null},document.body.appendChild(l));l.style.width=b?b+"px":"";
l.innerHTML='<div style="margin:150px;"><i class="fa fa-spinner fa-spin"></i></div>';!g||g.hasAttribute("multipleImages")||g.hasAttribute("multipleFiles")||(a=a.slice(0,1));var m=[],n={};if(Array.isArray(a))if(a.forEach(function(a,b){if(a.startsWith("data:image"))m.push("<img style='width:100%;' src='"+a+"' />");else{var c=a.indexOf("url=");-1<c&&(a=a.substring(c+4));n[""+b]=decodeURIComponent(a)}}),0<Object.keys(n).length){var q=g.attr.pdfFilePreviewOnly;q&&(n.pdfPreviewOnly=q);q=a[0].startsWith("http")?
url:location.protocol+"//"+location.host+"/sims/embedPreview.jsp";getPromise(q,n).then(function(a){m.push(a);k(m.join(""),g,e,f)})}else k(m.join(""),g,e,f);else q=a,q.startsWith("data:image")?k("<img style='width:100%;' src='"+q+"' />",g):(q=q.startsWith("http")?q:location.protocol+"//"+location.host+q,getPromise(q).then(function(a){k(a,g)}));setTimeout(_showMsg,50,d?"true":"false")}function moveToPDFLargePicImg(a,b){b.querySelector(".pdfLargePic[index='"+a+"']").scrollIntoView({block:"end"})}
function appendPDFImg(a,b,c){var d=c.page;if(d.length>a){d=d[a].path;var e=node("IMG");e.src="/sims/file.jsp?a="+ap+"&f="+d;e.setAttribute("index",a+1);var f=e.cloneNode(!0);e.classList.add("pdfSmallPic");b.querySelector(".pdfImgSmallPicContainer").appendChild(e);f.classList.add("pdfLargePic");b.querySelector(".pdfImgLargePicContainer").appendChild(f);e.onload=function(){appendPDFImg(a+1,b,c)};f.onload=function(){f.setAttribute("top",f.offsetTop)};e.onclick=function(){var a=e.getAttribute("index");
moveToPDFLargePicImg(a,b)}}}function expandRightPop(){"95%"==$("fpDiv").style.width?($("fpDiv").style.width="500px",$("expandRightPopButton").innerHTML='<i class="fa fa-expand"></i>'):($("fpDiv").style.width="95%",$("expandRightPopButton").innerHTML='<i class="fa fa-compress"></i>')}function _showMsg(a){var b=$("fpDiv");b&&(clearTimeout(myTimeout),b.style.top=0,b.style.right=0,ctrl.fpShow=!0,a||(ctrl.triangle={dir:2,callback:_hideMsg}))}
function _hideMsg(){var a=$("fpDiv");a&&(a.style.top=0,a.style.right=-1*a.offsetWidth+"px",ctrl.fpShow=!1,ctrl.dropWinLock=!1)}function resetShowFp(){ctrl.showMsgManual||clearTimeout(myTimeout)}function cancelEventBubble(a){a.preventDefault();a.stopPropagation()}function nextElementSibling(a){do a=a.nextSibling;while(a&&1!==a.nodeType);return a}function createNewGroup(){floatWinPrompt("_createNewGroup","","","")}
function _createNewGroup(){postPromise("/sims/reg/newgroup.jsp",{a:ap,gn:$("floatWinPromptInput").value}).then(eval);floatWinClose()}function setAllWebviewAttribute(a){for(var b=document.querySelectorAll("."+a),c="",d=0;d<b.length;d++)b[d].checked&&(""!=c&&(c+="|"),c+=b[d].getAttribute("domainId"));setWebviewAttribute(a,c)}function setWebviewAttribute(a,b){read(null,"/sims/webview/saveConfig.jsp?a="+ap+"&p="+encodeURIComponent(path)+"&si="+sheetIndex+"&wvname="+a+"&v="+encodeURIComponent(b))}
function startImportAjaxUpdate(){getPromise("/sims/import/checkImportCount.jsp").then(function(a){$("entriesImported")&&($("entriesImported").innerHTML="Imported <b>"+a+"</b> entries.",ctrl.timeout=setTimeout(startImportAjaxUpdate,2E3))})}function startRestoreAjaxUpdate(){ajaxget("/sims/backupStatus.jsp",{a:ap},eval);ctrl.timeout=setTimeout(startRestoreAjaxUpdate,1E3)}
function cancelReg(a){var b=RagicStorage.localStorage.getItem("registeredAPName");RagicStorage.localStorage.getItem("registeredAPName")?postPromise("/sims/reg/accRemove.jsp",{a:b}).then(function(){clearLocalRegInfo();alert(a);location.href="/"}):(alert(a),location.href="/")}
function clearLocalRegInfo(){RagicStorage.localStorage.getItem("registeredAPName")&&RagicStorage.localStorage.getItem("registeredPwd")&&RagicStorage.localStorage.getItem("registeredEmail")&&(RagicStorage.localStorage.removeItem("registeredAPName"),RagicStorage.localStorage.removeItem("registeredPwd"),RagicStorage.localStorage.removeItem("registeredEmail"))}
function resetNUIIframe(){var a=$("nuiiframe_submitted");a&&document.body.removeChild(a);(a=$("nuiiframe"))&&document.body.removeChild(a);recreateNUIIframe()}function recreateNUIIframe(){var a=node("iframe");a.id="nuiiframe";a.name="nuiiframe";a.style.display="none";document.body.appendChild(a)}
function ajaxpost(a,b,c,d){for(var e=document.createElement("iframe"),f="tIframe"+genRandom(5);$(f);)f="tIframe"+genRandom(5);for(var g="tForm"+genRandom(5);$(g);)g="tForm"+genRandom(5);e.id=f;e.name=f;e.style.display="none";document.body.appendChild(e);e.onload=function(){var a=this.contentDocument.body.innerHTML||this.contentWindow.document.body.innerHTML;try{document.body.removeChild($(f)),document.body.removeChild($(g))}catch(m){}c&&c(a)};if(d)d.target=f;else{d=document.createElement("form");
document.body.appendChild(d);d.id=g;d.action=a;d.method="POST";d.target=f;for(var k in b)a=document.createElement("input"),a.name=k,a.value=b[k],a.type="hidden",d.appendChild(a)}d.submit()}var ajaxcache={};function ajaxgetAllowCache(a,b,c,d){var e="?"+Object.keys(b).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(b[a])}).join("&"),f=a+e;ajaxcache[f]?c(ajaxcache[f]):ajaxget(a,b,function(a){ajaxcache[f]=a;c(a)},d)}
function ajaxget(a,b,c,d){var e="?"+Object.keys(b).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(b[a])}).join("&"),f=new XMLHttpRequest;f.open("GET",a+e,!d);d||(f.onreadystatechange=function(){if(4==f.readyState){if(200!=f.status)return!1;c&&c(f.responseText);return!0}});f.send(null);if(d){if(200!=f.status)return!1;c&&c(f.responseText)}return!0}
if(window.owner&&profOrAbove()){if($("logo")){var logoChangeIcon=node("div","logoChangeIcon","logoChangeIcon");logoChangeIcon.innerHTML='<i class="fa fa-cog"></i>';$("logo").onmouseenter=function(){$("logo").style.outline="#ccc dashed 1px";$("logo").appendChild(logoChangeIcon);(new DMenu([{name:lm.uploadImage,func:function(){menuSetUpload("uploadLogo")}},{name:lm.remove,func:function(){ajaxget("/sims/menu/menuSetUpdate.jsp",{a:ap,umsi:window.menuSetIndex,removeLogo:"true"},function(){location.reload()})}}])).attach(logoChangeIcon,
3)};$("logo").onmouseleave=function(){$("logo").style.outline=null;$("logo").contains(logoChangeIcon)&&$("logo").removeChild(logoChangeIcon)}}if($("v5HeaderTable")){var bannerChangeIcon=node("div","bannerChangeIcon","bannerChangeIcon");bannerChangeIcon.innerHTML='<i class="fa fa-cog"></i>';$("v5HeaderTable").onmouseenter=function(){$("v5HeaderTopLeft").appendChild(bannerChangeIcon);(new DMenu([{name:lm.uploadImage,func:function(){menuSetUpload("uploadBanner")}},{name:lm.remove,func:function(){ajaxget("/sims/menu/menuSetUpdate.jsp",
{a:ap,umsi:window.menuSetIndex,removeBanner:"true"},function(){location.reload()})}}])).attach(bannerChangeIcon,3)};$("v5HeaderTable").onmouseleave=function(){$("v5HeaderTopLeft").contains(bannerChangeIcon)&&$("v5HeaderTopLeft").removeChild(bannerChangeIcon)}}}function profOrAbove(){return"PROF"===window.edition||"CONPROF"===window.edition||"ENT"===window.edition||"CONENT"===window.edition||"DISTR"===window.edition}
function menuSetUpload(a){if(window.owner){var b=node("FORM"),c=node("INPUT");b.appendChild(c);c.accept="image/*";c.type="file";c.onchange=function(){handleMenuSetUpload(this.files[0],a)};c.click()}}function handleMenuSetUpload(a,b){if(a){var c=new FormData;c.append("upload",a);postFormDataPromise("/sims/menu/menuSetUpdate.jsp?a="+ap+"&umsi="+window.menuSetIndex+"&"+b,c).then(function(){location.reload()}).catch(emptyFunction)}}
function setTabIconForm(a,b){function c(a,b,c,d){a={ap:ap,path:a,type:b,icon:c};d?ajaxpost("/sims/changeTabIcon.jsp",a,d):ajaxpost("/sims/changeTabIcon.jsp",a,function(){location.reload()})}function d(a,b){b.style.display="";var c=findPos(a);b.style.top=c[1]+a.offsetHeight+10+"px";b.style.left=c[0]+"px"}function e(){var a=k.querySelector(".chosenIcon");a&&a.classList.remove("chosenIcon")}function f(a){if(a){var c=new FormData;c.append("iconUpload",a);postFormDataPromise("/sims/changeTabIcon.jsp?ap="+
ap+"&path="+b+"&type=cusImg",c).then(function(){var a=$("tabIcon"+b);return a?a:Promise.reject()}).then(rm).then(function(b){return readBlobAsDataURL(a).then(function(a){var c=node("IMG");c.classList.add("cusImg");c.src=a;b.appendChild(c)})}).catch(emptyFunction)}}function g(){-1===floatingPanels.indexOf(q)&&floatingPanels.push(q);q.addEventListener("click",function(){ctrl.dropWin=!0});m.onclick=function(){var a=node("FORM"),b=node("INPUT");a.appendChild(b);b.accept="image/*";b.type="file";b.onchange=
function(){f(this.files[0])};b.click()};n.onclick=function(){c(b,"noIcon","",function(){var a=$("tabIcon"+b);if(a){rm(a);var c=node("I");c.classList.add("fa","noIcon");a.appendChild(c);e()}})};l.onclick=function(a){if(a=a.target.closest(".iconBlock")){e();a.parentNode.classList.add("chosenIcon");var d=a.querySelector("i").dataset.icon;c(b,"fontAwesome",d,function(){var a=$("tabIcon"+b);if(a){rm(a);var c=node("I");d.split(" ").forEach(function(a){c.classList.add(a)});a.appendChild(c)}})}}}var k=$("tabIconPicker"),
l=$("tabIconFontAwesomeContent"),m=$("tabIconUploadFormLink"),n=$("noIconLink"),q=$("floatingWin");k?(ctrl.dropWin=!0,e(),g(),d(a,q)):ajaxget("/sims/getChangeTabIconForm.jsp",{ap:ap},function(a){floatWin(null,a,"",!0);k=$("tabIconPicker");l=$("tabIconFontAwesomeContent");m=$("tabIconUploadFormLink");n=$("noIconLink");q=$("floatingWin");e();g()});$("dbDropdown").style.display="none"}var TabColorPicker;
function setTabColorForm(a,b){var c=document.querySelector(".undragTab.v6TopTabOn");if(c)var d=c.style.backgroundColor;var e=document.querySelector("#tabColorPicker");TabColorPicker||(TabColorPicker=new ColorPicker(e.querySelector(".slide"),e.querySelector(".picker"),e.querySelector(".color_input"),e.querySelector(".ragic_color_palette"),e.querySelector(".slide-indicator"),e.querySelector(".picker-indicator")));floatWinClose();TabColorPicker.setCallback(function(a){c&&b===path&&(c.style.backgroundColor=
a,$("v6TabHR").style.backgroundColor=a)});(function(a,b){var c=window.pageYOffset;b.style.display="";var d=findPos(a);b.style.top=d[1]+a.offsetHeight-(c?c:0)+"px";b.style.left=d[0]+"px"})(a,e);$("tabColorPickerSaveButton").onclick=function(){ajaxpost("/sims/changeColor.jsp",{ap:ap,path:b,color:TabColorPicker.inputElement.value},emptyFunction);refreshTabColorList();e.style.display="none"};e.querySelector(".fa-times").addEventListener("click",function(){e.style.display="none";d&&(c.style.backgroundColor=
d,$("v6TabHR").style.backgroundColor=d)})}function selectOption(a,b){for(var c=0;c<a.options.length;c++){var d=a.options[c];d.selected=d.value==b?!0:!1}}
function animateInstall(){var a=JSON.parse(RagicStorage.localStorage.getItem("INSTALL_ANIMATE"));RagicStorage.localStorage.removeItem("INSTALL_ANIMATE");if(a){ctrl.animatingInstall=!0;for(var b=0,c=a.length;b<c;b++){var d=a[b].split("/"),e="/"+d[1];d=d[2];var f=$("sheet"+e+"/"+d),g=smallProgress();f.style.opacity=0;f.style.color="#cccccc";$("progress"+e+"/"+d).appendChild(g)}var k=!0,l=function(){if(0<a.length){if(k){k=!1;var b=a.shift().split("/"),c="/"+b[1];b=b[2];mDropWin($("pathTab"+c),$("pathDrop"+
c),null,!1,!1,3);tutorial.enabled&&(ctrl.dropMenuLocked=!0);c=$("sheet"+c+"/"+b);c.style.opacity=1;c.style.background="#efefef";k=!0}window.setTimeout(l,200)}};l()}}var spbar;function simpleProgress(){var a=node("div");a.className="pbar";var b=node("div");b.className="pbarinner pbartransition";a.appendChild(b);spbar=b;return a}function runspbar(a){spbar.style.width=(spbar.parentNode.offsetWidth-4)*a+"px"}
function repeatspbar(a){spbar.className="pbarinner";5<a&&(a=5);spbar.style.webkitAnimation="pbaranimation "+1/a+"s linear 0 "+a+" normal none running"}function advancespbar(a){spbar.style.webkitAnimation=null;spbar.className="pbarinner pbartransition";a=(ctrl.lastPercent?ctrl.lastPercent:0)+a;1<a&&(a=0);spbar.style.width=(spbar.parentNode.offsetWidth-4)*a+"px"}var pbars=[],pbarsDone=[],pbarTimer;
function smallProgress(a,b){var c=node("div");c.className="pbar";var d=node("div");d.className="pbarinner pbartransition";c.appendChild(d);pbars.push(d);pbarTimer||b||(pbarTimer=setTimeout(runpbar,a?a:300));return c}function runpbar(a){0<pbars.length?a&&1>a?pbars[0].style.width=(pbars[0].parentNode.offsetWidth-4)*a+"px":(pbars[0].style.width=pbars[0].parentNode.offsetWidth-4+"px",a=pbars.splice(0,1),pbarsDone.push(a[0]),setTimeout(runpbar,500)):setTimeout(pbarfinish,500)}var pbarfinishCallback;
function pbarfinish(){for(var a=0;a<pbarsDone.length;a++)pbarsDone[a].parentNode.style.opacity=0,pbarsDone[a].parentNode.parentNode.parentNode.style.color="#000000";pbarsDone=[];tutorial.enabled&&(ctrl.dropMenuLocked=!1);pbarfinishCallback&&pbarfinishCallback();ctrl.animatingInstall=!1}var animateObj;
function loadAppIntro(a){read(function(a){$("docMain").innerHTML=a.responseText},"/sims/v5Module/marketApp.jsp?id="+a);document.body.style.overflowY="hidden";animateObj=$("appIntro");animateShow($("appId"+a))}
function animateShow(a){var b=findPos(a);animateObj.style.opacity=.99;animateObj.style.width="1px";animateObj.style.height="1px";animateObj.style.padding="0";animateObj.style.left=b[0]+a.clientWidth/5+"px";animateObj.style.top=b[1]+a.clientHeight/2+getBodyScrolltop()+"px";animateObj.style.display="";$("docMain").style.display="none";$("appClose").style.display="none";animateObj.className="transition";$("tutBlock").style.display="";$("tutBlock").style.opacity=0;$("tutBlock").style.height=document.documentElement.offsetHeight+
"px";$("tutBlock").onclick=exitAppIntro;requestAnimationFrame(_animateShow)}function _animateShow(){animateObj.style.top=60+getBodyScrolltop()+"px";animateObj.style.left="250px";animateObj.style.width="900px";animateObj.style.height="500px";animateObj.style.padding="25px";animateObj=null;setTimeout(function(){$("docMain").style.display="";$("appClose").style.display="";$("tutBlock").style.opacity=.2},150)}
function exitAppIntro(){$("appIntro").style.opacity=0;$("tutBlock").style.opacity=0;$("tutBlock").onclick=null;setTimeout(function(){$("appIntro").style.display="none"},150);setTimeout(function(){$("tutBlock").style.display="none"},500);document.body.style.overflowY="auto"}function wrapRelativeDiv(a,b,c){c=node("div",!1,c?"multiFilesContainer":"");b||(c.style.overflow="hidden");for(;a.hasChildNodes();)c.appendChild(a.childNodes[0]);a.appendChild(c)}
function getFilenameFromInputFile(a){return truncateFilenameMultiDotsToOne(a.match(/[^\/\\]+$/).toString())}function truncateFilenameMultiDotsToOne(a){return a.replaceAll(/\.{2,}/g,".")}
function hoverDesignModeHelper(a){a.style.width="450px";$("designModeHelperDiv").style.width="420px";a.hasAttribute("status")&&"0"!=a.getAttribute("status")||(a.setAttribute("status","0"),a.addEventListener("mouseout",closeDesignModeHelper));1<$("designModeHelperContent").innerHTML.length?($("designModeHelperHeader").style.display="none",$("designModeHelperDesc").style.display="none",$("designModeHelper").style.height="auto",$("designModeHelperClose").style.display="block"):($("designModeHelperHeader").style.display=
"",$("designModeHelperDesc").style.display="",$("designModeHelperClose").style.display="none");$("designModeHelperContent").style.display=""}
function closeDesignModeHelper(a){a=$("designModeHelper");a.style.width="60px";a.style.height="60px";1<$("designModeHelperContent").innerHTML.length?($("designModeHelperHeader").style.display="",$("designModeHelperDesc").style.display="none",$("designModeHelperContent").style.display="none",$("designModeHelperClose").style.display="none",rm($("designModeHelperContent")),a.setAttribute("status","0")):($("designModeHelperHeader").style.display="",$("designModeHelperDesc").style.display="none",$("designModeHelperDiv").style.width=
"30px",$("designModeHelperContent").style.display="none",$("designModeHelperClose").style.display="none")}function loadRightApproval(){getPromise("/sims/t_approval.jsp",{a:ap,p:path,fn:sheet}).then(function(a){var b=$("designModeHelper"),c=$("designModeHelperHeader"),d=$("designModeHelperContent");d.style.display="";c.style.display="none";d.innerHTML=a;loadApproval();b.style.width="auto";b.style.height="auto"})}function getInnerText(a){return a.innerText||""}
function linkToolTip(a,b,c){c||(c=window.event);var d=document.createElement("DIV");d.innerHTML=b;b=d.innerHTML;$("linkToolDesc"+a).innerHTML==b?$("linkToolDesc"+a).innerHTML=$("linkToolDesc"+a).getAttribute("backup"):($("linkToolDesc"+a).setAttribute("backup",$("linkToolDesc"+a).innerHTML),$("linkToolDesc"+a).innerHTML=b);c.stopPropagation()}function bounce(a){var b=$(a);b&&(b.style.transition="all 0.3s linear",b.style.marginTop="-10px",setTimeout(function(){$(a).style.marginTop=null},300))}
function gotoImportDir(a){$("dropboxPicker").innerHTML='<i class="fa fa-spinner fa-spin" style="margin:25px;"></i>';location.href="config?dir="+a}
function selectImportDir(a,b){ctrl.importDir==b?(a.style.background=null,a.style.color="#000000",ctrl.importDir=null,$("dropboxImportButton").style.opacity=.3):(ctrl.importDirObj&&(ctrl.importDirObj.style.background=null,ctrl.importDirObj.style.color="#000000"),a.style.background="#E76E6E",a.style.color="#ffffff",ctrl.importDir=b,ctrl.importDirObj=a,$("dropboxImportButton").style.opacity=1)}
function dropboxCreateExec(){ctrl.importDir=$("ragicDocsFolder").value;ctrl.importDir?window.chosenDirNames&&-1!==window.chosenDirNames.indexOf(ctrl.importDir)?floatWin(null,"You already have a folder with this name."):(ctrl.importDir="/"+ctrl.importDir,dropboxImportExec(!0)):floatWin(null,"Please enter a name as the RagicDocs folder to be created in your Dropbox.")}
function dropboxImportExec(a){ctrl.importDir?ajaxget("/integration/dropbox/exec.jsp",{a:ap,dir:ctrl.importDir,create:a?"true":"false"},function(a){eval(a)},!0):floatWin(null,"Please select a directory in your Dropbox as the home for your documents.")}
function importProgress(){ajaxget("/integration/checkProgress.jsp",{name:ap},function(a){a=JSON.parse(a);$("appSetupStatus").innerHTML=a.s+" "+a.c+" / "+a.t;1==a.d&&($("appSetupStatus").innerHTML="Dropbox initial sync complete!",0==tutorial.getDoneChapter().length||-1===tutorial.getDoneChapter().indexOf("004")?tutorialStart("004"):setTimeout(function(){location.href="/"+ap+"/apps/dropbox/manage"},3E3));ctrl.lastStatus=a},!1);setTimeout(importProgress,2E3)}var appSetupResult={currentStep:1,choices:[""]};
function appSetupStep(a,b){var c=a+1;appSetupResult.choices[a]=b;appSetupResult.currentStep=c;$("appSetupStep"+a).style.display="none";$("appSetupStep"+c)?$("appSetupStep"+c).style.display="":window.location="install?ans="+encodeURIComponent(JSON.stringify(appSetupResult.choices))}function appSetupBack(){var a=appSetupResult.currentStep,b=appSetupResult.currentStep-1;appSetupResult.currentStep=b;$("appSetupStep"+a).style.display="none";$("appSetupStep"+b)&&($("appSetupStep"+b).style.display="")}
function addSlashes(a){return a.replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")}function unescapeHTML(a){var b=document.createElement("textarea");b.innerHTML=a;return b.textContent}
function approvalPrompt(a,b,c,d){var e="<div style='margin:15px;'>";a&&(e+="<div style='margin:0 0 6px 0;'>"+lm.approval_pwd_req+"</div>"+(b?"<div style='color:#cc0000;'>"+lm.pwdNotMatch+"</div>":"")+"<input style='width:250px;' id='apr_pwd' type='password'><br/><br/>");if(a||c||!d){b="REJ"===$("wfResponse").value;var f=$("approvalForm"),g=f.closest("tr"),k=g.querySelector("td"),l=k.dataset.email;k=k.dataset.nocontinuoussigning;g=g.nextSibling;if(g)var m=g.querySelector("td").dataset.email;c&&(e+=
'<div style="margin:0 0 6px 0;">'+lm.signature+"</div>",e=e+'<div id="approvalCanvasContainer" class="signatureBlock"><canvas id="approvalSigcanvas" width="500" height="250" style="background:#f8f8f8;border:1px solid #ccc;border-radius:5px;float:left;clear:left;"></canvas><div class="clearSignatureIcon" onclick="clearSig();"><i class="fas fa-redo-alt"></i></div><div id="approvalSigBackgroundDiv"></div></div><div style="margin:0 0 8px 0;"><a id="approvalAddPersonalSigLink" href="javascript:void(0);" >'+
(lm.loadSigFromPersonalSetting+"</a></div>"));d||(e+="<div style='margin:0 0 6px 0;'>"+lm.approval_comment_req+"</div><textarea id='apr_comment' style='width:500px;height:60px;'></textarea><br/>");!l||!m||l!==m||b||k||c||(e+=(d?"<div style='display:none'>":"<div style='margin:10px 0 10px 0'>")+"<input style='display: none' type='checkbox' id='approval_continuous_signing' checked/><label for='approval_continuous_signing'>"+lm.approval_continuous_signing+"<a style='margin: 0 0 0 3px;float:none;top:0;' href='javascript:void(0);' onclick='showSingleTooltip(this,\"HELP_APPROVAL_CONTINUOUS_SIGNING\",false,true,false,true);' class='tooltipQ'><i class='fas fa-question'></i></a></label></div>");
e+="<div id='pwd_submit'  class='topButtonWhole' style='margin:15px 0 0 0;' onclick='approvalPromptSubmit();'>OK</div></div>";k&&(f.elements.namedItem("continuous_signing").value=!1);floatWin(null,e,"",!0);c&&(c=$("approvalSigcanvas"),loadSigScript(c),ctrl.isIE&&ctrl.isObsoleteIE||setSignatureBackgroundBox($("approvalSigBackgroundDiv"),!0),$("approvalAddPersonalSigLink").onclick=function(){getPromise("/sims/reg/getSignature.jsp",{a:ap}).then(function(a){a&&setSignatureBackground(a)})});$("floatingWin").classList.add("thinFloatingWin");
a?$("apr_pwd").focus():$("apr_comment").focus()}else approvalPromptSubmit(!0)}
function approvalPromptSubmit(a){var b=$("approvalForm");$("apr_pwd")&&(b.elements.namedItem("apr_pwd").value=$("apr_pwd").value);$("approval_continuous_signing")?b.elements.namedItem("continuous_signing").value=$("approval_continuous_signing").checked:a&&(b.elements.namedItem("continuous_signing").value=!0);b.elements.namedItem("comment").value=$("apr_comment")?$("apr_comment").value:"";$("approvalCanvasContainer")&&(a=ctrl.signaturePad.toDataURL(),b.elements.namedItem("dig_sig").value=a);b.submit();
floatWinClose()}function toggleAprComment(a){a=$("aprComment"+a);a.style.display="none"===a.style.display?"":"none"}function checkEmailIdAccess(a){a.checked&&floatWin(null,lm.guestEmailValidationMsg)}function calendarUrlGen(){for(var a="",b=0;$("domain"+b);b++)if(!$("domain"+b).checked){var c=$("domain"+b).value;0<a.length&&(a+=",");a+=c}0<a.length&&($("calendarUrl").value=$("calendarOUrl").value+"&x="+a)}
function calendarUrlGenBySelect(a){for(var b=ctrl.calendarSelectActionBuilder.result.result,c=[],d=0,e=0;e<b.length;e++){c[d]={};c[d].subtableKeys={};for(var f in b[e])if("field"!=f&&"value"!=f){var g=JSON.parse(b[e][f]);c[d][f]=g.value;g.subtableKey&&(c[d].subtableKeys[g.subtableKey]="")}if(c[d].selStart){g=0;for(f in c[d].subtableKeys)if(g++,1<g)break;if(1<g){window.alert(lm.calEventFromMultiSubtables);return}delete c[d].subtableKeys;d++}}0==d?window.alert(lm.calNoEventSelected):($("calendarUrl").value=
$("calendarOUrl").value.split("&y=")[0]+"&y="+encodeURIComponent(JSON.stringify(c)),$("calendarUrl").value+="&r="+Math.floor(1E4*Math.random()),$("calendarUrl").value+="&tz="+encodeURIComponent($("calendarTimeZone").options[$("calendarTimeZone").selectedIndex].value),$("calendarUrl").value+="&v=2",$("calendarUrl").value+="&applyDST="+$("calApplyDST").checked,$("calendarUrl").value+="&displayRecordUrlInDescription="+$("calDisplayRecordUrlInDescription").checked,shortenURL($("calendarUrl").value,function(b){b=
JSON.parse(b);b.err?(window.alert(b.err),window.prompt(a,$("calendarUrl").value)):window.prompt(a,b.shortLink)}))}function calendarFloatingWinGen(a,b,c,d){ctrl.floatWinCallback=calendarSelectGen;floatWin(a,b,c,d)}
function calendarSelectGen(){var a=[],b=[],c=[],d=[],e=[],f=[],g=0;ajaxgetAllowCache("/sims/listFields.jsp",{a:ap,p:path,si:sheetIndex,prefix:"",nosubtable:!1},function(k){var l=node("div");l.innerHTML=k;for(k=0;k<l.childNodes.length;k++){var m;if("OPTION"==l.childNodes[k].nodeName){if(-1==l.childNodes[k].value)continue;var r={};r.value=l.childNodes[k].value;(m=l.childNodes[k].getAttribute("subtableKey"))&&(r.subtableKey=m);m=l.childNodes[k].getAttribute("dateFormat");"T"==m?(c.push(l.childNodes[k].text),
d.push(JSON.stringify(r))):"D"==m&&(a.push(l.childNodes[k].text),b.push(JSON.stringify(r)));f.push(JSON.stringify(r));e.push(l.childNodes[k].text)}g++}},!0);if(0<g&&(ctrl.calendarSelectActionBuilder.config.items[0].options=a,ctrl.calendarSelectActionBuilder.config.items[0].optionValues=b,ctrl.calendarSelectActionBuilder.config.items[1].options=c,ctrl.calendarSelectActionBuilder.config.items[1].optionValues=d,ctrl.calendarSelectActionBuilder.config.items[2].options=a,ctrl.calendarSelectActionBuilder.config.items[2].optionValues=
b,ctrl.calendarSelectActionBuilder.config.items[3].options=c,ctrl.calendarSelectActionBuilder.config.items[3].optionValues=d,ctrl.calendarSelectActionBuilder.config.items[4].options=e,ctrl.calendarSelectActionBuilder.config.items[4].optionValues=f,ctrl.calendarSelectActionBuilder.config.items[5].options=e,ctrl.calendarSelectActionBuilder.config.items[5].optionValues=f,ctrl.calendarSelectActionBuilder.config.items[6].options=e,ctrl.calendarSelectActionBuilder.config.items[6].optionValues=f,ctrl.calendarSelectActionBuilder.loadResult({result:[{field:"",
value:""}]}),ctrl.calendarSelectActionBuilder.renderActionBuilder($("selectDiv")),null!=document.querySelector("#selectDiv .fa-plus-square"))){document.querySelector("#selectDiv .fa-plus-square").parentNode.addEventListener("click",calendarSelectStyleAdjust);for(var k=document.querySelectorAll("#selectDiv .fa-times"),l=0;l<k.length;l++)k[l].parentNode.addEventListener("click",calendarSelectStyleAdjust);calendarSelectStyleAdjust()}}
function calendarSelectStyleAdjust(){var a=document.querySelector("#floatingWinContent th").innerHTML;a+='<label style="color:red;margin:0;">*</label>';document.querySelector("#floatingWinContent th").innerHTML=a;a=document.querySelectorAll("#floatingWinContent select");for(var b in a)a[b].style="width:85px;";document.querySelector(".actionTable").style.margin="12px 2%";document.querySelector(".fa-plus-square").parentNode.addEventListener("click",calendarSelectStyleAdjust);a=document.querySelectorAll("#selectDiv .fa-times");
for(b=0;b<a.length;b++)a[b].parentNode.addEventListener("click",calendarSelectStyleAdjust)}function shortenURL(a,b){ajaxpost("/sims/shortenUrl.jsp",{longUrl:a},b)}function calendarHelpMsgDisp(){var a=$("calenderHelpMsg");a.style.display="none"==a.style.display?"block":"none"}
function changeEventSelected(a){var b=$("homeCalendarConfigAvailableCell"),c=$("homeCalendarConfigSelectedCell");if(a)for(a=0;a<c.options.length;a++){var d=c.options[a];var e=d.parentElement;var f=e.getAttribute("value");if(d.selected){d.selected=!1;d.style.background=d.style.background.split("/")[1];1<e.childElementCount?e.removeChild(d):c.removeChild(e);f=b.querySelector("optgroup[value='"+f+"']");var g=$("homeCalendarConfigTabSelect").value.split("/")[1],k=d.value.split("/")[1];g==k&&(f?(f.style.display=
"",d.style.background=d.getAttribute("background"),d.removeAttribute("background"),f.appendChild(d)):(e=e.cloneNode(!1),e.style.background=e.getAttribute("background"),e.removeAttribute("background"),d.style.background=d.getAttribute("background"),d.removeAttribute("background"),e.appendChild(d),b.appendChild(e)),a--)}}else for(a=0;a<b.options.length;a++)d=b.options[a],e=d.parentElement,f=e.getAttribute("value"),d.selected&&(d.selected=!1,1<e.childElementCount?e.removeChild(d):b.removeChild(e),(f=
c.querySelector("optgroup[value='"+f+"']"))?(d.setAttribute("background",d.style.background),d.style.background="",f.appendChild(d)):(e=e.cloneNode(!1),e.setAttribute("background",e.style.background),e.style.background="",d.setAttribute("background",d.style.background),d.style.background="",e.appendChild(d),c.appendChild(e)),a--)}
function saveSelected(){var a=$("homeCalendarConfigSelectedCell"),b="",c=parseInt($("cellCount").innerText);if(0<=a.options.length){if(!(a.options.length==c&&0<a.options.length))for(c=0;c<a.options.length;c++)b=0!=c?b+","+a.options[c].value:a.options[c].value;getPromise("/sims/updateHomeConfig.jsp",{a:ap,action:"saveSelected",sheetPaths:b}).then(function(){floatWinClose(!1);loadHomeEvents()})}}
function homeCalendarConfigSelectTabChange(){var a=$("homeCalendarConfigSelectedCell");if(""===$("homeCalendarConfigTabSelect").value)$("homeCalendarConfigAvailableCell").innerHTML="";else{for(var b="",c=0;c<a.options.length;c++)b=0!=c?b+","+a.options[c].value:a.options[c].value;getPromise("/sims/homeCalendarConfigHelper.jsp",{a:ap,msi:$("homeCalendarConfigTabSelect").value,sc:b}).then(function(a){null==a&&(a="");$("homeCalendarConfigAvailableCell").innerHTML=null==a?"":a})}}
function removeAllSelectedEvent(){$("homeCalendarConfigSelectedCell").innerHTML="";$("homeCalendarConfigTabSelect").options[0].selected="selected";homeCalendarConfigSelectTabChange()}function closeAccount(){confirm("Are you absolutely sure?")&&postPromise("/sims/dev/rdu.jsp",{a:ap}).then(eval)}function hideSimpleReport(){showFloatingMain();ctrl.simpleReportOn=!1;$("v6Recent").style.display=""}
function clickAppCatTab(a){for(var b=0;$("appcatTab"+b);)$("appcatTab"+b).className="",b++;$("appcatTab"+a).className="largeTabOn";for(b=0;$("appcatContent"+b);)$("appcatContent"+b).style.display="none",b++;$("appcatContent"+a).style.display=""}function addButtonDuplicate(a){ctrl.temp=a;dropWin(this,$("builderFromToolsDrop"));floatWinPrompt("_addButtonDuplicate",lm.createActionButtonDuplicate,"","")}
function _addButtonDuplicate(){var a=0;for(c in builder.actionButtons){var b=parseInt(c);b>a&&(a=b)}a+=1;var c=getNextActionButtonId();builder.actionButtons[a]=new ActionButton(c,"F",a,$("floatWinPromptInput").value,ctrl.temp);builderHelperPanelSwitch(3);$("bActionButtons").click();getActionButtons(a);updateBuilderActionButtonCheckBoxValue(builder.actionButtons[a]);floatWinClose()}
function addButtonSubtableCreate(a){ctrl.temp=a;floatWinPrompt("_addButtonSubtableCreate",lm.createActionButtonSubtableCreate,"","")}
function _addButtonSubtableCreate(){var a=Object.keys(builder.actionButtons).reduce(function(a,b){return Math.max(a,b)},0);a+=1;var b=getNextActionButtonId();builder.actionButtons[a]=new ActionButton(b,"F",a,$("floatWinPromptInput").value,ctrl.temp);builderHelperPanelSwitch(3);$("bActionButtons").click();getActionButtons(a);updateBuilderActionButtonCheckBoxValue(builder.actionButtons[a]);floatWinClose()}
function paramFillFieldWithNodeId(a,b){for(var c=biffdata.biffs,d=a,e=0;e<c.length;e++){var f=c[e];if(f.dataType==DATA&&f.attr&&f.attr.stf==a){d=f.domainId;break}}if(a=biffdata.findBiff(d)[0].ip)a.loadValueByNodeId(parseInt(b)),a.render()}
function paramFillFieldWithValue(a,b){a=biffdata.findBiff(a)[0];var c=a.ip;c.type==SELECTOR?(c.notify=!0,c.reloadNotify=!0,c._write(b),b=c._getSuggest(),c.nodeIdSpecified&&a.value==b||(c.userInput&&0<c.userInput.length?c.loadValue(b):c.loadValue(""))):c.loadValue(b);c.render()}function shiftPipeIndex(a,b,c){var d=a.split("|");if(1>=d.length)return a;a=parseInt(d[0]);d=parseInt(d[1]);b?a+=c:d+=c;return a+"|"+d}
function isPathTaken(a){return"/home"===a||"/market"===a||"/apps"===a||"/search"===a||"/report"===a||"/reports"===a||"/design"===a||"/data"===a||"/config-setup"===a||"/notifications"===a||"/notificationSetting"===a||"/workflow"===a||"/admin"===a||"/billing"===a||"/translation"===a||"/start"===a||"/jobs"===a}
function loadVideoLoop(a,b){ctrl.showTooltip=!0;tooltipV2(a,function(){var a=$("preloadedVideo");$("tutorialText").appendChild(a);a.loop=!0;a.currentTime=0;a.load();a.play();a.style.width="540px";a.style.height="303.75px";a.style.top="20px";a.id=null},b,50,576,353.75,"#f2f2f2","#aaa")}
function loadVideoLoopURL(a,b,c){ctrl.showTooltip=!0;ctrl.dropWin=!0;tooltipV2(a,function(){$("tutorialText").innerHTML='<video autoplay loop style="position:absolute;top:20px;left:0;width:540px;height:303.75px;"><source src="'+b+'" type="video/mp4"></video>'},c,50,576,353.75,"#f2f2f2","#aaa")}
function loadVideoLoopOld(a){ctrl.dropWinLock=!0;var b=Math.min(720,Math.floor(document.body.clientHeight-50)),c=Math.floor(b/.75);$("videoRoom").style.display="";$("youtubeLoader").innerHTML='<video autoplay loop style="width:'+c+"px;height:"+b+'px;"><source src="'+a+'" type="video/mp4"></video>';document.documentElement.scrollTop=0}function loadImageBox(a){$("videoRoom").style.display="";$("youtubeLoader").innerHTML='<img src="'+a+'" style="width:95%;" />';document.documentElement.scrollTop=0}
function loadSlide(a){var b=Math.min(720,Math.floor(document.body.clientHeight-50)),c=Math.floor(b/.75);$("videoRoom").style.display="";$("youtubeLoader").innerHTML='<iframe style="width:'+c+"px;height:"+b+'px;border-width:0px;"  src="//www.slideshare.net/slideshow/embed_code/'+a+'" allowfullscreen></iframe>';document.documentElement.scrollTop=0}
function loadTutorialVideo(a){var b=Math.min(720,Math.floor(document.body.clientHeight-50)),c=Math.floor(b/.75);$("videoRoom").style.display="";"zh-CN"==langv5?$("youtubeLoader").innerHTML='<iframe style="width:'+c+"px;height:"+b+'px;border-width:0px;"  src="//player.youku.com/embed/'+a+'" frameborder=0 "allowfullscreen"></iframe>':$("youtubeLoader").innerHTML='<iframe style="width:'+c+"px;height:"+b+'px;border-width:0px;"  src="//www.youtube.com/embed/'+a+'?autoplay=1" allowfullscreen></iframe>';
b=userProperties.initedVideoTut;a={"2CJMfgpfKBI":"001","10zyRc8eLXc":"002",tX6DWYX0KYY:"003",VnORcKMoWPs:"004"}[a];b?-1===b.search(a)&&(b=b.split("|"),b.push(a),saveUserProperties("initedVideoTut",b.join("|"))):saveUserProperties("initedVideoTut",a);$("video"+a)&&$("video"+a).previousSibling&&$("video"+a).previousSibling.style&&($("video"+a).previousSibling.style.visibility="visible");document.documentElement.scrollTop=0}
function docWinMsg(a,b){if(a&&"null"!=a&&!tutorial.enabled&&"DISTR"!=window.edition){var c=$("onboardTab"+a);c&&(ctrl.currentDocWinMsgTab&&(ctrl.currentDocWinMsgTab.className="dockWinRightTableTD2"),c.className+=" dockWinRightTableTD2Open");b?b.a=ap:b={a:ap};ajaxget("/sims/v5frame/msg/"+langv5+"/"+a+".jsp",b,function(b){$("docWinMsg").innerHTML=b;nui?$("docWinMiddle").style.bottom="12px":$("docWinMiddle").style.bottom=0;$("docWinMiddle").setAttribute("displayed",!0);"default"==a&&(b=RagicStorage.localStorage.getItem("onboardingOpen"),
switchOnboardSteps(b),(b=RagicStorage.localStorage.getItem("onboardingSubMsg"))&&docWinSubMsg(b,null,!0))});c&&(ctrl.currentDocWinMsgTab=c);saveUserProperties("onboardingTab",a);saveUserProperties("onboardingWinClose","")}}
function docWinSubMsg(a,b,c){var d=$("docWinSubMsg");d&&(d.className="",rm(d),d.style.margin="0 0 0 350px",b?b.a=ap:b={a:ap},ajaxget("/sims/v5frame/msg/"+langv5+"/"+a+".jsp",b,function(a){d.innerHTML=a;c||(d.className="transitionIt");setTimeout(function(){$("docWinSubMsg").style.margin="0"},300)}),RagicStorage.localStorage.setItem("onboardingSubMsg",a))}
function closeDocMsg(){$("docWinMiddle").style.bottom="-500px";$("docWinMiddle").setAttribute("displayed",!1);saveUserProperties("onboardingWinClose","1")}
function switchOnboardSteps(a){var b=$("onboardsteps"+a);b&&(""==b.style.display?(b.style.display="none",ctrl.currentOnboardStep=null,RagicStorage.localStorage.removeItem("onboardingOpen")):(ctrl.currentOnboardStep&&(ctrl.currentOnboardStep.style.display="none"),b.style.display="",ctrl.currentOnboardStep=b,RagicStorage.localStorage.setItem("onboardingOpen",a)))}
function submitComment(a){a.onclick=null;a.classList.add("submittingComment","topButtonDisabled");RagicStorage.localStorage.removeItem("RAGIC_TEXT_"+ap+path+"/"+sheetIndex+"/"+biffdata.rootNodeId+"/comment");$("newCommentForm").submit()}
function sendEmailConversation(){if(!ctrl.submitSemaphore){$("bEmailSend").onclick=null;ctrl.submitSemaphore=!0;RagicStorage.localStorage.removeItem("RAGIC_TEXT_"+ap+path+"/"+sheetIndex+"/"+biffdata.rootNodeId+"/email");var a=new FormData,b=document.querySelectorAll(".emailAttachFile");b&&b.length&&b.forEach(function(b){a.append("at",b.files[0])});b=$("emailConversationForm");var c="/sims/mmailer/reply.jsp?a="+ap,d=b.querySelectorAll("input");d&&d.length&&(d.forEach(function(b){b.name&&(b.value||
(b.value=""),"file"!==b.type&&a.set(b.name,b.value))}),b.querySelectorAll("textarea").forEach(function(b){b.name&&b.value&&a.set(b.name,b.value)}),postFormDataPromise(c,a).then(function(a){"Y"===a?(ctrl.currentController.resetBrowseLeft(),ctrl.currentController.load("&reset","",function(){})):(ctrl.currentController.resetBrowseLeft(),browseBack());setTimeout("ctrl.submitSemaphore = false;",1E3)}))}}
function changeToUpdateEmailTemplateMode(a){loadEmailTemplate(a);$("bEmailTemplate").style.display="";$("bEmailSend").style.display="none";$("tocc").style.display="none";$("emailTemplateContent").style.background="#ffefef";$("templateIdInput").value=a}function deleteEmailTemplate(a){confirm("Delete template?")&&ajaxget("/sims/mmailer/deleteTemplate.jsp",{a:ap,p:path,si:sheetIndex,ti:a},function(a){eval(a)})}
function saveAsEmailTemplate(){var a=prompt("Template name:",$("templateName").value);a&&($("templateName").value=a,$("emailConversationForm").action="/sims/mmailer/saveTemplate.jsp?a="+ap,$("emailConversationForm").submit())}function newEmailTemplate(){$("bEmailTemplate").style.display="";$("bEmailSend").style.display="none";$("tocc").style.display="none";$("emailTemplateContent").style.background="#ffefef";$("emailTemplateContent").value="";$("templateIdInput").value="-1"}
function loadEmailTemplate(a){$("bEmailTemplate").style.display="none";$("bEmailSend").style.display="";$("bEmailSend").className+=" topButtonCut";$("tocc").style.display="";$("emailTemplateContent").style.background=null;ajaxget("/sims/mmailer/loadTemplate.jsp",{a:ap,p:path,si:sheetIndex,tid:a},function(a){a=JSON.parse(a);$("emailTemplateSubject").value||($("emailTemplateSubject").value=a.subject);$("emailTemplateContent").value=a.content+"\n\n\n--\n"+a.sig;$("templateIdInput").value=a.id;$("templateName").value=
a.name;a.att&&0<a.att.length&&($("loadedAttach").value=a.att[0],$("emailAttachLinkText").innerHTML=getFilenameFromInputFile(a.att[0]))})}function editSignature(){ajaxget("/sims/mmailer/showSignature.jsp",{a:ap},function(a){$("emailEditor").innerHTML=a})}function quickBillUpdateUser(){if($("numOfUsers")&&$("unitPrice")){var a=parseInt($("unitPrice").value)*parseInt($("numOfUsers").value);a&&!isNaN(a)?$("billAmount").innerHTML="$"+a:rm($("billAmount"))}}
function quickPartnerTemplateBillChangePlan(){floatWin(function(){return"/billing/s/changePlan.jsp?partnerTemplate&a="+ap},null,"",!0);ctrl.floatWinCallback=function(){$("floatingWinContent").style.height="auto"}}
function quickBillChangePlan(a,b){window.isFreeDistr?floatWin(null,'You will need to <a href="https://www.ragic.com/intl/en/pricing?qnap" target="_blank">upgrade your account</a> to allow more sheets and records.'):ifFreePack()?floatWin(function(){return"/billing/s/freecrmUpgrade.jsp?a="+ap},null,"",!0):(floatWin(function(){return"/billing/s/changePlan.jsp?a="+ap+(a?"&profOnly":"")+(b?"&code="+b:"")},null,"",!0),ctrl.floatWinCallback=function(){$("floatingWinContent").style.height="auto"})}
function placeHotspot(a,b,c,d,e,f){if(a){b||(b="c");ctrl.hotspot||(ctrl.hotspot=node("span"));var g=ctrl.hotspot;g.className="hotspot";g.style.position="absolute";g.style.display=f?"none":"";positionHotspot(g,a,b);document.body.appendChild(g);c&&(g.onclick=function(){c();ctrl.hotspot&&(ctrl.hotspot.style.display="none")});d&&(g.onmouseenter=d);e&&(g.onmouseleave=e);f&&f()}}
function positionHotspot(a,b,c,d){var e=findPos(b),f=b.offsetHeight;b=b.offsetWidth;var g=d?nui.main.scrollTop:0;1==c?(a.style.top=e[1]-29+f/2-g+"px",a.style.left=e[0]-20+"px"):2==c?(a.style.top=e[1]-29+f/2-g+"px",a.style.left=e[0]+b-48+"px"):3==c?(a.style.top=e[1]-29-g+"px",a.style.left=e[0]-29+b+"px"):"c"==c?(a.style.top=e[1]-29+f/2-g+"px",a.style.left=e[0]-29+b/2+"px"):"cl"==c&&(a.style.top=e[1]-29+f/2-g+"px",a.style.left=e[0]-29+b/4+"px");d&&(a.style.visibility=140>a.offsetTop?"hidden":"visible")}
function preloadVideo(a){var b=$("preloadedVideo")||node("video");b.id="preloadedVideo";b.style.position="absolute";b.style.top=0;b.style.left=0;b.style.width="1px";b.style.height="1px";b.autoplay=!0;b.oncanplaythrough=function(){"1px"==b.style.width&&(ctrl.hotspot.style.display="")};var c=node("source");c.src=a;b.appendChild(c);document.body.appendChild(b)}function isFunction(a){if(!a)return!1;var b={};return a&&"[object Function]"===b.toString.call(a)}
function attachFileToEmail(a,b){a||(a=$("emailAttachFileDiv"));b||(b=$("emailAttachLinkText"));ctrl.emailAttachCount||(ctrl.emailAttachCount=0);ctrl.emailAttachCount++;var c=node("input");c.type="file";c.id="emailAttachFile"+ctrl.emailAttachCount;c.name="at";c.classList.add("emailAttachFile");c.style.display="none";c.onchange=function(){b.innerHTML+='<div id="emailAttachLabel'+ctrl.emailAttachCount+'" style="margin:0 0 0 18px;">'+getFilenameFromInputFile(this.value)+"</div>"};a.appendChild(c);$("emailAttachFile"+
ctrl.emailAttachCount).click()}function promptRightForGroup(a,b){ctrl.saveRightSettingRole=a;"X-"==a.substr(0,2)?$("internalRights").style.display="none":$("internalRights").style.display="";dropWin(b,$("dropdown"),!1,!1,0)}function ifChinese(a){return 19968<=a.charCodeAt(0)&&40869>=a.charCodeAt(0)}
function subtableCopyPreviousRow(){if(!biffdata.ifListingPage()){var a=biffdata.getDataRoot(nui.fcol,nui.frow).ip;if(a){var b=nui._getcell(a.biff.x,a.biff.y-1).ip;if(b){for(;a;){if(a.biff.attr&&b&&a.IPType!=UPLOADER){if(a.biff.attr.ro)continue;a.loadValue(b.getValue());a.render()}if(a=nui._getcell(a.biff.x+1,a.biff.y).ip)b=nui._getcell(a.biff.x,a.biff.y-1).ip}$("hin").setValue(nui._curcell().ip.getValue())}}}}
function massCreateShowDiv(a,b){void 0!=a&&(void 0!=b&&clearTimeout(b),a.style.opacity=1,a.zIndex="auto",a.style.visibility="visible",a.style.position="static")}function massCreateHiddenDiv(a){if(void 0!=a)return a.style.opacity=0,setTimeout(function(){a.zIndex=-1;a.style.visibility="hidden";a.style.position="absolute"},800)}function openMassCreateTabs(){floatWin(null,ctrl.massCreateTabsBuilder.text,lm.massCreate_floatingTitle,!0,null,!1);ctrl.massCreateTabsBuilder.openDiv()}
function executeMassCreateScript(){if(void 0===ctrl.massCreateTabsBuilder.dataCount||0===ctrl.massCreateTabsBuilder.dataCount)floatWin(null,lm.massCreate_errorCreateMsg,lm.massCreate_errorCreateTitle),massCreateTabsBuilder.closeDiv();else{var a=ctrl.massCreateDefaultValueAction.result.result,b=ctrl.massCreateRuleResult;!1!==checkEmptyField(a)&&(a={a:ap,p:path,si:sheetIndex,fieldDefaultValue:JSON.stringify(a),createRule:JSON.stringify(b)},setTimeout(updateSystemTaskProgress,1E3),floatWinClose(),postPromise("/sims/massCreate.jsp",
a).then(function(a){a=JSON.parse(a);if("allSuccess"===a.STATUS)inNUI(),setTimeout(silentReload,300),ctrl.massCreateTabsBuilder.closeDiv();else if("allFailure"===a.STATUS||"error"===a.STATUS)$("floatingWin").style.display="",$("massCreateMsgDiv").innerHTML=a.ERROR_MSG,$("massCreateMsgDiv").style.display="";else if("fractionSuccess"===a.STATUS){var b=a.SUMMARY;b=b+"<br /><br />"+lm.massCreate_failureReasonTitle;b=b+"<br />"+a.ERROR_MSG;floatWin(null,b,lm.massCreate_fractionSuccessTitle);setTimeout(silentReload,
300);ctrl.massCreateTabsBuilder.closeDiv()}}))}}function checkEmptyField(a){for(var b=!0,c=0;c<a.length;c++)void 0!==a[c].field&&""!==a[c].field&&(b=!1);return!1===b?!0:confirm(lm.massCreateEmptyField_confirmMsg)}
function updateDataCount(a,b,c,d){var e=1,f=function(a,b,c){if(a===lm.massCreateCategory_numbericRange){b=parseInt(b);c=parseInt(c);if(isNaN(b)||isNaN(c))return 0;b=c>b?c-b+1:b-c+1;ctrl.massCreateNumbericRangeAction.dataCount=b;deleteCreateRuleResult(lm.massCreateCategory_numbericRange);c=ctrl.massCreateNumbericRangeAction.result.result[0];ctrl.massCreateRuleResult.push({createType:a,result:{itemId1:c.rangeStart,itemId2:c.rangeEnd}});return b}return null!=ctrl.massCreateNumbericRangeAction.dataCount?
ctrl.massCreateNumbericRangeAction.dataCount:null}(a,b,c);null!==f&&(e*=f,d.innerHTML=f);f=function(a,b,c){b=new Date(b);c=new Date(c);if(null!=b&&null!=c&&!isNaN(b)&&!isNaN(c)&&b.getTime()>c.getTime()){var d=b;b=c;c=d}if(a===lm.massCreateCategory_hourlyCreate){if(null==b||null==c||isNaN(b)||isNaN(c))return 0;b=c.getTime()-b.getTime();b=Math.floor(b/36E5)+1;ctrl.massCreateTimeRangeAction.dataCount=b;deleteCreateRuleResult(lm.massCreateCategory_hourlyCreate);c=ctrl.massCreateTimeRangeAction.result.result[0];
ctrl.massCreateRuleResult.push({createType:a,result:{itemId1:c.rangeStart,itemId2:c.rangeEnd},dateFormat:ctrl.massCreateTimeRangeAction.dateFormat});return b}if(a===lm.massCreateCategory_dailyCreate){if(null==b||null==c||isNaN(b)||isNaN(c))return 0;b=c.getTime()-b.getTime();b=Math.floor(b/864E5)+1;ctrl.massCreateTimeRangeAction.dataCount=b;deleteCreateRuleResult(lm.massCreateCategory_dailyCreate);c=ctrl.massCreateTimeRangeAction.result.result[0];ctrl.massCreateRuleResult.push({createType:a,result:{itemId1:c.rangeStart,
itemId2:c.rangeEnd},dateFormat:ctrl.massCreateTimeRangeAction.dateFormat});return b}if(a===lm.massCreateCategory_weeklyCreate){if(null==b||null==c||isNaN(b)||isNaN(c))return 0;b=c.getTime()-b.getTime();b=Math.floor(b/6048E5)+1;ctrl.massCreateTimeRangeAction.dataCount=b;deleteCreateRuleResult(lm.massCreateCategory_weeklyCreate);c=ctrl.massCreateTimeRangeAction.result.result[0];ctrl.massCreateRuleResult.push({createType:a,result:{itemId1:c.rangeStart,itemId2:c.rangeEnd},dateFormat:ctrl.massCreateTimeRangeAction.dateFormat});
return b}if(a===lm.massCreateCategory_monthlyCreate){if(null==b||null==c||isNaN(b)||isNaN(c))return 0;d=12*(c.getFullYear()-b.getFullYear());d+=c.getMonth()-b.getMonth();d+=1;ctrl.massCreateTimeRangeAction.dataCount=d;deleteCreateRuleResult(lm.massCreateCategory_monthlyCreate);b=ctrl.massCreateTimeRangeAction.result.result[0];ctrl.massCreateRuleResult.push({createType:a,result:{itemId1:b.rangeStart,itemId2:b.rangeEnd},dateFormat:ctrl.massCreateTimeRangeAction.dateFormat});return d}if(a===lm.massCreateCategory_yearlyCreate){if(null==
b||null==c||isNaN(b)||isNaN(c))return 0;b=c.getFullYear()-b.getFullYear();b+=1;ctrl.massCreateTimeRangeAction.dataCount=b;deleteCreateRuleResult(lm.massCreateCategory_yearlyCreate);c=ctrl.massCreateTimeRangeAction.result.result[0];ctrl.massCreateRuleResult.push({createType:a,result:{itemId1:c.rangeStart,itemId2:c.rangeEnd},dateFormat:ctrl.massCreateTimeRangeAction.dateFormat});return b}return null!=ctrl.massCreateTimeRangeAction.dataCount?ctrl.massCreateTimeRangeAction.dataCount:null}(a,b,c);null!==
f&&(e*=f,d.innerHTML=f);f=function(a,b){var c=0;if(a===lm.massCreateCategory_group){if(null!=b&&0!=b.length){for(var d=ctrl.massCreateGroupAction.groupArray,e=0;e<d.length;e++)if(b===d[e].group){c+=d[e].usersCount;break}ctrl.massCreateGroupAction.dataCount=c;deleteCreateRuleResult(lm.massCreateCategory_group);ctrl.massCreateRuleResult.push({createType:a,result:{itemId1:b,itemId2:""}});return c}return 0}return null!=ctrl.massCreateGroupAction.dataCount?ctrl.massCreateGroupAction.dataCount:null}(a,
b);null!==f&&(e*=f,d.innerHTML=f);f=function(a,b){var c=0;b=parseInt(b);if(a===lm.massCreateCategory_selectOption){if(isNaN(b)||-1==b)return 0;for(var d=ctrl.massCreateSelectOptionAction.optionArray,e=0;e<d.length;e++)if(b===d[e].domainId){c+=d[e].optionCount;break}ctrl.massCreateSelectOptionAction.dataCount=c;deleteCreateRuleResult(lm.massCreateCategory_selectOption);ctrl.massCreateRuleResult.push({createType:a,result:{itemId1:b+"",itemId2:""}});return c}return null!=ctrl.massCreateSelectOptionAction.dataCount?
ctrl.massCreateSelectOptionAction.dataCount:null}(a,b);null!==f&&(e*=f,d.innerHTML=f);f=function(a,b,c){if(a===lm.massCreateCategory_linkSheet){var d=0,e=b.sheetValue,f=e.lastIndexOf("/"),g=e.slice(0,f);e=e.slice(f+1);b=b.fieldValue;c=c.filterValue;ajaxget("/sims/massCreateQuery.jsp",{a:ap,path:g,si:e,filterSeq:c,query:"getLinkSheetCount"},function(a){d=parseInt(a)},!0);deleteCreateRuleResult(lm.massCreateCategory_linkSheet);ctrl.massCreateRuleResult.push({createType:a,result:{itemId1:{path:g,sheetIndex:e,
field:b,filter:c}}});return ctrl.massCreateLinkSheetAction.dataCount=d}return null!=ctrl.massCreateLinkSheetAction.dataCount?ctrl.massCreateLinkSheetAction.dataCount:null}(a,b,c);null!==f&&(e*=f,d.innerHTML=f);ctrl.massCreateTabsBuilder.dataCount=e;updateDefaultValueBlock(a,e,b,c)}
function updateDefaultValueBlock(a,b,c,d){function e(a,b,c,d,e){a=parseInt(a);b=parseInt(b);if(a>b){var f=a;a=b;b=f}f=[];for(var g=!1;a<=b;a++){if(f.length>=c){g=!0;break}f.push(a)}return m(f,c,g,d,e)}function f(a,b,c,d,e,f){start=new Date(b);end=new Date(c);if(start&&end){start.getTime()>end.getTime()&&(b=start,start=end,end=b);b=[];c=!1;for(var g=start,k=!1,l,n=!1;g.getTime()<=end.getTime();){if(b.length>=d){c=!0;break}b.push(formatDate(g,ctrl.massCreateTimeRangeAction.dateFormat));if(a===lm.massCreateCategory_hourlyCreate)g.setHours(g.getHours()+
1);else if(a===lm.massCreateCategory_dailyCreate)g.setDate(g.getDate()+1);else if(a===lm.massCreateCategory_weeklyCreate)g.setDate(g.getDate()+7);else if(a===lm.massCreateCategory_monthlyCreate){var q=g.getDate(),p=g.getMonth(),r=g.getFullYear(),t=(p+1)%12;p=11==p?r+1:r;r=(new Date(p,t+1,0)).getDate();q>r?(g=new Date(p,t+1,0),k=!0,l=q):(g.setMonth(g.getMonth()+1),!0===k&&(g.setDate(l),k=!1))}else a===lm.massCreateCategory_yearlyCreate&&(q=g.getDate(),t=g.getMonth(),p=g.getFullYear(),1==t&&29==q&&
(n=!0),!0===n?g=new Date(p+1,t+1,0):g.setFullYear(g.getFullYear()+1))}return m(b,d,c,e,f)}}function g(a,b,c,d){if(a){var e=!1,f=[];ajaxget("/sims/massCreateQuery.jsp",{a:ap,group:a,limitCount:b,query:"getUsersFromGroup"},function(a){a=JSON.parse(a);f=a.users;e=a.outOflimitCount},!0);return m(f,b,e,c,d)}}function k(a,b,c,d){if(a){var e=!1,f=[];ajaxget("/sims/massCreateQuery.jsp",{a:ap,fieldDomainId:a,limitCount:b,query:"getOptionsFromFieldDomainId"},function(a){a=JSON.parse(a);f=a.options;e=a.outOflimitCount},
!0);return m(f,b,e,c,d)}}function l(a,b,c,d,e){if(a&&b){var f=a.sheetValue,g=f.lastIndexOf("/"),k=f.slice(0,g);f=f.slice(g+1);var l=!1,n=[];ajaxget("/sims/massCreateQuery.jsp",{a:ap,path:k,si:f,fieldDomainId:a.fieldValue,filterSeq:b.filterValue,limitCount:c,query:"getLinkSheetData"},function(a){a=JSON.parse(a);n=a.datas;l=a.outOflimitCount},!0);return m(n,c,l,d,e)}}function m(a,b,c,d,e){d=d||",";e=e||"...";return c?a.join(d)+e:a.join(d)}var n=ctrl.massCreateDefaultValueAction.result.result;switch(a){case lm.massCreateCategory_numbericRange:var q=
e(c,d,3," , ","...");break;case lm.massCreateCategory_hourlyCreate:case lm.massCreateCategory_dailyCreate:case lm.massCreateCategory_weeklyCreate:case lm.massCreateCategory_monthlyCreate:case lm.massCreateCategory_yearlyCreate:q=f(a,c,d,3," , ","...");break;case lm.massCreateCategory_group:q=g(c,3," , ","...");break;case lm.massCreateCategory_selectOption:q=k(c,3," , ","...");break;case lm.massCreateCategory_linkSheet:q=l(c,d,3," , ","...")}d=ctrl.massCreateDefaultValueAction.autogenArray;for(c=0;c<
d.length&&d[c].type!==a;c++);c!=d.length?0<b?(n[c].value=q,d[c].showValue=q):(n.splice(c,1),d.splice(c,1)):0<b&&(n.splice(0,0,{value:q}),d.splice(0,0,{type:a,showValue:q}));ctrl.massCreateDefaultValueAction.loadResult({result:n});ctrl.massCreateDefaultValueAction.renderActionBuilder($("massCreateDefaultValueDiv"))}function openMassCloneTabs(){floatWin(null,ctrl.massCloneTabsBuilder.text,lm.massClone_floatingTitle,!0,!1,!1);ctrl.massCloneTabsBuilder.openDiv()}
function executeMassClone(){var a={a:ap,p:path,si:sheetIndex,query:"checkCloneEntryMax"},b=getCheckedRootNodeIds();0<b.length&&(a.checkedNodeIds=JSON.stringify(b));postPromise("/sims/massCloneQuery.jsp",a).then(function(a){""===a?executeMassCloneScript():floatWinError(a)})}
function executeMassCloneScript(){var a={a:ap,p:path,si:sheetIndex},b=getCheckedRootNodeIds();0<b.length&&(a.checkedNodeIds=JSON.stringify(b));b=ctrl.massCloneFieldAction.result.result[0].fields;0<b.length&&(a.noCloneDomainIds=JSON.stringify(b));setTimeout(updateSystemTaskProgress,1E3);floatWinClose();postPromise("/sims/massClone.jsp",a).then(function(a){""===a?(inNUI(),clearListingPageCheckbox(),setTimeout(silentReload,300),ctrl.massCloneTabsBuilder.closeDiv()):($("floatingWin").style.display="",
$("massCloneMsgDiv").innerHTML=a,$("massCloneMsgDiv").style.display="")})}function openBatchExecTabs(){floatWin(null,ctrl.batchExecTabsBuilder.text,lm.batchExecute,!0,null,!1);ctrl.batchExecTabsBuilder.renderTabs($("floatingWinContent"))}function openMassEditTabs(){floatWin(null,ctrl.massEditTabsBuilder.text,lm.massEdit,!0,null,!1);ctrl.massEditTabsBuilder.renderTabs($("floatingWinContent"))}
function executeMassUpdateScript(){var a={a:ap,p:path,si:sheetIndex,c:JSON.stringify(ctrl.massUpdateActionBuilder.result)},b=getCheckedRootNodeIds();0<b.length&&(a.checkedNodeIds=JSON.stringify(b));postPromise("/sims/massEdit.jsp",a).then(function(a){""===a?(floatWinClose(),updateSystemTaskProgress(),clearListingPageCheckbox(),inNUI(),setTimeout(silentReload,300)):($("massUpdateMsgDiv").innerHTML=a,$("massUpdateMsgDiv").style.display="")})}
function executeMassReplaceScript(){var a={a:ap,p:path,si:sheetIndex,c:JSON.stringify(ctrl.massUpdateReplaceModeActionBuilder.result),replaceMode:!0},b=getCheckedRootNodeIds();0<b.length&&(a.checkedNodeIds=JSON.stringify(b));postPromise("/sims/massEdit.jsp",a).then(function(a){""===a?(floatWinClose(),updateSystemTaskProgress()):($("massUpdateMsgDiv").innerHTML=a,$("massUpdateMsgDiv").style.display="")})}function clearSig(){ctrl.signaturePad.clear();ctrl.signaturePad._isBackGroundEmpty=!0}
function massActionButtonExec(){rm($("massActionButtonErrorMsg"));var a=function(){var a=$("massActionButtonSelect");return a.options[a.selectedIndex].value}();a={a:ap,p:path,fn:sheet,bid:a};var b=getCheckedRootNodeIds();0<b.length&&(a.checkedNodeIds=JSON.stringify(b));postPromise("/sims/massActionButton.jsp",a).then(function(a){a=JSON.parse(a);a.isSuccess?(floatWinClose(),updateSystemTaskProgress()):$("massActionButtonErrorMsg").innerHTML=a.messages[0]})}
function massLockExec(){rm($("massLockErrorMsg"));var a=$("massLockSelect");a={a:ap,p:path,fn:sheet,lockValue:a.options[a.selectedIndex].value};var b=getCheckedRootNodeIds();0<b.length&&(a.checkedNodeIds=JSON.stringify(b));postPromise("/sims/massLockExec.jsp",a).then(function(a){a=JSON.parse(a);a.isSuccess?(floatWinClose(),updateSystemTaskProgress()):$("massLockErrorMsg").innerHTML=a.messages[0]})}
function massApprovalExec(a,b){if("approve"==a||"reject"==a){rm($("massApprovalErrorMsg"));a={a:ap,p:path,fn:sheet,act:a};var c=$("massApproval_comment").value;c&&(a.comment=c);b&&(a.pwd=$("massApproval_password").value);b=getCheckedRootNodeIds();0<b.length&&(a.checkedNodeIds=JSON.stringify(b));postPromise("/sims/massApprovalExec.jsp",a).then(function(a){a=JSON.parse(a);if(a.isSuccess){if(a.errorMessages&&0<a.errorMessages.length){for(var b="",c=0;c<a.errorMessages.length;c++)b=b+a.errorMessages[c]+
"<br>";b+="<br>";parent.document.getElementById("magic").value=floatWinWarning(b,null,null,!0);parent.document.getElementById("magic").click()}else floatWinClose();updateSystemTaskProgress()}else $("massApprovalErrorMsg").innerHTML=a.messages[0],floatWinClose()})}}function showNewsDetail(a){showMsg("/sims/newsRead.jsp?id="+a,350,!0,!0);$("whatsnewBubble")&&($("whatsnewBubble").style.display="none")}
function hideNewsDetail(a){$("newsDetail").style.right="-350px";showMsg("/sims/news.jsp",350,!0,!0)}function initSystemTaskProgress(){var a={a:ap};embed&&(a.embed=!0);getPromise("/sims/systemTaskProgress.jsp",a).then(JSON.parse).then(handleSystemTaskProgress.bind(null,!0)).catch(hideStpDiv)}function updateSystemTaskProgress(){var a={a:ap};embed&&(a.embed=!0);getPromise("/sims/systemTaskProgress.jsp",a).then(JSON.parse).then(handleSystemTaskProgress.bind(null,!1)).catch(hideStpDiv)}
function removeStp(a,b){var c=(new Date).getTime();b&&3E4<c-b||postPromise("/sims/systemTaskProgress.jsp",{a:ap,remove:a}).then(JSON.parse).then(handleSystemTaskProgress.bind(null,!1)).then(function(){hideStpDiv(a)}).catch(function(){hideStpDiv(a)})}function hideStpDiv(a){$("stpDiv"+a)&&($("stpDiv"+a).style.transform="scaleY(0)",setTimeout("$('stpDivWrapper').removeChild($('stpDiv"+a+"'));",500))}
function initStp(){if(!$("stpDivWrapper")){var a=node("div","stpDivWrapper","stpDivWrapper");document.body.appendChild(a)}}
function initStpInstance(a,b){if($("stpDivWrapper"))if($("stpDiv"+a))$("stpDiv"+a).style.transform=null;else{var c=node("div","stpDiv"+a,"stpDiv");$("stpDivWrapper").appendChild(c);b||(c.style.transform="scaleY(0)",setTimeout("$('stpDiv"+a+"').style.transform=null;",1));b=node("div","stpIcon"+a,"stpIcon");c.appendChild(b);b=node("div","stpMessage"+a,"stpMessage");c.appendChild(b);b=node("div","stpProgress"+a,"stpProgress");c.appendChild(b);b=node("div","stpClose"+a,"stpClose");b.innerHTML="<i class='fal fa-times'></i>";
b.onclick=function(){removeStp(a)};c.appendChild(b)}}
function handleSystemTaskProgress(a,b){initStp();for(var c=0;c<b.length;c++){var d=b[c],e=d.id;initStpInstance(e,a);if(d.done){var f="ERROR"!==d.status&&d.autoDisappear;switch(d.status){case "ERROR":var g="<i class='fa fa-times' style='color:#cc0000'></i>";break;default:g="<i class='fa fa-check' style='color:#29c529'></i>"}$("stpDiv"+e).classList.add("stpDone");$("stpIcon"+e).innerHTML=g;$("stpMessage"+e).innerHTML=d.message+(d.link?"<div><a href='javascript:void(0);' onclick=\""+d.link+'" >'+d.linkMsg+
"</a></div>":"");$("stpProgress"+e).innerHTML=d.progress?d.progress+lm.space+lm.records:"";biffdata.ifListingPage()&&updateSelectAllCheckbox();d.reloadReport&&reloadReport();a||(silentReload(),updateCountDiv());d=(new Date).getTime();f&&setTimeout(removeStp.bind(null,e,d),1E4)}else $("stpDiv"+e).classList.remove("stpDone"),$("stpIcon"+e).innerHTML.startsWith("<img")||($("stpIcon"+e).innerHTML="<img src='/sims/img/working.gif' />"),$("stpMessage"+e).innerHTML=d.message,$("stpProgress"+e).innerHTML=
d.progress?d.progress+lm.space+lm.records:"",ctrl.systemTaskProgressTimer=setTimeout(updateSystemTaskProgress,2E3,!0)}}function setSelectByValue(a,b,c){for(var d=a.options,e=!1,f=0;f<d.length;f++)d[f].value==b&&(a.selectedIndex=f,e=!0);c&&!e&&(c=node("OPTION"),c.value=b,c.innerHTML=b,a.appendChild(c),a.selectedIndex=d.length-1)}
function addUserCheckStub(){"DISTR"==window.licenseType?floatWinWarning("You reached the max amount of users licensed on your on-premises server. Please contact support@ragic.com if you need to purchase more users."):(floatWin(function(){return"/billing/s/moreUsers.jsp?a="+ap},null,null,!0),ctrl.floatWinCallback=quickBillUpdateUser)}
function modifyPlan(a){var b="1"!==$("months").options[$("months").selectedIndex].value?!0:!1,c=$("quantity").value;getPromise("/sims/validatePlanModification.jsp",{edition:window.edition,ap:ap}).then(function(d){d=JSON.parse(d);return d.msg?(floatWin(null,d.msg),a.selectedIndex=1,Promise.reject()):getPromise("/billing/s/modifyPlanBillingEquationLayout.jsp",{edition:window.edition,ifYearly:b,quantity:c,ap:ap})}).then(function(a){$("billingEquationContainer").innerHTML=a;"LITE2"==window.edition&&"NPOINTL9"===
tempCoupon&&(floatWin(null,lm.npoDiscountDeleted,""),tempCoupon="");updateCheckout()}).catch(function(){})}function removeRight(a,b){confirm("Are you sure you would like to remove it from entry manager?")&&ajaxget("/sims/removeRight.jsp",{a:ap,p:path,si:sheetIndex,key:biffdata.rootDomainId,rootNode:a,remove:b},loadInfo)}
function removeNotify(a,b){confirm("Are you sure you would like to remove it from notify list?")&&ajaxget("/sims/removeRight.jsp",{a:ap,p:path,si:sheetIndex,key:biffdata.rootDomainId,rootNode:a,remove:b,rmf:110},loadInfo)}function removeGuest(a,b){confirm("Are you sure you would like to remove it from temp log in list?")&&ajaxget("/sims/removeRight.jsp",{a:ap,p:path,si:sheetIndex,key:biffdata.rootDomainId,rootNode:a,remove:b,rmf:32},loadInfo)}
function doubleReloadSheet(){reloadSheet();window.setTimeout(reloadSheet,5E3)}function reloadSheet(a){mode==BROWSE&&ctrl.currentController.load(a?"&reset":"","",function(){mode==BROWSE&&(browse._init(),browse._focus())})}function getBundleString(a,b){if(null==lm[a])return a;if(null==b)return lm[a];a=lm[a];for(var c in b){var d=new RegExp("{["+c+"]}","g");a=Array.isArray(a)?a.map(function(a){return a.replace(d,b[c])}):a.replace(d,b[c])}return a}
function downloadBackup(a,b){switch(a){case 1:var c=lm.download1DayBackup;break;case 3:c=lm.download7DayBackup;break;case 7:c=lm.download14DayBackup;break;default:c=lm.backupTitle}floatWin(null,'<div style="margin:12px 12px 12px 12px"><div style="font-size:16px;font-weight:bold;margin:0 8px 8px 0;">'+c+'</div><input type="checkbox" id="backupDefOnly" style="margin:0 8px 8px 0;" /><label for="backupDefOnly">'+lm.backupDefOnly+'</label><br/><input type="checkbox" id="backupNoUploadFiles" style="margin:0 8px 8px 0;" /><label for="backupNoUploadFiles">'+
lm.noUpload+'</label><br/><input type="button" value="'+lm.download+'" onclick="_downloadBackup(\'/sims/backup.jsp?act=DLBK&btype='+(a+"&a="+b)+"')\" /></div>",null,!0)}function _downloadBackup(a){$("backupDefOnly").checked&&(a+="&defOnly");$("backupNoUploadFiles").checked&&(a+="&noUpload");location.href=a}
var vis=function(){var a,b={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(a in b)if(a in document){var c=b[a];break}return function(b){b&&document.addEventListener(c,b);return!document[a]}}();
function openZapier(){floatWin(null,lm.zapierSyncText+"<div id='zapierDiv' style='max-width: 900px;'></div>");var a=document.getElementById("zapierDiv"),b=document.createElement("SCRIPT");b.type="text/javascript";b.src="https://zapier.com/apps/embed/widget.js?services=ragic&limit=10&container=true&html_id=zapierDiv";a.appendChild(b);b.onload=positionFloatWin}
function unsubscribeWebhook(a){var b=a.target.closest("tr");a={url:b.querySelector(".webhookUrlTd").textContent,ap:ap,path:path,si:sheetIndex};postPromise("/sims/webhookUnsubscribe.jsp",a).then(JSON.parse).then(function(a){b.parentNode.removeChild(b)})}
function showAllWebhooks(){$("displayWebhooksButton").style.display="none";var a=$("webhookForm"),b=document.createElement("TABLE");b.id="webhooksTable";var c=document.createElement("TBODY");b.appendChild(c);a.appendChild(b);getPromise("/sims/webhooks.jsp",{ap:ap,path:path,si:sheetIndex}).then(JSON.parse).then(function(a){a.forEach(function(a){var b=c.insertRow(),d=b.insertCell();d.classList.add("webhookUrlTd");d.appendChild(document.createTextNode(a.url));a=document.createElement("I");a.classList.add("fas",
"fa-times","webhookDeleteIcon");a.onclick=unsubscribeWebhook;b.insertCell().appendChild(a)})})}
function subsribeWebhook(a){if(a)floatWin(null,'<div id="webhookForm"><div><table><tbody><tr><td>'+lm.webhookUrl+' : </td><td><input style="width:360px;" type="text" id="webhookUrl"></td></tr></tbody></table></div><span style="margin:12px 5px 12px 0;" class="topButtonWhole" onclick="subsribeWebhook(false);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.webhookSubscribeConfirm+
'</span><span style="margin:12px 8px 12px 8px;" class="topButtonWhole"  onclick="$(\'floatingWin\').style.display=\'none\';" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.cancel+'</span><span style="float:right;position:relative;top:20px;" id="displayWebhooksButton"><a href="javascript:void(0) " onclick="showAllWebhooks();">'+lm.showAllWebhooks+"</a></span></div>","",!0);else{a=
$("webhookForm");var b=$("webhookUrl").value;b&&(a.querySelector(".topButtonWhole").onclick=emptyFunction,postPromise("/sims/webhookSubscribe.jsp",{ap:ap,path:path,si:sheetIndex,url:b}).then(JSON.parse).then(function(a){floatWin(null,a.msg)}).catch(function(a){floatWin(null,JSON.parse(a.response).msg)}))}}function decHTML(a){return a&&"string"===typeof a?a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&apos;/g,"'").replace(/&quot;/g,'"'):a}
function encHTML(a){return a&&"string"===typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;"):a}function encHTMLTag(a){return a&&"string"===typeof a?a.replace(/&lt;/g,"&#60;").replace(/&gt;/g,"&#62;"):a}function decjs(a){return a?a.replace(/%27/g,"'").replace(/%22/g,'"'):a}function encjs(a){return a&&"string"===typeof a?a.replace(/'/g,"%27").replace(/"/g,"%22"):a}
function textToHTML(a){var b="";if(0<a.length){var c;for(c=0;c<a.length;c++)switch(a[c]){case "\n":"\n"===a[c+1]?(b+="</p>\n<p>",c++):b+="<br>";break;case " ":" "!=a[c-1]&&"\t"!=a[c-1]&&(b+=" ");break;case "\t":"\t"!=a[c-1]&&(b+=" ");break;case "&":b+="&amp;";break;case '"':b+="&quot;";break;case ">":b+="&gt;";break;case "<":b+="&lt;";break;default:b+=a[c]}}return b}function removeHTML(a){return a?a.replace(/<[^>]*>/gim,""):a}
function createTextLinks(a){return(a||"").replace(/(?:https?):(?:\/{1,3}|\\{1})[-a-zA-Z0-9:;,@#!%&()~_?\+=\/\\\.]*/g,function(a,c,d){return'<a href="'+a+'" target="_blank" rel="noopener noreferrer nofollow">'+a+"</a>"})}
function suggestion(){floatWin(null,'<textarea id="suggestionText" placeholder="'+lm.yourSuggestions+'" style="width:500px;height:180px;float:left;"></textarea><div onclick="sendSuggestion();" class="topButtonWhole" style="height:16px;margin:8px 8px 0 0;padding-left:30px;padding-right:30px;clear:left;">'+lm.submit+"</div>","",!0)}
function sendSuggestion(){ajaxpost("/sims/suggestion.jsp",{suggest:$("suggestionText").value},function(a){floatWinWarning("We have received your suggestion and will get back to you via e-mail.")})}function ifFreePack(){return"FREECRM"==window.edition}function otherReportingOptions(){floatWin(function(){return"/sims/report/templates/reportingOptions.jsp"})}
function homeEventConfigMenu(a,b){clearDropWin();cancelEventBubble(a);a=node("div");a.id="eventConfigMenu";a.className="eventConfigMenu";var c=b.eventObj,d=node("div");d.textContent=lm.hideEvent;d.onclick=function(){ajaxget("/sims/updateHomeConfig.jsp",{a:ap,action:"hideEvent",path:c.path,si:c.sheetIndex,dd:c.dd},function(){loadHomeEvents()})};a.appendChild(d);d=node("div");d.textContent=lm.setShortName;d.onclick=function(){var a=prompt(lm.setShortName,c.fn);ajaxget("/sims/updateHomeConfig.jsp",{a:ap,
action:"shortName",path:c.path,si:c.sheetIndex,name:a},function(){loadHomeEvents()})};a.appendChild(d);document.body.appendChild(a);d=findPos(b);a.style.top=d[1]+b.offsetHeight+"px";a.style.left=d[0]+b.offsetWidth+"px";floatingPanels.push(a)}function resendTempLogInEmail(a,b){confirm("Resend temp log in email?")&&(b&&(b.style.display="none"),ajaxget("/sims/resendTempLogIn.jsp",{a:ap,p:path,si:sheetIndex,em:a,ni:biffdata.rootNodeId},function(a){floatWinWarning(a)}))}
function isNumeric(a){return"string"===typeof a&&(a.includes("\n")||a.includes("\t"))?!1:!isNaN(a-parseFloat(a))}function checkIfOnline(){var a="https://www.ragic.com/sims/img/empty.gif?t="+Date.now(),b=new Image;b.onload=function(){ctrl.ifOnline=!0};b.onerror=function(){ctrl.ifOnline=!1};b.src=a}
var decodeEntities=function(){var a=document.createElement("div");return function(b){b&&"string"===typeof b&&(b=b.replace(/<script[^>]*>([\S\s]*?)<\/script>/gmi,""),b=b.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gmi,""),a.innerHTML=b,b=a.textContent,a.textContent="");return b}}();function decodeAllEntities(a){for(var b=0;b<a.length;b++)a[b]=decodeEntities(a[b])}window.groupNodeIds&&decodeAllEntities(window.groupNodeIds);
function unlinkAccount(a){var b=location.href.startsWith("https://localhost/")?"https://localhost/api/internal/main_unlinkAccount.jsp":"https://www.ragic.com/api/internal/main_unlinkAccount.jsp";ajaxget(b,{unlink:a},function(){location.href="/"})}
function checkRunningServiceByFormUrl(a,b){var c={ap:ap,serviceKey:ap+path+"/"+sheetIndex};b&&(c.type=b);postPromise("/sims/lock/checkRunningServiceByFormUrl.jsp",c).then(function(b){b=JSON.parse(b);var c=parseInt(b.count);if(0<c)b=decodeURIComponent(b.msg),floatWinWarning(b,!0),$("runningServiceForceExec").onclick=function(){$("floatingWinCloseIcon").click();a&&a()};else if(0===c)a&&a();else throw Error(b.msg);})}
function checkRunningServiceByAp(a){ajaxpost("/sims/lock/checkRunningServiceByAp.jsp",{ap:ap},function(b){b=JSON.parse(b);var c=parseInt(b.count);if(0<c)b=decodeURIComponent(b.msg),floatWinWarning(b,!0);else if(0==c)a&&a();else throw Error(b.msg);})}
function newSheetFromSubtable(a,b){var c=$("mystf"+b);if(0==c.options.length)floatWinWarning("You need to have at least one free text field saved on this sheet to generate a new sheet from subtable.");else{var d=function(){inNUI();$("floatingWin").style.display="none"};floatWin(null,"<p>"+lm.createNewSheet+'?</p><span id="createNewSheetOk" class="topButtonWhole" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.confirm_ok+'</span><span id="createNewSheetCancel" style="margin-left: 8px;" class="topButtonWhole" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.confirm_cancel+"</span></p>","",!0);$("createNewSheetOk").onclick=function(){d();postPromise("/sims/createSheetFromSubtable.jsp",{d:a,mystf:c.options[c.selectedIndex].value}).then(function(a){window.open(a,"_blank");return getPromise("/sims/v5frame/v6Tabs.jsp",
{a:ap,p:path,si:sheetIndex?sheetIndex:-1,callingBy:"newSheetFromSubtable",forceReload:!0})}).then(function(a){a&&($("tabsContainer").parentNode.innerHTML=a,ctrl.currentController.resize())})};$("createNewSheetCancel").onclick=d}}function checkKeywordReplace(a){if("tickets"===ap){var b=a.value;/{{.+}}/.test(b)&&ajaxget("/sims/mmailer/keywordReplace.jsp",{text:b},function(b){b=JSON.parse(b);a.value=b.result;a.selectionStart=b.start;a.selectionEnd=b.start+b.len},!0)}}
function toggleRightDockSetting(a,b){"true"!==RagicStorage.localStorage.getItem(a)?RagicStorage.localStorage.setItem(a,"true"):RagicStorage.localStorage.setItem(a,"false")}function unselectAllMappedFields(){Array.from(document.querySelectorAll("#excelUploadForm select")).forEach(function(a){a.classList.contains("importSubSelectionTitle")||(a.options[0].selected=!0)})}
function selectAbsolutelyMatchingFields(){var a=Array.from(document.querySelectorAll("#excelUploadForm .mappingHeaderName")),b=Array.from(document.querySelectorAll("#excelUploadForm select"));if(a.length!=b.length)throw Error("Length not match");for(var c=0;c<a.length;c++){var d=a[c].innerText.trim(),e=b[c];if(!e.classList.contains("importSubSelectionTitle")){for(var f=0,g=1;g<e.options.length;g++){var k=e.options[g].text.trim();if(d==k){f=g;break}}e.options[f].selected=!0}}}
function getRootNodeIdFromUrl(){var a=urlHashResolve(!0).split("/");if(5!==a.length)return-1;a=parseInt(a[4]);return isNaN(a)?-1:a}function loadUserInfo(){ajaxget("/sims/userPicker.jsp",{a:ap},function(a){try{window.userNodeIdEmail=JSON.parse(a)}catch(b){}},!0);ajaxget("/sims/userPickerAvatar.jsp",{a:ap},function(a){try{window.avatarList=JSON.parse(a)}catch(b){}},!0)}
function loadUserNames(){window.userNameEmail||ajaxget("/sims/userPickerNameEmail.jsp",{a:ap},function(a){if(a)try{window.userNameEmail=JSON.parse(a)}catch(b){}},!0)}function getAvatarHTMLByNodeId(a,b){window.userNodeIdEmail||loadUserInfo();return getAvatarHTMLByEmail(window.userNodeIdEmail[""+a],20,b)}
function getAvatarHTMLByEmail(a,b,c){window.avatarList||loadUserInfo();var d=window.avatarList[a];return d?"<img class='avatar' src='"+lm.cdn+"/sims/file.jsp?imageResize=100,100&fresize&a="+ap+"&f="+d+"'></img>":"support@ragic.com"==a||"api@ragic.com"==a||"reminder@ragic.com"==a?"<img style='width:"+.8*b+"px;margin:"+15*b/48+"px 0 0 "+6*b/48+"px;' src='"+lm.cdn+"/sims/img/logoRed_150x56.png'></img>":c?(a=c.split(" "),c=a[0].charAt(0).toUpperCase(),ifChinese(c)?'<div class="iniAva">'+c+"</div>":1==
a.length?'<div class="iniAva">'+c+"</div>":1<a.length?'<div class="iniAva">'+c+a[a.length-1].charAt(0).toUpperCase()+"</div>":"<i class='fas fa-user-circle' style='font-size:"+b+"px;color:#d8e1f1;'></i>"):"<i class='fas fa-user-circle' style='font-size:"+b+"px;color:#d8e1f1;'></i>"}var SYSCOLORS="#cc0000 #236FBD #049d57 #56458C #b0710a #00bbcc #cc00a8 #555555".split(" ");
function initAvatars(){var a=document.getElementsByClassName("iniAva");if(a&&a.length&&0<a.length)for(var b=0;b<a.length;b++){var c=a[b],d=c.parentNode;if(50<b)break;var e=d.clientWidth,f=d.clientHeight;c.style.fontSize=.45*e+"px";var g=c.clientWidth;g&&(c.style.top=(f-c.clientHeight)/2-1+"px",c.style.left=(e-g)/2+"px",c=(c=c.innerHTML)&&0<c.length?c.charCodeAt(0):7,d.style.background=SYSCOLORS[c%SYSCOLORS.length])}}
function initJSAvatar(){var a=document.getElementsByClassName("jsavatar");if(a&&a.length&&0<a.length){for(var b=0;b<a.length;b++){var c=a[b],d=c.getAttribute("email"),e=c.getAttribute("userName");c.innerHTML=getAvatarHTMLByEmail(d,40,e)}initAvatars()}}function enlargeComment(a,b,c){open("/sims/getComment.jsp?ap="+a+"&di="+b+"&ni="+c)}
function checkTheTypeOfAg(){var a=builder.cellData[currentBiff.x+","+currentBiff.y];a&&a.attr.ag&&(a.attr.ag.includes("{RAGIC_ID}")||a.attr.ag.includes("{SUBTABLE_RAGIC_ID}"))?floatWinWarning("Not Supported!"):floatWinSuccess("OK!")}function debouncedFn(a,b){var c=null;return function(){var d=this,e=arguments;c&&clearTimeout(c);c=setTimeout(function(){b.apply(d,e);c=null},a)}}
function throttledFn(a,b){var c=0;return function(){var d=(new Date).getTime();if(!(d-c<a))return c=d,b.apply(this,arguments)}}function getTodayNoTime(){var a=new Date;a.setHours(0);a.setMinutes(0);a.setMilliseconds(0);return a}function getBodyScrolltop(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0}function getBodyScrollleft(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0}
function getMinimumBrowserFontSize(){if(ctrl.minimumBrowserFontSize)return ctrl.minimumBrowserFontSize;var a=node("DIV");a.style.visibility="hidden";a.style.lineHeight="1";a.style.fontSize="8px";a.textContent="L";document.body.appendChild(a);var b=a.clientHeight;document.body.removeChild(a);return ctrl.minimumBrowserFontSize=b}function downloadHistory(){window.open("/sims/downloadHistory.jsp?a="+(ap+"&p="+path+"&si="+sheetIndex+"&ni="+biffdata.rootNodeId),"_blank")}
function changeUnarchiveIconToSpinIcon(){var a=$("unarchiveHistoryIcon");a.classList.remove("far","fa-info-circle");a.classList.add("fas","fa-spinner","fa-spin");a.onclick=function(){}}
function unarchiveHistory(a){a?ajaxpost("/sims/unarchiveHistory.jsp",{a:ap,pathSheet:path+"/"+sheetIndex+"_Sheet"+sheetIndex,ni:biffdata.rootNodeId},function(){updateSystemTaskProgress()}):floatWin(null,'<div id="downloadArchiveHistoryMainPart">'+lm.historyDownloadWarningMsg+'</div><div><span style="margin:12px 5px 12px 8px;" class="topButtonWhole" onclick="unarchiveHistory(true);$(\'floatingWin\').style.display=\'none\';changeUnarchiveIconToSpinIcon();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.download+
'</span><span style="margin:12px 8px 12px 8px;" class="topButtonWhole" onclick="$(\'floatingWin\').style.display=\'none\';" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.cancel+"</span></div>",null,!0)}function loadScript(a,b){var c=document.createElement("script");c.src=a;c.onload=function(){b&&b()};document.head.appendChild(c)}
function openExternalURL(a){var b=window.open();b.opener=null;b.location=a}function triggerActionButton(a,b){if(biffdata){var c=sheetIndex,d=getButtonUpdateRootNodeId(a);a={bId:a,api:""};rmlc&&(a.rmlc=rmlc);postPromise("/"+ap+path+"/"+c+"/"+d,a).then(b)}}function loadLinkNLoad(a,b,c,d){a&&b&&c&&checkRunningServiceByAp(function(){var e={a:a,p:b,si:c};d&&(e.d=d);ajaxget("/sims/dev/loadLinkNLoad.jsp",e,function(a){eval(a)})})}
function imageEXIFOrientation(a,b){a=new DataView(a);if(a.byteLength){if(65496!=a.getUint16(0,!1))return b(-2);for(var c=a.byteLength,d=2;d<c&&!(8>=a.getUint16(d+2,!1));){var e=a.getUint16(d,!1);d+=2;if(65505==e){if(1165519206!=a.getUint32(d+=2,!1))break;e=18761==a.getUint16(d+=6,!1);d+=a.getUint32(d+4,e);var f=a.getUint16(d,e);d+=2;for(var g=0;g<f;g++)if(274==a.getUint16(d+12*g,e))return b(a.getUint16(d+12*g+8,e))}else if(65280!=(e&65280))break;else d+=a.getUint16(d,!1)}return b(-1)}}
function srcToArrayBuffer(a){if(a)return fetch(a).then(function(a){return a.arrayBuffer()})}function imageOrientationRotate(a,b){if(!ctrl.isFF&&void 0===a.style.imageOrientation){var c=b||a.src,d=function(b){a.style.transform="rotate("+(3===b?180:6===b?90:8===b?-90:0)+"deg)"};ctrl.imageSrcBuffer[c]?imageEXIFOrientation(ctrl.imageSrcBuffer[c],d):srcToArrayBuffer(c).then(function(a){ctrl.imageSrcBuffer[c]=a;imageEXIFOrientation(a,d)})}}
function showTopMessage(a){$("topMessageDivContent").innerHTML=a;$("topMessageDiv").style.top=0}function closeTopMessage(){$("topMessageDiv").style.top="-50px"}
function clearOldLocalStorage(){for(var a=[],b=new Date,c=0;c<RagicStorage.localStorage.length();c++){var d=RagicStorage.localStorage.key(c);if(d.startsWith("templateJSONDate")){var e=getDateFromFormat(RagicStorage.localStorage.getItem(d),"yyyy/MM/dd");1728E5<b.getTime()-e&&(e=d.substring(16),a.push(d),a.push("templateJSON"+e))}d.startsWith("RAGIC_DRAFT_DATE")&&(e=new Date,e.setTime(parseInt(RagicStorage.localStorage.getItem(d))),1728E5<b.getTime()-e.getTime()&&(e=d.substring(16),a.push(d),a.push("RAGIC_DRAFT_HEADER"+
e),a.push("RAGIC_DRAFT_DATA"+e)))}for(c=0;c<a.length;c++)RagicStorage.localStorage.removeItem(a[c])}try{clearOldLocalStorage()}catch(a){}function transitionEndListener(a,b){a.addEventListener("transitionend",b);a.addEventListener("webkitTransitionEnd",b);a.addEventListener("oTransitionEnd",b)}
function massDeleteMsg(a){var b=function(){var a=$("quicklyDeleteCheckbox");$("quickDownloadWarningMsg").style.display=a&&a.checked?"":"none"};floatWin(null,"<div><div style='padding: 5px 5px 5px 10px;'>"+lm.deleteAll+"</div>"+(a?"<div style='padding: 10px 5px 5px 10px;'><input type='checkbox' name='quicklyDelete' id='quicklyDeleteCheckbox'><label for='quicklyDeleteCheckbox' style='padding: 0 0 0 5px;' >"+lm.quicklyDelete+'</label></div><div><div id="quickDownloadWarningMsg" style="display:none;padding:5px 5px 5px 10px;"><div>'+
lm.quicklyDeleteWarning1+"</div><ul><li>1. "+lm.quicklyDeleteWarning2+"</li><li>2. "+lm.quicklyDeleteWarning3+"</li><li>3. "+lm.quicklyDeleteWarning4+"</li><li>4. "+lm.quicklyDeleteWarning5+"</li></ul></div>":"")+'<span style="margin:12px 5px 12px 8px;" class="topButtonWhole" onclick="checkRunningServiceByFormUrl(deleteMultipleEntry);$(\'floatingWin\').style.display=\'none\';" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm["delete"]+'</span><span style="margin:12px 8px 12px 8px;" class="topButtonWhole"  onclick="cancelDelete();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.cancel+"</span></div></div>","",!0);$("quicklyDeleteCheckbox")&&($("quicklyDeleteCheckbox").onchange=b)}
function createMagicRecordLinkWin(){function a(){$("magicRecordLinkText").innerHTML="";$("rmlcHelp").style.display=c.checked?"none":""}if(0>biffdata.rootNodeId)deletedRecordPrompt();else if(validateUserFeatureAccess("magicShareEntry")){floatWin(null,"<div><div><h3>"+lm.rightsDesc+"</h3><input id='magicRecord_r' type='radio' name='right' style='margin: 0 5px 0 0; vertical-align:middle'"+("R"===biffdata.rights||biffdata.noedit?"checked":"")+"><label style='user-select: none' for='magicRecord_r'>"+lm.onlyRead+
"</label>"+("W"!==biffdata.rights||biffdata.noedit?"":"<input id='magicRecord_w' type='radio' name='right' style='margin: 0 5px 0 15px; vertical-align:middle' checked><label style='user-select: none' for='magicRecord_w'>"+lm.canWrite+"</label>")+"<label style='user-select: none; margin: 0 5px 0 20px;' for='magicRecord_expireDate'>"+lm.expireDate+"</label><input id='magicRecord_expireDate' type='number' value='7' style='width: 70px; margin: 0 5px 0 0;'>"+lm.expireDateUnit+"<div style='margin: 20px 0; max-width: 450px;'><span id='rmlcHelp' style='color: grey;line-height:1.7em'>"+
lm.magicRecordLinkHelpText+"</span></div><br><button class='topButtonWhole topButtonWholeLight' style='cursor:pointer; float: none;' onclick='createMagicRecordLink(this)'>"+lm.createMagicRecordLink+"</button></div><div style='padding-top:20px; align-items: center'><div id='magicRecordLinkText' style='display: flex; align-items: center'></div></div></div>","",!0);var b=$("magicRecord_w"),c=$("magicRecord_r");b&&(b.onchange=a);c.onchange=a;$("rmlcHelp").style.display=c.checked||!b?"none":""}}
function createMagicRecordLink(){var a="",b=$("magicRecord_expireDate").value;$("magicRecord_r").checked?a="r":$("magicRecord_w")&&$("magicRecord_w").checked&&(a="w");$("magicRecordLinkText").innerHTML="";ajaxget("/sims/createMagicRecordLink.jsp",{a:ap,p:path,si:sheetIndex,rw:a,expireDate:b},function(a){setTimeout(function(){a=a.trim();$("magicRecordLinkText").innerHTML="<input onclick='this.select()' id='magicLinkInput' style='width: 400px; height: 30px;border: 1px solid #bdbdbd; border-right:0' value='"+
a+"' readonly><button class='topButtonWhole topButtonWholeLight' style='cursor:pointer; float: none; height: 30px;border-top-left-radius: 0; border-bottom-left-radius: 0;' onclick=\"copyLink($('magicLinkInput'))\">"+lm.copy+"</button>"},100)},!0)}function createLineShareWin(){0>biffdata.rootNodeId?deletedRecordPrompt():validateUserFeatureAccess("magicShareEntry")&&createShareWin(function(a){return"https://social-plugins.line.me/lineit/share?url="+encodeURIComponent(a)})}
function createWhatsAppShareWin(){0>biffdata.rootNodeId?deletedRecordPrompt():validateUserFeatureAccess("magicShareEntry")&&createShareWin(function(a){return"https://wa.me/?text="+encodeURIComponent(a)})}
function createShareWin(a){var b=[];b.push(createElement("p",{children:[lm.share_way]}));var c={link:{text:lm.share_link,toolTipMsgPropertyName:"share_toolTipQ_link",rw:""},readOnlyTemporarilyLink:{text:lm.share_readOnlyTemporarilyLink,toolTipMsgPropertyName:"share_toolTipQ_readOnlyTemporarilyLink",rw:"r"}};"W"!==biffdata.rights||biffdata.noedit||(c.editableTemporarilyLink={text:lm.share_editableTemporarilyLink,toolTipMsgPropertyName:"share_toolTipQ_editableTemporarilyLink",rw:"w"});var d={},e;for(e in c)d.$jscomp$loop$prop$id$47$546=
e,b.push(createElement("div",{attrs:{style:"margin: 8px 0;display: flex;align-items: center;"},children:[createElement("input",{attrs:{type:"radio",name:"selectLinkType",id:d.$jscomp$loop$prop$id$47$546,style:"margin-right:5px;","data-rw":c[d.$jscomp$loop$prop$id$47$546].rw},callback:function(a){return function(b){"link"===a.$jscomp$loop$prop$id$47$546&&b.setAttribute("checked","");b.addEventListener("change",function(){toggleExpireDateBlock(this)})}}(d)}),createElement("label",{attrs:{for:d.$jscomp$loop$prop$id$47$546},
children:[c[d.$jscomp$loop$prop$id$47$546].text]}),createElement("a",{attrs:{class:"tooltipQ",style:"margin-top: 4px;"},callback:function(a){return function(b){b.addEventListener("click",function(){showSingleTooltip(this,c[a.$jscomp$loop$prop$id$47$546].toolTipMsgPropertyName,!1,!0,!1,!0,!1,"link"!==a.$jscomp$loop$prop$id$47$546?null:["<a href="+lm.share_toolTipQ_Link_link+" target='_blank'' style='color:#8FB4FF;cursor:pointer;'>"+lm.share_correspondLink+"</a>"])})}}(d),children:[node("i",null,"fas fa-question")]})]})),
d={$jscomp$loop$prop$id$47$546:d.$jscomp$loop$prop$id$47$546};b.push(createElement("div",{attrs:{id:"shareHelp",style:"display: none; color: grey; padding: 8px 0;"},callback:function(a){a.innerHTML=lm.magicRecordLinkHelpText}}));b.push(createElement("button",{attrs:{class:"topButtonWhole topButtonWholeLight",style:"margin-top: 8px;"},callback:function(b){b.addEventListener("click",function(){share(a)})},children:[lm.share]}));var f=createElement("div",{attrs:{id:"shareWin"},children:b});floatWin(function(){var a=
$("floatingWinContent");a.replaceChild(f,a.firstChild)},"\u00a0",null,!0)}function validateUserFeatureAccess(a){return access?access[a]:!0}
function toggleExpireDateBlock(a){var b=a.parentElement,c=$("expireDateBlock");"link"!==a.id?(c?"none"===c.style.display&&(c.style.display=""):c=createElement("div",{attrs:{id:"expireDateBlock",style:"height: 14px;position: relative;top: -5px;left: 50px;"},children:[lm.expireDate,createElement("input",{attrs:{id:"expireDate",type:"number",style:"width: 72px;height: 24px;margin: 0 8px;",value:"7",min:"1"}}),lm.day]}),b.appendChild(c)):c&&(c.style.display="none");$("shareHelp").style.display="editableTemporarilyLink"===
a.id?"":"none"}
function share(a){var b=document.querySelectorAll("#shareWin input[type=radio]");b=Array.apply(null,b);var c=$("expireDate");c=c?c.value:-1;var d="";b.forEach(function(a){a.checked&&(d=a.dataset.rw)});""===d?(b=a(location.href),window.open(b,"_blank","top=200,left=500,width=550,height=500")):getPromise("/sims/createMagicRecordLink.jsp",{a:ap,p:path,si:sheetIndex,rw:d,expireDate:c}).then(function(b){b&&(b=a(b.trim()),window.open(b,"_blank","top=200,left=500,width=550,height=500"))})}
function copyLink(a){a.select();document.execCommand("Copy")}function onTemplatePage(){return 9999<parseInt(sheetIndex)}function switch2fa(){event.preventDefault();postPromise("/sims/2fa/2fa.jsp",{a:ap}).then(function(a){$("floatingWin2faContent").innerHTML=a;$("floatingWin2fa").style.display=""})}
function resizeImage(a,b){var c=a.name,d=c.substring(c.lastIndexOf(".")+1);return new Promise(function(c,f){b.ip.IPType!==GRAPHICS||b.hasAttribute("keepOriginalSize")?c(a):readBlobAsDataURL(a).then(function(b){if("png"===d||"jpg"===d||"jpeg"===d||"webp"===d){var e=new Image;e.onload=function(){var b=document.createElement("canvas"),f=e.width,g=e.height;if(1920<=f&&1920>g)g*=1920/f,f=1920;else if(1920>f&&1920<=g)f*=1920/g,g=1920;else if(1920<=f&&1920<=g)f>=g?(g*=1920/f,f=1920):(f*=1920/g,g=1920);else{c(a);
return}b.width=f;b.height=g;b.getContext("2d").drawImage(e,0,0,f,g);b=b.toDataURL("png"===d?"":"webp"===d?"image/webp":"image/jpeg");b=dataURLToBlob(b);c(b.size<a.size?b:a)};e.src=b}else c(a)})})}function dataURLToBlob(a){if(a.includes(";base64,")){var b=a.split(";base64,");a=b[0].split(":")[1];b=window.atob(b[1]);for(var c=b.length,d=new Uint8Array(c),e=0;e<c;++e)d[e]=b.charCodeAt(e);return new Blob([d],{type:a})}a=a.split(",");b=a[0].split(":")[1];return new Blob([a[1]],{type:b})}
function openSMSdetails(){cancelEventBubble(event);postPromise("/sims/mmailer/smsDetails.jsp").then(function(a){$("floatingWinSMSDetailsContent").innerHTML=a;$("floatingWinSMSDetails").style.display=""})}function goToVersion(a){location.href=a+(0<=biffdata.rootNodeId?"/"+biffdata.rootNodeId:"")}function fixSelection2Free(a,b){ajaxget("/sims/dev/fixSelection2Free.jsp",{a:ap,key:a,free:b},function(){fieldAnalyze()})}
function dedup(){ajaxget("/sims/dev/dedup.jsp",{a:ap,p:path,si:sheetIndex,action:"dedup"},function(){fieldAnalyze()},!0)}function unshelf(a){ajaxget("/sims/shelf.jsp",{a:a,action:"unshelf"},function(a){updateSystemTaskProgress()})}
function mailSuggestion(a,b,c){if("function"!==typeof b)console.warn("no suggestion callback");else{var d=["hotmail.com","gmail.com","aol.com","ragic.com","gov.taipei"],e=RagicStorage.localStorage.getObjectItem("mailSugDomain",[]);d=d.concat(e);Mailcheck.run({email:a,domains:d,topLevelDomains:["com","net","org","eco"],suggested:function(c){b(c.full,a)},empty:function(){"function"===typeof c&&c()}})}}
function addMailDomainToLocalStorage(a){a=a.substring(a.lastIndexOf("@")+1);var b=RagicStorage.localStorage.getObjectItem("mailSugDomain",[]);RagicStorage.localStorage.setObjectItem("mailSugDomain",b.concat([a]))}function ifEmailValid(a){return/.+@.+\..+/.test(a)}function addEvent(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c)}
function add_optgr(a,b){var c=b.options.length,d=document.createElement("OPTGROUP");!1!==b.groupLabel&&(d.label=b.groupLabel);for(var e=0;e<c;++e){var f=document.createElement("OPTION");f.textContent=b.options[e].name;f.value=b.options[e].value;!1!==b.groupLabel?d.appendChild(f):a.appendChild(f)}!1!==b.groupLabel&&a.appendChild(d);return d}function build_select(a,b){for(var c=0;c<b.length;c++)add_optgr(a,b[c])}
function tabOnMouseOver(a,b,c){window.userProperties&&"false"!==window.userProperties.pathTabHoverShowDropWin?mDropWin(a,$("pathDrop"+b),null,!1,100,3):closeDropWin($("pathDrop"+b));c&&(a.children[a.children.length-1].children[0].style.visibility="visible")}function tabOnMouseLeave(a,b,c){mDropWin(a,$("pathDrop"+b),!0,!1);c&&(a.children[a.children.length-1].children[0].style.visibility="hidden")}
function $create(a,b,c){b=b||{};c=c||"";var d=document.createElement(a||"div");Object.keys(b).forEach(function(a){return d.setAttribute(a,b[a])});d.textContent=c;return d}function shareThisSheet(a){floatWin(function(){return"/sims/shareThisSheet.jsp?a="+ap+"&p="+path+"&si="+sheetIndex+"&type="+a},null,lm.shareThisSheet,!0)}
function enterAuthorizationCodeFloatWin(a){floatWin(function(){document.getElementById("floatingWin").style["max-width"]="500px"},'<div style="display:flex;justify-content: space-between"><input style="display: none" id="authorizationCodeTemplateId" value="'+a+'"/><input class="authorizationCodeInput" id="authorizationCodeInput1" name="code1" onpaste="authorizationCodePaste();" maxlength="5"/><span class="codeDash">-</span><input class="authorizationCodeInput" id="authorizationCodeInput2" name="code2" maxlength="5"/><span class="codeDash">-</span><input class="authorizationCodeInput" id="authorizationCodeInput3" name="code3" maxlength="5"/><span class="codeDash">-</span><input class="authorizationCodeInput" id="authorizationCodeInput4" name="code4" maxlength="5"/><span class="codeDash">-</span><input class="authorizationCodeInput" id="authorizationCodeInput5" name="code5" maxlength="5"/></div><div class="topButtonWhole topButtonBlue" style="margin: 12px 0 0 3px;float:left;" onclick="submitAuthorizationCode();">'+
lm.sendCode+"</div>",lm.partnerCenter_enterAuthorizationCodeDesc,!0)}function authorizationCodePaste(){event.clipboardData.getData("text/plain").split("-").forEach(function(a,b){$("authorizationCodeInput"+(b+1)).value=a});event.preventDefault()}
var submitAuthorizationCode=throttledFn(1E3,function(){var a={};a.code=$("authorizationCodeInput1").value+"-"+$("authorizationCodeInput2").value+"-"+$("authorizationCodeInput3").value+"-"+$("authorizationCodeInput4").value+"-"+$("authorizationCodeInput5").value;a.userId=user;a.ap=ap;a.templateId=$("authorizationCodeTemplateId").value;postPromise("/partners/processAuthorizationCode.jsp",a).then(JSON.parse).then(function(a){a.hasOwnProperty("errorMsg")||window.location.reload()})});
function configWebEmbedForm(){floatWinClose();showFloatingMain("mfEmbed","/sims/webview/config/index.jsp?caction=checkRight&&rightCheck=1&type=form&url="+location.host+"/"+ap+path+"/"+sheetIndex,"embedConfigIframe")}
function submitRecoveryFilter(a){var b=$("recoverySheetFilter"),c=$("recoveryStartDateFilter"),d=$("recoveryEndDateFilter"),e=$("recoveryEditorFilter"),f=$("recoveryKeywordFilter"),g=$("recoveryDataUrlFilter");b=""!==b.value?"&ps="+b.value:"";c=0<c.value.length?getDateFromFormat(c.value,"yyyy/MM/dd"):"";d=0<d.value.length?getDateFromFormat(d.value,"yyyy/MM/dd"):"";e=""!==e.value?"&editor="+e.value:"";f=""!==f.value?"&kw="+f.value:"";g=""!==g.value?"&dataUrl="+encodeURIComponent(g.value):"";a.innerText=
"";a.appendChild(node("i",null,"fas fa-spinner fa-spin"));a.classList.remove("topButtonWholeLight");a.style.pointerEvents="none";location.href="/"+ap+"/data?recycle"+b+(0<c.toString().length?"&dts="+c:"")+(0<d.toString().length?"&dte="+d:"")+e+f+g}
function initBarcodeScanner(a,b,c,d){b.contains(document.getElementById("barcodeScanner"))&&(document.getElementById("barcodeScanner").srcObject.getTracks().forEach(function(a){a.stop()}),b.removeChild(document.getElementById("barcodeScanner")));d&&($("buttonDiv").style.visibility="hidden");$("scannedValue").value="";$("scanResponse").style.visibility="hidden";$("scannedValue").class="";$("scanResponse").innerHTML="";$("executeResponse").style.visibility="hidden";$("executeResponse").class="";$("executeResponse").innerHTML=
"";$("CameraDiv").style.display="";var e=0;navigator.mediaDevices.enumerateDevices().then(function(a){a.forEach(function(a){"videoinput"===a.kind&&e++});1<e&&($("CameraDiv").style.display="")});var f=node("video","barcodeScanner","barcodeScanner");b.appendChild(f);navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:c}},audio:!1}).then(function(b){f.srcObject=b;f.onloadedmetadata=function(b){f.play();ctrl.barcodeScannerRunning=
a;setTimeout(runBarcodeScanner,100)}})}function runBarcodeScanner(){var a=$("barcodeScanner");a&&(new BarcodeDetector({formats:["qr_code"]})).detect(a).then(function(b){for(;0<b.length;){b=b[0];ctrl.barcodeScannerRunning(b.rawValue);ctrl.barcodeScannerRunning=null;break}a&&ctrl.barcodeScannerRunning&&setTimeout(runBarcodeScanner,100)})}
function contiuneBarcodeScan(){setTimeout(function(){$("scannedValue").value="";$("scanResponse").style.visibility="hidden";$("scanResponse").class="";$("scanResponse").innerHTML="";$("executeResponse").style.visibility="hidden";$("executeResponse").class="";$("executeResponse").innerHTML="";ctrl.barcodeScannerRunning=barcodeCallback;setTimeout(runBarcodeScanner,100)},3E3)}
function translate2FontSizeRate(a){a=parseInt(a);if(!isNaN(a))return 2<a&&(a=2),-2>a&&(a=-2),((0<a?2+a:2)/(0>a?2-a:2)).toFixed(2)}function renderSheetFontSizeByRate(a){for(var b=biffdata.biffs,c=0;c<b.length;++c){var d=b[c];d=nui.getcell(d.x,d.y);var e=parseInt(d.dataset.fontSize);d.style.fontSize=Math.floor((0<e?e:13)*a)}}function updatePersonalSettingFontSize(a,b){if(a=translate2FontSizeRate(a)){var c=$("userpref_fontSizeRateLabel");c&&(c.textContent=a+"X");b||renderSheetFontSizeByRate(a)}}
function curry(a){var b=a.length;return function d(){var e=arguments;return e.length>=b?a.apply(this,Array.from(e)):function(){return d.apply(this,Array.from(e).concat(Array.from(arguments)))}}}
function debounceProcessLastEditDefaultValue(a,b){var c=null;return function(d,e){if(canSaveData()&&!biffdata.loadingLastEditDefaultValue){var f=this,g=arguments;if(b){if(c){var k=c.split("_");k[1]==e.domainId&&k[2]==e.x&&k[3]==e.y&&clearTimeout(k[0])}c=setTimeout(function(){a.apply(f,g);c=null},b)+"_"+e.domainId+"_"+e.x+"_"+e.y}else a.apply(f,g)}}}
function _processLastEditDefaultValue(){if(canSaveData()&&2===arguments.length)try{var a=arguments[0],b=arguments[1];if(b&&biffdata.ifSubtableDataBiff(b)){if(!a||0<=b.parentNodeId)biffdata.ifListingPage()||(biffdata.loadAllLastEditTimeDefaultValues(),biffdata.loadLastEditUserDefaultValue||biffdata.loadAllLastEditUserDefaultValues()),biffdata.loadSameSubtableRowLastEditDefaultValue(b),biffdata.loadLastEditUserDefaultValue=!0}else biffdata.loadAllLastEditTimeDefaultValues(),biffdata.loadLastEditUserDefaultValue||
biffdata.loadAllLastEditUserDefaultValues(),biffdata.loadLastEditUserDefaultValue=!0}catch(c){processJSExceptionObj(c)}}var curriedDebouncProcessLastEditDefaultValue=curry(debounceProcessLastEditDefaultValue),curriedProcessLastEditDefaultValue=curriedDebouncProcessLastEditDefaultValue(_processLastEditDefaultValue),keyupLoadLastEditDefaultValue=curriedProcessLastEditDefaultValue(300),loadLastEditDefaultValue=curriedProcessLastEditDefaultValue(null);
function processLastEditDefaultValue(a,b){canSaveData()&&(b&&b.keyup?keyupLoadLastEditDefaultValue(a,b):loadLastEditDefaultValue(a,b))}function escapeRegExp(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}
var DebugToolObj={inited:!1,debugToolDiv:null,topToolDiv:null,stopShowInfoDiv:null,showDomainIdDiv:null,showNodeIdDiv:null,showHeaderAttrDiv:null,zoomOutTimer:null,init:function(){-1!==window.location.search.toLowerCase().indexOf("debugtoolopen")&&RagicStorage.localStorage.setObjectItem("debug_toolOpen",!0);this.hasAuthority()&&RagicStorage.localStorage.getObjectItem("debug_toolOpen",!1)&&!this.inited&&(this.inited=!0,this.renderDebugToolContent(),this.refreshStopShowInfo(this.getStopShowInfo()),
this.refreshShowDomainId(RagicStorage.localStorage.getObjectItem("debug_showDomainId",!1)),this.refreshShowNodeId(RagicStorage.localStorage.getObjectItem("debug_showNodeId",!1)),this.refreshShowAttr(RagicStorage.localStorage.getObjectItem("debug_showAttr",!1)))},renderDebugToolContent:function(){var a=node("div","debugToolDiv");a.style.width="0px";a.style.height="0px";a.style.position="fixed";a.style.left="0px";a.style.bottom="0px";a.style.border="solid";a.style.background="gray";a.style.borderRadius=
"8px";a.onmouseleave=this.mouseLeave.bind(this);a.onmouseenter=this.mouseEnter.bind(this);this.debugToolDiv=a;var b=node("div","topToolDiv");b.style.width="auto";b.style.height="25px";b.style.background="silver";b.style.marginBottom="20px";b.style.textAlign="center";var c=node("span","stopShowInfoDiv","fal fa-lock");c.title="\u505c\u6b62\u986f\u793a\u6240\u6709\u8cc7\u8a0a";c.style.width="30px";c.style.height="20px";c.style.position="absolute";c.style.right="30px";c.style.cursor="pointer";b.appendChild(c);
c.onclick=this.clickStopShowInfo.bind(this);this.stopShowInfoDiv=c;c=node("span","closeDebugTool","fa fa-angle-down");c.title="\u7e2e\u5c0f";c.style.width="30px";c.style.height="20px";c.style.position="absolute";c.style.right="0px";c.style.cursor="zoom-out";b.appendChild(c);c.onclick=this.zoomOut.bind(this);this.topToolDiv=b;c=node("div","showDomainIdDiv");c.textContent="\u986f\u793a\u6b04\u4f4dDomainId";c.style.width="fit-content";c.style.marginBottom="10px";c.style.cursor="pointer";c.onclick=this.clickShowDomainId.bind(this);
this.showDomainIdDiv=c;var d=node("div","showNodeIdDiv");d.textContent="\u986f\u793a\u8cc7\u6599\u6b04\u4f4dNodeId";d.style.width="fit-content";d.style.marginBottom="10px";d.style.cursor="pointer";d.onclick=this.clickShowNodeId.bind(this);this.showNodeIdDiv=d;var e=node("div","showHeaderAttr");e.textContent="\u986f\u793a\u6b04\u4f4dAttr\u5c6c\u6027";e.style.width="fit-content";e.style.marginBottom="10px";e.style.cursor="pointer";e.onclick=this.clickShowAttr.bind(this);this.showHeaderAttrDiv=e;a.appendChild(b);
a.appendChild(c);a.appendChild(d);a.appendChild(e);$("v5Body").appendChild(a)},clickShowDomainId:function(){var a=!RagicStorage.localStorage.getObjectItem("debug_showDomainId",!1);this.refreshShowDomainId(a);RagicStorage.localStorage.setObjectItem("debug_showDomainId",a);silentReload()},refreshShowDomainId:function(a){this.showDomainIdDiv.style.color=a?"blue":"black"},ifShowDomainId:function(){return!this.hasAuthority()||this.getStopShowInfo()?!1:RagicStorage.localStorage.getObjectItem("debug_showDomainId",
!1)},clickShowNodeId:function(){var a=!RagicStorage.localStorage.getObjectItem("debug_showNodeId",!1);this.refreshShowNodeId(a);RagicStorage.localStorage.setObjectItem("debug_showNodeId",a);silentReload()},refreshShowNodeId:function(a){this.showNodeIdDiv.style.color=a?"blue":"black"},ifShowNodeId:function(){return!this.hasAuthority()||this.getStopShowInfo()?!1:RagicStorage.localStorage.getObjectItem("debug_showNodeId",!1)},clickShowAttr:function(){var a=!RagicStorage.localStorage.getObjectItem("debug_showAttr",
!1);this.refreshShowAttr(a);RagicStorage.localStorage.setObjectItem("debug_showAttr",a);silentReload()},refreshShowAttr:function(a){this.showHeaderAttrDiv.style.color=a?"blue":"black"},ifShowAttr:function(){return!this.hasAuthority()||this.getStopShowInfo()?!1:RagicStorage.localStorage.getObjectItem("debug_showAttr",!1)},hasAuthority:function(){return!!window.user&&user.toLowerCase().endsWith("@ragic.com")},clickStopShowInfo:function(){var a=!this.getStopShowInfo();this.refreshStopShowInfo(a);RagicStorage.localStorage.setObjectItem("debug_stopShowInfo",
a);silentReload()},refreshStopShowInfo:function(a){a?(this.stopShowInfoDiv.className="fal fa-lock-open",this.stopShowInfoDiv.title="\u986f\u793a\u6240\u6709\u8cc7\u8a0a"):(this.stopShowInfoDiv.className="fal fa-lock",this.stopShowInfoDiv.title="\u66ab\u6642\u505c\u6b62\u986f\u793a\u6240\u6709\u8cc7\u8a0a")},getStopShowInfo:function(){return RagicStorage.localStorage.getObjectItem("debug_stopShowInfo",!1)},closeDebugTool:function(){$("v5Body").removeChild(this.debugToolDiv);this.reset()},reset:function(){this.inited=
!1},mouseLeave:function(){this.zoomOutTimer=setTimeout(this.zoomOut.bind(this),3E3)},zoomOut:function(){this.debugToolDiv.style.height="0px";this.debugToolDiv.style.width="0px"},mouseEnter:function(){null!==this.zoomOutTimer&&clearTimeout(this.zoomOutTimer);this.zoomIn()},zoomIn:function(){this.debugToolDiv.style.width="400px";this.debugToolDiv.style.height="200px"}};DebugToolObj.init();
function bulkDownload(){var a="/sims/bulkDownload.jsp?a="+ap+"&p="+path+"&si="+sheetIndex,b=BarSelectAgent.getSelector("bulkDownloadDomainSelector").getOption();if(0!==b.length){var c=NODOMAIN.toString(),d=NODOMAIN.toString();if(BarSelectAgent.hasSelector("domainSelector")&&BarSelectAgent.hasSelector("mappingKeySelector")){var e=BarSelectAgent.getSelector("domainSelector"),f=BarSelectAgent.getSelector("mappingKeySelector");c=e.getOption().value;d=f.getOption().value}var g={};b.forEach(function(a){a=
a.value.split(",");var b=2===a.length?a[1]:biffdata.rootDomainId.toString();g.hasOwnProperty(b)||(g[b]={downloadFields:[],mappingKey:b===c?d:NODOMAIN.toString()});g[b].downloadFields.push(a[0])});var k="";Object.keys(g).forEach(function(a){var b=g[a];k&&(k+="|");k+=a+","+b.mappingKey+","+b.downloadFields.join(",")});a+="&di="+encodeURIComponent(k);b=$("dlSize1").checked?$("dlSize3").value:1E4;isNumeric(b)&&(a+="&size="+b);window.location=a}}
function processMappingKeyFieldContent(a){var b=BarSelectAgent.getSelector("bulkDownloadDomainSelector"),c=document.querySelector("#bulkDownloadInfo .kfContent"),d=NODOMAIN.toString(),e=NODOMAIN.toString();if(BarSelectAgent.hasSelector("domainSelector")){var f=BarSelectAgent.getSelector("domainSelector").getOption();f&&(d=f.value);BarSelectAgent.removeSelector("domainSelector")}if(BarSelectAgent.hasSelector("mappingKeySelector")){if(f=BarSelectAgent.getSelector("mappingKeySelector").getOption())e=
f.value;BarSelectAgent.removeSelector("mappingKeySelector")}c.innerHTML="";var g=biffdata.rootDomainId.toString(),k=[];b.getOption().forEach(function(a){a.value.includes(",")?(a=a.value.split(",")[1],k.includes(a)||k.push(a)):k.includes(g)||k.push(g)});var l=[];l.push({value:NODOMAIN.toString(),text:"",selected:NODOMAIN.toString()===d});k.forEach(function(b){var c=a.fields;b!==g?(c=c["stid"+b],c=lm.newSubtableDefault+"("+c.name+") "):c=lm.Independentfields+" ";l.push({value:b,text:c,selected:b===
d})});var m=createElement("div",{class:"kfBlock flex-center"});b=BarSelectAgent.createSelector("domainSelector",l,m,{});0===b.getSelectedOptionLength()&&0<b.options.length&&b.setOption(b.options[0]);f=createElement("span",{class:"bulkDownloadDesc",style:"margin: 0 8px 0 10px;",children:lm.bulkDownloadMappingFileKF+": "});m.appendChild(f);e={selectedDomainBefore:d,selectedMappingKeyBefore:e,currentSelectedDomain:b.getOption().value};updateMappingKeySelector(m,a,e);c.appendChild(m);b.setAfterSelectOption(function(){var b=
{currentSelectedDomain:this.getOption()?this.getOption().value:NODOMAIN.toString()};updateMappingKeySelector(m,a,b)})}
function updateMappingKeySelector(a,b,c){var d=c.selectedMappingKeyBefore,e=c.currentSelectedDomain;c=e===c.selectedDomainBefore;BarSelectAgent.hasSelector("mappingKeySelector")&&BarSelectAgent.removeSelector("mappingKeySelector");var f=a.querySelector("#mappingKeySelector");f&&f.remove();f=[];var g=biffdata.rootDomainId.toString();if(e!==NODOMAIN.toString()){b=b.fields;e!==g&&(b=b["stid"+e]);for(var k in b)k.startsWith("fid")&&(e=b[k],g=e.type,g!==UPLOADER&&g!==GRAPHICS&&(g=k.slice(3,k.length),f.push({value:g,
text:e.name,selected:c&&g===d})))}else f.push({value:NODOMAIN.toString(),text:"",selected:!0});a=BarSelectAgent.createSelector("mappingKeySelector",f,a,{});0===a.getSelectedOptionLength()&&0<a.options.length&&a.setOption(a.options[0])}function getDownloadFromBackupPanel(){var a="";read(function(b){a=b.responseText},"/sims/downloadFromBackupPanel.jsp?a="+ap+"&path="+path+"&si="+sheetIndex,!0);return a}
function startHistoryReserver(a){var b=$("reserverTargetSelecter"),c=0<b.selectedIndex,d=c?b.options[b.selectedIndex].dataset.loc:"",e,f=$("reserveTime");f.value&&(e=(new Date(f.value)).getTime());location.href="/sims/dev/historyReverser.jsp?a="+ap+"&p="+path+"&si="+sheetIndex+(c?"&sk="+b.value+"&loc="+d+"&o"+(a?"&getOld":""):"")+(e?"&ts="+e:"")}
function getBulkDownloadPanel(){var a;return'<div id="bulkDownloadPanel"><div id="bulkDownloadInfo" style="margin: 0 2px 10px 9px;"><div id="dataDlSettingPanel" style="margin:0;"><table style="margin: 0 0 5px 0;"><tr class="flex-center"><td class="bulkDownloadDesc flex-center" style="padding: 5px 5px 5px 0;">'+lm.downloadSize+':</td><td class="flex-center"><input type="radio" name="dlSize" id="dlSize1" checked/><label for=dlSize1>'+lm.downloadSize1+' <input type="text" name="dlSize3" id="dlSize3" size="6" value="1000" /> '+
lm.downloadSize3+'</label></td><td class="flex-center"><input type="radio" name="dlSize" id="dlSize2" /><label for=dlSize2>'+lm.downloadSize2+'</label></td></tr></table></div><div class="flex-center"><span class="bulkDownloadDesc" style="margin-right: 8px;">'+lm.bulkDownloadDesc+":  </span>"+function(){var b='<select name="bulkDownloadDomain" multiple style="display: none;">';read(function(c){a=JSON.parse(c.responseText);var d=a.fields,e=!0,f="";Object.getOwnPropertyNames(d).forEach(function(a){if(d[a].type===
UPLOADER||d[a].type===GRAPHICS)e&&(b+='<optgroup label="'+lm.Independentfields+'">',e=!1),f=a,b+='<option value="'+a.slice(3,a.length)+'">'+d[a].name+"</option>";else if(a.startsWith("stid")){f.startsWith("stid")&&(b+="</optgroup>");var c=d[a],g=Object.getOwnPropertyNames(c);b+='<optgroup label="'+lm.newSubtableDefault+" - "+c.name+'">';for(var m=0;m<g.length;m++)if(UPLOADER===c[g[m]].type||GRAPHICS===c[g[m]].type)b+='<option value="'+g[m].slice(3,a.length)+","+a.slice(4,a.length)+'">'+c[g[m]].name+
"</option>";b+="</optgroup>"}})},"/sims/formJSONDef.jsp?a="+ap+"&p="+encodeURIComponent(path)+"&si="+sheetIndex,!0);return b+="</select>"}()+'<div id="bulkDownloadDomainSelectorContainer"></div></div></div><div style="margin: 20px 0 0 0;"><span style="float:none;margin:12px 5px 12px 8px;" id="bulkDownloadButton" class="topButtonWhole"  onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.download+'</span><span style="float:none;margin:12px 8px 12px 8px;" class="topButtonWhole"  onclick="cancelDelete();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.cancel+'</span></div></div><a id="addedMappingFileLink" href="javascript:void(0)" style="float:right;">'+lm.bulkDownloadMappingFileLink+"</a>"}
function hasTypeDomain(){var a=Array.from(arguments);if(biffdata.ifListingPage())return getPromise("/sims/formJSONDef.jsp",{a:ap,p:path,si:sheetIndex}).then(JSON.parse).then(function(b){return Object.entries(b.fields).reduce(function(a,b){if(b[0].startsWith("fid"))a.push(b[1]);else if(b[0].startsWith("stid"))return b=Object.entries(b[1]).filter(function(a){return a[0].startsWith("fid")}).map(function(a){return a[1]}),a.concat(b);return a},[]).some(function(b){return a.includes(b.type)})});var b=biffdata.biffs.some(function(b){return a.includes(b.IPType)});
return Promise.resolve(b)}
function renderDownloadWin(a,b){var c,d=this.name;"CSV"===d?c=".csv":"Excel"===d&&(c=".xlsx");var e=[];e.push(createElement("td",{attrs:{style:"font-weight:bold;"},children:[lm.downloadField+":"]}));var f={dlField1:{text:lm.downloadField1},dlField2:{text:lm.downloadField2},dlField3:{text:lm.downloadField3}};for(k in f)e.push(createElement("td",{children:[createElement("input",{attrs:{type:"radio",name:"dlField",id:k}}),createElement("label",{attrs:{for:k},children:[f[k].text]})]}));e=createElement("table",
{attrs:{id:"dlFieldTable"},callback:function(a){a.addEventListener("change",function(a){var b;"CSV"===d?b="csv":"Excel"===d&&(b="xlsx");showFieldSelector(a,b)})},children:[createElement("tr",{children:e})]});f=createElement("table",{children:[createElement("tr",{children:[createElement("td",{attrs:{style:"font-weight:bold;"},children:[lm.downloadSize+":"]}),createElement("td",{children:[createElement("input",{attrs:{type:"radio",name:"dlSize",id:"dlSize1"}}),createElement("label",{attrs:{for:"dlSize1"},
children:[lm.downloadSize4+" ",createElement("input",{attrs:{type:"text",name:"dlSize3_start",id:"dlSize3_start",size:"6"}})," "+lm.to+" ",createElement("input",{attrs:{type:"text",name:"dlSize3",id:"dlSize3",size:"6"}})," "+lm.downloadSize3]})]}),createElement("td",{children:[createElement("input",{attrs:{type:"radio",name:"dlSize",id:"dlSize2"}}),createElement("label",{attrs:{for:"dlSize2"},children:[lm.downloadSize2]})]})]})]});if(".csv"===c){var g=[];var k={SEPARATOR_COMMA:lm.CSV_separator_comma,
SEPARATOR_SEMICOLON:lm.CSV_separator_semicolon,SEPARATOR_SPACE:lm.CSV_separator_space,SEPARATOR_TAB:lm.CSV_separator_tab,SEPARATOR_CUSTOMIZE:lm.CSV_separator_customize};for(var l in k)g.push(createElement("option",{attrs:{value:l},children:[k[l]]}));g=createElement("div",{attrs:{id:"separatorSetting"},children:[createElement("span",{attrs:{style:"margin: 0 10.5px 0 5px;font-weight: bold;"},children:[lm.CSV_separator+":"]}),createElement("select",{attrs:{id:"separatorSelect"},callback:function(a){a.addEventListener("change",
function(){$("customizeSeparator").style.visibility="SEPARATOR_CUSTOMIZE"!==this.value?"hidden":""})},children:g}),createElement("input",{attrs:{type:"text",id:"customizeSeparator",style:"margin-left: 12px;visibility: hidden;",maxlength:"1",size:"6"}})]})}l=createElement("div",{attrs:{id:"dataDlSettingPanel"},children:[e,node("div","listingFieldSelectorTableContent"),f,g]});g=createElement("span",{attrs:{id:"bDownloadWinDownload",class:"topButtonWhole",style:"float:none;margin:12px 5px 12px 8px;"},
callback:function(a){a.addEventListener("click",function(){download(c,!1)});a.addEventListener("mouseover",function(){buttover(this)});a.addEventListener("mouseout",function(){buttout(this)})},children:[lm.download]});e=createElement("span",{attrs:{class:"topButtonWhole",style:"float:none;margin:12px 8px 12px 8px;"},callback:function(a){a.addEventListener("click",cancelDelete);a.addEventListener("mouseover",function(){buttover(this)});a.addEventListener("mouseout",function(){buttout(this)})},children:[lm.cancel]});
appendChildren(a,[l,createElement("div",{attrs:{style:"margin:16px 0 0 0;"},children:[g,e]})]);b&&b.call(this)}
function refreshDownloadExcelOrCSVOption(){for(var a="export/"+ap+path+"/"+sheetIndex,b=$("dlFieldTable"),c=0;c<biffdata.custFieldsSets.length;c++){var d=b.rows.length;4<=b.rows[d-1].cells.length?(d=b.insertRow(d),d.insertCell(0),d.innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+biffdata.custFieldsSets[c].id+'"><label for="cfSet_'+biffdata.custFieldsSets[c].id+'">'+biffdata.custFieldsSets[c].name+'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'):
b.rows[d-1].innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+biffdata.custFieldsSets[c].id+'"><label for="cfSet_'+biffdata.custFieldsSets[c].id+'">'+biffdata.custFieldsSets[c].name+'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'}$("dlField1").checked=!0;$("dlSize1").checked=!0;(a=JSON.parse(RagicStorage.localStorage.getItem(a)))?(a.field&&$(a.field)&&
$(a.field).click(),a.size||a.start||($("dlSize3").value="1000"),a.size&&("all"===a.size?$("dlSize2").checked=!0:$("dlSize3").value=a.size),a.start&&($("dlSize3_start").value=a.start)):$("dlSize3").value="1000"}function rmOtherPanelContent(a,b){for(var c=0;c<b.length;c++)c!==a&&rm($("tabsBuilder_tab_content_"+c))}
function downloadExcelOrCSV(){var a=[{name:"Excel",func:renderDownloadWin,renderCallback:function(){var b=a.indexOf(this);rmOtherPanelContent(b,a);refreshDownloadExcelOrCSVOption();var d=document.createElement("TABLE");d.style.display="none";if(d){var e=d.insertRow(-1),f=e.insertCell(0);b=e.insertCell(1);var g=e.insertCell(2);e=e.insertCell(3);f.style["font-weight"]="bold";e.style.width="60px";f.appendChild(document.createTextNode(lm.imgDisplayedWay+":"));var k=document.createElement("INPUT");k.type=
"radio";k.name="imgDisplayed";k.id="displayAsImg";f=document.createElement("LABEL");f.setAttribute("for",k.id);f.appendChild(document.createTextNode(lm.imgDisplayedAsImg));var l=document.createElement("INPUT");l.type="radio";l.name="imgDisplayed";l.id="displayAsUrl";l.checked=!0;e=document.createElement("LABEL");e.setAttribute("for",l.id);e.appendChild(document.createTextNode(lm.imgDisplayedAsImgUrl));b.appendChild(l);b.appendChild(e);g.appendChild(k);g.appendChild(f);var m=d.insertRow(-1).insertCell(0);
m.colSpan=4;m.style.color="#ff0000";b=function(){k.checked?m.textContent=lm.imgDisplayedAsImgAlert:l.checked&&(m.textContent="")};l.onchange=b;k.onchange=b}$("dataDlSettingPanel").appendChild(d);getPromise("/sims/formJSONDef.jsp",{a:ap,p:path,si:sheetIndex}).then(JSON.parse).then(function(a){var b=a.fields;Object.getOwnPropertyNames(b).find(function(a){return b[a].type===GRAPHICS})&&(d.style.display="")})}},{name:"CSV",func:renderDownloadWin,renderCallback:function(){var b=a.indexOf(this);rmOtherPanelContent(b,
a);refreshDownloadExcelOrCSVOption()}}];ArrayContainsIgnoreCase(groupNodeIds,"SYSADMIN")&&a.push({name:lm.downloadFromBackup,func:getDownloadFromBackupPanel,renderCallback:function(){var b=a.indexOf(this);rmOtherPanelContent(b,a)},sync:!0});var b=new TabsBuilder(a);floatWin(null,"",lm.downloadConfig,!0,null,!1);b.renderTabs($("floatingWinContent"));positionFloatWin()}
function pdfDownloadUIHelper(){return{initDlField:function(){for(var a=$("dlFieldTable"),b=0;b<biffdata.custFieldsSets.length;b++){var c=a.rows.length;4<=a.rows[c-1].cells.length?(c=a.insertRow(c),c.insertCell(0),c.innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+biffdata.custFieldsSets[b].id+'"><label for="cfSet_'+biffdata.custFieldsSets[b].id+'">'+biffdata.custFieldsSets[b].name+'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'):
a.rows[c-1].innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+biffdata.custFieldsSets[b].id+'"><label for="cfSet_'+biffdata.custFieldsSets[b].id+'">'+biffdata.custFieldsSets[b].name+'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'}},getUploadFieldInfo:function(){getPromise("/sims/formJSONDef.jsp",{a:ap,p:path,si:sheetIndex}).then(JSON.parse).then(function(a){var b=
$("pdfDlToFieldSelect"),c=a.fields;a=Object.getOwnPropertyNames(c);if(null!=b&&0==b.length){var d=document.createElement("OPTION");b&&(b.appendChild(d),a.forEach(function(a){if(c[a].type===UPLOADER){var d=document.createElement("OPTION");d.value=a.slice(3,a.length);d.textContent=c[a].name;b.appendChild(d)}}))}})},getPDFDownloadWinText:function(a){var b="";"listingPage"===a?b='<div id="dataDlSettingPanel"><table id="dlFieldTable" onchange="showFieldSelector(event, \'pdf\'); "><tr><td style="font-weight:bold;">'+
lm.downloadField+':</td><td><input type="radio" name="dlField" id="dlField1" /><label for=dlField1>'+lm.downloadField1+'</label></td><td><input type="radio" name="dlField" id="dlField2" /><label for=dlField2>'+lm.downloadField2+'</label></td><td><input type="radio" name="dlField" id="dlField3" /><label for=dlField3>'+lm.downloadField3+'</label></td></tr></table><div id="listingFieldSelectorTableContent"></div><table id="dlPDFFormatSettingTable"><tr><td style="font-weight:bold;text-align: right">'+
lm.pdfPaperOrientation+':</td><td><input type="radio" name="orientation" id="orientation1"><label for=orientation1>'+lm.pdfPaperOrientation1+'</label></td><td><input type="radio" name="orientation" id="orientation2"><label for=orientation2>'+lm.pdfPaperOrientation2+'</label></td><td></td></tr><tr><td style="font-weight:bold;text-align: right">'+lm.pdfPaperSize+':</td><td><select id="pdfSizeSelect" name="pdfSize"><option value="A4" selected>A4</option><option value="A3">A3</option><option value="Letter">Letter</option><option value="Tabloid">Tabloid</option><option value="Ledger">Ledger</option><option value="Legal">Legal</option></select></td></tr></table><table style="font-size:12px;"><tr><td><input type="radio" name="dlSize" id="dlSize1" style="margin:0 5px 0 0;display:none;" /><label for=dlSize1>'+
lm.downloadSize4+' <input type="text" name="dlSize3_start" id="dlSize3_start" size="6" value="" onkeyup="if(parseInt(this.value)<1){this.value=\'\';}" /> '+lm.to+' <input type="text" name="dlSize3" id="dlSize3" size="6" onkeyup="if(parseInt(this.value)>20000){this.value=20000;}" /> '+lm.downloadSize3+'</label></td></tr><tr><td style="padding:5px;"><input type="checkbox" name="dlKeepContent" id="dlKeepContent" style="margin:0 5px 0 0;"/><label for=dlKeepContent>'+lm.downloadKeepContent+'</label></td></tr><tr><td style="padding: 5px 5px 10px 5px;"><input type="checkbox" name="dlShowDefaultBorder" id="dlShowDefaultBorder" style="margin:0 5px 0 0;"/><label for=dlShowDefaultBorder>'+
lm.downloadShowDefaultBorder+'</label></td></tr></td></tr></table></div><div><span style="margin:12px 5px 12px 8px;float:none;" class="topButtonWhole" onclick="downloadPDF(false);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.download+'</span><span style="margin:12px 8px 12px 8px;float:none;" class="topButtonWhole"  onclick="cancelDelete();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.cancel+"</span></div>":"formPage"===a&&(b='<div id="dataDlSettingPanel"><div id="listingFieldSelectorTableContent"></div><table id="dlPDFFormatSettingTable" style="margin: 0 0 5px 0;"><tr><td style="font-weight:bold;text-align: right">'+lm.pdfPaperOrientation+':</td><td><input type="radio" name="orientation" id="orientation1"><label for=orientation1>'+lm.pdfPaperOrientation1+'</label></td><td><input type="radio" name="orientation" id="orientation2"><label for=orientation2>'+lm.pdfPaperOrientation2+
'</label></td><td></td></tr><tr><td style="font-weight:bold;text-align: right">'+lm.pdfPaperSize+':</td><td><select id="pdfSizeSelect" name="pdfSize"><option value="A4" selected>A4</option><option value="A3">A3</option><option value="Letter">Letter</option><option value="Tabloid">Tabloid</option><option value="Ledger">Ledger</option><option value="Legal">Legal</option></select></td><td style="font-weight:bold;text-align: right"><span id="fileNameRefLabel" style="padding-left: 18px;">'+lm.cusReportConfig_FileNameRefDomain+
'</span></td><td><select id="fileNameRefSelect"></select></td></tr></table><table style="font-size:12px;"><tr><td><input type="radio" name="dlSize" id="dlSize1" style="margin:0 5px 0 0;display:none;" /><label for=dlSize1>'+lm.downloadSize4+' <input type="text" name="dlSize3_start" id="dlSize3_start" size="6" value="" onkeyup="if(parseInt(this.value)<1){this.value=\'\';}" /> '+lm.to+' <input type="text" name="dlSize3" id="dlSize3" size="6" onkeyup="if(parseInt(this.value)>20000){this.value=20000;}" /> '+
lm.downloadSize3+'</label></td></tr><tr><td style="padding:5px;"><input type="radio" name="dlFormPageWay" id="dlFormPageToField" style="margin:0 5px 0 0;"/><label for=dlFormPageToField>'+lm.downloadPDFAsFromPageAndStoredToFileUploadField+'</label><span id="dlToUploadFieldContainer"><select style="margin:0 0 0 5px;" id="pdfDlToFieldSelect"></select></span></td></tr><tr><td style="padding:5px;"><input type="radio" name="dlFormPageWay" id="dlFormPageSavedAs" style="margin:0 5px 0 0;" checked/><label for=dlFormPageSavedAs>'+
lm.downloadPDFAsFromPageAndSavedAs+'</label><select style="margin:0 0 0 5px;" id="dlPdfSaveAs"><option value="merge">'+lm.mergeAllEntriesInOnePDF+'</option><option value="separate"> '+lm.downloadInMultiPDFs+'</option></select></td></tr><tr><td style="padding:5px;"><input type="checkbox" name="dlKeepContent" id="dlKeepContent" style="margin:0 5px 0 0;" /><label for=dlKeepContent>'+lm.downloadKeepContent+'</label></td></tr><tr><td style="padding:5px;"><input type="checkbox" name="dlShowDefaultBorder" id="dlShowDefaultBorder" style="margin:0 5px 0 0;" /><label for=dlShowDefaultBorder>'+
lm.downloadShowDefaultBorder+'</label></td></tr><tr><td style="padding: 5px 5px 10px 5px;"><span id="dlPDFWithApprovalContainer"><input type="checkbox" name="dlPDFWithApproval" id="dlPDFWithApproval" style="margin:0 5px 0 0;"/><label for=dlPDFWithApproval>'+lm.downloadPDFWithApproval+'</label></span></td></tr></table></div><div><span style="margin:12px 5px 12px 8px;float:none;" class="topButtonWhole" onclick="downloadPDF(false);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.download+'</span><span style="margin:12px 8px 12px 8px;float:none;" class="topButtonWhole"  onclick="cancelDelete();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.cancel+"</span></div>");return b},getPDFFormPageDownloadWinText:function(a,b,c,d,e){a='<div id="dataDlSettingPanel"><table id="dlPDFFormatSettingTable"><tr><td><span  style="font-weight:bold;">'+lm.pdfPaperOrientation+
':</span><div style="display: inline-block;position: relative;top: 2px;"></td><td><input type="radio" name="orientation" id="orientation1" '+(a?"checked":"")+"><label for=orientation1>"+lm.pdfPaperOrientation1+'</label></td><td><input type="radio" name="orientation" id="orientation2" '+(a?"":"checked")+"><label for=orientation2>"+lm.pdfPaperOrientation2+'</label></div></td></tr><tr><td><span  style="font-weight:bold;">'+lm.pdfPaperSize+':</span></td><td><select id="pdfSizeSelect" name="pdfSize"><option value="A4" selected>A4</option><option value="A3">A3</option><option value="Letter">Letter</option><option value="Tabloid">Tabloid</option><option value="Ledger">Ledger</option><option value="Legal">Legal</option></select></td><td><span style="font-weight:bold;margin-right: 10px;padding-left: 18px;">'+
lm.cusReportConfig_FileNameRefDomain+'</span><select id="fileNameRefSelect"></select></td></tr></table><table style="font-size:12px;"><tr><td style="padding:5px;"><input type="checkbox" name="dlKeepContent" id="dlKeepContent" style="margin:0 5px 0 0;" '+(b?"checked":"")+"/><label for=dlKeepContent>"+lm.downloadKeepContent+'</label></td></tr><tr><td style="padding:5px;"><input type="checkbox" name="dlShowDefaultBorder" id="dlShowDefaultBorder" style="margin:0 5px 0 0;" '+(c?"checked":"")+"/><label for=dlShowDefaultBorder>"+
lm.downloadShowDefaultBorder+'</label></td></tr><tr><td><input type="checkbox" name="dlPDFWithApproval" id="dlPDFWithApproval" '+(d?"checked":"")+' style="margin:0 5px 0 0;"/><label for=dlPDFWithApproval>'+lm.downloadPDFWithApproval+"</label></td></tr></table></div>";e||(a+='<div><span style="margin:12px 5px 12px 8px;" class="topButtonWhole" onclick="downloadPDF(false);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.download+'</span><span style="margin:12px 8px 12px 8px;" class="topButtonWhole"  onclick="cancelDelete();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.cancel+"</span></div>");return a},populateFileNameRefOptions:function(){return getPromise("/sims/formJSONDef.jsp",{a:ap,p:path,si:sheetIndex}).then(JSON.parse).then(function(a){var b=$("fileNameRefSelect"),c=a.fields;a=Object.getOwnPropertyNames(c);
var d=document.createElement("OPTION");b.appendChild(d);a.forEach(function(a){if(c[a].type){var d=document.createElement("OPTION");d.value=a.slice(3,a.length);d.textContent=c[a].name;b.appendChild(d)}})})},getPDFDownloadParams:function(a){var b=!1,c=!1,d="?",e="",f={};$("dlSize1")&&$("dlSize1").checked&&($("dlSize3")&&$("dlSize3").value&&(d+="&s="+$("dlSize3").value),$("dlSize3_start")&&$("dlSize3_start").value&&(d+="&start="+$("dlSize3_start").value));var g=biffdata&&!biffdata.ifListingPage(),k=
$("dlFormPageSavedAs"),l=$("dlFormPageToField");$("dlPDFWithApproval");var m=!1;if(l&&l.checked||k&&k.checked)d+="&formPage",g=m=!0;biffdata&&biffdata.ifListingPage()&&a&&RagicStorage.localStorage.setItem("pdf tabType:"+ap+path+"/"+sheetIndex,g?"formPage":"listingPage");if(!d.includes("formPage"))if($("dlField1")&&$("dlField1").checked)d+="&f=all",f.field="dlField1";else if($("dlField2")&&$("dlField2").checked)f.field="dlField2";else if($("dlField2")&&!$("dlField2").checked){d+="&f=cust";e=$("listingFieldOptions");
for(var n=e.options.length,q=[],r=0;r<n;r++)q.push(e.options[r].value);e=JSON.stringify(q);if($("dlField3")&&$("dlField3").checked)f.field="dlField3";else for(r=0;r<biffdata.custFieldsSets.length;r++)n="cfSet_"+biffdata.custFieldsSets[r].id,$(n)&&$(n).checked&&(f.field=n)}if(l&&l.checked)if($("pdfDlToFieldSelect").value)d+="&uId="+$("pdfDlToFieldSelect").value,b=!0;else return;k&&k.checked&&"separate"===$("dlPdfSaveAs").value&&(d+="&zip",c=!0);$("orientation1")&&$("orientation1").checked?(d+="&orientation=portrait",
k=getParameterByName("id"),"/report"===path&&isNumeric(k)?a&&RagicStorage.localStorage.setItem(ap+path+"/"+k+" pdfDownloadOrientation","portrait"):"/report"!==path&&a&&RagicStorage.localStorage.setItem(ap+path+"/"+sheetIndex+(g?"formPage":"")+" pdfDownloadOrientation","portrait")):$("orientation2")&&$("orientation2").checked&&(d+="&orientation=landscape",k=getParameterByName("id"),"/report"===path&&isNumeric(k)?a&&RagicStorage.localStorage.setItem(ap+path+"/"+k+" pdfDownloadOrientation","landscape"):
"/report"!==path&&a&&RagicStorage.localStorage.setItem(ap+path+"/"+sheetIndex+(g?"formPage":"")+" pdfDownloadOrientation","landscape"));e&&(e="&order="+encodeURIComponent(e));$("dlPDFWithApproval")&&$("dlPDFWithApproval").checked&&(d+="&showApprovalInfo",a&&RagicStorage.localStorage.setItem(ap+path+"/"+sheetIndex+(g?"formPage":"")+" pdfAppendApprovalBlock","true"));$("pdfSizeSelect")&&(l=$("pdfSizeSelect").value,d+="&pdfSize="+l,k=getParameterByName("id"),"/report"===path&&isNumeric(k)?a&&RagicStorage.localStorage.setItem(ap+
path+"/"+k+" pdfSize",l):"/report"!==path&&a&&RagicStorage.localStorage.setItem(ap+path+"/"+sheetIndex+(g?"formPage":"")+" pdfSize",l));$("fileNameRefSelect")&&(k=$("fileNameRefSelect").value,d+="&fileNameRef="+k);$("dlKeepContent")&&($("dlKeepContent").checked?(d+="&keepContent",biffdata&&a&&RagicStorage.localStorage.setItem("pdf keepContent"+(g?" formPage":"")+":"+ap+path+"/"+sheetIndex,"true")):biffdata&&a&&RagicStorage.localStorage.setItem("pdf keepContent"+(g?" formPage":"")+":"+ap+path+"/"+
sheetIndex,"false"));$("dlShowDefaultBorder")&&($("dlShowDefaultBorder").checked?(d+="&showDefaultBorder",biffdata&&a&&RagicStorage.localStorage.setItem("pdf defaultBorder"+(g?" formPage":"")+":"+ap+path+"/"+sheetIndex,"true")):biffdata&&a&&RagicStorage.localStorage.setItem("pdf defaultBorder"+(g?" formPage":"")+":"+ap+path+"/"+sheetIndex,"false"));"/report"===path&&(d=location.search.includes("id=")?d+("&"+location.search.substring(1).replace("id=","report=")):d+("&report&"+location.search.substring(1)),
location.search.includes("viewMode")&&(d+="&viewMode"));return{uploadToField:b,ifZip:c,dlParam:d,order:e,dlJson:f,options:q,dlFormPage:m}}}}
function downloadPDF(a){var b=pdfDownloadUIHelper(),c=b.initDlField,d=b.getUploadFieldInfo,e=b.getPDFDownloadWinText,f=b.getPDFFormPageDownloadWinText,g=b.populateFileNameRefOptions;b=b.getPDFDownloadParams;if(!biffdata&&"/report"===path&&a)g=getParameterByName("id"),c=RagicStorage.localStorage.getItem(ap+path+"/"+g+" pdfDownloadOrientation"),c="landscape"!==c,e=RagicStorage.localStorage.getItem(ap+path+"/"+g+" pdfSize"),f='<div id="dataDlSettingPanel"><table id="dlPDFFormatSettingTable"><tr><td style="font-weight:bold;text-align: right"/>'+
lm.pdfPaperOrientation+':</td><td><input type="radio" name="orientation" id="orientation1" '+(c?"checked":"")+"><label for=orientation1>"+lm.pdfPaperOrientation1+'</label></td><td><input type="radio" name="orientation" id="orientation2" '+(c?"":"checked")+"><label for=orientation2>"+lm.pdfPaperOrientation2+'</label></td></tr><tr><td style="font-weight:bold;text-align: right">'+lm.pdfPaperSize+':</td><td><select id="pdfSizeSelect" name="pdfSize"><option value="A4" selected>A4</option><option value="A3">A3</option><option value="Letter">Letter</option><option value="Tabloid">Tabloid</option><option value="Ledger">Ledger</option><option value="Legal">Legal</option></select></td></tr></table></div><div><span style="margin:12px 5px 12px 8px;" class="topButtonWhole" onclick="downloadPDF(false);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.download+'</span><span style="margin:12px 8px 12px 8px;" class="topButtonWhole"  onclick="cancelDelete();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.cancel+"</span></div>",floatWin(null,f,lm.downloadPDF,!0),e&&($("pdfSizeSelect").value=e);else if(biffdata&&biffdata.ifListingPage()&&a){g=RagicStorage.localStorage.getItem("pdf tabType:"+ap+path+"/"+sheetIndex);null===g&&
(g="listingPage");var k=[{name:lm.listingPage,text:e("listingPage"),renderCallback:function(){var a=k.indexOf(this);rmOtherPanelContent(a,k);$("dlField2").checked=!0;$("dlSize1").checked=!0}},{name:lm.formPage,text:e("formPage"),renderCallback:function(){var a=k.indexOf(this);rmOtherPanelContent(a,k);d();$("dlSize1").checked=!0;getPromise("/sims/formJSONDef.jsp",{a:ap,p:path,si:sheetIndex}).then(JSON.parse).then(function(a){var b=$("fileNameRefSelect"),c=a.fields;a=Object.getOwnPropertyNames(c);var d=
document.createElement("OPTION");b.appendChild(d);a.forEach(function(a){if(c[a].type){var d=document.createElement("OPTION");d.value=a.slice(3,a.length);d.textContent=c[a].name;b.appendChild(d)}})});"merge"===$("dlPdfSaveAs").value&&($("fileNameRefLabel").style.display="none",$("fileNameRefSelect").style.display="none");$("dlPdfSaveAs").onchange=function(){$("dlFormPageSavedAs").checked&&("merge"===$("dlPdfSaveAs").value?($("fileNameRefLabel").style.display="none",$("fileNameRefSelect").style.display=
"none"):($("fileNameRefLabel").style.display="",$("fileNameRefSelect").style.display=""))};$("dlFormPageToField").onclick=function(){$("fileNameRefLabel").style.display="";$("fileNameRefSelect").style.display=""};$("dlFormPageSavedAs").onclick=function(){"merge"===$("dlPdfSaveAs").value?($("fileNameRefLabel").style.display="none",$("fileNameRefSelect").style.display="none"):($("fileNameRefLabel").style.display="",$("fileNameRefSelect").style.display="")}}}];floatWin(null,"",lm.downloadPDF,!0,null,
!1);(new TabsBuilder(k)).renderTabs($("floatingWinContent"));d();c();"listingPage"===g?(g="true"===RagicStorage.localStorage.getItem("pdf keepContent:"+ap+path+"/"+sheetIndex),f="true"===RagicStorage.localStorage.getItem("pdf defaultBorder:"+ap+path+"/"+sheetIndex),c="landscape"!==RagicStorage.localStorage.getItem(ap+path+"/"+sheetIndex+" pdfDownloadOrientation"),e=RagicStorage.localStorage.getItem(ap+path+"/"+sheetIndex+" pdfSize"),g&&($("dlKeepContent").checked=!0),f&&($("dlShowDefaultBorder").checked=
!0),c?$("orientation1").checked=!0:$("orientation2").checked=!0,e&&($("pdfSizeSelect").value=e)):"formPage"===g&&($("tabsBuilder_tab_1").click(),g="true"===RagicStorage.localStorage.getItem("pdf keepContent formPage:"+ap+path+"/"+sheetIndex),f="true"===RagicStorage.localStorage.getItem("pdf defaultBorder formPage:"+ap+path+"/"+sheetIndex),c="landscape"!==RagicStorage.localStorage.getItem(ap+path+"/"+sheetIndex+"formPage pdfDownloadOrientation"),e=RagicStorage.localStorage.getItem(ap+path+"/"+sheetIndex+
"formPage pdfSize"),a=RagicStorage.localStorage.getItem(ap+path+"/"+sheetIndex+"formPage pdfAppendApprovalBlock"),c?$("orientation1").checked=!0:$("orientation2").checked=!0,g&&($("dlKeepContent").checked=!0),f&&($("dlShowDefaultBorder").checked=!0),a&&($("dlPDFWithApproval").checked=!0),e&&($("pdfSizeSelect").value=e))}else if(biffdata&&!biffdata.ifListingPage()&&a){a="true"===RagicStorage.localStorage.getItem("pdf keepContent formPage:"+ap+path+"/"+sheetIndex);b="true"===RagicStorage.localStorage.getItem("pdf defaultBorder formPage:"+
ap+path+"/"+sheetIndex);c=RagicStorage.localStorage.getItem(ap+path+"/"+sheetIndex+"formPage pdfDownloadOrientation");c="landscape"!==c;e=RagicStorage.localStorage.getItem(ap+path+"/"+sheetIndex+"formPage pdfSize");var l=RagicStorage.localStorage.getItem(ap+path+"/"+sheetIndex+"formPage pdfAppendApprovalBlock");f=f(c,a,b,l,!1);floatWin(null,f,lm.downloadPDF,!0);e&&($("pdfSizeSelect").value=e);g()}else{floatWinClose();ctrl.outOfNUI=!1;g=b(!0);var m=g.uploadToField,n=g.ifZip,q=g.dlParam,r=g.order,p=
g.options,t=g.dlFormPage;g=function(){("/report"!==path?getViewableMaskedFieldDomainIds(biffdata&&biffdata.ifListingPage()&&!(t&&t.checked),$("dlField1")&&$("dlField1").checked,p):new Promise(function(a,b){return a([])})).then(function(a){0<a.length?selectMaskedFieldExportType(a,function(a){var b=urlHashResolve(!0)+".pdf"+q+r;0<a.length&&(b+="&unmasked="+encodeURIComponent(JSON.stringify(a)));m||n?getPromise(b,{}).then(function(){updateSystemTaskProgress()}):window.open(b,"_blank")}):(a=urlHashResolve(!0)+
".pdf"+q+r,m||n?getPromise(a,{}).then(function(){updateSystemTaskProgress()}):window.open(a,"_blank"))})};biffdata&&biffdata.ifListingPage()?checkRunningServiceByFormUrl(g):g()}positionFloatWin()}
function download(a,b){var c="export/"+ap+path+"/"+sheetIndex;if(biffdata.ifListingPage()&&b)hasTypeDomain(GRAPHICS,UPLOADER).then(function(b){var d="";b&&(d='<a style="margin:16px 8px 12px 8px;" onclick="getBulkDownloadPanel()" href="javascript:void(0);">'+lm.bulkDownloadLink+"</a>");floatWin(null,'<div id="dataDlSettingPanel"><table id="dlFieldTable" onchange="showFieldSelector(event); "><tr><td style="font-weight:bold;">'+lm.downloadField+':</td><td><input type="radio" name="dlField" id="dlField1" /><label for=dlField1>'+
lm.downloadField1+'</label></td><td><input type="radio" name="dlField" id="dlField2" /><label for=dlField2>'+lm.downloadField2+'</label></td><td><input type="radio" name="dlField" id="dlField3" /><label for=dlField3>'+lm.downloadField3+'</label></td></tr></table><div id="listingFieldSelectorTableContent"></div><table><tr><td style="font-weight:bold;">'+lm.downloadSize+':</td><td><input type="radio" name="dlSize" id="dlSize1" /><label for=dlSize1>'+lm.downloadSize1+' <input type="text" name="dlSize3" id="dlSize3" size="6" /> '+
lm.downloadSize3+'</label></td><td><input type="radio" name="dlSize" id="dlSize2" /><label for=dlSize2>'+lm.downloadSize2+'</label></td></tr></table></div><div><span style="margin:12px 5px 12px 8px;" class="topButtonWhole" onclick="download(\''+a+'\',false);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.download+'</span><span style="margin:12px 8px 12px 8px;" class="topButtonWhole"  onclick="cancelDelete();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.cancel+"</span>"+d+"</div>",lm.downloadConfig,!0);b=$("dlFieldTable");for(d=0;d<biffdata.custFieldsSets.length;d++){var e=b.rows.length;4<=b.rows[e-1].cells.length?(e=b.insertRow(e),e.insertCell(0),e.innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+biffdata.custFieldsSets[d].id+'"><label for="cfSet_'+biffdata.custFieldsSets[d].id+'">'+biffdata.custFieldsSets[d].name+'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'):
b.rows[e-1].innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+biffdata.custFieldsSets[d].id+'"><label for="cfSet_'+biffdata.custFieldsSets[d].id+'">'+biffdata.custFieldsSets[d].name+'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'}$("dlField1").checked=!0;$("dlSize1").checked=!0;(b=JSON.parse(RagicStorage.localStorage.getItem(c)))?(b.field&&$(b.field)&&
$(b.field).click(),b.size?"all"===b.size?$("dlSize2").checked=!0:$("dlSize3").value=b.size:$("dlSize3").value="1000"):$("dlSize3").value="1000"});else{inNUI();var d=[];b={};var e=$("dlField1")&&$("dlField1").checked;if(e)d.push("f=all"),b.field="dlField1";else if($("dlField2")&&$("dlField2").checked)b.field="dlField2";else if($("dlField2")&&!$("dlField2").checked){d.push("f=cust");var f=Array.from($("listingFieldOptions").options).map(function(a){return a.value});d.push("order="+encodeURIComponent(JSON.stringify(f)));
if($("dlField3")&&$("dlField3").checked)b.field="dlField3";else for(var g=0;g<biffdata.custFieldsSets.length;g++){var k="cfSet_"+biffdata.custFieldsSets[g].id;$(k)&&$(k).checked&&(b.field=k)}}$("displayAsImg")&&$("displayAsImg").checked&&d.push("displayAsImg");var l=$("dlSize1")&&$("dlSize1").checked,m=0,n=0;l&&((g=$("dlSize3"))&&isNumeric(g.value)&&(m=parseInt(g.value)),(k=$("dlSize3_start"))&&isNumeric(k.value)&&(n=parseInt(k.value)),0===m&&0===n?l=!1:(0!==m&&(d.push("s="+g.value),b.size=g.value),
0!==n&&(d.push("start="+k.value),b.start=k.value)));l||(b.size="all");".csv"===a&&(g=$("separatorSelect"),k="","SEPARATOR_CUSTOMIZE"===g.value?(g=$("customizeSeparator"),k=""===g.value?"SEPARATOR_SPACE":" "===g.value?"SEPARATOR_SPACE":g.value):k=g.value,d.push("separator="+k),d.push("async"));g=$("printHeader");biffdata.ifListingPage()&&g&&!g.checked&&d.push("ignoreHeader");RagicStorage.localStorage.setItem(c,JSON.stringify(b));b=Promise.resolve();ifNoTotalEntry()&&(floatWin(null,lm.prop_loading,
"",!0),b=getPromise("/sims/getNumOfEntries.jsp",{a:ap,p:path,fn:sheet}).then(updateTotalEntry));b.then(function(){$("floatingWin").style.display="none";".xlsx"===a&&-1!==biffdata.totalEntry&&biffdata.totalEntry>ctrl.ExcelExportLimit&&(l?0<m?m-n>ctrl.ExcelExportLimit&&(a=".csv"):biffdata.totalEntry-n>ctrl.ExcelExportLimit&&(a=".csv"):a=".csv");".csv"===a&&(d.push("async"),setTimeout(updateSystemTaskProgress,1E3));var b=urlHashResolve(!0)+a+(d.length?"?"+d.join("&"):"");getViewableMaskedFieldDomainIds(biffdata.ifListingPage(),
e,f).then(function(a){0<a.length?selectMaskedFieldExportType(a,function(a){0<a.length&&(b+=(b.includes("?")?"&":"?")+"unmasked="+encodeURIComponent(JSON.stringify(a)));window.open(b)}):window.open(b)})})}}
function downloadAttachments(){var a=[];a.push({name:lm.bulkDownloadLink,func:getBulkDownloadPanel,renderCallback:function(){var b=a.indexOf(this);rmOtherPanelContent(b,a);var d,e=$("floatingWinContent");b=e.querySelector(".userpref_tab");e=e.querySelector(".userpref_tabcontent");b.style.display="none";e.style.border="1px solid #ccc";e.style.borderRadius="6px";ajaxget("/sims/formJSONDef.jsp",{a:ap,p:path,si:sheetIndex},function(a){d=JSON.parse(a)},!0);b=$("bulkDownloadButton");var f=$("addedMappingFileLink");
e=document.querySelector("#bulkDownloadPanel select[name='bulkDownloadDomain']");var g=BarSelectAgent.modifiedSelector("bulkDownloadDomainSelector",e,$("bulkDownloadDomainSelectorContainer"),{});b.addEventListener("click",bulkDownload);f.addEventListener("click",function(){f.classList.add("hide");var a=createElement("div",{class:"kfContent"});$("bulkDownloadInfo").appendChild(a);processMappingKeyFieldContent(d);g.setAfterSelectOption(function(){processMappingKeyFieldContent(d)})})},sync:!0});var b=
new TabsBuilder(a);floatWin(null,"",lm.bulkDownloadLink,!0,null,!1);b.renderTabs($("floatingWinContent"));positionFloatWin()}
function downloadHTML(a){if(biffdata.ifListingPage()&&a){a="true"===RagicStorage.localStorage.getItem("keepContent:"+ap+path+"/"+sheetIndex);floatWin(null,'<div id="dataDlSettingPanel"><table id="dlFieldTable" onchange="showFieldSelector(event); "><tr><td style="font-weight:bold;">'+lm.downloadField+':</td><td><input type="radio" name="dlField" id="dlField1" /><label for=dlField1>'+lm.downloadField1+'</label></td><td><input type="radio" name="dlField" id="dlField2" /><label for=dlField2>'+lm.downloadField2+
'</label></td><td><input type="radio" name="dlField" id="dlField3" /><label for=dlField3>'+lm.downloadField3+'</label></td></tr></table><div id="listingFieldSelectorTableContent"></div><table style="font-size:12px;"><tr><td><input type="radio" name="dlSize" id="dlSize1" style="margin:0 5px 0 0;display:none;" /><label for=dlSize1>'+lm.downloadSize4+' <input type="text" name="dlSize3_start" id="dlSize3_start" size="6" value="" onkeyup="if(parseInt(this.value)<1){this.value=\'\';}" /> '+lm.to+' <input type="text" name="dlSize3" id="dlSize3" size="6" onkeyup="if(parseInt(this.value)>20000){this.value=20000;}" /> '+
lm.downloadSize3+'</label></td></tr><tr><td style="padding:5px;"><input type="checkbox" name="dlFormPage" id="dlFormPage" style="margin:0 5px 0 0;" onchange="toggle($(\'dlFieldTable\'))"/><label for=dlFormPage>'+lm.downloadAsFormPage+'</label></td></tr><tr><td style="padding:5px;"><input type="checkbox" name="dlKeepContent" id="dlKeepContent" style="margin:0 5px 0 0;" '+(a?"checked":"")+"/><label for=dlKeepContent>"+lm.downloadKeepContent+'</label></td></tr><tr><td style="padding:5px;"><input type="checkbox" name="dlShowDefaultBorder" id="dlShowDefaultBorder" style="margin:0 5px 0 0;" '+
(a?"checked":"")+"/><label for=dlShowDefaultBorder>"+lm.downloadShowDefaultBorder+'</label></td></tr></table></div><div><span style="margin:12px 5px 12px 8px;" class="topButtonWhole" onclick="downloadHTML(false);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.print+'</span><span style="margin:12px 8px 12px 8px;" class="topButtonWhole"  onclick="cancelDelete();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.cancel+"</span></div>",lm.downloadHTML,!0);var b=$("dlFieldTable");for(a=0;a<biffdata.custFieldsSets.length;a++){var c=b.rows.length;4<=b.rows[c-1].cells.length?(c=b.insertRow(c),c.insertCell(0),c.innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+biffdata.custFieldsSets[a].id+'"><label for="cfSet_'+biffdata.custFieldsSets[a].id+'">'+biffdata.custFieldsSets[a].name+'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'):
b.rows[c-1].innerHTML+='<td onmouseover="showDeleteIcon(event);" onmouseout="hideDeleteIcon(event);"><input type="radio" name="dlField" id="cfSet_'+biffdata.custFieldsSets[a].id+'"><label for="cfSet_'+biffdata.custFieldsSets[a].id+'">'+biffdata.custFieldsSets[a].name+'</label><i class="dataDlSetting_deleteIcon fas fa-minus-circle" onclick="deleteCustFieldsSet(event);"></i></td>'}$("dlField2").checked=!0;$("dlSize1").checked=!0;positionFloatWin()}else{ctrl.outOfNUI=!1;var d="?",e="";$("dlSize1")&&
$("dlSize1").checked&&$("dlSize3")&&$("dlSize3").value&&(d+="&s="+$("dlSize3").value,$("dlSize3_start")&&$("dlSize3_start").value&&(d+="&start="+$("dlSize3_start").value));(c=$("dlFormPage"))&&c.checked&&(d+="&formPage");if(!d.includes("formPage"))if($("dlField1")&&$("dlField1").checked)d+="&f=all";else if(!($("dlField2")&&$("dlField2").checked||!$("dlField2")||$("dlField2").checked)){d+="&f=cust";var f=$("listingFieldOptions"),g=f.options.length;b=[];for(a=0;a<g;a++)b.push(f.options[a].value);e=
JSON.stringify(b);if(!$("dlField3")||!$("dlField3").checked)for(a=0;a<biffdata.custFieldsSets.length;a++)f="cfSet_"+biffdata.custFieldsSets[a].id,$(f)&&$(f)}e&&(e="&order="+encodeURIComponent(e));$("dlKeepContent")&&"none"!==$("floatingWin").style.display?$("dlKeepContent").checked?(d+="&keepContent",c&&c.checked?RagicStorage.localStorage.setItem("keepContent formPage:"+ap+path+"/"+sheetIndex,"true"):RagicStorage.localStorage.setItem("keepContent:"+ap+path+"/"+sheetIndex,"true")):c&&c.checked?RagicStorage.localStorage.setItem("keepContent formPage:"+
ap+path+"/"+sheetIndex,"false"):RagicStorage.localStorage.setItem("keepContent:"+ap+path+"/"+sheetIndex,"false"):"true"===RagicStorage.localStorage.getItem("keepContent formPage:"+ap+path+"/"+sheetIndex)&&(d+="&keepContent");$("dlShowDefaultBorder")&&"none"!==$("floatingWin").style.display?$("dlShowDefaultBorder").checked?(d+="&showDefaultBorder",c&&c.checked?RagicStorage.localStorage.setItem("defaultBorder formPage:"+ap+path+"/"+sheetIndex,"true"):RagicStorage.localStorage.setItem("defaultBorder:"+
ap+path+"/"+sheetIndex,"true")):c&&c.checked?RagicStorage.localStorage.setItem("defaultBorder formPage:"+ap+path+"/"+sheetIndex,"false"):RagicStorage.localStorage.setItem("defaultBorder:"+ap+path+"/"+sheetIndex,"false"):"true"===RagicStorage.localStorage.getItem("defaultBorder formPage:"+ap+path+"/"+sheetIndex)&&(d+="&showDefaultBorder");$("dlShowNoLink")&&"none"!==$("floatingWin").style.display?$("dlShowNoLink").checked?(d+="&dlShowNoLink",c&&c.checked?RagicStorage.localStorage.setItem("showNoLink formPage:"+
ap+path+"/"+sheetIndex,"true"):RagicStorage.localStorage.setItem("showNoLink:"+ap+path+"/"+sheetIndex,"true")):c&&c.checked?RagicStorage.localStorage.setItem("showNoLink formPage:"+ap+path+"/"+sheetIndex,"false"):RagicStorage.localStorage.setItem("showNoLink:"+ap+path+"/"+sheetIndex,"false"):"true"===RagicStorage.localStorage.getItem("showNoLink formPage:"+ap+path+"/"+sheetIndex)&&(d+="&showNoLink");d+="&showConfig";getViewableMaskedFieldDomainIds(biffdata.ifListingPage()&&!(c&&c.checked),$("dlField1")&&
$("dlField1").checked,b).then(function(a){0<a.length?selectMaskedFieldExportType(a,function(a){var b=urlHashResolve(!0)+".xhtml"+d+e;0<a.length&&(b+="&unmasked="+encodeURIComponent(JSON.stringify(a)));window.open(b,"_blank")}):(a=urlHashResolve(!0)+".xhtml"+d+e,window.open(a,"_blank"));floatWinClose()})}}
function selectMaskedFieldExportType(a,b){a={a:ap,p:path,si:sheetIndex,maskedFields:JSON.stringify(a)};postPromise("/sims/selectMaskedFieldExportType.jsp",a).then(function(a){floatWin(null,a,null,!0);$("maskedFieldExport").onclick=function(){for(var a=[],c=document.querySelectorAll("#maskedFieldSelectTable input[type=checkbox]"),f=0;f<c.length;f++)c[f].checked||a.push(c[f].value);b&&b(a);floatWinClose()}})}
function getViewableMaskedFieldDomainIds(a,b,c){a={a:ap,p:path,si:sheetIndex,ifListingPage:a,ifAllFields:b};c&&(a.fetchDomains=JSON.stringify(c));return getPromise("/sims/getViewableMaskedFieldDomainIds.jsp",a).then(function(a){return new Promise(function(b,c){b(JSON.parse(a))})})}
function deleteTemplate(a){if(confirm(lm.deleteTemplateMsg)){for(var b=-1,c=0;c<biffdata.templates.length;c++)if(biffdata.templates[c].id==a){b=c;break}0<=b&&(biffdata.templates.splice(b,1),postPromise("/sims/saveTemplate.jsp",{r:1,a:ap,p:path,s:sheet,cid:a}),mailMerge())}}function showEditTemplate(a){"none"==$("editTemplate"+a).style.display?$("editTemplate"+a).style.display="":$("editTemplate"+a).style.display="none";$("upFile"+a).style.display="none"}
function uploadCusReport(a,b){if(b){b=$("tempFile"+a).value;if(!b||!(b.endsWith(".xlsx")||b.endsWith(".xlsm")||b.endsWith(".docx"))){if(!ctrl.mailMergeXLSWhiteList.includes(ap)){alert(lm.templateUploadFailure);return}if(!(b.endsWith(".xlsx")||b.endsWith(".xlsm")||b.endsWith(".docx")||b.endsWith(".xls"))){alert(lm.templateUploadFailure);return}}b=$("tempForm"+a);b.action="/sims/saveTemplate.jsp?u=1&a="+ap+"&p="+path+"&s="+sheet+"&cid="+a;b.target="nuiiframe";b.submit();mailMerge()}else a=$("upFile"+
a),a.style.display="none"==a.style.display?"":"none"}
function createTemplate(a){if(a){var b=1;biffdata.templates&&0<biffdata.templates.length&&(a=biffdata.templates[biffdata.templates.length-1])&&(b=parseInt(a.id)+1);var c=$("tempName").value,d=$("tempFile").value;if(c){if(!d||!(d.endsWith(".xlsx")||d.endsWith(".xlsm")||d.endsWith(".docx"))){if(!ctrl.mailMergeXLSWhiteList.includes(ap)){alert(lm.templateUploadFailure);return}if(!(d.endsWith(".xlsx")||d.endsWith(".xlsm")||d.endsWith(".docx")||d.endsWith(".xls"))){alert(lm.templateUploadFailure);return}}a=
$("templateTypeSelect")?"formPageTemplate"!==$("templateTypeSelect").value:biffdata.ifListingPage();b=new Template(b,c,d);b.ifListingMode=a;biffdata.templates.push(b);b=$("tempForm");b.action="/sims/saveTemplate.jsp?c=1&a="+ap+"&p="+path+"&s="+sheet+(a?"&listingMode":"");b.target="nuiiframe";b.submit();mailMerge()}else alert(lm.newTemplateMsg)}else a=$("createDiv"),a.style.display="none"===a.style.display?"":"none"}
function createMailMergeInfoPoJo(){var a={};$("dlSize1")&&(a.dlSize1Checked=$("dlSize1").checked);$("dlSize2")&&(a.d2Size1Checked=$("dlSize2").checked);$("dlSize3_start")&&(a.dlSize3_start=$("dlSize3_start").value);$("dlSize3")&&(a.dlSize3=$("dlSize3").value);a.mailMergeToFieldSelect=$("mailMergeToFieldSelect").value;return a}
function updateMailMergeInfo(a){$("dlSize1")&&($("dlSize1").checked=a.dlSize1Checked);$("dlSize2")&&($("dlSize2").checked=a.d2Size1Checked);$("dlSize3_start")&&($("dlSize3_start").value=a.dlSize3_start);$("dlSize3")&&($("dlSize3").value=a.dlSize3);$("mailMergeToFieldSelect").value=a.mailMergeToFieldSelect}function checkMailMergeDLLimit(a,b){if(!a.value||-1>a.value)a.value=0;parseInt(b.value)-parseInt(a.value)>ctrl.mailMergeLimit&&(b.value=parseInt(a.value)+ctrl.mailMergeLimit)}
function viewMultiCusReport(a,b,c){ctrl.outOfNUI=!1;var d=biffdata.templates.find(function(b){return b.id==a}),e=!0,f="",g=b||$("dlDirectly").checked;if($("dlSize1")&&$("dlSize1").checked&&$("dlSize3")&&$("dlSize3").value){var k=urlHashResolve(!0)+".custom?size="+$("dlSize3").value+"&cid="+a;$("dlSize3_start")&&$("dlSize3_start").value&&(k+="&start="+$("dlSize3_start").value);if(!b&&$("dlToField").checked){var l=$("mailMergeToFieldSelect").value;l?k+="&uId="+l:(e=!1,f+=lm.mailMergeNotChooseDomainErr)}else if(!b&&
$("dlDirectly").checked){var m=$("mailMergeSaveAsTo").value;"merge"===m&&(k+="&merge");"mergedInPage"===m&&(k+="&mergedInPage");l=$("dlSize3_start")&&$("dlSize3_start").value?$("dlSize3_start").value:0;var n=$("dlSize3").value;m="separate"===m;d=d.file.endsWith(".docx");d=m?1E4:d?100:300;parseInt(n)-parseInt(l)>d&&biffdata.totalEntry>=(userProperties.rowsPerPage?userProperties.rowsPerPage:25)&&(e=!1,m||(f+=lm.mailMergeDlOverLimit.replace(/\{0\}/g,d)))}}else k=urlHashResolve(!0)+".custom?size=-1&cid="+
a,l=getCheckedRootNodeIds(),0<l.length&&(k+="&checkedRootNodeIds="+encodeURIComponent(JSON.stringify(l))),!b&&$("dlToField").checked?(l=$("mailMergeToFieldSelect").value)?k+="&uId="+l:(e=!1,f=lm.mailMergeNotChooseDomainErr):!b&&$("dlDirectly").checked&&("merge"===$("mailMergeSaveAsTo").value&&(k+="&merge"),"mergedInPage"===$("mailMergeSaveAsTo").value&&(k+="&mergedInPage"));b&&(k+="&listingMode");if(e)!b&&$("dlToField").checked&&c?($("mailMergeContainer").querySelector("table").style.display="none",
f=createMailMergeInfoPoJo(),b=$("mailMergeContainer").innerHTML+"<div>"+lm.mailMergeDlToFieldWarning+'</div><div><span style="margin:12px 5px 12px 8px;" class="topButtonWhole" onclick="viewMultiCusReport('+a+", "+b+', false);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.download+'</span><span style="margin:12px 8px 12px 8px;" class="topButtonWhole"  onclick="cancelDelete();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.cancel+"</span></div>",floatWin(null,b,"",!0),updateMailMergeInfo(f)):(floatWinClose(),b=function(){getViewableMaskedFieldDomainIds(!1).then(function(a){0<a.length?selectMaskedFieldExportType(a,function(a){k+="&unmasked="+encodeURIComponent(JSON.stringify(a));g?window.open(k,"_blank"):getPromise(k,{}).then(function(){updateSystemTaskProgress()})}):g?window.open(k,"_blank"):getPromise(k,{}).then(function(a){5<a.length?($("floatingWin").style.display="",$("dlMsg").innerHTML=a,$("dlMsg").style.display=
""):updateSystemTaskProgress()})})},g?b():checkRunningServiceByFormUrl(b));else if(b=$("dlMsg"))b.style.display="",b.textContent=f}
function viewCusReport(a){if(biffdata.ifListingPage()){var b=biffdata.templates.find(function(b){return b.id==a}),c=!1,d=b.file.endsWith(".xls")||b.file.endsWith(".xlsx");b&&(c=b.ifListingMode);b=getCheckedRootNodeIds();var e=c?d?ctrl.mailMergeLimit:ctrl.mailMergeWordListingModeLimit:ctrl.mailMergeToFieldLimit;floatWinClose();d='<div id="mailMergeContainer" style="margin:5px;"><table style="font-size:12px;" onchange="checkMailMergeDlLimit('+e+');">'+(0==b.length?'<tr><td style="padding:5px;font-weight:bold;">'+
lm.downloadSize+':</td><td style="padding:5px"><input type="radio" name="dlSize" id="dlSize1" style="margin:0 5px 0 0;" /><label for=dlSize1>'+lm.downloadSize4+' <input type="text" name="dlSize3_start" id="dlSize3_start" size="6" value="" onkeyup="if(parseInt(this.value)<1){this.value=\'\';}" /> '+lm.to+' <input type="text" name="dlSize3" id="dlSize3" size="6" value="'+e+'" onkeyup="checkMailMergeDLLimit($(\'dlSize3_start\'), this);" /> '+lm.downloadSize3+'</label></td><td style="padding:5px"><input type="radio" name="dlSize" id="dlSize2" style="margin:0 5px 0 0;" /><label for=dlSize2>'+
lm.downloadSize2+"</label></td></tr>":'<tr><td style="padding:5px;font-weight:bold;">'+lm.downloadSize+':</td><td style="padding:5px">'+lm.mailMergeCheckedRootNodeIds+"</td></tr>")+'<tr class="exportWayTr"><td style="padding:5px;font-weight:bold;">'+lm.mailMergeResultTo+':</td><td colspan = "2" style="padding:5px"><input type="radio" name="dlWay" id="dlToField" style="margin:0 5px 0 0;" checked/><label for="dlToField">'+lm.uploadResultToDesc+'<select style="margin:0 0 0 5px;" id="mailMergeToFieldSelect"></select></label></td></tr><tr class="exportWayTr"><td></td><td colspan = "2" style="padding:5px"><input type="radio" name="dlWay" id="dlDirectly" style="margin:0 5px 0 0;" /><label for="dlDirectly">'+
lm.saveAs+"</label>"+(d?'<select style="margin:0 0 0 5px;" id="mailMergeSaveAsTo"><option value="merge">'+lm.mergeAllEntriesInOneExcel+'</option><option value="separate"> '+lm.downloadInMultiExcels+'</option><option value="mergedInPage">'+lm.mergeAllEntriesInOneExcelPage+"</option></select>":'<select style="margin:0 0 0 5px;" id="mailMergeSaveAsTo"><option value="separate">'+lm.downloadInMultiWords+'</option><option value="merge"> '+lm.mergeAllEntriesInOneWord+"</option></select>")+'</td></tr></table></div><div id="dlMsg" style="margin:10px;color:#ff0000;display:none;max-width:600px;">'+
lm.dlNumOverLimit.split("{0}").join(ctrl.mailMergeLimit)+'</div><div><span style="margin:12px 5px 12px 8px;" class="topButtonWhole" onclick="viewMultiCusReport('+a+", "+c+', true);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.download+'</span><span style="margin:12px 8px 12px 8px;" class="topButtonWhole"  onclick="cancelDelete();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.cancel+"</span></div>";floatWin(null,d,lm.mailMerge+lm.space+lm.download,!0);getPromise("/sims/formJSONDef.jsp",{a:ap,p:path,si:sheetIndex}).then(JSON.parse).then(function(a){var b=$("mailMergeToFieldSelect"),c=a.fields;a=Object.getOwnPropertyNames(c);var d=document.createElement("OPTION");b.appendChild(d);a.forEach(function(a){if(c[a].type===UPLOADER){var d=document.createElement("OPTION");d.value=a.slice(3,a.length);d.textContent=c[a].name;b.appendChild(d)}})});$("dlSize1")&&($("dlSize1").checked=
!0);c&&Array.from(document.querySelectorAll(".exportWayTr")).forEach(function(a){a.style.display="none"})}else{var f=urlHashResolve(!0)+".custom?rn="+biffdata.rootNodeId+"&cid="+a+(rmlc?"&rmlc="+encodeURIComponent(rmlc):"");getViewableMaskedFieldDomainIds(!1).then(function(a){0<a.length?selectMaskedFieldExportType(a,function(a){f+="&unmasked="+encodeURIComponent(JSON.stringify(a));window.open(f,"_blank")}):window.open(f,"_blank")})}}
function downloadCusTemplate(a){a=urlHashResolve(!0)+".custom?t=1&cid="+a;window.open(a,"_blank")}
function mailMerge(){for(var a="",b=0;b<biffdata.templates.length;b++){var c=biffdata.templates[b];if(!(!c||c.ifListingMode&&!biffdata.ifListingPage()||c.userGroups&&0<c.userGroups.length&&!checkUserGroups(c.userGroups))){var d=0<=c.file.indexOf(".xls");a=a+'<tr><td style="padding:6px 0 2px;vertical-align:top"><img style="padding:1px 5px 0 0;width: 16px;" src="'+lm.cdn+"/sims/img/"+(d?"excel":"word")+'.png"/><span id="templateTitle'+c.id+'" >'+c.name+"</span>"+(c.ifListingMode?"("+lm.listingModeTemplate+
")":"")+'</td><td style="padding-left:10px;vertical-align:top"><span style="margin:3px;" class="topButtonWhole" onclick="viewCusReport('+c.id+')" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.mailMerge+'</span><span style="margin:3px;" class="topButtonWhole" onclick="showEditTemplate('+c.id+')" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.editTemplate+'</span><div id="editTemplate'+c.id+'" style="display:none;"><a href="javascript:void(0);" onclick="downloadCusTemplate('+c.id+');" style="margin-left:5px;vertical-align:top">'+lm.download+'</a><a href="javascript:void(0);" onclick="uploadCusReport('+c.id+',false);" style="margin-left:15px;vertical-align:top">'+lm.upload+'</a><a href="javascript:void(0);" onclick="deleteTemplate('+c.id+');" style="margin-left:15px;vertical-align:top">'+lm["delete"]+'</a></div><div id="upFile'+c.id+
'" style="display:none;"><form name="tempForm'+c.id+'" id="tempForm'+c.id+'" method="POST" enctype="multipart/form-data"><table><tbody><tr><td><input type="file" id="tempFile'+c.id+'" name="tempFile'+c.id+'" /></td></tr><tr><td><span style="margin:0 0 0 3px;float:left;" class="topButtonWholeRight" onclick="uploadCusReport('+c.id+',true);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.save+"</span></td></tr></tbody></table></form></div></td>"+(ArrayContainsIgnoreCase(groupNodeIds,"SYSADMIN")?'<td style="vertical-align:top;position:relative;top:10px"><i class="fa fa-cog" style="cursor:pointer;color:#888;" onclick="editCusReportSetting('+c.id+', this)"></i></td>':"")+"</tr>"}}a='<table id="templateTable" style="font-size:13px;"><tr><td style="padding:6px 0 2px;vertical-align:top"><img style="padding:1px 5px 0 0;width: 16px;" src="'+lm.cdn+'/sims/img/excel.png"/>'+lm.sampleTemplate+
'</a></td><td style="padding-left:10px;vertical-align:top;"><span style="margin:3px;" class="topButtonWhole" onclick="downloadCusTemplate(0)" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.download+"</span></td></tr>"+a+'</table><div style="padding:6px 0; width: 150px"><a href="javascript:void(0);" onClick="createTemplate(false);"><i style="padding: 0 8px 0 2px;" class="fa fa-plus-circle fa"></i>'+
lm.createTemplate+'</a><br></div><div id="createDiv" style="display:none;"><form name="tempForm" id="tempForm" method="POST" enctype="multipart/form-data"><table id="addTempTable"><tbody><tr><td style="font-size:14px;font-weight: 700;text-align: right;padding: 0 10px 0 0;">'+lm.templateUpload+'</td><td style="padding: 0 0 0 3px;"><input style="width:200px" type="file" id="tempFile" name="tempFile" /></td></tr><tr><td style="font-size:14px;font-weight:700;text-align: right;padding: 0 10px 0 0;">'+
lm.templateName+'</td><td><input style="margin:2px 0 0 4px;" size="17" type="text" id="tempName" name="tempName" autocomplete="off"/><select id="templateTypeSelect" name="templateType"><option value="formPageTemplate" '+(biffdata.ifListingPage()?"":"selected")+">"+lm.uploadAsFormPageTemplate+"</option><option "+(biffdata.ifListingPage()?"selected":"")+' value="listingPageTemplate">'+lm.uploadAsListingPageTemplate+'</option></select></td></tr><tr><td></td><td><span style="float:left;margin: 2px 0 0 4px;" class="topButtonWholeRight" onclick="createTemplate(true);" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.upload+"</span><td></tr></tbody></table></form></div>";floatWin(null,a,lm.mailMerge,!0);a=$("templateTable");$("addTempTable").querySelector("td").style.width=a.querySelector("td").offsetWidth+"px"}
function editCusReportSetting(a,b){if(a){for(var c=null,d=0;d<biffdata.templates.length;d++){var e=biffdata.templates[d];if(a==e.id){c=e;break}}if(c){d=node("div");d.className="settingContainer";e=node("div");e.className="cusReportDivContainer";d.appendChild(e);var f=node("label");f.className="cusReportConfigLabel";f.appendChild(document.createTextNode(lm.cusReportConfig_rename_title));e.appendChild(f);var g=node("input");g.setAttribute("type","text");g.style.verticalAlign="middle";g.style.marginLeft=
"5px";g.style.width="195px";g.style.height="28px";g.value=c.name;g.onfocus=function(){ctrl.dropWinLock=!0};g.onclick=function(){ctrl.dropWinLock=!0};g.onblur=function(){ctrl.dropWinLock=!1;postPromise("/sims/updateTemplateConfig.jsp",{a:ap,p:path,si:sheetIndex,ni:biffdata.rootNodeId,cid:a,rename:g.value}).then(function(a){a=JSON.parse(a);a.isSuccess?($("templateTitle"+c.id).innerHTML=g.value,silentReload()):a.errorMessage&&console.error(a.errorMessage)})};e.appendChild(g);if(!c.ifListingMode){e=node("div");
e.className="cusReportDivContainer";d.appendChild(e);f=node("label");f.className="cusReportConfigLabel";f.appendChild(document.createTextNode(lm.cusReportConfig_FileNameRefDomain));e.appendChild(f);var k=node("select");k.id="fileNameRefSelect";k.style.marginLeft="5px";k.style.verticalAlign="middle";e.appendChild(k);k.onfocus=function(){ctrl.dropWinLock=!0};k.onblur=function(){ctrl.dropWinLock=!1};k.onchange=function(){postPromise("/sims/updateTemplateConfig.jsp",{a:ap,p:path,si:sheetIndex,ni:biffdata.rootNodeId,
cid:a,fileNameRefDomain:k.value}).then(function(a){a=JSON.parse(a);a.isSuccess?silentReload():a.errorMessage&&console.error(a.errorMessage)})};getPromise("/sims/formJSONDef.jsp",{a:ap,p:path,si:sheetIndex}).then(JSON.parse).then(function(a){var b=$("fileNameRefSelect"),d=a.fields;a=Object.getOwnPropertyNames(d);var e=document.createElement("OPTION");b.appendChild(e);a.forEach(function(a){if(d[a].type){var c=document.createElement("OPTION");c.value=a.slice(3,a.length);c.textContent=d[a].name;b.appendChild(c)}});
-1<c.fileNameRefDomainId&&(b.value=c.fileNameRefDomainId)})}(e=c.userGroups)&&0!=e.length||(e=["SYSAdmin","EVERYONE"]);var l=node("div");l.className="cusReportDivContainer";d.appendChild(l);f=node("label");f.className="cusReportConfigLabel";f.appendChild(document.createTextNode(lm.cusReportConfig_accessRight_title));l.appendChild(f);l.appendChild(node("br"));e={a:ap,multiple:!0,dispAdmin:!0,id:"accessRightSelect",selectedGroups:JSON.stringify(e)};getPromise("/sims/groupSelector.jsp",e).then(function(b){var c=
node("div");c.innerHTML=b;b=c.firstChild;l.appendChild(b);var d=enableMultiSelectCombo(b,!1,{keepDropWinOnToggleDropdown:!0,customComboBoxStyles:{minWidth:"250px",maxWidth:"250px",backgroundColor:"white",marginTop:"5px"},fixedValues:["SYSAdmin"]});d.setAfterChangeItem(function(){var b={a:ap,p:path,si:sheetIndex,ni:biffdata.rootNodeId,cid:a,userGroups:JSON.stringify(d.getValues())};postPromise("/sims/updateTemplateConfig.jsp",b).then(function(a){a=JSON.parse(a);a.isSuccess?silentReload():a.errorMessage&&
console.error(a.errorMessage)})})});f=null==c.displayButton?!0:c.displayButton;e=node("div");e.className="cusReportDivContainer";d.appendChild(e);var m=node("input");m.setAttribute("type","checkbox");m.style.verticalAlign="middle";m.checked=f;m.onclick=function(a){ctrl.dropWinLock=!0};m.onchange=function(b){ctrl.dropWinLock=!1;postPromise("/sims/updateTemplateConfig.jsp",{a:ap,p:path,si:sheetIndex,ni:biffdata.rootNodeId,cid:a,displayButton:m.checked}).then(function(a){a=JSON.parse(a);a.isSuccess?
silentReload():a.errorMessage&&console.error(a.errorMessage)})};e.appendChild(m);f=node("label");f.className="cusReportConfigLabel";f.appendChild(document.createTextNode(lm.cusReportConfig_displayButton_title));e.appendChild(f);f=null==c.maintainImgAspectRatio?!1:c.maintainImgAspectRatio;e=node("div");e.className="cusReportDivContainer";d.appendChild(e);var n=node("input");n.setAttribute("type","checkbox");n.style.verticalAlign="middle";n.checked=f;n.onclick=function(a){ctrl.dropWinLock=!0};n.onchange=
function(b){ctrl.dropWinLock=!1;postPromise("/sims/updateTemplateConfig.jsp",{a:ap,p:path,si:sheetIndex,ni:biffdata.rootNodeId,cid:a,maintainImgAspectRatio:n.checked}).then(function(a){a=JSON.parse(a);a.isSuccess?silentReload():a.errorMessage&&console.error(a.errorMessage)})};e.appendChild(n);f=node("label");f.className="cusReportConfigLabel";f.appendChild(document.createTextNode(lm.cusReportConfig_maintainAspectRatio_title));e.appendChild(f);e=$("cusReportSetting");rm(e);e.appendChild(d);$("cusReportSettingOuter").appendChild(e);
dropWin(b,$("cusReportSettingOuter"))}else console.error("Template "+a+" not found")}}function addMailMergeOptions(a){var b=$("otherMailMergeOptions");"none"===b.style.display&&(b.style.display="",a.style.display="none")}
function checkMailMergeDlLimit(a){$("dlSize2")&&$("dlSize2").checked?(-1===biffdata.totalEntry&&getPromise("/sims/getNumOfEntries.jsp",{a:ap,p:path,fn:sheet}).then(updateTotalEntry),$("dlSize2")&&$("dlSize2").checked&&(biffdata.totalEntry>a||-1===biffdata.totalEntry)&&($("dlMsg").style.display="")):$("dlMsg").style.display="none"}function TemplateLibrary(a){this.json=a;this.selectedTemplate=this.selectedCategory=0}
TemplateLibrary.prototype.getJson=function(a){for(var b=this.json.cats,c,d=0;d<b.length;d++)if(b[d].list&&(c=b[d].list.find(function(b){return b.id===a})),c)return c;return null};
TemplateLibrary.prototype.search=function(){for(var a=[],b=[],c=window.user&&window.user.endsWith("@ragic.com"),d=0;d<this.json.cats.length;d++){var e=this.json.cats[d];if(e.list&&0!=e.list.length){e=e.list;for(var f=0;f<e.length;f++){var g=e[f];if("Private"!=g.status||c||"DEV"==window.licenseType)g.name&&-1!=g.name.toUpperCase().indexOf(this.searchText.toUpperCase())?a.push(g):g.desc&&-1!=g.desc.toUpperCase().indexOf(this.searchText.toUpperCase())&&b.push(g)}}}return e={list:a.concat(b)}};
TemplateLibrary.prototype.checkIfCustomized=function(a,b,c){for(var d=this.json.cats,e,f=0;f<d.length&&(d[f].list&&(e=d[f].list.find(function(b){return b.id===a})),!e);f++);d=document.getElementById("templateLibrary")&&document.getElementById("templateLibrary").classList.contains("homeTemplateLibrary");e&&!d?(e=e.installSheets.split("\n"),d={},d.ap=ap,d.sheets=e,getPromise("/sims/checkCustomized.jsp",d).then(JSON.parse).then(function(d){!0===d.ifCustomized?(d=d.sheetsInfo.filter(function(a){return a.ifCustomized}).map(function(a){return a.sheetName}).join(","),
floatWinConfirmV3(lm.updateCustomizedTemplateWaring.replace("{0}","<b>"+d+"</b>"),function(){tlib.install(a,b,c)}),$("floatingWin").style.zIndex=1E4):tlib.install(a,b,c)})):d&&tlib.install(a,b,c)};
TemplateLibrary.prototype.render=function(a){var b=$("templateLibrary");if(b){rm(b);var c;this.searchText&&(c=this.search());c||(c=this.json.cats[this.selectedCategory]);c||(this.selectedCategory=0,c=this.json.cats[this.selectedCategory]);if(c){for(var d=c.list;!d&&this.selectedCategory+1<this.json.cats.length;)c=this.json.cats[++this.selectedCategory],d=c.list;var e=node("div");e.className="templateLibrarySidebar";b.appendChild(e);var f;for(f=0;f<this.json.cats.length;f++)if(c=this.json.cats[f],
c.list&&0!=c.list.length){var g=node("div");g.className="templateLibrarySidebarItem"+(f!=this.selectedCategory||this.searchText?"":"Selected");g.setAttribute("id",f);g.onclick=function(){tlib.searchText=null;tlib.selectedCategory=this.getAttribute("id");tlib.selectedTemplate=0;tlib.render()};e.appendChild(g);var k=node("a");k.href="javascript:void(0);";k.className="templateLibrarySidebarItemText";k.innerHTML=c.name;g.appendChild(k)}f=node("div");f.className="templateLibrarySidebarItem";f.innerHTML=
'<input type="text" id="templateSearchbox" title='+lm.accessibility_templateSearch+' class="templateSearchbox" onblur="ctrl.templateSearchFocus=false;ctrl.outOfNUI=false;" onfocus="ctrl.templateSearchFocus=true;ctrl.outOfNUI=true;" value="'+(this.searchText?this.searchText:"")+'"><div class="templateSearchbutton" onclick="templateSearch();"><i class="fa fa-search"></i></div>';e.appendChild(f);var l=node("div");l.className="templateItemsDiv";b.appendChild(l);e=window.user&&window.user.endsWith("@ragic.com");
for(f=0;f<d.length;f++)if(c=d[f],"Private"!=c.status||e||"DEV"==window.licenseType)if("Yes"!==c["Partner app"]||"DISTR"!==window.licenseType)g=node("div"),g.className=this.selectedTemplate==f?" templateItemDivSelected":"templateItemDiv",g.setAttribute("id",f),g.onclick=function(){tlib.selectedTemplate!==this.getAttribute("id")&&(tlib.selectedTemplate=this.getAttribute("id"),tlib.render(l.scrollTop))},l.appendChild(g),k=node("div"),k.className="templateItemIcon",k.innerHTML=c.icon,k.querySelector("i").classList.add("fa-fw"),
g.appendChild(k),k=node("div"),k.className="templateItemText",k.innerHTML=c.name,k.setAttribute("id",f),k.onclick=function(){tlib.selectedTemplate!==this.getAttribute("id")&&(tlib.selectedTemplate=this.getAttribute("id"),tlib.render(l.scrollTop),event.stopPropagation())},g.appendChild(k),k=node("div"),k.className="templateItemButton",k.innerHTML=c.installed?'<span style="color:#aaaaaa;"><i class="fa fa-check" style="font-size:14px;"></i> '+lm.update+"</span>":lm.get,k.setAttribute("id",c.id),k.setAttribute("installed",
""+c.installed),c.wizardId&&k.setAttribute("wizardId",c.wizardId),k.onmousedown=installTemplateButton,k.ontouchstart=installTemplateButton,g.appendChild(k);a&&(l.scrollTop=a);0==d.length&&(l.innerHTML='<div style="margin:50px;">'+lm.noTemplateMatch+" <b>"+$("templateSearchbox").value+"</b></div>");f=node("div");f.className="templateDetailDiv";b.appendChild(f);if(this.selectedTemplate<d.length){d=d[this.selectedTemplate];a=node("div");a.className="templateItemName";a.innerHTML=d.name;var m=d.doc_url;
m&&(e=node("DIV"),e.onclick=function(){window.open(m)},e.classList.add("templateHelpIconContent"),e.appendChild(document.createTextNode(lm.templateIntro)),a.appendChild(e));f.appendChild(a);a=node("span");a.className="templateItemButton2";a.setAttribute("installed",""+d.installed);a.setAttribute("id",d.id);d.installed?(a.style.background="#dbdbdb",a.innerHTML='<span><i class="fa fa-check" style="font-size:14px;"></i> '+lm.update+"</span>"):a.innerHTML=lm.get;d.wizardId&&a.setAttribute("wizardId",
d.wizardId);a.onmousedown=installTemplateButton;a.ontouchstart=installTemplateButton;f.appendChild(a);a=node("div");a.className="templateItemDesc";a.innerHTML=d.desc;f.appendChild(a);a=node("div");a.className="templateItemSheets";a.innerHTML="<span>"+lm.includedSheets+":</span><br>"+d.sheets;f.appendChild(a);e=node("div");e.className="templateScreenshotDivOuter";f.appendChild(e);a=node("div");a.className="templateScreenshotDivInner";e.appendChild(a);for(f=1;5>=f;f++)d["screenshot"+f]&&(e=node("img"),
e.className="templateItemScreenshot",e.style.width="100%",e.src="https://www.ragic.com/sims/file.jsp?a=kb&f="+d["screenshot"+f]+"&imageResize=335,600",e.srcFull="https://www.ragic.com/sims/file.jsp?a=kb&f="+d["screenshot"+f],e.onclick=function(){window.open(this.srcFull,"_blank")},a.appendChild(e))}b.style.display=""}else ctrl.templateLoadRetryCounter?ctrl.templateLoadRetryCounter++:ctrl.templateLoadRetryCounter=1,5>ctrl.templateLoadRetryCounter?initTemplateLibraryHome():floatWinError("Error loading template, please e-mail support@ragic.com with a screenshot of current screen. Thank you!")}};
function installTemplateButton(){var a=this.getAttribute("id");a=tlib.getJson(a);if(window.edition&&("FREE2"===window.edition||"LITE2"===window.edition)&&"Yes"===a["Paid app"])return lightboxClose(),quickPartnerTemplateBillChangePlan(),!1;this.innerHTML="<i class='fa fa-spinner fa-spin'></i>";ctrl.installTemplateRunning||(ctrl.installTemplateRunning=!0,"true"!=this.getAttribute("installed")||tutorial.enabled?this.getAttribute("wizardId")?this.closest("#templateLibrary").classList.contains("homeTemplateLibrary")?
tlib.install(this.getAttribute("id"),!0,this):location.href="/"+ap+"/apps/"+this.getAttribute("wizardId")+"/index":tlib.checkIfCustomized(this.getAttribute("id"),!0,this):this.getAttribute("wizardId")?location.href="/"+ap+"/apps/"+this.getAttribute("wizardId")+"/manage":(a=this.getAttribute("id"),floatWinConfirmV3(lm.updateTemplateWarning,tlib.checkIfCustomized.bind(tlib,a,!1,this)),$("floatingWin").style.zIndex=1E4))}
TemplateLibrary.prototype.install=function(a,b,c){c&&(c.innerHTML="<i class='fa fa-spinner fa-spin'></i>");window.user?ajaxget("/sims/install.jsp",{id:a,a:ap,newInstall:b?"true":"false",msi:window.menuSetIndex},function(a){a=JSON.parse(a);if(a.error)floatWinError(a.error);else if(a.exec)eval(a.exec),$("floatingWin").style.zIndex=1E4;else if(a.redirMenuSet||0===a.redirMenuSet)location.href="/"+ap+"/home/"+a.redirMenuSet;else{var b=[],c;for(c in a)for(var d=a[c].sheets,k=0;k<d.length;k++)b.push(c+"/"+
d[k].sheetIndex);RagicStorage.localStorage.setItem("INSTALL_ANIMATE",JSON.stringify(b));clearTemplateLibraryCache();location.reload()}}):location.href="/intl/"+window.langv5+"/register?appId="+a};function clearTemplateLibraryCache(){RagicStorage.localStorage.removeItem("loadTemplateServerStartTime");RagicStorage.localStorage.removeItem("templateJSON"+ap+lm.lang);RagicStorage.localStorage.removeItem("templateJSONDate"+ap+lm.lang)}
function templateSearch(){$("templateSearchbox").value&&(tlib.searchText=$("templateSearchbox").value,tlib.render())}var tabColorList;function refreshTabColorList(){RagicStorage.localStorage.removeItem("tabColorListDate"+ap+lm.lang);RagicStorage.localStorage.removeItem("tabColorList"+ap+lm.lang)}
function preInitTabColorList(a){var b=formatDate(new Date,"yyyy/MM/dd hh");if(ctrl.ifLocalStorage&&b==RagicStorage.localStorage.getItem("tabColorListDate"+ap+lm.lang)){var c=RagicStorage.localStorage.getItem("tabColorList"+ap+lm.lang);tabColorList=JSON.parse(c);a&&a()}else ajaxget("/sims/v5Module/colorList.jsp",{a:ap},function(c){var d=JSON.parse(c);ctrl.ifLocalStorage&&(RagicStorage.localStorage.setItem("tabColorList"+ap+lm.lang,c),RagicStorage.localStorage.setItem("tabColorListDate"+ap+lm.lang,
b));tabColorList=d;a&&a()},!0)}var tlib;
function preInitTemplateLibrary(a,b){var c=formatDate(new Date,"yyyy/MM/dd");a=a||lm.lang;if(!ctrl.ifLocalStorage||c!==RagicStorage.localStorage.getItem("templateJSONDate"+ap+a)||"DISTR"===licenseType&&startTime!==RagicStorage.localStorage.getItem("loadTemplateServerStartTime")){var d={a:ap};b&&(d.locale=b);b=getPromise("/sims/v5Module/installTemplates.jsp",d).then(function(b){ctrl.ifLocalStorage&&("DISTR"===licenseType&&RagicStorage.localStorage.setItem("loadTemplateServerStartTime",startTime),RagicStorage.localStorage.setItem("templateJSON"+
ap+a,b),RagicStorage.localStorage.setItem("templateJSONDate"+ap+a,c));return b})}else b=RagicStorage.localStorage.getItem("templateJSON"+ap+a),b=Promise.resolve(b);b=b.then(JSON.parse).then(function(a){tlib=new TemplateLibrary(a);window.preInitTemplatePromise&&delete window.preInitTemplatePromise});return window.preInitTemplatePromise=b}
function initRagicStore(a,b){var c={};a&&(c.appId=a);getPromise("/sims/ragicAppStoreHome.jsp",c).then(JSON.parse).then(function(c){document.body.innerHTML="<div id='returnDiv'><button onclick=''><i class='far fa-angle-left'></i></button></div><div id='ragicAppStoreContainer' style='display:none;'></div>";var d=$("ragicAppStoreContainer"),f=document.createElement("DIV");f.style.marginTop="20px";var g=c.logo,k=document.createElement("DIV"),l=document.createElement("IMG"),m=document.createElement("DIV"),
n=document.createElement("DIV"),q=document.createElement("DIV"),r=document.createElement("I"),p=document.createElement("DIV"),t=document.createElement("I"),v=document.createElement("DIV"),u=document.createElement("DIV"),x=document.createElement("DIV"),E=document.createElement("DIV"),D=document.createElement("DIV"),A=document.createElement("I"),w=document.createElement("DIV"),F=document.createElement("I"),C=document.createElement("DIV"),z=document.createElement("DIV"),J=document.createElement("DIV"),
L=document.createElement("DIV"),B=document.createElement("DIV"),y=document.createElement("DIV"),O=document.createElement("DIV"),K=document.createElement("DIV"),M=[c.image1,c.image2,c.image3,c.image4,c.image5].filter(function(a){return!!a}),Q=document.createElement("DIV"),P=document.createElement("DIV"),G=document.createElement("DIV"),R=document.createElement("DIV"),N=document.createElement("IMG"),H=document.createElement("DIV"),I=document.createElement("DIV"),U=document.createElement("DIV"),T=document.createElement("DIV"),
V=document.createElement("DIV"),S=document.createElement("DIV"),W=document.createElement("I"),X=document.createElement("DIV"),ba=document.createElement("DIV"),fa=document.createElement("DIV"),ja=document.createElement("I"),ka=document.createElement("DIV"),ca=document.createElement("DIV"),oa=document.createElement("DIV"),qa=document.createElement("I"),da=document.createElement("DIV");l.src="/sims/file.jsp?a=rstore&f="+g;N.src="/sims/file.jsp?a=rstore&f="+c.flowChart;k.classList.add("logoBlock");l.classList.add("logoImg");
n.classList.add("appName");q.classList.add("developers");r.classList.add("fa","fa-home");p.classList.add("developerEmails");t.classList.add("fa","fa-envelope");m.classList.add("basicInfoBlock");v.classList.add("priceBlock");u.classList.add("pricePlan");x.classList.add("priceNumber");E.classList.add("installBlock");D.classList.add("installButton");A.classList.add("fas","fa-cloud-download-alt");w.classList.add("updateButton");F.classList.add("fas","fa-arrow-circle-down");C.classList.add("descriptionSection");
z.classList.add("descriptionTitle");J.classList.add("descriptionLine");L.classList.add("descriptionBlock");B.classList.add("previewSection");y.classList.add("previewTitle");O.classList.add("previewLine");K.classList.add("previewBlock");Q.classList.add("tutorialSection");N.classList.add("flowChart");H.classList.add("supportSection");I.classList.add("supportTitle");U.classList.add("supportLine");T.classList.add("supportBlock");V.classList.add("manualBlock");S.classList.add("manualIconBlock");W.classList.add("fas",
"fa-book");X.classList.add("manual");ba.classList.add("supportMailBlock");fa.classList.add("supportMailIconBlock");ja.classList.add("fa","fa-envelope");ka.classList.add("supportMail");ca.classList.add("supportLinesBlock");oa.classList.add("supportLinesIconBlock");qa.classList.add("fas","fa-phone");da.classList.add("supportLines");P.classList.add("tutorialTitle");G.classList.add("tutorialLine");U.classList.add("supportLine");R.classList.add("flowChartBlock");T.classList.add("supportBlock");k.appendChild(l);
f.appendChild(k);n.appendChild(document.createTextNode(c.appName));q.appendChild(r);q.appendChild(document.createTextNode(c.developers));p.appendChild(t);p.appendChild(document.createTextNode(c.developerEmails));m.appendChild(n);m.appendChild(q);m.appendChild(p);f.appendChild(m);x.appendChild(document.createTextNode("US $"+c.price));u.appendChild(document.createTextNode(c.pricePlan));v.appendChild(x);v.appendChild(u);f.appendChild(v);D.appendChild(A);D.appendChild(document.createTextNode("Install"));
w.appendChild(F);w.appendChild(document.createTextNode("Update"));E.appendChild(D);b?(w.style.display="none",D.onclick=function(){window.open("/intl/"+(window.langv5?window.langv5:"en")+"/register?saas="+a)}):(D.style.display="none",w.onclick=function(){w.onclick=function(){};w.replaceChild(document.createTextNode("Updating..."),w.firstChild);floatWinLoading("Please wait until the app update finished...");document.getElementById("floatingWin").style["z-index"]=1E4;postPromise("/sims/installRagicStoreApp.jsp",
{appSourceUrl:c.accountUrl,action:"update",ap:ap}).then(JSON.parse).then(function(a){"success"===a.result?startCheckAppStoreUpdateStatus():floatWinError("<div>Oops...Something was wrong</div><div>"+a.msg+"</div>")})});E.appendChild(document.createElement("DIV"));E.appendChild(w);f.appendChild(E);z.appendChild(document.createTextNode("Description"));L.appendChild(document.createTextNode(c.appIntro));C.appendChild(z);C.appendChild(J);C.appendChild(L);y.appendChild(document.createTextNode("Preview"));
B.appendChild(y);B.appendChild(O);B.appendChild(K);P.appendChild(document.createTextNode("Tutorial"));Q.appendChild(P);Q.appendChild(G);R.appendChild(N);Q.appendChild(R);I.appendChild(document.createTextNode("Support"));g=document.createElement("H3");g.appendChild(document.createTextNode("User Manual"));X.appendChild(g);g=document.createElement("A");g.href=c.manual;g.appendChild(document.createTextNode(c.manual));X.appendChild(g);g=document.createElement("H3");g.appendChild(document.createTextNode("Support Mail"));
ka.appendChild(g);g=document.createElement("A");g.href="mailto:"+c.supportMail;g.appendChild(document.createTextNode(c.supportMail));ka.appendChild(g);g=document.createElement("H3");g.appendChild(document.createTextNode("Support Lines"));da.appendChild(g);g=document.createElement("SPAN");g.appendChild(document.createTextNode(c.supportLines));da.appendChild(g);S.appendChild(W);fa.appendChild(ja);oa.appendChild(qa);V.appendChild(S);V.appendChild(X);ba.appendChild(fa);ba.appendChild(ka);ca.appendChild(oa);
ca.appendChild(da);T.appendChild(V);T.appendChild(ba);T.appendChild(ca);H.appendChild(I);H.appendChild(U);H.appendChild(T);d.appendChild(document.createElement("DIV"));d.appendChild(f);d.appendChild(document.createElement("DIV"));d.appendChild(C);d.appendChild(B);d.appendChild(Q);d.appendChild(H);d.style.display="";for(d=currTransl.length=0;d<M.length;d++)currTransl.push(-K.offsetWidth);oldPreviewBlockWidth=K.offsetWidth;initRagicStorePreview(M,"rstore");var ra=debouncedFn(300,initRagicStorePreview),
pa=function(){offset=K.offsetWidth;intervalArr.forEach(function(a){clearInterval(a)});intervalArr.length=0;$("ragicAppStoreContainer")?ra(M,"rstore"):window.removeEventListener("resize",pa)};window.addEventListener("resize",pa)})}function startCheckAppStoreUpdateStatus(){ajaxget("/sims/backupStatus.jsp",{a:ap,appStore:""},eval);ctrl.timeout=setTimeout(startCheckAppStoreUpdateStatus,1E3)}
function initRagicStorePreviewArrow(a){var b=document.querySelector(".previewBlock");if(!b.querySelector(".fa-angle-right")){var c=function(){m&&(clearInterval(q),n=!0);if(g){g=!1;var c=b.querySelector("#indic_"+f),d=f;f=(f+1+a)%a;for(var e=0;e<a;e++){var p=k.querySelectorAll(".slide")[e],r=currTransl[e]-l;p.style.opacity="1";p.style.transform="translateX("+r+"px)";currTransl[e]=r}e=k.querySelectorAll(".slide")[d];p=currTransl[d]+l*a;e.style.transform="translateX("+p+"px)";e.style.opacity="0";currTransl[d]=
p;d=b.querySelector("#indic_"+f);c.style.backgroundColor="white";d.style.backgroundColor="#9b9c9b";currentIndex=f}},d=document.createElement("I");d.classList.add("far","fa-angle-right");d.style.bottom=b.offsetHeight/2-d.offsetHeight/2-22+"px";d.style.right="5%";var e=document.createElement("I");e.classList.add("far","fa-angle-left");e.style.left="5%";e.style.bottom=b.offsetHeight/2-e.offsetHeight/2-22+"px";var f=currentIndex,g=!0,k=b.querySelector(".imgDiv"),l=b.offsetWidth,m=!0,n=!1,q=setInterval(function(){m=
!1;c()},3E3);intervalArr.push(q);for(var r=function(){g=!0;n&&(q=setInterval(function(){m=!1;c()},3E3),n=!1);m=!0},p=0;p<a;p++){var t=document.querySelectorAll(".slide")[p];transitionEndListener(t,r)}d.addEventListener("click",c);e.addEventListener("click",function(){m&&(clearInterval(q),n=!0);if(g){g=!1;for(var c=b.querySelector("#indic_"+f),d=f=(f-1+a)%a,e=0;e<a;e++){var p=k.querySelectorAll(".slide")[e],r=currTransl[e]+l;p.style.opacity="1";p.style.transform="translateX("+r+"px)";currTransl[e]=
r}e=k.querySelectorAll(".slide")[d];p=currTransl[d]-l*a;e.style.transform="translateX("+p+"px)";e.style.opacity="0";currTransl[d]=p;d=b.querySelector("#indic_"+f);c.style.backgroundColor="white";d.style.backgroundColor="#9b9c9b";currentIndex=f}});k.querySelectorAll("video").forEach(function(a){a.onplay=function(){clearInterval(q)};a.onpause=function(){q=setInterval(function(){m=!1;c()},3E3)};a.addEventListener("webkitfullscreenchange",function(){clearInterval(q)});a.addEventListener("mozfullscreenchange",
function(){clearInterval(q)});a.addEventListener("fullscreenchange",function(){clearInterval(q)})});b.appendChild(e);b.appendChild(d)}}var videoFullScreen=!1,intervalArr=[],currTransl=[],currentIndex=0,oldPreviewBlockWidth,newPreviewBlockWidth;
function initRagicStorePreviewIndicators(a){var b=document.querySelector(".previewBlock");if(!b.querySelector(".indicators")){var c=document.createElement("DIV");c.classList.add("indicatorBlock");for(var d=[],e=0;e<a;e++){var f=new Promise(function(c){var d=document.createElement("DIV");d.style.width=b.offsetWidth/(4*a)+"px";d.id="indic_"+e;c(d)});d.push(f)}Promise.all(d).then(function(a){a.forEach(function(a,b){a.classList.add("indicators");a.style.backgroundColor=b===currentIndex?"#9b9c9b":"white";
c.appendChild(a)})});b.appendChild(c)}}
function initRagicStorePreview(a,b){if(!videoFullScreen){var c=a.length,d=$("ragicAppStoreContainer");if(d){var e=d.querySelector(".previewBlock");d=e.offsetWidth*c;e.querySelector(".imgDiv")&&(e.removeChild(e.querySelector(".imgDiv")),e.querySelector(".far")&&(e.removeChild(e.querySelector(".fa-angle-left")),e.removeChild(e.querySelector(".fa-angle-right"))));e.querySelector(".indicatorBlock")&&e.removeChild(e.querySelector(".indicatorBlock"));var f=[];newPreviewBlockWidth=e.offsetWidth;var g=document.createElement("DIV");
g.style.width=d+"px";g.style.position="relative";g.style.left="0px";g.classList.add("imgDiv");g.style.display="flex";g.style.alignItems="center";a.forEach(function(a){var c=new Promise(function(c){if(a.endsWith(".wmv")||a.endsWith(".ogg")||a.endsWith(".mp4")){var d=document.createElement("VIDEO"),e=document.createElement("SOURCE");e.src="/sims/file.jsp?a="+b+"&f="+a;d.setAttribute("controls","");d.setAttribute("muted","");d.appendChild(e);d.addEventListener("loadstart",function(){c(d)})}else{var f=
new Image;f.addEventListener("load",function(){c(f)});f.src="/sims/file.jsp?a="+b+"&f="+a}});f.push(c)});a=newPreviewBlockWidth/oldPreviewBlockWidth;var k=[];for(d=0;d<currTransl.length;d++)currTransl[d]*=a;for(a=0;a<currTransl.length;a++)k[a]=currTransl[(a+1)%currTransl.length];Promise.all(f).then(function(a){a.forEach(function(a,b){a.style.width=e.offsetWidth;a.classList.add("slide","animate");a.style.transform="translateX("+k[b]+"px)";"VIDEO"===a.tagName&&(a.addEventListener("webkitfullscreenchange",
function(){document.webkitIsFullScreen?videoFullScreen=!0:(videoFullScreen=!0,setTimeout(function(){videoFullScreen=!1},500))}),a.addEventListener("mozfullscreenchange",function(){document.mozFullScreen?videoFullScreen=!0:(videoFullScreen=!0,setTimeout(function(){videoFullScreen=!1},500))}),a.addEventListener("fullscreenchange",function(){document.fullScreen?videoFullScreen=!0:(videoFullScreen=!0,setTimeout(function(){videoFullScreen=!1},500))}));g.appendChild(a)});g.insertBefore(g.children[a.length-
1],g.children[0]);e.appendChild(g);initRagicStorePreviewArrow(c);initRagicStorePreviewIndicators(c)});oldPreviewBlockWidth=newPreviewBlockWidth}}}function initTemplateLibrary(){if(tlib)var a=Promise.resolve("");else(a=window.preInitTemplatePromise)||(a=preInitTemplateLibrary());return a.then(function(){lightboxJS("<div id='templateLibrary' style='display:none;'></div>");tlib.render()})}
function initTemplateLibraryHome(){ajaxget("/sims/v5Module/installTemplates.jsp",{},function(a){a=JSON.parse(a);tlib=new TemplateLibrary(a);tlib.selectedCategory="3";tlib.render()})}
function desktopNotifyLatestTasks(a){!a||isNaN(a)||0>=a||ajaxget("/sims/task/latest.jsp",{a:ap,n:a},function(a){a=JSON.parse(a);var b=!1;a=a.reverse();for(var d=0;d<a.length;d++){var e=a[d],f=e.id,g,k=e.a;if(window.user)if((g=RagicStorage.localStorage.getItem(k+"_"+window.user))&&f>parseInt(g)||!g){if(RagicStorage.localStorage.setItem(k+"_"+window.user,f),e.asg===e.owner)continue}else continue;b=e.ps&&e.oid?"/"+k+e.ps+"/"+e.oid:e.ps?"/"+k+e.ps:"/"+k;"REMINDER"==e.t?desktopNotify(lm.reminder,b,e.txt):
desktopNotify(e.asg,b,e.txt);b=!0}b&&(a=document.createElement("AUDIO"),a.src="/sims/sound/notificationSound.mp3",a.play())})}function showTaskDatePicker(a){var b=document.querySelector(".datePickerRagic");if(b&&(b.style.display="",a)){var c=a.getBoundingClientRect();b.style.top=c.top+document.body.scrollTop+a.offsetHeight+2+"px";b.style.left=c.left+"px"}}function hideTaskDatePicker(){document.querySelector(".datePickerRagic")&&(document.querySelector(".datePickerRagic").style.display="none")}
function showFormatDateToTarget(a,b,c,d){var e=a.value,f=d?getDateFromFormat(e,c):getDateFromFormat(e,"yyyy/MM/dd"),g=null;isNaN(f)||(g=new Date(f));if(g=g?new Date(g):d?smartParseDate(e,c):smartParseDate(e,"yyyy/MM/dd"))c=formatDate(g,c),b.value=c?c:a.value}
function saveTaskDraft(){var a={};a.taskTxt=$("manualTaskTxt").value;a.taskURL=$("taskURL").value;a.taskDesc=$("taskDesc").value;a.assignTo=$("manualTaskAssignTo").value;a.dueDate=$("taskDueDate").value;RagicStorage.localStorage.setItem("RAGIC_TEXT_"+ap+"/task",JSON.stringify(a))}
function createSingleTask(a){ctrl.dropWin=!0;ajaxget("/sims/task/single.jsp",{a:ap},function(b){var c=!$("manualTaskTxt");$("taskDropContent").innerHTML=b;(b=RagicStorage.localStorage.getItem("RAGIC_TEXT_"+ap+"/task"))&&c&&(b=JSON.parse(b),c=$("taskDueDate"),$("manualTaskTxt").value=b.taskTxt,$("taskURL").value=b.taskURL,$("taskDesc").value=b.taskDesc,$("manualTaskAssignTo").value=b.assignTo,c.value=b.dueDate,showFormatDateToTarget(c,$("taskDueDateWF"),a));$("taskDrop").style.maxHeight=null;$("taskDropContentContainer").style.maxHeight=
null;$("taskDetailLink").style.display="none"})}function createSingleTaskHome(){ajaxget("/sims/task/single.jsp",{a:ap,home:!0},function(a){$("achTaskDetail").innerHTML=a})}function manualLongTaskSave(){""==$("taskDetailTitle").value.trim()?floatWin(null,lm.noTaskDesc):0>=$("taskDetailAsg").selectedIndex?floatWin(null,lm.noTaskAssignTo):($("taskDetailForm").submit(),reloadLongTasks())}
function manualSingleTaskAssignExec(){if(""==$("manualTaskTxt").value.trim())floatWin(null,lm.noTaskDesc);else if(0>=$("manualTaskAssignTo").selectedIndex)floatWin(null,lm.noTaskAssignTo);else{var a=$("manualTaskAssignTo").options[$("manualTaskAssignTo").selectedIndex],b=a.getAttribute("apname");ajaxget("/sims/task/singleExec.jsp",{a:b?b:ap,txt:$("manualTaskTxt").value,asg:a.value,taskURL:$("taskURL").value,taskDueDate:$("taskDueDate").value,taskDesc:$("taskDesc").value},function(a){$("taskDropContent").innerHTML=
a;reloadLongTasks();RagicStorage.localStorage.removeItem("RAGIC_TEXT_"+ap+"/task")})}}var throttledManualSinTaskAssignExecHome=throttledFn(1E3,function(a){manualSingleTaskAssignExecHome(a)}),throttledManualSinTaskAssignExec=throttledFn(1E3,function(){manualSingleTaskAssignExec()});
function manualSingleTaskAssignExecHome(a){""==$("manualTaskTxt").value.trim()?floatWin(null,lm.noTaskDesc):ajaxget("/sims/task/singleExec.jsp",{a:a?a:ap,home:!0,taskURL:$("taskURL").value,txt:$("manualTaskTxt").value,asg:$("manualTaskAssignTo").options[$("manualTaskAssignTo").selectedIndex].value,taskDueDate:$("taskDueDate").value,taskDesc:$("taskDesc").value},function(a){RagicStorage.localStorage.removeItem("RAGIC_TEXT_"+ap+"/task");$("achTaskDetail").innerHTML=a})}
function cancelNewTaskHome(){RagicStorage.localStorage.removeItem("RAGIC_TEXT_"+ap+"/task");loadHomeTasks()}function cancelNewTask(){resetTaskContent();$("taskDrop").style.display="none";RagicStorage.localStorage.removeItem("RAGIC_TEXT_"+ap+"/task")}function resetTaskContent(){rm($("taskDropContent"));$("taskDetailLink").style.display=""}
function loadHomeEvents(){window.owner&&($("hiddenEventGear").innerHTML='<i id="GearIcon" onclick="showGearList();" class="fas fa-cog" style="font-size:12px;"></i>');read(function(a){var b=$("achEventDetail"),c=JSON.parse(a.responseText);3>a.responseText.length?b.innerHTML='<p style="margin:8px 0 12px 13px;font-size:12px;color:#ccc;">'+lm.noEvents+"<br/></p>":displayEventsHome(c)},"/sims/calEvents.jsp?q="+formatDate(new Date,"yyyy/MM/dd")+"&a="+ap)}
function loadHomeTasks(){read(function(a){var b=$("achTaskDetail");rm(b);a=JSON.parse(a.responseText).tasks;0==a.length?3>b.innerHTML.length&&(b.innerHTML='<p style="margin:8px 0 12px 13px;font-size:12px;color:#ccc;">'+lm.noTasks+"<br/></p>"):displayTasksHome(a)},"/sims/task/task.jsp?detail&type=P&count=10&a="+ap)}
function displayEventsHome(a){var b=$("achEventDetail");rm(b);var c=formatDate(new Date,"yyyy/MM/dd"),d;for(d in a){var e=a[d];if(0!=e.length){var f=node("div");f.className="achEventDay";var g=parseDate(d);f.innerHTML=formatDate(g,"M/d E");c==d&&(f.style.color="#cc0000");b.appendChild(f);for(g=0;g<e.length;g++){var k=e[g],l=null;k.content?l=k.content:k.fn&&k.title&&(l=k.fn+":"+k.title);if(l){var m='<span style="color:#000">'+l+"</span>",n=k.url;n||(n="/"+ap+k.path+"/"+k.sheetIndex+"/"+k.nodeId);l=
node("li");l.className="achTaskItem achTaskStatusP";b.appendChild(l);f=node("div");f.className="achTaskTextDiv";l.appendChild(f);var q=node("div");q.className="achTaskLinkDiv";f.appendChild(q);f=node("a");f.href=n?n:"javascript:void(0);";f.onclick=function(){ctrl.dropWin=!0};f.innerHTML=m;q.appendChild(f);window.owner&&(f=node("div"),f.className="achTaskGearDiv",f.innerHTML='<i class="fas fa-cog"></i>',l.appendChild(f),(new DMenu([{name:lm.setShortName,func:function(){var a=prompt(lm.setShortName,
this.dmobj.fn);null!==a&&ajaxget("/sims/updateHomeConfig.jsp",{a:ap,action:"shortName",path:this.dmobj.path,si:this.dmobj.sheetIndex,sheetName:this.dmobj.fn.toString(),name:a},function(){loadHomeEvents()})}}],k)).attach(f))}}}}}
function showGearList(){window.owner&&!document.getElementById("eventConfigMenu")&&(ragicMainMenu.hideSideNav(),floatWin(null,lm.prop_loading,lm.homeCalendarEventSelectWin,!0),$("floatingWin").style.top="120px",$("floatingWin").style.left="280px",window.homeCalendarConfigTab||(window.homeCalendarConfigTab=""),window.homeCalendarConfigSelectedCell||(window.homeCalendarConfigSelectedCell={}),getPromise("/sims/homeCalendarConfigEditor.jsp",{a:ap,msi:window.homeCalendarConfigTab,selected:window.homeCalendarConfigSelectedCell}).then(function(a){floatWin(null,
a,lm.homeCalendarEventSelectWin,!0)}))}
function displayTasksHome(a){for(var b=$("achTaskDetail"),c=0;c<a.length;c++){var d=a[c],e=d.txt,f=null;d.url&&(f=d.url);!f&&d.ps&&(f="/"+ap+d.ps+"/"+d.oid);!f||f.startsWith("http://")||f.startsWith("https://")||f.startsWith("/")||(f="http://"+f);var g="/"+d.a+"/task?id="+d.id;f||(f="");b.innerHTML+='<li class="achTaskItem achTaskStatus'+d.s+' transitionIt"><div class="achTaskCheckDiv"><i class="'+("F"==d.s?"fas":"fal")+' fa-check-square" onclick="taskHomeCheckboxClick(\''+f+"',"+(d.ctf?d.id:"null")+
",this,'"+d.a+'\');"></i></div><div class="achTaskTextDiv"><div class="achTaskLinkDiv"><a href="'+g+'" target="_BLANK" rel="noopener noreferrer nofollow">'+e+"</a></div></div></li>"}}
function readTasks(a){window.Notification&&Notification.requestPermission();read(function(b){var c=$("taskDropContent");b=JSON.parse(b.responseText);var d=b.taskFilter;d&&(d.aby?($("tabTaskFilterSelect").value=d.aby+"|",ctrl.taskATO=null,ctrl.taskABY=d.aby):(d.ato?($("tabTaskFilterSelect").value="|"+d.ato,ctrl.taskATO=d.ato):($("tabTaskFilterSelect").value="|",ctrl.taskATO=null),ctrl.taskABY=null));b.tasks&&0!==b.tasks.length?(displayTasks(b.tasks),a&&a(),initAvatars()):(3>c.innerHTML.length&&(c.innerHTML=
'<p style="margin:15px;font-size:14px;">'+lm.noTasks+"<br/></p>"),ctrl.readingTasks=!1,a&&a())},"/sims/task/task.jsp?detail&count&a="+ap+(ctrl.taskATO?"&ato="+ctrl.taskATO:"")+(ctrl.taskABY?"&aby="+ctrl.taskABY:"")+(ctrl.showCompleted?"":"&type=P"))}
function displayTasks(a){var b=$("taskDropContent");resetTaskContent();for(var c=0;c<a.length;c++){var d=a[c],e=d.txt,f=null;d.url&&(f=d.url);!f&&d.ps&&(f="/"+ap+d.ps+"/"+d.oid);f||(f="");!f||f.startsWith("http://")||f.startsWith("https://")||f.startsWith("/")||(f="http://"+f);var g="/"+d.a+"/task?id="+d.id,k=d.dd,l="#555555";if(k){k&&10<k.length&&(k=k.substr(0,10));k=getDateFromFormat(k,"yyyy/MM/dd");var m=getTodayNoTime().getTime();m=k-m;0>m?l="#CC0000":1728E5>m?l="#049d57":6048E5>m&&(l="#228B22");
k=dayAgo(k)}else k="";(new Date).getTimezoneOffset();b.innerHTML+="<li onclick=\"var newTab=window.open();newTab.opener=null;newTab.location='"+g+'\';" class="notifyDropItem taskStatus'+d.s+" transitionIt\"><div style='clear:left;float:right;' class='avatar taskAvatar'>"+getAvatarHTMLByEmail(d.owner,48,d.u)+"</div><div style='clear:left;float:right;color:"+l+";max-width: 15%;' class='taskDueDateDiv'>"+k+'</div><div class="taskCheckDiv"><i class="'+("F"==d.s?"fas fa-check-square":"fal fa-square")+
'" onclick="taskCheckboxClick(event,\''+f+"',"+(d.ctf?d.id:"null")+",this,'"+d.a+"','"+d.s+'\');"></i></div><div class="taskTextDiv"><div class="taskLinkDiv">'+e+'</div><div class="notifAgo">'+timeAgo(Date.parse(d.cd))+"</div></div>"+(f?'<div class="taskExtLink" onclick="window.open(\''+f+'\');event.cancelBubble=true;"><i class="far fa-external-link"></i></div>':"")+"</li>"}initAvatars()}
function searchTaskTitle(a,b){13===event.keyCode&&(event.preventDefault(),a=document.getElementById("searchTaskTitle"),ajaxget("/sims/task/changeFilter.jsp",{aby:ctrl.taskABY,ato:ctrl.taskATO,type:ctrl.showCompleted?"CLEAR":"P",title:a?a.value:""},function(){b&&b();setTimeout(initAvatars,100)}))}
function updateTaskFilter(a,b){a&&(a=a.split("|"),ctrl.taskABY=0<a[0].length?a[0]:null,ctrl.taskATO=0<a[1].length?a[1]:null);a=document.getElementById("searchTaskTitle");ajaxget("/sims/task/changeFilter.jsp",{aby:ctrl.taskABY,ato:ctrl.taskATO,type:ctrl.showCompleted?"CLEAR":"P",title:a?a.value:""},function(){b&&b();setTimeout(initAvatars,100)})}function showTasks(){clearDropWin();resetTaskContent();readTasks(function(){mDropWinClick($("taskTab"),$("taskDrop"),!0,9)})}
function taskHomeCheckboxClick(a,b,c,d,e){e||(e="P");if(b||0===b)b={a:d?d:ap,id:b,cs:e},a&&(b.recordUrl=a),ajaxget("/sims/task/finish.jsp",b,function(){setTimeout(getNotificationCount,1E3)});c&&("P"==e?(c.parentNode.parentNode.style.height="0px",c.parentNode.parentNode.style.padding="0",c.parentNode.parentNode.style.borderBottom="none",c.className="fas fa-check-square"):"F"==e&&(c.className="fal fa-check-square",c.parentNode.parentNode.className="notifyDropItem taskStatusP transitionIt"))}
function taskCheckboxClick(a,b,c,d,e,f){a&&(a.cancelBubble=!0);f||(f="P");ctrl.dropWin=!0;if(c||0===c)a={a:e?e:ap,id:c,cs:f},b&&(a.recordUrl=b),ajaxget("/sims/task/finish.jsp",a,function(){setTimeout(getNotificationCount,1E3)});d&&("P"==f?(d.parentNode.parentNode.style.height="0px",d.parentNode.parentNode.style.padding="0",d.parentNode.parentNode.style.borderBottom="none",d.parentNode.parentNode.querySelector(".taskTextDiv").style.display="none",d.className="fas fa-check-square"):"F"==f&&(d.className=
"fal fa-check-square",d.parentNode.parentNode.className="notifyDropItem taskStatusP transitionIt"))}function blurTask(){ctrl.editingTextArea=null}function focusTask(a){ctrl.editingTextArea=a;a.focus()}function browseNextTaskPage(){reloadLongTasks(null,1)}function browsePrevTaskPage(){reloadLongTasks(null,-1)}function browseFirstTaskPage(){reloadLongTasks(null,"firstPage")}
function taskLongCheckboxClick(a,b,c,d,e){e||(e="P");ctrl.dropWin=!0;if(b||0===b)b={a:d?d:ap,id:b,cs:e},a&&(b.recordUrl=a),ajaxget("/sims/task/finish.jsp",b,function(){setTimeout(getNotificationCount,1E3)});c&&("P"==e?(c.parentNode.parentNode.style.height="0px",c.parentNode.parentNode.style.padding="0",c.parentNode.parentNode.style.borderBottom="none",c.className="fas fa-check-square"):"F"==e&&(c.className="fal fa-check-square"))}
function showNotification(){var a=$("notifyDrop");""===a.style.display?a.style.display="none":(clearDropWin(),ctrl.notificationCached?(a.style.display="",a.style.zIndex=101,floatingPanels.push(a),ctrl.dropWin=!0):getPromise("/sims/task/notificationDetail.jsp",{a:ap}).then(JSON.parse).then(function(a){var b=$("notifyDropContent"),d="";a=a.data;rm(b);for(var e=0;e<a.length;e++){var f=a[e],g=f.notifyFrom,k=f.url;!k||7!==f.type&&6!==f.type||k.startsWith("/")||(k="/"+k);d+='<li class="notifyDropItem'+
(f.ifread?"":" highlight")+"\"><div class='avatar notifAvatar'>"+getAvatarHTMLByEmail(g,48,f.notifyFromName)+'</div><div class="notifTextDiv"><div class="notifLinkDiv"><a'+(k?' href="'+k+'"':' href="javascript:void(0);"')+">"+encHTML(f.subject)+'</a></div><div class="notifAgo">'+timeAgo((new Date(f.date)).getTime())+"</div></div></li>"}d=0==a.length?'<p style="margin:25px;">'+lm.noNotifications+'<br/><div style="margin:12px 25px 25px 25px;"><a style="color:#08c;" href="/'+ap+'/notificationSetting">'+
lm.notificationSetting+"</a></div></p>":d+('<p style="margin:25px;"><a style="color:#08c;" href="/'+ap+'/notifications">'+lm.moreNotifications+"</a></p>");ctrl.notificationCached=!0;b.innerHTML=d;mDropWinClick($("notificationTab"),$("notifyDrop"),!0,9);$("notificationBubble").style.display="none";titleAddNumber(0);initAvatars()}))}
function updateBrowseButton(){var a=$("browseButtonInfo");if(a){var b=$("bNextTaskPage"),c=$("bPrevTaskPage"),d=$("bFirstTaskPage"),e=a.dataset.pageNum;b.style.display="true"===a.dataset.nextButton?"":"none";0<parseInt(e)?(c.style.display="",d.style.display=""):(c.style.display="none",d.style.display="none")}}
function reloadLongTasks(a,b){if($("taskLongListDiv")){var c={a:ap};b&&(c.pd=b);getPromise("/sims/task/taskLong.jsp",c).then(function(b){$("taskLongListDiv").innerHTML=b;initJSAvatar();a&&taskDetail(a);updateBrowseButton()})}}function taskDetail(a,b){b||(b=ap);ajaxget("/sims/task/detail.jsp",{a:b,id:a},function(a){$("taskPane2").innerHTML=a;showTaskComments();initJSAvatar()})}
function newTaskDetail(){$("taskKeyNodeId").value="-1";$("taskDetailTitle").value="";$("taskDetailAsg").selectedIndex=0;$("taskDetailDueDate").value="";$("taskDetailURL").value="";$("taskDetailDesc").value="";$("taskComments").style.display="none"}function taskPage(){location.href="/"+ap+"/task"}function deleteTaskComment(a,b,c){confirm(lm.promptDeleteComment)&&postPromise("/sims/task/comment.jsp",{a:ap,p:path,f:a,n:b,t:c,"delete":!0}).then(function(){showTaskComments();$("nuiiframe").src=""})}
function showTaskComments(){var a=$("taskPane2"),b=$("taskComments");b.classList.remove("displayNone");rm(b);var c=document.createElement("FORM");a=a.querySelector('input[name="a"]')?a.querySelector('input[name="a"]').value:ap;var d=$("taskKeyNodeId").value;c.id="newTaskCommentForm";c.enctype="multipart/form-data";c.action="/sims/task/comment.jsp?multipart&a="+a+"&p="+path+"&n="+d;c.target="nuiiframe";c.method="POST";var e=document.createElement("TEXTAREA");e.id="taskCommentTextarea";e.rows=1;e.classList.add("taskCommentTextareaDisabled");
e.name="content";e.onfocus=function(){var a=$("taskCommentTextarea");ctrl.editingTextArea=a;a.rows=3;a.classList.contains("taskCommentTextareaDisabled")&&(a.value="",a.classList.remove("taskCommentTextareaDisabled"),a.classList.add("taskCommentTextareaEnabled"));$("taskCommentFormSubmitPart").classList.remove("displayNone");a.focus()};e.onpaste=function(a){clipboardUploadImage(this,a)};e.placeholder=lm.writeCommentHere;var f=document.createElement("DIV");f.id="taskCommentFormSubmitPart";f.classList.add("displayNone");
var g=document.createElement("DIV");g.classList.add("topButtonWhole");g.appendChild(document.createTextNode(lm.comment));g.onclick=function(){this.onclick=null;$("newTaskCommentForm").submit()};var k=document.createElement("A");k.id="taskCommentAttachLink";k.onclick=function(){$("taskCommentAttachInput").click()};var l=document.createElement("INPUT");l.type="file";l.id="taskCommentAttachInput";l.name="at";l.classList.add("displayNone");l.onchange=function(){$("taskCommentAttachLinkDesc").textContent=
getFilenameFromInputFile(this.value)};var m=document.createElement("I");m.classList.add("fa","fa-paperclip");k.appendChild(m);m=document.createElement("SPAN");m.id="taskCommentAttachLinkDesc";m.appendChild(document.createTextNode(lm.attachFile));k.appendChild(m);f.appendChild(g);f.appendChild(k);f.appendChild(l);c.appendChild(e);c.appendChild(f);b.appendChild(c);postPromise("/sims/task/comment.jsp",{a:a,p:path,n:d}).then(function(a){var c=document.createElement("DIV");c.innerHTML=a;b.appendChild(c);
initJSAvatar()})}function FilterStatus(){this.filterItems=[];this.domainListing=null}FilterStatus.prototype.getFilterv2String=function(a){var b,c="";for(b=0;b<this.filterItems.length;b++){var d=this.filterItems[b];d.getFilterv2String()&&(c&&(c+="&"),a&&(c+="fv2="),c+=""+d.getFilterv2String())}return c};
FilterStatus.prototype.addFilters=function(a,b){if(a){a=a.split("&");var c;for(c=0;c<a.length;c++){for(var d=a[c].split("|"),e=0,f=d.length;e<f;e++)d[e]=d[e].replace(/%2C/g,",");if(d[1]===FILTER_OPERAND.REGEX+"")for(e=2;e<d.length;e++)f=d[e],f.startsWith("%5CQ")&&f.endsWith("%5CE")&&(f=f.slice(4,f.length-4)),this.addFilter(d[0],1,f,b,"");else e=void 0,3>d.length||(3<d.length&&(e=parseInt(d[2])),this.addFilter(parseInt(d[0]),parseInt(d[1]),d[d.length-1],b,e))}}};
FilterStatus.prototype.addFilter=function(a,b,c,d,e){if(""===c&&(b===FILTER_OPERAND.LIKE&&(b=FILTER_OPERAND.EQ),b!==FILTER_OPERAND.EQ))return;a=new FilterItem(a,b,c,e);a.index=this.filterItems.length;d&&(a.fixed=!0);this.filterItems.push(a)};FilterStatus.prototype.getFilterItems=function(a){var b=[];if(void 0===a)return b;for(var c=0;c<this.filterItems.length;c++)this.filterItems[c].domainId===a&&b.push(this.filterItems[c]);return b};
FilterStatus.prototype.removePQParameterOnUrl=function(){var a=location.search;a=a.substring(1);a=a.split("&").reduce(function(a,c){/^(pq(v|l|r)\d+)|fv2$/.test(c.split("=")[0])||(a+=c);return a},"");history.replaceState(null,"",location.pathname+(""!==a?"?"+a:""))};
FilterStatus.prototype.removeFilter=function(a){this.removePQParameterOnUrl();a==REMOVE_ALL_FILTER?(this.filterItems=[],mode!=BUILDER&&(biffdata.ifListingPage()?ctrl.currentController.load("&gbt","&cl="+REMOVE_ALL_FILTER,function(){mode==BROWSE&&(browse._init(),browse._focus(),$("searchbox")&&($("searchbox").value=""),ctrl.currentNUI.scrollTop=0,clearListingPageCheckbox(),processStar(),updateListingPageAddRowButton())}):ctrl.currentController.load("","&cl="+REMOVE_ALL_FILTER,function(){mode==BROWSE&&
(browse._init(),browse._focus(),$("searchbox")&&($("searchbox").value=""),ctrl.currentNUI.scrollTop=0,clearListingPageCheckbox(),processStar(),updateListingPageAddRowButton())}))):a?this.filterItems.splice(a,1):this.filterItems=[];RagicStorage.localStorage.removeItem("filterDateSet")};FilterStatus.prototype.hasFixedOrderFilter=function(a){for(var b=0;b<this.filterItems.length;b++){var c=this.filterItems[b];if((void 0===a||a==c.domainId)&&c.fixed&&FILTER_OPERAND.isSortingFilter(c.operator))return!0}return!1};
FilterStatus.prototype.v6ApplyFilter=function(a){Array.from(document.querySelectorAll('[name="v6QueryItem"]')).forEach(function(a){a.checked&&(a.checked=!1);a.value&&(a.value="");a.classList.contains("v6QueryTextbox")?$("tExact"+a.id.replace("|8","")).checked=!1:a.classList.contains("dateFilter")?dateSetting("dsCancel"):a.classList.contains("userFilter")&&userSetting("usCancel")});a&&this.removeFilter(REMOVE_ALL_FILTER);toggleResetV6Query();for(var b=0;b<this.filterItems.length;b++){var c=this.filterItems[b],
d=0<c.interm;$("v6QueryTextToggle"+c.domainId);var e=$("v6QuerySelToggle"+c.domainId),f=$("v6Query"+c.domainId),g=void 0;void 0!=f&&(g=f.getAttribute("filtertype"));if((a||!c.fixed)&&!FILTER_OPERAND.isSortingFilter(c.operator)){var k=$("v6QueryItemBar");if(!k)break;k=k.children[k.children.length-1];!f&&k&&"More"===k.textContent&&refreshV6Search(!0);toggleV6Query(c.domainId,1);if(c.operator===FILTER_OPERAND.GTE||c.operator===FILTER_OPERAND.LTE)$(c.domainId+"|"+c.operator+(d?"|"+c.interm:""))&&(d=$(c.domainId+
"|"+c.operator+(d?"|"+c.interm:"")),f="true"===d.dataset.date,"percent"===d.dataset.numbertype&&isNumeric(c.filterValue)?d.value=100*c.filterValue:f&&d.dataset.utctime?(f=getStandardFormat(d.dataset.fmtd),c=decodeURIComponent(c.filterValue),(e=getDateFromFormat(c,f))?(e=dayjs(e).subtract((new Date).getTimezoneOffset(),"minute").toDate(),d.value=formatDate(e,f)):d.value=c):d.value=decodeURIComponent(c.filterValue));else if(c.operator===FILTER_OPERAND.EQ)$(c.domainId+"|"+c.operator+(d?"|"+c.interm:
"")+"|"+c.filterValue)?(e&&""===e.style.display&&toggleV6QueryTextInput(e),$(c.domainId+"|"+c.operator+(d?"|"+c.interm:"")+"|"+c.filterValue).checked=!0):g===FILTER_SELECT||g===FILTER_USER?createOptionIntoSection(c):fillValueIntoSection(c);else if(c.operator===FILTER_OPERAND.LIKE)$(c.domainId+"|8"+(d?"|"+c.interm:""))&&fillValueIntoSection(c);else if(c.operator===FILTER_OPERAND.EQN)for(f=c.filterValue.split(";"),e&&""===e.style.display&&toggleV6QueryTextInput(e),e=0;e<f.length;e++)if($(c.domainId+
"|"+c.operator+(d?"|"+c.interm:"")+"|"+f[e]))$(c.domainId+"|"+c.operator+(d?"|"+c.interm:"")+"|"+f[e]).checked=!0;else if($(c.domainId+"|-1|"+f[e]))$(c.domainId+"|-1|"+f[e]).checked=!0;else for(k=0;k<biffdata.selections.length;k++){if(g=biffdata.selections[k],g[1]==c.domainId){for(k=3;k<g.length;k++){var l=g[k].indexOf("|"),m=g[k].slice(0,l);_value=g[k].slice(l+1);if(m==f[e]){$(c.domainId+"|1"+(d?"|"+c.interm:"")+"|"+encodeURIComponent(_value))&&($(c.domainId+"|1"+(d?"|"+c.interm:"")+"|"+encodeURIComponent(_value)).checked=
!0);break}}break}}else c.operator===FILTER_OPERAND.SS&&(c.filterValue=decodeURIComponent(c.filterValue),"$USER"===c.filterValue?($("usdropdown").setAttribute("belongto","v6Query"+c.domainId),userSetting(c.filterValue)):($("dsdropdown").setAttribute("belongto","v6Query"+c.domainId),dateSetting(c.filterValue)))}}};
function createOptionIntoSection(a){var b=0<a.interm,c=$("v6Query"+a.domainId),d=$$(".v6QueryOption",c),e=node("div",null,"v6QueryOption");0===d.length&&(e.style.marginTop="6px");b=node("input",a.domainId+"|"+a.operator+(b?"|"+a.interm:"")+"|"+a.filterValue);b.name="v6QueryItem";b.type="checkbox";b.checked=!0;b.value="";var f=node("label");f.append(decodeURIComponent(a.filterValue));e.appendChild(b);e.appendChild(f);0!==d.length?insertAfter(e,d[d.length-1]):(a=$("v6QuerySelToggle"+a.domainId),void 0!==
a&&c.insertBefore(e,a))}
function fillValueIntoSection(a){var b=0<a.interm,c=$("v6QueryTextToggle"+a.domainId),d=decodeURIComponent(a.filterValue);c&&""===c.style.display&&toggleV6QueryTextInput(c);d.startsWith("\\Q")&&d.endsWith("\\E")?d=d.slice(2,d.length-2):1!==a.operator&&(d="regex:"+d);if(c=$(a.domainId+"|8"+(b?"|"+a.interm:""))){if("true"===c.dataset.date&&c.dataset.fmtd){var e=JSON.parse(RagicStorage.localStorage.getItem("filterDateSet"));d=e&&e[a.domainId]?e[a.domainId]:d}c.value=d;a.operator===FILTER_OPERAND.EQ?
($("tExact"+a.domainId+(b?"|"+a.interm:"")).checked=!0,$("tExactDiv"+a.domainId+(b?"|"+a.interm:"")).style.display="block"):$("tExactDiv"+a.domainId+(b?"|"+a.interm:"")).style.display="none"}}function FilterItem(a,b,c,d){if("string"===typeof a){var e=a.match(/^([\d\-]+)\|(\d+)\|(.*)$/);if(null!=e)return new FilterItem(+e[1],+e[2],e[3],null)}this.domainId=+a||-1;this.operator=+b||0;this.filterValue=""+c||"";this.interm=d||null}
FilterItem.prototype.getFilterv2String=function(a){var b=this.interm,c=this.operator,d=this.filterValue;d||(d="");if(!this.domainId||!c)return null;a||(d=processDefaultValueString(d));d&&(d=d.replace("|","%7C"));return b&&0<parseInt(b)?this.domainId+"|"+c+"|"+b+"|"+d:this.domainId+"|"+c+"|"+d};function getJSONAttribute(a,b,c){var d;for(d=0;a&&d<a.length;d++)if(a[d].id==b)return a[d][c];return null}
function textFilter(a){temp=a.parentNode.domainId;floatWinPrompt("_textFilter",lm.enterFilterText,lm.filterByText,null,lm.exactMatch);$("filterPanel").style.display="none"}function _textFilter(){var a=""+$("floatWinPromptInput").value,b=!!$("floatWinPromptCheckbox").checked;applyTextFilter(temp,a,b);inNUI();$("floatingWin").style.display="none"}
function applyTextFilter(a,b,c){var d=b.toLowerCase().startsWith("regex:");d&&(b=b.slice(6));ctrl.filterDate[a]=b;RagicStorage.localStorage.setItem("filterDateSet",JSON.stringify(ctrl.filterDate));var e=biffdata.findBiff(a)[0];e.hasAttribute("fmt_d")&&(b=preprocessFilterDateString(b,e.attr.fmt_d,e.attr.utcTime));b=processDefaultValueString(b)||"";b=textFilterValueEscapeProcessing(b);!c&&!d&&0<b.length&&(b="\\Q"+b+"\\E");ctrl.currentController.load("","&fv2add&fv2="+(a+"|"+(c?"1":"8")+"|"+b),function(){mode===
BROWSE&&browse._init();browse._focus();clearListingPageCheckbox()})}function clearFilter(a){ctrl.currentController.load("","&cl="+a.parentNode.domainId,function(){mode==BROWSE&&(browse._init(),browse._focus(),biffdata.ifListingPage()&&sheetScrollToTop())});$("filterPanel").style.display="none"}
function sheetScrollToTop(){for(var a,b=0;b<biffdata.biffs.length;b++){var c=biffdata.biffs[b];if(c.dataType==HEADER){b=nui._getcell(c.x,c.y);a||(a=b);break}}a=findPos(a);b=findPos($("nui_outer"));$("stickyHeader")&&document.body.removeChild($("stickyHeader"));nui.main.scrollTop=a[1]-b[1]}
function setFilterIconClass(a,b,c){a.hasAttribute("fmt_d")?c?b.classList.add("fal","fa-sort-alpha-up","fa-fw"):b.classList.add("fal","fa-sort-alpha-down","fa-fw"):a.hasAttribute("fmt_n")?c?b.classList.add("fal","fa-sort-numeric-up","fa-fw"):b.classList.add("fal","fa-sort-numeric-down","fa-fw"):c?b.classList.add("fal","fa-sort-alpha-up","fa-fw"):b.classList.add("fal","fa-sort-alpha-down","fa-fw")}function getSortingInfo(){return biffdata.additionalInfo}
function getMainSortingDomainId(a){var b=getSortingInfo(),c=[];if(void 0===a)for(a=0;a<b.length;a++)c.push(parseInt(b[a].mainSorting.split(",")[0]));else for(var d=0;d<b.length;d++){var e=b[d];if(e.subtableDomainId&&e.subtableDomainId===a){c.push(parseInt(e.mainSorting.split(",")[0]));break}}return c}
function getSecondarySortingDomainId(a){var b=getSortingInfo(),c=[];if(void 0===a)for(a=0;a<b.length;a++){var d=b[a];if(d.secondarySorting){d=d.secondarySorting.split("|");for(var e=0;e<d.length;e++)c.push(parseInt(d[e].split(",")[0]))}}else for(d=0;d<b.length;d++)if(e=b[d],e.subtableDomainId&&e.subtableDomainId===a){if(e.secondarySorting)for(b=e.secondarySorting.split("|"),a=0;a<b.length;a++)c.push(parseInt(b[a].split(",")[0]));break}return c}
function getMainSortingDirection(a){var b=getSortingInfo(),c=[];if(void 0===a)for(a=0;a<b.length;a++)c.push(parseInt(b[a].mainSorting.split(",")[1]));else for(var d=0;d<b.length;d++){var e=b[d];if(e.subtableDomainId&&e.subtableDomainId===a){c.push(parseInt(e.mainSorting.split(",")[1]));break}}return c}
function getSecondarySortingDirection(a){var b=getSortingInfo(),c=[];if(void 0===a)for(a=0;a<b.length;a++){var d=b[a];if(d.secondarySorting){d=d.secondarySorting.split("|");for(var e=0;e<d.length;e++)c.push(parseInt(d[e].split(",")[1]))}}else for(d=0;d<b.length;d++)if(e=b[d],e.subtableDomainId&&e.subtableDomainId===a){if(e.secondarySorting)for(b=e.secondarySorting.split("|"),a=0;a<b.length;a++)c.push(parseInt(b[a].split(",")[1]));break}return c}
function showFilterIcons(){var a=biffdata.filteredDomains;if(a&&0<a.length){for(var b=0;b<a.length;b++){var c=a[b],d=$("arrow"+c),e=$("stickyarrow"+c);c&&!isNaN(c)&&d&&(d.classList.add("fas","fa-filter","fa-xs"),d.style.top="10px",e&&(e.classList.add("fas","fa-filter","fa-xs"),e.style.top="10px"))}mvpMode&&($("bMvpClearFilter").style.display="")}a=getSortingInfo();b={};for(c=0;c<a.length;b={$jscomp$loop$prop$mainSortingDomainId$550:b.$jscomp$loop$prop$mainSortingDomainId$550,$jscomp$loop$prop$mainSortingDirection$552:b.$jscomp$loop$prop$mainSortingDirection$552,
$jscomp$loop$prop$secondarySortings$551:b.$jscomp$loop$prop$secondarySortings$551},c++){var f=a[c];b.$jscomp$loop$prop$mainSortingDomainId$550=parseInt(f.mainSorting.split(",")[0]);b.$jscomp$loop$prop$mainSortingDirection$552=parseInt(f.mainSorting.split(",")[1]);if((e=biffdata.findHeader(b.$jscomp$loop$prop$mainSortingDomainId$550))&&(d=nui._getcell(e.x,e.y))&&(b.$jscomp$loop$prop$mainSortingDirection$552===SORT_ASC||b.$jscomp$loop$prop$mainSortingDirection$552===SORT_DESC)){d.style.overflowY="hidden";
var g=document.createElement("span");g.classList.add("nuiSortingArrow","nuiSortingIndex");g.onclick=function(a){return function(){applySort(a.$jscomp$loop$prop$mainSortingDomainId$550,[2,0][a.$jscomp$loop$prop$mainSortingDirection$552-1])}}(b);var k=node("i");k.classList.add("nuiSortingIcon");setFilterIconClass(e,k,1!==b.$jscomp$loop$prop$mainSortingDirection$552);g.appendChild(k);f.secondarySorting&&g.appendChild(document.createTextNode(1));d.firstChild&&(e=d.getElementsByTagName("img")[0],d.firstChild.insertBefore(g,
e));if(f.secondarySorting)for(b.$jscomp$loop$prop$secondarySortings$551=f.secondarySorting.split("|"),f={},g=0;g<b.$jscomp$loop$prop$secondarySortings$551.length;f={$jscomp$loop$prop$secondarySortingDomainId$554:f.$jscomp$loop$prop$secondarySortingDomainId$554,$jscomp$loop$prop$secondarySortingDirection$555:f.$jscomp$loop$prop$secondarySortingDirection$555},g++)if(f.$jscomp$loop$prop$secondarySortingDomainId$554=parseInt(b.$jscomp$loop$prop$secondarySortings$551[g].split(",")[0]),f.$jscomp$loop$prop$secondarySortingDirection$555=
parseInt(b.$jscomp$loop$prop$secondarySortings$551[g].split(",")[1]),(e=biffdata.findHeader(f.$jscomp$loop$prop$secondarySortingDomainId$554))&&(d=nui._getcell(e.x,e.y))&&(f.$jscomp$loop$prop$secondarySortingDirection$555===SORT_ASC||f.$jscomp$loop$prop$secondarySortingDirection$555===SORT_DESC)){d.style.overflowY="hidden";k=document.createElement("span");k.classList.add("nuiSortingArrow","nuiSortingIndex");k.onclick=function(a,b){return function(){var c=[a.$jscomp$loop$prop$mainSortingDomainId$550].concat(a.$jscomp$loop$prop$secondarySortings$551.map(function(a){return parseInt(a.split(",")[0])})),
d=[a.$jscomp$loop$prop$mainSortingDirection$552].concat(a.$jscomp$loop$prop$secondarySortings$551.map(function(a){return parseInt(a.split(",")[1])}));applySecondarySort(c,d,b.$jscomp$loop$prop$secondarySortingDomainId$554,[2,0][b.$jscomp$loop$prop$secondarySortingDirection$555-1])}}(b,f);var l=node("i");l.classList.add("nuiSortingIcon");setFilterIconClass(e,l,1!==f.$jscomp$loop$prop$secondarySortingDirection$555);k.appendChild(l);k.appendChild(document.createTextNode(g+2));d.firstChild&&(e=d.getElementsByTagName("img")[0],
d.firstChild.insertBefore(k,e))}}}}function clearSortStorage(){RagicStorage.localStorage.removeItem("psort/"+ap+path+"/"+sheetIndex);RagicStorage.localStorage.removeItem("psort/secondary/"+ap+path+"/"+sheetIndex);RagicStorage.localStorage.removeItem("psort_st/"+ap+path+"/"+sheetIndex);RagicStorage.localStorage.removeItem("psort_st/secondary/"+ap+path+"/"+sheetIndex)}
function applySort(a,b,c){biffdata.ifListingPage()?(RagicStorage.localStorage.removeItem("psort/secondary/"+ap+path+"/"+sheetIndex),mvpMode||(b&&b!==SORT_NODIR&&RagicStorage.localStorage.setItem("psort/"+ap+path+"/"+sheetIndex,a+","+b),b&&b!==SORT_NODIR||RagicStorage.localStorage.removeItem("psort/"+ap+path+"/"+sheetIndex))):(RagicStorage.localStorage.removeItem("psort_st/secondary/"+ap+path+"/"+sheetIndex),b&&b!==SORT_NODIR&&RagicStorage.localStorage.setItem("psort_st/"+ap+path+"/"+sheetIndex,a+
","+b),b&&b!==SORT_NODIR||RagicStorage.localStorage.removeItem("psort_st/"+ap+path+"/"+sheetIndex));c=c||NORMAL_PRIORITY;c="&filterPriority="+c;var d="",e="";b!==SORT_NODIR?(d=getFV2String("fv2=",a,b==SORT_ASC?FILTER_OPERAND.SORT_ASC:FILTER_OPERAND.SORT_DESC,"x"),d="&"+d,ctrl.applySorting=!0):(b=NODOMAIN,biffdata.ifListingPage()||(b=biffdata.findHeader(a,!0).getSubtable().domainId),e="&cl="+REMOVE_ALL_SORT_FILTER+"&subtableKey="+b);ctrl.currentController.load("","&fv2add"+e+d+c,function(){mode==BROWSE&&
browse._init();browse._focus();clearListingPageCheckbox();biffdata.ifListingPage()&&sheetScrollToTop()})}
function applySecondarySort(a,b,c,d,e){c=parseInt(c);d=parseInt(d);var f,g,k="",l="",m=!1,n=!1;a.forEach(function(a,e){0===e?(f=b[e],g=a):n||(1<e&&(k+=",",l+=","),c===a?d===SORT_NODIR?n=!0:(k+=a,l+=d,m=!0):(k+=a,l+=b[e]))});m||d===SORT_NODIR||(0<k.length&&(k+=",",l+=","),k+=c,l+=d);0<k.length?(biffdata.ifListingPage()?RagicStorage.localStorage.setItem("psort/secondary/"+ap+path+"/"+sheetIndex,"&ssdi="+k+"&ssd="+l):RagicStorage.localStorage.setItem("psort_st/secondary/"+ap+path+"/"+sheetIndex,"&ssdi="+
k+"&ssd="+l),ctrl.applySorting=!0):biffdata.ifListingPage()?RagicStorage.localStorage.removeItem("psort/secondary/"+ap+path+"/"+sheetIndex):RagicStorage.localStorage.removeItem("psort_st/secondary/"+ap+path+"/"+sheetIndex);a=[];var q=parseInt(f)===SORT_ASC?FILTER_OPERAND.SORT_ASC:FILTER_OPERAND.SORT_DESC;q=getFV2String("fv2=",g,q,"x");a.push(q);q=k.split(",");for(var r=l.split(","),p=0,t=q.length;p<t;p++){var v=r[p];""!==q[p]&&""!==v&&(v=parseInt(v)===SORT_ASC?FILTER_OPERAND.SECONDARY_SORT_ASC:FILTER_OPERAND.SECONDARY_SORT_DESC,
v=getFV2String("fv2=",q[p],v,"x"),a.push(v))}e=e||NORMAL_PRIORITY;q=NODOMAIN;biffdata.ifListingPage()||(q=biffdata.findHeader(c,!0).getSubtable().domainId);ctrl.currentController.load("","&fv2add&cl="+REMOVE_ALL_SORT_FILTER+"&subtableKey="+q+"&"+a.join("&")+"&filterPriority="+e,function(){mode===BROWSE&&browse._init();browse._focus();clearListingPageCheckbox()})}
function createMainSortDivContent(a,b){var c=$("mainSortingFilterDiv"),d=c.querySelector(".filterPanelNum"),e=c.querySelector(".filterPanelDate"),f=c.querySelector(".filterPanelAlpha");a.biff.hasAttribute("fmt_d")?(d.style.display="none",e.style.display="",f.style.display="none"):a.biff.hasAttribute("fmt_n")?(d.style.display="",e.style.display="none",f.style.display="none"):(d.style.display="none",e.style.display="none",f.style.display="");b?(Array.from(c.querySelectorAll(".arrowDown")).forEach(function(b){b.onclick=
function(){applySort(a.domainId,1,OVER_FIXED_PRIORITY)}}),Array.from(c.querySelectorAll(".arrowUp")).forEach(function(b){b.onclick=function(){applySort(a.domainId,2,OVER_FIXED_PRIORITY)}})):(Array.from(c.querySelectorAll(".arrowDown")).forEach(function(b){b.onclick=function(){applySort(a.domainId,1,NORMAL_PRIORITY)}}),Array.from(c.querySelectorAll(".arrowUp")).forEach(function(b){b.onclick=function(){applySort(a.domainId,2,NORMAL_PRIORITY)}}));c.querySelector(".clearSort").onclick=function(){applySort(a.domainId,
0,NORMAL_PRIORITY)}}
function createSecondarySortDivContent(a,b){var c=a.biff,d=c.domainId+"";if(!biffdata.ifListingPage())var e=c.getSubtable().domainId;var f=getMainSortingDomainId(e);f=0!==f.length?f[0]:NODOMAIN;var g=getMainSortingDirection(e);g=0!==g.length?g[0]:SORT_NODIR;var k=getSecondarySortingDomainId(e);e=getSecondarySortingDirection(e);var l=[],m=[];if(f!==c.domainId){0<k.length?(l=l.concat(f,k),m=m.concat(g,e)):f!==NODOMAIN&&biffdata.findHeader(f)&&(l.push(f),m.push(g));f=node("DIV");g=node("DIV");k=node("DIV");
f.classList.add("filterPanelDiv","secondarySortDiv","arrowDown");g.classList.add("filterPanelDiv","secondarySortDiv","arrowUp");k.classList.add("filterPanelDiv","secondarySortDiv","clearSecondarySort");var n=node("I"),q=node("I");e=node("I");f.appendChild(n);g.appendChild(q);k.appendChild(e);c.hasAttribute("fmt_n")?(n.classList.add("fal","fa-sort-numeric-down","fa-fw"),q.classList.add("fal","fa-sort-numeric-up","fa-fw"),c=lm.secondarySortAscNum.split(","),n=lm.secondarySortDscNum.split(",")):c.hasAttribute("fmt_d")?
(n.classList.add("fal","fa-sort-alpha-down","fa-fw"),q.classList.add("fal","fa-sort-alpha-up","fa-fw"),c=lm.secondarySortAscDate.split(","),n=lm.secondarySortDscDate.split(",")):(n.classList.add("fal","fa-sort-alpha-down","fa-fw"),q.classList.add("fal","fa-sort-alpha-up","fa-fw"),c=lm.secondarySortAscAlpha.split(","),n=lm.secondarySortDscAlpha.split(","));q=node("SPAN");var r=node("SPAN");q.appendChild(document.createTextNode(c[0]));r.appendChild(document.createTextNode(n[0]));for(var p=l.indexOf(d),
t=0;t<l.length;t++){id=l[t];if(id===parseInt(d))break;if(-1===p||t<p){0!==t&&(q.appendChild(document.createTextNode(", ")),r.appendChild(document.createTextNode(", ")));var v=node("B"),u=biffdata.findHeader(id);u&&(v.appendChild(document.createTextNode(u.displayValue.replace(/&#44;/g,","))),q.appendChild(v.cloneNode(!0)),r.appendChild(v))}}q.appendChild(document.createTextNode(c[1]));r.appendChild(document.createTextNode(n[1]));p=node("B");p.appendChild(document.createTextNode(a.biff.displayValue.replace(/&#44;/g,
",")));q.appendChild(p.cloneNode(!0));r.appendChild(p);q.appendChild(document.createTextNode(c[2]));r.appendChild(document.createTextNode(n[2]));f.appendChild(q);g.appendChild(r);e.classList.add("fal","fa-fw");k.appendChild(document.createTextNode(lm.secondarySortNo));var x=NORMAL_PRIORITY;b&&(x=OVER_FIXED_PRIORITY);f.onclick=function(){applySecondarySort(l,m,d,1,x)};g.onclick=function(){applySecondarySort(l,m,d,2,x)};k.onclick=function(){applySecondarySort(l,m,d,0,x)};a=$("secondarySortingFilterDiv");
a.appendChild(f);a.appendChild(g);a.appendChild(k)}}
function showFilterPanel(){if(this.biff){var a=$("filterPanel"),b=this.getBoundingClientRect();if(""==a.style.display){var c=a.getBoundingClientRect().left;a.style.display="none";if(b.left===c)return}if(mode!==BROWSE)floatWin(null,"Filter and sorting not available in editing mode.");else{var d=$("mainSortingFilterDiv"),e=$("secondarySortingFilterDiv");e&&Array.from(e.querySelectorAll(".secondarySortDiv")).forEach(function(a){e.removeChild(a)});(c=$("filterOptionFilter"))&&c.parentElement.removeChild(c);
var f=!0,g=!0,k=!0,l=!0;c=biffdata.filterStatus;if(!biffdata.ifListingPage())var m=this.biff.getSubtable().domainId;k=getMainSortingDomainId(m);k=0!==k.length?k[0]:NODOMAIN;m=c.hasFixedOrderFilter();var n=c.hasFixedOrderFilter(this.biff.domainId)&&this.biff.domainId!=k;m?this.biff.domainId===k?(f=!0,g=k=!1):(f=!1,k=!0,n&&(l=!1)):this.biff.domainId===k?(f=!0,k=!1):(f=!0,k=k===NODOMAIN?!1:!0);f?(createMainSortDivContent(this,m),d.style.display="",g?d.querySelector(".filterPanelDiv.clearSort").style.display=
"":d.querySelector(".filterPanelDiv.clearSort").style.display="none"):d.style.display="none";k?(createSecondarySortDivContent(this,m),e.style.display="",l?e.querySelector(".secondarySortDiv.clearSecondarySort").style.display="":e.querySelector(".secondarySortDiv.clearSecondarySort").style.display="none"):e.style.display="none";this.biff.hasAttribute("interm")&&($("sortingInFilterPanel").style.display="none");l=g=f=d=!1;if(biffdata&&owner){var q=this.biff.getSubtable();q&&(biffdata.filteredDomains&&
biffdata.filteredDomains.find(function(a){return biffdata.findBiff(a).find(function(a){return a.getSubtable()===q})})&&(d=!0),0<getSortingInfo().length&&(g=!0),0<q.defaultFilters.length&&(f=!0),0<q.defaultSortings.length&&(l=!0))}d||f||g||l?($("subtableDefaultFilterPanel").style.display="",$("saveSubtableDefaultFilterAndSorting").style.display=d||g?"":"none",$("removeSubtableDefaultFilterAndSorting").style.display=f||l?"":"none"):$("subtableDefaultFilterPanel").style.display="none";biffdata.ifListingPage()?
$("summaryTotalPanel").style.display="":$("summaryTotalPanel").style.display="none";var r=this.biff.attr.usrref,p=320===this.biff.domainId||312===this.biff.domainId,t=this.biff.attr.checkbox;a.style.top=b.top+this.clientHeight+3+"px";a.style.left=b.left+"px";a.style.minWidth=this.clientWidth+"px";a.style.overflowY="auto";a.style.maxHeight=document.body.clientHeight-b.top-this.clientHeight-30+"px";a.style.display="";a.domainId=this.domainId;a.biff=this.biff;floatingPanels.push(a);ctrl.dropWin=!0;var v=
$("filterOptions");v.domainId=this.domainId;rm(v);if(this.biff.IPType===SELECTOR||this.biff.IPType===MSELECTOR)a=this.biff.hasAttribute("mvp"),a=1>=biffdata.role&&a,b=biffdata.cascadedSelections.hasOwnProperty(this.domainId),a||read(function(a){a=a.responseText.split("\n");var b;for(b=0;b<a.length;b++)if(0!==a[b].length||!a[b].includes("|")){var c=a[b].indexOf("|"),d=a[b].substring(0,c),e=a[b].substring(c+1);""!==e&&(c=node("div"),c.className="filterPanelDiv",c.domainId=v.domainId,c.nodeId=d,c.valueString=
e,c.ifUsrref=r,c.ifSystemField=p,c.dataset.defaultOrder=b,c.dataset.value=e,c.ifCheckbox=t,c.onclick=filterOptionClick,d=cellTextProcess(e.replace(/&#44;/gim,",")),t&&(d=checkboxSymbolRender(d)),c.innerHTML=d,v.appendChild(c))}0<v.children.length&&v.parentElement.insertBefore(createFilterOptionFilterDOM(),v)},"/sims/options.jsp?a="+ap+"&p="+encodeURIComponent(path)+"&si="+sheetIndex+"&d="+this.domainId+(b?"&fv2="+encodeURIComponent(c.getFilterv2String()):"")+(t?"&checkbox":""))}}}
function createFilterOptionFilterDOM(){function a(){var a=e.value,b=$("filterOptions").dataset.searchText||"";a!==b&&(b=e.orderCallbackID,void 0!==b&&clearTimeout(b),e.orderCallbackID=setTimeout(function(){reorderOptionsBySearchText(a);delete e.orderCallbackID;d.classList.remove("fa-spinner","fa-spin");d.classList.add("fa-search")},500),d.classList.remove("fa-search"),d.classList.add("fa-spinner","fa-spin"))}var b=node("div");b.id="filterOptionFilter";b.onclick=function(a){a.stopPropagation()};var c=
node("hr");b.append(c);var d=node("i");d.classList.add("fa","fa-search");c=node("div");c.append(d);b.append(c);var e=node("input");e.autocomplete="off";e.onfocus=function(a){ctrl.outOfNUI=!0};e.onblur=function(a){ctrl.outOfNUI=!1};e.onchange=e.onkeyup=e.onpaste=e.oncut=function(b){b.stopPropagation();"paste"===b.type||"cut"===b.type?setTimeout(a,0):a()};c.append(e);return b}
function reorderOptionsBySearchText(a){var b=$("filterOptions");if(a!==(b.dataset.searchText||"")){b.dataset.searchText=a;var c=function(a,b){if(a===b)return 3;if(b.includes(a))return 2;a=a.toLowerCase();return b.toLowerCase().includes(a)?1:0},d=function(a,b,d){var e=b.dataset.value,f=d.dataset.value;if(""===a)return 0;b.similarityLevel=b.similarityLevel||c(a,e);d.similarityLevel=d.similarityLevel||c(a,f);a=b.similarityLevel-d.similarityLevel;return 0===a?0:0<a?-1:1};""===a&&(d=function(a,b,c){return b.dataset.defaultOrder-
c.dataset.defaultOrder});var e=Array.prototype.slice.apply(b.childNodes);e.forEach(function(a){delete a.similarityLevel});e.sort(d.bind(null,a));for(a=0;a<e.length;++a)d=e[a],void 0===d.similarityLevel||0<d.similarityLevel?d.classList.remove("hide"):d.classList.add("hide"),b.append(d)}}
function totalSummary(a,b,c){b||(b=window.event);b&&(b.cancelBubble=!0);var d=$("filterOptions");d.innerHTML='<i class="fa fa-spinner fa-spin" style="margin:25px;"></i>';a={a:ap,p:path,fn:sheet,d:a};c&&(a.showSingle="");getPromise("/sims/totalSummary.jsp",a).then(function(a){d.innerHTML=a;a=document.getElementById("filterOptionFilter");null!==a&&(a.style.display="none")})}
function filterOptionClick(){var a=this.domainId+"|1|"+textFilterValueEscapeProcessing(this.valueString);this.ifCheckbox?a=this.domainId+"|8|"+textFilterValueEscapeProcessing(this.valueString):this.ifSystemField?a=this.domainId+"|1|"+this.nodeId:$(this.domainId+"|-1|"+this.nodeId)&&(a=this.domainId+"|-1|"+this.nodeId);ctrl.currentController.load("","&fv2add&fv2="+a,function(){mode==BROWSE&&(browse._init(),browse._focus(),showFilterPanel(),clearListingPageCheckbox(),biffdata.ifListingPage()&&sheetScrollToTop())})}
function showSpecialSettingMenu(a,b,c){if((c=$(c))&&""===c.style.display)c.style.display="none";else{clearDropWin();cancelEventBubble(a);a=b.getBoundingClientRect();var d=document.documentElement||document.body;if(b.parentNode.parentNode.hasAttribute("lock")){for(;c.lastChild.nodeType===Node.TEXT_NODE;)c.removeChild(c.lastChild);c.lastChild.style.display=""}else{for(;c.lastChild.nodeType===Node.TEXT_NODE;)c.removeChild(c.lastChild);c.lastChild.style.display="none"}floatingPanels.push(c);c.style.display=
"";c.style.left=a.left+b.offsetWidth+5+"px";c.setAttribute("belongTo",b.parentNode.parentNode.id);c.style.top=(0<d.offsetHeight-a.bottom&&0===getParameterByName("webaction").length?a.top-c.offsetHeight+b.offsetHeight:a.top)+"px";$("v5Sidebar")&&c.setAttribute("sideScrollTop",$("v5Sidebar").scrollTop+"")}}
function dateSetting(a){var b;if(a.startsWith("$NEXT-X")||a.startsWith("$PAST-X")||a.startsWith("$NEXTMIN-X")){var c=a.split("-");if(2<c.length){var d=c.slice(0,c.length-1).join("-");var e=parseInt(c[2]);e=isNaN(e)?-1:e}else d=c.join("-");a=d;$(d)&&(b=$(d).closest("[belongto]"))}else $(a)&&(b=$(a).closest("[belongto]"));if(b&&(b=$(b.getAttribute("belongto")))){for(;b.children[0].classList.contains("dateFilter");)b.removeChild(b.children[0]);if("dsCancel"!==a){Array.prototype.forEach.call(b.querySelectorAll('INPUT[name="v6QueryItem"]'),
function(a){a.name="hideV6QueryItem"});d=0;for(c=b.children.length-1;d<c;d++)b.children[d].style.display="none";var f=node("div");d=b.querySelector("INPUT").id.split("|");d[1]=FILTER_OPERAND.SS+"";f.id=d.join("|");f.className="dateFilter";if(d=$(a).dataset.xdate){c=d.split("{0}");d=document.createTextNode(c[0]);c=document.createTextNode(c[1]);var g=node("INPUT");g.type="text";g.classList.add("xdateInput");void 0!==e&&-1<e&&(g.value=e,f.value=a+"-"+e);g.onchange=function(){f.value=a+"-"+g.value};f.append(d);
f.append(g);f.append(c)}else f.textContent=$(a).textContent,f.value=a;f.setAttribute("name","v6QueryItem");f.ondblclick=function(a){a.target.classList.contains("xdateInput")||dateSetting("dsCancel")};b.prepend(f);b.setAttribute("lock",!0)}else{Array.prototype.forEach.call(b.querySelectorAll('INPUT[name="hideV6QueryItem"]'),function(a){a.name="v6QueryItem"});if(e=b.querySelector("[id^=v6QueryTextToggle]"))e.style.display="";if(e=b.querySelector(".v6QueryQuickSearchIcon.besideToggle"))e.style.display=
"";if(e=b.querySelector(".dateFilterPart"))e.style.display="";if(e=b.querySelector(".specialSetterContent"))e.style.display="";b.removeAttribute("lock")}}}
function userSetting(a){var b=$(a).closest("[belongto]");if(b=$(b.getAttribute("belongto"))){for(;b.children[0].classList.contains("userFilter");)b.removeChild(b.children[0]);if("usCancel"!==a){b.children[0].style.display="none";Array.prototype.forEach.call(b.querySelectorAll('INPUT[name="v6QueryItem"]'),function(a){a.name="hideV6QueryItem"});Array.prototype.forEach.call(b.querySelectorAll(".v6QueryOption"),function(a){a.style.display="none"});b.querySelector(".v6QueryQuickSearchIcon")&&(b.querySelector(".v6QueryQuickSearchIcon").style.display=
"none");var c=node("div");b.id.substr(7);var d=b.querySelector("INPUT").id.split("|");d[1]=FILTER_OPERAND.SS+"";c.id=d.join("|");c.className="userFilter";b.prepend(c);c.textContent=$(a).textContent;c.value=a;c.setAttribute("name","v6QueryItem");c.ondblclick=function(){userSetting("usCancel")};b.setAttribute("lock",!0)}else Array.prototype.forEach.call(b.querySelectorAll('INPUT[name="hideV6QueryItem"]'),function(a){a.name="v6QueryItem"}),b.querySelector(".v6QueryQuickSearchIcon").style.display="",
b.children[0].style.display="",Array.prototype.forEach.call(b.querySelectorAll(".v6QueryOption"),function(a){a.style.display=""}),b.removeAttribute("lock")}}
function v6CreateFilterString(a){if(ctrl.saveSelectedAsView){a="&fv2="+biffdata.rootDomainId+"|-1|";var b=getCheckedRootNodeIds();a+=b.join(";");ctrl.saveSelectedAsView=!1;v6Search(a,",");return a}var c=new FilterStatus,d="";b=document.querySelectorAll("[name='v6QueryItem']");for(var e=0;e<b.length;e++){var f=b[e],g=f.id,k=f.value,l=k&&"string"==typeof k?k.toLowerCase().startsWith("regex:"):!1,m="v6QueryTextbox"===f.className&&$("tExact"+g.replace("|"+FILTER_OPERAND.LIKE,"")).checked,n="DIV"===f.tagName,
q="percent"===f.dataset.numbertype,r="true"===f.dataset.date,p=g.split("|")[0];if(f.value||m||f.checked){d="";d=m?d+g.replace("|"+FILTER_OPERAND.LIKE,"|"+FILTER_OPERAND.EQ):d+g;q&&isNumeric(k)&&(k/=100);r&&f.dataset.fmtd&&!l&&""!==k&&(ctrl.filterDate[p]=k,RagicStorage.localStorage.setItem("filterDateSet",JSON.stringify(ctrl.filterDate)),k=preprocessFilterDateString(k,f.dataset.fmtd,f.dataset.utctime));if("SELECT"===f.tagName.toUpperCase())(f=f.options[f.selectedIndex])&&f.value&&(d+=f.value);else if("v6QueryDatebox"===
f.className)d+="|"+encodeURIComponent(k);else if(k||m)l||m||n?l&&(k=k.slice(6)):k="\\Q"+k+"\\E",d+="|"+encodeURIComponent(k);c.addFilters(d)}}if(biffdata&&0<biffdata.orderDomain.length&&0<biffdata.orderDir.length&&biffdata.orderDomain[0]!==NODOMAIN&&biffdata.orderDir[0]!==SORT_NODIR&&(d=biffdata.orderDomain[0]+"|2"+biffdata.orderDir[0]+"|x",c.addFilters(d),biffdata.additionalInfo&&biffdata.additionalInfo.secondarySortDomainIds)){b=biffdata.additionalInfo.secondarySortDomainIds.split(",");var t=biffdata.additionalInfo.secondarySortDirections.split(",");
b.length===t.length&&b.forEach(function(a,b){d=a+"|2"+(parseInt(t[b])+2)+"|x";c.addFilters(d)})}if(a)for(a=biffdata.filterStatus,b=0;b<a.filterItems.length;b++)if(g=a.filterItems[b],!g.fixed)if(e=g.domainId,f=g.operator,g=g.filterValue,k=c.getFilterItems(e),0===k.length)c.addFilter(e,f,g);else if(FILTER_OPERAND.isSortingFilter(f)){l=!1;for(m=0;m<k.length;m++)if(k[m].operator==f){l=!0;break}0==l&&c.addFilter(e,f,g)}return("&"+c.getFilterv2String(!0)).replace(/%2C/g,"%26%2344%3B").replace(/%7C/g,"%26%23124%3B")}
function preprocessFilterDateString(a,b,c){var d=!1;if(/^\d{4}\/\d{2}\/\d{2}(\s\d{2}:\d{2}:\d{2})?$/.test(a))return a;var e=ragic_date_parseV2(a,b);e&&(c&&(e=dayjs(e).add((new Date).getTimezoneOffset(),"minute").toDate()),b=formatDate(e,getStandardFormat(b,null,!0)),b.length===a.length&&(a=b,d=!0),d||10!==a.length||(b=formatDate(e,"yyyy/MM/dd"),b.length===a.length&&(a=b)));return a}
function v6Search(a,b,c){if(mode!==UPDATE&&mode!==BUILDER||confirm(lm.away)){mode===UPDATE&&modeBrowse();var d="&gbt";c&&(d+=c);$("searchbox")&&($("searchbox").value="");a?(a=a.replace(new RegExp(b,"gim"),"&fv2="),ctrl.currentController.load(d,a,function(){mode===BROWSE&&(browse._init(),browse._focus(),clearListingPageCheckbox(),processStar(),updateListingPageAddRowButton())})):ctrl.currentController.load(d,v6CreateFilterString(),function(){mode===BROWSE&&(browse._init(),browse._focus(),sheetScrollToTop(),
clearListingPageCheckbox())})}}
function updateSidebarViewHighlight(){for(var a=document.getElementsByClassName("v6RecentItemNow");a&&0<a.length;)a[0].classList.remove("v6RecentItemNow"),a=document.getElementsByClassName("v6RecentItemNow");if(a=document.getElementsByClassName("viewLink")){var b=biffdata.filterStatus.filterItems;if(b&&0!==b.length){var c=[];b.forEach(function(a){var b=a.domainId,d=a.operator,e=a.filterValue.includes("$")?encodeURIComponent(a.filterValue):a.filterValue;a=a.interm;b=b+"|"+d+(a?"|"+a:"")+"|"+e;c.includes(b)||
c.push(b)});var d;(b=document.querySelector("#v6FixedQueries li a"))&&(d=decodeURIComponent(b.getAttribute("filterString")).split("&"));b={};for(var e=0;e<a.length;b={$jscomp$loop$prop$viewsFilterStringArray$558:b.$jscomp$loop$prop$viewsFilterStringArray$558},e++){var f=decodeURIComponent(a[e].getAttribute("filterString"));b.$jscomp$loop$prop$viewsFilterStringArray$558=f.split("&");d&&d.forEach(function(a){return function(b){a.$jscomp$loop$prop$viewsFilterStringArray$558.includes(b)||a.$jscomp$loop$prop$viewsFilterStringArray$558.push(b)}}(b));
c.length===b.$jscomp$loop$prop$viewsFilterStringArray$558.length&&c.every(function(a){return function(b){return a.$jscomp$loop$prop$viewsFilterStringArray$558.includes(b)}}(b))&&a[e].classList.add("v6RecentItemNow")}}}}
function toggleResetV6Query(){var a=$("v6QueryItemBar");if(a)for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];c.id&&c.id.includes("v6Query")&&(c=c.id.substr(7),"1"===RagicStorage.localStorage.getItem("v6Query"+c+"_isOpen_"+ap+path+"/"+sheetIndex)?toggleV6Query(c,1):toggleV6Query(c,2))}}
function toggleV6Query(a,b){var c=$("v6Query"+a),d=$("v6QueryArrow"+a);if(c&&d){var e=b?b:"none"==c.style.display?1:2;1==e?(c.style.display="",d.innerHTML='<i class="fa fa-caret-down" style="font-size:14px;"></i>'):(c.style.display="none",d.innerHTML='<i class="fa fa-caret-right" style="font-size:14px;"></i>');void 0===b&&RagicStorage.localStorage.setItem("v6Query"+a+"_isOpen_"+ap+path+"/"+sheetIndex,e)}}
function renameV6Query(a){$("floatingWin").style.display="none";_renameV6Query(a,$("floatWinPromptInput").value)}function renameV6DesignerQuery(a){$("floatingWin").style.display="none";_renameV6DesignerQuery(a,$("floatWinPromptInput").value)}function _renameV6DesignerQuery(a,b){read(evalJS,"/sims/saveDesignerQuery.jsp?rename&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+"&seq="+a+"&v="+uiversion+"&name="+b)}
function _renameV6Query(a,b){read(evalJS,"/sims/saveQuery.jsp?rename&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+sheetIndex+"&n="+a+"&v="+uiversion+"&name="+b)}function deleteV6Query(a){read(evalJS,"/sims/saveQuery.jsp?delete&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+sheetIndex+"&n="+a+"&v="+uiversion)}function deleteV6DesignerQuery(a){read(evalJS,"/sims/saveDesignerQuery.jsp?delete&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+"&seq="+a+"&v="+uiversion)}
function setV6DefaultQuery(a){read(evalJS,"/sims/saveDesignerQuery.jsp?setDefault&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+"&seq="+a+"&v="+uiversion)}function removeV6DefaultQuery(){read(evalJS,"/sims/saveDesignerQuery.jsp?removeDefault&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+"&v="+uiversion)}
function addV6DesignerQueryNotify(a,b){ajaxpost("/sims/saveDesignerQuery.jsp",{addNotify:"",a:ap,p:path,fn:sheet,seq:a,v:uiversion},function(a){try{JSON.parse(a).success&&b.setAttribute("notify",!0)}catch(d){console.log(d)}})}function removeV6DesignerQueryNotify(a,b){ajaxpost("/sims/saveDesignerQuery.jsp",{removeNotify:"",a:ap,p:path,fn:sheet,seq:a,v:uiversion},function(a){try{JSON.parse(a).success&&b.setAttribute("notify",!1)}catch(d){console.log(d)}})}
function showV6TextQueryOpts(a){outNUI();ctrl.sidebarSearchFocus=!0;$("tExactDiv"+a).style.display="block";biffdata&&biffdata.keyField&&1E5<biffdata.totalEntry&&($("tExact"+a).checked="checked")}function hideV6TextQueryOpts(a){inNUI();ctrl.sidebarSearchFocus=!1;window.setTimeout(function(){$("tExact"+a).checked||($("tExactDiv"+a).style.display="")},350)}function toggleV6TextParentNode(a){a.checked||(a.parentNode.style.display="")}
function toggleV6QueryTextInput(a){a=a.parentNode.children;for(var b=a.length;b--;)if("none"==a[b].style.display){if(a[b].style.display="",a[b].firstChild&&"v6QueryTextbox"===a[b].firstChild.className){var c=a[b].firstChild;c.style.width="113px";c.value=""}}else a[b].firstChild&&a[b].firstChild.checked&&(a[b].firstChild.checked=""),a[b].style.display="none"}
function toggleV6QueryDateTextInput(a,b){a=a.parentNode;var c=a.children;if(b)switch(Array.from(c).forEach(function(a){a.style.display="none"}),b){case "date":a.querySelector("[id^=v6QueryTextToggle]").style.display="";a.querySelector(".v6QueryQuickSearchIcon.besideToggle").style.display="";a.querySelector(".dateFilterPart").style.display="";a.querySelector(".specialSetterContent").style.display="";break;case "text":a.querySelector("[id^=v6QuerySelToggle]").style.display="",a.querySelector(".textFilterPart").style.display=
""}}function showV6QueryDropdown(a,b){clearDropWin();var c;a=a||window.event;a.which?c=3==a.which:a.button&&(c=2==a.button);c&&(b.oncontextmenu=function(a){_showV6QueryDropdown(a,b)})}function showV6QueryDropdownLeftVer(a,b){clearDropWin();_showV6QueryDropdown(a,b)}
function createReplaceDesignerViewFloatingWin(a,b){a="<p style='margin:12px 5px 12px 25px;'>"+lm.replaceOldCheckMsg.replace("{0}",a)+"</p><p><span style='margin:12px 5px 12px 25px;' class='topButtonWhole' onclick=\"floatWinClose();_replaceDesignerView("+b+');">'+lm.yes+"</span><span style='margin:12px 8px 12px 8px;' class='topButtonWhole' onclick=\"floatWinClose();\">"+lm.no+"</span></p>";floatWin(null,a,"",!0)}
function createReplacePersonalViewFloatingWin(a,b){a="<p style='margin:12px 5px 12px 25px;'>"+lm.replaceOldCheckMsg.replace("{0}",a)+"</p><p><span style='margin:12px 5px 12px 25px;' class='topButtonWhole' onclick=\"floatWinClose();_replacePersonalView("+b+');">'+lm.yes+"</span><span style='margin:12px 8px 12px 8px;' class='topButtonWhole' onclick=\"floatWinClose();\">"+lm.no+"</span></p>";floatWin(null,a,"",!0)}
function _replaceDesignerView(a){$("floatingWin").style.display="none";ctrl.outOfNUI=!1;var b=v6CreateFilterString(!0);postPromise("/sims/saveDesignerQuery.jsp",{seq:a,update:"",qs:b,a:ap,p:path,fn:sheet}).then(eval)}function _replacePersonalView(a){$("floatingWin").style.display="none";ctrl.outOfNUI=!1;var b=v6CreateFilterString(!0);postPromise("/sims/saveQuery.jsp",{qid:a,update:"",qs:b,a:ap,p:path,fn:sheetIndex}).then(eval)}
function _showV6QueryDropdown(a,b){cancelEventBubble(a);var c=$("v6QueryDropdown");if(c){var d=c.children;if(b.hasAttribute("nodeId")){d[0].style.display="";d[0].onclick=function(){deleteV6Query(b.getAttribute("nodeId"))};for(var e=1;e<d.length;e++)d[e].style.display="none";$("renamePersonalViews").style.display="";$("renamePersonalViews").onclick=function(){v6RenameFilter(b.getAttribute("nodeId"),b.title)};$("replaceOldView").style.display="";$("replaceOldView").onclick=function(){createReplacePersonalViewFloatingWin(b.title,
b.getAttribute("nodeId"))}}else if(b.hasAttribute("seq")){e=JSON.parse(b.getAttribute("canNotify"));var f=b.getAttribute("systemFieldNames");if(owner){d[0].style.display="none";d[4].style.display="none";$("renamePersonalViews").style.display="none";d[1].style.display="";d[1].onclick=function(){getPromise("/sims/getDesignerQueryDependencies.jsp",{a:ap,p:path,si:sheetIndex,seq:b.getAttribute("seq")}).then(function(a){a.error&&Promise.reject(a.error);a=JSON.parse(a);if(0<Object.keys(a).length){var c=
"<div><b>"+lm.removeSystemQuery_confirm_1+"</b></div>";c+='<div style="margin:5px 0;">'+lm.removeSystemQuery_confirm_2+": </div>";c+='<table style="font-size:13px;margin:10px 0;">';for(var d in a){var e=a[d];c+="<tr>";c+='<td style="vertical-align:top;font-weight:bold;">';c+='<div style="margin:5px">'+lm[d]+": </div>";c+="</td>";c+="<td>";c+='<ul style="margin:5px">';e.forEach(function(a){c+="<li>"+a+"</li>"});c+="</ul>";c+="</td>";c+="</tr>"}c+="</table>";floatWinConfirmV3(c,function(){deleteV6DesignerQuery(b.getAttribute("seq"))});
return Promise.resolve(!1)}return Promise.resolve(!0)}).then(function(a){a&&deleteV6DesignerQuery(b.getAttribute("seq"))})};b.hasAttribute("default")?(d[2].style.display="none",d[3].style.display="",d[3].onclick=removeV6DefaultQuery):(d[2].style.display="",d[2].onclick=function(){setV6DefaultQuery(b.getAttribute("seq"))},d[3].style.display="none");d=$("renameSystemViews");var g=$("reorderSharedViews"),k=$("setGroupsOfView"),l=$("customEmail_notify_view");d.style.display="";d.onclick=function(){v6RenameSystemViews(b.getAttribute("seq"),
b.title)};g.style.display="";g.onclick=function(a){sortSharedViews(a,this.parentNode)};k.style.display="";k.onclick=function(a){setViewsGroup(b.getAttribute("seq"))};$("replaceOldView").style.display="";$("replaceOldView").onclick=function(){createReplaceDesignerViewFloatingWin(b.title,b.getAttribute("seq"))};l&&(e?(l.onclick=function(){floatWin(null,lm.prop_loading,b.title,!0,null,!1);ctrl.notifyViewTabsBuilder.filterSeq=b.getAttribute("seq");ctrl.notifyViewTabsBuilder.triggerObj=b;ctrl.notifyViewTabsBuilder.renderTabs($("floatingWinContent"))},
l.style.color="#0066FF"):(l.onclick=function(){floatWin(null,getBundleString("systemQueryNotifyNotNotifiable",[f]))},l.style.color="grey"))}else d[0].style.display="none",$("renamePersonalViews").style.display="none";d=$("sharedSystemViewsURL");d.style.display="";d.onclick=function(){var a=location.protocol+"//"+location.host+"/"+ap+path+"/"+sheetIndex+"?embed&hidetop&view="+b.getAttribute("seq"),c=location.protocol+"//"+location.host+"/"+ap+path+"/"+sheetIndex+"?api&filterId="+b.getAttribute("seq"),
d=location.protocol+"//"+location.host+"/"+ap+path+"/"+sheetIndex+".xlsx?view="+b.getAttribute("seq");floatWin(null,"<div>"+lm.shareViewURLMsg+'</div><div><input onclick="this.select();" style="margin: 10px 0;width: 90%" value="'+a+'" readonly="readonly"></div><div>'+lm.shareViewApiURLMsg+'</div><div><input onclick="this.select();" style="margin: 10px 0;width: 90%" value="'+c+'" readonly="readonly"></div></div><div>'+lm.shareViewExcelDownload+'</div><div><input onclick="this.select();" style="margin: 10px 0;width: 90%" value="'+
d+'" readonly="readonly"></div></div>')};JSON.parse(b.getAttribute("notify"))?($("addSystemQueryNotify").style.display="none",$("removeSystemQueryNotify").style.display="",e?($("removeSystemQueryNotify").onclick=function(){removeV6DesignerQueryNotify(b.getAttribute("seq"),b)},$("addSystemQueryNotify").style.color="#0066FF",$("removeSystemQueryNotify").style.display="#0066FF"):($("removeSystemQueryNotify").onclick=function(){floatWin(null,getBundleString("systemQueryNotifyNotNotifiable",[f]))},$("addSystemQueryNotify").style.color=
"grey",$("removeSystemQueryNotify").style.display="grey")):($("addSystemQueryNotify").style.display="",$("removeSystemQueryNotify").style.display="none",e?($("addSystemQueryNotify").onclick=function(){addV6DesignerQueryNotify(b.getAttribute("seq"),b)},$("addSystemQueryNotify").style.color="#0066FF",$("removeSystemQueryNotify").style.display="#0066FF"):($("addSystemQueryNotify").onclick=function(){floatWin(null,getBundleString("systemQueryNotifyNotNotifiable",[f]))},$("addSystemQueryNotify").style.color=
"grey",$("removeSystemQueryNotify").style.display="grey"))}else{if(!owner)return;for(e=0;e<d.length;e++)d[e].style.display="none";d[4].style.display="";d[4].onclick=function(){read(evalJS,"/sims/saveDesignerQuery.jsp?fixed&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+"&n="+encodeURIComponent(name)+"&qs=&v="+uiversion,!1);window.setTimeout(function(){mode!==BUILDER&&ctrl.currentController.load("","",function(){mode===BROWSE&&(browse._init(),browse._focus())})},500)}}floatingPanels.push(c);
c.style.display="";a=absoluteCursorPosition(a);c.setAttribute("sideScrollTop",$("v5Sidebar").scrollTop);c.style.top=a.Y+6+"px";c.style.left=a.X+3+"px"}}
function v6RenameFilter(a,b){floatWin(null,'<div style="margin:8px 0 25px 25px;float:left;_width:500px;"><div>'+lm.sheetNewName+'</div><input type=text style="clear:left;float:left;" onfocus="ctrl.enterSubmitBox=this;ctrl.enterSubmitButton=$(\'floatWinPromptSubmit\');" onblur="ctrl.enterSubmitBox=null;ctrl.enterSubmitButton=null;" id=floatWinPromptInput value="'+b+'" /><br/><input type=button id="floatWinPromptSubmit" onclick="renameV6Query('+a+');" style="clear:left;float:left;" value=Submit /></div>',
"",!0)}
function setViewsGroup(a){var b='<div id="viewGroupMain" style="margin: 0 18px 0 10px;">';ajaxget("/sims/groupOfView.jsp",{ap:ap,path:path,si:sheetIndex,seq:a,noAdmin:!0},function(a){a=JSON.parse(a);var c=a.selectedGroups;a.groups.forEach(function(a,d){var e=encodeURIComponent(a).replace(/[!'()*]/g,function(a){return"%"+a.charCodeAt(0).toString(16)}),f=!1;c&&-1<c.indexOf(a)&&(f=!0);0===d%2&&(b+='<div class="viewGroupContent">');b+='<div class="viewGroupPart"><input name="viewGroup" type="checkbox" data-groupname="'+e+
'" id="viewGroup_'+d+'" '+(f?"checked":"")+'/><label for="viewGroup_'+d+'">'+a+"</label></div>";0!==d%2&&(b+="</div>")})},!0);b+='<div class="viewGroupFooter"><div id="viewGroupOK" class="topButtonWhole">'+lm.save+'</div><div id="viewGroupCancel" class="topButtonWhole" onclick="ctrl.outOfNUI=false;$(\'floatingWin\').style.display=\'none\'">'+lm.cancel+'</div><a id="setGroupDefaultViewLink" onclick="setGroupDefaultView('+a+')" href="javascript:void(0)">'+lm.setGroupDefaultView+"</a></div></div>";floatWin(null,
b,"",!0);var c=document.querySelector('.viewGroupPart input[name="viewGroup"][data-groupname="EVERYONE"]');$("viewGroupOK").addEventListener("click",function(){var b=Array.from(document.querySelectorAll('.viewGroupPart input[name="viewGroup"]:checked')).map(function(a){return a.dataset.groupname}).join(",");postPromise("/sims/groupOfView.jsp",{ap:ap,selectedGroup:b,path:path,si:sheetIndex,seq:a});ctrl.outOfNUI=!1;$("floatingWin").style.display="none"});$("viewGroupMain").addEventListener("click",
function(a){if(a=a.target.closest(".viewGroupPart input"))"EVERYONE"===a.dataset.groupname?(Array.from(document.querySelectorAll('.viewGroupPart input[name="viewGroup"]:checked')).forEach(function(a){a.checked=!1}),c.checked=!0):c.checked=!1});0===document.querySelectorAll('.viewGroupPart input[name="viewGroup"]:checked').length&&(c.checked=!0)}
function v6RenameSystemViews(a,b){floatWin(null,'<div style="margin:8px 0 25px 25px;float:left;_width:500px;"><div>'+lm.sheetNewName+'</div><input type=text style="clear:left;float:left;" onfocus="ctrl.enterSubmitBox=this;ctrl.enterSubmitButton=$(\'floatWinPromptSubmit\');" onblur="ctrl.enterSubmitBox=null;ctrl.enterSubmitButton=null;" id=floatWinPromptInput value="'+b+'" /><br/><input type=button id="floatWinPromptSubmit" onclick="renameV6DesignerQuery('+a+');" style="clear:left;float:left;" value="'+
lm.submit+'" /></div>',"",!0)}function saveSelectedAsView(){ctrl.saveSelectedAsView=!0;v6CreateFilter(!1,!0)}
function v6CreateFilter(a,b){var c='<input type="radio" name="filterType" id="personalType" onclick="v6CreateFilter(true, '+b+');" checked /><label for="personalType"> '+lm.personalQuery+'</label><a style="float:none;margin:0 15px 0 2px;" href="javascript:void(0);" onclick=showSingleTooltip(this,"personalQueryDescription",false,true,false,true); class="tooltipQ"><i class="fas fa-question"></i></a>',d=b?'<input type="radio" name="filterType" id="systemType" onclick="v6CreateFilter(true, '+b+');" /><label for="systemType" id="systemTypeLabel"> '+
lm.systemQuery+'</label><a style="float:none;margin:0 15px 0 2px;" href="javascript:void(0);" onclick=showSingleTooltip(this,"systemQueryDescription",false,true,false,true); class="tooltipQ"><i class="fas fa-question"></i></a>':"";b=owner?'<input type="radio" name="filterType" id="fixedType" onclick="v6CreateFilter(true, '+b+');" /><label for="fixedType" id="fixedTypeLabel"> '+lm.fixedFilter+'</label><a style="float:none;margin:0 15px 0 2px;" href="javascript:void(0);" onclick=showSingleTooltip(this,"fixedFilterDescription",false,true,false,true); class="tooltipQ"><i class="fas fa-question"></i></a>':
"";var e=user.endsWith("@ragic.com")||"/ragic-setup"!==path||1!==sheetIndex&&5!==sheetIndex;c='<div style="margin:8px 0 25px 25px;float:left;_width:500px;"><div style="margin:0 0 8px 0;font-weight:bold;font-size:14px;">'+lm.createNew+':</div><div style="margin:4px 0 5px 5px;_margin-top:2px;float:left;_width:220px;">'+c+d+(e?b:"")+'</div><input type="text" style="clear:left;float:left;" onfocus="ctrl.enterSubmitBox=this;ctrl.enterSubmitButton=$(\'floatWinPromptSubmit\');" onblur="ctrl.enterSubmitBox=null;ctrl.enterSubmitButton=null;" id="floatWinPromptInput" value="" /><br/><div id="msgShow" style="clear:left;float:left;color:#888888;"></div><input type="button" id="floatWinPromptSubmit" onclick="_v6CreateFilter();" style="clear:left;float:left;" value="'+
lm.submit+'" /></div>';if(a){var f=$("personalType").checked?"personalType":$("systemType").checked?"systemType":$("fixedType").checked?"fixedType":"";var g=$("floatWinPromptInput").value}floatWin(null,c,"",!0);f&&($(f).checked="checked");"fixedType"==f?$("floatWinPromptInput").style.display="none":$("floatWinPromptInput").style.display="";g&&($("floatWinPromptInput").value=g);$("floatWinPromptInput").focus()}
function _v6CreateFilter(){if($("fixedType")&&$("fixedType").checked){$("floatingWin").style.display="none";ctrl.outOfNUI=!1;var a=v6CreateFilterString(!0).split("&fv2=").join(",");postPromise("/sims/saveDesignerQuery.jsp",{a:ap,p:path,fn:sheet,n:b,qs:a,fixed:""}).then(eval).then(function(){mode!==BUILDER&&ctrl.currentController.load("","",function(){mode===BROWSE&&(browse._init(),browse._focus())})})}else{var b=$("floatWinPromptInput").value.trim();b?$("personalType").checked?($("floatingWin").style.display=
"none",ctrl.outOfNUI=!1,postPromise("/sims/saveQuery.jsp",{a:ap,p:path,fn:sheetIndex,n:b,qs:v6CreateFilterString(!0)}).then(eval)):$("systemType").checked&&($("floatingWin").style.display="none",ctrl.outOfNUI=!1,postPromise("/sims/saveDesignerQuery.jsp",{a:ap,p:path,fn:sheet,n:b,qs:v6CreateFilterString(!0)}).then(eval)):$("msgShow").innerHTML="Please input a name for your filter."}}
function v6MoreFilter(a){read(function(a){$("v6QueryItemBar").innerHTML=a.responseText;biffdata.filterStatus.v6ApplyFilter()},"/sims/queryItemBar.jsp?"+(a?"more&":"")+"a="+ap+"&p="+encodeURIComponent(path)+"&n="+encodeURIComponent(sheet))}
function updateSubtableDefaultFilter(a){"object"!==typeof a&&(a={});var b=a.subtable,c=a.field,d={a:a.apname||ap,p:a.path||path,fn:a.sheet||sheet};a.remove&&(d.remove=!0);b?d.subtableId=b.domainId:d.fieldId=+c.getFieldId();return postPromise("/sims/updateSubtableDefaultFilter.jsp",d)}function uiSaveSubtableDefaultFilterAndSorting(a){updateSubtableDefaultFilter(a).then(function(a){ctrl.currentController.load("","",function(){mode===BROWSE&&(browse._init(),browse._focus())});floatWin(null,a)})}
function uiRemoveSubtableDefaultFilterAndSorting(a){"object"!==typeof a&&(a={});a.remove=!0;updateSubtableDefaultFilter(a).then(function(a){ctrl.currentController.load("","",function(){mode===BROWSE&&(browse._init(),browse._focus())});floatWin(null,a)})}
function quickSearchTemplate(a){function b(a){var b=[],c=!1,d=/[\.\\\+\*\?\[\^\]\$\(\)\{\}=!<>\|:\-]/g;Array.from(n.querySelectorAll("input[name='conditions']")).forEach(function(a){""!==a.value?(a=a.value.replace(d,"\\$&"),b.push(a)):c||(c=!0)});c&&!a&&b.push("");return b}function c(a){return b(a).join("|")}function d(a){var b=node("DIV"),c=node("INPUT"),d=document.createTextNode(lm.condition+" "),e=node("I"),f=!0;e.classList.add("far","fa-plus-square");e.onclick=function(){var b=node("input"),c=
document.createTextNode(","),d=n.querySelector(".conditionContent");if(a&&f){var g=node("SELECT"),k=node("OPTION"),l=node("OPTION");k.appendChild(document.createTextNode(lm.allConditionBelow));k.value="ALL";l.appendChild(document.createTextNode(lm.oneConditionBelow));l.value="ONE";g.appendChild(k);g.appendChild(l);g.classList.add("combineSelect");d.insertBefore(c,e);q.insertBefore(g,n);f=!1}else d.insertBefore(c,e);b.name="conditions";d.insertBefore(b,e)};c.name="conditions";b.classList.add("conditionContent");
b.appendChild(d);b.appendChild(c);b.appendChild(e);n.appendChild(b)}function e(a){var b=$("quickSearchWarning"),c=node("DIV");c.appendChild(document.createTextNode(a));b.appendChild(c)}function f(d,e){inNUI();var f="";switch(e.value){case "include":var k=q.querySelector(".combineSelect")?q.querySelector(".combineSelect").value:"ALL";"ALL"===k?(g="^.*{0}.*$",b(!0).forEach(function(a,b,c){f+="(?=.*{0}.*)".replace("{0}",a);c.length-1!==b&&(f+=".*")})):"ONE"===k&&(g="^.*({0}).*$",f=c(!0));break;case "exclude":k=
q.querySelector(".combineSelect")?q.querySelector(".combineSelect").value:"ONE";"ONE"===k?(g="^({0}.)*$",b(!0).forEach(function(a){f+="(?!{0})".replace("{0}",a)})):"ALL"===k&&(g="^{0}$",b(!0).forEach(function(a){f+="((?!{0}).)*".replace("{0}",a)}));break;case "notNull":g="[^ ]";break;case "equalToNull":g="^$";break;case "equalToOneOf":g="^({0})$";f=c();break;case "equalToNoneOf":g="^(?!{0}$)";f=c();break;case "equal":g="^{0}$";f=c();break;case "nonEqual":g="^(?!{0}$)",f=c()}if(g=g.replace("{0}",f))g=
encodeURIComponent(g).replace(/%2C/g,"%26%2344%3B").replace(/%7C/g,"%26%23124%3B"),r?(d=a.split("|"),d=document.querySelector("#v6Query"+d[0]+" .v6QueryTextbox")):d=document.querySelector("#v6Query"+d+" .v6QueryTextbox"),d&&("equalToNull"===e.value?(d.value="",document.querySelector("#tExact"+a).click()):d.value="regex:"+g),ctrl.currentController.load("&gbt",v6CreateFilterString(),function(){mode===BROWSE&&browse._init();browse._focus()});$("floatingWin").style.display="none"}var g="",k='<div id="quickSearchContent"><div id="quickSearchWarning"></div><div id="quickSearchDesc">'+
lm.quickSearchDesc+'</div><select id="quickFilterSelect">'+lm.quickSearchOptions+'</select><div id="filterContent"></div><div id="quickSearchButton" class="topButtonWhole">'+lm.set+"</div></div>",l,m,n,q,r=1<a.split("|").length;(function(){floatWin(null,k,"",!0);var b=a;a.includes("|")&&(b=a.substring(0,a.indexOf("|")));var c=!1;ajaxget("/sims/checkIfSelection.jsp",{a:ap,p:path,si:sheetIndex,di:a},function(a){c="true"===a},!0);q=$("quickSearchContent");l=$("quickFilterSelect");m=$("quickSearchButton");
n=$("filterContent");r&&(l.querySelector("option[value='equalToNull']").style.display="none");l.onchange=function(){for(var a=c,b=$("quickSearchWarning");n.firstChild;)n.removeChild(n.firstChild);var f=q.querySelector(".combineSelect");f&&q.removeChild(f);rm(b);switch(this.value){case "exclude":a&&e(lm.quickSearchNoEmptyValueWarning);case "include":d(!0);break;case "equalToNoneOf":a&&e(lm.quickSearchNoEmptyValueWarning);case "equalToOneOf":d();break;case "nonEqual":a&&e(lm.quickSearchNoEmptyValueWarning);
case "equal":a=node("DIV"),b=node("INPUT"),f=document.createTextNode(lm.condition+" "),b.name="conditions",a.classList.add("conditionContent"),a.appendChild(f),a.appendChild(b),n.appendChild(a)}};m.onclick=function(){f(b,l)}})()}function fieldFilter(a,b){for(var c=0;c<b.options.length;c++){var d=b.options[c];a&&d.innerHTML&&-1==d.innerHTML.toUpperCase().indexOf(a.toUpperCase())?d.style.display="none":d.style.display=""}}
function componentFilter(a,b,c){b=c?b.querySelectorAll(c):b.childNodes;for(c=0;c<b.length;c++){var d=b[c];a&&d.textContent&&-1==d.textContent.toUpperCase().indexOf(a.toUpperCase())?d.style.display="none":d.style.display=""}}
function subtableComponentFilter(a){if($("createSubtableFromMultiple"))for(var b=$("createSubtableFromMultiple").childNodes,c=0;c<b.length;c++){var d=b[c],e=d.querySelector(".subtableName");a&&(!e||e&&e.textContent&&-1==e.textContent.toUpperCase().indexOf(a.toUpperCase()))?d.style.display="none":d.style.display=""}}
function allRecords(){ctrl.currentController.load("&gbt","&cl="+REMOVE_ALL_FILTER,function(){mode==BROWSE&&(browse._init(),browse._focus(),$("searchbox")&&($("searchbox").value=""),ctrl.currentNUI.scrollTop=0,clearListingPageCheckbox(),processStar(),updateListingPageAddRowButton())})}function getFV2String(a,b,c,d){return a+b+"|"+c+"|"+d}
function showRightKeyMenu(a){if(!a)return!1;if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);var c=checkParentClass(b,["nui"])||checkParentId(b,["focus"]);if(!checkParentId(b,["iTop"]))if(mode!=BROWSE&&mode!=UPDATE||!c||mvpMode){if(mode==BUILDER&&c)return builderRKeyMenu(a,b),!1;if(mode==UPDATE&&!isNaN(d)&&!isNaN(e))return d=parseInt(b.id.split("_")[1]),e=parseInt(b.id.split("_")[2]),nui._focus(d,e),!1}else{var d=parseInt(b.id.split("_")[1]),e=parseInt(b.id.split("_")[2]);
isNaN(d)||isNaN(e)||b.classList.contains("nuiFreeCell")||nui._focus(d,e);(isSingleFocusOnNuiCell()||"focus"===b.id&&1<ctrl.multiSelected.length)&&nuiRKeyMenu(a,b);return!1}return!0}function checkParentId(a,b){for(var c=0;a&&20>c;){if(b&&-1!==b.indexOf(a.id))return!0;a=a.parentNode;c++}return!1}function checkParentClass(a,b){for(var c=0;a&&20>c;){if(b&&-1!==b.indexOf(a.className))return!0;a=a.parentNode;c++}return!1}
function nuiRKeyMenu(a,b){var c=0,d=0;if(a.pageX||a.pageY)c=a.pageX,d=a.pageY;else if(a.clientX||a.clientY)c=a.clientX+getBodyScrollleft(),d=a.clientY+getBodyScrolltop();$("rightKeyFloatNUI").style.display="";d+$("rightKeyFloatNUI").offsetHeight>document.body.clientHeight?$("rightKeyFloatNUI").style.top=d-$("rightKeyFloatNUI").offsetHeight+"px":$("rightKeyFloatNUI").style.top=d+"px";c+$("rightKeyFloatNUI").offsetWidth>document.body.clientWidth?$("rightKeyFloatNUI").style.left=c-$("rightKeyFloatNUI").offsetWidth+
"px":$("rightKeyFloatNUI").style.left=c+"px";ctrl.targetCell=b;a=$("focus");"focus"!==ctrl.targetCell.id&&a.cell&&a.cell.ip&&"U"===a.cell.ip.type&&(ctrl.targetCell=a);(function(){if(ctrl.targetCell)var a=ctrl.targetCell.ip;!a&&ctrl.targetCell&&ctrl.targetCell.cell&&(a=ctrl.targetCell.cell.ip);!a&&nui._curcell()&&(a=nui._curcell().ip);a&&(a.biff&&a.biff.hasAttribute("ro")||a.readOnly)?($("bCutNUI").style.display="none",$("bPasteNUI").style.display="none"):($("bCutNUI").style.display="",$("bPasteNUI").style.display=
"")})();$("bCutNUI").onclick=cutCell;$("bCopyNUI").onclick=copyCell;$("bPasteNUI").onclick=pasteCell;$("bInsertComment").onclick=function(){biffdata.ifListingPage()?floatWinWarning(lm.insertCommentAlert):loadCellComment(nui.fcol,nui.frow)};$("bFieldAnalyzerNUI").onclick=function(){fieldAnalyze()};$("bFieldHistory").onclick=function(){if(ctrl.targetCell)var a=ctrl.targetCell.ip;!a&&ctrl.targetCell&&(a=ctrl.targetCell.cell.ip);!a&&nui._curcell()&&(a=nui._curcell().ip);if(a){var b={a:ap,p:path,si:sheetIndex,
d:a.domainId,rd:biffdata.rootDomainId};biffdata.ifListingPage()?b.ni=a.parentNodeId:(b.ni=biffdata.rootNodeId,a.biff&&biffdata.ifSubtableDataBiff(a.biff)&&(b.sk=a.biff.parentDomainId,b.sni=a.biff.parentNodeId));getPromise("/sims/fieldHistory.jsp",b).then(function(a){floatWin(null,a,lm.fieldHistory,!0)})}};a=$("bFilterByNUI");c=(b=ctrl.targetCell&&(ctrl.targetCell.ip||ctrl.targetCell.cell&&ctrl.targetCell.cell.ip)||nui._curcell()&&nui._curcell().ip)&&b.biff&&biffdata.ifSubtableDataBiff(b.biff);mode===
BROWSE&&(biffdata.ifListingPage()||c)&&b?(c=a.dataset.template,d=(d=biffdata.findHeaderFromBiff(b.biff))?d.value:"",b="M"!==b.type?b.getValue():b.valueList.join(", "),15<=b.length&&(b=b.substr(0,15)+"..."),a.innerHTML=c.replace("{0}","<b class='highlightText'></b>").replace("{1}","<b class='highlightText'></b>"),c=a.querySelectorAll("b.highlightText"),c[0].innerText=d,c[1].innerText=b,a.style.display="",a.onclick=rKeyFilterBy):a.style.display="none";window.owner?$("bFieldAnalyzerNUI").style.display=
"":$("bFieldAnalyzerNUI").style.display="none";6==biffdata.role?$("bFieldHistory").style.display="":$("bFieldHistory").style.display="none";floatingPanels.push($("rightKeyFloatNUI"))}function isSingleFocusOnNuiCell(){var a=0===ctrl.multiSelected.length||1===ctrl.multiSelected.length,b=nui.focus&&nui.focus.cell&&!nui.focus.cell.classList.contains("hide")&&(nui.focus.cell.biff||nui.focus.cell.ip);return a&&b}
function cutCell(){hinFocus();ctrl.clipboard=mode==BUILDER?builder.getObjectCopyString(nui.fcol,nui.frow):$("hin").getValue();document.execCommand("Copy");mode==BROWSE&&modeUpdate();if(ctrl.targetCell)var a=ctrl.targetCell.ip;!a&&ctrl.targetCell&&(a=ctrl.targetCell.cell.ip);!a&&nui._curcell()&&(a=nui._curcell().ip);if(a){var b=a.biff&&a.biff.hasAttribute("ro")||a.readOnly,c=a.biff&&a.biff.hasAttribute("hide");b||c||(a.clear&&a.clear(),a.loadValue(""),a.render(),mode==BUILDER&&builder.setField(nui.fcol,
nui.frow,null))}}function hinCopyEvent(){mode==BUILDER&&(ctrl.clipboard=builder.getObjectCopyString(nui.fcol,nui.frow))}function copyCell(){hinFocus();ctrl.clipboard=mode==BUILDER?builder.getObjectCopyString(nui.fcol,nui.frow):$("hin").getValue();document.execCommand("Copy")}
function pasteCell(){hinFocus();if(ctrl.clipboard){if(ctrl.targetCell)var a=ctrl.targetCell.ip;!a&&ctrl.targetCell&&(a=ctrl.targetCell.cell.ip);!a&&nui._curcell()&&(a=nui._curcell().ip);if(mode===BUILDER)nui._curcell()&&(a?($("hin").setValue(ctrl.clipboard),builder.isPositionValid(nui.fcol,nui.frow)?builder.setContent(nui.fcol,nui.frow,ctrl.clipboard):(a.loadValue(ctrl.clipboard),a.render())):(a=ctrl.clipboard.split(","),5<=a.length&&"F"===a[0]?saveBuilderMode(BUILDER_TEXT,!0):saveBuilderMode(BUILDER_FIELDS,
!0),builder.mode==BUILDER_FIELDS?builder.setField(nui.fcol,nui.frow,ctrl.clipboard):builder.setDescription(nui.fcol,nui.frow,ctrl.clipboard)),nui._updateFocus());else{var b=a&&a.biff&&a.biff.hasAttribute("ro"),c=a&&a.biff&&a.biff.hasAttribute("hide");b||c||(mode===BROWSE&&modeUpdate(),a&&(a.pasting=!0,$("hin").setValue(ctrl.clipboard),a.loadValue(ctrl.clipboard),a.render(),a.pasting=!1))}}else mode===BROWSE&&modeUpdate()}
function clearCell(){if(ctrl.targetCell)var a=ctrl.targetCell.ip;!a&&ctrl.targetCell&&(a=ctrl.targetCell.cell.ip);!a&&nui._curcell()&&(a=nui._curcell().ip);if(mode==BUILDER){var b=builder.cellData[nui.fcol+","+nui.frow];if(b&&(doDeleteCheck(b),b.noDelete))return}a&&(a.clear&&a.clear(),a.loadValue(""),a.render(),mode==BUILDER&&(builder.setField(nui.fcol,nui.frow,null),nui._updateFocus()))}
function fieldAnalyze(){if(mode===BUILDER){if(currentBiff)var a=currentBiff.domainId;var b=builder.rootDomainId;a&&floatWin(function(){return"/sims/fieldAnalyzer.jsp?a="+ap+"&p="+path+"&si="+sheetIndex+"&d="+a+"&rd="+b+(c&&c.biff?"&ni="+c.biff.nodeId:"")},null,lm.fieldAnalyzer,!0)}else if(mode===BROWSE){if(ctrl.targetCell)var c=ctrl.targetCell.ip;!c&&ctrl.targetCell&&(c=ctrl.targetCell.cell.ip);!c&&nui._curcell()&&(c=nui._curcell().ip);c&&(a=c.domainId);b=biffdata.rootDomainId;a&&floatWin(function(){return"/sims/fieldAnalyzer.jsp?a="+
ap+"&p="+path+"&si="+sheetIndex+"&d="+a+"&rd="+b+(c&&c.biff?"&ni="+c.biff.nodeId:"")},null,lm.fieldAnalyzer,!0)}}
function rKeyFilterBy(){if(mode===BROWSE){var a=ctrl.targetCell&&(ctrl.targetCell.ip||ctrl.targetCell.cell&&ctrl.targetCell.cell.ip)||nui._curcell()&&nui._curcell().ip;if(biffdata.ifListingPage()||biffdata.ifSubtableDataBiff(a.biff)){var b=a.domainId,c="M"!==a.type?$("hin").getValue():a.value;if("M"===a.type){var d="";c.split("|").forEach(function(a,c){0!==c&&(d+="&");d+="fv2="+b+"|1|"+a});c=d}if(312===b)switch(c){case lm.approval_status_new:c="N";break;case lm.approval_status_process:c="P";break;
case lm.approval_status_finish:c="F";break;case lm.approval_status_rejected:c="REJ"}else 320===b&&ajaxget("/sims/getUserNameMap.jsp",{ap:ap},function(a){a=JSON.parse(a);for(var b in a)if(a.hasOwnProperty(b)&&a[b]===c){c=b;break}},!0);"M"===a.type?ctrl.currentController.load("","&fv2add&"+c,function(){mode===BROWSE&&browse._init();browse._focus();clearListingPageCheckbox()}):$(b+"|-1|"+a.biff.nodeId)?ctrl.currentController.load("","&fv2add&fv2="+(b+"|-1|"+a.biff.nodeId),function(){mode==BROWSE&&(browse._init(),
browse._focus(),showFilterPanel(),clearListingPageCheckbox(),biffdata.ifListingPage()&&sheetScrollToTop())}):applyTextFilter(b,c,!0)}}}function textFilterValueEscapeProcessing(a){return encodeURIComponent(a).replace(/%2C/g,"%26%2344%3B").replace(/%7C/g,"%26%23124%3B")}function classWithDisabled(a){return a.classList.contains("Disabled")}
function builderRKeyMenu(a,b){if("focus"==b.id){var c=nui.fcol;var d=nui.frow}else"I"===b.tagName&&b.parentNode.classList.contains("showUnHideArrow")&&(b=b.parentElement.parentElement),c=parseInt(b.id.split("_")[1]),d=parseInt(b.id.split("_")[2]);if(!isNaN(d)){ctrl.rightClickRow=d;ctrl.rightClickCol=c;var e=new ContextMenuDataHelper(ContextMenu.builderRKeyMenuData);b=e.getItem("bInsertActionButton");var f=e.getItem("bInsertRow"),g=e.getItem("bDeleteRow"),k=e.getItem("bDeleteCol"),l=e.getItem("bInsertCol"),
m=e.getItem("bInsertLocalCol"),n=e.getItem("bHideCol"),q=e.getItem("bSetColWidth"),r=e.getItem("bSetRowHeight"),p=e.getItem("bFieldAnalyzer");e=e.getItem("bNUISectionCreate");b.hide=!1;f.hide=!1;g.hide=!1;k.hide=!1;l.hide=!1;m.hide=!1;n.hide=!1;q.hide=!1;r.hide=!1;p.hide=!0;e.hide=!0;g.text=lm.deleteRow;k.text=lm.deleteColumn;if(builder.ifListingPage()){1!==c&&(l.hide=!0);m.hide=!0;builder.cellData[c+","+d]&&(k.hide=!0);var t=builder.getFirstField();t&&t.y==d&&(g.hide=!0)}0==c&&(l.hide=!0,m.hide=
!0,n.hide=!0,k.hide=!0,q.hide=!0,ctrl.multiSelected&&0<ctrl.multiSelected.length&&!builder.ifListingPage()&&(c=builder.getEndOfLastSection(),!c||d>c))&&(e.hide=!1);0==d&&(f.hide=!0,g.hide=!0,m.hide=!0,r.hide=!0);ctrl.multiSelected&&0<ctrl.multiSelected.length&&(g.text=lm.deleteSelectedRow,k.text=lm.deleteSelectedColumn);window.owner&&(p.hide=!1);actionButtonsMenuData=[];b.sub=actionButtonsMenuData;c={};for(var v in builder.actionButtons)builder.actionButtons.hasOwnProperty(v)&&(c.$jscomp$loop$prop$buttonJson$560=
builder.actionButtons[v],d={text:c.$jscomp$loop$prop$buttonJson$560.name,events:{click:function(a){return function(){insertActionButton(a.$jscomp$loop$prop$buttonJson$560.seq)}}(c)}},actionButtonsMenuData.push(d)),c={$jscomp$loop$prop$buttonJson$560:c.$jscomp$loop$prop$buttonJson$560};0===actionButtonsMenuData.length&&(b.hide=!0);b=v=0;if(a.pageX||a.pageY)v=a.pageX,b=a.pageY;else if(a.clientX||a.clientY)v=a.clientX+getBodyScrollleft(),b=a.clientY+getBodyScrolltop();ContextMenu.createMenu("rightKeyFloat",
ContextMenu.builderRKeyMenuData,b+"px",v+"px");ctrl.builderRightKeyEvent=a}}function newSheet(a){createModule(a)}function _newSheet(){var a=temp,b=$("floatWinPromptInput").value;setCookie("newSheet",b);window.location="/"+ap+a}
function _execNewSheet(a,b){a=decodeURIComponent(a);changeSheet(b+"_Sheet"+b);modeBrowse();builder.isSheetNew=!0;location.hash="";builder.formType=null;biffdata.formType=null;BUILDER_EMPTY_CLASS="builderEmpty";modeBuilder();builder.newName=a;biffdata.displaySheetName=a;displayNUIHeader();!tutorial.getEnabled()&&ctrl.ifOnline&&liveTemplates();setTimeout(ctrl.currentController.resize.bind(ctrl.currentController),100)}
function refreshSheet(a){ctrl.currentController.load("&reset","",function(){mode==BROWSE&&(browse._init(),browse._focus())})}function copySheet(a){var b=$("copyLink").checked;a={a:ap,fn:a,p:path};b||(a.cnf="");postPromise("/sims/copySheet.jsp",a).then(function(a){alert(a);location.href=a})}
function changeSheet(a){if((mode==UPDATE||mode==BUILDER)&&!confirm(lm.away))return!1;!window.sheet&&defaultSheet&&(window.sheet=defaultSheet);if(!window.sheet)return!1;a&&(sheet=a);mode==UPDATE&&read(null,"/sims/lockEntry.jsp?unlock&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+(biffdata.ifListingPage()?"&sl":"&ni="+biffdata.rootNodeId));try{sheetIndex=parseInt(sheet.split("_")[0])}catch(b){}$("v5NUIHeader")&&(ctrl.currentController.resetBrowseLeft(),biffdata.filterStatus.domainListing=
null,sheetIndex&&mode==BROWSE&&(sheetIndex==rpSheetIndex?1<location.hash.toString().length&&(location.hash=""):location.hash="#!/"+sheetIndex),$("v5NUIHeader").style.backgroundImage="url("+lm.cdn+"'/sims/img/imgmgr.jsp?i=dbbanner&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+sheetIndex+"')");return!0}function browseNextPage(){finalizeAutoSave();ctrl.currentController.load("","&pd=1",function(){mode==BROWSE&&(browse._init(),browse._focus())})}
function browsePrevPage(){finalizeAutoSave();ctrl.currentController.load("","&pd=-1",function(){mode==BROWSE&&(nui.main.scrollLeft=0,browse._init(),browse._focus())})}function browseFirstPage(){finalizeAutoSave();ctrl.currentController.load("","&pd=first",function(){mode==BROWSE&&(nui.main.scrollLeft=0,browse._init(),browse._focus())})}function finalizeAutoSave(){biffdata.autoSave&&-1!=nui.frow&&-1!=nui.fcol&&(setTimeout(rm,1E3,$("draftDiv")),nui._blur(!0))}
function reloadData(){ctrl.currentController.load("","",function(){mode==BROWSE&&(browse._init(),browse._focus())})}
function browseBack(){if(!biffdata.ifListingPage()){biffdata.calendarOn&&cal.show();$("bBack").style.display="none";hideEditElements();finalizeAutoSave();ctrl.currentController.load("&gb","",function(){browse._trav(!1);biffdata.ifListingPage()&&(location.hash="#!/"+sheetIndex,_tutorialCheckProgress())},nuiController.LEFT);forceRedraw();biffdata.custTheme&&CustThemeHelper.applyTheme(biffdata.custTheme);try{RagicInteractiveRules.loadRules(biffdata.interactiveRuleString),RagicInteractiveRules.execute(!0)}catch(a){processJSExceptionObj(a)}}}
function calBrowseForward(a){nui.main.scrollTop=0;ctrl.currentController.load("&dm=index&ni="+a+"&dnpd=-1&dnpn=-1","",function(){browse._trav(!0)},nuiController.RIGHT)}function forceRedraw(a){if(ctrl.isChrome&&ctrl.isMac)if(a){var b=$(a).clientWidth;b&&0<b&&requestAnimationFrame(function(){$(a).style.width=b+5+"px"})}else setTimeout(window.dispatchEvent,300,new Event("resize"))}
function browseForward(a){ctrl.editIcon&&(document.body.removeChild(ctrl.editIcon),ctrl.editIcon=null);if(mvpMode)selectMVP();else return a=_browseForward(a),forceRedraw(),a}
function _browseForward(a){var b=browse._getCell();if(!b&&!a)return!1;var c=b?b.ip:a.ip;if(!c)return!1;b=biffdata.ifListingPage();var d,e=0;if(biffdata.keyField)if(b){var f=c.parentDomainId;b=c.parentNodeId;e=c.domainNodeSeq;c=d=-1}else f=c.parentDomainId,b=c.parentNodeId,e=c.domainNodeSeq,d=biffdata.rootDomainId,c=biffdata.rootNodeId;else f=c.domainId,b=c.nodeId,e=c.domainNodeSeq,d=c.parentDomainId,c=c.parentNodeId;if(!biffdata.ifListingPage()){for(var g=!1,k=0;k<biffdata.subforms.length;k++){var l=
biffdata.subforms[k];if(f==l||sheetIndex+"_"+f==l){g=!0;break}}if(!g||a)return!1}biffdata&&biffdata.ifListingPage()&&(ctrl.tempListingScrollTop=nui.main.scrollTop);listingPageCheckboxSelectAll("uncheck");nui.main.scrollTop=0;a="&dm="+(biffdata.ifListingPage()?"index":f)+"&dns="+e+"&ni="+b+"&dnpd="+d+"&dnpn="+c;ctrl.currentController.load(a,0>b?"&pd=new":"",function(){browse._trav(!0);forceRedraw()},nuiController.RIGHT);return!0}
function newData(){if(userIdentifiable||confirmedFunctionConfirmed)if(0===biffdata.role||2===biffdata.role||biffdata.nocreate)floatWinWarning(lm.noAccessCreate);else if("/ragic-setup"===path&&1==sheetIndex&&window.addUserCheck&&"DEV"!=window.licenseType)addUserCheck();else{if("FREE2"===window.edition&&!onTemplatePage()&&(ajaxget("/sims/edcheck.jsp",{a:ap,p:path,fn:sheet},function(a){ctrl.currentSheetNumOfEntries=parseInt(a)},!0),ctrl.currentSheetNumOfEntries>=lm.constFreeEntryLimit)){quickBillChangePlan(!1,
"RECORDLIMIT");return}finalizeAutoSave();var a=RagicStorage.localStorage.getItem("RAGIC_DRAFT_HEADER"+ap+path+"/"+sheetIndex),b=RagicStorage.localStorage.getItem("RAGIC_DRAFT_DATA"+ap+path+"/"+sheetIndex),c=RagicStorage.localStorage.getItem("RAGIC_DRAFT_DATE"+ap+path+"/"+sheetIndex),d=new Date(parseInt(c));!a||!b||location.search&&-1!=location.search.indexOf("new")||tutorial.getEnabled()?newData_nodraft():ajaxget("/sims/getFormLastModifiedTime.jsp",{a:ap,p:path,fn:sheet},function(a){a=new Date(Number(a));
a.isValid()&&a>d?(RagicStorage.localStorage.removeItem("RAGIC_DRAFT_HEADER"+ap+path+"/"+sheetIndex),RagicStorage.localStorage.removeItem("RAGIC_DRAFT_DATA"+ap+path+"/"+sheetIndex),RagicStorage.localStorage.removeItem("RAGIC_DRAFT_DATE"+ap+path+"/"+sheetIndex),newData_nodraft()):floatWin(null,'<p style="margin:12px 25px;">'+lm.draftHint.replace("%s",timeAgo(d))+'</p><p><span id="loadDraftButton" style="margin:12px 5px 12px 25px;" class="topButtonWhole" onclick="newData_draft();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.loadDraft+'</span><span id="discardDraftButton" style="margin:12px 8px 12px 8px;" class="topButtonWhole" onclick="newData_nodraft();" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.discardDraft+"</span></p>","",!0)},!0)}else confirmedFunction=newData,ctrl.outOfNUI=!1,confirmedFunctionConfirmed=!0,confirmedFunction()}
function newData_draft(){floatWinClose();$("tutorial").style.display="none";ctrl.outOfNUI=!1;if(biffdata.ifListingPage())ctrl.currentController.load("&dm=index&ft=f&dnpd=-1&dnpn=-1","&pd=new",function(){browse._trav(!0);var a=RagicStorage.localStorage.getItem("RAGIC_DRAFT_HEADER"+ap+path+"/"+sheetIndex),b=RagicStorage.localStorage.getItem("RAGIC_DRAFT_DATA"+ap+path+"/"+sheetIndex);ctrl.draftLoading=!0;biffdata.autoSave||modeUpdate();biffdata.reset();biffdata.loadHeader(a);biffdata.loadData(b,!1,!0,
!0);displayData();checkEmptySubtableRows();ctrl.draftLoading=!1},nuiController.RIGHT);else{var a=RagicStorage.localStorage.getItem("RAGIC_DRAFT_HEADER"+ap+path+"/"+sheetIndex),b=RagicStorage.localStorage.getItem("RAGIC_DRAFT_DATA"+ap+path+"/"+sheetIndex);ctrl.draftLoading=!0;biffdata.lockMode="";biffdata.autoSave||modeUpdate();ctrl.newDataFlag=!0;biffdata.draftReset();biffdata.loadHeader(a);biffdata.loadData(b,!1,!0,!0);displayData();checkEmptySubtableRows();formulaBuilder.updateAll();nui.main.scrollTop=
0;ctrl.draftLoading=!1}}
function newData_nodraft(){floatWinClose();$("tutorial").style.display="none";ctrl.outOfNUI=!1;ctrl.newDataFlag=!0;biffdata.deleteDraft();biffdata.ifListingPage()?ctrl.currentController.load("&dm=index&ft=f&dnpd=-1&dnpn=-1","&pd=new",function(){browse._trav(!0);biffdata.autoSave?autoSaveInterval(1E3):_modeUpdate();nui.main.scrollTop=0},nuiController.RIGHT):ctrl.currentController.load("&dm=index&ft=f&dnpd=-1&dnpn=-1","&pd=new",biffdata.autoSave?function(){hideEditElements();nui._focus()}:function(){_modeUpdate();
nui.main.scrollTop=0})}function Button(a,b,c,d,e,f,g,k,l,m){this.type=b;this.seq=c;this.name=d;this.url=e;this.confirmBeforeAction=!(!f||"true"!==f&&!0!==f);this.needApproval=!(!g||"true"!==g&&!0!==g);this.hideButton=!(!l||"true"!==l&&!0!==l);this.userGroups=k;this.checkIfUserCanEdit=null!=m&&JSON.parse(m);this.id=a}function Template(a,b,c){this.id=a;this.name=b;this.file=c}function CustFieldsSet(a,b,c){this.id=a;this.name=b;this.domainIdArray=c}
function FieldId(a,b){var c=this.domainId=-1,d=this.parentDomainId=-1;"string"===typeof a?(a=a.split("-"),c=+a[0],2<=a.length&&(d=+a[1])):"number"===typeof a&&(c=a,"number"===typeof b&&(d=b));!isNaN(c)&&0<=c&&(this.domainId=c);!isNaN(d)&&0<=d&&(this.parentDomainId=d)}FieldId.prototype.toString=function(){return-1!==this.parentDomainId?this.domainId+"-"+this.parentDomainId:""+this.domainId};FieldId.prototype.valueOf=function(){return this.domainId};
function BiffData(){this.headerBiffs=[];this.biffs=[];this.subtableDataBiffs={};this.imgFitBiffsRenderAgain=new Set;this.txnId=(new Date).getTime();this.keyField=!1;this.subtables=[];this.subtableKeyFields=[];this.subtableLocationCheck=[];this.subtableKeyFieldAlias=[];this.subtableFilters=[];this.subtableKeyUrl=[];this.subtableFpUrls=[];this.subtableDomainIds=[];this.duplicateDomainIds=[];this.parentNodeId=this.parentDomainId=this.rootNodeId=this.rootDomainId=-1;this.rights="R";this.nocreate=this.noedit=
!1;this.role=0;this.notify=[];this.selections=[];this.cascadedSelections={};this.cascadedRelation={};this.formulaMap={};this.sections={};this.interactiveRuleString="";this.domainIdCellMapping={};this.existingCellCords=[];this.orderDomain=[];this.orderDir=[];this.pureInsert=!0;this.customFilter={};this.buttons=[];this.changed=!0;this.formDesc="";this.tasks=[];this.subtableShifts=[];this.star=[];this.updateCellIds=[];this.updateCellIndex=0;this.subforms=[];this.widgets=[];this.widgetObjs=[];this.widgetsCount=
0;this.templates=[];this.custFieldsSets=[];this.additionalInfo=[];this.nuiFileName="";this.freezeY=this.freezeX=0;this.paymentAmountField=-1;this.stripeUserId=this.paymentCurrency=null;this.lastEditTimeDefaultValueSingleBiffs=[];this.lastEditUserDefaultValueSingleBiffs=[];this.loadLastEditUserDefaultValue=!1;this.filterStatus=new FilterStatus;this.autoGenGuessRefMap={}}
function cloneEntry(){ctrl.pauseSubtableExtend=!0;biffdata.cloneForm();biffdata.wfInfo=null;wf.init(biffdata.wfInfo);ctrl.cloneAction=!0;biffdata.lockMode="";biffdata.cloningEntry=!0;biffdata.autoSave?biffdata.rights="W":modeUpdate();biffdata.cloningEntry=!1;formulaBuilder.updateAll();ctrl.pauseSubtableExtend=!1;biffdata.autoSave&&(ctrl.currentController.resetBrowseLeft(),displayData(),updateNUIForm(),$("draftDiv").textContent=lm.cloneEntryNotSavedYet);ctrl.cloneAction=!1}
window.setInterval(autoSaveDraft,1E4);function autoSaveDraft(){biffdata&&biffdata.saveDraft()}window.setInterval(autoSaveTextarea,3E3);
function autoSaveTextarea(){if(ctrl.editingTextArea)if("emailTemplateContent"==ctrl.editingTextArea.id)RagicStorage.localStorage.setItem("RAGIC_TEXT_"+ap+path+"/"+sheetIndex+"/"+biffdata.rootNodeId+"/email",ctrl.editingTextArea.value);else if("commentTextarea"==ctrl.editingTextArea.id)RagicStorage.localStorage.setItem("RAGIC_TEXT_"+ap+path+"/"+sheetIndex+"/"+biffdata.rootNodeId+"/comment",ctrl.editingTextArea.value);else if("manualTaskTxt"==ctrl.editingTextArea.id||"taskURL"==ctrl.editingTextArea.id||
"taskDesc"==ctrl.editingTextArea.id||"taskDueDate"==ctrl.editingTextArea.id){var a={};a.taskTxt=$("manualTaskTxt").value;a.taskURL=$("taskURL").value;a.taskDesc=$("taskDesc").value;a.assignTo=$("manualTaskAssignTo").value;a.dueDate=$("taskDueDate").value;RagicStorage.localStorage.setItem("RAGIC_TEXT_"+ap+"/task",JSON.stringify(a))}}
BiffData.prototype.saveDraft=function(){if(mode==UPDATE&&localStorage&&!(0<=this.rootNodeId||window.embed||1!=this.getFormPageLevel())){var a=new Date;RagicStorage.localStorage.setItem("RAGIC_DRAFT_HEADER"+ap+path+"/"+sheetIndex,this.serializeHeader());RagicStorage.localStorage.setItem("RAGIC_DRAFT_DATA"+ap+path+"/"+sheetIndex,this.serializeData());RagicStorage.localStorage.setItem("RAGIC_DRAFT_DATE"+ap+path+"/"+sheetIndex,a.getTime());$("draftDiv").innerHTML=lm.draftSavedAt+": "+formatDate(a,"HH:mm a");
$("draftDiv").style.display=""}};BiffData.prototype.getNUIFileName=function(){return-1==this.nuiFileName.indexOf("Sheet")?this.nuiFileName:sheetIndex+"_Sheet"+sheetIndex+"_index"+(this.ifListingPage()?"_t":"")+".nui"};BiffData.prototype.ifListingPage=function(){return"2"==this.formType};BiffData.prototype.getFormPageLevel=function(){return"2"==this.formType?0:-1==biffdata.parentDomainId?1:2};
BiffData.prototype.deleteDraft=function(){localStorage&&(RagicStorage.localStorage.removeItem("RAGIC_DRAFT_HEADER"+ap+path+"/"+sheetIndex),RagicStorage.localStorage.removeItem("RAGIC_DRAFT_DATA"+ap+path+"/"+sheetIndex))};BiffData.prototype.serializeHeader=function(){return this.biffs.filter(function(a){return a.dataType===HEADER}).reduce(function(a,b){return a+b.sec+"\n"},"")};
BiffData.prototype.serializeData=function(){var a="",b=this.biffs,c;this.keyField&&(a+="KF,"+this.rootDomainId+","+this.rootNodeId+(this.parentDomainId?","+this.parentDomainId+","+this.parentNodeId:"")+"\n");if(this.subtables){var d=0;for(c=this.subtables.length;d<c;d++){var e=this.subtables[d];a+="ST,"+e.x+","+e.y+","+e.domainId;a+=",";0<e.domainIdAlias&&(a+=e.domainIdAlias);a+=",";e.keyUrl&&(a+=e.keyUrl);a+=",";e.filters&&(a+=e.filters);a+="\n"}}else if(this.subtableKeyFields)for(d=0;d<this.subtableKeyFields.length;d++)a+=
"ST,0,0,"+this.subtableKeyFields[d],a+=",",0<this.subtableKeyFieldAlias[d]&&(a+=this.subtableKeyFieldAlias[d]),a+=",",this.subtableKeyUrl[d]&&(a+=this.subtableKeyUrl[d]),a+=",",this.subtableFilters[d]&&(a+=this.subtableFilters[d]),a+="\n";c=this.selections;for(d=0;d<c.length;d++){var f="";c[d].forEach(function(a,b){0<b&&(f+=",");f+=a.replace(/,/g,"&#44;")});a+=f+"\n"}for(d=0;d<b.length;d++)if(f=b[d],f.dataType===DATA){f.sec[1]=f.x;f.sec[2]=f.y;f.sec[3]=f.domainId;f.sec[4]=f.nodeId;f.sec[5]=f.parentDomainId;
f.sec[6]=f.parentNodeId;if(!f.hasAttribute("dv")||"$"!==f.attr.dv.charAt(0)&&"#"!==f.attr.dv.charAt(0))f.sec[8]=f.value.toString().replace(/,/g,"&#44;");a+=f.sec+"\n"}return a};
BiffData.prototype.cloneForm=function(){if("2"!=this.formType){var a=-1E3,b={};var c=this.rootNodeId;var d=[];this.rootNodeId=-1E3;this.keyField&&(b[this.rootDomainId+","+c]=this.rootNodeId);for(c=0;c<this.biffs.length;c++){var e=this.biffs[c];if(e.dataType==DATA){if(e.IPType==TYPER||e.IPType==UPLOADER||e.IPType==GRAPHICS){var f=e.nodeId,g=--a;e.nodeId=g;e.sec[4]=""+g;b[e.domainId+","+f]=g;(f=b[e.parentDomainId+","+e.parentNodeId])?(e.originalParentNodeId=e.parentNodeId,e.parentNodeId=f,e.sec[6]=
""+f):-1!=indexOf(e.parentDomainId,this.subtableKeyFields)&&(f=e.parentNodeId,e.originalParentNodeId=f,e.parentNodeId=--a,e.sec[6]=""+e.parentNodeId,b[e.parentDomainId+","+f]=e.parentNodeId);e.format()}else if(e.IPType==SELECTOR||e.IPType==MSELECTOR)(f=b[e.parentDomainId+","+e.parentNodeId])?(e.originalParentNodeId=e.parentNodeId,e.parentNodeId=f,e.sec[6]=""+f):-1!=indexOf(e.parentDomainId,this.subtableKeyFields)&&(f=e.parentNodeId,e.originalParentNodeId=f,e.parentNodeId=--a,e.sec[6]=""+e.parentNodeId,
b[e.parentDomainId+","+f]=e.parentNodeId);f=e.hasAttribute("dv")?e.attr.dv:null;if(g=e.attr&&(e.attr.noclone||e.attr.ag||e.attr.f&&isApprovalFormula(e.attr.f)||e.attr.dv_f&&isApprovalFormula(e.attr.dv_f)||e.attr.noDup||"true"==e.attr.masked&&!e.unmasked||1E3>e.domainId))e.IPType==SELECTOR||e.IPType==MSELECTOR?(e.value="",e.originalNodeId=a--,e.nodeId=""+a--,e.sec[4]="",e.sec[8]=e.nodeId):(e.ip.loadValue(""),e.ip.changed=!1);if(f&&("$"===f.charAt(0)||"#"===f.charAt(0)||g)){if(e.IPType===SELECTOR||
e.IPType===MSELECTOR)e.value="",e.nodeId=""+a--,e.sec[4]="",e.sec[8]=e.nodeId;biffdata.ifSubtableDataBiff(e)?d.push(e):(e.ip.loadValue(getBiffDefaultValue(e),!0),e.format())}}}checkEmptySubtableRows();a=0;for(b=d.length;a<b;a++)c=d[a],c.isEmptyRow||c.ip.loadValue(getBiffDefaultValue(c),!0),c.format()}};
BiffData.prototype.debug=function(){var a;var b="key:"+this.rootNodeId+"/"+this.rootDomainId+"\n";for(a=0;a<this.biffs.length;a++){var c=this.biffs[a];c.dataType!=DATA||c.sec[0]!=SELECTOR&&c.sec[0]!=TYPER&&c.sec[0]!=UPLOADER&&c.sec[0]!=GRAPHICS&&c.sec[0]!=MSELECTOR||(b+=c.sec+"("+c.nodeId+","+c.parentNodeId+")\n")}return b};
BiffData.prototype.readline=function(a,b,c){if(!a)return!1;a.startsWith("CUST_THEME=")&&(this.custTheme=a.substring(a.indexOf("=")+1));var d=a.split(",");if(2>d.length)return!1;if("W"===d[0]){this.widthCommand=d[1];this.heightCommand=d[2];if(1<d.length&&d[1]){var e=d[1].split("&");a={};for(b=0;b<e.length;b++)c=e[b].split("=",2),2>c.length||(a[c[0]]=parseInt(c[1]),this.widthObj=a)}if(2<d.length&&d[2])for(e=d[2].split("&"),a={},b=0;b<e.length;b++)c=e[b].split("=",2),2>c.length||(a[c[0]]=parseInt(c[1]),
this.heightObj=a);return!1}if("A"===d[0]&&b===DATA)return this.rights=d[1],this.role=parseInt(d[2]),this.prevButton=d[3],this.nextButton=d[4],b=d[5].split("|"),0<d[5].length&&b&&0<b.length&&!isNaN(b[0])&&(this.filteredDomains=b),this.totalEntry=parseInt(d[6]),this.currentEntry=parseInt(d[7])+1,this.orderDomain=d[8].split("|"),this.orderDomain=this.orderDomain.map(function(a){return parseInt(a)}),this.orderDir=d[9].split("|"),this.orderDir=this.orderDir.map(function(a){return parseInt(a)}),this.lockMode=
d[10],this.additionalInfo=JSON.parse(decodeURIComponent(d[11])),!1;if("A"===d[0]&&b===HEADER){b=parseInt(d[2]);if(2==b||0==b)this.rights="R";3<d.length&&(this.formType=d[3]);4<d.length&&(this.hash=d[4]);return!1}if("A2"===d[0]&&b===HEADER)for(c=d[1].split("&"),b=0;b<c.length;b++)e=c[b].split("="),a=e[1],ArrayContainsIgnoreCase(window.groupNodeIds,e[0])&&("1"==a.charAt(0)&&(this.noedit=!0),"1"==a.charAt(1)&&(this.nocreate=!0));else{if(d[0]===SELECTION&&b===DATA){c=this.selections;e=-1;for(b=2;b<d.length;b++)d[b].indexOf("&#44;")&&
(d[b]=unformatNUIAttr(d[b]).replace(/&#44;/gim,",")),d[b].indexOf("<br/>")&&(d[b]=d[b].replaceAll("<br/>","\n"));for(b=0;b<c.length;b++)c[b]&&c[b][1]==d[1]&&(e=b);-1==e?this.selections.push(d):this.selections[e]=d;return!0}if("S2"===d[0]&&b===DATA){b=[];c={};for(a=4;a<d.length;a++)if(d[a]){var f=unformatNUIAttr(d[a]).split("|");if(!(3>f.length)){var g=f[0];e=f[1].replace(/%7C/g,"|").replace(/&#44;/g,",");f=f[2].replace(/%7C/g,"|").replace(/&#44;/g,",");g=g+"|"+f;c.hasOwnProperty(e)||(c[e]=[]);c[e].push(g);
b.includes(g)||b.push(g)}}this.cascadedSelections[d[1]]={pbiffs:[],collection:c};this.cascadedRelation.hasOwnProperty(d[2])?this.cascadedRelation[d[2]].push(d[1]):this.cascadedRelation[d[2]]=[d[1]];c=this.selections;e=-1;a=["S",d[1],d[3]].concat(b);for(b=0;b<c.length;b++)c[b]&&c[b][1]==d[1]&&(e=b);-1==e?this.selections.push(a):this.selections[e]=a;return!0}if("N"===d[0]&&b===HEADER)return this.displaySheetName=decHTML(d[1]),2<d.length&&(this.formDesc=d[2]),!1;if("FS"===d[0])return this.fs=d[1],!1;
if("DS"===d[0])return this.ds=d[1],!1;if("SUBFORM"===d[0]&&b===HEADER)return this.subforms.push(d[1]),!1;if("DRILL"===d[0])return this.drill=d[1],!1;if("X"===d[0]&&b===HEADER){if("1"===d[2])biffdata.filterStatus.addFilters(d[3],!0);else if("0"===d[2]||"2"===d[2])biffdata.customFilter[d[1]]=d[3],"2"===d[2]&&(biffdata.defaultFilter=d[1]);return!1}if("X"===d[0]&&b===DATA)return this.ifListingPage()&&biffdata.filterStatus.addFilters(d[3]),!1;if("T"===d[0]&&b===HEADER){c=d[1].split("&");biffdata.tAttr=
{};for(b=0;b<c.length;b++)e=c[b].split("=",2),biffdata.tAttr[e[0]]=e[1];return!1}if("FZ"===d[0])return b=d[1].split("|").map(Number),this.freezeX=b[0],this.freezeY=b[1],!1;if("PAY"===d[0])this.paymentAmountField=d[1],this.paymentCurrency=d[2],this.stripeUserId=d[3],$("paymentButton").style.display="",this.needLoadPaymentWin=!0;else if("AUTOSAVE"!==d[0]||mvpMode)if(this.ifListingPage()&&"WF_STATUSES"===d[0])b=a.substring(a.indexOf(",")+1),this.wfStatuses=JSON.parse(b);else if("WF"===d[0])b!==DATA||
c?b===HEADER&&(this.wfType=d[1]):(this.wfId=d[1],this.wfStatus=d[2]);else if("WFINFO"!==d[0]||b!==DATA||c)if("TF"===d[0]&&b===HEADER)this.titleField=parseInt(d[1]);else if("PARTNER_TEMPLATE"===d[0]&&b===HEADER)this.partnerTemplateId=d[1],getPromise("/api/http/templateInfo.jsp",{id:d[1]}).then(JSON.parse).then(function(a){var b=a["Partner Logo"],c=$("partnerButton");c.style.display="none";var d=document.createElement("img");d.id="partnerLogo";d.src="https://www.ragic.com/sims/file.jsp?a=kb&f="+b;d.partnerInfo=
a;(a=c.querySelector("#partnerLogo"))&&c.removeChild(a);$("partnerButton").appendChild(d);$("partnerButton").style.display=""});else if("KF"!==d[0]||b!==DATA||c)if("ST"!==d[0]||b!==DATA||c)if("C"!==d[0]||b!==DATA||c||mvpMode){if("K"===d[0]&&b===DATA)return b=a.substring(a.indexOf(",")+1),b=JSON.parse(b),this.buttons.push(new Button(b.id,b.type,b.seq,b.name||"No name",b.action,b.confirmBeforeAction,b.needApproval,b.userGroups,b.hideButton,b.checkIfUserCanEdit)),!1;if("WIDGET"===d[0]&&6<=d.length)b=
JSON.parse(decodeURIComponent(d[5])),b.layout.x=parseInt(d[1]),b.layout.y=parseInt(d[2]),b.layout.width=parseInt(d[3]),b.layout.height=parseInt(d[4]),this.widgets.push(b),this.widgetsCount++;else{if("CR"===d[0]){b=new Template(d[1],d[2],d[3]);b.ifListingMode=4<d.length?"true"===d[4]:!1;b.displayButton=b.ifListingMode?!1:!0;try{b.displayButton=JSON.parse(d[5])}catch(q){}b.userGroups=[];try{d[6]&&(b.userGroups=JSON.parse(d[6].replace(/`/g,",")))}catch(q){}b.maintainImgAspectRatio=!1;try{b.maintainImgAspectRatio=
JSON.parse(d[7])}catch(q){}b.fileNameRefDomainId=-1;try{e=parseInt(JSON.parse(d[8])),b.fileNameRefDomainId=isNaN(e)?-1:e}catch(q){}this.templates.push(b);return!1}if("DCF"===d[0])return this.custFieldsSets.push(new CustFieldsSet(d[1],d[2],d[3])),!1;if("SEC"===d[0])this.initSections(JSON.parse(decodeURIComponent(d[1]))),nui.loadOpenedSectionCache();else if("IR"===d[0])this.interactiveRuleString=d[1];else if("SYSMSG"===d[0])floatWinWarning(d[1]);else if("NUI_FILE_NAME"===d[0])this.nuiFileName=d[1];
else if("QS"===d[0])this.quickSaveDisableCode=parseInt(d[1]);else if("IFREAD"===d[0])this.tasks=JSON.parse(decodeURIComponent(d[1]));else if("LOCK"===d[0])this.lock=d[1].split("|").map(function(a){return parseInt(a)});else if("STAR"===d[0])this.star=d[1].split("|").map(function(a){return parseInt(a)});else if("INTRO"===d[0])this.intro={group:d[1],type:d[2],source:d[3]};else if("GCONST"===d[0])this.globalConst=JSON.parse(a.substring(a.indexOf(",")+1));else{if(d[0]===TYPER||d[0]===SELECTOR||d[0]===
FREE||d[0]===MSELECTOR||d[0]===UPLOADER||d[0]===GRAPHICS){var k=new Biff(d,b);if(k.invalid)return!1;-1==this.rootDomainId&&b===DATA&&(k.domainId&&(this.rootDomainId=k.domainId),k.nodeId&&(this.rootNodeId=k.nodeId),-1!=k.parentDomainId&&(this.parentDomainId=k.parentDomainId),-1!=k.parentNodeId&&(this.parentNodeId=k.parentNodeId),k.value&&(this.rootNodeValue=k.value));e=k.hasAttribute("cg")?k.attr.cg:"";if(c){(a=this.shiftSetTotalShift[this.domainSetId[k.domainId+"y"+k.y]])||(a=0);if(!biffdata.ifSubtableDomainId(k.domainId)&&
0<biffdata.subtableShifts.length)for(g=0;g<biffdata.subtableShifts.length;g++)f=biffdata.subtableShifts[g].amount,k.y+a>biffdata.subtableShifts[g].y&&(a+=f);a&&(k.y+=a,k.sec[2]=k.y)}0<k.domainId&&this.titleField==k.domainId&&(this.titleFieldValue=k.value);if(k.hasAttribute("usrref")&&d[0]===MSELECTOR){var l=this;l.groupsInfo||ajaxget("/sims/groups.jsp",{a:ap},function(a){if(a=JSON.parse(a))l.groupsInfo=a},!0)}k.hasAttribute("usrref")&&k.dataType===DATA&&0<=k.nodeId&&(a=this.selections.find(function(a){return parseInt(a[1])===
k.domainId}))&&!a.includes(k.nodeId+"|"+k.value)&&a.every(function(a){return!a.startsWith(k.nodeId+"|")})&&a.push(k.nodeId+"|"+k.value);if(!this.ifHasSelection(k.domainId)||k.attr&&k.attr.mvpf)k.lazyLoading=!0;a=!biffdata.keyField&&this.existingCellCords.includes(k.x+","+k.y+","+k.domainId+(e?","+e:""));if(c||a)!(e=this.findBiff(k.domainId,k.y))||!c&&e.value&&0!==e.value.length||(d[0]===SELECTOR?(b=selpro.getSelectList(k.domainId),-1!=b.nodeIds.indexOf(k.nodeId)&&(k.value=b.options[b.nodeIds.indexOf(k.nodeId)]),
-1==b.options.indexOf(k.value)&&(this.addSelectionValue(k.domainId,k.nodeId,k.value),b.options.push(k.value),b.nodeIds.push(k.nodeId)),e.hasAttribute("usrref")&&(e.nodeId=k.nodeId),e.ip?e.hasAttribute("mvp")?e.ip.loadValueByNodeId(k.nodeId,!1,k.value,!0)||e.ip.loadValue(k.value,!1,null,!1,!0):e.ip.loadValue(k.value,!1,null,!1,!0):e.value=k.value):d[0]===MSELECTOR?k.value&&k.nodeId?(e.value=k.value,e.nodeId=k.nodeId):""===k.value&&-1==k.nodeId&&(e.value=k.value,e.nodeId=k.nodeId):(e.ip&&e.ip.value!==
k.value?e.ip.loadValue(k.value):e.value=k.value,e.updatedBySubform=!0,d[0]===TYPER&&b===DATA&&e.format()));else{if(c)return null;this.biffs.push(k);this.existingCellCords.push(k.x+","+k.y+","+k.domainId+(e?","+e:""));k.dataType===DATA&&(this.ifSubtableDataBiff(k)?(ctrl.draftLoading||(k.isEmptyRow=0>k.parentNodeId,k.isSubtableObj=!0),b=k.parentDomainId,k.hasAttribute("cg")?(this.subtableDataBiffs.hasOwnProperty(b)||(this.subtableDataBiffs[b]={}),this.subtableDataBiffs[b].hasOwnProperty(k.attr.cg)||
(this.subtableDataBiffs[b][k.attr.cg]=[]),this.subtableDataBiffs[b][k.attr.cg].push(k)):(this.subtableDataBiffs.hasOwnProperty(b)||(this.subtableDataBiffs[b]=[]),this.subtableDataBiffs[b].push(k))):ctrl.lastEditTimeDefaultValue.includes(k.attr.dv)?this.lastEditTimeDefaultValueSingleBiffs.push(k):ctrl.lastEditUserDefaultValue.includes(k.attr.dv)&&this.lastEditUserDefaultValueSingleBiffs.push(k))}return k}"MAGIC_ENTRY"===d[0]&&(this.rights=d[1],this.noedit=!!parseInt(d[2]))}}}else{if(ctrl.doingSilentReload){if(0<
this.emailSize)return!1;this.emailSize=parseInt(d[2]);isNaN(this.emailSize)&&(this.emailSize=0);0<this.emailSize?$("emailSize").innerHTML="("+this.emailSize+")":rm($("emailSize"))}else{if(0<this.commentSize||0<this.emailSize)return!1;this.commentSize=parseInt(d[1]);this.emailSize=parseInt(d[2]);b=parseInt(d[3]);c=parseInt(d[4]);isNaN(this.commentSize)&&(this.commentSize=0);isNaN(this.emailSize)&&(this.emailSize=0);isNaN(b)&&(b=0);0<this.commentSize?$("commentCount").innerHTML="("+this.commentSize+
")":rm($("commentCount"));0<this.emailSize?$("emailSize").innerHTML="("+this.emailSize+")":rm($("emailSize"));0<this.commentSize&&"true"!==RagicStorage.localStorage.getItem("hide_commentWin")?switchRightDock($("commentWin"),$("comments"),loadComments,1):switchRightDock($("commentWin"),$("comments"),loadComments,2);0<b-this.commentSize&&!biffdata.ifListingPage()&&loadAllCellComments();0<this.emailSize&&0<c&&"true"!==RagicStorage.localStorage.getItem("hide_emailWin")?switchRightDock($("emailWin"),$("emailEditor"),
loadEmailEditor(),1):switchRightDock($("emailWin"),$("emailEditor"),loadEmailEditor,2)}return!1}else{b=this.biffs.find(function(a){return a.dataType===HEADER&&a.x===+d[1]&&a.y===+d[2]});var m=[],n=[];(d[6]||"").split("&").forEach(function(a){a=new FilterItem(a);FILTER_OPERAND.isSortingFilter(a.operator)?n.push([a.domainId,a.operator===FILTER_OPERAND.SORT_ASC||a.operator===FILTER_OPERAND.SECONDARY_SORT_ASC?SORT_ASC:SORT_DESC]):0<a.operator&&m.push(a)});b=new Subtable({domainId:+d[3],domainIdAlias:d[4]||
-1,keyUrl:d[5]||"",filters:d[6]||"",defaultFilters:m,defaultSortings:n,firstHeader:b});this.subtables.push(b);c=d[1]+","+d[2];this.subtableLocationCheck.includes(c)||this.subtableLocationCheck.push(c);this.subtableKeyFields.push(parseInt(d[3]));7<=d.length&&this.subtableFilters.push(d[6]);6<=d.length?this.subtableKeyUrl.push(d[5]):this.subtableKeyUrl.push("");5<=d.length?this.subtableKeyFieldAlias.push(parseInt(d[4])):this.subtableKeyFieldAlias.push(-1);8<=d.length?(this.subtableFpUrls.push(d[7]),
b.fpUrl=d[7]):this.subtableFpUrls.push("")}else this.rootDomainId=parseInt(d[1]),this.keyField=!0,2<d.length&&(this.rootNodeId=parseInt(d[2]),0>this.rootNodeId&&!ctrl.newDataFlag&&0<=window.rpNodeId&&deletedRecordPrompt(),ctrl.newDataFlag&&(ctrl.newDataFlag=!1),4<d.length&&(this.parentDomainId=parseInt(d[3]),this.parentNodeId=parseInt(d[4])));else this.wfInfo=a.substring(a.indexOf(",")+1);else"1"==d[1]&&(this.autoSave=!0,ctrl.silentAutoReload||($("draftDiv").innerHTML=lm.autoSaveChanges,$("draftDiv").style.display=
""))}};function deletedRecordPrompt(){window.rmlc?floatWinWarning(lm.deletedRecordPromptMagicLink,!0):floatWinWarning(lm.deletedRecordPrompt,!0)}BiffData.prototype.hasSections=function(){return 0<this.getSectionLength()};BiffData.prototype.sectionExist=function(a){return this.hasSections()?!!this.sections.sections[a]:!1};BiffData.prototype.ifStartFirstSection=function(a){return this.getSectionStart(0)===a};
BiffData.prototype.getSectionLength=function(){return this.sections&&this.sections.sections?this.sections.sections.length:0};BiffData.prototype.getEndOfLastSection=function(){var a=this.getSectionLength();if(0<a){var b=this.sections.sections[a-1].end;this.sections.sections[a-1].shift&&(b+=this.sections.sections[a-1].shift);this.sections.endShift&&(b+=this.sections.endShift);return b}return null};
BiffData.prototype.isSectionEnd=function(a){if(!this.sections||!this.sections.sections||0==this.sections.sections.length)return!1;for(var b=0;b<this.sections.sections.length;b++){var c=this.getSectionEnd(b);if(a===c)return!0}return!1};
BiffData.prototype.getSectionIndex=function(a){if(!this.sections||!this.sections.sections||!this.sections.start||a<this.getSectionStart(0))return-1;if(a===this.getSectionStart(0))return 0;for(var b=0;b<this.sections.sections.length;b++){var c=this.getSectionEnd(b);if(a<=c)return b}return-1};BiffData.prototype.ifRenderRow=function(a){if(!this.sections||!this.sections.sections||!this.sections.start)return!0;a=this.getSectionIndex(a);return-1===a?!0:this.sections.sections[a].display?!0:!1};
BiffData.prototype.initSections=function(a){var b=0;if(this.hasSections()){var c=this.getDisplaySection();-1!==c&&(b=c)}this.sections=a;this.sections.sections[b].display=!0};BiffData.prototype.getDisplaySection=function(){if(!this.sections||!this.sections.sections||!this.sections.start)return-1;for(var a=0;a<this.sections.sections.length;a++){var b=this.sections.sections[a];if(b&&b.display)return a}return-1};
BiffData.prototype.getSectionStart=function(a){if(0===a)return this.sections.start+(this.sections.shift?this.sections.shift:0);var b=this.sections.sections[a];return this.sections.sections[a-1].end+(b.shift?b.shift:0)+1};BiffData.prototype.getSectionEnd=function(a){var b=this.sections.sections[a];return(a=this.sections.sections[a+1])?b.end+(a.shift?a.shift:0):b.end+b.shift+(this.sections.endShift?this.sections.endShift:0)};
BiffData.prototype.getSectionIndexNoShift=function(a){if(!this.sections||!this.sections.sections||!this.sections.start||a<this.sections.start)return-1;if(a===this.sections.start)return 0;for(var b=0;b<this.sections.sections.length;b++)if(a<=this.sections.sections[b].end)return b;return-2};
BiffData.prototype.expandSection=function(a,b){if(this.sections&&this.sections.sections&&this.sections.start&&(a=this.getSectionIndex(a),-1!=a&&-2!=a))for(;a<this.sections.sections.length;a++)this.sections.sections[a].end+=b};BiffData.prototype.setEndShift=function(a){a&&(this.sections.endShift=a)};BiffData.prototype.setStartShift=function(a){this.sections&&this.sections.sections&&this.sections.start&&(this.sections.start+=a)};
BiffData.prototype.setSectionShift=function(a,b){if(this.sections&&this.sections.sections&&this.sections.start)if(a<this.sections.start&&(!this.sections.shift||this.sections.shift<b))this.sections.shift=b;else if(a=this.getSectionIndexNoShift(a),-1!==a&&-2!==a&&(a=this.sections.sections[a],!a.shift||a.shift<b))a.shift=b};BiffData.prototype.getRootNodeIdList=function(){if(this.ifListingPage()){for(var a=biffdata.biffs,b={},c=0;c<a.length;c++){var d=a[c];0<=d.parentNodeId&&(b[d.parentNodeId]=!0)}return Object.keys(b)}return this.rootNodeId};
BiffData.prototype.getSubtableRootNodeIdList=function(a){for(var b=biffdata.biffs,c={},d=0;d<b.length;d++){var e=b[d];0<=e.parentNodeId&&e.parentDomainId==a&&(c[e.parentNodeId]=!0)}return Object.keys(c)};
BiffData.prototype.hasButtons=function(){if(0===this.buttons.filter(function(a){return a.hideButton||a.checkIfUserCanEdit&&!checkIfUserCanEdit(!0,!0)||a.id&&-1!=a.id.indexOf("_")?!1:!0}).length&&0===this.templates.length)return!1;var a=this.ifListingPage()?this.templates.find(function(a){return a.displayButton}):this.templates.find(function(a){return!a.ifListingMode&&a.displayButton});return 0<this.buttons.length||!!a};
BiffData.prototype.addSelectionValue=function(a,b,c){var d=this.selections.find(function(b){return parseInt(b[1])===parseInt(a)});d?d.push(b+"|"+c):this.selections.push([SELECTION,""+a,"",b+"|"+c])};BiffData.prototype.isSameSubtable=function(a,b){if(a.IPType===FREE||b.IPType===FREE)return!1;a=a.getSubtable();return!!a&&a===b.getSubtable()};
BiffData.prototype.findHeader=function(a,b){a=+a;return b?this.headerBiffs.find(function(b){return b.domainId===a&&this.ifSubtableBiff(b)}.bind(this))||null:this.headerBiffs.find(function(b){return b.domainId===a})||null};BiffData.prototype.findLeftHeader=function(a){return this.biffs.find(function(b){return b.x===a.x-1&&b.y===a.y&&b.dataType===HEADER})};
BiffData.prototype.findSameSubtableRowDataBiffs=function(a){var b=this;return a.dataType!==HEADER&&b.ifSubtableDataBiff(a)?b.biffs.filter(function(c){return b.ifSubtableDataBiff(c)&&c.y===a.y&&(b.ifListingPage()||b.isSameSubtable(c,a))}):[]};BiffData.prototype.getTask=function(a,b){var c,d;for(d in this.tasks){var e=this.tasks[d];b&&b!=e.oid||"C"!==e.s&&decodeURIComponent(e.u)==a&&(c=e)}return c};
BiffData.prototype.getFieldValue=function(a,b){var c;for(c=0;c<this.biffs.length;c++){var d=this.biffs[c];if(b){if(d.domainId==a&&d.parentNodeId==b&&d.dataType===DATA)return d.value}else if(d.domainId==a&&d.dataType===DATA)return d.value}return null};BiffData.prototype.findFree=function(a,b){for(var c=this.biffs.length,d=0;d<c;++d){var e=this.biffs[d];if(e.IPType===FREE&&e.x===a&&e.y===b)return e}return null};
BiffData.prototype.findData=function(a,b){var c;for(c=0;c<this.biffs.length;c++){var d=this.biffs[c];if(d.domainId==a&&d.nodeId==b&&d.dataType===DATA)return d}return null};
BiffData.prototype.findHeaderFromBiff=function(a){if(!a||a.IPType===FREE)return null;if(a.dataType===HEADER)return a;if(this.isDomainIdUnique(a.domainId))return this.headerBiffs.find(function(b){return b.domainId===a.domainId});var b=this.headerBiffs.filter(function(b){return b.domainId===a.domainId}),c=b.find(function(b){return b.x===a.x-1&&(b.y===a.y||b.y===a.y+1)});return c?c:b.reduce(function(b,c){return c.x===a.x&&c.y<=a.y&&(!b||b.y<=c.y)?c:b},null)};
BiffData.prototype.findBiff=function(a,b){var c,d;if(b){for(c=0;c<this.biffs.length;c++)if((d=this.biffs[c])&&d.domainId==a&&d.y==b&&d.dataType===DATA)return d;for(c=0;c<this.biffs.length;c++)if((d=this.biffs[c])&&d.domainId==a&&d.dataType===DATA)return d;return null}b=[];for(c=0;c<this.biffs.length;c++)(d=this.biffs[c])&&d.domainId==a&&d.dataType===DATA&&b.push(d);return b};
BiffData.prototype.findBiffV2=function(a,b){a=this.findBiff(a);return b?a.filter(function(a){return this.ifSubtableBiff(a)}.bind(this)):a};BiffData.prototype.findSubtableDataBiffs=function(a,b){return this.ifSubtableDomainId(a)&&b?this.findBiffV2(a,!0).filter(function(a){return a.getSubtable()===b}):null};
BiffData.prototype.findSubtableDataBiffsV2=function(a,b){if(!this.ifSubtableDataBiff(a))return[];var c=a.domainId;a=a.hasAttribute("cg")?b?Object.values(this.subtableDataBiffs[a.parentDomainId]).flat():this.subtableDataBiffs[a.parentDomainId][a.attr.cg]:this.subtableDataBiffs[a.parentDomainId];return Array.isArray(a)?a.filter(function(a){return c===a.domainId}):[]};BiffData.prototype.findBiffByLocation=function(a,b){return this.biffs.find(function(c){return c.x===a&&c.y===b})||null};
BiffData.prototype.ifRight=function(a,b){var c,d=!1;for(c=0;c<this.biffs.length;c++){var e=this.biffs[c];e.x==a+1&&e.y==b&&e.dataType===DATA&&e.IPType!=FREE&&(d=!0)}return d};BiffData.prototype.getDataRoot=function(a,b,c){var d,e=[];for(d=0;d<this.biffs.length;d++){var f=this.biffs[d];f.y==b&&f.dataType===DATA&&f.IPType!=FREE&&(c?this.ifSubtableBiff(f)&&(e[f.x]=f):e[f.x]=f)}c=null;for(d=a;0<=d;d--)if(e[d])c=e[d];else break;return c&&c.x==a&&!biffdata.ifRight(a,b)?null:c};
BiffData.prototype.ifTableHeaderRest=function(a,b){var c,d=!1;var e=0;for(c=this.biffs.length;e<c;e++){var f=this.biffs[e];if(f.x==a-1&&f.y==b&&f.dataType===HEADER&&f.IPType!=FREE){d=!0;break}}return d};BiffData.prototype.ifAdjacent=function(a,b,c){var d,e=!1,f=!1;for(d=0;d<this.biffs.length;d++){var g=this.biffs[d];g.x==a+1&&g.y==b&&g.dataType===DATA?f=!0:g.x==a-1&&g.y==b&&g.dataType===DATA&&(e=!0)}return c?c(f,e):f&&!e};
BiffData.prototype.ifSubtableDomainId=function(a){if(isNaN(a)||!this.subtableDomainIds||0===this.subtableDomainIds.length)return!1;Number.isInteger(a)||(a=parseInt(a));return this.subtableDomainIds.includes(a)};BiffData.prototype.ifSubtableBiff=function(a){return a&&this.ifSubtableDomainId(a.domainId)?this.isDomainIdUnique(a.domainId)?!0:a.dataType===DATA?this.ifSubtableDataBiff(a):this.headerBiffs.some(function(b){return a.y===b.y&&1===Math.abs(b.x-a.x)}):!1};
BiffData.prototype.ifSubtableDataBiff=function(a){return a&&a.dataType===DATA&&this.ifSubtableDomainId(a.domainId)?this.isDomainIdUnique(a.domainId)||this.headerBiffs.filter(function(b){return b.domainId===a.domainId}).every(function(b){return b.y!==a.y||b.x+1!==a.x}):!1};
BiffData.prototype.loadHeader=function(a){this.rootDomainId=-1;a=a.responseText?a.responseText:a;if(a.split){var b=a.split("\n");for(a=0;a<b.length;a++)this.readline(b[a],HEADER);var c=1,d=[];b=[];var e={};for(a=0;a<this.biffs.length;e={$jscomp$loop$prop$b$562:e.$jscomp$loop$prop$b$562},a++){e.$jscomp$loop$prop$b$562=this.biffs[a];var f="";if(e.$jscomp$loop$prop$b$562.dataType===HEADER&&e.$jscomp$loop$prop$b$562.IPType!==FREE){var g=e.$jscomp$loop$prop$b$562.domainId;e.$jscomp$loop$prop$b$562.value&&
!this.rootDomainName&&(this.rootDomainName=e.$jscomp$loop$prop$b$562.value);this.headerBiffs.push(e.$jscomp$loop$prop$b$562);d.includes(g)?this.duplicateDomainIds.includes(g)||this.duplicateDomainIds.push(g):d.push(g);e.$jscomp$loop$prop$b$562.hasAttribute("f")?f=e.$jscomp$loop$prop$b$562.attr.f:e.$jscomp$loop$prop$b$562.hasAttribute("dv_f")&&(f=e.$jscomp$loop$prop$b$562.attr.dv_f);e.$jscomp$loop$prop$b$562.unique=c++;this.biffs.some(function(a){return function(b){return b.dataType===HEADER&&b.IPType!==
FREE&&b.y===a.$jscomp$loop$prop$b$562.y&&(b.x+1===a.$jscomp$loop$prop$b$562.x||b.x-1===a.$jscomp$loop$prop$b$562.x)}}(e))&&this.subtableDomainIds.push(g)}else e.$jscomp$loop$prop$b$562.IPType===FREE&&(f=retrieveFormulaFromDesc(e.$jscomp$loop$prop$b$562.value));if(f)for(f=formulaBuilder._findChangeCellNames(f),g=0;g<f.length;g++)b.includes(f[g])||b.push(f[g])}for(a=0;a<this.headerBiffs.length;a++){c=this.headerBiffs[a];d=getCellName(c.x,c.y);if(!b.includes(d))if(c.hasAttribute("f")||c.hasAttribute("dv_f"))b.push(d);
else continue;e=c.domainId;this.isDomainIdUnique(e)?this.domainIdCellMapping[e]=d:(this.domainIdCellMapping.hasOwnProperty(e)||(this.domainIdCellMapping[e]={}),this.domainIdCellMapping[e][c.unique]=d)}this.displaySheetName||(a=sheet.split("_"),a[1]=a[1].replace(/\+/g," "),this.displaySheetName=a[1])}};BiffData.prototype.loadDataSubform=function(a){this.loadData(a,!0)};
BiffData.prototype.loadData=function(a,b,c,d){b||(this.rootDomainId=-1);a=a.responseText?a.responseText:a;if(a.split){var e=a.split("\n"),f,g=!1,k=biffdata;k.lock=void 0;b||(k.timestamp=(new Date).getTime());var l=[],m=!0;for(a=0;a<e.length;a++)if(f=k.readline(e[a],DATA,b))this.pureInsert&&f.nodeId&&0<f.nodeId&&(this.pureInsert=!1),m&&f.value&&0<f.value.trim().length&&(m=!1),g=!0,k.anydata=!0,l[f.y]=!0;if(!b){0<k.emailSize?$("emailButton").style.display="":$("emailButton").style.display="none";k.hasButtons()?
$("actionButton").style.display="":$("actionButton").style.display="none";k.wfType&&(k.wfId||"W"===k.rights)?("true"!==RagicStorage.localStorage.getItem("hide_wfWin")?switchRightDock($("wfWin"),$("wfMain"),loadWorkflow,1):loadWorkflow(),$("wfButton").style.display=""):($("wfButton").style.display="none",$("wfWin").style.display="none");switchRightDock($("historyWin"),$("historyMain"),loadHistory,5);switchRightDock($("infoWin"),$("infoMain"),loadInfo,5);k.hasButtons()&&(ifShowActionButtonWin()?switchRightDock($("actionButtonWin"),
$("actionButtonMain"),loadActionButtons,1):(loadActionButtons(),switchRightDock($("actionButtonWin"),$("actionButtonMain"),null,2)));for(a=e=0;a<l.length;a++)l[a]&&e++;k.ifListingPage()&&(k.dataRowCount=e);mvpMode||updatePaging();$("stickyHeader")&&document.body.removeChild($("stickyHeader"));$("stickyHeaderBuilder")&&document.body.removeChild($("stickyHeaderBuilder"));$("stickyHeaderLeftBuilder")&&document.body.removeChild($("stickyHeaderLeftBuilder"));if(!d){this.doShifting();f=k.biffs;l=[];for(a=
0;a<f.length;a++)d=f[a],(e=l[d.y])||(e=[]),e[d.x]=d,l[d.y]=e;var n;for(a=0;a<l.length;a++)if(e=l[a])for(f=n=0;f<e.length;f++)if(d=e[f])d.absoluteX-d.x!=n&&(d.builderX=d.x,d.x-=n),this.ifSubtableBiff(d)&&d.hasAttribute("cs")&&(n+=parseInt(d.attr.cs)-1)}}n=f=l=e=null;var q=ctrl.NUIRowNum,r=ctrl.NUIColNumBrowse;for(a=0;a<k.biffs.length;a++){d=k.biffs[a];if(!e||e<d.y)e=d.y;if(!l||l<d.absoluteX)l=d.absoluteX;if(d.dataType===HEADER)this.headerMaxY||(this.headerMaxY=0),this.headerMaxY=Math.max(this.headerMaxY,
d.y);else if(d.dataType!==FREE){if(!f||f>d.x)f=d.x;if(!n||n>d.y)n=d.y}}this.dataminY=n;this.dataminX=f;this.dataMaxY=e;this.dataMaxX=l;this.maxY=e?e+2:q;this.maxX=l?l:r;this.dataMaxY=e;g||!k.anydata?(ctrl.silentAutoReload?(this.autoSave&&(displayData(),0<=this.rootNodeId&&checkEmptySubtableRows()),updateNUIForm(),ctrl.silentAutoReload=!1):(displayData(),this.autoSave&&0<=this.rootNodeId&&checkEmptySubtableRows()),$("v6Query")&&k.filterStatus.v6ApplyFilter(),mvpMode?(displayNUIHeader(),adjustPrevNext(),
$("bMvpClearFilter").style.display=biffdata&&biffdata.filteredDomains&&0<biffdata.filteredDomains.length?"":"none"):b||topButtonDisplay(),ctrl.isFF&&ctrl.currentController.resize()):loadingBox&&(loadingBox.style.display="none");""===$("floatingWin").style.display&&"History"===floatWinMode&&(floatWin(),floatWinMode="History");!b&&!c&&!biffdata.ifListingPage()&&-1==biffdata.parentDomainId&&0<=biffdata.rootNodeId&&(location.hash="#!/"+sheetIndex+"/"+biffdata.rootNodeId);biffdata.needLoadPaymentWin?switchRightDock($("paymentWin"),
$("paymentMain"),loadPaymentWin,1):switchRightDock($("paymentWin"),$("paymentMain"),loadPaymentWin,2);m&&!b&&biffdata.ifListingPage()&&"T"==biffdata.nextButton&&1==biffdata.currentEntry?floatWinWarning(lm.notice_2_1):owner&&!mvpMode&&25<=l&&biffdata.ifListingPage()&&(b=RagicStorage.localStorage.getObjectItem("doNotNotifyAgain_notice_1",!1),(c=getStorage("notice_1"))&&6048E5<(new Date).getTime()-c&&(c=null),b||c||(floatWinWarning(lm.notice_1_1+l+lm.notice_1_2+lm.notice_1_checkbox),document.getElementById("doNotNotifyInput").onclick=
function(a){RagicStorage.localStorage.setObjectItem("doNotNotifyAgain_notice_1",a.currentTarget.checked)},RagicStorage.localStorage.setItem("notice_1",(new Date).getTime())));biffdata.ifListingPage()||biffdata.keyField||(biffdata.subtables=biffdata.biffs.filter(function(a){return a.isSubtableFirstField()}).map(function(a){return new Subtable(a)}));biffdata.intro&&processIntro()}};
BiffData.prototype.doShifting=function(){function a(a){var b=k[a]-g[a];n[a]=3<b?n[a]?Math.max(n[a],b-3):b-3:0}function b(a){for(var c=0,d=0;d<Q;d++){var f;if(f=g[d]<g[a]){f=a;var k=d;if(0<=G[f][k])f=0<G[f][k];else{var q=l[f],p=m[f],r=l[k],t=m[k],u=g[k],w=e.getSectionIndexNoShift(g[f]);u=e.getSectionIndexNoShift(u);w!==u||q<=r&&r<=p||q<=t&&t<=p||r<=q&&q<=t||r<=p&&p<=t?(G[f][k]=1,f=!0):(G[f][k]=0,f=!1)}}f&&(0>P[d]&&b(d),void 0==n[d]&&(n[d]=0),c=Math.max(c,P[d]+n[d]))}P[a]=c}this.domainSetId={};this.shiftSetTotalShift=
[];var c,d,e=biffdata,f=[],g=[],k=[],l=[],m=[],n=[],q=this.domainSetId,r={},p=-1,t={};try{var v={};for(c=0;c<e.biffs.length;v={$jscomp$loop$prop$yDistance$564:v.$jscomp$loop$prop$yDistance$564,$jscomp$loop$prop$domainSetIdKey$565:v.$jscomp$loop$prop$domainSetIdKey$565},c++){var u=e.biffs[c],x=u.hasAttribute("cg")?u.attr.cg:"";if(u.dataType===HEADER){if(e.ifTableHeaderRest(u.x,u.y)){var E=f.length-1;var D=f[E];q[u.domainId+"y"+u.y]=E;D&&D.push(u)}else{var A=[];A.push(u);E=f.length;f.push(A);q[u.domainId+
"y"+u.y]=E;x&&(r[x]=E);g.push(u.y);k.push(u.y)}var w=u.x;for(A=0;0<w;){if(t[w+","+u.y]){A=t[w+","+u.y];break}w--}u.absoluteX=u.x+A;var F=1;if(u.hasAttribute("cs")&&(F=parseInt(u.attr.cs),this.ifSubtableBiff(u)))for(d=0;4>d;d++)t[u.x+1+","+(u.y+d)]=A+F-1;if(!l[E]||u.absoluteX<l[E])l[E]=u.absoluteX;var C=this.ifSubtableDomainId(u.domainId)||u.IPType===FREE?u.absoluteX+F-1:u.absoluteX+F;if(!m[E]||C>m[E])m[E]=C}else{A=null;var z=parseInt(u.y),J=parseInt(u.x);if(x)A=r[x];else if(L==J-1&&B==u.y&&this.ifSubtableBiff(u))A=
p;else{for(F=1500;void 0==A&&0<z;)A=q[u.domainId+"y"+z],z--,0>F&&(A=0),F--;0>F&&(v.$jscomp$loop$prop$yDistance$564=void 0,v.$jscomp$loop$prop$domainSetIdKey$565=void 0,Object.keys(q).forEach(function(a){return function(b){if(b.startsWith(u.domainId+"y")){var c=parseInt(b.substr((u.domainId+"y").length));!isNaN(c)&&0<u.y-c&&(void 0===a.$jscomp$loop$prop$yDistance$564||u.y-c<a.$jscomp$loop$prop$yDistance$564)&&(a.$jscomp$loop$prop$yDistance$564=u.y-c,a.$jscomp$loop$prop$domainSetIdKey$565=b)}}}(v)),
v.$jscomp$loop$prop$domainSetIdKey$565&&(A=q[v.$jscomp$loop$prop$domainSetIdKey$565]))}var L=J;var B=u.y;p=A;var y=f[A];y&&y.push(u);if(!k[A]||u.y>k[A])k[A]=u.y;var O=y.length;if(2==O){var K=y[0];u.absoluteX=K.absoluteX+1}else if(2<O){for(d=0;d<O;d++){var M=y[d];if(M.dataType===HEADER&&M.domainId==u.domainId){K=M;break}}u.absoluteX=K.absoluteX}}}}catch(T){window.onerror(T.message,"shift biffdata",T.lineNumber,T.columnNumber,T)}var Q=f.length;for(c=0;c<Q;c++)a(c);var P=Array(Q);for(c=0;c<Q;c++)P[c]=
-1;var G=Array(Q);for(c=0;c<Q;c++)for(G[c]=Array(Q),d=0;d<Q;d++)G[c][d]=-1;var R=-1;for(c=0;c<Q;c++)for(0>P[c]&&b(c),q=P[c],this.shiftSetTotalShift[c]=q,r=f[c],L=r.length,B=this.existingCellCords,d=0;d<L;d++)for(t=r[d],v=void 0,v=t.hasAttribute("cg")?t.attr.cg:"",p=t.x+","+t.y+","+t.domainId+(v?","+v:""),0===d&&(R=biffdata.getSectionIndexNoShift(t.y),0<=R&&(biffdata.sections.sections[R].hasOwnProperty("shift")||biffdata.setSectionShift(t.y,q))),t.y+=q,t.sec[2]=t.y,t=t.x+","+t.y+","+t.domainId+(v?
","+v:""),v=0;v<B.length;v++)if(B[v]==p){B[v]=t;break}if(biffdata.hasSections()&&0<biffdata.subtableKeyFields.length){var N=biffdata.sections.sections;c=e.getSectionLength();var H={},I={};R=-1;g.forEach(function(a,b){2>=f[b].length||(R=biffdata.getSectionIndexNoShift(a),H.hasOwnProperty(R)&&!(k[b]>H[R]))||(H[R]=k[b],0<R?I[R]=n[b]+P[b]-N[R].shift:-1===R&&(I[R]=n[b]+P[b]))});d=I[-1]||0;for(q=0;q<c;q++)r=e.sections.sections[q],r.hasOwnProperty("shift")?d=r.shift+I[q]:r.shift=d;d=N[0].shift||0;0<d&&biffdata.setStartShift(d);
0<I[c-1]&&biffdata.setEndShift(I[c-1])}d=0;q=biffdata.heightCommand.split("&");r={};L=q.length;B=g.filter(function(a,b){return n[b]});p=new Set;for(c=0;c<Q;c++)if(n[c]&&(t=P[c]+n[c],d=Math.max(d,t),!p.has(d)))for(t={},v=0;v<L;t={$jscomp$loop$prop$y$567:t.$jscomp$loop$prop$y$567},v++)E=q[v].split("=",2),2>E.length||(t.$jscomp$loop$prop$y$567=parseInt(E[0]),x=B.some(function(a){return function(b){return a.$jscomp$loop$prop$y$567>b&&a.$jscomp$loop$prop$y$567<=b+3}}(t)),t.$jscomp$loop$prop$y$567>g[c]+
3&&!x&&(r[v]=t.$jscomp$loop$prop$y$567+d+"="+E[1],p.add(d)));for(U in r)q[U]=r[U];biffdata.heightCommand=q.join("&");for(c=0;c<Q;c++)if(n[c]){var U=g[c]+P[c];d=k[c]+P[c];subtableCopyHeight(d,U)}cleanDefaultWidthHeight()};BiffData.prototype.hasFieldWithAttribute=function(a){for(var b=0;b<this.biffs.length;b++){var c=this.biffs[b];if(c.dataType==HEADER&&c.attr&&c.attr[a])return!0}return!1};
BiffData.prototype.draftReset=function(){this.headerBiffs=[];this.biffs=[];this.subtableDataBiffs={};this.lastEditTimeDefaultValueSingleBiffs=[];this.lastEditUserDefaultValueSingleBiffs=[];this.loadLastEditUserDefaultValue=!1;this.autoGenGuessRefMap={}};
BiffData.prototype.reset=function(){this.headerBiffs=[];this.biffs=[];this.subtableDataBiffs={};this.imgFitBiffsRenderAgain.clear();this.notify=[];this.selections=[];this.filteredDomains=[];this.anydata=!1;this.existingCellCords=[];this.orderDomain=[];this.orderDir=[];this.emailSize=this.commentSize=0;this.displaySheetName=null;this.formDesc="";this.wfType=this.wfId=null;this.customFilter={};this.buttons=[];this.tasks=[];this.cellLocCommentJSON=[];this.subtables=[];this.subtableShifts=[];this.subtableKeyFields=
[];this.subtableKeyFieldAlias=[];this.subtableFilters=[];this.subtableDomainIds=[];this.duplicateDomainIds=[];this.interactiveRuleString="";this.filterStatus.filterItems=[];ctrl.silentAutoReload||(this.formulaMap={},this.domainIdCellMapping={},this.updateCellIds=[],this.updateCellIndex=0);this.sections={};loadingBox&&(loadingBox.style.display="");this.subforms=[];this.templates=[];this.custFieldsSets=[];this.additionalInfo=[];this.nuiFileName="";this.wfInfo=null;this.lastEditTimeDefaultValueSingleBiffs=
[];this.lastEditUserDefaultValueSingleBiffs=[];this.loadLastEditUserDefaultValue=!1;this.autoGenGuessRefMap={}};BiffData.prototype.ifHasSelection=function(a){return this.selections.some(function(b){return parseInt(b[1])===parseInt(a)})};BiffData.prototype.getSelectionValue=function(a,b){for(var c=this.selections,d=0;d<c.length;d++)if(c[d][1]==a)for(var e=2;e<c[d].length;e++){var f=c[d][e].split("|");if(f&&2<=f.length&&f[0]==b)return f[1]}return null};BiffData.prototype.isDomainIdUnique=function(a){return!this.duplicateDomainIds.includes(a)};
BiffData.prototype.loadAllLastEditTimeDefaultValues=function(){if(canSaveData()){var a=nui._curcell()&&nui._curcell().ip&&nui._curcell().ip.biff;this._loadAllLastEditDefaultValues(a,this.lastEditTimeDefaultValueSingleBiffs)}};BiffData.prototype.loadAllLastEditUserDefaultValues=function(){if(canSaveData()){var a=nui._curcell()&&nui._curcell().ip&&nui._curcell().ip.biff;this._loadAllLastEditDefaultValues(a,this.lastEditUserDefaultValueSingleBiffs)}};
BiffData.prototype._loadAllLastEditDefaultValues=function(a,b){biffdata.loadingLastEditDefaultValue=!0;for(var c=0,d,e,f=b.length;c<f;c++)d=b[c],(e=d.ip)&&d!==a&&d.hasAttribute("dv")&&(e.loadValue(getBiffDefaultValue(d)),e.render());biffdata.loadingLastEditDefaultValue=!1};
BiffData.prototype.loadSameSubtableRowLastEditDefaultValue=function(a){if(canSaveData()&&this.ifSubtableDataBiff(a)){biffdata.loadingLastEditDefaultValue=!0;a=this.findSameSubtableRowDataBiffs(a);for(var b=0,c,d,e=a.length;b<e;b++)d=a[b],(c=d.ip)&&d.hasAttribute("dv")&&"#"===d.attr.dv.charAt(0)&&(c.loadValue(getBiffDefaultValue(d),!1,null,!1,!0),c.render(),resetFormulaObject(d));biffdata.loadingLastEditDefaultValue=!1}};
function Biff(a,b){this.dataType=b;this.sec=a;this.IPType=a[0];if(this.IPType!==SELECTION){this.x=parseInt(a[1]);this.y=parseInt(a[2]);this.originalX=parseInt(a[1]);this.originalY=parseInt(a[2]);if(1E4<this.x||1E4<this.y)this.y=this.x=-1,this.invalid=!0;this.IPType===FREE?(this.originX=this.x,this.originY=this.y,this.action=a[3]):this.domainId=parseInt(a[3]);b==HEADER?(this.value=fieldHeaderDecode(a[4]),this.displayValue=fieldHeaderDecode(a[4]),(this.attr=parseAttributes(a[5]))&&(this.attr.l?biffdata.notify.push(parseInt(this.attr.l)):
this.attr.ln&&biffdata.notify.push(parseInt(this.attr.ln)))):(this.originalNodeId=this.nodeId=a[4],this.value=loadTextProcess(a[8]),this.displayValue=a[8],this.attr=parseAttributes(a[7]),this.parentDomainId=parseInt(a[5]),this.parentNodeId=parseInt(a[6]),mode!==BUILDER&&this.format(),this.originalValue=this.value);if(this.attr&&this.attr.actionButton)try{this.actionButton=JSON.parse(this.attr.actionButton),this.actionButtonId=this.attr.actionButtonId}catch(c){}this.IPType!==FREE&&this.attr&&biffdata.ifListingPage()&&
delete this.attr.cs;this._cache={header:null,subtable:null}}}
Biff.prototype.format=function(a){var b=this;if(b&&b.attr&&b.attr.ag&&b.IPType==TYPER&&0>b.nodeId){var c=b.isRefToOtherFieldAutoGen();a=biffdata.ifSubtableDataBiff(b);b.displayValue=""==b.value?a||c?" ":lm.AutoGen:b.value;if(!biffdata.ifListingPage()&&(biffdata.keyField&&b.parentDomainId==biffdata.rootDomainId&&!a||-1==b.parentDomainId)&&!c){var d=b.domainId,e=b.y;ajaxget("/sims/autogenGuess.jsp",{a:ap,d:b.domainId,ag:b.attr.ag,txn:biffdata.txnId,p:path,si:sheetIndex,nid:b.parentNodeId},function(a){var c=
biffdata.findBiff(d,e);!c||biffdata.ifListingPage()&&mode===BROWSE&&0===biffdata.totalEntry&&b!==c||(c.updateDisplayValue=a,c.ip&&c.ip.updateFormulaEngine&&(c.ip.updateFormulaEngine(!1),c.ip.render()))})}}else if(b&&b.attr&&b.attr.fmt_n){c=b.attr.fmt_n_ts;a=b.attr.fmt_n_ds;b.value=cleanUpNumber(b.value,c,a);var f=parseFloat(b.value);isNaN(f)?b.displayValue=b.value:(b.displayValue=formatNumber(f,b.attr.fmt_n,c,a),b.value=""+f)}else if(b&&b.attr&&b.attr.phonefmt)c=ragic_phone_reformat(b.value,b.attr.phonefmt),
b.displayValue=c,b.value=c;else if(b&&b.attr&&b.attr.fmt_d){var g=getStandardFormat(b.attr.fmt_d,b.value);f=g.includes("y");c=g.includes("H");g=getDateFromFormat(b.value,g);isNaN(g)&&(g=getDateFromFormat(b.value,b.attr.fmt_d),isNaN(g)&&(g=getDateFromFormat(b.value,"yyyy/MM/dd HH:mm:ss"),isNaN(g)&&(g=getDateFromFormat(b.value,"yyyy/MM/dd"))));var k=-6E4*(new Date).getTimezoneOffset();k=b.attr.email_updateDate||b.attr.email_createDate||b.attr.utcTime?0:k-companyTimeZoneOffset;var l=null;if(isNaN(g))if(a=
ragic_date_parse(b.value,b.attr.fmt_d,b.attr.f,a)){if(b.displayValue=formatDate(a,b.attr.fmt_d),b.value=formatDate(a,getStandardFormat(b.attr.fmt_d)),b.attr.ago||b.attr.countdown)b.displayValue=c?timeAgo(a.getTime()+k,!(!b.attr.email_updateDate&&!b.attr.email_createDate),!0):dayAgo(a.getTime()+k,!(!b.attr.email_updateDate&&!b.attr.email_createDate),!0)}else b.displayValue="",b.value="";else if(b.value=f&&c?formatDate(new Date(g),"yyyy/MM/dd HH:mm:ss"):f?formatDate(new Date(g),"yyyy/MM/dd"):formatDate(new Date(g),
"HH:mm:ss"),l=b.attr.repeat?formatRepeatDate(new Date(g),b.attr.repeat):formatDate(new Date(g),b.attr.fmt_d),b.displayValue=l,b.attr.ago||b.attr.countdown)b.displayValue=c?timeAgo((new Date(g)).getTime()+k,!(!b.attr.email_updateDate&&!b.attr.email_createDate),!0):dayAgo((new Date(g)).getTime()+k,!(!b.attr.email_updateDate&&!b.attr.email_createDate),!0)}else b&&b.attr&&b.IPType===GRAPHICS?b.attr.imageResize=!0:b.displayValue=displayValueProcess(b.value)};
Biff.prototype.ifCreateInsertRow=function(){var a=this.x,b=this.y,c=nui,d=this.domainId,e=c._getcell(a,b-1),f=c._getcell(a,b+1);c=c._getcell(a,b);c=biffdata.findHeaderFromBiff(c&&c.ip&&c.ip.biff);return(e&&e.ip&&e.ip.biff&&e.ip.biff.domainId==d||c&&a==c.x&&b==c.y+1)&&(!f||!f.ip||!f.ip.biff||f.ip.biff.domainId!=d)};Biff.prototype.hasAttribute=function(a){return this.hasOwnProperty("attr")?this.attr.hasOwnProperty(a):!1};
Biff.prototype.getAttribute=function(a){return this.hasAttribute(a)?this.attr[a]:null};Biff.prototype.hasAtLeastOneAttribute=function(){var a=this;return a.hasOwnProperty("attr")?Array.from(arguments).some(function(b){return a.attr.hasOwnProperty(b)}):!1};Biff.prototype.isSubtableFirstField=function(){return this.dataType===HEADER&&this.IPType!==FREE&&(biffdata.findBiffByLocation(this.x+1,this.y)||{}).dataType===HEADER&&!biffdata.findBiffByLocation(this.x-1,this.y)};
Biff.prototype.getSubtable=function(){if(this._cache.subtable)return this._cache.subtable;var a=biffdata.findHeaderFromBiff(this);if(!a)return null;var b=biffdata.subtables.find(function(b){return b&&a&&b.x===a.x&&b.y===a.y});return b?a._cache.subtable=b:(b=biffdata.findLeftHeader(a))?(b=b.getSubtable(),a._cache.subtable=b):null};
Biff.prototype.getFieldId=function(){var a=biffdata,b=+this.domainId;if(a.isDomainIdUnique(b))return new FieldId(b);var c=this.getSubtable();return c?new FieldId(b,-1===+c.domainIdAlias?+c.domainId:+c.domainIdAlias):new FieldId(b,+a.rootDomainId)};Biff.prototype.getSubtableKey=function(a,b){return b||biffdata.ifSubtableDataBiff(this)?this.parentDomainId+(a&&this.hasAttribute("cg")?"_"+this.attr.cg:""):-1};
Biff.prototype.isRefToOtherFieldAutoGen=function(){return this.hasAttribute("ag")?/\{2,reference,(\d+)\}/.test(this.attr.ag):!1};Biff.prototype.isAutoGenRefType=function(){return this.IPType===TYPER&&this.hasAttribute("fmt_d")||this.IPType===SELECTOR};
function parseAttributes(a){if(!a)return{};a=a.replace(/&#44;/g,",");a=a.split("&");var b,c={};for(b=0;b<a.length;b++){var d=a[b].indexOf("=");d=[a[b].substring(0,d),a[b].substring(d+1)];2>d.length||(d[1]=unformatNUIAttr(d[1]),"help"===d[0]&&(d[1]=d[1].replace(/<br\s*(\/)?>/gim,"\n").replace(/%26/gim,"&")),c[d[0]]=d[1])}void 0!==c.dv_f&&void 0!==c.dv&&delete c.dv;return c}
function changeEPP(a){100<a&&!confirm(lm.recordPerPageWarning)||(RagicStorage.localStorage.setItem("ctrl.NUIRowNum",a),ctrl.NUIRowNum=a,updatePaging(),ctrl.currentController.load("","",function(){mode==BROWSE&&(browse._init(),browse._focus())}))}function ifNoTotalEntry(){return 0<biffdata.filterStatus.filterItems.length||0!=biffdata.orderDir}
function updatePaging(a){var b=biffdata;if(b){b.totalEntry&&(b.totalEntry=Math.round(b.totalEntry));a=!ifNoTotalEntry()||"T"!=b.nextButton&&"T"!=b.prevButton||a?lm.entryUnit&&0<lm.entryUnit.length?" ("+lm.ofTotal+" <b id='entryCountNumber'>"+b.totalEntry+"</b> "+lm.entryUnit+")":lm.ofTotal+" <b>"+b.totalEntry+"</b>":"";var c=b.totalEntry&&-1!==b.totalEntry&&b.currentEntry+ctrl.NUIRowNum-1>b.totalEntry?b.totalEntry:b.currentEntry+ctrl.NUIRowNum-1;if(b.currentEntry&&c&&(0===b.totalEntry||b.totalEntry)){var d=
$("entryCount");"2"==b.formType?(switchRightDock($("wfWin"),$("wfMain"),loadWorkflow,2),switchRightDock($("historyWin"),$("historyMain"),loadHistory,2),switchRightDock($("infoWin"),$("infoMain"),loadInfo,2),switchRightDock($("commentWin"),$("comments"),loadComments,2),switchRightDock($("emailWin"),$("emailEditor"),loadEmailEditor,2),b.hasButtons()||switchRightDock($("actionButtonWin"),$("actionButtonMain"),loadActionButtons,2),d&&(d.innerHTML=0===b.totalEntry?lm.noEntries:lm.entryPrefix+" <b>"+b.currentEntry+
"</b> - <b>"+c+"</b> "+lm.entryUnit+a)):(b.hasButtons()||switchRightDock($("actionButtonWin"),$("actionButtonMain"),loadActionButtons,2),d&&rm(d))}}}function updateTotalEntry(a){biffdata.totalEntry=parseInt(a);updatePaging(!0)}
function Subtable(a){a instanceof Biff&&(a={domainId:+a.domainId,firstHeader:a});"object"!==typeof a&&(a={});this._x=a.x||-1;this._y=a.y||-1;this.domainId=a.domainId||-1;this.domainIdAlias=a.domainIdAlias||-1;this.keyUrl=a.keyUrl||"";this.filters=a.filters||"";this.defaultFilters=a.defaultFilters||[];this.defaultSortings=a.defaultSortings||[];this.firstHeader=a.firstHeader||null;Object.defineProperty(this,"x",{get:function(){return this.getX()}});Object.defineProperty(this,"y",{get:function(){return this.getY()}})}
Subtable.prototype.equals=function(a){return a instanceof Subtable?this.domainId===a.domainId&&this.domainIdAlias===a.domainIdAlias:!1};Subtable.prototype.getX=function(){return this.firstHeader?this.firstHeader.x:this._x};Subtable.prototype.getY=function(){return this.firstHeader?this.firstHeader.y:this._y};function BrowseController(){this.bcells=[];this.focusbcell=-1;this.focusbcellList=[0]}
BrowseController.prototype._trav=function(a){a?(this.focusbcellList.push(this.focusbcell),this.focusbcell=0):0<this.focusbcellList.length&&(this.focusbcell=this.focusbcellList.pop());this._init()};BrowseController.prototype.checkClickable=function(){if(0===biffdata.totalEntry)return!1;var a=this.bcells[this.focusbcell];return a&&1<a.length};
BrowseController.prototype._init=function(){var a;this.bcells=[];var b=[],c=[],d=biffdata.ifListingPage();for(a=0;a<biffdata.biffs.length;a++){var e=biffdata.biffs[a];if(e&&e.IPType!==SELECTION&&e.dataType!==HEADER&&!e.hasAttribute("hide")){var f=e.x,g=e.y;parseInt(e.domainId);parseInt(e.nodeId);if(e=nui._getcell(f,g)){if(b[g]&&(d||b[g]+1==f)){var k=c[g];e.browseIndex=k;this.bcells[k].push(e)}else k=[],e.browseIndex=this.bcells.length,c[g]=this.bcells.length,k.push(e),this.bcells.push(k);b[g]=f}}}this._focus();
rm($("dcelldiv"))};BrowseController.prototype._move=function(a){this.focusbcell+=a;0>this.focusbcell&&(this.focusbcell=0);this.focusbcell>=this.bcells.length&&(this.focusbcell=this.bcells.length-1);isNaN(this.focusbcell)&&(this.focusbcell=0);this._focus(!0)};
BrowseController.prototype._focus=function(a){if(0!==biffdata.totalEntry){var b,c=this.bcells[this.focusbcell];this._nofocus();if(c&&mode==BROWSE){for(b=0;b<c.length;b++)if(c[b]&&!c[b].browseFocus&&(c[b].hasMouse&&!mvpMode&&placeEditIcon(c[b]),c[b].classList.add("focus"),c[b].browseFocus=!0,!e&&c[b].ip)){var d=c[b].ip.biff;if(d){var e=d.y;var f=d.parentNodeId;biffdata.keyField||(f=d.nodeId)}}biffdata.ifListingPage()&&showListingPageCheckbox(f)}this.lastFocus=c;a&&c&&c[0]&&nui.setScrolling(c[0])}};
BrowseController.prototype._nofocus=function(){var a;for(a=0;this.lastFocus&&a<this.lastFocus.length;a++)this.lastFocus[a]&&(this.lastFocus[a].classList.remove("focus"),this.lastFocus[a].browseFocus=!1);ctrl.editIcon&&(document.body.removeChild(ctrl.editIcon),ctrl.editIcon=null)};BrowseController.prototype._getCell=function(){var a=this.bcells[this.focusbcell];return a?a[0]:null};var browse=new BrowseController;function getTooltipMessage(a){return getPromise("/sims/help.jsp",{n:a})}
function showSingleTooltip(a,b,c,d,e,f,g,k){getTooltipMessage(b).then(function(b){ctrl.showTooltip=!0;k&&k.forEach(function(a,c){for(;b.includes("{"+c+"}");)b=b.replace("{"+c+"}",a)});var d=$("tooltips");rm(d);d.style.display="";d=3;c?d=2:e?d=1:g&&(d=4);tooltipV2(a,b,d,50)})}function clearTooltip(){if(ctrl.showTooltip){ctrl.showTooltip=!1;hideTooltip();var a=$("tooltips");a&&(a.style.display="none",RagicStorage.localStorage.setItem("tooltip","false"))}}
BrowseController.prototype.selectRow=function(a){var b=this.bcells[a];if(b&&mode==BROWSE)for(a=0;a<b.length;a++)b[a]&&b[a].classList.add("focusSelect")};BrowseController.prototype.deselectRow=function(a){var b=this.bcells[a];if(b&&mode==BROWSE)for(a=0;a<b.length;a++)b[a]&&b[a].classList.remove("focusSelect")};
var mode=0,floatWinMode,RAGIC_DEBUG=!1,ctrl={_init:function(){var a=window,b=navigator,c=b.userAgent;this.isOpera=a.opera&&opera.buildNumber;this.isOldWebKit=(this.isWebKit=/WebKit/.test(c))&&!a.getSelection().getRangeAt;this.isObsoleteIE=(this.isIE=!this.isWebKit&&!this.isOpera&&(/MSIE/gi.test(c)||/Trident/gi.test(c)))&&(!document.documentMode||10>=document.documentMode);this.isIE11=this.isIE&&11===document.documentMode;this.isEdge=/Edge/.test(c);this.isGecko=!this.isWebKit&&/Gecko/.test(c);this.isMac=
c.includes("Mac");this.isAir=/adobeair/i.test(c);this.isChrome=/Chrome/.test(c)&&/Google Inc/.test(b.vendor);this.isSafari=/Safari/.test(c)&&/Apple Computer/.test(b.vendor);this.tempCount=0;this.widgetTempId=1;this.mainScrollLeft=this.mainScrollTop=0;this.widgetDefaultWidth=350;this.widgetDefaultHeight=300;this.ifOnline=!0;this.currentNUI=$("nui");this.currentNUI_outer=$("nui_outer");$("v5Sidebar")&&(this.nuiNormSize=document.body.clientWidth-$("v5Sidebar").clientWidth);ctrl.currentNUI_outer&&(ctrl.ctrlHeight=
ctrl.currentNUI_outer.offsetTop);this.CRLF="\n";this.isIE&&!this.isObsoleteIE||this.isEdge?(this.focusHeight=this.focusWidth=-3,this.focusLeft=this.focusTop=0,this.dropdownTop=50):this.isIE?(this.focusHeight=this.focusWidth=-2,this.focusLeft=this.focusTop=0,this.dropdownTop=50):this.isChrome?(this.focusHeight=this.focusWidth=-3,this.focusLeft=this.focusTop=0,this.dropdownTop=50):(this.isFF=!0,this.focusHeight=this.focusWidth=-3,this.focusLeft=this.focusTop=0,this.dropdownTop=30);a=parseInt(RagicStorage.localStorage.getItem("ctrl.NUIRowNum"));
b=parseInt(getCookie("fontSizeCookie"));window.userProperties&&(isNaN(a)&&(a=parseInt(window.userProperties.rowsPerPage)),isNaN(b)&&(b=parseInt(window.userProperties.fontSizeRate)));this.NUIRowNum=isNaN(a)?25:a;this.NUIColNumBrowse=this.NUIColNum=16;this.builderRowNum=5;this.dragging=!1;this.draggingDcellY=this.draggingDcellX=0;this.multiSelected=[];this.floatListSize=20;this.templateStartIndex=this.systemFieldMax=1E4;this.ExcelExportLimit=5E3;this.mailMergeToFieldLimit=this.mailMergeLimit=1E4;this.mailMergeWordListingModeLimit=
1E3;this.rightKeyMenuOff||(this.rightKeyMenuOff=!1);this.col1Width=(this.ifStar=window.userValid)?45:25;this.starShift=0;this.checkboxShift=-20;this.fontSizeRate=b?b:0;this.TABLE_DEF_ROWS=3;this.dropWinScrollLock=this.dropWin=!1;this.dropWinColorPickerNotConfirmed=[];this.hinFocus=this.nuiLock=!1;this.ifLocalStorage=!0;this.saveRetryCount=this.counter=0;this.minNodeId=-1;this.urlCache={};this.listingPageCheckboxes={};this.listingPageStars={};this.checkedRootNodeIds=[];this.closedSidenavCats=[];this.enterSubmitBox=
this.enterSubmitButton=null;this.mvpSelectorCanvas=$("f_mvp");this.mvpSelectorCallback=mvpSelChange;this.lastReadUrl="";this.lastReadTime=this.lastReadCount=0;this.toRemoveImg=[];this.formulaResultCache={};this.lastHCell=[];this.lastVCell=[];this.lastSHCell=[];this.lastSVCell=[];this.idleInitRecord=(new Date).getTime();this.lazyRenderingDebug=this.lazyRendering=this.tutNoGoStart=this.noConfirmClose=!1,this.lazyRenderBufferX=100,this.lazyRenderBufferY=50;this.lazyInitStartY=this.lazyInitStartX=0;this.defaultColumnWidthDelta=
35;this.defaultColumnHeightDelta=12;this.defaultColumnWidth=100;this.defaultRowHeight=16;this.sheetHeaderOffset=100;this.lazyAnimationShiftLeft="-300px";this.lazyAnimationShiftRight="750px";this.IMEStatus=0;this.fxcur="AED AFN ALL AMD ANG AOA ARS AUD AWG AZN BAM BBD BDT BGN BHD BIF BMD BND BOB BRL BSD BTC BTN BWP BYR BZD CAD CDF CHF CLF CLP CNY COP CRC CUC CUP CVE CZK DJF DKK DOP DZD EEK EGP ERN ETB EUR FJD FKP GBP GEL GGP GHS GIP GMD GNF GTQ GYD HKD HNL HRK HTG HUF IDR ILS IMP INR IQD IRR ISK JEP JMD JOD JPY KES KGS KHR KMF KPW KRW KWD KYD KZT LAK LBP LKR LRD LSL LTL LVL LYD MAD MDL MGA MKD MMK MNT MOP MRO MTL MUR MVR MWK MXN MYR MZN NAD NGN NIO NOK NPR NZD OMR PAB PEN PGK PHP PKR PLN PYG QAR RON RSD RUB RWF SAR SBD SCR SDG SEK SGD SHP SLL SOS SRD STD SVC SYP SZL THB TJS TMT TND TOP TRY TTD TWD TZS UAH UGX USD UYU UZS VEF VND VUV WST XAF XAG XAU XCD XDR XOF XPD XPF XPT YER ZAR ZMK ZMW ZWL".split(" ");
this.RAGIC_AUTOGEN_MAPPING_HINT="//RAGIC_AUTO_MAPPING";this.notifOffset=this.taskOffset=0;this.unhideArrowTooltip={};this.imageSrcBuffer={};this.uploadTargetCell=null;this.mailMergeXLSWhiteList=["DelivereePH","DelivereeID","DelivereeTH2"];this.filterDate={};this.downloadingFiles=new Map;this.uploadingFiles=new Map;this.uploadSuccess=0;this.lastEditTimeDefaultValue="#DATE #TIME #DATETIME #YEAR #MONTH #WEEKDAY".split(" ");this.lastEditUserDefaultValue=["#USER","#USERID","#USERNAME"];this.applySorting=
!1;this.guessSubtableSeqsPatchSize=100;this.subtableAutoGenSeqs={};this.subtableAutoGenMaxSeq={};this.autoGenGuessingPromise=Promise.resolve()},setWidth:function(a,b,c,d,e){if(a){var f={};if(c){c=c.split("&");var g;for(g=0;g<c.length;g++){var k=c[g].split("=",2);2>k.length||Number.isNaN(parseInt(k[0]))||(f[k[0]]=k[1])}}e=void 0!==e?"_"+e:"";b=parseInt(b)||0;f[a]=b+e;a=Object.entries(f).map(function(a){return a[0]+"="+a[1]}).join("&");d(a)}}};ctrl._init();
ctrl.smartSet={date:function(a,b){builder.setAttribute(a,b,"it","DATE")},birthday:function(a,b){builder.setAttribute(a,b,"it","DATE_REPEAT")},time:function(a,b){builder.setAttribute(a,b,"it","DATE");builder.setAttribute(a,b,"fmt_d","yyyy/MM/dd HH:mm a")},phone:function(a,b){builder.setAttribute(a,b,"it","PHONE")},fax:function(a,b){builder.setAttribute(a,b,"it","PHONE")},mobile:function(a,b){builder.setAttribute(a,b,"it","PHONE")},address:function(a,b){builder.setAttribute(a,b,"it","ADDR")},location:function(a,
b){builder.setAttribute(a,b,"it","ADDR")},signature:function(a,b){builder.setAttribute(a,b,"it","SIG")},email:function(a,b){builder.setAttribute(a,b,"it","EMAIL")},"e-mail":function(a,b){builder.setAttribute(a,b,"it","EMAIL")},user:function(a,b){builder.setAttribute(a,b,"it","USER")},owner:function(a,b){builder.setAttribute(a,b,"it","USER")},category:function(a,b){builder.setAttribute(a,b,"it","L")},territory:function(a,b){builder.setAttribute(a,b,"it","L")},gender:function(a,b){builder.setAttribute(a,
b,"it","L")},stage:function(a,b){builder.setAttribute(a,b,"it","L")},tags:function(a,b){builder.setAttribute(a,b,"it","M")},type:function(a,b){builder.setAttribute(a,b,"it","L")},status:function(a,b){builder.setAttribute(a,b,"it","L")},priority:function(a,b){builder.setAttribute(a,b,"it","L")},url:function(a,b){builder.setAttribute(a,b,"it","URL")},website:function(a,b){builder.setAttribute(a,b,"it","URL")},revenue:function(a,b){builder.setAttribute(a,b,"it","MONEY")},tax:function(a,b){builder.setAttribute(a,
b,"it","MONEY")},vat:function(a,b){builder.setAttribute(a,b,"it","MONEY")},cost:function(a,b){builder.setAttribute(a,b,"it","MONEY")},budget:function(a,b){builder.setAttribute(a,b,"it","MONEY")},deposit:function(a,b){builder.setAttribute(a,b,"it","MONEY")},number:function(a,b){builder.setAttribute(a,b,"it","FORMATTED")},amount:function(a,b){builder.setAttribute(a,b,"it","NUMBER")},total:function(a,b){builder.setAttribute(a,b,"it","NUMBER")},quantity:function(a,b){builder.setAttribute(a,b,"it","NUMBER")},
qty:function(a,b){builder.setAttribute(a,b,"it","NUMBER")},value:function(a,b){builder.setAttribute(a,b,"it","NUMBER")},balance:function(a,b){builder.setAttribute(a,b,"it","NUMBER")},image:function(a,b){builder.setAttribute(a,b,"it","G")},photo:function(a,b){builder.setAttribute(a,b,"it","G")},attachment:function(a,b){builder.setAttribute(a,b,"it","U")},scan:function(a,b){builder.setAttribute(a,b,"it","U")},ssn:function(a,b){$("at_phonefmt").value="XXX-XX-XXXX";builder.setAttribute(a,b,"it","FORMATTED")},
price:function(a,b){builder.setAttribute(a,b,"it","MONEY")},picture:function(a,b){builder.setAttribute(a,b,"it,","G")},subtotal:function(a,b){builder.setAttribute(a,b,"it","MONEY")},upload:function(a,b){builder.setAttribute(a,b,"it","U")},id:function(a,b){builder.setAttribute(a,b,"it","AUTOGEN")},serial:function(a,b){builder.setAttribute(a,b,"it","AUTOGEN")}};
ctrl.smartSetZH={"?":function(a,b){builder.setAttribute(a,b,"it","CHECKBOX")},"\u65e5\u671f":function(a,b){builder.setAttribute(a,b,"it","DATE")},"\u751f\u65e5":function(a,b){builder.setAttribute(a,b,"it","DATE_REPEAT")},"\u6642\u9593":function(a,b){builder.setAttribute(a,b,"it","DATE");builder.setAttribute(a,b,"fmt_d","yyyy/MM/dd HH:mm a")},"\u671f\u9650":function(a,b){builder.setAttribute(a,b,"it","DATE")},"\u5730\u5740":function(a,b){builder.setAttribute(a,b,"it","ADDR")},"\u985e\u5225":function(a,
b){builder.setAttribute(a,b,"it","L")},"\u7a2e\u985e":function(a,b){builder.setAttribute(a,b,"it","L")},"\u6027\u5225":function(a,b){builder.setAttribute(a,b,"it","L")},"\u5206\u985e":function(a,b){builder.setAttribute(a,b,"it","L")},"\u72c0\u614b":function(a,b){builder.setAttribute(a,b,"it","L")},"\u5e33\u865f":function(a,b){builder.setAttribute(a,b,"it","FORMATTED")},"\u5b57\u865f":function(a,b){builder.setAttribute(a,b,"it","FORMATTED")},"\u865f\u78bc":function(a,b){builder.setAttribute(a,b,"it",
"FORMATTED")},"\u96fb\u8a71":function(a,b){builder.setAttribute(a,b,"it","PHONE")},"\u50b3\u771f":function(a,b){builder.setAttribute(a,b,"it","PHONE")},"\u624b\u6a5f":function(a,b){builder.setAttribute(a,b,"it","PHONE")},"\u884c\u52d5":function(a,b){builder.setAttribute(a,b,"it","PHONE")},"\u7db2\u5740":function(a,b){builder.setAttribute(a,b,"it","URL")},"\u6a94\u6848":function(a,b){builder.setAttribute(a,b,"it","U")},"\u5716\u7247":function(a,b){builder.setAttribute(a,b,"it","G")},"\u7c3d\u540d":function(a,
b){builder.setAttribute(a,b,"it","SIG")},"\u6578\u91cf":function(a,b){builder.setAttribute(a,b,"it","NUMBER")},"\u50f9\u683c":function(a,b){builder.setAttribute(a,b,"it","MONEY")},"\u7e3d\u50f9":function(a,b){builder.setAttribute(a,b,"it","MONEY")},"\u5c0f\u8a08":function(a,b){builder.setAttribute(a,b,"it","MONEY")},"\u55ae\u50f9":function(a,b){builder.setAttribute(a,b,"it","MONEY")},"\u91d1\u984d":function(a,b){builder.setAttribute(a,b,"it","MONEY")},"\u7e3d\u984d":function(a,b){builder.setAttribute(a,
b,"it","NUMBER")},"\u8ca0\u8cac\u4eba":function(a,b){builder.setAttribute(a,b,"it","USER")},"\u4eba\u54e1":function(a,b){builder.setAttribute(a,b,"it","USER")},"\u6de8\u984d":function(a,b){builder.setAttribute(a,b,"it","NUMBER")},"\u7de8\u865f":function(a,b){builder.setAttribute(a,b,"it","AUTOGEN")},"\u4fe1\u7bb1":function(a,b){builder.setAttribute(a,b,"it","EMAIL")}};function ActionBuilder(a){this.config=a;this.result={result:[]}}
ActionBuilder.prototype.renderActionBuilder=function(a){a&&(this.parentElement=a);"dynamicFilter"===a.id&&Object.keys(BarSelectAgent.selectors).filter(function(a){return a.startsWith("dynamicFilter")}).forEach(function(a){BarSelectAgent.removeSelector(a)});a=this.result.result;var b=this.config.items,c=node("div"),d=node("table");d.className="actionTable";c.appendChild(d);this.tableContainer=d;this.rowIds=[];if(this.config.showHeader)for(var e=d.insertRow(-1),f={},g=0;g<b.length;f={$jscomp$loop$prop$cellContent$569:f.$jscomp$loop$prop$cellContent$569,
$jscomp$loop$prop$customOption$570:f.$jscomp$loop$prop$customOption$570},g++){var k=b[g],l=node("th");f.$jscomp$loop$prop$cellContent$569=node("div");f.$jscomp$loop$prop$cellContent$569.innerHTML=k.name;f.$jscomp$loop$prop$customOption$570=k.customOption||{};f.$jscomp$loop$prop$customOption$570.headerStyles&&Object.keys(f.$jscomp$loop$prop$customOption$570.headerStyles).forEach(function(a){return function(b){a.$jscomp$loop$prop$cellContent$569.style[b]=a.$jscomp$loop$prop$customOption$570.headerStyles[b]}}(f));
l.appendChild(f.$jscomp$loop$prop$cellContent$569);e.appendChild(l)}for(b=0;b<a.length;b++)this.insertDisplayRow(b,a[b]);if(void 0===this.config.showAdder||!0===this.config.showAdder)e=d.insertRow(-1),d=e.insertCell(-1),d.innerHTML='<i class="fa fa-plus-square" style="font-size:16px;color:#336699;cursor:pointer;"></i>',d.resultArray=a,d.ab=this,d.onclick=abInsertRow;rm(this.parentElement);this.parentElement.appendChild(c);return c};
ActionBuilder.prototype.insertDisplayRow=function(a,b){for(var c=this.config.items,d=this.result.result,e=this.tableContainer,f=this.config.showHeader?a+1:a,g=genRandom(5);-1!=this.rowIds.indexOf(g);)g=genRandom(5);this.rowIds.splice(a,0,g);e=e.insertRow(f);f={};for(var k=0;k<c.length;f={$jscomp$loop$prop$elementObj$574:f.$jscomp$loop$prop$elementObj$574,$jscomp$loop$prop$sel$575:f.$jscomp$loop$prop$sel$575,$jscomp$loop$prop$customOption$593:f.$jscomp$loop$prop$customOption$593,$jscomp$loop$prop$selectedValues$577:f.$jscomp$loop$prop$selectedValues$577,
$jscomp$loop$prop$itemId$578:f.$jscomp$loop$prop$itemId$578,$jscomp$loop$prop$elementObj$117$586:f.$jscomp$loop$prop$elementObj$117$586,$jscomp$loop$prop$freeText$587:f.$jscomp$loop$prop$freeText$587,$jscomp$loop$prop$elementObj$122$591:f.$jscomp$loop$prop$elementObj$122$591,$jscomp$loop$prop$freeText$121$592:f.$jscomp$loop$prop$freeText$121$592,$jscomp$loop$prop$elementObj$129$596:f.$jscomp$loop$prop$elementObj$129$596},k++){var l=c[k];f.$jscomp$loop$prop$itemId$578=l.id;var m=l.type,n=b[f.$jscomp$loop$prop$itemId$578];
f.$jscomp$loop$prop$customOption$593=l.customOption||{};var q=e.insertCell(-1);"function"===typeof l.beforeRenderFieldCallback&&l.beforeRenderFieldCallback(l);if(l.beforeFieldTitle){var r=node("span");r.innerHTML=l.beforeFieldTitle;q.appendChild(r)}r={element:null,optionType:m};"dynamic"==m&&(m=l.getTypeFunc(c,d,a));if("select"==m||"selectFree"==m){f.$jscomp$loop$prop$sel$575=this.createSelectElement(l);f.$jscomp$loop$prop$sel$575.resultItem=b;f.$jscomp$loop$prop$sel$575.resultItemId=f.$jscomp$loop$prop$itemId$578;
f.$jscomp$loop$prop$sel$575.resultArray=d;f.$jscomp$loop$prop$sel$575.ab=this;f.$jscomp$loop$prop$sel$575.onchange=abSelectionChange;f.$jscomp$loop$prop$sel$575.rowId=g;r.element=f.$jscomp$loop$prop$sel$575;if(void 0!=l.addEvents){f.$jscomp$loop$prop$elementObj$574=f.$jscomp$loop$prop$sel$575;for(var p={},t=0;t<l.addEvents.length;p={$jscomp$loop$prop$eventCallback$572:p.$jscomp$loop$prop$eventCallback$572},t++){var v=l.addEvents[t].eventName;p.$jscomp$loop$prop$eventCallback$572=l.addEvents[t].callback;
addEvent(f.$jscomp$loop$prop$elementObj$574,v,function(a,b){return function(c){a.$jscomp$loop$prop$eventCallback$572(c,b.$jscomp$loop$prop$elementObj$574)}}(p,f))}}for(p=0;p<f.$jscomp$loop$prop$sel$575.options.length;p++)t=f.$jscomp$loop$prop$sel$575.options[p],t.value==n&&(t.selected=!0);p=!1;if(""!==n)if(n)for(t=0;t<f.$jscomp$loop$prop$sel$575.options.length;t++){if(f.$jscomp$loop$prop$sel$575.options[t].value===n){p=!0;break}}else p=!0;f.$jscomp$loop$prop$customOption$593.selectStyles&&Object.keys(f.$jscomp$loop$prop$customOption$593.selectStyles).forEach(function(a){return function(b){a.$jscomp$loop$prop$sel$575.style[b]=
a.$jscomp$loop$prop$customOption$593.selectStyles[b]}}(f));f.$jscomp$loop$prop$selectedValues$577=[];d.forEach(function(a){return function(b){a.$jscomp$loop$prop$selectedValues$577.push(b[a.$jscomp$loop$prop$itemId$578])}}(f));t={};for(v=0;v<f.$jscomp$loop$prop$sel$575.options.length;t={$jscomp$loop$prop$optionObj$116$582:t.$jscomp$loop$prop$optionObj$116$582},v++)t.$jscomp$loop$prop$optionObj$116$582=f.$jscomp$loop$prop$sel$575.options[v],f.$jscomp$loop$prop$customOption$593.optionStyles&&Object.keys(f.$jscomp$loop$prop$customOption$593.optionStyles).forEach(function(a,
b){return function(c){a.$jscomp$loop$prop$optionObj$116$582.style[c]=b.$jscomp$loop$prop$customOption$593.optionStyles[c]}}(t,f)),f.$jscomp$loop$prop$customOption$593.markSelectedOptions&&-1!=f.$jscomp$loop$prop$selectedValues$577.indexOf(t.$jscomp$loop$prop$optionObj$116$582.value)&&(t.$jscomp$loop$prop$optionObj$116$582.style.color="white",t.$jscomp$loop$prop$optionObj$116$582.style.backgroundColor="rgb(200, 200, 200)",f.$jscomp$loop$prop$customOption$593.selectedOptionStyles&&Object.keys(f.$jscomp$loop$prop$customOption$593.selectedOptionStyles).forEach(function(a,
b){return function(c){a.$jscomp$loop$prop$optionObj$116$582.style[c]=b.$jscomp$loop$prop$customOption$593.selectedOptionStyles[c]}}(t,f)));if("selectFree"!=m||p)q.appendChild(f.$jscomp$loop$prop$sel$575),"selectFree"==m&&(p=node("i"),p.className="fas fa-pencil-alt switchIcon",p.resultItem=b,p.resultItemId=f.$jscomp$loop$prop$itemId$578,p.ab=this,p.onclick=abSwitchToFreetext,p.rowId=g,q.appendChild(p));else{f.$jscomp$loop$prop$freeText$587=node("input");f.$jscomp$loop$prop$freeText$587.type="text";
f.$jscomp$loop$prop$freeText$587.value=n||"";f.$jscomp$loop$prop$freeText$587.resultItem=b;f.$jscomp$loop$prop$freeText$587.resultItemId=f.$jscomp$loop$prop$itemId$578;f.$jscomp$loop$prop$freeText$587.ab=this;f.$jscomp$loop$prop$freeText$587.onkeyup=abFreetextChange;f.$jscomp$loop$prop$freeText$587.onfocus=outNUI;f.$jscomp$loop$prop$freeText$587.onblur=inNUI;f.$jscomp$loop$prop$freeText$587.rowId=g;r.element=f.$jscomp$loop$prop$freeText$587;if(void 0!=l.addEvents)for(f.$jscomp$loop$prop$elementObj$117$586=
f.$jscomp$loop$prop$freeText$587,p={},t=0;t<l.addEvents.length;p={$jscomp$loop$prop$eventCallback$120$585:p.$jscomp$loop$prop$eventCallback$120$585},t++)v=l.addEvents[t].eventName,p.$jscomp$loop$prop$eventCallback$120$585=l.addEvents[t].callback,addEvent(f.$jscomp$loop$prop$elementObj$117$586,v,function(a,b){return function(c){a.$jscomp$loop$prop$eventCallback$120$585(c,b.$jscomp$loop$prop$elementObj$117$586)}}(p,f));f.$jscomp$loop$prop$customOption$593.freetextStyles&&Object.keys(f.$jscomp$loop$prop$customOption$593.freetextStyles).forEach(function(a){return function(b){a.$jscomp$loop$prop$freeText$587.style[b]=
a.$jscomp$loop$prop$customOption$593.freetextStyles[b]}}(f));q.appendChild(f.$jscomp$loop$prop$freeText$587);p=node("i");p.className="fas fa-pencil-alt switchIcon";p.resultItem=b;p.resultItemId=f.$jscomp$loop$prop$itemId$578;p.ab=this;p.onclick=abSwitchToSelection;p.rowId=g;q.appendChild(p)}if(!n&&l.defaultSelected)for(t=0;t<f.$jscomp$loop$prop$sel$575.options.length;t++)if(f.$jscomp$loop$prop$sel$575.options[t].value===l.defaultSelected){f.$jscomp$loop$prop$sel$575.options[t].selected=!0;b[f.$jscomp$loop$prop$itemId$578]=
l.defaultSelected;break}}else if("free"==m){f.$jscomp$loop$prop$freeText$121$592=node("input");f.$jscomp$loop$prop$freeText$121$592.type="text";f.$jscomp$loop$prop$freeText$121$592.value=n||"";f.$jscomp$loop$prop$freeText$121$592.resultItem=b;f.$jscomp$loop$prop$freeText$121$592.resultItemId=f.$jscomp$loop$prop$itemId$578;f.$jscomp$loop$prop$freeText$121$592.ab=this;f.$jscomp$loop$prop$freeText$121$592.oninput=abFreetextChange;f.$jscomp$loop$prop$freeText$121$592.onfocus=outNUI;f.$jscomp$loop$prop$freeText$121$592.onblur=
inNUI;f.$jscomp$loop$prop$freeText$121$592.rowId=g;r.element=f.$jscomp$loop$prop$freeText$121$592;if(void 0!=l.addEvents)for(f.$jscomp$loop$prop$elementObj$122$591=f.$jscomp$loop$prop$freeText$121$592,n={},p=0;p<l.addEvents.length;n={$jscomp$loop$prop$eventCallback$125$590:n.$jscomp$loop$prop$eventCallback$125$590},p++)t=l.addEvents[p].eventName,n.$jscomp$loop$prop$eventCallback$125$590=l.addEvents[p].callback,addEvent(f.$jscomp$loop$prop$elementObj$122$591,t,function(a,b){return function(c){a.$jscomp$loop$prop$eventCallback$125$590(c,
b.$jscomp$loop$prop$elementObj$122$591)}}(n,f));f.$jscomp$loop$prop$customOption$593.freetextStyles&&Object.keys(f.$jscomp$loop$prop$customOption$593.freetextStyles).forEach(function(a){return function(b){a.$jscomp$loop$prop$freeText$121$592.style[b]=a.$jscomp$loop$prop$customOption$593.freetextStyles[b]}}(f));q.appendChild(f.$jscomp$loop$prop$freeText$121$592)}else if("multiSelect"==m){p=this.createSelectElement(l);p.selectedIndex=-1;p.setAttribute("multiple",!0);q.appendChild(p);n||(n=[]);if(!Array.isArray(n))throw Error("Result value of a multi select action builder must be an array: "+
n);for(t=0;t<p.options.length;t++)v=p.options[t],-1!=n.indexOf(v.value)&&(v.selected=!0);n=enableMultiSelectCombo(p,!1,f.$jscomp$loop$prop$customOption$593);n.resultItem=b;n.resultItemId=f.$jscomp$loop$prop$itemId$578;n.resultArray=d;n.ab=this;n.afterChangeItem=abMultiSelectChange;n.rowId=g;r.element=n.element}else if("multiFree"==m){n||(n=[]);if(!Array.isArray(n))throw Error("Result value of a multi free action builder must be an array: "+n);p=new MultiFreeInput;p.setValues(n);p.render(q);p.resultItem=
b;p.resultItemId=f.$jscomp$loop$prop$itemId$578;p.resultArray=d;p.ab=this;p.afterChangeValues=abMultiFreeChange;p.rowId=g;r.element=p}else if("datalist"==m&&(p=new DataList,p.setPlaceHolder(l.placeholder),p.setValue(n),p.render(this.createSelectElement(l),q),p.resultItem=b,p.resultItemId=f.$jscomp$loop$prop$itemId$578,p.resultArray=d,p.ab=this,p.afterChangeValue=abDataListChange,r.element=p.input,void 0!=l.addEvents))for(f.$jscomp$loop$prop$elementObj$129$596=p.input,n={},p=0;p<l.addEvents.length;n=
{$jscomp$loop$prop$eventCallback$132$595:n.$jscomp$loop$prop$eventCallback$132$595},p++)t=l.addEvents[p].eventName,n.$jscomp$loop$prop$eventCallback$132$595=l.addEvents[p].callback,addEvent(f.$jscomp$loop$prop$elementObj$129$596,t,function(a,b){return function(c){a.$jscomp$loop$prop$eventCallback$132$595(c,b.$jscomp$loop$prop$elementObj$129$596)}}(n,f));"select"!==m&&"selectFree"!==m||!0!==l.enableSearchSelect||this.enableSearchableSelect(q,l);l.afterFieldTitle&&(m=node("span"),m.innerHTML=l.afterFieldTitle,
q.appendChild(m));"function"===typeof l.renderFieldCallback&&"multiFree"!==r.optionType&&"multiSelect"!==r.optionType&&l.renderFieldCallback(r)}if(void 0===this.config.showAdder||!0===this.config.showAdder)a=e.insertCell(-1),a.onclick=abDeleteRow,a.rowId=g,a.resultArray=d,a.ab=this,a.innerHTML='<i class="fa fa-times" style="color:#555;cursor:pointer;"></i>'};
ActionBuilder.prototype.enableSearchableSelect=function(a,b){var c=a.querySelector("select");if(c){var d={display:"inline-block"},e=b.customOption||{};e.selectStyles&&e.selectStyles.width&&(d.width=e.selectStyles.width);var f=BarSelectAgent.modifiedSelector("actionBuilder_searchableSelect_"+b.id+"_"+c.rowId,c,a,{barSelectStyles:d});c.style.display="none";f.setAfterSelectOption(function(a){c.value=a.value;triggerEvent(c,"change")});f.setOnToggleDropdown(function(a){if(a){a=Object.keys(BarSelectAgent.selectors).filter(function(a){return a.includes(f.id.substring(0,
f.id.lastIndexOf("_")))});var b=[];a.forEach(function(a){a=BarSelectAgent.getSelector(a);document.body.contains(a.element)&&b.push(a.options.findIndex(function(a){return a.selected}))});a.forEach(function(a){var c=BarSelectAgent.getSelector(a);c.options.forEach(function(a,d){b.includes(d)?c.options[d].customProperties.barSelectOptionClasses=["hasChosenOption"]:c.options[d].customProperties.barSelectOptionClasses=[]})})}});if(b=a.querySelector("i.switchIcon"))a.style.display="flex",a.style.alignItems=
"center",b.parentNode.appendChild(b)}};
ActionBuilder.prototype.createSelectElement=function(a){for(var b=node("select"),c=null;null==c||null!=$(c);)c="abSelect"+genRandom(5);b.id=c;var d=a.options,e=a.optionValues;c=a.enableOptGroup;if(a.optionPath&&a.optionSheetIndex)d=[],e=[],ajaxgetAllowCache("/sims/listFields.jsp",{a:ap,p:a.optionPath,si:a.optionSheetIndex,prefix:a.prefix||"",nosubtable:a.optionSheetNoSubtable||"",freeTextOnly:a.freeTextOnly||"",numberOnly:a.numberOnly||"",ignoreReadOnly:a.ignoreReadOnly||"",subtableOnly:a.subtableOnly||
"",sameSubtableWith:a.sameSubtableWith||"",noMultiSelect:a.noMultiSelect||"",noInterm:a.noInterm||"",noMultiLink:a.noMultiLink||""},function(a){b.innerHTML=a;for(a=0;a<b.options.length;a++)d.push(b.options[a].text),e.push(b.options[a].value)},!0);else if(a.noEmptyOption&&JSON.parse(a.noEmptyOption)||(c?d.splice(0,0,{groupLabel:!1,options:[{name:"",value:-1}]}):-1==e.indexOf("-1")&&(d.splice(0,0,""),e.splice(0,0,"-1"))),c)build_select(b,d);else for(c=0;c<d.length;c++)optionObj=node("option"),optionObj.appendChild(document.createTextNode(d[c])),
optionObj.value=e[c],b.appendChild(optionObj);if(a=a.optionTitles)if(c=d.length==a.length?0:d.length==a.length+1?1:-1,0<=c)for(var f=0;f<a.length;f++)b.options[f+c].title=a[f];return b};ActionBuilder.prototype.deleteDisplayRow=function(a){this.tableContainer.deleteRow(this.config.showHeader?a+1:a)};ActionBuilder.prototype.loadResult=function(a){this.config.loadResult?this.config.loadResult(a,this):this.result=a};
function abSelectionChange(){this.ab.config.preprocess&&this.ab.config.preprocess(this);this.resultItem[this.resultItemId]=this.options[this.selectedIndex].value;this.ab.config.callback&&this.ab.config.callback(this.ab.result)}function abFreetextChange(){this.ab.config.preprocess&&this.ab.config.preprocess(this);this.resultItem[this.resultItemId]=this.value;this.ab.config.callback&&this.ab.config.callback(this.ab.result)}
function abMultiSelectChange(){this.ab.config.preprocess&&this.ab.config.preprocess(this);this.resultItem[this.resultItemId]=this.getValues();this.ab.config.callback&&this.ab.config.callback(this.ab.result)}function abMultiFreeChange(){this.ab.config.preprocess&&this.ab.config.preprocess(this);this.resultItem[this.resultItemId]=this.getValues();this.ab.config.callback&&this.ab.config.callback(this.ab.result)}
function abDataListChange(){this.ab.config.preprocess&&this.ab.config.preprocess(this);this.resultItem[this.resultItemId]=this.getValue();this.ab.config.callback&&this.ab.config.callback(this.ab.result)}
function abDeleteRow(){for(var a=this.rowId,b=-1,c=0;c<this.ab.rowIds.length;c++)this.ab.rowIds[c]==a&&(b=c);-1!=b&&(this.ab.config.preprocess&&this.ab.config.preprocess(this),this.resultArray.splice(b,1),this.ab.rowIds.splice(b,1),this.ab.deleteDisplayRow(b),this.ab.config.callback&&this.ab.config.callback(this.ab.result))}
function abInsertRow(){this.ab.config.preprocess&&this.ab.config.preprocess(this);var a={};this.resultArray.push(a);this.ab.insertDisplayRow(this.resultArray.length-1,a);this.ab.config.callback&&this.ab.config.callback(this.ab.result)}
function abSwitchToFreetext(){for(var a=this.rowId,b=-1,c=0;c<this.ab.rowIds.length;c++)this.ab.rowIds[c]==a&&(b=c);-1!=b&&(this.ab.config.preprocess&&this.ab.config.preprocess(this),this.resultItem[this.resultItemId]="",this.ab.insertDisplayRow(b,this.resultItem),this.ab.deleteDisplayRow(b+1),this.ab.rowIds.splice(b+1,1),this.ab.config.callback&&this.ab.config.callback(this.ab.result))}
function abSwitchToSelection(){for(var a=this.rowId,b=-1,c=0;c<this.ab.rowIds.length;c++)this.ab.rowIds[c]==a&&(b=c);-1!=b&&(this.ab.config.preprocess&&this.ab.config.preprocess(this),this.resultItem[this.resultItemId]="-1",this.ab.insertDisplayRow(b,this.resultItem),this.ab.deleteDisplayRow(b+1),this.ab.rowIds.splice(b+1,1),this.ab.config.callback&&this.ab.config.callback(this.ab.result))}window.lm||(window.lm={});
ctrl.copyRecordSubtableFilterActionBuilder=new ActionBuilder({items:[{id:"convertRec_subtableFilterDomainId",name:lm.convertRec_subtableFilterDomainId,type:"select",options:[],optionValues:[],noEmptyOption:!0,subtableOnly:!0,noMultiSelect:!0},{id:"convertRec_subtableFilterValues",name:lm.convertRec_subtableFilterValues,type:"dynamic",getTypeFunc:function(a,b,c){b=getActionBuilderOptionItem(b[c].convertRec_subtableFilterDomainId);return null!=b.options&&null!=b.optionValues?(a[1].options=b.options,
a[1].optionValues=b.optionValues,"multiSelect"):"multiFree"},options:[],optionValues:[],noEmptyOption:!0}],showHeader:!0,preprocess:function(a){if("convertRec_subtableFilterDomainId"==a.resultItemId&&a.rowId&&a.ab&&a.ab.rowIds){var b=a.ab.rowIds.indexOf(a.rowId);if(-1!=b){var c=a.options[a.selectedIndex].value,d=a.ab.config.items[1],e=getActionBuilderOptionItem(c);e.options&&e.optionValues?(d.type="multiSelect",d.options=e.options,d.optionValues=e.optionValues):d.type="multiFree";c={convertRec_subtableFilterDomainId:c,
convertRec_subtableFilterValues:[]};a.ab.result.result[b]=c;a.ab.insertDisplayRow(b,c);a.ab.deleteDisplayRow(b+1);a.ab.rowIds.splice(b+1,1);d.type="dynamic"}}}});ctrl.copyRecordSubtableGroupingActionBuilder=new ActionBuilder({items:[{id:"convertRec_subtableGroupingFields",name:lm.convertRec_subtableGroupingFields,type:"select",subtableOnly:!0,noMultiSelect:!0}],showHeader:!0});
function getActionBuilderOptionItem(a){var b={},c=!1,d=!1;if(mode===BUILDER){var e=builder.findField(a);!e||"L"!==e.IPType&&"M"!==e.IPType||(c=!0,d=e.hasAttribute("usrref"))}else mode===BROWSE&&ajaxgetAllowCache(urlHashResolve(!0),{api:"",def:""},function(b){if(b=JSON.parse(b).fields)!(b=b["fid"+a])||"L"!==b.type&&"M"!==b.type||(c=!0,d=null!=b.attr_usrref)},!0);c&&(b.options=[],b.optionValues=[],ajaxgetAllowCache("/sims/options.jsp",{a:ap,p:path,si:sheetIndex,d:a},function(a){a.split("\n").forEach(function(a){a=
a.substring(a.indexOf("|")+1);0!=a.length&&(b.options.push(a),b.optionValues.push(a))})},!0),d&&ajaxgetAllowCache("/sims/getUserNameMap.jsp",{ap:ap},function(a){var c=JSON.parse(a);b.options=[];b.optionValues.forEach(function(a){var d=c[a];d||(d=a);b.options.push(d)})},!0));return b}
ctrl.copyRecordActionBuilder=new ActionBuilder({items:[{id:"cf",name:lm.convertRec_convertFromField,type:"select",options:[],optionValues:[],customOption:{headerStyles:{width:"180px"},selectStyles:{width:"180px"},markSelectedOptions:!0}},{id:"ct",name:lm.convertRec_convertToField,noInterm:!0,type:"select",options:[],optionValues:[],customOption:{headerStyles:{width:"180px"},selectStyles:{width:"180px"},markSelectedOptions:!0}}],showHeader:!0});
ctrl.updateRecordActionsActionBuilder=new ActionBuilder({items:[{id:"thisField",name:lm.updRecThisNumField,type:"select",options:[],optionValues:[],customOption:{headerStyles:{width:"200px"},selectStyles:{width:"200px"},markSelectedOptions:!0}},{id:"actions",name:lm.updRecAct,type:"select",options:[],optionValues:[],customOption:{headerStyles:{width:"60px"},selectStyles:{width:"60px"}}},{id:"updField",name:lm.updRecUpdNumField,type:"select",options:[],optionValues:[],customOption:{headerStyles:{width:"200px"},
selectStyles:{width:"200px"},markSelectedOptions:!0}}],showHeader:!0,callback:function(a){a=a.result;for(var b=!1,c=0;c<a.length;c++){var d=a[c];if(d.thisField&&-1!=JSON.parse(d.thisField)&&d.updField&&-1!=JSON.parse(d.updField)&&d.actions&&-1!=d.actions&&"SET"===d.actions){b=!0;break}}$("updateRecordCreateReverseButtonDiv").style.display=b?"none":"block"}});
ctrl.updateRecordMatchActionBuilder=new ActionBuilder({items:[{id:"thisField",name:lm.matchThisField,type:"select",options:[],optionValues:[],customOption:{headerStyles:{width:"200px",margin:"0 70px 0 0"},selectStyles:{width:"200px"},markSelectedOptions:!0}},{id:"updField",name:lm.matchUpdField,type:"select",options:[],optionValues:[],customOption:{headerStyles:{width:"200px"},selectStyles:{width:"200px"},markSelectedOptions:!0}}],showHeader:!0});
ctrl.linkNLoadActionBuilder=new ActionBuilder({items:[{id:"ff",name:lm.dynamicFilterField1,type:"select",enableSearchSelect:!0,options:[],optionValues:[]},{id:"fo",name:lm.dynamicFilterField2,type:"select",options:["=",">","<",">=","<=","!=",lm.contains2,lm.doesNotContain2],optionValues:"1 4 5 2 3 11,^(?!{0}$) 8 11,^((?!{0}).)*$,^.*$".split(" "),defaultSelected:"1"},{id:"fv",name:lm.dynamicFilterField3,options:[lm.dv_create_date,lm.dv_create_year,lm.dv_create_month,lm.dv_create_user_id,lm.dv_create_user_name],
optionValues:["$DATE","$YEAR","$MONTH","$USERID","$USERNAME"],type:"selectFree",enableSearchSelect:!0,prefix:"$"}],showHeader:!0,currentDomainId:-1,callback:function(a){a=a.result;for(var b="",c=0;c<a.length;c++){var d=a[c];d&&d.ff&&d.fo&&d.fv&&"$null"!=d.fv&&(b&&0<b.length&&(b+="&"),b+=d.ff+"|"+d.fo+"|"+d.fv)}(b||""===b)&&builder.setAttributeByDomainId(this.currentDomainId,"mvpf",b)},loadResult:function(a,b){if(a){var c=[];a=a.split("&");for(var d=0;d<a.length;d++)!/^\d{7,}\|\d+|\d+,\|.*$/g.test(a[d])&&
0<d&&(a[d-1]+="&"+a[d],a.splice(d,1));for(d=0;d<a.length;d++){var e=a[d].split("|");c.push({ff:e[0],fo:e[1],fv:e[2]})}b.result={result:c}}else b.result={result:[{}]}}});
ctrl.massUpdateActionBuilder=new ActionBuilder({items:[{id:"field",name:lm.updateTheseFields,type:"select",enableSearchSelect:!0,options:[],optionValues:[],optionSheetNoSubtable:!0,ignoreReadOnly:!0,noMultiLink:!0,customOption:{headerStyles:{width:"150px"},selectStyles:{width:"150px",height:"22px"}}},{id:"value",name:lm.withTheseValues,type:"dynamic",getTypeFunc:function(a,b,c){a=b[c].field;if(!a)return"free";a=biffdata.findBiff(a);if(!a||0==a.length)return"free";a=a[0];if(a.hasAttribute("mvp"))return"free";
if("L"===a.IPType)return"datalist";if("M"===a.IPType)return"multiSelect"},customOption:{headerStyles:{width:"150px"},freetextStyles:{width:"150px"},selectStyles:{width:"150px",height:"22px"},customComboBoxStyles:{width:"150px"}}}],showHeader:!0,preprocess:function(a){if("field"==a.resultItemId&&a.rowId&&a.ab&&a.ab.rowIds){var b=a.ab.rowIds.indexOf(a.rowId);if(-1!=b){var c=a.ab.config.items[1],d=a.options[a.selectedIndex].value;ajaxgetAllowCache(urlHashResolve(!0),{api:"",def:""},function(e){if(e=
JSON.parse(e).fields)if(e=e["fid"+d]){if(e.attr_mvp)c.type="free";else if("L"===e.type||"M"===e.type){var f=getActionBuilderOptionItem(d);f.options&&f.optionValues&&(c.type="L"===e.type?"datalist":"multiSelect",c.options=f.options,c.optionValues=f.optionValues,c.noEmptyOption="M"===e.type)}else c.type="free";e={field:d,value:"M"===e.type?[]:""};a.ab.result.result[b]=e;a.ab.insertDisplayRow(b,e);a.ab.deleteDisplayRow(b+1);a.ab.rowIds.splice(b+1,1);c.type="dynamic"}},!0)}}}});
ctrl.massUpdateReplaceModeActionBuilder=new ActionBuilder({items:[{id:"field",name:lm.massReplace_fieldsToBeUpdated,type:"select",enableSearchSelect:!0,options:[],optionValues:[],optionSheetNoSubtable:!0,freeTextOnly:!0,ignoreReadOnly:!0},{id:"value_replaced",name:lm.massReplace_valuesToBeReplaced,type:"free"},{id:"value_new",name:lm.massReplace_ReplaceValues,type:"free"}],showHeader:!0});
ctrl.updateFieldsActionBuilder=new ActionBuilder({items:[{id:"field",name:lm.updateTheseFields,type:"select",options:[],optionValues:[],customOption:{headerStyles:{width:"180px"},selectStyles:{width:"180px"},markSelectedOptions:!0}},{id:"value",name:lm.withTheseValues,type:"free",customOption:{headerStyles:{width:"180px"},freetextStyles:{width:"180px"}}}],showHeader:!0});
ctrl.calendarSelectActionBuilder=new ActionBuilder({items:[{id:"selStart",name:lm.calEventSelectStart,type:"select",options:[],optionValues:[]},{id:"selStartTime",name:lm.calEventSelectStartTime,type:"select",options:[],optionValues:[]},{id:"selEnd",name:lm.calEventSelectEnd,type:"select",options:[],optionValues:[]},{id:"selEndTime",name:lm.calEventSelectEndTime,type:"select",options:[],optionValues:[]},{id:"selTitle",name:lm.calTitleSelect,type:"select",options:[],optionValues:[]},{id:"selDesc",
name:lm.calDescSelect,type:"select",options:[],optionValues:[]},{id:"selLocation",name:lm.calLocationSelect,type:"select",options:[],optionValues:[]}],showHeader:!0});ctrl.attachMailMergesActionBuilder=new ActionBuilder({items:[{id:"attachMailMerges",name:lm.selectAttachMailMerge,type:"select",options:[],optionValues:[]}],showHeader:!0});ctrl.widgetFilterActionBuilderObj={};ctrl.widgetFilterActionBuilder=null;
ctrl.createWidgetFilterActionBuilder=function(a){return new ActionBuilder({items:[{id:"ff",name:lm.widgetSourceValue,type:"select",options:[],optionValues:[]},{id:"fo",name:lm.dynamicFilterField2,type:"select",options:["=",">","<",">=","<=","!=",lm.contains2,lm.doesNotContain2],optionValues:"1 4 5 2 3 11,^(?!{0}$) 8 11,^((?!{0}).)*$,^.*$".split(" "),defaultSelected:"1"},{id:"fv",name:lm.dynamicFilterField3,options:[lm.dv_create_date,lm.dv_create_year,lm.dv_create_month,lm.dv_create_user_id,lm.dv_create_user_name],
optionValues:["$DATE","$YEAR","$MONTH","$USERID","$USERNAME"],type:"selectFree",prefix:"$"}],id:a,showHeader:!0,currentDomainId:-1,callback:function(a){var b=a.result;a="";for(var d=0;d<b.length;d++){var e=b[d];e&&e.ff&&e.fo&&e.fv&&"$null"!=e.fv&&(a&&0<a.length&&(a+="&"),a+=e.ff+"|"+e.fo+"|"+e.fv)}if(a||""===a)for(b=0;b<builder.widgets.length;b++)builder.widgets[b].id===this.id&&(builder.widgets[b].dataSource.filters=a)},loadResult:function(a,c){if(a){var b=[];a=a.split("&");for(var e=0;e<a.length;e++)!/^\d{7,}\|\d+|\d+,\|.*$/g.test(a[e])&&
0<e&&(a[e-1]+="&"+a[e],a.splice(e,1));for(e=0;e<a.length;e++){var f=a[e].split("|");b.push({ff:f[0],fo:f[1],fv:f[2]})}c.result={result:b}}else c.result={result:[]}}})};function DMenu(a,b){this.json=a;this.dmobj=b;this.disposable=this.attached=!1}
DMenu.prototype.attach=function(a,b,c){b||(b=3);var d=this,e;c&&c.scrollableParentId&&(e=document.getElementById(c.scrollableParentId));c=function(c){var f=this,k=c.currentTarget.getAttribute("id");k&&k.startsWith("menuSheetMoveLeftRight")&&(k=1<k.split("/").length?$("menuTabEditor/"+k.split("/")[1]).value:$("menuTabEditorReport").value,k!==f.lastSelectedOptionValue&&(f.lastSelectedOptionValue=k,d.attached=!1));if(d.attached)f.disposable||(d.attached=!1);else{clearDropWin();cancelEventBubble(c);var l=
node("div");l.id="eventConfigMenu";l.className="eventConfigMenu";f.json.forEach(function(a){var b=node("div");b.innerHTML=a.name;b.onclick=b.ontouchend=a.func;f.dmobj&&(b.dmobj=f.dmobj);l.appendChild(b)});document.body.appendChild(l);c=findPos(a);k=e?e.scrollTop:0;var m=e?e.scrollLeft:0;switch(b){case 1:l.style.top=c[1]-l.offsetHeight-k+"px";l.style.left=c[0]-l.offsetWidth-m+"px";break;case 2:l.style.top=c[1]-l.offsetHeight-k+"px";l.style.left=c[0]+a.offsetWidth-m+"px";break;case 3:l.style.top=c[1]+
a.offsetHeight-k+"px";l.style.left=c[0]+a.offsetWidth-m+"px";break;case 4:l.style.top=c[1]+a.offsetHeight-k+"px";l.style.left=c[0]-l.offsetWidth-m+"px";break;case 5:l.style.top=c[1]+a.offsetHeight+1+"px",l.style.left=c[0]+"px"}floatingPanels.push(l);(new MutationObserver(function(a,b){a.some(function(a){return"none"===a.target.style.display})&&(b.disconnect(),document.body.removeChild(l))})).observe(l,{attributes:!0,attributeFilter:["style"]});d.attached=!0}}.bind(this);a.addEventListener("click",
c,!1)};function TabsBuilder(a,b){this.configs=a;this.ID_PREFIX_TAB="tabsBuilder_tab";this.ID_PREFIX_TAB_LINK="tabsBuilder_tab_link";this.ID_PREFIX_TAB_CONTENT="tabsBuilder_tab_content";this.currentTabIndex=-1;this.tabcontent_class="";this.tabcontent_class="undefined"!==typeof b?b:"userpref_tabcontent"}
TabsBuilder.prototype.renderTabs=function(a){if(a&&0!==this.configs.length){this.currentTabIndex=-1;var b=this,c=node("ul");c.className="userpref_tab";c.style.overflow="hidden";c.style.display="inline-flex";for(var d=[],e=0;e<this.configs.length;e++){var f=this.configs[e],g=f.name,k=f.text;if(f.func||k)f=node("li"),f.id=this.ID_PREFIX_TAB+"_"+e,f.style.cursor="pointer",f.onclick=function(){var a=this.id.split("_");b.renderTab(a[a.length-1])},k=node("a"),k.id=this.ID_PREFIX_TAB_LINK+"_"+e,k.className=
0===e?"userpref_tablinks userpref_tablinksOn":"userpref_tablinks",k.style.textDecoration="none",k.style.color="black",k.innerHTML=g,f.appendChild(k),c.appendChild(f),g=node("div"),g.id=this.ID_PREFIX_TAB_CONTENT+"_"+e,g.className=this.tabcontent_class,g.style.display=0===e?"":"none",d.push(g)}rm(a);a.appendChild(c);for(e=0;e<d.length;e++)a.appendChild(d[e]);this.renderTab(0)}};
TabsBuilder.prototype.renderTab=function(a){if(this.currentTabIndex!==a){var b=this.configs[a];if(b){var c=$(this.ID_PREFIX_TAB_LINK+"_"+a),d=$(this.ID_PREFIX_TAB_CONTENT+"_"+a);if(c&&d){c.className="userpref_tablinks userpref_tablinksOn";b.text?(d.innerHTML=b.text,b.renderCallback&&b.renderCallback()):b.func&&(b.sync?(d.innerHTML=b.func(),b.renderCallback&&b.renderCallback()):b.func(d,b.renderCallback));d.style.display="";if(0<=this.currentTabIndex){if(b=$(this.ID_PREFIX_TAB_CONTENT+"_"+this.currentTabIndex))b.style.display=
"none";if(b=$(this.ID_PREFIX_TAB_LINK+"_"+this.currentTabIndex))b.className="userpref_tablinks"}this.currentTabIndex=a}}}};
ctrl.massCreateTabsBuilder=new TabsBuilder([{name:lm.massCreate_tabTitle,text:'<div id="massCreateCategory" style="margin:8px 0 10px 0;"></div><div id="massCreateRule" style="margin:8px 0 25px 0;opacity: 0;transition: opacity 0.8s;-moz-transition: opacity 0.8s;-webkit-transition: opacity 0.8s;-o-transition: opacity 0.8s;position:absolute;z-index: -1;visibility: hidden;"><div id="massCreateNumbericRange" style="opacity: 0;transition: opacity 0.8s;-moz-transition: opacity 0.8s;-webkit-transition: opacity 0.8s;-o-transition: opacity 0.8s;z-index: -1;visibility: hidden;position:absolute"><div id="massCreateNumbericRangeContent"></div></div><div id="numericDataCountContent" style="font-size: 14px;display: none"><br />'+lm.massCreateDataCount_beforeTitle+
'&nbsp;&nbsp;<span id="numericDataCount">0</span>&nbsp;&nbsp;'+lm.massCreateDataCount_afterTitle+'</div><div id="massCreateTimeRange" style="opacity: 0;transition: opacity 0.8s;-moz-transition: opacity 0.8s;-webkit-transition: opacity 0.8s;-o-transition: opacity 0.8s;z-index: -1;visibility: hidden;position:absolute"><div id="massCreateTimeRangeContent"></div></div><div id="timeDataCountContent" style="font-size: 14px;display: none"><br />'+lm.massCreateDataCount_beforeTitle+'&nbsp;&nbsp;<span id="timeDataCount">0</span>&nbsp;&nbsp;'+
lm.massCreateDataCount_afterTitle+'</div><div id="massCreateGroup" style="opacity: 0;transition: opacity 0.8s;-moz-transition: opacity 0.8s;-webkit-transition: opacity 0.8s;-o-transition: opacity 0.8s;z-index: -1;visibility: hidden;position:absolute"><div id="massCreateGroupContent"></div></div><div id="groupUsersDataCountContent" style="font-size: 14px;display: none"><br />'+lm.massCreateDataCount_beforeTitle+'&nbsp;&nbsp;<span id="groupUsersDataCount">0</span>&nbsp;&nbsp;'+lm.massCreateDataCount_afterTitle+
'</div><div id="massCreateSelectOption" style="opacity: 0;transition: opacity 0.8s;-moz-transition: opacity 0.8s;-webkit-transition: opacity 0.8s;-o-transition: opacity 0.8s;z-index: -1;visibility: hidden;position:absolute"><div id="massCreateSelectOptionContent"></div></div><div id="selectOptionDataCountContent" style="font-size: 14px;display: none"><br />'+lm.massCreateDataCount_beforeTitle+'&nbsp;&nbsp;<span id="selectOptionDataCount">0</span>&nbsp;&nbsp;'+lm.massCreateDataCount_afterTitle+'</div><div id="massCreateLinkSheet" style="opacity: 0;transition: opacity 0.8s;-moz-transition: opacity 0.8s;-webkit-transition: opacity 0.8s;-o-transition: opacity 0.8s;z-index: -1;visibility: hidden;position:absolute"><div id="massCreateLinkSheetContent"></div><br /><div id="massCreateLinkSheetContentForSelectFilter"></div></div><div id="sheetDataCountContent" style="font-size: 14px;display: none"><br />'+
lm.massCreateDataCount_beforeTitle+'&nbsp;&nbsp;<span id="sheetDataCount">0</span>&nbsp;&nbsp;'+lm.massCreateDataCount_afterTitle+'</div></div><div id="massCreateDefaultValueDiv" style="margin:8px 0 25px 0;opacity: 0;transition: opacity 0.8s;-moz-transition: opacity 0.8s;-webkit-transition: opacity 0.8s;-o-transition: opacity 0.8s;z-index: -1;visibility: hidden;position:absolute"></div><div id="massCreateExecuteButton" onclick="checkRunningServiceByFormUrl(function() {executeMassCreateScript()});" class="topButtonWhole" style="display: none" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.executeMassCreate+'<div id="dataCount" style="float:right;font-weight:bolder;font-style:italic"></div></div><div id="blockDiv" style="display:none;height:20px" ></div><div id="massCreateMsgDiv" style="color:red;clear:both;padding:10px 0;display:none"></div>',renderCallback:function(){ctrl.massCreateCategoryAction.loadResult({result:[{category:""}]});ctrl.massCreateCategoryAction.renderActionBuilder($("massCreateCategory"))}}]);
ctrl.massCreateTabsBuilder.openDiv=function(){ctrl.massCreateTabsBuilder.renderTabs($("floatingWinContent"));$("floatingWinOuterContent").style.overflow="visible"};ctrl.massCreateTabsBuilder.closeDiv=function(){ctrl.massCreateTabsBuilder.dataCount=0;ctrl.massCreateRuleResult=[];$("floatingWinOuterContent").style.overflow="auto"};
ctrl.massCreateCategoryAction=new ActionBuilder({items:[{id:"category",name:"",beforeFieldTitle:"<span id='massCreateCategory_beforeTitle' style='font-size:14px'>"+lm.massCreateCategory_beforeTitle+"&nbsp;&nbsp;</span>",afterFieldTitle:"<span id='massCreateCategory_afterTitle' style='font-size:14px'>&nbsp;&nbsp;"+lm.massCreateCategory_afterTitle+"&nbsp;&nbsp;</span>",type:"select",options:[lm.massCreateCategory_numbericRange,lm.massCreateCategory_dailyCreate,lm.massCreateCategory_weeklyCreate,lm.massCreateCategory_monthlyCreate,
lm.massCreateCategory_yearlyCreate,lm.massCreateCategory_group,lm.massCreateCategory_selectOption,lm.massCreateCategory_linkSheet],optionValues:[lm.massCreateCategory_numbericRange,lm.massCreateCategory_dailyCreate,lm.massCreateCategory_weeklyCreate,lm.massCreateCategory_monthlyCreate,lm.massCreateCategory_yearlyCreate,lm.massCreateCategory_group,lm.massCreateCategory_selectOption,lm.massCreateCategory_linkSheet],customOption:{headerStyles:{fontSize:"14px",textAlign:"left"},selectStyles:{width:"130px",
height:"22px"}},addEvents:[{eventName:"change",callback:function(a,b){if(void 0!=b&&(a=$(b.id),void 0!=a&&(a=a.options[a.selectedIndex].value,void 0!==a)))if(closeMassCreateRule(),ctrl.massCreateDefaultValueAction.refreshDiv(),$("dataCount").innerText="",ctrl.massCreateTabsBuilder.dataCount=0,-1==a||""===a)$("massCreateExecuteButton").style.display="none",$("blockDiv").style.display="none",ctrl.massCreateDefaultValueAction.closeDiv();else switch(showMassCreateRule(),$("massCreateExecuteButton").style.display=
"block",$("blockDiv").style.display="block",a){case lm.massCreateCategory_numbericRange:$("massCreateCategory_beforeTitle").innerHTML=lm.massCreateCategory_beforeTitle+"&nbsp;&nbsp;";$("massCreateCategory_afterTitle").innerHTML="&nbsp;&nbsp;"+lm.massCreateCategory_afterTitle;ctrl.massCreateNumbericRangeAction.openDiv();break;case lm.massCreateCategory_hourlyCreate:$("massCreateCategory_beforeTitle").innerHTML=lm.massCreateCategory_beforeTitle+"&nbsp;&nbsp;";$("massCreateCategory_afterTitle").innerHTML=
"&nbsp;&nbsp;"+lm.massCreateCategory_afterTitle;ctrl.massCreateTimeRangeAction.openDiv("hour");break;case lm.massCreateCategory_dailyCreate:$("massCreateCategory_beforeTitle").innerHTML=lm.massCreateCategory_beforeTitle+"&nbsp;&nbsp;";$("massCreateCategory_afterTitle").innerHTML="&nbsp;&nbsp;"+lm.massCreateCategory_afterTitle;ctrl.massCreateTimeRangeAction.openDiv("day");break;case lm.massCreateCategory_weeklyCreate:$("massCreateCategory_beforeTitle").innerHTML=lm.massCreateCategory_beforeTitle+"&nbsp;&nbsp;";
$("massCreateCategory_afterTitle").innerHTML="&nbsp;&nbsp;"+lm.massCreateCategory_afterTitle;ctrl.massCreateTimeRangeAction.openDiv("week");break;case lm.massCreateCategory_monthlyCreate:$("massCreateCategory_beforeTitle").innerHTML=lm.massCreateCategory_beforeTitle+"&nbsp;&nbsp;";$("massCreateCategory_afterTitle").innerHTML="&nbsp;&nbsp;"+lm.massCreateCategory_afterTitle;ctrl.massCreateTimeRangeAction.openDiv("month");break;case lm.massCreateCategory_yearlyCreate:$("massCreateCategory_beforeTitle").innerHTML=
lm.massCreateCategory_beforeTitle+"&nbsp;&nbsp;";$("massCreateCategory_afterTitle").innerHTML="&nbsp;&nbsp;"+lm.massCreateCategory_afterTitle;ctrl.massCreateTimeRangeAction.openDiv("year");break;case lm.massCreateCategory_group:$("massCreateCategory_beforeTitle").innerHTML=lm.massCreateCategory_beforeTitle+"&nbsp;&nbsp;";$("massCreateCategory_afterTitle").innerHTML="&nbsp;&nbsp;"+lm.massCreateCategory_afterTitle;ctrl.massCreateGroupAction.openDiv();break;case lm.massCreateCategory_selectOption:$("massCreateCategory_beforeTitle").innerHTML=
lm.massCreateCategory_beforeTitle+"&nbsp;&nbsp;";$("massCreateCategory_afterTitle").innerHTML="&nbsp;&nbsp;"+lm.massCreateCategory_afterTitle;ctrl.massCreateSelectOptionAction.openDiv();break;case lm.massCreateCategory_linkSheet:$("massCreateCategory_beforeTitle").innerHTML=lm.massCreateCategory_beforeTitle+"&nbsp;&nbsp;",$("massCreateCategory_afterTitle").innerHTML="&nbsp;&nbsp;"+lm.massCreateCategory_afterTitleForLinkSheet,ctrl.massCreateLinkSheetAction.openDiv()}}}]}],showHeader:!0,showAdder:!1});
ctrl.massCreateNumbericRangeAction=new ActionBuilder({items:[{id:"rangeStart",name:lm.massCreateCategory_numbericRange,beforeFieldTitle:"<span style='font-size:14px'>"+lm.massCreateNumbericRange_start+"&nbsp;&nbsp;</span>",type:"free",customOption:{freetextStyles:{width:"100px"}},addEvents:[{eventName:"input",callback:function(a,b){a=b.value;var c=b.resultItem.rangeEnd;b.resultItem.rangeStart=b.value;updateDataCount(lm.massCreateCategory_numbericRange,a,c,$("numericDataCount"))}}]},{id:"rangeEnd",
name:lm.massCreateNumbericRange_end,beforeFieldTitle:"<span style='font-size:14px'>"+lm.massCreateNumbericRange_end+"&nbsp;&nbsp;</span>",type:"free",customOption:{freetextStyles:{width:"100px"}},addEvents:[{eventName:"input",callback:function(a,b){a=parseInt(b.resultItem.rangeStart);var c=parseInt(b.value);b.resultItem.rangeEnd=b.value;updateDataCount(lm.massCreateCategory_numbericRange,a,c,$("numericDataCount"))}}]}],showHeader:!1,showAdder:!1});
ctrl.massCreateNumbericRangeAction.showDiv=function(){var a=$("massCreateNumbericRange");massCreateShowDiv(a,ctrl.massCreateNumbericRangeAction.hiddenTimeoutId)};ctrl.massCreateNumbericRangeAction.hiddenDiv=function(){var a=$("massCreateNumbericRange");ctrl.massCreateNumbericRangeAction.hiddenTimeoutId=massCreateHiddenDiv(a)};
ctrl.massCreateNumbericRangeAction.openDiv=function(){ctrl.massCreateType=lm.massCreateCategory_numbericRange;ctrl.massCreateNumbericRangeAction.showDiv();ctrl.massCreateNumbericRangeAction.loadResult({result:[{rangeStart:"",rangeEnd:""}]});ctrl.massCreateNumbericRangeAction.renderActionBuilder($("massCreateNumbericRangeContent"));$("numericDataCountContent").style.display=""};
ctrl.massCreateNumbericRangeAction.closeDiv=function(){delete ctrl.massCreateNumbericRangeAction.dataCount;$("numericDataCount").innerText=0;$("numericDataCountContent").style.display="none";updateDefaultValueBlock(lm.massCreateCategory_numbericRange,0);deleteCreateRuleResult(lm.massCreateCategory_numbericRange);ctrl.massCreateNumbericRangeAction.loadResult({result:[{rangeStart:"",rangeEnd:""}]});ctrl.massCreateNumbericRangeAction.hiddenDiv()};
ctrl.massCreateTimeRangeAction=new ActionBuilder({items:[{id:"rangeStart",name:lm.massCreateTimeRange_start,beforeFieldTitle:"<span style='font-size:14px'>"+lm.massCreateTimeRange_start+"&nbsp;&nbsp;</span>",afterFieldTitle:"<span style='font-size:14px'>&nbsp;&nbsp;"+lm.massCreateTimeRange_afterStart+"</span>",type:"free",customOption:{freetextStyles:{textAlign:"center",width:"100px"}},addEvents:[{eventName:"click",callback:function(a,b){datePickerClick(b,ctrl.massCreateTimeRangeAction.dateFormat)}},
{eventName:"change",callback:function(a,b){a=ragic_date_format(b.value,ctrl.massCreateTimeRangeAction.dateFormat);var c=b.resultItem.rangeEnd;b.resultItem.rangeStart=a;b.value=a;updateDataCount(ctrl.massCreateType,a,c,$("timeDataCount"))}}],renderFieldCallback:function(a){a.element.autocomplete="off"}},{id:"rangeEnd",name:lm.massCreateTimeRange_end,beforeFieldTitle:"<span style='font-size:14px'>"+lm.massCreateTimeRange_end+"&nbsp;&nbsp;</span>",afterFieldTitle:"<span style='font-size:14px'>&nbsp;&nbsp;"+
lm.massCreateTimeRange_afterEnd+"</span>",type:"free",customOption:{freetextStyles:{textAlign:"center",width:"100px"}},addEvents:[{eventName:"click",callback:function(a,b){datePickerClick(b,ctrl.massCreateTimeRangeAction.dateFormat)}},{eventName:"change",callback:function(a,b){a=ragic_date_format(b.value,ctrl.massCreateTimeRangeAction.dateFormat);var c=b.resultItem.rangeStart;b.resultItem.rangeEnd=a;b.value=a;updateDataCount(ctrl.massCreateType,c,a,$("timeDataCount"))}}],renderFieldCallback:function(a){a.element.autocomplete=
"off"}}],showHeader:!1,showAdder:!1});ctrl.massCreateTimeRangeAction.showDiv=function(){var a=$("massCreateTimeRange");massCreateShowDiv(a,ctrl.massCreateTimeRangeAction.hiddenTimeoutId)};ctrl.massCreateTimeRangeAction.hiddenDiv=function(){var a=$("massCreateTimeRange");ctrl.massCreateTimeRangeAction.hiddenTimeoutId=massCreateHiddenDiv(a)};
ctrl.massCreateTimeRangeAction.openDiv=function(a){ctrl.massCreateTimeRangeAction.showDiv();ctrl.massCreateTimeRangeAction.dateFormat="yyyy/MM/dd";switch(a){case "hour":ctrl.massCreateTimeRangeAction.dateFormat="yyyy/MM/dd HH:mm";ctrl.massCreateType=lm.massCreateCategory_hourlyCreate;break;case "day":ctrl.massCreateTimeRangeAction.dateFormat="yyyy/MM/dd";ctrl.massCreateType=lm.massCreateCategory_dailyCreate;break;case "week":ctrl.massCreateTimeRangeAction.dateFormat="yyyy/MM/dd";ctrl.massCreateType=
lm.massCreateCategory_weeklyCreate;break;case "month":ctrl.massCreateTimeRangeAction.dateFormat="yyyy/MM/dd";ctrl.massCreateType=lm.massCreateCategory_monthlyCreate;break;case "year":ctrl.massCreateTimeRangeAction.dateFormat="yyyy/MM/dd",ctrl.massCreateType=lm.massCreateCategory_yearlyCreate}ctrl.massCreateTimeRangeAction.loadResult({result:[{rangeStart:"",rangeEnd:""}]});ctrl.massCreateTimeRangeAction.renderActionBuilder($("massCreateTimeRangeContent"));$("timeDataCountContent").style.display=""};
ctrl.massCreateTimeRangeAction.closeDiv=function(){delete ctrl.massCreateTimeRangeAction.dataCount;$("timeDataCount").innerText=0;$("timeDataCountContent").style.display="none";updateDefaultValueBlock(ctrl.massCreateType,0);deleteCreateRuleResult(ctrl.massCreateType);ctrl.massCreateTimeRangeAction.loadResult({result:[{rangeStart:"",rangeEnd:""}]});ctrl.massCreateTimeRangeAction.hiddenDiv()};
ctrl.massCreateGroupAction=new ActionBuilder({items:[{id:"groupValue",name:lm.massCreateGroup_value,beforeFieldTitle:"<span style='font-size:14px'>"+lm.massCreateGroup_beforeTitle+"&nbsp;&nbsp;</span>",afterFieldTitle:"<span style='font-size:14px'>&nbsp;&nbsp;"+lm.massCreateGroup_afterTitle+"</span>",type:"select",options:[],optionValues:[],customOption:{freetextStyles:{textAlign:"center"},selectStyles:{width:"150px",height:"22px"},customComboBoxStyles:{width:"250px"}},addEvents:[{eventName:"change",
callback:function(a,b){updateDataCount(lm.massCreateCategory_group,b.resultItem.groupValue,null,$("groupUsersDataCount"))}}]}],showHeader:!1,showAdder:!1});ctrl.massCreateGroupAction.showDiv=function(){var a=$("massCreateGroup");massCreateShowDiv(a,ctrl.massCreateGroupAction.hiddenTimeoutId)};ctrl.massCreateGroupAction.hiddenDiv=function(){var a=$("massCreateGroup");ctrl.massCreateGroupAction.hiddenTimeoutId=massCreateHiddenDiv(a)};
ctrl.massCreateGroupAction.openDiv=function(){ctrl.massCreateType=lm.massCreateCategory_group;ctrl.massCreateGroupAction.showDiv();var a=ctrl.massCreateGroupAction.config.items[0];ajaxget("/sims/massCreateQuery.jsp",{a:ap,path:path,si:sheetIndex,query:"getGroupInfo"},function(b){b=JSON.parse(b);ctrl.massCreateGroupAction.groupArray=b;for(var c=[],d=[],e=0;e<b.length;e++)c.push(b[e].group+"("+b[e].usersCount+")"),d.push(b[e].group);a.options=c;a.optionValues=d},!0);ctrl.massCreateGroupAction.loadResult({result:[{groupValue:""}]});
ctrl.massCreateGroupAction.renderActionBuilder($("massCreateGroupContent"));$("groupUsersDataCountContent").style.display=""};ctrl.massCreateGroupAction.closeDiv=function(){delete ctrl.massCreateGroupAction.dataCount;$("groupUsersDataCount").innerText=0;$("groupUsersDataCountContent").style.display="none";updateDefaultValueBlock(lm.massCreateCategory_group,0);deleteCreateRuleResult(lm.massCreateCategory_group);ctrl.massCreateGroupAction.loadResult({result:[{groupValue:""}]});ctrl.massCreateGroupAction.hiddenDiv()};
ctrl.massCreateSelectOptionAction=new ActionBuilder({items:[{id:"optionValue",name:"",beforeFieldTitle:"<span style='font-size:14px'>"+lm.massCreateOption_beforeTitle+"&nbsp;&nbsp;</span>",afterFieldTitle:"<span style='font-size:14px'>&nbsp;&nbsp;"+lm.massCreateOption_afterTitle+"</span>",type:"select",options:[],optionValues:[],customOption:{freetextStyles:{textAlign:"center"},selectStyles:{width:"150px",height:"22px"},customComboBoxStyles:{width:"250px"}},addEvents:[{eventName:"change",callback:function(a,
b){updateDataCount(lm.massCreateCategory_selectOption,b.resultItem.optionValue,null,$("selectOptionDataCount"))}}]}],showHeader:!1,showAdder:!1});ctrl.massCreateSelectOptionAction.showDiv=function(){var a=$("massCreateSelectOption");massCreateShowDiv(a,ctrl.massCreateSelectOptionAction.hiddenTimeoutId)};ctrl.massCreateSelectOptionAction.hiddenDiv=function(){var a=$("massCreateSelectOption");ctrl.massCreateSelectOptionAction.hiddenTimeoutId=massCreateHiddenDiv(a)};
ctrl.massCreateSelectOptionAction.openDiv=function(){ctrl.massCreateType=lm.massCreateCategory_selectOption;ctrl.massCreateSelectOptionAction.showDiv();var a=ctrl.massCreateSelectOptionAction.config.items[0];ajaxget("/sims/massCreateQuery.jsp",{a:ap,path:path,si:sheetIndex,query:"getSelectionFieldsOfSheet"},function(b){b=JSON.parse(b);ctrl.massCreateSelectOptionAction.optionArray=b;for(var c=[],d=[],e=0;e<b.length;e++)c.push(b[e].fieldDisplayText),d.push(b[e].domainId);a.options=c;a.optionValues=
d},!0);ctrl.massCreateSelectOptionAction.loadResult({result:[{optionValue:""}]});ctrl.massCreateSelectOptionAction.renderActionBuilder($("massCreateSelectOptionContent"));$("selectOptionDataCountContent").style.display=""};
ctrl.massCreateSelectOptionAction.closeDiv=function(){delete ctrl.massCreateSelectOptionAction.dataCount;$("selectOptionDataCount").innerText=0;$("selectOptionDataCountContent").style.display="none";updateDefaultValueBlock(lm.massCreateCategory_selectOption,0);deleteCreateRuleResult(lm.massCreateCategory_selectOption);ctrl.massCreateSelectOptionAction.loadResult({result:[{optionValue:""}]});ctrl.massCreateSelectOptionAction.hiddenDiv()};
ctrl.massCreateLinkSheetAction=new ActionBuilder({items:[{id:"sheetValue",name:"",beforeFieldTitle:"<span style='font-size:14px'>"+lm.massCreateLinkSheet_sheetBeforeTitle+"&nbsp;&nbsp;</span>",afterFieldTitle:"<span style='font-size:14px'>&nbsp;&nbsp;"+lm.massCreateLinkSheet_sheetAfterTitle+"</span>",type:"select",options:[],optionValues:[],enableOptGroup:!0,addEvents:[{eventName:"change",callback:function(a,b){var c=b.resultArray[0].sheetValue,d=c.lastIndexOf("/");a=c.slice(0,d);c=c.slice(d+1);var e=
[];ajaxget("/sims/massCreateQuery.jsp",{a:ap,path:a,si:c,query:"getFieldsOfSheet"},function(a){e=JSON.parse(a)},!0);d=b.parentElement.nextSibling.children[1];rm(d);b=document.createElement("OPTION");b.textContent="";b.value=-1;d.appendChild(b);for(var f=0;f<e.length;f++)b=document.createElement("OPTION"),b.textContent=e[f].fieldDisplayText,b.value=e[f].domainId,d.appendChild(b);var g=[];ajaxget("/sims/massCreateQuery.jsp",{a:ap,path:a,si:c,query:"getDesignerFilter"},function(a){g=JSON.parse(a)},!0);
a=$("LinkSheet_filterAfterTitle").parentElement.previousSibling;rm(a);b=document.createElement("OPTION");b.textContent="";b.value=-1;a.appendChild(b);for(c=0;c<g.length;c++)b=document.createElement("OPTION"),b.textContent=g[c].filterName,b.value=g[c].sequence,a.appendChild(b)}}],customOption:{selectStyles:{width:"150px",height:"22px"}}},{id:"fieldValue",name:"",beforeFieldTitle:"<span style='font-size:14px'>"+lm.massCreateLinkSheet_fieldBeforeTitle+"</span>",afterFieldTitle:"<span style='font-size:14px'>&nbsp;&nbsp;"+
lm.massCreateLinkSheet_fieldAfterTitle+"</span>",type:"select",options:[],optionValues:[],addEvents:[{eventName:"change",callback:function(a,b){ctrl.massCreateLinkSheetAction.updateLinkSheetDataCount()}}],customOption:{selectStyles:{width:"150px",height:"22px"}}}],showHeader:!1,showAdder:!1});ctrl.massCreateLinkSheetAction.showDiv=function(){var a=$("massCreateLinkSheet");massCreateShowDiv(a,ctrl.massCreateLinkSheetAction.hiddenTimeoutId)};
ctrl.massCreateLinkSheetAction.hiddenDiv=function(){var a=$("massCreateLinkSheet");ctrl.massCreateLinkSheetAction.hiddenTimeoutId=massCreateHiddenDiv(a)};
ctrl.massCreateLinkSheetAction.openDiv=function(){ctrl.massCreateType=lm.massCreateCategory_linkSheet;ctrl.massCreateLinkSheetAction.showDiv();ajaxget("/sims/massCreateQuery.jsp",{a:ap,query:"getAppAndSheet"},function(a){a=JSON.parse(a);for(var b=[],c=0;c<a.length;c++){var d={};d.groupLabel=a[c].appName;for(var e=a[c].sheets,f=a[c].sheetIndexs,g=[],k=0;k<e.length;k++)optObj={},optObj.name=e[k],optObj.value=a[c].appPath+"/"+f[k],g.push(optObj);d.options=g;b.push(d)}ctrl.massCreateLinkSheetAction.config.items[0].options=
b},!0);ctrl.massCreateLinkSheetAction.loadResult({result:[{sheetValue:"",fieldValue:""}]});ctrl.massCreateLinkSheetAction.renderActionBuilder($("massCreateLinkSheetContent"));ctrl.massCreateLinkSheetAction.SelectFilterAction.openDiv();$("sheetDataCountContent").style.display=""};
ctrl.massCreateLinkSheetAction.closeDiv=function(){delete ctrl.massCreateLinkSheetAction.dataCount;$("sheetDataCount").innerText=0;$("sheetDataCountContent").style.display="none";updateDefaultValueBlock(lm.massCreateCategory_linkSheet,0);deleteCreateRuleResult(lm.massCreateCategory_linkSheet);ctrl.massCreateLinkSheetAction.loadResult({result:[{sheetValue:"",fieldValue:""}]});ctrl.massCreateLinkSheetAction.hiddenDiv();ctrl.massCreateLinkSheetAction.SelectFilterAction.closeDiv()};
ctrl.massCreateLinkSheetAction.updateLinkSheetDataCount=function(){updateDataCount(lm.massCreateCategory_linkSheet,ctrl.massCreateLinkSheetAction.result.result[0],ctrl.massCreateLinkSheetAction.SelectFilterAction.result.result[0],$("sheetDataCount"))};
ctrl.massCreateLinkSheetAction.SelectFilterAction=new ActionBuilder({items:[{id:"filterValue",name:"",beforeFieldTitle:"<span style='font-size:14px'>"+lm.massCreateLinkSheet_filterBeforeTitle+"&nbsp;&nbsp;</span>",afterFieldTitle:"<span id='LinkSheet_filterAfterTitle' style='font-size:14px'>&nbsp;&nbsp;"+lm.massCreateLinkSheet_filterAfterTitle+"</span>",type:"select",options:[],optionValues:[],addEvents:[{eventName:"change",callback:function(a,b){ctrl.massCreateLinkSheetAction.updateLinkSheetDataCount()}}],
customOption:{selectStyles:{width:"150px",height:"22px"}}}],showHeader:!1,showAdder:!1});ctrl.massCreateLinkSheetAction.SelectFilterAction.openDiv=function(){ctrl.massCreateLinkSheetAction.SelectFilterAction.loadResult({result:[{filterValue:""}]});ctrl.massCreateLinkSheetAction.SelectFilterAction.renderActionBuilder($("massCreateLinkSheetContentForSelectFilter"))};ctrl.massCreateLinkSheetAction.SelectFilterAction.closeDiv=function(){ctrl.massCreateLinkSheetAction.SelectFilterAction.loadResult({result:[{filterValue:""}]})};
ctrl.massCreateDefaultValueAction=new ActionBuilder({items:[{id:"field",name:lm.massCreateDefaultFieldValue_field,type:"select",options:[],optionValues:[],optionSheetNoSubtable:!0,ignoreReadOnly:!0,noMultiLink:!0,customOption:{headerStyles:{width:"150px"},selectStyles:{width:"150px",height:"22px"}},addEvents:[{eventName:"change",callback:function(a,b){if(!isValueInAutoGenDefaultValue(b.resultItem.value||"")&&"field"==b.resultItemId&&b.rowId&&b.ab&&b.ab.rowIds){var c=b.ab.rowIds.indexOf(b.rowId);if(-1!=
c){var d=b.ab.config.items[1],e=b.options[b.selectedIndex].value;ajaxgetAllowCache(urlHashResolve(!0),{api:"",def:""},function(a){if(a=JSON.parse(a).fields)if(a=a["fid"+e]){if(a.attr_mvp)d.type="free";else if("L"===a.type||"M"===a.type){var f=getActionBuilderOptionItem(e);f.options&&f.optionValues&&(d.type="L"===a.type?"datalist":"multiSelect",d.options=f.options,d.optionValues=f.optionValues,d.noEmptyOption="M"===a.type)}else d.type="free";a={field:e,value:b.resultItem.value};b.ab.result.result[c]=
a;b.ab.insertDisplayRow(c,a);b.ab.deleteDisplayRow(c+1);b.ab.rowIds.splice(c+1,1);d.type="free"}},!0)}}}}]},{id:"value",name:lm.massCreateDefaultFieldValue_value,type:"free",renderFieldCallback:function(a){a=a.element;isValueInAutoGenDefaultValue(a.value||"")&&(a.readOnly=!0,a.style.border="none")},customOption:{headerStyles:{width:"150px"},freetextStyles:{width:"150px"},selectStyles:{width:"150px",height:"22px"},customComboBoxStyles:{width:"150px"}}}],showHeader:!0});
ctrl.massCreateDefaultValueAction.showDiv=function(){var a=$("massCreateDefaultValueDiv");massCreateShowDiv(a,ctrl.massCreateDefaultValueAction.hiddenTimeoutId)};ctrl.massCreateDefaultValueAction.hiddenDiv=function(){var a=$("massCreateDefaultValueDiv");ctrl.massCreateDefaultValueAction.hiddenTimeoutId=massCreateHiddenDiv(a)};
ctrl.massCreateDefaultValueAction.openDiv=function(){ctrl.massCreateDefaultValueAction.showDiv();ctrl.massCreateDefaultValueAction.config.items[0].optionPath=path;ctrl.massCreateDefaultValueAction.config.items[0].optionSheetIndex=sheetIndex;ajaxget("/sims/massCreateQuery.jsp",{a:ap,path:path,si:sheetIndex,query:"getMustFieldDomainId"},function(a){a=JSON.parse(a);var b=[];0===a.length&&b.push({field:"",value:""});for(var c=0;c<a.length;c++)b.push({field:a[c],value:""});ctrl.massCreateDefaultValueAction.loadResult({result:b})},
!0);ctrl.massCreateDefaultValueAction.renderActionBuilder($("massCreateDefaultValueDiv"))};ctrl.massCreateDefaultValueAction.closeDiv=function(){ctrl.massCreateDefaultValueAction.loadResult({result:[{field:"",value:""}]});ctrl.massCreateDefaultValueAction.autogenArray=[];ctrl.massCreateDefaultValueAction.hiddenDiv()};ctrl.massCreateDefaultValueAction.refreshDiv=function(){ctrl.massCreateDefaultValueAction.closeDiv();ctrl.massCreateDefaultValueAction.openDiv()};
ctrl.massCreateDefaultValueAction.autogenArray=[];function showMassCreateRule(){var a=$("massCreateRule");massCreateShowDiv(a,ctrl.CreateRuleBlockTimeoutId)}function closeMassCreateRule(){closeMassCreateRuleAction();ctrl.massCreateType="";var a=$("massCreateRule");ctrl.CreateRuleBlockTimeoutId=massCreateHiddenDiv(a)}function closeMassCreateRuleAction(){ctrl.massCreateRuleActionSet.forEach(function(a){a.closeDiv&&a.closeDiv()})}
function deleteCreateRuleResult(a){for(var b=0;b<ctrl.massCreateRuleResult.length;b++)if(ctrl.massCreateRuleResult[b].createType===a){ctrl.massCreateRuleResult.splice(b,1);break}}function isValueInAutoGenDefaultValue(a){for(var b=0;b<ctrl.massCreateDefaultValueAction.autogenArray.length;b++)if(ctrl.massCreateDefaultValueAction.autogenArray[b].showValue==a)return!0;return!1}ctrl.massCreateRuleActionSet=[];ctrl.massCreateRuleActionSet.push(ctrl.massCreateNumbericRangeAction);ctrl.massCreateRuleActionSet.push(ctrl.massCreateTimeRangeAction);
ctrl.massCreateRuleActionSet.push(ctrl.massCreateGroupAction);ctrl.massCreateRuleActionSet.push(ctrl.massCreateLinkSheetAction);ctrl.massCreateRuleActionSet.push(ctrl.massCreateSelectOptionAction);ctrl.massCreateRuleResult=[];ctrl.massCreateType="";
ctrl.massCloneTabsBuilder=new TabsBuilder([{name:lm.massClone,text:lm.massClonePrompt+'<div id="massCloneFields" style="margin:8px 0 10px 0;"></div><div id="massCloneBlockUp" style="height:20px" ></div><div id="massCloneExecuteButton" onclick="checkRunningServiceByFormUrl(function() {executeMassClone()});" class="topButtonWhole" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.executeMassClone+
'</div><div id="massCloneBlockDown" style="height:20px" ></div><div id="massCloneMsgDiv" style="color:red;clear:both;padding:10px 0;display:none"></div>'}]);ctrl.massCloneTabsBuilder.openDiv=function(){ctrl.massCloneTabsBuilder.renderTabs($("floatingWinContent"));ctrl.massCloneFieldAction.openDiv();$("floatingWinOuterContent").style.overflow="visible"};ctrl.massCloneTabsBuilder.closeDiv=function(){$("floatingWinOuterContent").style.overflow="auto"};
ctrl.massCloneFieldAction=new ActionBuilder({items:[{id:"fields",name:lm.massCloneFieldHeader,beforeFieldTitle:"",afterFieldTitle:"",type:"multiSelect",options:[],optionValues:[],customOption:{headerStyles:{fontSize:"13px",fontWeight:"normal",textAlign:"left"}},noEmptyOption:!0}],showHeader:!0,showAdder:!1});
ctrl.massCloneFieldAction.openDiv=function(){var a=ctrl.massCloneFieldAction.config.items[0],b=[];ajaxget("/sims/massCreateQuery.jsp",{a:ap,path:path,si:sheetIndex,query:"getFieldsOfSheet",includeSubtable:!0,queryAttributes:'["noclone"]'},function(a){b=JSON.parse(a)},!0);for(var c=[],d=[],e=[],f=0;f<b.length;f++)d.push(b[f].fieldDisplayText+" ("+lm.Doc_InfoFieldId+":"+b[f].domainId+")"),e.push(b[f].domainId),void 0!==b[f].noclone&&c.push(b[f].domainId+"");a.options=d;a.optionValues=e;ctrl.massCloneFieldAction.loadResult({result:[{fields:c}]});
ctrl.massCloneFieldAction.renderActionBuilder($("massCloneFields"))};ctrl.massCloneFieldAction.closeDiv=function(){};
ctrl.batchExecTabsBuilder=new TabsBuilder([{name:lm.massActionButton,func:function(a){postPromise("/sims/massActionButtonSelect.jsp",{a:ap,p:path,fn:sheet}).then(function(b){a.innerHTML=b})}},{name:lm.massLock_title,func:function(a){postPromise("/sims/massLockSelect.jsp",{a:ap,p:path,fn:sheet}).then(function(b){a.innerHTML=b})}},{name:lm.massApproval_title,func:function(a){postPromise("/sims/massApproval.jsp",{a:ap,p:path,si:sheetIndex}).then(function(b){a.innerHTML=b})}},{name:lm.massMailMerge_title,
func:function(a){postPromise("/sims/massMailMerge.jsp",{a:ap,p:path,si:sheetIndex}).then(function(b){a.innerHTML=b})}}]);
ctrl.massEditTabsBuilder=new TabsBuilder([{name:lm.massEdit_tabTitle,text:lm.massEditPrompt+'<div id="massEditContainer" style="margin:8px 0 25px 0;"></div><div onclick="checkRunningServiceByFormUrl(function() {executeMassUpdateScript()});" class="topButtonWhole" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.executeMassUpdate+'</div><div id="massUpdateMsgDiv" style="color:red;clear:both;padding:10px 0;display:none"></div><div style=\'float:none;clear:both;padding:8px 0 0 0;color:red;\'>'+
lm.massEdit_warning+"</div>",renderCallback:function(){ctrl.massUpdateActionBuilder.config.items[0].optionPath=path;ctrl.massUpdateActionBuilder.config.items[0].optionSheetIndex=sheetIndex;ctrl.massUpdateActionBuilder.loadResult({result:[{field:"",value:""}]});ctrl.massUpdateActionBuilder.renderActionBuilder($("massEditContainer"))}},{name:lm.massReplace_title,text:lm.massReplace_desc_1+'<div id="massReplaceContainer" style="margin:8px 0 25px 0;"></div><div onclick="checkRunningServiceByFormUrl(function() {executeMassReplaceScript()});" class="topButtonWhole" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.massReplace_execute+'</div><div id="massUpdateMsgDiv" style="color:red;clear:both;padding:10px 0;display:none;color:red"></div><div style=\'float:none;clear:both;padding:8px 0 0 0;color:red;\'>'+lm.massReplace_warning+"</div>",renderCallback:function(){ctrl.massUpdateReplaceModeActionBuilder.config.items[0].optionPath=path;ctrl.massUpdateReplaceModeActionBuilder.config.items[0].optionSheetIndex=sheetIndex;ctrl.massUpdateReplaceModeActionBuilder.loadResult({result:[{field:"",value_replaced:"",value_new:""}]});
ctrl.massUpdateReplaceModeActionBuilder.renderActionBuilder($("massReplaceContainer"))}}]);
ctrl.notifyViewTabsBuilder=new TabsBuilder([{name:lm.customEmail_notify_view_insert_title,func:function(a){editModeEmailTemplateEditors.notifyViewInsert.open(ctrl.notifyViewTabsBuilder.filterSeq,a)}},{name:lm.customEmail_notify_view_updateMatch_title,func:function(a){editModeEmailTemplateEditors.notifyViewUpdateMatch.open(ctrl.notifyViewTabsBuilder.filterSeq,a)}},{name:lm.customEmail_notify_view_updateNoMatch_title,func:function(a){editModeEmailTemplateEditors.notifyViewUpdateNoMatch.open(ctrl.notifyViewTabsBuilder.filterSeq,
a)}}]);function MultiFreeInput(){this.values=[];this.separator=","}MultiFreeInput.prototype.setSeparator=function(a){this.separator=a};MultiFreeInput.prototype.setValues=function(a){this.values=a;this.afterChangeValues&&this.afterChangeValues(this.values)};MultiFreeInput.prototype.getValues=function(){return this.values};MultiFreeInput.prototype.push=function(a){this.values.push(a);this.afterChangeValues&&this.afterChangeValues(this.values)};
MultiFreeInput.prototype.pop=function(){0!=this.values.length&&(this.values.pop(),this.afterChangeValues&&this.afterChangeValues(this.values))};MultiFreeInput.prototype.setValue=function(a,b){0>a||a>=this.values.length||(this.values[a]=b,this.afterChangeValues&&this.afterChangeValues(this.values))};
MultiFreeInput.prototype.render=function(a){var b=this;rm(a);var c=node("div");c.classList.add("conditionContent");a.appendChild(c);var d=node("div");d.style.display="inline-block";c.appendChild(d);for(var e={$jscomp$loop$prop$i$598:0};e.$jscomp$loop$prop$i$598<this.values.length;e={$jscomp$loop$prop$i$598:e.$jscomp$loop$prop$i$598},e.$jscomp$loop$prop$i$598++){0<e.$jscomp$loop$prop$i$598&&d.appendChild(document.createTextNode(this.separator));var f=this.values[e.$jscomp$loop$prop$i$598],g=node("input");
g.style.width="80px";g.value=f;g.onkeyup=function(a){return function(){b.setValue(a.$jscomp$loop$prop$i$598,this.value)}}(e);g.onfocus=outNUI;g.onblur=inNUI;d.appendChild(g)}d=node("div");d.style.display="inline-block";c.appendChild(d);c=node("i");c.classList.add("far");c.classList.add("fa-plus-square");c.onclick=function(){b.push("");b.render(a)};d.appendChild(c);c=node("i");c.classList.add("far");c.classList.add("fa-minus-square");c.onclick=function(){b.pop();b.render(a)};d.appendChild(c)};
function DataList(){for(var a=node("input"),b=node("datalist"),c=null,d=null;null==c||$(c)||null==d||$(d);)d=genRandom(5),c="dataList"+d,d="dataListInput"+d;b.setAttribute("id",c);a.setAttribute("id",d);a.setAttribute("list",c);var e=this;a.onchange=function(){e.setValue(a.value)};a.onkeyup=function(){e.setValue(a.value)};this.input=a;this.dataList=b}
DataList.prototype.render=function(a,b){if(!a||!a.options)throw Error("Not a valid select element");if(!b)throw Error("No parentElement");for(var c=0;c<a.options.length;c++){var d=a.options[c];if(d.text&&d.value){var e=node("option");e.setAttribute("data-value",d.value);e.setAttribute("value",d.text);this.dataList.appendChild(e)}}rm(b);this.input.setAttribute("placeholder",this.placeholder?this.placeholder:lm.ab_datalist_defaultPlaceHolder);b.appendChild(this.input);b.appendChild(this.dataList)};
DataList.prototype.setValue=function(a){null==a&&(a="");for(var b=this.input.value=a,c=0;c<this.dataList.options.length;c++){var d=this.dataList.options[c];if(d.getAttribute("value")==a){b=d.getAttribute("data-value");break}}this.afterChangeValue&&this.afterChangeValue(b)};DataList.prototype.getValue=function(){for(var a=this.input.value||"",b=a,c=0;c<this.dataList.options.length;c++){var d=this.dataList.options[c];if(d.getAttribute("value")==a){b=d.getAttribute("data-value");break}}return b};
DataList.prototype.setPlaceHolder=function(a){a&&(this.placeholder=a)};
function floatWin(a,b,c,d,e,f){f=$("floatingWinOK");var g=$("floatingWin"),k=$("floatingWinHeader"),l=$("floatingWinContent"),m=$("floatingWinOuterContent");outNUI();c||(c="&nbsp;");d?f.style.display="none":(f.style.display="",e&&($("floatingOKButton").textContent=e));a||b||(b="&nbsp;");rm(k);rm(l);g.style.display="";g.style.height="auto";g.style.width="auto";g.classList.contains("thinFloatingWin")&&g.classList.remove("thinFloatingWin");m.style.height="auto";m.style.width="auto";m.style.overflow=
"auto";k.innerHTML=c;positionFloatWin();b?(b instanceof Element?(rm(l),l.appendChild(b)):l.innerHTML=b,positionFloatWin(),a&&a()):(a&&(floatingWinUrlFunc=a),l.innerHTML='<i class="fa fa-spinner fa-spin" style="margin:25px;"></i>',read(function(a){l.innerHTML=a.responseText;positionFloatWin();(a=$("email"))&&a.focus();"function"===typeof ctrl.floatWinCallback&&(ctrl.floatWinCallback(),ctrl.floatWinCallback=null)},floatingWinUrlFunc()))}
function floatWinClose(a){inNUI();ctrl.focusLock=!1;$("floatingWin").style.display="none";a&&"boolean"==typeof a&&location.reload();mode===BUILDER&&(builder.bbcodeImage=null)}
function positionFloatWin(a){if(a)var b=a.querySelector(".floatingWinContent");else a=$("floatingWin"),b=$("floatingWinOuterContent");var c=Math.min(document.body.clientHeight,document.documentElement.clientHeight),d=Math.min(document.body.clientWidth,document.documentElement.clientWidth);b.querySelector(".userpref_tabcontent")||(a.offsetHeight>.8*c&&(b.style.height=.8*c+"px"),a.offsetWidth>.8*d&&(b.style.width=.8*d+"px"));b=a.offsetHeight;var e=a.offsetWidth,f=getBodyScrolltop()+.25*c,g=getBodyScrollleft()+
.25*d;2*f+b>c&&(f=(c-b)/2+getBodyScrolltop());2*g+e>d&&(g=(d-e)/2+getBodyScrollleft());a.style.top=f+"px";a.style.left=g+"px"}
function floatWinError(a,b,c,d,e){3===arguments.length&&"string"===typeof c&&(e=c,d=c=!1);floatWinIcon('<svg style="width:70px;fill:#e92729;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>',a,
!b,c,d,e)}
function floatWinErrorWithConfirm(a,b,c,d,e,f,g){floatWinConfirmV3(a,b,c,d,e,f,g,'<svg style="width:70px;fill:#e92729;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>')}
function floatWinWarningWithConfirm(a,b,c,d,e,f,g){floatWinConfirmV3(a,b,c,d,e,f,g,'<i style="font-size:70px;color:#F1D83B;" class="fas fa-exclamation-triangle"></i>')}function floatWinWarning(a,b,c,d,e){3===arguments.length&&"string"===typeof c&&(e=c,d=c=!1);floatWinIcon('<i style="font-size:70px;color:#F1D83B;" class="fas fa-exclamation-triangle"></i>',a,!b,c,d,e)}
function floatWinLoading(a,b,c,d,e){3===arguments.length&&"string"===typeof c&&(e=c,d=c=!1);floatWinIcon('<i style="font-size:70px;color:#CCC;" class="fas fa-spinner-third quick-spin"></i>',a,!b,c,d,e)}
function floatWinSuccess(a,b,c,d,e){3===arguments.length&&"string"===typeof c&&(e=c,d=c=!1);floatWinIcon('<svg style="width:70px;fill:#6CB73D;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></svg>',a,
b,c,d,e)}
function floatWinIcon(a,b,c,d,e,f){e?(e=document.createElement("span"),e.innerHTML=b,e.className="getTextWidth",document.querySelector("body").appendChild(e),e=document.querySelector(".getTextWidth").offsetWidth,document.querySelector(".getTextWidth").remove(),e=Math.ceil(e/.7),550>e&&(e=550),floatWin(null,'<div style="width:'+e+'px "><div style="float:left;width:15%;margin:0 30px 0 15px;">'+a+'</div><div style="float:right;width:calc(90% - 100px);margin: 0 5px 0 0"><p style="float:left;min-height:70px;margin:5px 0 0 0;font-size:14px; white-space:nowrap;">'+b+
"</p>"+(c?'<p style="float:right;clear:both;margin:0;"><span style="margin:0;" id="floatingOKButton" class="topButtonWholeLarger" onclick= "floatWinClose('+d+');"onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.ok+"</span></p>":"")+"</div></div>",f,!0)):floatWin(null,'<div style="float:left;width:15%;margin:0 30px 0 15px;">'+a+'</div><div style="float:left;width:70%;"><p style="float:left;min-height:70px;margin:5px 0 0 0;font-size:14px; line-height: 1.5;">'+
b+"</p>"+(c?'<p style="float:right;clear:both;margin:0;"><span style="margin:0;" id="floatingOKButton" class="topButtonWholeLarger" onclick= "floatWinClose('+d+');"onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.ok+"</span></p>":"")+"</div>",f,!0)}
function floatWinConfirmV3(a,b,c,d,e,f,g,k){a||(a="");c||(c=lm.ok);e||(e=lm.cancel);b||(b="floatWinClose();");d||(d="floatWinClose();");var l=node("div"),m=node("div",null,"floatWinConfirmIconDiv");m.style.color="#3467CB";m.innerHTML=k?k:'<i class="fas fa-question-circle"></i>';k=node("div",null,"floatWinConfirmContentDiv");var n=node("p",null,"floatWinConfirmTextDiv");a instanceof Element?(rm(n),n.appendChild(a)):n.innerHTML=a;a=node("p",null,"floatWinConfirmButtonDiv");k.appendChild(n);k.appendChild(a);
n=node("div","bFloatWinConfirmOK","topButtonWholeLarger");n.style.margin="0 15px 0 0";n.innerHTML=c;n.onclick="function"===typeof b?function(){try{b()}catch(q){}floatWinClose()}:function(){try{eval(b)}catch(q){}floatWinClose()};c=node("div","bFloatWinConfirmCancel","topButtonWholeLarger");c.innerHTML=e;c.onclick="function"===typeof d?function(){try{d()}catch(q){}floatWinClose()}:function(){try{eval(d)}catch(q){}floatWinClose()};a.appendChild(n);a.appendChild(c);l.appendChild(m);l.appendChild(k);floatWin(g,
l,f,!0)}
function floatWinSubmit(a,b,c,d,e,f,g){a||(a="");c||(c=lm.ok);e||(e=lm.cancel);b||(b="floatWinClose();");d||(d="floatWinClose();");a=h("div",null,[h("div",{class:"floatWin-submit-content"},a),h("div",{class:["floatWin-submit-footer","flex-end-center"]},[h("button",{id:"bFloatWinConfirmOK",class:"topButtonWholeLarger",callback:function(a){a.onclick="function"===typeof b?function(){try{b()}catch(l){}floatWinClose()}:function(){try{eval(b)}catch(l){}floatWinClose()}}},c),h("button",{id:"bFloatWinConfirmCancel",class:"topButtonWholeLarger",
callback:function(a){a.onclick="function"===typeof d?function(){try{d()}catch(l){}floatWinClose()}:function(){try{eval(d)}catch(l){}floatWinClose()}}},e)])]);floatWin(g,a,f,!0)}
function floatWinPrompt(a,b,c,d,e,f){f||(f=biffdata&&1E5<biffdata.totalEntry);floatWin(null,b+'<br/><input type=text onfocus="ctrl.enterSubmitBox=this;ctrl.enterSubmitButton=$(\'floatWinPromptSubmit\');" onblur="ctrl.enterSubmitBox=null;ctrl.enterSubmitButton=null;" id=floatWinPromptInput '+(d?'value="'+d+'"':"")+" /><br/>"+(e?'<input type=checkbox id="floatWinPromptCheckbox" '+(f?"checked":"")+' /><label for="floatWinPromptCheckbox">'+e+"</label>":"")+'<input type=button id="floatWinPromptSubmit" onclick="'+
a+'();" value="'+lm.submit+'" /> ',c,!0);$("floatWinPromptInput").select()}
function floatWinConfirmV2(a,b,c,d,e,f,g,k){var l=node("div"),m=node("div");m.style.margin="12px 25px";d&&(d instanceof Element?m.appendChild(d):m.innerHTML=d);l.appendChild(m);d=node("div");l.appendChild(d);m=node("span");m.style.margin="12px 5px 12px 25px";m.id="bFloatWinConfirmOK";m.classList.add("topButtonWhole");m.textContent=f?f:lm.confirm_ok;m.onclick=function(){$("floatingWin").style.display="none";b&&b();k&&inNUI()};d.appendChild(m);f=node("span");f.style.margin="12px 8px 12px 8px";f.id=
"bFloatWinConfirmCancel";f.classList.add("topButtonWhole");f.textContent=g?g:lm.confirm_cancel;f.onclick=function(){$("floatingWin").style.display="none";c&&c();k&&inNUI()};d.appendChild(f);floatWin(a,l,e,!0)}
function floatWinAlert(a,b,c,d,e,f){a||(a="");c||(c=lm.ok);b||(b="floatWinClose();");var g=node("div"),k=node("div",null,"floatWinAlertIconDiv");k.style.color="#3467CB";k.innerHTML=f?f:'<i style="font-size:70px;color:#F1D83B;" class="fas fa-exclamation-triangle"></i>';f=node("div",null,"floatWinAlertContentDiv");var l=node("p",null,"floatWinAlertTextDiv");a instanceof Element?(rm(l),l.appendChild(a)):l.innerHTML=a;a=node("p",null,"floatWinAlertButtonDiv");f.appendChild(l);f.appendChild(a);l=node("div",
"bFloatWinAlertOK","topButtonWholeLarger");l.style.margin="0 15px 0 0";l.innerHTML=c;l.onclick="function"===typeof b?function(){try{b()}catch(m){}floatWinClose()}:function(){try{eval(b)}catch(m){}floatWinClose()};a.appendChild(l);g.appendChild(k);g.appendChild(f);floatWin(e,g,d,!0)}
function dropWinList(a,b,c){a=$("dropWinList");var d=$("dropWinArrow");a.innerHTML="";a.style.display="";a.style.height="fit-content";for(var e={},f=0,g=b.length;f<g;e={$jscomp$loop$prop$opt$600:e.$jscomp$loop$prop$opt$600},f++)e.$jscomp$loop$prop$opt$600=b[f],a.appendChild(h("div",{class:"dropwin-list-item",callback:function(a){return function(b){a.$jscomp$loop$prop$opt$600.callback&&b.addEventListener("pointerdown",function(b){ifRightClick(b)||a.$jscomp$loop$prop$opt$600.callback()})}}(e)},[e.$jscomp$loop$prop$opt$600.icon?
h("i",{class:e.$jscomp$loop$prop$opt$600.icon}):"",e.$jscomp$loop$prop$opt$600.text]));b=0;c&&(d.style.display="",b=d.offsetWidth*Math.SQRT2/2,floatingPanels.push(d));event.clientY+a.offsetHeight+b>document.body.clientHeight&&event.clientY-b>a.offsetHeight?(a.style.top=event.clientY-b-a.offsetHeight+"px",c&&d.attr({left:event.clientX-b,top:event.clientY-b}),c="top"):(a.style.top=event.clientY+b+"px",event.clientY+b+a.offsetHeight>document.body.clientHeight&&(a.style.height=document.body.clientHeight-
event.clientY-30+"px"),c&&d.attr({left:event.clientX-b,top:event.clientY+b}),c="bottom");event.clientX-b+a.offsetWidth>document.body.clientWidth?(a.style.left=event.clientX+b-a.offsetWidth+"px",b="left"):(a.style.left=event.clientX-b+"px",b="right");"right"===b&&"bottom"===c?a.style.borderTopLeftRadius=0:"right"===b&&"top"===c?a.style.borderBottomLeftRadius=0:"left"===b&&"bottom"===c?a.style.borderTopRightRadius=0:"left"===b&&"top"===c&&(a.style.borderBottomRightRadius=0);ctrl.dropWin=!0;floatingPanels.push(a)}
function AutoComplete(a){this.selectedIndex=0;a(this)}
AutoComplete.prototype.complete=function(a,b){a=a.toLowerCase();$("acContainer")&&document.body.removeChild($("acContainer"));var c=node("div","acContainer","acContainer"),d=this.mapping,e=0,f;for(f in d){var g=d[f];if(f.toLowerCase().startsWith(a)){var k=e==this.selectedIndex,l=node("div");l.innerHTML=f;l.setAttribute("mapValue",g);l.setAttribute("atPosition",b);k&&l.classList.add("selectedDiv");l.onclick=function(){mentionAC.replace(a,this.getAttribute("mapValue"),parseInt(this.getAttribute("atPosition")));
mentionAC.selectedIndex=0};c.appendChild(l);e++}}document.body.appendChild(c);floatingPanels.push(c);b=findPos(this.target);d=b[1]+this.target.offsetHeight;e=document.body.clientHeight-12;c.style.top=d+"px";c.style.left=b[0]+"px";c.style.height=d+c.offsetHeight>e?e-d+"px":"auto"};
AutoComplete.prototype.replace=function(a,b,c){var d=this.target.value;b=d.substring(0,c-1)+b+" ";a=d.substring(c+a.length);c=b.length;this.target.value=b+a;mode==UPDATE&&this.ip&&(this.ip.loadValue(b+a),this.ip.render());this.target.select();this.target.selectionStart=c;this.target.selectionEnd=c;$("acContainer")&&document.body.removeChild($("acContainer"))};
function mentionACKey(a){if(mode!==BUILDER&&window.userValid){mentionAC.target=a.target;var b=nui&&nui._curcell()?nui._curcell().ip:null;b&&(mentionAC.ip=b);b=mentionAC.target.value;var c=a.target.selectionStart,d=-1,e="",f=$("acContainer");if(f&&(a.keyCode===KEYCODE.UP||a.keyCode===KEYCODE.DOWN)&&"keydown"===a.type)a.preventDefault(),a.stopPropagation(),a.keyCode===KEYCODE.UP&&(mentionAC.selectedIndex--,0>mentionAC.selectedIndex&&(mentionAC.selectedIndex=0)),a.keyCode===KEYCODE.DOWN&&(mentionAC.selectedIndex++,
mentionAC.selectedIndex>=$("acContainer").children.length&&(mentionAC.selectedIndex=$("acContainer").children.length-1));else if(f&&a.keyCode==KEYCODE.ENTER){$("acContainer").children[mentionAC.selectedIndex].click();mentionAC.selectedIndex=0;a.preventDefault();a.stopPropagation();return}for(a=c;0<a;a--)if(c=b.charAt(a-1),-1==d)if("@"==c){if(d=a,loadUserNames(),window.userNameEmail)for(var g in userNameEmail)mentionAC.mapping[g]="[[@"+g+"]]"}else if("\n"==c)break;else e=c+e;else{" "!=c&&"\n"!=c&&
(d=-1,e="");break}0<=d?mentionAC.complete(e,d):f&&document.body.removeChild($("acContainer"))}}var mentionAC=new AutoComplete(function(a){a.mapping={}});$("hin")&&($("hin").addEventListener("keyup",mentionACKey),$("hin").addEventListener("keydown",mentionACKey));var colNames="0 A B C D E F G H I J K L M N O P Q R S T U V W X Y Z AA AB AC AD AE AF AG AH AI AJ AK AL AM AN AO AP AQ AR AS AT AU AV AW AX AY AZ BA BB BC BD BE BF BG BH BI BJ BK BL BM BN BO BP BQ BR BS BT BU BV BW BX BY BZ CA CB CC CD CE CF CG CH CI CJ CK CL CM CN CO CP CQ CR CS CT CU CV CW CX CY CZ DA DB DC DD DE DF DG DH DI DJ DK DL DM DN DO DP DQ DR DS DT DU DV DW DX DY DZ EA EB EC ED EE EF EG EH EI EJ EK EL EM EN EO EP EQ ER ES ET EU EV EW EX EY EZ FA FB FC FD FE FF FG FH FI FJ FK FL FM FN FO FP FQ FR FS FT FU FV FW FX FY FZ GA GB GC GD GE GF GG GH GI GJ GK GL GM GN GO GP GQ GR GS GT GU GV GW GX GY GZ HA HB HC HD HE HF HG HH HI HJ HK HL HM HN HO HP HQ HR HS HT HU HV HW HX HY HZ IA IB IC ID IE IF IG IH II IJ IK IL IM IN IO IP IQ IR IS IT IU IV IW IX IY IZ JA JB JC JD JE JF JG JH JI JJ JK JL JM JN JO JP JQ JR JS JT JU JV JW JX JY JZ KA KB KC KD KE KF KG KH KI KJ KK KL KM KN KO KP KQ KR KS KT KU KV KW KX KY KZ LA LB LC LD LE LF LG LH LI LJ LK LL LM LN LO LP LQ LR LS LT LU LV LW LX LY LZ MA MB MC MD ME MF MG MH MI MJ MK ML MM MN MO MP MQ MR MS MT MU MV MW MX MY MZ NA NB NC ND NE NF NG NH NI NJ NK NL NM NN NO NP NQ NR NS NT NU NV NW NX NY NZ OA OB OC OD OE OF OG OH OI OJ OK OL OM ON OO OP OQ OR OS OT OU OV OW OX OY OZ".split(" ");
function NUI(){this.fcol=this.frow=-1;this.focusChanged=[];this.multiFocus=null;this.currentIncrement=0;this.highCellRows=[];ctrl.lazyRendering?(this.main=node("div",null,"nui"),this.main.style.position="relative"):this.main=node("div",null,"nui");this.main_outer=$("nui_outer");this.main.onmousedown=nuiMouseDown;this.focus=$("focus");this.focusDot=$("focusDot")}
NUI.prototype._updateCol1Width=function(){mode==BUILDER&&(1800<ctrl.mainScrollTop?$("_0_0").style.width=ctrl.col1Width+11+"px":$("_0_0").style.width=ctrl.col1Width+"px")};
NUI.prototype.init=function(a,b){builderCellTopPos=null;nui._updateFocus();rm($("dcelldiv"));ctrl.lazyRendering?this.lazyInit(a,b):(ctrl.isIE||rm(this.main),this.main.innerHTML=getDefaultNUIString(a,b),a=getNUIPageHeader(),this.main.prepend(a),this.nuiPageHeader=a,a=this.main.childNodes[1],this.main.nuicelltable=a,a.onmousedown=cellMouseDown,a.onmouseover=cellMouseover,a.onmouseout=cellMouseout,a.ondblclick=cellDblclick,simulateMouseClickOnMobile(a,nuiTableTouchSimulatedMouseClick,cellTouchSimulatedContextMenu));
this.highCellRows=[];this.main.style.width=ctrl.nuiNormSize+"px";this.main.style.height=this.main_outer.offsetHeight-21+"px";ctrl.lazyRendering?(this.main.onscroll=scrollIncrement,this.main.onscroll=scrollIncrement):(this.main.onscroll=scrollIncrement,this.main_outer.onscroll=scrollIncrement);browse.lastFocus=null};function hinOnScroll(a){a||(a=window.event);a=parseInt(a.wheelDelta||-1*a.detail);nui.main.scrollTop-=.33*a}
function scrollIncrement(){ctrl.scrollingTimeout?(clearTimeout(ctrl.scrollingTimeout),5<ctrl.scrollingSkipTick&&(scrollComplete(),ctrl.scrollingSkipTick=1),ctrl.scrollingSkipTick++):ctrl.scrollingSkipTick=1;ctrl.scrollingTimeout=setTimeout(scrollComplete,50);ctrl.dropWin=!1;ctrl.dropWinScrollLock||clearDropWin();mvpMode||(ctrl.mainScrollTop=nui.main.scrollTop,ctrl.mainScrollLeft=nui.main.scrollLeft);updateEditIconLoc();updateListingPageAddRowButton();nui._updateFocus(null,null,null,null,!0);nui._updateDelIcon();
ctrl.isIE&&nui._updateStickyHeader();nui._updateCol1Width();builderCellLeftPos=builderCellTopPos=null;ctrl.scrollTimer=null}
function getNUIPageHeader(){var a=node("div");a.id="nuiPageHeaderDiv";a.className="nuiPageHeaderDiv";var b=DebugToolObj.ifShowDomainId()?'<div style="position: absolute;top:10px;left:20px" class="debug_showId">'+biffdata.rootDomainId+"</div>":"";a.innerHTML='<div class="nuiPageHeader_sheetName" id="nuiPageHeader_sheetName" >'+(biffdata&&biffdata.displaySheetName?biffdata.displaySheetName:"")+'</div><div class="nuiPageHeader_sheetDesc" id="nuiPageHeader_sheetDesc">'+(biffdata&&biffdata.formDesc?biffdata.formDesc:
"")+"</div>"+b;return a}
function getDefaultNUIString(a,b){var c=[];mode!==UPDATE&&mode!==BROWSE||!biffdata||biffdata.ifListingPage()||(a=200>a?a+5:a+50);a=a?a:ctrl.NUIRowNum;b=b?b:mode==BROWSE?ctrl.NUIColNumBrowse:ctrl.NUIColNum;var d;nui.maxX=b;nui.maxY=a;c.push('<table id="nuicelltable" style="width:100%;">');for(var e=0;e<=a;e++){var f=mode==BUILDER?builder:biffdata;if(f.ifStartFirstSection(e)){var g="";for(d=0;d<f.sections.sections.length;d++){var k=f.sections.sections[d],l=k.display,m=d===f.sections.sections.length-1;
g+='<li id="nuiSectionTab'+d+'" class="'+(l?"nuiSectionTabOn":"nuiSectionTab")+'" '+(l?"":'onclick="nui.openSection('+d+');" ')+(mode==BUILDER?'ondblclick="nuiSectionRename('+d+');" ':"")+">"+k.name+(mode==BUILDER&&m?' <i class="fa fa-times" style="color:#888;cursor:pointer;margin:0 0 0 8px;" onclick="nuiSectionDelete('+d+')"></i>':"")+"</li>"}mode==BUILDER&&(g+='<li style="cursor:pointer;display:inline-block;margin:0 0 0 15px;" onclick="nuiSectionCreatePrompt();"><i class="fa fa-plus"></i></li>');
g+='<li style="display:block;width:100%;border-bottom:1px solid #888;"></li>';c.push('<tr id="nuiSectionTabContainer" style="height:45px;"><td style="background:none;padding:0;"><div style="margin-right:1px;background: #f8f8f8;width:44px;height:45px;"></div></td><td colspan="'+b+'" style="vertical-align: bottom;background:#f8f8f8;border-bottom:0;overflow:visible;">'+g+"</td></tr>")}f.ifRenderRow(e)?(f.getEndOfLastSection()===e-1&&c.push('<tr id="nuiSectionTabContainerBottomLine"><td></td><td colspan="'+
b+'" style="padding: 0;"><div style="width:100%;padding: 0;border-bottom: 1px solid #888;"></div></td></tr>'),c.push("<tr>")):c.push('<tr style="display:none;">');d=g="";k=-1!==f.getSectionIndex(e);f.isSectionEnd(e);for(f=0;f<=b;f++)c.push("<td id='_"+f+"_"+e+"' data-x='"+f+"' data-y='"+e+"'"),l="",0==f&&0==e?c.push('class="sideCell" style="width:'+ctrl.col1Width+'px;" '):0==f&&0<e?(mode===BUILDER?(l=e,c.push('style="height:26px;width:10px;padding:0;'+(k?"border-right:1px solid #888;border-bottom:0;border-top:0;":
"border-bottom:1px solid #efefef;")+'" ')):c.push('style="height:26px;'+(k?"border-right:1px solid #888;border-bottom:0;border-top:0;":"")+'" '),c.push('class="sideCellLeft" onmouseover="dvcellMouseover(this);" ')):0==e&&0<f?(mode===BUILDER&&(l=f>=colNames.length?colNames[Math.floor(f/26)]+colNames[f%26]:colNames[f],c.push('style="border-right:1px solid #efefef;" '),g='<span class="arrowUnhide left" onmousedown="unhideColumn(this, false)" onmouseout="hideTinyTooltip();"><i class="fa fa-caret-left"></i></span>',
d='<span class="arrowUnhide right" onmousedown="unhideColumn(this, true)" onmouseout="hideTinyTooltip();"><i class="fa fa-caret-right"></i></span>'),c.push('class="sideCell" '+(mode===BUILDER?'onmouseover="dhcellMouseover(this);':"")+'" ')):mode===BUILDER?c.push('class="'+BUILDER_EMPTY_CLASS+'" '):1==f&&1==e&&c.push(' style="border-radius:6px 0 0 0;"'),c.push(">"+d+l+g+"</td>");c.push("</tr>")}c.push("</table>");return c.join("")}
NUI.prototype.setScrolling=function(a){if(!ifMobile){var b=this.main,c=this.main_outer,d=findPos(a),e=d[0];d=d[1];var f=findPos(c),g=f[0];f=f[1];var k=c.offsetHeight,l=document.body.clientWidth;30>e-g-b.scrollLeft-c.scrollLeft?b.scrollLeft=e-g-30-c.scrollLeft:e-b.scrollLeft-c.scrollLeft+a.offsetWidth+30>l&&(b.scrollLeft=e-l-c.scrollLeft+a.offsetWidth+30);d+50>k+b.scrollTop+f?b.scrollTop=d+50-k-f:d-b.scrollTop<f+100&&(b.scrollTop=d-f-100)}};
NUI.prototype._focus=function(a,b,c,d){if(!ctrl.focusLock){var e=this._getcell(a,b);if(e&&e.ip&&e.ip.biff||!biffdata.findFree(a,b)){var f=e&&e.classList.contains("table")&&e.classList.contains("header");e=e&&(e.classList.contains("noFocus")||e.classList.contains("hide"));if(!f&&!e)if(this.multiFocus=null,a=parseInt(a),b=parseInt(b),f=a==this.fcol&&b==this.frow,a&&b){e=null;if(!c&&(this._blur(!0),mode===UPDATE&&this._curcell()&&this._curcell().ip)){c=this._curcell().ip.biff;var g=this._getcell(a,b);
g&&g.ip&&(e=g.ip.biff);c&&e&&(!biffdata.ifSubtableDataBiff(c)||biffdata.isSameSubtable(c,e)&&this.frow===b||updateSameSubtableRowBiffsFormulaEngine(c,!0))}c=this.focus;if(e=this._getcell(a,b)){rm(c);c.cell=e;this.fcol=a;this.frow=b;e.ip?(c.onclick=focusClick,c.ondblclick=focusDblClick,e.ip.focus()):c.onclick=null;if(mode===BUILDER){builder.cellData[a+","+b]?saveBuilderMode(BUILDER_FIELDS):builder.freeData[a+","+b]?saveBuilderMode(BUILDER_TEXT):saveBuilderMode();if(builder.mode==BUILDER_FIELDS){g=
nui._getcellV2(a-1,b);var k=nui._getcellV2(a+1,b);if(e.classList.contains("builderFocusRight")||e.classList.contains("builderFocusRightSingle")||e.classList.contains("builderFieldWhite")||e.classList.contains("builderFieldWhiteSingle")){var l=nui._getcellV2(a-2,b);if(!(!g.builderField||l&&l.builderField||k&&(!k||k.builderField))&&(g=builder.getFirstField(),!g||g.x!=a-1||g.y!=b||builder.createAsListingPage)){k=!0;for(g=1;g<=ctrl.TABLE_DEF_ROWS;g++){l=nui._getcellV2(a,b+g);var m=nui._getcellV2(a-1,
b+g);if(!l||!l.classList.contains(BUILDER_EMPTY_CLASS)||builder.freeData[a+","+(b+g)]||builder.cellData[a+","+(b+g)]||"none"==l.style.display)k=!1;if(!m||!m.classList.contains(BUILDER_EMPTY_CLASS)||builder.freeData[a-1+","+(b+g)]||builder.cellData[a-1+","+(b+g)]||"none"==m.style.display)k=!1}if(k)for(e.oldClassName=e.className,e.className="builderFocus",e.style.color="#cccccc",this.focusChanged.push(e),g=1;g<=ctrl.TABLE_DEF_ROWS;g++)l=nui._getcell(a,b+g),m=nui._getcell(a-1,b+g),l.oldClassName=l.className,
l.className="builderFocusRight",m.oldClassName=m.className,m.className="builderFocusRight",this.focusChanged.push(l),this.focusChanged.push(m)}}else if(g&&g.builderField&&(k&&!k.builderField||!k)){k=!0;for(g=1;g<=ctrl.TABLE_DEF_ROWS;g++)if((l=nui._getcell(a,b+g))&&!l.classList.contains(BUILDER_EMPTY_CLASS)){k=!1;break}e.builderField&&(k=!0);if(k)for(e.oldClassName=e.className,e.className="builderFocus",this.focusChanged.push(e),g=1;g<=ctrl.TABLE_DEF_ROWS;g++)if(l=nui._getcell(a,b+g))l.oldClassName=
l.className,l.className="builderFocusRight",this.focusChanged.push(l)}else!k||k.builderField||k.builderFreeField||k.classList.contains("builderFocusRight")||k.classList.contains("builderFieldWhite")||builder.ifListingPage()||builder.createAsListingPage&&!builder.onlyOneField()||-1!=e.className.indexOf("builderFocus")||(e.oldClassName=e.className,e.className="builderFocus",k.oldClassName=k.className,k.className="builderFocusRightSingle",this.focusChanged.push(e),this.focusChanged.push(k))}doSideCellColoring();
builder.cellData[a+","+b]?(builderHelperPanelSwitch(2),setPropertyTable(e),setStylePane(builder.cellData[a+","+b]),ctrl.currentTabContainer&&ctrl.currentTabContent&&openTab($(ctrl.currentTabContainer),$(ctrl.currentTabContent),$("propSel"),$("propSpace"))):e.classList.contains("builderFieldWhiteSingle")&&builder.cellData[a-1+","+b]&&d?nui._move(-1,0):e.classList.contains("builderFieldWhite")&&d?builder.cellData[a+","+(b-1)]?nui._move(0,-1):builder.cellData[a+","+(b-2)]?nui._move(0,-2):builder.cellData[a+
","+(b-3)]&&nui._move(0,-3):builder.freeData[a+","+b]?(builderHelperPanelSwitch(2),setStylePane(builder.freeData[a+","+b])):($("prop").innerHTML='<div style="margin:50px;">No Field Selected.</div>',builderHelperPanelSwitch(1))}d||f||this.setScrolling(this._getcell(a,b));this._updateFocus();d=$("hin");e.ip?(e.ip.type===SELECTOR||e.ip.type===MSELECTOR?(f=e.ip.userInput?e.ip.userInput:"",-1!=f.indexOf("<br/>")&&(f=f.replaceAll("<br/>","\n")),d.value=f,d.oldValue=f):(f=!1,e.ip.biff.hasAttribute("masked")&&
e.ip.biff.hasOwnProperty("unmasked")&&(!0!==e.ip.biff.attr.masked&&"true"!==e.ip.biff.attr.masked||!0!==e.ip.biff.unmasked&&"true"!==e.ip.biff.unmasked||(f=!0)),f?(d.value=e.ip.biff.value,d.oldValue=e.ip.biff.value):(d.value=e.ip.value,d.oldValue=e.ip.value)),mode!==BUILDER&&e.ip.biff&&e.ip.biff.attr&&e.ip.biff.attr.phone&&e.ip.biff.attr.phonefmt&&(d.value=ragic_phone_reformat(d.value,e.ip.biff.attr.phonefmt))):d.value="";d.hinFocus=!1;(e.ip||mode===BUILDER)&&hinFocus();canSaveData()&&biffdata.fs&&
0<parseInt(biffdata.fs)&&(biffdata.keyField?biffdata.subtableKeyFields&&0<biffdata.subtableKeyFields.length&&(showSubtableRowDelete(a,b),nui._updateDelIcon()):(showSubtableRowDelete(a,b),nui._updateDelIcon()));biffdata.updateCellIndex=indexOf("_"+a+"_"+b,biffdata.updateCellIds);mode!==BUILDER&&(!e.ip||e.ip.IPType!==UPLOADER&&e.ip.IPType!==GRAPHICS?(c.removeEventListener("dragenter",dragFileIn,!0),c.removeEventListener("dragover",dragFileIn,!0),c.removeEventListener("dragleave",dragFileOut,!0),c.removeEventListener("drop",
dropFileFunc,!0)):(c.removeEventListener("dragenter",dragFileIn,!0),c.removeEventListener("dragover",dragFileIn,!0),c.removeEventListener("dragleave",dragFileOut,!0),c.removeEventListener("drop",dropFileFunc,!0),c.addEventListener("dragenter",dragFileIn,!0),c.addEventListener("dragover",dragFileIn,!0),c.addEventListener("dragleave",dragFileOut,!0),dropFileFunc=dropFile.bind(e.ip),c.addEventListener("drop",dropFileFunc,!0)));return!0}}else 0<ctrl.multiSelected.length||(this._blur(),this.fcol=this.frow=
-1,this._updateFocus())}}};function doSideCellColoring(){var a=nui.fcol,b=nui.frow;uncolorSideCell();var c=nui._curcell(),d=1;c&&(d=c.colSpan);d||(d=1);var e=builder.absolutePositions[a+","+b];c=a;e&&(c=parseInt(e.split(",")[0]));isNaN(c)&&(c=a);for(e=0;e<d;e++)colorSideCellH(c+e,b);colorSideCellV(a,b)}
function colorSideCellH(a,b){var c=$("v6TabHR");c=c&&c.style.backgroundColor?c.style.backgroundColor:"#bbbbbb";var d=nui._getcell(a,0);a=$("shh_"+a);d&&(d.setAttribute("prevbackgroundColor",d.style.backgroundColor),d.setAttribute("prevborderBottom",d.style.borderBottom),d.style.backgroundColor="#e8e8e8",1<b&&(d.style.borderBottom="2px solid "+c),a&&(a.style.backgroundColor="#e8e8e8",a.style.borderBottom="2px solid "+c,ctrl.lastSHCell.push(a)),ctrl.lastHCell.push(d))}
function colorSideCellV(a,b){var c=$("v6TabHR");c=c&&c.style.backgroundColor?c.style.backgroundColor:"#bbbbbb";var d=nui._getcell(0,b);b=$("shv_"+b);d&&(d.setAttribute("prevbackgroundColor",d.style.backgroundColor),d.setAttribute("prevborderRight",d.style.borderRight),d.style.backgroundColor="#e8e8e8",1<a&&(d.style.borderRight="2px solid "+c),b&&(b.style.backgroundColor="#e8e8e8",b.style.borderRight="4px solid "+c,ctrl.lastSVCell.push(b)),ctrl.lastVCell.push(d))}
function uncolorSideCell(){var a;for(a=0;a<ctrl.lastHCell.length;a++)ctrl.lastHCell[a].style.backgroundColor=ctrl.lastHCell[a].getAttribute("prevbackgroundColor"),ctrl.lastHCell[a].style.borderBottom=ctrl.lastHCell[a].getAttribute("prevborderBottom");for(a=0;a<ctrl.lastVCell.length;a++)ctrl.lastVCell[a].style.backgroundColor=ctrl.lastVCell[a].getAttribute("prevbackgroundColor"),ctrl.lastVCell[a].style.borderRight=ctrl.lastVCell[a].getAttribute("prevborderRight");for(a=0;a<ctrl.lastSHCell.length;a++)ctrl.lastHCell[a].style.backgroundColor=
ctrl.lastHCell[a].getAttribute("prevbackgroundColor"),ctrl.lastHCell[a].style.borderBottom=ctrl.lastHCell[a].getAttribute("prevborderBottom");for(a=0;a<ctrl.lastSVCell.length;a++)ctrl.lastVCell[a].style.backgroundColor=ctrl.lastVCell[a].getAttribute("prevbackgroundColor"),ctrl.lastVCell[a].style.borderRight=ctrl.lastVCell[a].getAttribute("prevborderRight");ctrl.lastHCell=[];ctrl.lastVCell=[];ctrl.lastSHCell=[];ctrl.lastSVCell=[]}
function showSubtableRowDelete(a,b){if(!biffdata.autoSave||mode!==BROWSE||checkIfUserCanEdit(!0)){var c=biffdata.getDataRoot(a,b,!0);c&&((a=(a=nui._getcell(a,b))&&a.ip&&a.ip.biff)&&biffdata.findSameSubtableRowDataBiffs(a).every(function(a){return a.attr?"true"===a.attr.hide||"true"===a.attr.ro||a.ip&&a.ip.readOnly:!1})?c.noRowDelete=!0:(delete c.noRowDelete,c=nui._getcell(c.x,c.y),c=findPos(c),a=$("delIcon"),a||(a=node("img"),a.id="delIcon",a.src=lm.cdn+"/sims/img/delete.png",a.style.cursor="pointer",
a.style.position="absolute",a.style.zIndex=10,document.body.appendChild(a)),a.style.display="block",a.style.top=c[1]+5+"px",a.style.left=c[0]-15+"px",a.onclick=delSubtableRow))}}
NUI.prototype._blur=function(a){var b=this._curcell();if(!b)return!1;b.ip&&(b.classList.contains("builderFocusRight")||b.classList.contains("builderFocusRightSingle"))&&(b.ip=null);a=!1;b.ip&&(a=b.ip.blur(),biffdata.autoSave&&a&&autoSaveInterval(300));if(mode==BUILDER){var c=builder.cellData[nui.fcol+","+nui.frow];if(b.ip&&""==b.ip.value&&c&&!c.hasAttribute("interm")&&(doDeleteCheck(c),c.noDelete))return c.value=c.originalValue,b.ip.loadValue(c.originalValue),c.noDelete=!1;if((c=b.ip)&&c.type==TYPER&&
a){c.changed=!1;if(!builder.setContent(nui.fcol,nui.frow,c.value?c.value:""))return!1;a=!0;c=this._getcell(this.fcol-1,this.frow);var d=this._getcell(this.fcol+1,this.frow);if(""==b.ip.value){if(c&&c.builderField&&d&&d.builderField){try{var e=parseInt(builder.absolutePositions[this.fcol+","+this.frow].split(",")[0])}catch(f){e=this.fcol}shiftData(e,-1,!0,this.frow);builder.renderAll();builder.syncCurrentCellData()}c&&c.ip&&c.ip.biff&&(c.ip.biff.unrender(),c.ip.biff.render());this._setFocusColorBack(!0);
delete b.ip}else builder.mode==BUILDER_FIELDS&&(builder.ifKey(this.fcol,this.frow),setBorderClass(b,null),this.focusChanged=[]);c&&c.builderField&&builder.cellData[this.fcol-1+","+this.frow]&&builder.cellData[this.fcol-1+","+this.frow].render()}else this._setFocusColorBack();ctrl.isIE&&builder.renderAll();builder.renderAllWidgets();if(e=ctrl.highlightedCellPos)if(b=e[this.fcol+","+this.frow])b.forEach(function(a){var b=nui._getcell(a[0],a[1]);a=builder.cellData[a[0]+","+a[1]];if(b&&a){b.style.border=
"";for(var c in a.styling)c.startsWith("border")&&(b.style[c]=a.styling[c])}}),delete e[this.fcol+","+this.frow];ctrl.highlightCallback&&ctrl.highlightCallback();ctrl.highlightCallback=null}hinBlur();return a};NUI.prototype._updateStickyHeader=function(){mvpMode||(mode===BUILDER?(this._updateStickyHeaderBuilder(),this._updateStickyHeaderLeftBuilder(),doSideCellColoring()):biffdata.ifListingPage()&&this._updateStickyHeaderBrowse())};
NUI.prototype._updateStickyHeaderBuilder=function(){var a=this.main.scrollLeft,b=this.main_outer.scrollLeft,c=findPos(nui._getcell(1,0)),d=findPos($("nui_outer")),e=c[1]-this.main.scrollTop<d[1];ctrl.lastScrollXPos&&ctrl.lastScrollXPos!=a&&$("stickyHeaderBuilder")&&document.body.removeChild($("stickyHeaderBuilder"));if(!$("stickyHeaderBuilder")&&e){var f=node("table");f.id="stickyHeaderBuilder";f.className="stickyHeader";for(var g=f.insertRow(-1),k=1,l=0;nui._getcell(k,0);){var m=g.insertCell(-1),
n=nui._getcell(k,0),q=n.getBoundingClientRect().width;0>q&&(q=0);m.id="shh_"+k;m.style.width=q+"px";m.innerHTML=n.innerHTML;m.style.background="#F5F5F5";m.style.height=n.clientHeight+"px";m.style.overflow=n.style.overflow;m.style.overflowX=n.style.overflowX;m.style.textAlign="center";m.style.boxSizing="border-box";l<a&&(m.style.background="transparent",m.style.borderBottom="none",m.style.visibility="hidden",rm(m));l+=q;k++}f.style.top=d[1]+"px";f.style.left=c[0]-a-b+"px";f.style.pointerEvents="none";
document.body.appendChild(f)}$("stickyHeaderBuilder")&&(e?($("stickyHeaderBuilder").style.width=l+"px",$("stickyHeaderBuilder").style.display=""):$("stickyHeaderBuilder").style.display="none",ctrl.lastScrollXPos=a)};
NUI.prototype._updateStickyHeaderLeftBuilder=function(){var a=this.main.scrollTop,b=findPos(nui._getcell(0,1)),c=findPos($("nui_outer")),d=b[0]-this.main.scrollLeft-this.main_outer.scrollLeft<c[0];ctrl.lastScrollYPos&&ctrl.lastScrollYPos!=a&&$("stickyHeaderLeftBuilder")&&document.body.removeChild($("stickyHeaderLeftBuilder"));if(!$("stickyHeaderLeftBuilder")&&d){var e=node("table");e.id="stickyHeaderLeftBuilder";e.className="stickyHeader";for(var f=1,g=0;nui._getcell(0,f);){var k=e.insertRow(-1).insertCell(-1),
l=nui._getcell(0,f),m=l.getBoundingClientRect().height;k.id="shv_"+f;k.style.height=m+"px";k.innerHTML=l.innerHTML;k.style.background="#F5F5F5";k.style.width=l.clientWidth+"px";k.style.overflow=l.style.overflow;k.style.overflowY=l.style.overflowY;k.style.textAlign="center";k.style.lineHeight=l.style.lineHeight;g<a-this.nuiPageHeader.offsetHeight-this._getcell(1,0).offsetHeight&&(k.style.background="transparent",k.style.borderBottom="none",k.style.visibility="hidden",rm(k));g+=m;f++}e.style.left=c[0]+
"px";e.style.top=b[1]-a+"px";document.body.appendChild(e)}$("stickyHeaderLeftBuilder")&&(d?($("stickyHeaderLeftBuilder").style.height=g+"px",$("stickyHeaderLeftBuilder").style.display=""):$("stickyHeaderLeftBuilder").style.display="none",ctrl.lastScrollYPos=a)};
NUI.prototype._updateStickyHeaderBrowse=function(){for(var a,b=0;b<biffdata.biffs.length;b++){var c=biffdata.biffs[b];if(c.dataType==HEADER){var d=this._getcell(c.x,c.y);a||(a=d);break}}if(a&&$("nui_outer")){var e=this.main.scrollLeft;a=findPos(a);var f=findPos($("nui_outer")),g=a[1]-this.main.scrollTop<f[1];ctrl.lastScrollXPos&&ctrl.lastScrollXPos!=e&&$("stickyHeader")&&document.body.removeChild($("stickyHeader"));if(!$("stickyHeader")&&g){var k=node("table");k.id="stickyHeader";k.className="stickyHeader";
var l=k.insertRow(-1),m=0;for(b=0;b<biffdata.biffs.length;b++)if(c=biffdata.biffs[b],c.dataType==HEADER){var n=l.insertCell(-1);d=this._getcell(c.x,c.y);var q=Math.max(2,d.offsetWidth);m+=q;n.style.width=q+"px";if(3<q){n.innerHTML=d.innerHTML;n.className=d.className;n.style.padding=d.style.padding;n.style.borderBottom="2px solid #999";d.style.fontWeight&&(n.style.fontWeight=d.style.fontWeight);d.style.color&&(n.style.color=d.style.color);n.style.backgroundColor=d.style.backgroundColor||"#F5F5F5";
n.showFilterPanel=showFilterPanel;n.biff=c;n.domainId=c.domainId;c=n.getElementsByTagName("i")[0];if(!c)break;c.id="sticky"+c.id;c.poscell=n;c.onclick=function(a){a||(a=window.event);this.poscell.showFilterPanel();a&&(a.cancelBubble=!0)};if(c=n.querySelector(".nuiSortingArrow")){if(!r){var r=[];0<biffdata.orderDomain.length&&r.push([biffdata.orderDomain[0],biffdata.orderDir[0]]);q=biffdata.additionalInfo&&biffdata.additionalInfo.secondarySortDomainIds&&biffdata.additionalInfo.secondarySortDomainIds.split(",")||
[];for(var p=biffdata.additionalInfo&&biffdata.additionalInfo.secondarySortDirections&&biffdata.additionalInfo.secondarySortDirections.split(",")||[],t=0;t<q.length;t++)r.push([q[t],p[t]]);r=r.map(function(a){return[Number(a[0]),Number(a[1])]})}c.cell=n;c.onclick=function(){var a=r.find(function(a){return a[0]==this.cell.domainId}.bind(this));if(a){var b=r.indexOf(a);if(0===b)applySort(a[0],[2,1][a[1]-1]);else if(0<b){b=r.map(function(a){return a[0]});var c=r.map(function(a){return a[1]});applySecondarySort(b,
c,a[0],[2,1][a[1]-1])}}}}if(c=n.querySelector(".filterPanelButton"))c.onmouseover=function(a){a.target.closest(".nuiCell").classList.add("filterPanelButtonIsHover")},c.onmouseout=function(a){a.target.closest(".nuiCell").classList.remove("filterPanelButtonIsHover")}}m<e&&(n.style.background="transparent",n.style.borderBottom="none",rm(n));n.style.height=d.clientHeight+"px";n.style.overflow=d.style.overflow;n.style.overflowX=d.style.overflowX;n.style.textAlign=d.style.textAlign}k.style.top=f[1]+"px";
k.style.left=a[0]-e+"px";k.style.width=m+"px";document.body.appendChild(k)}$("stickyHeader")&&(g?$("stickyHeader").style.display="":$("stickyHeader").style.display="none",ctrl.lastScrollXPos=e)}};
NUI.prototype.freezeX=function(a){var b=this.main.nuicelltable;a=Array.from({length:Math.min(a,b.rows[0].cells.length)}).map(function(a,c){return b.rows[0].cells[c].getBoundingClientRect().width}).reduce(function(a,b,c){0===c?a.push(b):a.push(b+a[c-1]);return a},[]);a.unshift(0);a.pop();for(var c=0,d=b.rows.length;c<d;c++){var e=b.rows[c];if("nuiSectionTabContainer"===e.id||"nuiSectionTabContainerBottomLine"===e.id)e=e.cells[0],e.classList.contains("sticky")||e.classList.add("sticky"),e.style.left=
"0px";else for(var f=0,g=a.length;f<g;f++){var k=e.cells[f];k&&(k.classList.contains("sticky")||k.classList.add("sticky"),k.style.zIndex&&!k.style.left?k.style.zIndex=64:k.style.zIndex||(k.querySelector("img")?k.style.zIndex=63:k.style.zIndex=61),k.style.left=a[f]+"px")}}};
NUI.prototype.freezeY=function(a){biffdata.hasSections()&&a>=biffdata.sections.start&&a++;var b=this.main.nuicelltable;a=Array.from({length:Math.min(a,b.rows.length)}).map(function(a,c){return b.rows[c].getBoundingClientRect().height}).reduce(function(a,b,c){0===c?a.push(b):a.push(b+a[c-1]);return a},[]);a.unshift(0);a.pop();for(var c=0,d=a.length;c<d;c++)for(var e=a[c],f=b.rows[c],g=0,k=f.cells.length;g<k;g++){var l=f.cells[g];l&&(l.classList.contains("sticky")||l.classList.add("sticky"),l.style.zIndex&&
!l.style.top?l.style.zIndex=64:l.style.zIndex||(l.querySelector("img")?l.style.zIndex=63:l.style.zIndex=62),l.style.top=e+"px")}};NUI.prototype._getCellFromAbsoluteCoor=function(a,b){a=getRelativeCoor(a,b);return this._getcell(a[0],a[1])};function getFocusTopBound(a,b,c,d){return ctrl.relTopOffset?ctrl.relTopOffset:146}function getFocusLeftBound(a,b,c,d){return $("nui_outer").offsetLeft}
NUI.prototype._updateFocus=function(a,b,c,d,e){if(a||0===a||0===c)this.multiFocus=[a,b,c,d];this.multiFocus?this.focus.classList.add("focusColored"):this.focus.classList.remove("focusColored");var f=this._getcell(this.fcol,this.frow);if(f||this.multiFocus){var g=findDimV2(this.multiFocus);if(g){var k=getFocusTopBound(a,b,c,d);a=getFocusLeftBound(a,b,c,d);b=this.focus;c=b.style;d=$("focusDot");var l=$("bbcodeImageEdit"),m=g[0],n=g[1],q=ctrl.mainScrollTop>g[3]-k&&ctrl.mainScrollTop<=g[3]-k+n,r=ctrl.mainScrollTop+
n>g[3]-k&&g[3]-ctrl.mainScrollTop<=k+n&&g[3]+n-ctrl.mainScrollTop>k+ctrl.nui_outer_height,p=g[3]-ctrl.mainScrollTop>ctrl.nui_outer_height+k-5,t=g[2]<a&&g[2]+m>=a,v=g[2]+m<a;ctrl.mainScrollTop>g[3]-k+n||v||p?(c.display="none",d.style.display="none",l.style.display="none",hideEditElements()):(c.display="",d.style.display="",l.style.display="none",t?(p=a-g[2],c.width=m-p+"px",c.left=a+ctrl.focusLeft+"px"):(c.width=m+ctrl.focusWidth+"px",c.left=g[2]+ctrl.focusLeft+"px"),d.style.left=parseInt(noUnit(b.style.left))+
b.clientWidth+"px",q&&r?(c.height=n-(ctrl.mainScrollTop-(g[3]-k))-(g[3]-ctrl.mainScrollTop+n-(k+ctrl.nui_outer_height))-5+"px",c.top=k+ctrl.focusTop+"px"):q?(p=ctrl.mainScrollTop-(g[3]-k),c.height=n-p+"px",c.top=k+ctrl.focusTop+"px"):(r?(p=g[3]-ctrl.mainScrollTop+n-(k+ctrl.nui_outer_height-5),c.height=n-p+"px"):c.height=n+ctrl.focusHeight+"px",c.top=g[3]-ctrl.mainScrollTop+ctrl.focusTop+"px"),d.style.top=parseInt(noUnit(b.style.top))+b.clientHeight+"px",(b.cell=f)&&f.classList.contains("sticky")?
b.style.zIndex=70:b.style.zIndex="",f&&(mode===BUILDER&&f.bbcodeImage&&(l.style.display="block",l.style.left=parseInt(noUnit(d.style.left))+7+"px",l.style.top=c.top),f.ip&&(f.ip.biff&&f.ip.biff.hasAttribute("masked")&&f.ip.biff.hasOwnProperty("unmasked")&&(e=(!0===f.ip.biff.attr.masked||"true"===f.ip.biff.attr.masked)&&(!0===f.ip.biff.unmasked||"true"===f.ip.biff.unmasked)),e?(e=$("hin"),g=$("focus"),e.style.top=g.offsetTop+"px",f.ip._setHinSize&&f.ip._setHinSize(f,e)):("M"===f.ip.type&&!0===f.ip.typing&&
f.ip._renderFocus(nui.focus),f.ip.render(),ctrl.outOfNUI||hinFocus()))))}}else this.focus.style.display="none",this.focus.style.pointerEvents=null,$("focusDot").style.display="none",$("bbcodeImageEdit").style.display="none"};
function findDimV2(a){if(!a){var b=nui._getcell(nui.fcol,nui.frow);if(!b)return null;var c=findPos(b);return[b.offsetWidth,b.offsetHeight,c[0]-nui.main_outer.scrollLeft-nui.main.scrollLeft,c[1]]}b=parseInt(a[0]);c=parseInt(a[1]);var d=parseInt(a[2]),e=parseInt(a[3]);if(b!==c||d!==e){a=getAbsoluteCoorFromId(b,d);var f=getAbsoluteCoorFromId(c,e),g=nui._getCellFromAbsoluteCoor(a[0],a[1]),k=nui._getCellFromAbsoluteCoor(f[0],f[1]);d===e?(b>c?(b=f[0]-parseInt(k.colSpan)+1,c=a[0]):(b=a[0]-parseInt(g.colSpan)+
1,c=f[0]),a=d,d=e):(b=Math.min(f[0]-parseInt(k.colSpan)+1,a[0]-parseInt(g.colSpan)+1),c=Math.max(f[0],a[0]),d>e?a=e:(a=d,d=e));e=nui._getCellFromAbsoluteCoor(b,a);g=nui._getCellFromAbsoluteCoor(c,d);k=findPos(e);var l=findPos(g);e=k[0];f=l[0]+g.offsetWidth;k=k[1];g=l[1]+g.offsetHeight;f-=nui.main.scrollLeft;e-=nui.main.scrollLeft;l=nui.main.parentNode.querySelectorAll(".nui");2===l.length&&(biffdata.ifListingPage()?(e-=l[1].offsetWidth,f-=l[1].offsetWidth):(e-=l[0].offsetWidth,f-=l[0].offsetWidth));
ctrl.multiSelectAbsCoor=[b,c,a,d];return[Math.abs(f-e),Math.abs(g-k),e,k]}}
function findDim(a){if(!a){var b=nui._getcell(nui.fcol,nui.frow);if(!b)return null;var c=findPos(b);return[b.offsetWidth,b.offsetHeight,c[0]-nui.main_outer.scrollLeft-nui.main.scrollLeft,c[1]]}b=parseInt(a[0]);c=parseInt(a[1]);var d=parseInt(a[2]),e=parseInt(a[3]);c>b?e>d?(a=nui._getcell(b,d),b=nui._getcell(c+1,e+1)):(a=nui._getcell(b,e),b=nui._getcell(c+1,d+1)):e>d?(a=nui._getcell(c,d),b=nui._getcell(b+1,e+1)):(a=nui._getcell(c,e),b=nui._getcell(b+1,d+1));d=findPos(a);a=findPos(b);if(d&&a)return b=
d[0],c=a[0],d=d[1],a=a[1],c-=nui.main.scrollLeft,b-=nui.main.scrollLeft,e=nui.main.parentNode.querySelectorAll(".nui"),2===e.length&&(biffdata.ifListingPage()?(b-=e[1].offsetWidth,c-=e[1].offsetWidth):(b-=e[0].offsetWidth,c-=e[0].offsetWidth)),[Math.abs(c-b),Math.abs(a-d),b,d]}NUI.prototype._move=function(a,b){if(a=this._getcell(Math.max(1,this.fcol+a),Math.max(1,this.frow+b),0<a))b=a.id.split("_"),a=parseInt(b[1]),b=parseInt(b[2]),this._focus(a,b)};
NUI.prototype.moveInit=function(){if(0>nui.frow&&0>nui.fcol){0>biffdata.updateCellIndex&&(biffdata.updateCellIndex=0);biffdata.updateCellIndex>=biffdata.updateCellIds.length&&(biffdata.updateCellIndex=biffdata.updateCellIds.length-1);var a=biffdata.updateCellIds[biffdata.updateCellIndex];if(a){var b=a.split("_");a=parseInt(b[1]);b=parseInt(b[2]);this._focus(a,b,!0,!0)}}};
NUI.prototype.hmove=function(a){biffdata.updateCellIndex+=a;0>biffdata.updateCellIndex&&(biffdata.updateCellIndex=0);biffdata.updateCellIndex>=biffdata.updateCellIds.length&&(biffdata.updateCellIndex=biffdata.updateCellIds.length-1);var b=biffdata.updateCellIds[biffdata.updateCellIndex];if(b){b=b.split("_");var c=parseInt(b[1]),d=parseInt(b[2]),e=nui.fcol,f=nui.frow,g=this._getcell(c,d);biffdata.updateCellIndex===biffdata.updateCellIds.length-1&&g.classList.contains("hide")||(c==e&&d==f&&0!=a&&biffdata.updateCellIndex<
biffdata.updateCellIds.length-1&&0<biffdata.updateCellIndex||g.classList.contains("hide")?this.hmove(a):this._focus(parseInt(b[1]),parseInt(b[2]),0==a))}};
NUI.prototype.vmove=function(a){for(var b=this.focus.cell,c=this.fcol,d=parseInt(b.dataset.x),e=this.frow,f=b.colSpan||1,g,k=1E3,l,m,n=0,q=!1,r=!1;!r&&!(q||e===this.frow||n===f-1?(q||(d=parseInt(b.dataset.x)),e+=a,n=0):(d++,n++),(g=(g=this._getcell(d,e))&&!g.classList.contains("hide")?g.ip:null)&&g.biff&&(g.biff.hasAttribute("ro")||g.biff.hasAttribute("hide"))&&(g=null),g&&(q&&d!==c||(l=d,m=e),d===c?r=!0:q||(q=!0,d=c,e-=a)),k--,0===k||0>=e||e>=this.maxY););if(!r&&!q)return!1;this._focus(l,m);biffdata.updateCellIndex=
indexOf(this.focus.cell.id,biffdata.updateCellIds);return!0};NUI.prototype._createIP=function(a){if(!a)return null;a.ip=new Typer;a.ip.cell=a;a.ip.focused=!0;a.ip.loadValue("");return a.ip};
NUI.prototype.keyUp=function(a){if(ctrl.lockAll)return!1;if(a){var b=this._curcell(),c=a.keyCode,d=a.ctrlKey;if(mode==BUILDER){if(d||ctrl.commandKeyDown)return!1;d=ifSingleIntoTable(b);if(b&&!b.ip&&ifTextInputKeycode(a)&&!b.classList.contains("builderFieldWhite")&&!b.classList.contains("builderFieldWhiteSingle")&&(b.oldClassName&&-1!=b.oldClassName.indexOf(BUILDER_EMPTY_CLASS)&&-1!=b.className.indexOf("builderFocus")||d||builder.mode==BUILDER_TEXT))this._createIP(b),d&&(d=b.dataset,builder.subtableKeys[d.x-
1+","+d.y]=void 0);else if(KEYCODE.isEQUAL(c)&&b&&b.ip&&!b.ip.typing)return openTab($("prop6"),$("propTab6"),$("propSel"),$("propSpace")),window.setTimeout(function(){$("at_f").focus()},50),!0}if(c==KEYCODE.ESC)b&&b.ip&&b.ip.typing||(mode==BUILDER||mode==UPDATE)&&(mode==UPDATE&&!biffdata.changed||mode==BUILDER&&builder.createNUI()===builder.startNUI||confirm(lm.away))&&window.setTimeout(compose(nui._blur.bind(nui),backToBrowse),500);else if(b&&!b.classList.contains("hide")&&b.ip){if(!b.ip.keyUp(a))return!1;
if(mode==BUILDER&&b.ip.value&&ifTextInputKeycode(a)){if(!builder.setContent(nui.fcol,nui.frow,b.ip.value?b.ip.value:""))return!1;builderHelperPanelSwitch(2);builder.mode==BUILDER_FIELDS?(setPropertyTable(b),setStylePane(builder.cellData[this.fcol+","+this.frow])):builder.mode==BUILDER_TEXT&&setStylePane(builder.freeData[this.fcol+","+this.frow]);b.ip.focused=!0;b.ip.typing=!0;ctrl.typingLock&&(b.ip.typingLock=!0);b.ip.render()}2===ctrl.IMEStatus&&(ctrl.IMEStatus=0);biffdata.fs&&0<parseInt(biffdata.fs)&&
(biffdata.keyField?biffdata.subtableKeyFields&&0<biffdata.subtableKeyFields.length&&(showSubtableRowDelete(nui.fcol,nui.frow),nui._updateDelIcon()):(showSubtableRowDelete(nui.fcol,nui.frow),nui._updateDelIcon()));return!1}}};
NUI.prototype.keyDown=function(a){if(ctrl.lockAll||!a)return!1;var b=a.altKey,c=a.ctrlKey,d=a.shiftKey,e=a.metaKey,f=a.keyCode,g=this._curcell();g&&g.ip&&!0===g.ip.typing&&g.ip.type===MSELECTOR||(b||c||e||hinFocus(),b&&f==KEYCODE.ENTER&&hinFocus());if(g&&g.ip&&!g.ip.keyDown(a))return!0;if(mode==BROWSE&&(0>nui.frow||0>nui.fcol))return!1;switch(f){case KEYCODE.ENTER:return mode==BUILDER?nui._move(0,1):nui.vmove(1)||nui.hmove(1),!0;case KEYCODE.TAB:return mode==BUILDER?nui._move(1,0):nui.hmove(d?-1:
1),!1;case KEYCODE.CHAR_S:if((b||c||ctrl.commandKeyDown)&&-1===window.acceptedLanguage.indexOf("pl")){if(mode==UPDATE)return submitNUIForm(),!1;if(mode==BUILDER)return saveBuilder(),!1}break;case KEYCODE.F2:g&&g.classList.contains("hide")||dblclickMode(nui.fcol,nui.frow)}if(g&&g.ip&&g.ip.typingLock&&(mode!=BUILDER||f!=KEYCODE.UP&&f!=KEYCODE.DOWN))return!0;KEYCODE.isArrowKey(f)&&d&&!ctrl.multiSelect&&(ctrl.multiSelect=g);switch(f){case KEYCODE.LEFT:mode==BUILDER?nui._move(-1,0):nui.hmove(-1);break;
case KEYCODE.RIGHT:mode==BUILDER?nui._move(1,0):nui.hmove(1);break;case KEYCODE.UP:mode==BUILDER?nui._move(0,-1):nui.vmove(-1);break;case KEYCODE.DOWN:if(mode==BUILDER)nui._move(0,1);else if(!b||g.ip.type!==SELECTOR&&g.ip.type!==MSELECTOR)nui.vmove(1);else{if(mode==BROWSE&&!modeUpdate())return!1;g.ip.mvp?clickMVP(g.ip):g.ip._write("")}break;default:return!0}d&&(a=nui._curcell(),ctrl.multiSelectEnd=a,processMultiSelect(nui.fcol,nui.frow,!0));return!1};
NUI.prototype.openSection=function(a){var b=mode==BUILDER?builder:biffdata;if(b.hasSections()){ctrl.openSectionFlag=!0;for(var c=0;c<b.sections.sections.length;c++)b.sections.sections[c].display=!1;b.sections.sections[a]&&(b.sections.sections[a].display=!0);mode==BUILDER?builder.renderAll():displayData();mode===BROWSE&&(biffdata.freezeX&&nui.freezeX(biffdata.dataminX+biffdata.freezeX),biffdata.freezeY&&nui.freezeY(biffdata.dataminY+biffdata.freezeY));ctrl.openSectionFlag=!1;if(b.hasSections()){for(c=
0;c<b.sections.sections.length;c++)$("nuiSectionTab"+c).className="nuiSectionTab";$("nuiSectionTab"+a)&&($("nuiSectionTab"+a).className="nuiSectionTabOn");nui.setOpenedSectionCache(a)}}};
NUI.prototype.setOpenedSectionCache=function(a){try{var b=JSON.parse(RagicStorage.localStorage.getItem("openedSectionCache"));b||(b={});var c="/"+ap+path+"/"+sheetIndex;delete b[c];var d=Object.keys(b);if(10<d.length){var e="",f;Object.keys(d).forEach(function(a){if(f){var c=parseInt(b[a].ts);c<f&&(e=a,f=c)}else e=a,f=parseInt(b[a].ts)});delete b[e]}a=parseInt(a);0!==a&&(b[c]={index:a,ts:(new Date).getTime()});RagicStorage.localStorage.setItem("openedSectionCache",JSON.stringify(b))}catch(g){console.log("set OpenedSectionCache Failed."),
console.log(g)}};
NUI.prototype.loadOpenedSectionCache=function(){try{var a=JSON.parse(RagicStorage.localStorage.getItem("openedSectionCache"));if(a){var b="/"+ap+path+"/"+sheetIndex;if(a[b]){var c=mode===BUILDER?builder:biffdata,d=a[b].index;if(c.sectionExist(d)){var e=c.getDisplaySection();if(-1!==e){var f=c.sections.sections;delete f[e].display;f[d].display=!0}}else delete a[b],RagicStorage.localStorage.setItem("openedSectionCache",JSON.stringify(a))}}}catch(g){console.log("load OpenedSectionCache Failed."),console.log(g)}};
NUI.prototype.normalizeX=function(a){var b=a;return ctrl.lazyRendering&&!(a<=ctrl.stickyX)&&(0!==a&&(b-=ctrl.lazyInitStartX+ctrl.stickyX),a<=ctrl.stickyX)?null:b};NUI.prototype.normalizeY=function(a){var b=a;if(ctrl.lazyRendering&&!(a<=ctrl.stickyY)&&(0!==a&&(b-=ctrl.lazyInitStartY+ctrl.stickyY),a<=ctrl.stickyY))return null;var c=mode==BUILDER?builder:biffdata;c.hasSections()&&(a>=c.sections.start&&b++,a>c.getEndOfLastSection()&&b++);return b};
NUI.prototype.getcell=function(a,b){a=this.normalizeX(a);b=this.normalizeY(b);var c=this.main;if(!c||!c.nuicelltable||!c.nuicelltable.rows||0>b)return null;b=c.nuicelltable.rows[b];return!b||!b.cells||0>a?null:(c=b.cells[a])&&"none"!=c.style.display?c:c?b.cells[a+c.colSpan-1]:null};
NUI.prototype._getcell=function(a,b,c){a=this.normalizeX(a);b=this.normalizeY(b);var d=a,e=this.main;if(!e||!e.nuicelltable||!e.nuicelltable.rows||0>b)return null;b=e.nuicelltable.rows[b];if(!b||!b.cells||0>a)return null;if((e=b.cells[a])&&"none"!=e.style.display)return e;for(;e&&e.style&&"none"==e.style.display&&0<=a;)e=b.cells[--a];return e?c?b.cells[d+e.colSpan-1]:e:null};
NUI.prototype._getcellV2=function(a,b){a=this.normalizeX(a);b=this.normalizeY(b);var c=this.main;if(!c||!c.nuicelltable||!c.nuicelltable.rows||0>b)return null;b=c.nuicelltable.rows[b];if(!b||!b.cells||0>a)return null;if(a=b.cells[a])return a};NUI.prototype._removecell=function(a,b){a=this.normalizeX(a);b=this.normalizeY(b);var c=this.main;!c||0>b||(b=c.nuicelltable.rows[b])&&b.cells&&!(0>a)&&b.cells[a]&&(b.cells[a].style.display="none")};
NUI.prototype._curcell=function(){return this._getcell(this.fcol,this.frow)};
NUI.prototype._setFocusColorBack=function(a){var b;if(0<this.focusChanged.length)for(b=0;b<this.focusChanged.length;b++)if(this.focusChanged[b]){var c=parseInt(this.focusChanged[b].getAttribute("data-x")),d=parseInt(this.focusChanged[b].getAttribute("data-y"));isNaN(c)||isNaN(d)||0===c||0===d||(a?(rm(this.focusChanged[b]),removeBorderClass(this.focusChanged[b],BUILDER_EMPTY_CLASS)):this.focusChanged[b].className=this.focusChanged[b].oldClassName)}this.focusChanged=[]};
NUI.prototype.resetWidth=function(){biffdata.widthCommand=null;biffdata.heightCommand=null;for(var a=1,b=this._getcell(0,a);b;)b.style.width=embed?"70px":"100px",a++,b=this._getcell(0,a);a=1;for(b=this._getcell(0,a);b;)b.style.height=embed?"12px":"16px",a++,b=this._getcell(0,a)};NUI.prototype.testAddWidth=function(a,b){if(a=this._getcell(a,0)){var c=a.clientWidth;a.setAttribute("widthBeforeTest",a.style.width);a.style.width=c+b+"px";return a}};
function revertCellWidth(a){var b=a.getAttribute("widthBeforeTest");b&&(a.style.width=b)}
NUI.prototype.showUnhideColumnArrows=function(a,b,c){var d=this._getcell(a,0),e=this._getcell(a-1,0),f=this._getcell(a+1,0);if(d&&e&&f){var g=d.querySelector(".left");d=d.querySelector(".right");e=e.querySelector(".left");f=f.querySelector(".right");var k=!1;b?(!isHiddenColumn(a-1)&&1<a&&e.classList.add("showUnHideArrow"),!isHiddenColumn(a+1)&&a<builder.maxX+5&&f.classList.add("showUnHideArrow"),c||this.resetUnhideArrowsTooltip(a)):(c&&builder.hiddenColumnIndex.includes(a-1)&&(k=!0),hideUnhideArrow(f,
"r",a+1),hideUnhideArrow(e,"l",a-1));hideUnhideArrow(g,"l",a);k?d.classList.add("showUnHideArrow"):hideUnhideArrow(d,"r",a)}};function hideUnhideArrow(a,b,c){a&&a.classList.remove("showUnHideArrow");removeArrowMouseoverEvent(a,b+"_"+c)}function removeArrowMouseoverEvent(a,b){ctrl.unhideArrowTooltip.hasOwnProperty(b)&&(a.removeEventListener("mouseover",ctrl.unhideArrowTooltip[b]),delete ctrl.unhideArrowTooltip[b])}
NUI.prototype.resetUnhideArrowsTooltip=function(a){function b(a,b,c){var d=function(){tooltipTiny(a,k)};removeArrowMouseoverEvent(a,b+"_"+c);a.addEventListener("mouseover",d);ctrl.unhideArrowTooltip[b+"_"+c]=d}a=parseInt(a);var c=[],d=a+1,e=a-1;builder.hiddenColumnIndex=findAllHiddenColumnIndexs();for(isHiddenColumn(a)&&c.push(a);isHiddenColumn(d);)c.push(d++);for(;isHiddenColumn(e);)c.unshift(e--);a=c[0]-1;d=c[c.length-1]+1;e=$("_"+a+"_0")?$("_"+a+"_0").querySelector(".left.showUnhideArrow"):null;
var f=$("_"+d+"_0")?$("_"+d+"_0").querySelector(".right.showUnhideArrow"):null;c=c.map(function(a){return colNames[a]});var g=c.map(function(a,b){return"'{"+b+"}'"}).join(" ");lm.tt_disPlayHiddenColumn=lm.tt_disPlayHiddenColumn.replace(/('\{\d\}'\s*)+/g,g);var k=getBundleString("tt_disPlayHiddenColumn",c);e&&b(e,"l",a);f&&b(f,"r",d)};
NUI.prototype.setWidth=function(a,b,c){var d=this._getcell(a,0),e;if(!d)return null;var f=c+ctrl.defaultColumnWidth;if(0<=f){d.style.width=f+"px";if(12>f)for(e=0;e<biffdata.biffs.length;e++){var g=biffdata.biffs[e];g.absoluteX!==a||g.attr&&g.attr.cs&&g.dataType==DATA||(g=this._getcell(g.x,g.y),g.style.whiteSpace="nowrap",g.style.overflow="hidden")}0==f?(d.style.padding="0",d.style.borderWidth="0"):(d.style.padding="",d.style.borderWidth="",d.style.borderRightWidth="1px");b&&(b.dWidth=c)}return d};
NUI.prototype.setHeight=function(a,b,c){if(isNaN(a))return null;var d=this._getcell(0,a);if(d){var e=c+ctrl.defaultRowHeight;if(0<=e&&(d.style.lineHeight=e+"px",d.style.height=e+"px",b&&(b.dHeight=c),40<noUnit(d.style.height))){b=nui.main.nuicelltable.rows[a];for(c=0;c<b.cells.length;c++)b.cells[c].style.whiteSpace="pre-line";this.highCellRows.includes(a)||this.highCellRows.push(a)}return d}};
NUI.prototype._atHighRow=function(){var a=nui._curcell(),b=null;a&&a.ip&&a.ip.biff&&(b=a.ip.biff);return!(b&&b.attr&&(b.attr.fmt_d||b.attr.fmt_n||b.attr.url||b.attr.phone))&&(-1!=indexOf(this.frow,this.highCellRows)||40<$("hin").clientHeight)};
function processWidth(a,b){ctrl.narrowColumn=[];b=b||"";var c=(a||"").split("&"),d=b.split("&");nui.widthObj={};nui.heightObj={};for(a=0;a<c.length;a++){var e=c[a].split("=",2);2>e.length||(b=parseInt(e[0]),e=parseInt(e[1]),-90>e&&ctrl.narrowColumn.push(b),-100===e&&mode===BUILDER&&nui.showUnhideColumnArrows(b,!0),nui.widthObj[b]=e)}for(a=0;a<d.length;a++)if(e=d[a].split("=",2),!(2>e.length))if(biffdata.ifListingPage())if(parseInt(e[0])==biffdata.dataminY)for(b=parseInt(e[1]),c=biffdata.dataminY;c<=
biffdata.dataMaxY;c++)nui.heightObj[c]=b;else{if(parseInt(e[0])<biffdata.dataminY-1||parseInt(e[0])>biffdata.datamaxY)nui.heightObj[parseInt(e[0])]=parseInt(e[1])}else nui.heightObj[parseInt(e[0])]=parseInt(e[1]);for(a=1;a<nui.maxX;a++)if(nui.widthObj[a]||0===nui.widthObj[a]?nui.setWidth(a,null,nui.widthObj[a]):nui.setWidth(a,null,ctrl.defaultColumnWidthDelta),(ctrl.isIE||ctrl.isEdge||ctrl.isFF||ctrl.isChrome)&&-100==nui.widthObj[a]&&(d=nui._getcell(a,0)))d.style.padding="0px",d.style.borderWidth=
"0px";for(a=1;a<nui.maxY;a++)nui.heightObj[a]||0===nui.heightObj[a]?nui.setHeight(a,null,nui.heightObj[a]):nui.setHeight(a,null,ctrl.defaultColumnHeightDelta);ctrl.isIE&&loadColumnSizes()}
NUI.prototype._updateDelIcon=function(){var a=$("delIcon");if(a){var b=this.main,c=this.main_outer,d=biffdata.getDataRoot(this.fcol,this.frow,!0);biffdata.ifListingPage()?a.style.display="none":d&&checkIfUserCanEdit(!0)&&!d.noRowDelete?(d=this._getcell(d.x,d.y),d=findPos(d),a.style.top=d[1]+5-ctrl.mainScrollTop+"px",a.style.left=d[0]-15-c.scrollLeft-b.scrollLeft+"px"):a.style.display="none"}};
function subTableExtendProcess(a,b,c){if(canSaveData()&&!biffdata.ifListingPage()&&b&&b.ifCreateInsertRow()&&a&&0<a.length){a=biffdata.biffs;for(var d=b.x,e=b.x,f=b.y,g=0;g<a.length;g++){var k=a[g];k.IPType!==FREE&&biffdata.isSameSubtable(k,b)&&(k.x<d&&(d=k.x),k.x>e&&(e=k.x),k.y<f&&(f=k.y))}g=!0;for(k=0;k<a.length;k++)if(a[k].y>b.y){g=!1;break}g||shiftData(b.y,1);subtableCopyHeight(b.y+1,f);copyDataY(b.y,d,e);biffdata.expandSection(b.y,1);biffdata.maxY++;displayData(!0);doFreeze();c&&c()}}
function delSubtableRow(){var a=biffdata.getDataRoot(nui.fcol,nui.frow,!0);if(!(!checkRemovable(a)||a&&a.noRowDelete||biffdata.ifListingPage())){var b=a.domainId;biffdata.subtableKeyFields&&0<biffdata.subtableKeyFields.length&&(b=a.parentDomainId);var c=node("input");c.type="hidden";c.name="D_"+b;c.value=a.nodeId;biffdata.subtableKeyFields&&0<biffdata.subtableKeyFields.length&&(c.value=a.parentNodeId);ctrl.hidNodes||(ctrl.hidNodes=[]);ctrl.hidNodes.push(c);var d=-1,e=0;c=!0;var f=biffdata.formulaMap;
b=[];for(var g=[],k=[],l=0;l<biffdata.biffs.length;l++){var m=biffdata.biffs[l];if(m.y===a.y&&biffdata.isSameSubtable(a,m)){0>d&&(d=l);e++;var n=getCellNameFromDataCache(m);n&&f&&f[n]&&f[n][m.y]&&(f[n][m.y]=null,b.push(n));m.hasAttribute("ag")&&(m.isRefToOtherFieldAutoGen()?k.push(m):g.push(m))}else m.y===a.y&&(c=!1)}biffdata.biffs.splice(d,e);d=a.parentDomainId;var q;a.hasAttribute("cg")?isPlainObject(biffdata.subtableDataBiffs[d])&&(q=biffdata.subtableDataBiffs[d][a.attr.cg]):q=biffdata.subtableDataBiffs[d];
Array.isArray(q)&&(d=q.findIndex(function(b){return a.y===b.y}),-1<d&&q.splice(d,e));q=0;for(e=g.length;q<e;q++)reguessSubtableSameDomainBiffsSeqs(g[q]);g=0;for(q=k.length;g<q;g++)reguessSubtableSameDomainBiffsRefSeqs(findAllSubtableDataBiffsToReguessAutogen(k[g]));c&&shiftData(a.y,-1);biffdata.expandSection(a.y,-1);displayData();for(c=0;c<b.length;c++)formulaBuilder.update(b[c],a);nui._updateFocus();nui._updateDelIcon();if(biffdata.autoSave){b=$("nuiform");for(c=0;c<ctrl.hidNodes.length;c++)b.appendChild(ctrl.hidNodes[c]);
ctrl.hidNodes=null;autoSaveInterval(1E3)}biffdata.loadAllLastEditTimeDefaultValues();biffdata.loadLastEditUserDefaultValue||biffdata.loadAllLastEditUserDefaultValues();b=$("hin");c=nui._curcell()&&nui._curcell().ip&&nui._curcell().ip.biff;b.value=c?c.value:""}}function checkRemovable(a){for(var b=!1,c=0;c<biffdata.biffs.length;c++){var d=biffdata.biffs[c];if(d&&a&&d.y==a.y&&(d.value||0<=d.nodeId)&&(null==d.attr||d.attr&&d.value!=d.attr.ag)){b=!0;break}}return b}
function hideListingPageStuff(){$("quickAddListingRow")&&document.body.removeChild($("quickAddListingRow"));$("minDiv")&&document.body.removeChild($("minDiv"));hideListingPageCheckboxes()}
function updateListingPageAddRowButton(){if(mode!=BUILDER&&!mvpMode&&biffdata.ifListingPage()){var a=biffdata.quickSaveDisableCode,b=$("quickAddListingRow");b||(b=node("div"),b.id="quickAddListingRow",b.onmouseout=function(){hideTinyTooltip()},b.innerHTML="+",b.setAttribute("quickAdd","true"),0===a?(b.ontouchend=function(a){listPageAddRow();cancelEventBubble(a)},b.onclick=listPageAddRow,b.onmouseover=function(){tooltipTiny(this,lm.tt_quickAddListingRow)}):(b.className="quickAddListingRowDisabled",
b.onmouseover=function(){tooltipTiny(this,lm["tt_quickAddListingRowDisable"+a])}),document.body.appendChild(b));ctrl.firstCheckbox&&""==ctrl.firstCheckbox.style.display||document.querySelector('.listingPageStarChecked[index="1"]')?placeAtRow(b,biffdata.dataminY,-44):placeAtRow(b,biffdata.dataminY)}}function getCheckedRootNodeIds(){return ctrl.checkedRootNodeIds}
function hideListingPageCheckboxes(){for(var a in ctrl.listingPageCheckboxes){var b=ctrl.listingPageCheckboxes[a];b.parentNode&&b.parentNode.removeChild(b)}for(a in ctrl.listingPageStars)b=ctrl.listingPageStars[a],b.parentNode&&b.parentNode.removeChild(b);ctrl.selectAllCheckbox&&(ctrl.selectAllCheckbox.parentNode&&ctrl.selectAllCheckbox.parentNode.removeChild(ctrl.selectAllCheckbox),ctrl.selectAllCheckbox=null)}
function clearListingPageCheckbox(){hideListingPageCheckboxes();ctrl.listingPageCheckboxes={};ctrl.listingPageStars={};ctrl.checkedRootNodeIds=[];prepareListingPageCheckboxes()}function hasCheckedRecordOnThisPage(){if(!ctrl.checkedRootNodeIds||0==ctrl.checkedRootNodeIds.length)return!1;for(var a=0;ctrl.checkedRootNodeIds.length;a++)if(ctrl.listingPageCheckboxes[ctrl.checkedRootNodeIds[a]])return!0;return!1}
function prepareListingPageCheckboxes(){function a(){var a=node("div");a.classList.add("far","fa-square","listingPageCheckbox");return a}function b(){var a=node("div");a.classList.add("far","fa-star","listingPageStar");return a}hideListingPageCheckboxes();if(!(!biffdata.ifListingPage()||mode!=BROWSE||0>=biffdata.totalEntry||mvpMode)){var c=biffdata.dataminX,d=biffdata.dataminY,e=biffdata.dataMaxY,f=ctrl.selectAllCheckbox;f||(f=a(),f.setAttribute("selectAllBox","true"),f.onclick=listingPageCheckboxSelectAll,
f.ontouch=listingPageCheckboxSelectAll,ctrl.selectAllCheckbox=f);for(var g=1;d<=e;d++){var k=$("_"+c+"_"+d);if(k&&k.ip&&k.ip.biff){var l=k.ip.biff;k=l.parentNodeId;0>k&&0<=l.nodeId&&(k=l.nodeId);l=a();l.setAttribute("rootNodeId",k);l.setAttribute("rowId",d);l.setAttribute("index",g);l.onclick=listingPageCheckboxClick;l.ontouch=listingPageCheckboxClick;ctrl.listingPageCheckboxes[k]=l;ctrl.checkedRootNodeIds&&-1!=ctrl.checkedRootNodeIds.indexOf(k)&&(l.className="fas fa-check-square listingPageCheckboxChecked",
l.setAttribute("checked","true"));document.body.appendChild(l);if(ctrl.ifStar){var m=b();m.setAttribute("rootNodeId",k);m.setAttribute("rowId",d);m.setAttribute("index",g);m.onclick=listingPageStarClick;m.ontouch=listingPageStarClick;ctrl.listingPageStars[k]=m;document.body.appendChild(m)}placeCheckboxStar(l,m,d,ctrl.checkboxShift);g++;showListingPageCheckbox(k)}}hasCheckedRecordOnThisPage()?f.className="fas fa-minus-square listingPageCheckboxChecked":f.className="far fa-square listingPageCheckbox";
placeCheckboxStar(f,null,biffdata.headerBiffs[0].y,ctrl.checkboxShift);listingPageCheckboxUpdateTopButton(!1);processStar()}}
function showListingPageCheckbox(a){if(mode!==BUILDER&&!mvpMode){ctrl.currentListingPageCheckbox&&!ctrl.currentListingPageCheckbox.getAttribute("checked")&&(ctrl.currentListingPageCheckbox.style.color=null);ctrl.ifStar&&ctrl.currentListingPageStar&&!ctrl.currentListingPageStar.getAttribute("checked")&&(ctrl.currentListingPageStar.style.color=null);var b=ctrl.listingPageCheckboxes[a];b&&(b.style.color="#afafaf",ctrl.currentListingPageCheckbox=b);if(ctrl.ifStar){var c=ctrl.listingPageStars[a];c&&(c.getAttribute("checked")?
c.style.color=null:c.style.color="#afafaf",ctrl.currentListingPageStar=c)}(a=$("quickAddListingRow"))&&b&&(1==b.getAttribute("index")&&""==b.style.display?(placeAtRow(a,biffdata.dataminY,-44),ctrl.firstCheckbox=b,c&&(ctrl.firstStar=c)):c&&1==c.getAttribute("index")&&c.getAttribute("checked")?(placeAtRow(a,biffdata.dataminY,-44),ctrl.firstStar=c):!ctrl.firstCheckbox||"none"!=ctrl.firstCheckbox.style.display||ctrl.firstStar&&ctrl.firstStar.getAttribute("checked")||placeAtRow(a,biffdata.dataminY))}}
function listingPageCheckboxSelectAll(a){a&&"click"==a.type&&(a=this.getAttribute("action"),"uncheck"==a?(this.className="far fa-square listingPageCheckbox",this.removeAttribute("checked"),this.setAttribute("action","check")):"check"==a&&(this.className="fas fa-check-square listingPageCheckboxChecked",this.setAttribute("checked","true"),this.setAttribute("action","uncheck")));for(var b=biffdata.dataminX,c=biffdata.dataMaxY,d=biffdata.dataminY;d<=c;d++){var e=$("_"+b+"_"+d);if(e&&e.ip&&e.ip.biff){e=
e.ip.biff;var f=e.parentNodeId;0>f&&0<=e.nodeId&&(f=e.nodeId);(e=ctrl.listingPageCheckboxes[f])&&listingPageCheckboxClick(e,a)}}}function listingPageStarFill(a){if(a=ctrl.listingPageStars[a])a.className="fas fa-star listingPageStarChecked",a.setAttribute("checked","true")}function listingPageStarEmpty(a){if(a=ctrl.listingPageStars[a])a.className="far fa-star listingPageStar",a.removeAttribute("checked")}
function formPageStarClick(a){a=a?"uncheck":"check";updateFormPageStar(a);ctrl.currentController.resetBrowseLeft();ajaxget("/sims/star.jsp",{a:ap,d:biffdata.rootDomainId,ni:biffdata.rootNodeId,act:a,actFrom:"formPage",p:path,si:sheetIndex},function(a){})}
function listingPageStarClick(a){a=a.getAttribute&&"function"==typeof a.getAttribute?a:this;var b=a.getAttribute("checked")?"uncheck":"check";"uncheck"==b?(a.className="far fa-star listingPageStar",a.removeAttribute("checked"),biffdata.star.splice(biffdata.star.indexOf(parseInt(a.getAttribute("rootNodeId"))),1)):"check"==b&&(a.className="fas fa-star listingPageStarChecked",a.setAttribute("checked","true"),biffdata.star.push(parseInt(a.getAttribute("rootNodeId"))));ajaxget("/sims/star.jsp",{a:ap,d:biffdata.rootDomainId,
ni:a.getAttribute("rootNodeId"),act:b,actFrom:"listingPage",p:path,si:sheetIndex},function(a){})}
function listingPageCheckboxClick(a,b){a=a.getAttribute&&"function"==typeof a.getAttribute?a:this;b||(b=a.getAttribute("checked")?"uncheck":"check");var c=parseInt(a.getAttribute("rootNodeId"));"uncheck"==b?(a.className="far fa-square listingPageCheckbox",a.removeAttribute("checked"),b=ctrl.checkedRootNodeIds.indexOf(c),-1!=b&&ctrl.checkedRootNodeIds.splice(b,1)):"check"==b&&(a.className="fas fa-check-square listingPageCheckboxChecked",a.setAttribute("checked","true"),ctrl.checkedRootNodeIds&&-1==
ctrl.checkedRootNodeIds.indexOf(c)&&ctrl.checkedRootNodeIds.push(parseInt(c)));updateListingPageRowSelectColor(a);updateSelectAllCheckbox();updateCountDiv()}function updateCountDiv(){var a=ctrl.checkedRootNodeIds.length;0==a?$("countDiv").style.display="none":$("countDiv").style.display="";1>=a?$("countDiv").innerHTML="<b>"+ctrl.checkedRootNodeIds.length+"</b> "+lm.record+lm.space+lm.selected:$("countDiv").innerHTML="<b>"+ctrl.checkedRootNodeIds.length+"</b> "+lm.records+lm.space+lm.selected}
function updateSelectAllCheckbox(){var a=!1,b=!1,c;for(c in ctrl.listingPageCheckboxes)if(ctrl.listingPageCheckboxes[c].getAttribute("checked")?a=!0:b=!0,a&&b)break;a?(ctrl.selectAllCheckbox.className=b?"fas fa-minus-square listingPageCheckboxChecked":"fas fa-check-square listingPageCheckboxChecked",ctrl.selectAllCheckbox.setAttribute("action","uncheck")):(ctrl.selectAllCheckbox.className="far fa-square listingPageCheckbox",ctrl.selectAllCheckbox.setAttribute("action","check"));listingPageCheckboxUpdateTopButton(a)}
function listingPageCheckboxUpdateTopButton(a){mode!=BROWSE||mvpMode||(a?(access.massDelete&&($("bDeleteSelected").style.display=""),window.userValid&&($("bSaveAsView").style.display=""),access.massEdit&&($("bBatchExecSelected").style.display="",$("bMassEditSelected").style.display=""),$("bMassCloneSelected")&&($("bMassCloneSelected").style.display=""),$("bNewData").style.display="none",$("bMoreActions").style.display="none",$("bReload").style.display="none"):($("bDeleteSelected").style.display="none",
$("bSaveAsView").style.display="none",$("bBatchExecSelected").style.display="none",$("bMassEditSelected").style.display="none",$("bMassCloneSelected")&&($("bMassCloneSelected").style.display="none"),a="W"==biffdata.rights&&!biffdata.nocreate&&!window.embedHideTop&&access.singleNew,$("bNewData").style.display=a?"":"none",$("bMoreActions").style.display="",$("bReload").style.display=""))}
function updateListingPageRowSelectColor(a){var b=a.getAttribute("checked");a=a.getAttribute("index");b?setTimeout(browse.selectRow.bind(browse),100,a-1):setTimeout(browse.deselectRow.bind(browse),100,a-1)}function placeCheckboxStar(a,b,c,d){if(c=nui._getcell(biffdata.dataminX-1,c))c.innerHTML="",a&&c.appendChild(a),b&&c.appendChild(b),updateListingPageRowSelectColor(a)}
function placeAtRow(a,b,c){var d=biffdata.dataminX;if(d=ctrl.isIE?nui._getcell(d,b):nui._getcell(d-1,b)){if(ctrl.isIE){b=findPos(d);if(!b)return;d=b[1]+(d.clientHeight-16)/2-nui.main.scrollTop-3;a.style.top=d+"px";a.style.left=b[0]-nui.main.scrollLeft-22+(c?c:0)+"px"}else b=d.getBoundingClientRect(),d=b.top+(d.clientHeight-16)/2-3,a.style.top=d+"px",a.style.left=b.left+22+(c?c:0)+"px";a.style.display=160>d||ctrl.isIE&&3<nui.main.scrollLeft?"none":""}}
function listPageAddRow(){listingPageNewData()&&(nui._focus(),displayData(),mode==BROWSE&&browse._init(),topButtonDisplay(),updateListingPageAddRowButton(),nui._focus(biffdata.dataminX,biffdata.dataminY))}
function listingPageNewData(){var a=mode==BROWSE&&!canSaveData();ctrl.listingPageNewingData=!0;a&&modeUpdate();ctrl.listingPageNewingData=!1;if(!canSaveData())return!1;biffdata.dataMaxY++;biffdata.maxY++;var b=biffdata.dataminY,c=--ctrl.minNodeId;if(a&&0===biffdata.totalEntry){for(a=0;a<biffdata.biffs.length;a++){var d=biffdata.biffs[a];d&&d.IPType!=SELECTION&&d.dataType!=HEADER&&0>d.parentDomainId&&(d.parentDomainId=biffdata.rootDomainId)}return!0}for(a=0;a<biffdata.biffs.length;a++)(d=biffdata.biffs[a])&&
d.IPType!=SELECTION&&d.dataType!=HEADER&&(d.y++,d.sec[2]=d.y);var e=0;for(a=0;a<biffdata.biffs.length;a++)if((d=biffdata.biffs[a])&&d.IPType!=SELECTION&&d.dataType!=HEADER&&(0>d.parentDomainId&&(d.parentDomainId=biffdata.rootDomainId),d.y==b+1)){var f=new Biff(d.sec,d.dataType);f.y=b;f.sec[2]=f.y;f.nodeId=--ctrl.minNodeId;f.value="";f.lazyLoading=d.lazyLoading;f.isEmptyRow=!0;biffdata.keyField&&(f.parentDomainId=d.parentDomainId,f.parentNodeId=c);mode!=BUILDER&&f.dataType==DATA&&f.format();biffdata.biffs.splice(e,
0,f);biffdata.existingCellCords.splice(e,0,f.x+","+f.y+","+f.domainId);e++;a++}return!0}
NUI.prototype.lazyInit=function(a,b){if(!ctrl.nuiMainTop||!ctrl.nuiMainLeft){var c=findPos(nui.main);ctrl.nuiMainTop=c[1];ctrl.nuiMainLeft=c[0]}ctrl.currentController&&ctrl.currentController.resize();var d=nui.main.scrollLeft;c=nui.main.scrollTop;var e=nui.main_outer.offsetWidth+ctrl.lazyRenderBufferX,f=nui.main_outer.offsetHeight+ctrl.lazyRenderBufferY;nui.maxX=b;nui.maxY=a;a=getLazyRowByLocation(c-ctrl.lazyRenderBufferY);c=getLazyRowByLocation(c+f+ctrl.lazyRenderBufferY);b=getLazyColByLocation(d-
ctrl.lazyRenderBufferX);var g=getLazyColByLocation(d+e+ctrl.lazyRenderBufferX);ctrl.lastColFrom=b;ctrl.lastRowFrom=a;ctrl.lastColTo=g;ctrl.lastRowTo=c;ctrl.stickyX=biffdata.freezeX;ctrl.stickyY=biffdata.freezeY;biffdata.ifListingPage()&&0==ctrl.stickyY&&(ctrl.stickyY=biffdata.dataminY-1);f=[];for(var k,l,m=e=d=0;m<=c;m++)if(m>ctrl.stickyY&&m<a)d++;else{f.push("<tr>");l=k="";for(var n=0;n<=g;n++)if(n>ctrl.stickyX&&n<b)e++;else{f.push("<td id='_"+n+"_"+m+"' data-x='"+n+"' data-y='"+m+"'");var q="";
0==n&&0==m?f.push('class="sideCell" style="width:'+ctrl.col1Width+'px;" '):0==n&&0<m?(mode===BUILDER&&(q=m,f.push('style="border-bottom:1px solid #efefef;height:26px;width:10px;padding:0;" ')),f.push('class="sideCellLeft" style="height:26px;width:'+ctrl.col1Width+'px;" onmouseover="dvcellMouseover(this);" ')):0==m&&0<n?(mode===BUILDER&&(q=n>=colNames.length?colNames[Math.floor(n/26)]+colNames[n%26]:colNames[n],f.push('style="border-right:1px solid #efefef;" '),k='<span class="arrowUnhide left" onmousedown="unhideColumn(this, false)" onmouseout="hideTinyTooltip();"><i class="fa fa-caret-left"></i></span>',
l='<span class="arrowUnhide right" onmousedown="unhideColumn(this, true)" onmouseout="hideTinyTooltip();"><i class="fa fa-caret-right"></i></span>'),f.push('class="sideCell" '+(mode===BUILDER?'onmouseover="dhcellMouseover(this);"':"")+" ")):mode===BUILDER?f.push('class="'+BUILDER_EMPTY_CLASS+'" '):f.push(1==n&&1==m?' style="border-radius:6px 0 0 0;"':" ");f.push(">"+l+q+k+"</td>")}f.push("</tr>")}g=getLazyLocationY(nui.maxY)-getLazyLocationY(c);nui.lazyTable?(nui.lazyTable.innerHTML=f.join(""),nui.placeHolder.style.height=
g+"px",nui.placeHolder.style.top=getLazyLocationY(c+1)+"px"):(k=getNUIPageHeader(),this.main.prepend(k),this.nuiPageHeader=k,k=node("table","nuicelltable"),k.innerHTML=f.join(""),nui.main.appendChild(k),f=node("div",null),f.style.position="absolute",f.style.height=g+"px",f.style.top=getLazyLocationY(c+1)+"px",f.innerHTML="&nbsp;",nui.main.appendChild(f),nui.lazyTable=k,nui.placeHolder=f,this.main.nuicelltable=nui.lazyTable,nui.lazyTable.onmousedown=cellMouseDown,nui.lazyTable.onmouseover=cellMouseover,
nui.lazyTable.onmouseout=cellMouseout,nui.lazyTable.ondblclick=cellDblclick,simulateMouseClickOnMobile(nui.lazyTable,nuiTableTouchSimulatedMouseClick,cellTouchSimulatedContextMenu),ctrl.sheetHeaderOffset=nui.lazyTable.offsetTop);ctrl.lazyInitStartX=e;ctrl.lazyInitStartY=d;a=getLazyLocationY(a);b=getLazyLocationX(b);nui.lazyTable.style.width="100%";nui.lazyTable.style.position="absolute";nui.lazyTable.style.top=a;nui.lazyTable.style.left=b;processWidth(biffdata.widthCommand,biffdata.heightCommand)};
function lazyNeedUpdate(){var a=nui.main.scrollLeft,b=nui.main.scrollTop-ctrl.sheetHeaderOffset,c=nui.main.offsetWidth,d=nui.main.offsetHeight,e=getLazyRowByLocation(nui.main.scrollTop+d)==biffdata.dataMaxY;c=getLazyColByLocation(nui.main.scrollLeft+c)==biffdata.dataMaxX;return 0<ctrl.lastRowFrom&&b<getLazyLocationY(ctrl.lastRowFrom)&&!e||b+d>getLazyLocationY(ctrl.lastRowTo)&&!e||0<ctrl.lastColFrom&&a<getLazyLocationX(ctrl.lastColFrom)&&!c||a>getLazyLocationX(ctrl.lastColTo)&&!c?!0:!1}
function scrollComplete(){ctrl.lazyRendering&&lazyNeedUpdate()&&!ctrl.lazyUpdating&&setTimeout(lazyUpdate,0)}function lazyUpdate(){ctrl.lazyUpdating=!0;nui.init(biffdata.maxY,biffdata.maxX+6);_renderData();doFreeze();browse._init();browse._focus();ctrl.lazyUpdating=!1}
function getLazyRowByLocation(a){0>a&&(a=0);if(a<=ctrl.sheetHeaderOffset)return 0;a-=ctrl.sheetHeaderOffset;var b=0,c;for(c=0;c<=nui.maxY;c++){var d=28;0==c&&(d=4);b=biffdata.heightObj&&biffdata.heightObj[c]?b+(d+biffdata.heightObj[c]):b+d;if(b>a)break}return Math.min(c,biffdata.dataMaxY)}
function getLazyLocationY(a){if(0==a)return ctrl.sheetHeaderOffset;for(var b=0,c=0;c<=a;c++)b=0==c?b+4:biffdata.heightObj&&biffdata.heightObj[c]?b+(28+biffdata.heightObj[c]):b+28;return b+ctrl.sheetHeaderOffset}function getLazyColByLocation(a){var b=ctrl.col1Width;if(b>a)return 0;for(var c=1;c<=nui.maxX;c++)if(b=biffdata.widthObj[c]?b+biffdata.widthObj[c]:b+135,b>a)return c;return nui.maxX}
function getLazyLocationX(a){if(0==a)return 0;for(var b=ctrl.col1Width,c=1;c<=a;c++)b=biffdata.widthObj[c]?b+(135+biffdata.widthObj[c]):b+135;return b}
function ifSingleIntoTable(a){var b=nui._getcell(nui.fcol-1,nui.frow);if(a=a&&a.oldClassName&&-1!=a.oldClassName.indexOf("builderFieldWhiteSingle")&&b.builderField){a=nui._getcell(nui.fcol,nui.frow+1);b=nui._getcell(nui.fcol,nui.frow+2);var c=nui._getcell(nui.fcol,nui.frow+3);a=a.oldClassName&&-1!=a.oldClassName.indexOf(BUILDER_EMPTY_CLASS)&&b.oldClassName&&-1!=b.oldClassName.indexOf(BUILDER_EMPTY_CLASS)&&c.oldClassName&&-1!=c.oldClassName.indexOf(BUILDER_EMPTY_CLASS)}(b=builder.getFirstField())&&
b.x==nui.fcol-1&&b.y==nui.frow&&!builder.createAsListingPage&&(a=!1);return a}
window.onbeforeunload=function(a){mvpMode?read(null,"/sims/lockEntry.jsp?unlock&a="+ap+"&p="+encodeURIComponent(pathTemp)+"&fn="+encodeURIComponent(sheetTemp)+"&ni="+biffdataTemp.rootNodeId):mode&&mode==UPDATE&&read(null,"/sims/lockEntry.jsp?unlock&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+(biffdata.ifListingPage()?"&sl":"&ni="+biffdata.rootNodeId));if(mode&&!ctrl.isObsoleteIE&&!ctrl.noConfirmClose){if(mode==UPDATE&&biffdata.changed||mode==BUILDER||mode==BROWSE&&ctrl.downloadingFiles.size)return lm.away;
if(canSaveData()){if(ctrl.autoSaveTimeout)return nui._blur(),autoSaveInterval(),!1;(a=nui._curcell())&&a.ip&&a.ip.blur()&&autoSaveInterval()}}};
document.onkeydown=function(a){if(ctrl.lockAll)return!1;a||(a=window.event);var b=a.keyCode,c=a.altKey,d=a.ctrlKey;ctrl.autoLogoutInterval&&(ctrl.idleInitRecord=(new Date).getTime());b===KEYCODE.F3&&(a.preventDefault(),$("searchbox").focus());$("linkWizard")&&""==$("linkWizard").style.display&&linkWizardKeydown(a);if(b==KEYCODE.CTRL||b==KEYCODE.COMMAND||b==KEYCODE.LEFT_WIN||b==KEYCODE.SELECT)ctrl.commandKeyDown=!0,window.setTimeout(function(){ctrl.commandKeyDown=!1},1E3);b==KEYCODE.ESC&&lightboxClose();
switch(b){case KEYCODE.ENTER:var e=ctrl.enterSubmitButton,f=ctrl.enterSubmitBox;if(e&&f)return e.onclick(),!1;if(0<=searchableDocs.indexOf(searchDropSelector.searchFrom)&&"Enter"===a.key)return kbsearch(),!1;loginSubmit();if($("floatingWin")&&""==$("floatingWin").style.display&&$("floatingWinOK")&&""==$("floatingWinOK").style.display)return $("floatingOKButton").click(),!1;tutorial.getEnabled()&&"000"===tutorial.getChapter()&&tutorialProgress();e=document.activeElement;if("nuiSectionTabRename"===
e.id){e.blur();return}ctrl.createTab&&1!==ctrl.IMEStatus&&createCurrentTabName();ctrl.templateSearchFocus&&templateSearch();ctrl.sidebarSearchFocus&&v6Search();break;case KEYCODE.UP:ctrl.enterSubmitBox&&searchDropSelector&&searchDropSelector.qt&&0<searchDropSelector.qt.length&&searchDropSelector.move(-1);break;case KEYCODE.DOWN:ctrl.enterSubmitBox&&searchDropSelector&&searchDropSelector.qt&&0<searchDropSelector.qt.length&&searchDropSelector.move(1);break;case KEYCODE.ESC:$("floatingWin")&&""==$("floatingWin").style.display&&
floatWinClose(),_hideMsg()}if(mode==BROWSE&&nui&&0>=nui.frow&&!ctrl.outOfNUI)switch(b){case KEYCODE.PAGE_UP:return ctrl.browseMode="K",browsePrevPage(),!1;case KEYCODE.PAGE_DOWN:return ctrl.browseMode="K",ctrl.pureInsert||browseNextPage(),!1;case KEYCODE.UP:ctrl.browseMode="K";browse._move(-1);break;case KEYCODE.TAB:return ctrl.browseMode="K",browse._move(1),!1;case KEYCODE.DOWN:ctrl.browseMode="K";browse._move(1);break;case KEYCODE.BACKSPACE:case KEYCODE.LEFT:ctrl.browseMode="K";browseBack();break;
case KEYCODE.ENTER:case KEYCODE.RIGHT:ctrl.browseMode="K",browseForward()}else{if(!nui)return!0;e=nui._curcell();mode==BROWSE&&0<nui.fcol&&0<nui.frow&&!ctrl.outOfNUI&&e&&!e.classList.contains("hide")&&e.ip&&(e.ip.type==TYPER||e.ip.type==SELECTOR||e.ip.type===MSELECTOR)&&ifTextInputKeycode(a)&&2>ctrl.multiSelected.length&&!biffdata.autoSave&&(modeUpdate(),e.ip.typingLock||($("hin").hinFocus=!1));if(!ctrl.outOfNUI&&!nui.keyDown(a))return!1}if(mode==UPDATE||mode==BROWSE)switch(b){case KEYCODE.CHAR_V:c&&
d&&(mode==BROWSE&&modeUpdate(),biffdata.ifListingPage()||(subtableCopyPreviousRow(),subTableExtendProcess($("hin").getValue(),nui._curcell().ip.biff)))}return!KEYCODE.isArrowKey(b)||canSaveData()||ctrl.outOfNUI||mode==BUILDER?!0:!1};function ifSysFieldCannotDelete(a){a=parseInt(a);return 1E6>a&&312!==a&&320!==a&&105!==a&&109!==a}function showAddSystemFieldElement(a){a&&(a=parseInt(a),105===a?$("add_createDate").style.display="block":109===a&&($("add_lastUpdateDate").style.display="block"))}
function doDeleteCheck(a){!a||a.attr&&a.attr.interm||(a.hasAttribute("fixedDesign")||ifSysFieldCannotDelete(a.domainId)?(floatWin(null,lm.fieldNoDeleteFixedDesign),a.noDelete=!0):builder.ifListingPage()||ajaxget("/sims/referenceCheckForField.jsp",{a:ap,p:path,si:sheetIndex,d:a.domainId},function(b){b=JSON.parse(b);if(0<b.length){for(var c="",d=0;d<b.length;d++)c+=b[d].msg+"<br><br>";floatWin(null,c);a.noDelete=!0}},!0))}
document.onkeyup=function(a){if(ctrl.lockAll)return!1;a||(a=window.event);var b=a.keyCode;if(b==KEYCODE.ESC){if(mode==BUILDER&&builder.doingCopyStyle){$("bCopyStyle").onclick();cancelEventBubble(a);return}if($("mvpWin")&&""==$("mvpWin").style.display){ctrl.outOfNUI=!1;disableMVP();return}}if(ctrl.transText&&b==KEYCODE.CHAR_T){var c=prompt(ctrl.transText);ajaxget("/sims/trans.jsp",{a:ap,cl:window.lang,cv:ctrl.transText,tl:window.userProperties.transLang,tv:c},function(a){1<a.trim().length&&(ctrl.transElement.innerText=
c)})}tutorialCheckProgress();rtppasted||rtppaste();if(!ctrl.outOfNUI&&nui){if(((a.ctrlKey||ctrl.commandKeyDown)&&b==KEYCODE.CHAR_Z||b==KEYCODE.ESC)&&canSaveData()){var d=nui._curcell();d&&d.ip&&void 0!==d.ip.lastFocusValue&&d.ip.value!==d.ip.lastFocusValue&&($("hin").value=d.ip.lastFocusValue,(a.ctrlKey||ctrl.commandKeyDown)&&b==KEYCODE.CHAR_Z&&(d.ip.lastFocusValue=d.ip.value),d.ip.loadValue($("hin").value))}if(b==KEYCODE.CTRL||b==KEYCODE.COMMAND||b==KEYCODE.LEFT_WIN||b==KEYCODE.SELECT)ctrl.commandKeyDown=
!1;switch(mode){case BROWSE:d=nui._curcell();if(0<nui.fcol&&0<nui.frow)if((b==KEYCODE.DELETE||b==KEYCODE.BACKSPACE)&&ctrl.multiSelected&&biffdata.autoSave)modeUpdate();else{if(d&&d.ip&&(d.ip.type==TYPER||d.ip.type==SELECTOR||d.ip.type===MSELECTOR)&&ifTextInputKeycode(a)&&2>ctrl.multiSelected.length)return nui.keyUp(a)}else switch(b){case KEYCODE.CHAR_N:newData();break;case KEYCODE.CHAR_E:modeUpdate();break;case KEYCODE.CHAR_D:modeBuilder();break;case KEYCODE.CHAR_R:var e=a.shiftKey;a.ctrlKey||ctrl.currentController.load(e?
"&reset":"","",function(){mode==BROWSE&&(browse._init(),browse._focus())})}break;case UPDATE:if(b!=KEYCODE.DELETE&&b!=KEYCODE.BACKSPACE||!ctrl.multiSelected.length)return nui.keyUp(a);for(b=0;b<ctrl.multiSelected.length;b++)(d=ctrl.multiSelected[b])&&d.ip&&d.id&&!d.classList.contains("read-only_cell")&&(d.ip.loadValue(""),d.ip.blur());return!1;case BUILDER:if(a.ctrlKey)switch(b){case KEYCODE.CHAR_Z:a.ctrlKey&&builder.undo();break;case KEYCODE.CHAR_Y:a.ctrlKey&&builder.redo()}else if(ctrl.ignoreNextV&&
b==KEYCODE.CHAR_V)ctrl.ignoreNextV=null;else{if(b!=KEYCODE.DELETE&&b!=KEYCODE.BACKSPACE||!ctrl.multiSelected.length)return e=builder.cellData[nui.fcol+","+nui.frow],(b==KEYCODE.DELETE||b==KEYCODE.BACKSPACE)&&mode==BUILDER&&e&&e.noDelete?!1:nui.keyUp(a);a={};for(b=0;b<ctrl.multiSelected.length;b++)if((d=ctrl.multiSelected[b])&&d.ip&&d.id){var f=parseInt(d.id.split("_")[1]);d=parseInt(d.id.split("_")[2]);if(builder.ifAdjacent(f,d)){var g=a[d];g||(g=[],a[d]=g);0<g.length&&f!==g[g.length-1]+1||g.push(f)}else builder.setField(f,
d,""),builder.setDescription(f,d)}for(e in a)d=a[e],shiftData(d[0],-1*d.length,!0,parseInt(e));builder.renderAll()}}}};window.addEventListener("resize",eventWindowResize);function eventWindowResize(){nui&&nui._updateFocus();ctrl.currentController&&ctrl.currentController.resize()}var floatingPanels=[];function removeFloatinPanel(a){for(var b=0;b<floatingPanels.length;b++)floatingPanels[b].id==a,floatingPanels.splice(b,1),b--}function delayedClearDropWin(){}
function clearDropWin(){if(!ctrl.dropWinLock&&!ctrl.dropMenuLocked)if(ctrl.dropWin)ctrl.dropWin=!1;else{var a;for(a=0;a<floatingPanels.length;a++)floatingPanels[a].style.display="none",floatingPanels[a].colorPicker&&removeFloatingColorPicker(floatingPanels[a],!0);floatingPanels=[];ctrl.dropWinOpenFunc=null;ctrl.dropWinScrollLock=!1;window.shortcut&&(window.shortcut.attached=!1);_hideMsg()}}
function removeFloatingColorPicker(a,b){var c=ctrl.dropWinColorPickerNotConfirmed.findIndex(function(b){return b===a});-1<c&&(b&&a.colorPicker.resetToOriginHex(),a.colorPicker.dropWinListStartX&&delete a.colorPicker.dropWinListStartX,ctrl.dropWinColorPickerNotConfirmed.splice(c,1))}function clearCopyAvailableDaysWin(a){!ctrl.closeCopyAvailableDays||!a&&event.target.closest("#copyAvailableDays")||($("copyAvailableDays").style.display="none")}
document.onmousedown=function(a){if(ctrl.lockAll)return!1;a||(a=window.event);if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);var c=ifRightClick(a),d=$("nuicelltable"),e=d&&b.getAttribute("data-x")&&b.getAttribute("data-y"),f="focus"===b.id;!c&&1<ctrl.multiSelected.length&&!a.shiftKey&&(e||f)&&clearMultiSelect();!c&&(e&&d.contains(b)||f)&&(b=getAbsoluteCoor(a.clientX,a.clientY,!0),b=nui._getCellFromAbsoluteCoor(b[0],b[1]))&&(d=b.id.split("_"),b=parseInt(d[1]),
d=parseInt(d[2]),0===b||0===d?(0===b&&0===d?(ctrl.multiSelect=nui._getcell(0,0),ctrl.multiSelectEnd=nui._getcell(nui.maxX,nui.maxY)):0===b?(ctrl.multiSelect=nui._getcell(0,d),ctrl.multiSelectEnd=nui._getcell(nui.maxX,d)):0===d&&(ctrl.multiSelect=nui._getcell(b,0),ctrl.multiSelectEnd=nui._getcell(b,nui.maxY)),processMultiSelect(b,d)):(mode!==BUILDER||builder.cellData[b+","+d]||builder.freeData[b+","+d]||(ctrl.multiSelect=nui._getcell(b,d)),f&&nui._focus(b,d,!0,!0)));ctrl.autoLogoutInterval&&(ctrl.idleInitRecord=
(new Date).getTime());ctrl.mouseIsDown=!0;c||dragFloatingWinStart(a);if(ctrl.focusAction)return ctrl.focusAction=!1};document.addEventListener("compositionstart",function(){ctrl.IMEStatus=1});document.addEventListener("compositionend",function(){ctrl.IMEStatus=2});
function cellMouseDown(a){var b;a||(a=window.event);if(a.target)var c=a.target;else a.srcElement&&(c=a.srcElement);3==c.nodeType&&(c=c.parentNode);for(b=c;c&&(!c.id||"_"!=c.id.charAt(0));)c=c.parentNode;if(c){if(!ifRightClick(a)&&!b.onmousedown)if(mode==BROWSE){if(disableSelection(document.body),!biffdata.ifListingPage()||a.shiftKey)ctrl.dragStartX=a.clientX,ctrl.dragStartY=a.clientY,loadBuilderCellPos(),ctrl.multiSelect=c}else if(mode==BUILDER){disableSelection(document.body);b=c.getAttribute("data-x");
var d=c.getAttribute("data-y");builder.cellData[b+","+d]||builder.freeData[b+","+d]||(ctrl.dragStartX=a.clientX,ctrl.dragStartY=a.clientY,loadBuilderCellPos(),ctrl.multiSelect=c)}cellClick(a)}}
function nuiTableTouchSimulatedMouseClick(a){var b=a.target,c=(mode===BUILDER?builder:biffdata).getSectionLength();if(0<c&&b.id.startsWith("nuiSectionTab"))a=parseInt(b.id.substr(13)),0>a||a>c-1||nui.openSection(a);else if(c=b.closest("[id^=_]")){biffdata.ifListingPage()&&(browse.focusbcell=c.browseIndex,browse._focus());c===nui._curcell()&&"U"===c.ip.type&&ctrl.uploadTargetCell&&c.ip.click();if(c.classList.contains("nuiFreeCell"))if((b=a.target.closest("a"))&&b.href)window.open(b.href,"_blank");
else if(c.onclick)c.onclick();cellClick(a)}}
function cellTouchSimulatedContextMenu(a){var b=a.target.closest("[id^=_]");if(b&&!b.classList.contains("header"))if(b.classList.contains("nuiFreeCell"))if((a=a.target.closest("a"))&&a.href)window.open(a.href,"_blank");else{if(b.onclick)b.onclick()}else{if(biffdata.ifListingPage())browse.focusbcell=b.browseIndex,browse._focus();else{var c=b.id.split("_");b=parseInt(c[1]);c=parseInt(c[2]);nui._focus(b,c,!1,!0)}nui.focus.dispatchEvent(new MouseEvent("contextmenu",a))}}
function nuiMouseDown(a){a||(a=window.event);if(mode==BUILDER&&!(20>document.body.clientHeight-a.clientY)){var b=getBuilderComponentMouseoverCell(a.clientX,a.clientY,!0),c=parseInt(b[0]);b=parseInt(b[1]);ctrl.dragStartX=a.clientX;ctrl.dragStartY=a.clientY;if(a=nui._getcell(c,b))ctrl.dragging=a,a.biff?ctrl.builderMoveStart=a:(c=parseInt(a.id.split("_")[1]),b=parseInt(a.id.split("_")[2]),(c=nui._getcell(c-1,b))&&(a.classList.contains("builderFieldWhite")||a.classList.contains("builderFieldWhiteSingle"))&&
(ctrl.builderColspanStart=c.biff)),disableSelection(document.body)}}document.body?document.body.onscroll=function(){5<document.body.scrollTop&&(document.body.style.overflowY="auto")}:document.documentElement&&(document.documentElement.onscroll=function(){5<document.documentElement.scrollTop&&(document.documentElement.style.overflowY="auto")});
document.onclick=function(a){handleMobileLayoutSelectionOpenState(a);handleAccessFormSelectionOpenState(a);if(ctrl.lockAll)return!1;a||(a=window.event);if(2!==a.button){if(checkMselectorItemClick(a))return!0;if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);if(b&&b.id&&7<b.id.length&&"pathTab"==b.id.substring(0,7))return!0;var c=document.querySelector("table.totalSummaryTable");if(c&&c.contains(b))return!0;clearTooltip();clearhelpShower();clearDropWin();
clearCopyAvailableDaysWin();$("filterPanel")&&($("filterPanel").style.display="none");$("rightKeyFloat")&&($("rightKeyFloat").style.display="none");(b=ifRightClick(a))&&cellClick(a);return b&&!ctrl.rightKeyMenuOff?showRightKeyMenu(a):!0}};function handleMobileLayoutSelectionOpenState(a){var b=$("mobileLayoutSelect");b&&(a.target.closest("#mobileLayoutSelect")?b.dataset.open="true"!==b.dataset.open:b.dataset.open="false")}var accessFormOpenedSelection=void 0;
function handleAccessFormSelectionOpenState(a){$("globalAccessForm")&&((a=a.target.closest(".globalAccessFormSelection"))?a===accessFormOpenedSelection?a.dataset.open?(a.dataset.open="false",accessFormOpenedSelection=void 0):(a.dataset.open="true",accessFormOpenedSelection=a):(a.dataset.open="true",accessFormOpenedSelection&&(accessFormOpenedSelection.dataset.open="false",0===accessFormOpenedSelection.selectedIndex&&(accessFormOpenedSelection.style.visibility="hidden")),accessFormOpenedSelection=
a):accessFormOpenedSelection&&(accessFormOpenedSelection.dataset.open="false",0===accessFormOpenedSelection.selectedIndex&&(accessFormOpenedSelection.style.visibility="hidden"),accessFormOpenedSelection=void 0))}
function checkMselectorItemClick(a){a||(a=window.event);if(a=e_target(a)){var b=a.closest(".multiSel");if(b)return a===b?mselectorItemClick(a):a.tagName&&"input"==a.tagName.toLowerCase()&&a.type&&"checkbox"===a.type?mselectorItemClick(b,!0):a.tagName&&"span"==a.tagName.toLowerCase()?mselectorItemClick(b):(a.classList.contains("iniAva")||a.classList.contains("avatar"))&&mselectorItemClick(b),!0;if(a.classList.contains("closeIcon")&&a.parentNode.classList.contains("selectedMultiOption"))return b=a.closest(".selectedMultiOption"),
a=a.classList.contains("closeIcon"),mselectorSelectedMultiOptionClick(b,a),!0;if(!a.classList.contains("closeIcon")&&a.closest(".selectedMultiOption")||a.classList.contains("msContainer"))return $("focus").click(),!0;if(a.classList.contains("nuiCell")&&a.querySelector(".msContainer"))return $("focus").classList.contains("firstFocus")?$("focus").classList.remove("firstFocus"):$("focus").click(),!0}}
document.oncontextmenu=function(a){a||(a=window.event);var b=!0;ctrl.rightKeyMenuOff||(b=showRightKeyMenu(a));cellClick(a);if(a.target)if(a.target.closest(".nuiFreeCell"))b=!0;else if(a.target.closest("#dropWinList")||a.target.closest(".multi-range-slider-main"))b=!1;return b};
function processFocusDotDragEditMode(){for(var a=ctrl.multiSelect,b=0;b<ctrl.multiSelected.length;b++){var c=ctrl.multiSelected[b];if(c&&!c.classList.contains("hide")&&c.ip&&!c.ip.readOnly&&c.ip.type!==UPLOADER){if(a.ip.type===MSELECTOR){var d=a.ip.getRawValue();var e="|";c.ip.type!==MSELECTOR&&(a.ip.biff&&a.ip.biff.attr&&a.ip.biff.attr.sep_m?e=a.ip.biff.attr.sep_m:window.defaultMultiSelectSeparator&&(e=window.defaultMultiSelectSeparator));d=d.join(e)}else d=a.ip.getValue();c.ip.type===MSELECTOR?
multipleSelectFocusDotDrag(c,d):(c.ip.type===TYPER&&subTableExtendProcess(d,c.ip.biff),c.ip.loadValue(d,!1,null,!1));c.ip.blur()}}biffdata.autoSave&&autoSaveInterval(500)}
function multipleSelectFocusDotDrag(a,b){var c=selpro.getSelectList(a.ip.biff.domainId),d="",e=[];b.split("|").forEach(function(a,b){b=c.nodeIds[c.options.indexOf(a)];void 0!==b&&(0>b&&(b="RAGIC_ATINSZ8_"+a),e.push(b))});d=e.join("|");a.ip.biff.nodeId=d;a.ip.biff.value=b;a.ip.loadValue(b);a.ip.render();$("IX"+a.ip.biff.x+"Y"+a.ip.biff.y).querySelectorAll(".multiSel").forEach(function(a){a.getAttribute("value");var b=a.getAttribute("nodeid");null!==b&&void 0!==b&&(e.includes(b)?a.querySelector("input").checked=
!0:a.querySelector("input").checked=!1)})}
document.onmouseup=function(a){ctrl.mouseIsDown=!1;if(ctrl.lockAll)return!1;a||(a=window.event);var b=ctrl.dragging;$("floatingMouseWin")&&($("floatingMouseWin").style.display="none");ctrl.focusDotDrag&&ctrl.multiSelect&&0<ctrl.multiSelected.length&&(mode!=BROWSE||biffdata.autoSave||modeUpdate(),canSaveData()&&processFocusDotDragEditMode(),ctrl.focusDotDrag=!1);endMultiSelect(a);ctrl.builderMoveStart&&endBuilderMove(a);ctrl.builderComponentDragStart&&endBuilderComponentDrop(a);if(mode==BUILDER&&(b&&
(b.dWidth||0===b.dWidth?ctrl.setWidth(b.index,b.dWidth,biffdata.widthCommand,function(a){biffdata.widthCommand=a}):(b.dHeight||0===b.dHeight)&&ctrl.setWidth(b.index,b.dHeight,biffdata.heightCommand,function(a){biffdata.heightCommand=a})),ctrl.builderColspanStart&&(ctrl.builderColspanStart=null),1<ctrl.multiSelected.length)){var c=ctrl.multiSelected[0],d=c.getAttribute("data-x"),e=c.getAttribute("data-y");1<d&&"focus"===a.target.id&&(builderHelperPanelSwitch(2),setPropertyTable(c),setStylePane(builder.cellData[d+
","+e]),ctrl.currentTabContainer&&ctrl.currentTabContent&&openTab($(ctrl.currentTabContainer),$(ctrl.currentTabContent),$("propSel"),$("propSpace")))}b&&(b.dWidth=0,b.dHeight=0,rm($("dcelldiv")),loadColumnXLimit(),ctrl.dragging=null,enableSelection(document.body),"dwcell"===b.className&&nui.resetUnhideArrowsTooltip(b.index));ctrl.dragWin&&dragFloatWinEnd();(a.target||a.srcElement).tagName&&"SELECT"==(a.target||a.srcElement).tagName.toUpperCase()||tutorialCheckProgress()};
function endMultiSelect(){ctrl.multiSelect=null;enableSelection(document.body)}
function clearMultiSelect(){if(!(2>ctrl.multiSelected.length)){var a;for(a=0;a<ctrl.multiSelected.length;a++){var b=ctrl.multiSelected[a];if(b){var c=parseInt(b.id.split("_")[1]);b=parseInt(b.id.split("_")[2]);b=nui._getcell(0,b);c=nui._getcell(c,0);b&&b.classList.remove("focusSideCell");c&&c.classList.remove("focusSideCell")}}ctrl.multiSelected=[];$("quicksum")&&($("quicksum").style.display="none");nui.multiFocus=null;nui._updateFocus()}}
function processMultiSelect(a,b,c){if(ctrl.multiSelect&&ctrl.multiSelectEnd){disableSelection(document.body);browse.focusbcell=-1;browse._focus();var d=-1,e=-1;c&&(d=nui.fcol,e=nui.frow);clearMultiSelect();var f=ctrl.multiSelect.id,g=parseInt(f.split("_")[1]);f=parseInt(f.split("_")[2]);a=parseInt(a);b=parseInt(b);if(g>a){var k=g;g=a;a=k}f>b&&(k=f,f=b,b=k);if(mode===BUILDER){if(0===g&&0===f){f=g=1;a=nui.maxX;b=nui.maxY;for(k=g;k<=a;k++){var l=nui._getcell(k,0);l&&l.classList.add("focusSideCell")}for(k=
f;k<=b;k++)(l=nui._getcell(0,k))&&l.classList.add("focusSideCell")}else if(0===g||0===a)for(0===g&&(g=1,a=nui.maxX),0===a&&(a=1,g=nui.maxX),k=f;k<=b;k++)(l=nui._getcell(0,k))&&l.classList.add("focusSideCell");else if(0===f)for(f=1,b=nui.maxY,k=g;k<=a;k++)(l=nui._getcell(k,0))&&l.classList.add("focusSideCell");nui._setFocusColorBack(!0)}c&&(nui.fcol=d,nui.frow=e);nui._updateFocus(g,a,f,b);if(k=ctrl.multiSelectAbsCoor){c=k[0];d=k[1];e=k[3];g="";b=a=f=0;for(k=k[2];k<=e;k++){for(l=c;l<=d;l++){var m=null,
n=nui._getCellFromAbsoluteCoor(l,k);n&&!n.classList.contains("hide")&&(ctrl.multiSelected.push(n),n.ip&&n.ip.biff?m=n.ip.biff.value:n.biff?m=n.biff.value:mode!==BUILDER&&n.innerHTML&&(m=n.innerHTML),g+=m||"");l!==d&&(g+="\t");n&&n.colSpan&&(l+=n.colSpan-1);m&&(f++,isNaN(m)||(a++,b+=parseFloat(m)));$("quicksum").style.display="";rm($("quicksum"));0<a&&($("quicksum").innerHTML+="<span>Average: "+formatNumber(b/a,"#,###.##")+"</span>");f&&($("quicksum").innerHTML+="<span>Count: "+formatNumber(f,"#,###")+
"</span>");b&&($("quicksum").innerHTML+="<span>Sum: "+formatNumber(b,"#,###.##")+"</span>")}k<e&&(g+="\n")}mode!==UPDATE&&$("hin").setValue(g);$("hin").hinFocus=!1;hinFocus()}}}
document.onmousemove=function(a){a||(a=window.event);ctrl.browseMode="M";var b=ctrl.dragging;ctrl.autoLogoutInterval&&(ctrl.idleInitRecord=(new Date).getTime());mode==BUILDER&&(10<Math.abs(ctrl.dragStartX-a.clientX)+Math.abs(ctrl.dragStartY-a.clientY)&&((ctrl.builderMoveStart||ctrl.builderComponentDragStart)&&builderMoveCellMouseOver(a),ctrl.builderMoveStart?updateBuilderMove(a):ctrl.builderWidgetMoveStart?updateBuilderWidgetMove(a):ctrl.builderComponentDragStart&&updateBuilderComponentMove(a)),ctrl.builderColspanStart&&
updateBuilderColspan(a));if(ctrl.multiSelect&&ctrl.mouseIsDown){var c=getBuilderComponentMouseoverCell(a.clientX,a.clientY,!0),d=parseInt(c[0]);c=parseInt(c[1]);ctrl.multiSelectEnd=nui._getcell(d,c);(ctrl.multiSelectEnd&&ctrl.multiSelectEnd.id!==ctrl.multiSelect.id||1<ctrl.multiSelected.length)&&ctrl.multiSelectEnd&&(d=parseInt(ctrl.multiSelectEnd.getAttribute("data-x")),c=parseInt(ctrl.multiSelectEnd.getAttribute("data-y")),(mode!==BUILDER||0!==d&&0!==c||0===d&&a.target&&a.target.classList.contains("sideCellLeft")||
0===c&&a.target&&a.target.classList.contains("sideCell"))&&processMultiSelect(d,c),mouseBelowScreen(a)?nui.main.scrollTop+=15:mouseAboveListingPageRows(a)&&(nui.main.scrollTop-=15))}if(b&&"dwcell"==b.className){c=0;if(b.cellcolspan&&1<b.cellcolspan){var e=b.cellcolspan;d=parseInt(a.clientX)-ctrl.draggingDcellX;d=Math.round(d/e)-100;for(var f=0;f<e;f++){var g=b.index+parseInt(e)-1-f;c+=nui.setWidth(g,b,d).clientWidth}}else d=parseInt(a.clientX)-ctrl.draggingDcellX-100,c=nui.setWidth(b.index,b,d).clientWidth;
mode===BROWSE&&nui.freezeX(biffdata.dataminX+biffdata.freezeX);-100<=d&&(b.style.left=a.clientX+3+"px");floatMouseWin(a,c+"px");nui._updateFocus();mode===BUILDER&&(b=parseInt(b.index),ctrl.setWidth(b,c-100,biffdata.widthCommand,function(a){biffdata.widthCommand=a;builder.hiddenColumnIndex=findAllHiddenColumnIndexs()},getOriginWidth(b)),0>=c?nui.showUnhideColumnArrows(b,!0,!0):0<c&&10>c&&nui.showUnhideColumnArrows(b,!1,!0))}else b&&"dhcell"==b.className&&(d=parseInt(a.clientY)-ctrl.draggingDcellY-
16,c=nui.setHeight(b.index,b,d).clientHeight,mode==BUILDER&&builder.ifListingPage()&&(e=builder.getFirstField())&&e.y+1==b.index&&(nui.setHeight(e.y+2,b,d),nui.setHeight(e.y+3,b,d)),nui._updateFocus(),floatMouseWin(a,c+"px"));ctrl.dragWin&&dragFloatingWin(a);if(b=ctrl.triangle)b.x&&b.y&&(d=a.clientX-b.x,c=a.clientY-b.y,2==b.dir&&0>d?(b.callback(),ctrl.triangle=null):3==b.dir&&0>c&&(b.callback(),ctrl.triangle=null)),b.x=a.clientX,b.y=a.clientY};
function ifRightClick(a){if(!a)return!1;var b;a.which?b=3==a.which:a.button&&(b=2==a.button);return b}
function cellClick(a){if(ctrl.lockAll)return!1;a||(a=window.event);if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);for(;b&&(!b.id||"_"!=b.id.charAt(0));)b=b.parentNode;if(b){$("focus").cell&&b.ip&&(b.ip.type===MSELECTOR||b.ip.type===UPLOADER)&&$("focus").cell.ip===b.ip||clearDropWin();var c=ifRightClick(a),d=parseInt(b.id.split("_")[1]),e=parseInt(b.id.split("_")[2]);if(mode==BUILDER)!nui._focus(d,e,!1,!0)&&b.ip?b.ip.click():ctrl.currentTextFocus&&textBlur(ctrl.currentTextFocus),
ctrl.focusAction=!0;else if(mode==UPDATE)!b.ip||b.ip.biff&&b.ip.biff.hasAttribute("hide")||nui.focus&&nui.focus.cell&&nui.focus.cell.ip===b.ip&&b.ip.type===MSELECTOR||(nui._focus(d,e,!1,!0)||b.ip.click(),ctrl.focusAction=!0);else if(mode==BROWSE&&!(!b.ip||b.ip.biff&&b.ip.biff.hasAttribute("hide")))if(biffdata.ifListingPage())if(c||a.shiftKey){browse._nofocus();if(c||!ctrl.multiSelect)ctrl.multiSelect=nui._getcell(d,e);nui._focus(d,e,!1,!0);ctrl.focusAction=!0;ctrl.multiSelect=nui._getcell(d,e);disableSelection(document.body)}else!browse.checkClickable()||
c||ctrl.dropWin||0!=ctrl.multiSelected.length||browseForward();else browse._nofocus(),b.ip&&b.ip.IPType==UPLOADER&&1===b.ip.biff.value.splitIgnoreEmpty("|").length&&(b.ip.biff.value.endsWith(".mp3")||b.ip.biff.value.endsWith(".mp4"))||!b.ip||b.ip&&b.ip.biff&&b.ip.biff.dataType==HEADER||biffdata.autoSave&&nui.focus&&nui.focus.cell&&nui.focus.cell.ip===b.ip&&b.ip.type===MSELECTOR||(nui._focus(d,e,!1,!0),a.shiftKey&&!ctrl.multiSelect&&(ctrl.multiSelect=nui._getcell(d,e)),ctrl.focusAction=!0,biffdata.getDataRoot(d,
e)&&(c||browseForward()))}}function fnSelect(a){if(a)if(fnDeSelect(),document.selection){var b=document.body.createTextRange();b.moveToElementText(a);b.select()}else window.getSelection&&(b=document.createRange(),b.selectNode(a),window.getSelection().addRange(b))}function mouseAboveListingPageRows(a){return 183>=a.clientY}function mouseBelowScreen(a){return a.clientY>=document.body.clientHeight}
function fnDeSelect(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}
function cellDblclick(a){a||(a=window.event);if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);for(;b&&(!b.id||"_"!=b.id.charAt(0));)b=b.parentNode;b&&b.ip&&(a=b.ip.biff,mode!==BUILDER&&a&&a.hasAttribute("hide")||(a=parseInt(b.id.split("_")[1]),b=parseInt(b.id.split("_")[2]),"L"==biffdata.lockMode||biffdata.ifListingPage()||dblclickMode(a,b)))}
function dblclickMode(a,b){if(mode!=BROWSE||canSaveData()||biffdata.ifListingPage()){if(!biffdata.autoSave||checkIfUserCanEdit()){var c=nui._getcell(a,b);c&&c.ip&&(c.ip.dblclick(),nui._focus(a,b,!0,!0))}}else modeUpdate()&&(nui._focus(a,b),setTimeout(dblclickMode,300,a,b))}
function cellMouseover(a){a||(a=window.event);if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);for(;b&&(!b.id||"_"!=b.id.charAt(0));)b=b.parentNode;b&&(mode==BROWSE&&biffdata.ifListingPage()&&b.ip&&b.ip&&(b.hasMouse=!0),b.listingPageHeader&&(parseInt(b.id.split("_")[1]),dhcellMouseover(b)),mode==BROWSE&&0==ctrl.multiSelected.length&&"M"==ctrl.browseMode&&(a=browse,a.focusbcell=b.browseIndex,a._focus()),mode!=BROWSE||browse.bcells&&0!=browse.bcells.length||
(browse._init(),browse._focus()))}function cellMouseout(a){a||(a=window.event);if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);for(;b&&(!b.id||"_"!=b.id.charAt(0));)b=b.parentNode;b&&(mode==BROWSE&&biffdata&&biffdata.ifListingPage()&&b.ip&&(b.hasMouse=!1),ctrl.editIconPlace===b&&placeEditIcon(null))}
function updateEditIconLoc(){if(biffdata.ifListingPage()){var a=ctrl.editIcon?ctrl.editIcon.cell:null;if(a){var b=nui.main,c=nui.main_outer,d=findPos(a);ctrl.editIcon.style.top=d[1]+a.offsetHeight/2-ctrl.editIcon.offsetHeight/2-ctrl.mainScrollTop+"px";ctrl.editIcon.style.left=d[0]+a.offsetWidth-ctrl.editIcon.offsetWidth-5-c.scrollLeft-b.scrollLeft+"px"}}}
function placeEditIcon(a){ctrl.editIconPlace=a;ctrl.editIconTimeout&&clearTimeout(ctrl.editIconTimeout);ctrl.editIconTimeout=setTimeout(_placeEditIcon,200)}
function _placeEditIcon(){var a=ctrl.editIconPlace;if(a){var b=a.classList.contains("nuiCellHasFieldIcon"),c=findPos(a),d=!0;userProperties&&userProperties.showListingEditIcon?d="true"===userProperties.showListingEditIcon:access&&access.showEditIcon&&(d=access.showEditIcon);if(d){ctrl.editIcon||(ctrl.editIcon=node("div"),ctrl.editIcon.className="editIcon",a&&a.ip&&a.ip.biff&&a.ip.biff.hasAttribute("ro")?(ctrl.editIcon.innerHTML='<i class="fa fa-lock"></i>',ctrl.editIcon.locked=!0):(ctrl.editIcon.innerHTML=
'<i class="fa fa-pencil"></i>',ctrl.editIcon.locked=!1),document.body.appendChild(ctrl.editIcon));d=nui.main;var e=nui.main_outer;ctrl.editIcon.style.top=c[1]+a.offsetHeight/2-ctrl.editIcon.offsetHeight/2-d.scrollTop+"px";ctrl.editIcon.style.left=c[0]+a.offsetWidth-ctrl.editIcon.offsetWidth*(b?2:1)-5-e.scrollLeft-d.scrollLeft-(ctrl.lazyRendering?nui.main.scrollLeft:0)+"px";ctrl.editIcon.onmouseover=function(){ctrl.editIcon.mouseoverTime=(new Date).getTime()};ctrl.editIcon.onclick=function(){ctrl.editIcon.mouseoverTime&&
100<(new Date).getTime()-ctrl.editIcon.mouseoverTime?(ctrl.editIcon&&(document.body.removeChild(ctrl.editIcon),ctrl.editIcon=null),nui._focus(a.ip.biff.x,a.ip.biff.y)):browseForward()};ctrl.editIcon.cell=a}}}function cellMouseoverByIndex(a){if(mode==BROWSE&&0==ctrl.multiSelected.length&&"M"==ctrl.browseMode){var b=browse;b.focusbcell=a;b._focus()}}
function getInsertComponentShiftSize(){if(ctrl.dragging){var a=ctrl.dragging.getAttribute("type");return"SUBTABLE_NEW"==a||"SUBTABLE_REF"==a||"SUBTABLE_MULTI"==a?5:1}return 1}
function builderMoveCellMouseOver(a){var b=getBuilderComponentMouseoverCell(a.clientX,a.clientY,!1);if(!(0>=b[0]||0>=b[1])){var c=parseInt(b[0]);a=parseInt(b[1]);if(!ctrl.tempCoords||ctrl.tempCoords[0]!=b[0]||ctrl.tempCoords[1]!=b[1]){ctrl.tempCoords=[b[0],b[1]];0<=builder.tempDragDropShiftRow&&a!=builder.tempDragDropShiftRow&&(shiftData(builder.tempDragDropShiftRow,-1*builder.tempDragDropShiftRowSize,!1),builder.tempDragDropShiftRow=-1,builder.tempDragDropShiftRowSize=0,builder.renderAll());var d=
getInsertComponentShiftSize(),e=builder.numOfShiftNeeded(c,a,d);e&&0<e&&!ctrl.builderMoveStart&&(builder.tempDragDropShiftRow=a,builder.tempDragDropShiftRowSize=e,shiftData(a-1,e,!1),builder.renderAll());e=c;try{e=parseInt(builder.relativePositions[c+","+a].split(",")[0])}catch(u){}var f=nui._getcellV2(e,a);ctrl.builderMoveEnd=f;if(0<c&&0<a){var g=$("dropTarget");g.style.display="";g.style.top=b[3]-1+"px";g.style.left=b[2]-1+"px";var k=nui._getcellV2(e-1,a),l=nui._getcellV2(e+1,a),m=ctrl.dragging;
b=[];var n=!1,q=!1;m||(m=ctrl.builderMoveStart);if(m){var r=m.id;if(r.startsWith("addField")||m.getAttribute("type"))"DESC"==m.getAttribute("type")&&(n=!0),r=ctrl.dragging.actionButton?1:2;else{var p=parseInt(r.split("_")[1]);var t=parseInt(r.split("_")[2]);r=p+","+t;nui._getcell(p,t+1).classList.contains("builderFocusRight")&&(q=!0);builder.cellData[r]&&!q?r=parseInt(nui._getcellV2(p+1,t).colSpan)+1:builder.cellData[r]?r=parseInt(m.colSpan):builder.freeData[r]?(n=!0,r=parseInt(m.colSpan)):r=2;for(var v=
0;v<r;v++)b.push(p+v+"_"+t)}}if(1<d){g.style.border="3px dashed #888";for(v=d=0;3>v;v++)d+=nui._getcell(c+v,a).offsetWidth;g.style.width=d-2+"px";g.style.height=f.offsetHeight+nui._getcell(c,a+1).offsetHeight+nui._getcell(c,a+2).offsetHeight+nui._getcell(c,a+3).offsetHeight-2+"px"}else if(n||q||!(k&&k.builderField&&k!=m||l&&l.builderField&&l!=m))if(!n&&q&&(k&&k.builderField||l&&l.builderField))g.style.border="3px dashed #888",g.style.width=f.offsetWidth-2+"px",g.style.height=f.offsetHeight+nui._getcell(c,
a+1).offsetHeight+nui._getcell(c,a+2).offsetHeight+nui._getcell(c,a+3).offsetHeight-2+"px";else{d=builder.getFirstField();d=!(!d||!builder.cellData[d.x+1+","+d.y]);if(builder.ifListingPage()||builder.createAsListingPage&&d&&!n)g.style.border="3px dashed #FBB",g.style.width=f.offsetWidth-2+"px";else{g.style.border="3px dashed #888";for(v=d=0;v<r;v++)d+=nui._getcellV2(c+v,0).offsetWidth;g.style.width=d-2+"px";for(v=0;v<r;v++)if(c=nui._getcellV2(e+v,a),!(0<=b.indexOf(e+v+"_"+a))&&(c.builderField||c.builderFreeField||
c.classList.contains("builderFieldWhite")||c.classList.contains("builderFieldWhiteSingle")||"none"==c.style.display)){g.style.border="3px dashed #FBB";break}}g.style.height=f.offsetHeight-2+"px"}else g.style.border="3px dashed #FBB",g.style.width=f.offsetWidth-2+"px",g.style.height=f.offsetHeight-2+"px"}ctrl.builderMoveCellMouseover=f}}}
function focusMouseDown(a){if(mode==BUILDER)builder.cellData[nui.fcol+","+nui.frow]||builder.freeData[nui.fcol+","+nui.frow]?ctrl.builderMoveStart=nui._curcell():ctrl.multiSelect=nui._curcell(),ctrl.dragStartX=a.clientX,ctrl.dragStartY=a.clientY,disableSelection(document.body);else if(mode==BROWSE||mode==UPDATE)biffdata.ifListingPage()||(a=getBuilderComponentMouseoverCell(a.clientX,a.clientY,!0),ctrl.multiSelect=nui._getcell(a[0],a[1]),disableSelection(document.body)),(a=nui._curcell())&&a.ip&&a.ip.focusClickFunc&&
a.ip.focusClickFunc()}function focusClick(a){(a=nui._curcell())&&a.ip&&2>ctrl.multiSelected.length&&a.ip.click()}
function focusDblClick(a){a=nui._curcell();if(mode===BUILDER||!a||!a.classList.contains("hide"))if(mode!==BROWSE||checkIfUserCanEdit()){if(a){a.ip&&a.ip.dblclick();if(!a.ip&&mode==BROWSE){var b=biffdata.getDataRoot(nui.fcol,nui.frow+1);b&&browseForward(b)}mode!=BUILDER||a.ip||(b=ifSingleIntoTable(a),(a.oldClassName&&-1!=a.oldClassName.indexOf(BUILDER_EMPTY_CLASS)&&-1!=a.className.indexOf("builderFocus")||b||builder.mode==BUILDER_TEXT)&&nui._createIP(a).dblclick())}canSaveData()&&(a=nui.fcol,b=nui.frow,
biffdata.fs&&0<parseInt(biffdata.fs)&&(biffdata.keyField?biffdata.subtableKeyFields&&0<biffdata.subtableKeyFields.length&&(showSubtableRowDelete(a,b),nui._updateDelIcon()):(showSubtableRowDelete(a,b),nui._updateDelIcon())))}}var focus=$("focus");simulateMouseClickOnMobile(focus,focusSimulatedMouseClick,focusSimulatedContextMenu);
function focusSimulatedMouseClick(a){var b=nui._curcell();b&&(b.ip&&b.ip.type===TYPER?(focusDblClick(a),b.ip.typing&&(a=$("hin"),a.hinFocus=!0,b=a.value.length,hinFocus(),a.setSelectionRange(b,b))):b.ip&&b.ip.biff&&b.ip.biff.attr&&b.ip.biff.attr.checkbox&&!b.ip.biff.attr.ro?nextSelectOption(b.ip):focusClick(a))}function focusSimulatedContextMenu(a){nui.focus.dispatchEvent(new MouseEvent("contextmenu",a))}
function focusDotMouseDown(a){a||(a=window.event);var b=nui._curcell();1<ctrl.multiSelected.length&&(b=ctrl.multiSelected[0]);if(b){if(mode==BUILDER){var c=b.biff;c&&"F"==c.objectType?ctrl.builderColspanStart=c:(ctrl.multiSelect=b,ctrl.dragStartX=a.clientX,ctrl.dragStartY=a.clientY)}else ctrl.multiSelect=b,ctrl.focusDotDrag=!0;disableSelection(document.body)}}var columnXLimit,columnSizes;
function loadColumnSizes(){columnSizes=[];var a=nui,b;for(b=0;20>b;b++){var c=a._getcell(b,0);if(!c)break;columnSizes[b]=parseInt(c.offsetWidth)}}function loadColumnXLimit(){columnXLimit=[];var a=nui,b,c=nui.main_outer.scrollLeft;for(b=0;20>b;b++){var d=a._getcell(b,0);if(!d)break;d=findPos(d);columnXLimit[b]=parseInt(d[0])-c}}
function updateBuilderColspan(a){var b=ctrl.builderColspanStart;a=a.clientX;var c;columnXLimit||loadColumnXLimit();for(c=0;c<columnXLimit.length;c++)if(a+nui.main.scrollLeft<columnXLimit[c]){var d=c;break}d="B"==b.objectType?d-b.x-1:d-b.x;a=!1;if("F"==b.objectType){if(!isCellColspanSpreadable(b.x,b.y,d))return;a=b.styling.cs;a=a!=d;1<d?b.styling.cs=""+d:1==d&&delete b.styling.cs;1<=d&&($("desc_cs").value=""+d)}a&&(mode!=BUILDER&&nui.init(),builder.renderAll(),nui._updateFocus())}
function cellOnpaste(a,b){if(!clipboardUploadImage(a,b)&&(a=nui._curcell()))if(b=a.ip,mode==BROWSE){if(modeUpdate(),a&&b&&b.onpaste)b.onpaste()}else if(b||(b=nui._createIP(a)),b&&b.onpaste)b.onpaste()}
function processPaste(){var a=$("hin");a.value=a.value.trim();var b=a.value,c=nui,d=-1!=b.indexOf("\t"),e=-1!=b.indexOf("\n");c=c._curcell();if(mode==BUILDER){clipboardMatch(b);if(ctrl.clipboard)if(b=ctrl.clipboard.split(","),5<=b.length&&"F"===b[0]?saveBuilderMode(BUILDER_TEXT,!0):saveBuilderMode(BUILDER_FIELDS,!1),d||e){d=ctrl.clipboard.split("\n");ctrl.copyPasteCellRelative={};ctrl.pastedCells=[];for(e=0;e<d.length;e++)for(b=d[e],b=b.split("\t"),c=0;c<b.length;c++){var f=b[c];builder.isPositionValid(nui.fcol+
c,nui.frow+e)&&builder.setContent(nui.fcol+c,nui.frow+e,f)}ctrl.pastedCells.forEach(function(a){if(a.hasAttribute("l")){var b=ctrl.copyPasteCellRelative[a.attr.l];b&&(a.attr.l=b)}});ctrl.copyPasteCellRelative={};ctrl.pastedCells=[];var g=builder.cellData[nui.fcol+","+nui.frow];g&&(a.value=g.value)}else builder.isPositionValid(nui.fcol,nui.frow)&&builder.setContent(nui.fcol,nui.frow,ctrl.clipboard);else if(d||e)if(builder.mode==BUILDER_TEXT)builder.setContent(nui.fcol,nui.frow,b?b:"");else if(d)builder.isPositionValid(nui.fcol,
nui.frow)&&builder.setContent(nui.fcol,nui.frow,b?b:"");else for(d=b.split("\n"),e=0;e<d.length;e++)b=d[e],builder.isPositionValid(nui.fcol,nui.frow+e)&&builder.setContent(nui.fcol,nui.frow+e,b);else builder.setContent(nui.fcol,nui.frow,b?b:"");builder.renderAll();(g=nui._curcell().ip)&&!ctrl.clipboard&&(g.focused=!0,g.typing=!0);ctrl.ignoreNextV=!0}else if(canSaveData()&&c&&c.ip&&!c.ip.typingLock)if(!d&&!e||nui._atHighRow())c.ip.pasting=!0,c.ip.loadValue(b),c.ip.typing=!0,c.ip.focused=!0,c.ip.render(),
c.ip.pasting=!1,nui._updateFocus();else if(confirm(lm.pasteMultipleCells)){d=b.split("\n");for(e=0;e<d.length;e++)for(b=d[e],b=b.split("\t"),c=0;c<b.length;c++)if((f=b[c])&&(a=nui._getcell(nui.fcol+c,nui.frow+e))&&a.ip&&(0===e&&0===c&&(g=f),a&&a.ip&&a.ip.biff)){var k=a.ip.biff;subTableExtendProcess(f,k);k.hasAttribute("ro")||k.hasAttribute("hide")||(a.ip.pasting=!0,a.ip.loadValue(f),a.ip.render(),a.ip.pasting=!1)}g&&$("hin").setValue(g)}else c.ip.pasting=!0,c.ip.loadValue(b),c.ip.typing=!0,c.ip.focused=
!0,c.ip.render(),c.ip.pasting=!1,nui._updateFocus();tutorialCheckProgress()}function clipboardMatch(a){if(ctrl.clipboard){var b=ctrl.clipboard.split("\n");a=a.split("\n");for(var c=0;c<a.length&&c<b.length;c++)for(var d=b[c].split("\t"),e=a[c].split("\t"),f=0;f<e.length&&f<d.length;f++){var g=d[f],k=e[f];if(""!=k||""!=g)if(g=g.split(","),5>g.length||k!=g[4].trim()){ctrl.clipboard=null;break}}}}
function dvcellMouseover(a){rm($("dcelldiv"));var b=a.getAttribute("data-y"),c=nui.main_outer,d=nui.main;a.onmouseleave=dcellMouseout;var e=node("div");e.className="dhcell";var f=findPos(a);e.style.top=f[1]-d.scrollTop+a.offsetHeight-4+"px";e.style.left=f[0]-c.scrollLeft-d.scrollLeft+"px";e.style.height="4px";e.style.width=a.offsetWidth+"px";e.style["z-index"]="200";e.index=b;e.title=b;e.onmousedown=function(a){ctrl.dragging=this;ctrl.draggingDcellY=f[1]-d.scrollTop;disableSelection(document.body)};
e.onmouseover=function(){clearTimeout(ctrl.dcellTimeout)};$("dcelldiv").appendChild(e);biffdata.ifListingPage()&&(a=$("_"+biffdata.dataminX+"_"+b))&&a.ip&&a.ip.biff&&(biffdata.keyField?showListingPageCheckbox(a.ip.biff.parentNodeId):showListingPageCheckbox(a.ip.biff.nodeId))}
function dhcellMouseover(a){if(!(ctrl.dragging||mode!=BUILDER&&6>a.clientWidth)){rm($("dcelldiv"));var b=a.getAttribute("data-x"),c=a.getAttribute("data-y"),d=$("_"+(b-1)+"_"+c),e=nui.main_outer,f=nui.main;a.onmouseleave=dcellMouseout;if(1!=b&&mode==BUILDER){c=node("div");c.className="dwcell";var g=findPos(a);c.id="dwcell"+(b+1);c.style.top=g[1]-f.scrollTop+"px";c.style.left=g[0]-e.scrollLeft-f.scrollLeft-3+"px";c.style.height=a.offsetHeight+"px";c.style.width="6px";c.style["z-index"]="200";c.index=
b-1;c.title=colNames[b-1];c.onmousedown=function(a){ctrl.dragging=this;ctrl.draggingDcellX=g[0]-e.scrollLeft-f.scrollLeft-d.offsetWidth;disableSelection(document.body)};$("dcelldiv").appendChild(c)}c=node("div");c.className="dwcell";g=findPos(a);var k=a.biff;k&&k.absoluteX&&(b=k.absoluteX);c.id="dwcell"+b;c.style.top=g[1]-f.scrollTop+"px";c.style.left=g[0]-e.scrollLeft-f.scrollLeft+a.offsetWidth-2+"px";c.style.height=a.offsetHeight+"px";c.style.width="6px";c.style["z-index"]="200";c.index=b;c.title=
colNames[b];c.cellcolspan=a.getAttribute("colspan")||1;c.onmousedown=function(a){ctrl.dragging=this;ctrl.draggingDcellX=g[0]-e.scrollLeft-f.scrollLeft;disableSelection(document.body)};c.onmouseover=function(){clearTimeout(ctrl.dcellTimeout)};clearTimeout(ctrl.dcellTimeout);$("dcelldiv").appendChild(c)}}function dcellMouseout(){ctrl.dcellTimeout=setTimeout(rm,200,$("dcelldiv"))}var builderCellTopPos,builderCellLeftPos;
function loadBuilderCellPos(){builderCellTopPos=[];builderCellLeftPos=[];var a=nui,b,c=mode==BUILDER?builder.maxX:biffdata.maxX,d=mode==BUILDER?builder.maxY:biffdata.maxY;for(b=0;b<d+20;b++){var e=a._getcell(0,b);e&&(e=findPos(e),builderCellTopPos[b]=parseInt(e[1]))}for(b=0;b<=c+5;b++)if(e=a._getcell(b,0))e=findPos(e),builderCellLeftPos[b]=parseInt(e[0])-nui.main_outer.scrollLeft}
function getAbsoluteCoorFromId(a,b){b=parseInt(b);var c=0;a=parseInt(a);for(var d=1;d<=a;d++){var e=nui.getcell(d,b);e&&"none"!=e.style.display&&(e.colSpan?(e=parseInt(e.colSpan),c+=e):c++)}return[c,b]}function getRelativeCoor(a,b){var c=0;if(0<a)for(var d=1,e;d<=a;d++){var f=nui.getcell(d,b);if(f&&"none"!==f.style.display&&(f.colSpan?(f=parseInt(f.colSpan),c+=f):c++,c>=a)){e=d;break}}else e=0;return[e,parseInt(b)]}
function getScreenLocationFromId(a,b){builderCellTopPos||loadBuilderCellPos();var c,d=0,e=0;for(c=0;c<builderCellLeftPos.length&&!(c>a);c++)d=builderCellLeftPos[c];for(c=0;c<builderCellTopPos.length&&!(c>b);c++)e=builderCellTopPos[c];return[d-nui.main.scrollLeft,e-nui.main.scrollTop]}
function getAbsoluteCoor(a,b,c){builderCellTopPos&&!c||loadBuilderCellPos();a+=nui.main.scrollLeft;b+=nui.main.scrollTop;var d,e;for(c=0;c<builderCellLeftPos.length;c++)a>builderCellLeftPos[c]&&0!==builderCellLeftPos[c]&&(d=c);for(c=0;c<builderCellTopPos.length;c++)b>builderCellTopPos[c]&&0!==builderCellTopPos[c]&&(e=c);return[d,e]}
function getBuilderComponentMouseoverCell(a,b,c){b=getAbsoluteCoor(a,b);a=b[0];b=b[1];c&&(c=getRelativeCoor(a,b),a=c[0],b=c[1]);return[a,b,builderCellLeftPos[a]-nui.main.scrollLeft,builderCellTopPos[b]-nui.main.scrollTop]}$("addField")&&($("addField").onmousedown=mouseDownComponent);
function mouseDownComponent(a){a||(a=window.event);if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);3==b.nodeType&&(b=b.parentNode);if(b&&b.hasAttribute("type")&&"div"==b.tagName.toLowerCase()){var c=b.getAttribute("type"),d="SUBTABLE_REF"===c,e="SUBTABLE_MULTI"===c,f="HARD_REF"===c;"DESC"===c?saveBuilderMode(BUILDER_TEXT,!0):saveBuilderMode(BUILDER_FIELDS,!0);c=b.getBoundingClientRect();d=d||f||e?[b.offsetLeft,b.offsetTop]:[c.left,c.top];ctrl.builderComponentDragStart=!0;ctrl.dragStartX=
a.clientX;ctrl.dragStartY=a.clientY;ctrl.winStartX=d[0]-8;ctrl.winStartY=d[1]-5;ctrl.dragging=b;b.style.position="absolute";b.style.top=d[1]-5+"px";b.style.left=d[0]-8+"px";b.style.opacity=.7;ctrl.tempOldBackgroundColor=b.style.backgroundColor;b.style.backgroundColor="#CCDD88";disableSelection(document.body)}}
function updateBuilderComponentMove(a){var b=ctrl.dragging;if(b){var c=a.clientY-ctrl.dragStartY;b.style.left=ctrl.winStartX+(a.clientX-ctrl.dragStartX)+"px";b.style.top=ctrl.winStartY+c+"px"}}
function endBuilderComponentDrop(){var a=ctrl.dragging;if(a){$("addRefSubtableDiv")&&($("addRefSubtableDiv").style.display="none");var b=!1,c=!ctrl.builderMoveEnd;ctrl.dragging.getAttribute("type");var d,e,f=(d=builder.getFirstField())&&builder.cellData[d.x+1+","+d.y];if(ctrl.builderMoveEnd){var g=ctrl.builderMoveEnd.id;d=parseInt(g.split("_")[1]);var k=parseInt(g.split("_")[2]);g=nui._getcellV2(d-1,k);a.actionButton||(e=nui._getcellV2(d+1,k))}ctrl.builderMoveEnd&&(ctrl.builderMoveEnd.classList.contains("builderFieldWhite")||
ctrl.builderMoveEnd.classList.contains("builderFieldWhiteSingle"))||"DESC"!=a.getAttribute("type")&&(g&&g.builderField||e&&e.builderField)||e&&(e.builderField||e.builderFreeField||e.classList.contains("builderFieldWhiteSingle"))||ctrl.builderMoveEnd&&"none"==ctrl.builderMoveEnd.style.display||"DESC"!=a.getAttribute("type")&&builder.createAsListingPage&&f||(b=!0);b&&!c&&(g=ctrl.builderMoveEnd.id,d=parseInt(g.split("_")[1]),k=parseInt(g.split("_")[2]),"DESC"===a.getAttribute("type")&&d===nui.fcol-1&&
k===nui.frow&&nui._focus(d,k),builderAddComponent(d,k,ctrl.dragging),(b=nui._curcell())&&b.ip&&$("hin").setValue(b.ip.value));$("dropTarget").style.display="none";"HARD_REF"==a.getAttribute("type")&&a.classList.contains("addField")&&!c?a.parentElement.removeChild(a):(a.style.position="",a.style.top=null,a.style.left=null,a.style.opacity=null,a.style.backgroundColor=ctrl.tempOldBackgroundColor);ctrl.builderComponentDragStart=!1;ctrl.builderMoveEnd=null;ctrl.dragStartX=null;ctrl.dragStartY=null;ctrl.dragging=
null;builder.tempDragDropShiftRow=-1;enableSelection(document.body)}}$("focus")&&($("focus").onmousewheel=function(a){a||(a=window.event);0<parseInt(a.wheelDelta||-1*a.detail)?nui.main.scrollTop-=10:nui.main.scrollTop+=10});
function scrollSidebar(){for(var a=$("v5Sidebar").scrollTop,b,c=0;c<floatingPanels.length;c++)b=floatingPanels[c],b.hasAttribute("sideScrollTop")&&(b.style.top=parseInt(b.style.top)+(b.getAttribute("sideScrollTop")-a)+"px",b.setAttribute("sideScrollTop",a));ctrl.isIE&&(a=$("v6SearchBtn"),b=$("v6QueryItemBar").getBoundingClientRect(),c=$("v5Header").clientHeight+4,a&&(b.top<=c+52?(a.style.position="fixed",a.style.top=c+"px",a.style.backgroundColor="#efefef"):(a.style.position="",a.style.top="",a.style.backgroundColor=
"")))}function mouseoverSidebar(){nui&&($("v5Sidebar").style.overflowY="auto")}function mouseoutSidebar(a){a||(a=window.event);!a||165>a.clientX||($("v5Sidebar").style.overflowY="hidden")}var sysTimer={timer:-1,quickInterval:1E3,initInterval:1500,longInterval:1E4,getCountRatioInactive:10,getCountRatioActive:2,count:0};function update_systimer_task(){window.clearTimeout(sysTimer.timer);sysTimer.timer=window.setTimeout(default_systimer_task,sysTimer.quickInterval)}
function default_systimer_task(){if("guest account"!=window.user){try{sysTimer.count++,1==sysTimer.count%(vis()?sysTimer.getCountRatioActive:sysTimer.getCountRatioInactive)?getNotificationCount():(vis()||15==sysTimer.count%30)&&checkSession()}catch(a){}ctrl.autoLogoutInterval&&(ctrl.grantStaff&&(ctrl.idleInitRecord=(new Date).getTime()),0<=userNodeId&&ctrl.idleInitRecord&&getPromise("/sims/auto/updateLastIdleStartTime.jsp",{a:ap,ts:ctrl.idleInitRecord}).then(function(){return getPromise("/sims/auto/checkAutoLogout.jsp",
{a:ap})}).then(function(a){var b=JSON.parse(a);b&&b.doAutoLogout&&(floatTinyWin(null,"You have been idle for more than <b>"+ctrl.autoLogoutInterval+"</b> minutes, and you will be automatically logged out in 10 seconds."),setTimeout(function(){location.href="/sims/reg/logout.jsp?t="+b.t+"&a="+ap+"&code=IDLE&autologout&url="+encodeURIComponent(location.href)},1E4))}));sysTimer.timer=window.setTimeout(default_systimer_task,sysTimer.longInterval)}}
sysTimer.timer=window.setTimeout(default_systimer_task,sysTimer.initInterval);
function checkSession(){var a={a:ap,t:(new Date).getTime(),vis:vis()};if(biffdata){biffdata.timestamp&&(a.since=biffdata.timestamp);a["key_"+biffdata.rootDomainId]=biffdata.getRootNodeIdList().toString();biffdata.ifListingPage()&&1==biffdata.currentEntry&&0==biffdata.filterStatus.filterItems.length&&(a.checkNew=biffdata.rootDomainId);for(var b=0;b<biffdata.subtableKeyFields.length;b++){var c=biffdata.subtableKeyFields[b];a["key_"+c]=biffdata.getSubtableRootNodeIdList(c).toString()}}ajaxget("/sims/auto/notification.jsp",
a,function(a){try{var b=JSON.parse(a);execNotificationJSON(b)}catch(f){}})}function getNotificationCount(){$("notificationBubble")&&ajaxget("/sims/auto/notification.jsp",{count:!0,a:ap,t:(new Date).getTime(),vis:vis()},function(a){try{var b=JSON.parse(a);execNotificationJSON(b)}catch(c){}})}
function silentReload(){if(ctrl.currentController&&browse&&ctrl.currentNUI_outer&&mode==BROWSE&&!(ctrl.checkedRootNodeIds&&0<ctrl.checkedRootNodeIds.length))if(biffdata.ifListingPage()||ctrl.currentController.resetBrowseLeft(),ctrl.doingSilentReload=!0,biffdata.ifListingPage()){var a=nui.fcol,b=nui.frow;ctrl.currentController.load("&gb","",function(){mode==BROWSE&&(browse._init(),browse._focus(),nui._focus(a,b));ctrl.doingSilentReload=!1})}else{var c=getRootNodeIdFromUrl();if(-1!==c){var d=nui.fcol,
e=nui.frow,f=nui.main.scrollTop,g=$("hin").getValue();ctrl.currentController.load("&dm=index&ni="+c,"",function(){if(canSaveData()){if(nui._focus(d,e,!0),nui.main.scrollTop=f,-1!==d&&-1!==e){var a=nui._getcell(d,e).ip;a.type!==TYPER||a.biff.hasAttribute("sig")||a.biff.hasAttribute("html")||(a.dblclick(),$("hin").setValue(g))}}else browse._init(),browse._focus();ctrl.doingSilentReload=!1})}else ctrl.doingSilentReload=!1}}
function reloadReport(){-1!=location.href.indexOf(ap+"/report/display")&&location.reload()}
function execNotificationJSON(a){if(a){if("pup"==a.cmd)mode==BROWSE&&biffdata&&!ctrl.outOfNUI&&silentReload();else{if("reload"==a.cmd){location.reload();return}if("goWaiting"==a.cmd){ctrl.concurrentWaiting||location.href==="/"+ap||(location.href="/"+ap);return}if("logout"==a.cmd){floatWin(null,lm.conflictLogin);window.setTimeout(function(){location.href="/sims/reg/logout.jsp?t="+a.t+"&a="+ap+"&code=DUP&autologout&url="+encodeURIComponent(location.href)},3E3);return}}var b=a.n;b&&$("notificationBubble")&&
(0<b?($("notificationBubble").textContent=b,$("notificationBubble").style.display="",ctrl.notificationCached=!1,titleAddNumber(b)):$("notificationBubble").style.display="none");if($("taskBubble")&&((b=a.t)||0===b))if(0<b){$("taskBubble").textContent=b;$("taskBubble").style.display="";var c=b;(ctrl.taskLastCount||0===ctrl.taskLastCount)&&b>ctrl.taskLastCount&&(5<b&&(b=5),desktopNotifyLatestTasks(b));ctrl.taskCached=!1;ctrl.taskLastCount=c}else ctrl.taskLastCount=0,$("taskBubble").style.display="none"}}
function titleAddNumber(a){isNaN(a)||(document.title&&document.title.startsWith("(")&&(document.title=document.title.substr(document.title.indexOf(") ")+1)),0<a&&(document.title="("+a+") "+document.title))}
function desktopNotify(a,b,c){var d={badge:"/sims/img/logoRed_300_square.gif",icon:"/sims/img/logoRed_300_square.gif",body:c?removeHTML(c):""},e=function(a){a.preventDefault();window.open(b,"_blank").focus();this.cancel()};"Notification"in window&&("granted"===Notification.permission?(new Notification(removeHTML(a),d)).onclick=e:"denied"!==Notification.permission&&Notification.requestPermission(function(b){"granted"===b&&((new Notification(removeHTML(a),d)).onclick=e)}))}
function processJSExceptionObj(a){a&&(console.log(a.name+":"+a.message),console.log(location.href),console.log(a.lineNumber+":"+a.columnNumber),console.log(a),processJSException(a.message,location.href,a.lineNumber,a.columnNumber,a))}
function processJSException(a,b,c,d,e){a||(a="");ctrl.isChrome||ctrl.isGecko||!navigator||(a+="userAgent:"+navigator.userAgent+"\n");c||(c="");b=location.href;d||(d="");var f="",g="",k="",l="";e&&(e.name&&(l=e.name),e.message&&(g=e.message),e.stack&&(f=e.stack),e.fileName&&(k=e.fileName));"NetworkError"==l||-1!=a.indexOf("NetworkError")||"TimeoutError"==l||-1!=a.indexOf("TimeoutError")?(a=RagicStorage.localStorage.getItem("NetworkErrorRetry"),b=(new Date).getTime(),a?3E4<b-a&&(RagicStorage.localStorage.setItem("NetworkErrorRetry",
b),location.reload()):(RagicStorage.localStorage.setItem("NetworkErrorRetry",b),location.reload())):postPromise("/sims/jserror.jsp",{name:l,msg:a,objmsg:g,url:b,fileName:k,line:c,col:d,st:f})}window.onerror=function(a,b,c,d,e){if(!ctrl.isIE||!ctrl.isObsoleteIE)return processJSException(a,b,c,d,e),!1};
function clipboardUploadImage(a,b){if(ctrl.isIE)return!1;b=(b.clipboardData||b.originalEvent.clipboardData).items;if(1<b.length)return!1;var c=null;if(b)for(var d=0;d<b.length;d++)0===b[d].type.indexOf("image")&&(c=b[d].getAsFile());return null!==c?(readBlobAsDataURL(c).then(function(b){return postPromise("/sims/dataurlSave.jsp",{a:ap,d:b,cw:a.clientWidth,ch:a.clientHeight})}).then(function(b){b&&3<b.length&&(b=b.replace("&amp;","&"),insertAtCursor(a,b))}),!0):!1}
function insertAtCursor(a,b){if(document.selection)a.focus(),document.selection.createRange().text=b;else if(a.selectionStart||"0"==a.selectionStart){var c=a.selectionStart,d=a.selectionEnd;a.value=a.value.substring(0,c)+b+a.value.substring(d,a.value.length);a.selectionStart=c+b.length;a.selectionEnd=c+b.length}else a.value+=b}
window.afterInitHooks&&window.afterInitHooks.push(function(){if(window.userProperties&&window.userProperties.transLang){document.onmouseover=documentOnMouseOverForTranslation;var a=node("div");a.className="fixedPrompt";a.innerHTML="Online Translation Mode On";document.body.appendChild(a);$("transLangButton")&&($("transLangButton").value="Disable Online Translation Mode")}});
function documentOnMouseOverForTranslation(a){a||(a=window.event);if(a.target)var b=a.target;else a.srcElement&&(b=a.srcElement);b&&b&&b.innerText&&(ctrl.transText=b.innerText,ctrl.transElement=b)}function toggleOnlineTranslationMode(){window.userProperties.transLang?saveUserProperties("transLang",""):saveUserProperties("transLang",$("transLangSelection").options[$("transLangSelection").selectedIndex].value);location.reload()}function listingPageMultiEdit(){modeUpdate()}
function autoSaveInterval(a){if(biffdata.autoSave&&checkIfUserCanEdit()){ctrl.autoSaveTimeout&&clearTimeout(ctrl.autoSaveTimeout);$("tutorial")&&($("tutorial").style.display="none");for(var b=biffdata.biffs,c=b.length,d=0;d<c;d++){var e=b[d].ip;if(e&&e.IPType===UPLOADER&&e.currentUploadXhr){e.currentUploadXhr.addEventListener("load",autoSaveNUIForm,!1);ctrl.submitSemaphore=!1;ctrl.autoSaveTimeout=null;return}}b=validateAll().toString();RagicInteractiveRules.execute(!0);0<b.length?(a=$("draftDiv"),
a.innerHTML=lm.notSavedYet+'... <a href="javascript:void(0);" onmouseover="tooltipV2(this,\''+b+"',3,100)\">"+lm.why+"?</a>",a.style.display="",ctrl.autoSaveTimeout=null):a?ctrl.autoSaveTimeout=setTimeout(autoSaveNUIForm,a):(autoSaveNUIForm(),ctrl.autoSaveTimeout=null)}}
function autoSaveSilentReload(a,b){if(ctrl.currentController&&ctrl.currentNUI_outer&&mode==BROWSE){if(!(0<=biffdata.rootNodeId&&a!=biffdata.rootNodeId||0>biffdata.rootNodeId&&b!=biffdata.rootNodeId)){ctrl.doingSilentReload=!0;if(biffdata.ifListingPage())ctrl.silentAutoReload=!0,ctrl.currentController.load("&gb","",function(){mode==BROWSE&&(browse._init(),browse._focus(),clearListingPageCheckbox(),processStar());ctrl.doingSilentReload=!1});else if(-1!=a){ctrl.silentAutoReload=!0;ctrl.tempUpdateCellIndex=
biffdata.updateCellIndex;var c=nui.fcol,d=nui.frow,e=nui.main.scrollTop;ctrl.currentController.load("&dm=index&ni="+a,"",function(){biffdata.updateCellIndex=ctrl.tempUpdateCellIndex;mode==BROWSE&&(browse._init(),browse._focus());nui._focus(c,d,!0);nui.main.scrollTop=e;ctrl.doingSilentReload=!1})}else ctrl.doingSilentReload=!1;ctrl.creatingNew=!1}autoSaveDone()}}
function autoSaveDone(a){ctrl.currentController.resetBrowseLeft();var b=new Date,c=$("draftDiv");c.innerHTML=lm.lastSave+": "+formatDate(b,"hh:mm:ss a");c.style.display="";a&&floatWin(null,a);ctrl.autoSaveTimeout=null}function autoSaveBackendNotSaved(a){floatWin(null,a);a=a.replace(/"/g,"\\'");var b=$("draftDiv");b.innerHTML=lm.notSavedYet+'... <a href="javascript:void(0);" onmouseover="tooltipV2(this,\''+a+"',3,100)\">"+lm.why+"?</a>";b.style.display="";ctrl.autoSaveTimeout=null}
function autoSaveNUIForm(){if(0>biffdata.rootNodeId&&!biffdata.ifListingPage()){if(ctrl.creatingNew)return;ctrl.creatingNew=!0}biffdata.loadAllLastEditTimeDefaultValues();biffdata.txnId=(new Date).getTime();var a=$("draftDiv");a.style.display="";a.innerHTML=lm.saving+"...";a=$("nuiform");a.action="/sims/save_exec.jsp?quick&a="+ap+(rmlc?"&rmlc":"");a.submit();$("nuiiframe").id="nuiiframe_submitted";recreateNUIIframe();biffdata.loadLastEditUserDefaultValue=!1}
function simulateMouseClickOnMobile(a,b,c){if(a instanceof Element){var d={};a.addEventListener("touchstart",function(a){for(var b=0;b<a.targetTouches.length;++b){var c=a.targetTouches[b];d[c.identifier]={touch:c,timestamp:Date.now()}}});a.addEventListener("touchmove",function(a){for(var b=Object.keys(d),c=0;c<b.length;++c)for(var e=b[c],l=0;l<a.targetTouches.length;++l){var m=a.targetTouches[l];if(m.identifier===+e){var n=d[e].touch;if(5<=Math.sqrt(Math.pow(+m.pageX-+n.pageX,2)+Math.pow(+m.pageY-
+n.pageY,2))){delete d[e];break}}}});a.addEventListener("touchend",function(a){for(var e=Date.now(),g=0;g<a.changedTouches.length;++g){var k=a.changedTouches[g];if(k.identifier in d){var l={target:k.target,bubbles:!0,cancelable:!0,screenX:k.screenX,screenY:k.screenY,clientX:k.clientX,clientY:k.clientY,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,altKey:a.altKey,metaKey:a.metaKey,button:1,buttons:1,relatedTarget:k.relatedTarget,region:k.region,preventDefault:function(){},stopPropagation:function(){}};300>=
e-d[k.identifier].timestamp?b&&(b(l),k.target.actionButton||cancelEventBubble(a)):(l.button=l.bubbles=2,c&&(c(l),cancelEventBubble(a)))}}})}}function addEventToHin(a,b){a&&b&&$("hin").addEventListener(a,b)}function removeEventFromHin(a,b){a&&b&&$("hin").removeEventListener(a,b)}function clearhelpShower(){var a=$("helpShower");a&&"none"!==a.style.display&&(a.style.opacity=0,a.ontransitionend=function(){a.style.display="none"})}
function openHelpShower(a,b,c,d,e,f,g){c=$("helpShower");d=$("helperText");c.ontransitionend=null;c.style.display="inline";b=mode==BUILDER?builder.findField(b).attr.help:biffdata.findHeader(b).attr.help;b=b.replaceAll("\n","<br>");d.innerHTML=b;d=c.offsetHeight;b=c.offsetWidth;g=a.getBoundingClientRect();a=g.left;e=g.top;f=g.height;g=g.width;var k=document.documentElement.clientHeight,l=!0;a<b&&(l=!1);var m=!0;k-e-f<d&&(m=!1);m?l?(d=e+f,b=a-b):(d=e+f,b=a+g):l?(d=e-d,b=a-b):(d=e-d,b=a+g);c.style.top=
d+"px";c.style.left=b+"px";c.style.opacity=1}
function modeBuilder(a){$("nui")&&owner&&"OEM"!=window.edition&&!mvpMode&&mode!=UPDATE&&($("draftDiv")&&($("draftDiv").style.display="none",$("tutorial").style.display="none"),ifFreePack()?quickBillChangePlan():(listingPageCheckboxSelectAll("uncheck"),hideListingPageStuff(),clearDropWin(),resetWidgetsBrowser(),"/ragic-setup"!=path||1!=sheetIndex&&3!=sheetIndex&&4!=sheetIndex&&5!=sheetIndex&&7!=sheetIndex||floatWinWarning(lm.pleaseDoNotEdit),$("floatingFormRules").style.display="none",ctrl.tempScrollTop=
nui.main.scrollTop,mode=BUILDER,switchRightDock($("wfWin"),$("wfMain"),loadWorkflow,2),switchRightDock($("historyWin"),$("historyMain"),loadHistory,2),switchRightDock($("infoWin"),$("infoMain"),loadInfo,2),switchRightDock($("commentWin"),$("comments"),loadComments,2),$("v5Content").style.display="",read(function(a){callBuilderLoad(a);builder.ifListingPage()||checkDesign()},"/sims/form_builder.jsp?a="+encodeURIComponent(ap)+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+(a?"&action="+
a:""),!0),topButtonDisplay(),$("v5SidebarTD").style.display="none",$("v5DesignHelper").style.display="",builder.checkIfSysFieldDuplicated(105)&&($("add_createDate").style.display="none"),builder.checkIfSysFieldDuplicated(109)&&($("add_lastUpdateDate").style.display="none"),$("stickyHeader")&&document.body.removeChild($("stickyHeader")),$("stickyHeaderBuilder")&&document.body.removeChild($("stickyHeaderBuilder")),$("stickyHeaderLeftBuilder")&&document.body.removeChild($("stickyHeaderLeftBuilder")),
0>nui.frow&&(nui.frow=1,nui.fcol=1),nui._focus(nui.fcol,nui.frow,!0),builder.ifListingPage()?(listingPageFieldHelper(),ctrl.outOfNUI=!1,$("bFormBasic").style.display="none",$("bReminder").style.display="none"):($("bFormBasic").style.display="",$("bReminder").style.display=""),tutorialCheckProgress(),ifMobile||("001b"!==tutorial.getChapter()||ifTutorialInited("001b")?ctrl.noTutorial||tutorial.getEnabled()||builder.ifListingPage()||ifTutorialInited("001")||ifTutorialInited("001b")||ifTutorialInited("des")||
tutorialStart("des"):tutorialStart("001b"),ctrl.noTutorial&&(ctrl.noTutorial=!1)),ctrl.tempScrollTop&&(nui.main.scrollTop=ctrl.tempScrollTop),initActionButtonDrag(),ctrl.currentController.resize()))}
function loadBuilderModule(a){if(0<builder.keyField)floatWinWarning(lm.quickTemplateInvalid);else if(builder.ifEmpty()||confirm(lm.designOverwritten))a?(a=a.split("/"),ajaxget("https://www.ragic.com/api/internal/main_getNUI.jsp",{p:"/"+a[1],si:a[2],noDomainId:!0},function(a){builder.load(a,!0,!0);builder.clearDomainIds();builder.refreshStartNUI()},!1)):(builder.load(""),builder.clearDomainIds(),builder.refreshStartNUI())}
function listingPageFieldHelper(a){floatWin(null,lm.prop_loading,lm.listingPageFieldPicker,!0);$("floatingWin").style.top="360px";$("floatingWin").style.left="390px";var b={a:ap,p:path,fn:sheet,callback:"listingPageFieldHelperCallback",noClose:"",actionName:"OK"};a&&(b.v=a);getPromise("/sims/listingFieldSelector.jsp",b).then(function(a){$("floatingWinContent").innerHTML=a})}
function listingPageFieldHelperCallback(){var a=$("listingFieldOptions"),b=Array.from(a.options);a=Object.keys(builder.cellData);if(a.length){var c=a[0].split(",");var d=parseInt(c[0]);c=parseInt(c[1])}d&&c||(c=d=1);nui._focus(d,c);var e=biffdata.widthCommand.split("&"),f={};for(a=0;a<e.length;a++){var g=e[a].split("=",2);2>g.length||(f[g[0]]=g[1])}g={};e={};for(a=0;builder.cellData[d+a+","+c];a++)f[""+(d+a)]&&(g[builder.cellData[d+a+","+c].domainId]=f[""+(d+a)]);Object.values(builder.cellData).forEach(function(a){var c=
b.find(function(b){return parseInt(a.domainId)===parseInt(b.value)&&(-1!==parseInt(a.domainId)||a.value===b.innerHTML)});c&&c.setAttribute("attr",a.getAttributeString())});builder.cellData={};builder.mode=BUILDER_FIELDS;for(a=0;a<b.length;a++){f=b[a];var k=f.getAttribute("fieldName");builder.setField(d+a,c,k);builder.setAttribute(d+a,c,"rf",f.value);builder.setAttribute(d+a,c,"it",f.getAttribute("it"));g[f.value]&&(e[""+(d+a)]=g[f.value]);k=f.getAttribute("lov");var l=f.getAttribute("cascaded");f=
f.value;k&&(k=k.split("`").join("\n"),l?addCascadedSelectionFromLOV(k,f,l):builder.setAttribute(d+a,c,"lov",k))}for(a=0;a<b.length;a++)builder.copyAttribute(d+a,c,b[a].getAttribute("attr"));d="";for(var m in e)0<d.length&&(d+="&"),d+=m+"="+e[m];biffdata.widthCommand=d;builder.renderAll();builder.syncCurrentCellData()}function callBuilderLoad(a){builder.load(a.responseText,!0);builder.refreshStartNUI()}
function checkDesign(){getPromise("/sims/checkDesign.jsp",{a:ap,p:path,si:sheetIndex}).then(function(a){a&&(a=JSON.parse(a),a.msg&&floatWinWarning(a.msg))})}
function checkIfUserCanEdit(a,b){var c=biffdata.ifListingPage();if(!userIdentifiable&&!confirmedFunctionConfirmed)return confirmedFunction=modeUpdate,a||floatWin(function(){return"/sims/reg/login.jsp"+(window.ap?"?a="+window.ap:"")},null,"Log in to Ragic",!0,null,!0),!1;if(!mvpMode&&6>biffdata.role&&1!=biffdata.role&&c)return a||floatWinWarning(lm.noAccessEnter),!1;if(!mvpMode&&biffdata.nocreate&&0>biffdata.rootNodeId&&(!c||ctrl.listingPageNewingData))return a||floatWinWarning(lm.noAccessCreate),
!1;var d=0>biffdata.rootNodeId&&!c&&!biffdata.autoSave;if(!mvpMode&&("W"!==biffdata.rights||biffdata.noedit&&!ctrl.draftLoading)&&!ctrl.cloneAction&&!d)return a||floatWinWarning(lm.noAccessUpdate),!1;if("/ragic-setup"===path&&c)return a||floatWinWarning(lm.stopSystemSheetEdit),!1;if(!(b||"L"!==biffdata.lockMode||c||(b=nui._curcell(),b&&b.ip&&b.ip.biff&&b.ip.biff.attr&&b.ip.biff.attr.nolock||ctrl.clickMVP&&ctrl.clickMVP.biff&&ctrl.clickMVP.biff.hasAttribute("nolock"))))return a||floatWinWarning(lm.editionLocked),
!1;b=window.user&&window.user.endsWith("@ragic.com");return"FREE2"!==window.edition||"/ragic-setup"!==path||2!=sheetIndex||b?"FREE2"!==window.edition&&"LITE2"!==window.edition||"/ragic-setup"!==path||3!=sheetIndex&&4!=sheetIndex||b?!0:(a||floatWinWarning(lm.limitLiteFeature.replace(/\{0\}/,ap)),!1):(a||floatWinWarning(lm.limitFreeFeature.replace(/\{0\}/,ap)),!1)}
function modeUpdate(a){if(!$("nui"))return!1;var b=biffdata.ifListingPage(),c=!1;if(a&&!isNaN(a)){a=parseInt(a);var d=document.querySelector(".topButtonWhole[data-seq='"+a+"']");d&&"editEntry"===d.dataset.action&&(c=!0,ctrl.toolButtonAction=!0,ctrl.toolButtonSeq=a)}if(!c&&!checkIfUserCanEdit())return!1;if(biffdata.autoSave&&!b)return!0;0<=biffdata.rootNodeId||b?read(evalJS,"/sims/lockEntry.jsp?a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+(b?"&sl&type=2":"&type=1")+"&ni="+
biffdata.rootNodeId,!0):_modeUpdate();return!0}
function _modeUpdate(){mode!=UPDATE&&(mode=UPDATE,switchRightDock($("wfWin"),$("wfMain"),loadWorkflow,2),switchRightDock($("historyWin"),$("historyMain"),loadHistory,2),switchRightDock($("infoWin"),$("infoMain"),null,2),switchRightDock($("commentWin"),$("comments"),loadComments,2),displayData(),0<=biffdata.rootNodeId&&checkEmptySubtableRows(),topButtonDisplay(),browse._nofocus(),nui.moveInit(),nui._updateFocus(),hinFocus(),!ctrl.isIE&&biffdata.ifListingPage()&&nui.freezeY(biffdata.dataminY),doFreeze(),
tutorialCheckProgress())}
function modeBrowse(a){if($("nui")){mode=BROWSE;ctrl.currentNUI.style.width="30000px";ctrl.currentNUI.style.height="30000px";mvpMode&&disableMVP();$("draftDiv")&&($("draftDiv").style.display="none");nui&&(ctrl.tempScrollTop=nui.main.scrollTop,ctrl.tempScrollLeft=nui.main.scrollLeft,nui.fcol=-1,nui.frow=-1,nui.init());hideEditElements();var b=$("stickyHeader"),c=$("stickyHeaderBuilder"),d=$("stickyHeaderLeftBuilder");b&&document.body.removeChild(b);c&&document.body.removeChild(c);d&&document.body.removeChild(d);
resetWidgetsBuilder();$("v5SidebarTD").style.display="";$("v5DesignHelper").style.display="none";a||floatWinClose();ctrl.outOfNUI=!1;ctrl.currentController.load("","",function(){browse._init();browse._focus();ctrl.currentController&&ctrl.currentController.resize()},!1,!1);nui.main.scrollTop=ctrl.tempScrollTop;nui.main.scrollLeft=ctrl.tempScrollLeft;tutorialCheckProgress();$("delIcon")&&($("delIcon").style.display="none");$("designHistoryDiv")&&($("designHistoryDiv").style.display="none");$("multiMatchResultContainer")&&
($("multiMatchResultContainer").style.display="none");$("focus").classList.remove("focusPointNone");forceRedraw("nui_outer");biffdata.loadLastEditUserDefaultValue=!1}}function updateSameSubtableRowBiffsFormulaEngine(a,b){}
function checkEmptySubtableRows(a,b,c){if(biffdata.keyField&&!(0===biffdata.subtableKeyFields.length&&!biffdata.ifListingPage()||a&&!biffdata.ifSubtableDataBiff(a)||ctrl.checkEmptySubtableRows)){ctrl.checkEmptySubtableRows=!0;var d={},e=biffdata.biffs,f=e.length,g=ctrl.guessSubtableSeqsPatchSize;if(b&&0<b.length)f=b[0].parentDomainId,e={},e[b[0].y]=b,d[f]=e;else for(b=0;b<f;b++){var k=e[b];if(k.dataType!==HEADER&&biffdata.ifSubtableDataBiff(k)&&(!a||a.parentDomainId===k.parentDomainId&&a.y===k.y&&
(biffdata.ifListingPage()||biffdata.isSameSubtable(a,k)))){var l=k.getSubtableKey(!0,!0);d.hasOwnProperty(l)||(d[l]={});l=d[l];l.hasOwnProperty(k.y)||(l[k.y]=[]);l[k.y].push(k)}}for(var m in d){e=d[m];for(var n in e){l=e[n];var q=!0;k=[];f=l.length;var r=[],p=[];for(b=0;b<f;b++){var t=l[b];if(t.hasAttribute("f")){var v=formulaBuilder._findChangeCellNames(t.attr.f),u=v.length;if(0===u)r.push(t);else{for(var x=!0,E={},D=0;D<u;E={$jscomp$loop$prop$ch$602:E.$jscomp$loop$prop$ch$602,$jscomp$loop$prop$findId$603:E.$jscomp$loop$prop$findId$603},
D++){E.$jscomp$loop$prop$ch$602=v[D];var A=biffdata.formulaMap[E.$jscomp$loop$prop$ch$602];if(A&&A.hasOwnProperty(n)&&A[n]&&A[n].isSubtableObj&&(A=Object.entries(biffdata.domainIdCellMapping).find(function(a){return function(b){return b[1]===a.$jscomp$loop$prop$ch$602}}(E)))&&(E.$jscomp$loop$prop$findId$603=parseInt(A[0]),p.some(function(a){return function(b){return b.domainId===a.$jscomp$loop$prop$findId$603}}(E)))){x=!1;break}}x?p.unshift(t):p.push(t)}}else r.push(t)}l=r.concat(p);f=l.length;for(b=
0;b<f;b++)if(r=l[b],p=r.attr,!c||!(p.hasOwnProperty("dv")&&!p.hasOwnProperty("checkbox")||p.hasOwnProperty("f")))if(0<=r.parentNodeId||!(void 0===r.value||0===r.value.length||p&&p.hasOwnProperty("ag"))){q=!1;break}if(q)for(b=0;b<f;b++)q=l[b],r=q.attr,p=q.ip,q.isEmptyRow=!0,q.isSubtableObj=!0,resetFormulaObject(q),resetAutoGenGuessRefValueMapping(q),p&&k.push(p),a&&q.hasAttribute("ag")&&(q.updateDisplayValue="",p.render(),r.ag.includes("{RAGIC_ID}")||(q.isRefToOtherFieldAutoGen()?reguessSubtableSameDomainBiffsRefSeqs(findAllSubtableDataBiffsToReguessAutogen(q)):
reguessSubtableSameDomainBiffsSeqs(q)));else if(!a||(a.value||0===a.value)&&a.isEmptyRow)for(q={},b=0;b<f;q={$jscomp$loop$prop$b$175$608:q.$jscomp$loop$prop$b$175$608,$jscomp$loop$prop$br$176$609:q.$jscomp$loop$prop$br$176$609},b++)if(q.$jscomp$loop$prop$b$175$608=l[b],q.$jscomp$loop$prop$br$176$609=q.$jscomp$loop$prop$b$175$608.attr,r=q.$jscomp$loop$prop$b$175$608.ip,q.$jscomp$loop$prop$b$175$608.isEmptyRow=!1,q.$jscomp$loop$prop$b$175$608.isSubtableObj=!0,resetFormulaObject(q.$jscomp$loop$prop$b$175$608),
resetAutoGenGuessRefValueMapping(q.$jscomp$loop$prop$b$175$608),q.$jscomp$loop$prop$br$176$609&&(!a||a!==q.$jscomp$loop$prop$b$175$608))if(q.$jscomp$loop$prop$br$176$609.hasOwnProperty("ag"))0>q.$jscomp$loop$prop$b$175$608.nodeId&&(q.$jscomp$loop$prop$b$175$608.value=q.$jscomp$loop$prop$b$175$608.attr.ag,q.$jscomp$loop$prop$b$175$608.isRefToOtherFieldAutoGen()?q.$jscomp$loop$prop$b$175$608.updateDisplayValue||ctrl.isIE||autoGenGuessRefValueBuilder.updateFieldInChain(r):(r=!0,q.$jscomp$loop$prop$br$176$609.ag.includes("{RAGIC_ID}")?
(r=!1,chainAutoGenGuessPromise(function(a){return function(){var b=biffdataTemp||biffdata,c=b.findHeaderFromBiff(a.$jscomp$loop$prop$b$175$608);if(c&&c._cache.seq_RAGIC_ID)updateGuessSeq(a.$jscomp$loop$prop$b$175$608,c._cache.seq_RAGIC_ID);else return getAutogenGuess({a:ap,d:a.$jscomp$loop$prop$b$175$608.domainId,p:path,si:sheetIndex,ag:a.$jscomp$loop$prop$br$176$609.ag,nid:b.rootNodeId}).then(function(b){c&&(c._cache.seq_RAGIC_ID=b);updateGuessSeq(a.$jscomp$loop$prop$b$175$608,b)})}}(q))):q.$jscomp$loop$prop$br$176$609.ag.includes("{SUBTABLE_RAGIC_ID}")&&
0<=q.$jscomp$loop$prop$b$175$608.parentNodeId&&(r=!1,getAutogenGuess({a:ap,d:q.$jscomp$loop$prop$b$175$608.domainId,p:path,si:sheetIndex,ag:q.$jscomp$loop$prop$br$176$609.ag,nid:q.$jscomp$loop$prop$b$175$608.parentNodeId}).then(function(a){return function(b){updateGuessSeq(a.$jscomp$loop$prop$b$175$608,b)}}(q))),r&&!ctrl.isIE&&chainAutoGenGuessPromise(function(a){return function(){var b,c,d,e,f,k,l,m,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(q){switch(q.nextAddress){case 1:q.setCatchFinallyBlocks(2);
b=a.$jscomp$loop$prop$b$175$608.getSubtableKey(!1,!0)+","+a.$jscomp$loop$prop$b$175$608.domainId;c=ctrl.subtableAutoGenMaxSeq[b]+1;if(ctrl.subtableAutoGenSeqs.hasOwnProperty(b)){q.jumpTo(4);break}ctrl.subtableAutoGenSeqs[b]=[];d=parseInt;return q.yield(getSeq({a:ap,d:a.$jscomp$loop$prop$b$175$608.domainId,p:path,si:sheetIndex,ag:a.$jscomp$loop$prop$br$176$609.ag,stdid:a.$jscomp$loop$prop$b$175$608.parentDomainId}),5);case 5:c=d(q.yieldResult);case 4:e=findAllSubtableDataBiffsToReguessAutogen(a.$jscomp$loop$prop$b$175$608);
if(!(0===ctrl.subtableAutoGenSeqs[b].length||ctrl.subtableAutoGenSeqs[b].length<e.length)){q.jumpTo(6);break}f=[];k=c||0===c?c-1:0;for(l=1;l<=g;l++)f.push(k+l),l===g&&(ctrl.subtableAutoGenMaxSeq[b]=k+l);return q.yield(getAutogenGuess({a:ap,d:a.$jscomp$loop$prop$b$175$608.domainId,p:path,si:sheetIndex,ag:a.$jscomp$loop$prop$br$176$609.ag,seqs:f.toString()}),7);case 7:m=q.yieldResult.split(","),ctrl.subtableAutoGenSeqs[b]=ctrl.subtableAutoGenSeqs[b].concat(m);case 6:reguessSubtableSameDomainBiffsSeqs(a.$jscomp$loop$prop$b$175$608,
b,e);q.leaveTryBlock(0);break;case 2:return n=q.enterCatchBlock(),processJSExceptionObj(n),q.return(Promise.reject(n))}})}}(q))));else{p=t=!1;if(r){v=r.getValue();if(MSELECTOR===r.type){if(u=r.getRawValue(),void 0===u||0===u.length)p=t=!0}else t=(p=void 0===v||0===v.length)||q.$jscomp$loop$prop$br$176$609.hasOwnProperty("f")&&isInitLoadingFormula(q.$jscomp$loop$prop$br$176$609.f);!t&&q.$jscomp$loop$prop$br$176$609.hasOwnProperty("fmt_n")&&"0"===v&&(t=!0)}t&&(t=ctrl.draftLoading||ctrl.cloneAction,
q.$jscomp$loop$prop$br$176$609.hasOwnProperty("f")&&!t&&formulaBuilder.updateField(r,q.$jscomp$loop$prop$br$176$609.f),0>parseInt(q.$jscomp$loop$prop$b$175$608.nodeId)&&q.$jscomp$loop$prop$br$176$609.hasOwnProperty("dv_f")&&!t&&formulaBuilder.updateField(r,q.$jscomp$loop$prop$br$176$609.dv_f),!q.$jscomp$loop$prop$br$176$609.hasOwnProperty("dv")||ctrl.draftLoading&&"$"!==q.$jscomp$loop$prop$br$176$609.dv.charAt(0)&&"#"!==q.$jscomp$loop$prop$br$176$609.dv.charAt(0)?p&&k.push(r):(p=q.$jscomp$loop$prop$b$175$608.IPType===
SELECTOR||q.$jscomp$loop$prop$b$175$608.IPType===MSELECTOR,"#"===q.$jscomp$loop$prop$br$176$609.dv.charAt(0)&&!ctrl.draftLoading||q.$jscomp$loop$prop$b$175$608.IPType!==MSELECTOR&&q.$jscomp$loop$prop$b$175$608.IPType!==SELECTOR&&isNumeric(q.$jscomp$loop$prop$b$175$608.nodeId)&&0<=q.$jscomp$loop$prop$b$175$608.nodeId||(r.loadValue(getBiffDefaultValue(q.$jscomp$loop$prop$b$175$608),!1,null,!1,p,!0),q.$jscomp$loop$prop$b$175$608.IPType===MSELECTOR?r.render(!1,!0):r.render(),resetFormulaObject(q.$jscomp$loop$prop$b$175$608),
resetAutoGenGuessRefValueMapping(q.$jscomp$loop$prop$b$175$608))))}f=0;b=k.length;for(l=void 0;f<b;f++)l=k[f],l.needFormulaRecalc=!0,l.updateFormulaEngine(!1,!0)}}ctrl.checkEmptySubtableRows=null}}function resetFormulaObject(a){var b=getCellNameFromDataCache(a);b&&(biffdata.formulaMap[b]||(biffdata.formulaMap[b]={}),biffdata.formulaMap[b][a.y]=new FormulaMapObject(a))}
function videoHotspot(a,b,c,d,e,f){b=lm.cdn+b;placeHotspot(a,c,function(){loadVideoLoop(ctrl.hotspot,d);e&&(ctrl.tooltipCloseCallback=e);f&&f()},null,null,function(){preloadVideo(b)})}
function getCellName(a,b){var c=0,d=function(a,b){return a+(parseInt(b.attr.cs)-1)};mode===BROWSE||mode===UPDATE?c=biffdata.biffs.filter(function(c){var d=b-c.y;return 3>=d&&0<=d&&c.x<a&&c.hasAttribute("cs")&&biffdata.ifSubtableBiff(c)}).reduce(d,0):mode===BUILDER&&(c=builder.colSpanCells.filter(function(c){var d=b-c.y;return 3>=d&&0<=d&&c.x<a&&c.hasAttribute("cs")&&(builder.cellData[c.x+1+","+c.y]||builder.cellData[c.x-1+","+c.y])}).reduce(d,0));return colNames[a+c]+b}
function shift(a,b,c,d,e){if(a&&(!e||!(d&&e!=a.y||!d&&e!=a.x))){e=b;d&&builder.relativePositions.hasOwnProperty(b+","+a.y)&&(e=parseInt(builder.relativePositions[b+","+a.y].split(",")[0]));if(!d&&a.y>b)for((d=getCellNameFromDataCache(a))&&biffdata.formulaMap[d]&&biffdata.formulaMap[d][a.y]&&delete biffdata.formulaMap[d][a.y],b=a.hasAttribute("cg")?a.attr.cg:"",d=a.x+","+a.y+","+a.domainId+(b?","+b:""),a.y+=c,a.sec&&(a.sec[2]=a.y),a=a.x+","+a.y+","+a.domainId+(b?","+b:""),c=biffdata.existingCellCords,
b=0;b<c.length;b++){if(c[b]==d){c[b]=a;break}}else if(d&&a.x==e)builder.cellData[a.x+1+","+a.y]&&(d=parseInt(a.attr.cs)||1,builder.setAttribute(a.x,a.y,"cs",""+(d+c)));else if(d&&a.x>e){var f=nui,g=a.hasAttribute("cg")?a.attr.cg:"";d=a.x+","+a.y+","+a.domainId+(g?","+g:"");var k=b-1;try{k=parseInt(builder.relativePositions[b-1+","+a.y].split(",")[0])}catch(l){}0>c&&k==e||0<c&&(builder.cellData[e+","+a.y]&&builder.cellData[e+1+","+a.y]||f._getcellV2(e,a.y).classList.contains("builderFocusRight")&&
f._getcellV2(e+1,a.y).classList.contains("builderFocusRight"))||(a.x+=c);a.sec&&(a.sec[1]=a.x);a=a.x+","+a.y+","+a.domainId+(g?","+g:"");c=biffdata.existingCellCords;for(b=0;b<c.length;b++)if(c[b]==d){c[b]=a;break}}positionCellNameCache={}}}
function shiftData(a,b,c,d){if(!isNaN(a)&&(a||0===a)){if(0<ctrl.multiSelected.length&&-1==b)if(c){b=ctrl.multiSelected[0];a=ctrl.multiSelected[ctrl.multiSelected.length-1];b=parseInt(b.id.split("_")[1]);var e=parseInt(a.id.split("_")[1]);a=b;b=-1*(e-b+1)}else b=ctrl.multiSelected[0],a=ctrl.multiSelected[ctrl.multiSelected.length-1],b=parseInt(b.id.split("_")[2]),e=parseInt(a.id.split("_")[2]),a=b,b=-1*(e-b+1);e=shift;var f,g={},k={};if(mode==BUILDER){var l;if(0>b)for(f in builder.cellData)if(f&&(l=
builder.cellData[f])){try{var m=parseInt(builder.absolutePositions[f].split(",")[0])}catch(r){m=l.x}if(!(c||l.y!=a||d&&l.x!=d)||c&&m==a&&(!d||l.y==d))if(doDeleteCheck(l),l.noDelete)return;if(!c&&3>=a-l.y&&0<a-l.y&&builder.ifAdjacent(l.x,l.y)){floatWinWarning(lm.rowNoDeleteSubtableDataCell);return}}shiftFormula();for(f in builder.cellData)if(f&&(l=builder.cellData[f])){try{m=parseInt(builder.absolutePositions[f].split(",")[0])}catch(r){m=l.x}0>b&&!c&&l.y>=a&&l.y<=a+Math.abs(b)-1&&(!d||l.x==d)?delete g[l.x+
","+l.y]:0>b&&c&&m>=a&&m<=a+Math.abs(b)-1&&(!d||l.y==d)?delete g[l.x+","+l.y]:(e(l,a,b,c,d),g[l.x+","+l.y]=l)}linkWizard.specifyForm1LinkField&&(linkWizard.specifyForm1LinkField=shiftPipeIndex(linkWizard.specifyForm1LinkField,c,b));builder.cellData=g;builder.formulaRel.clearFCellRec();for(f in builder.cellData)f&&(l=builder.cellData[f])&&l.attr&&(l.attr.l||l.attr.ln)&&(l.attr.l&&(l.attr.l=shiftPipeIndex(l.attr.l,c,b)),l.attr.ln&&(l.attr.ln=shiftPipeIndex(l.attr.ln,c,b)),l.attr.f&&builder.formulaRel.addFCellRec(l.x+
","+l.y,l.attr.f),0>parseInt(l.nodeId)&&l.attr.dv_f&&builder.formulaRel.addFCellRec(l.x+","+l.y,l.attr.dv_f));for(f in builder.selections)f&&(g=builder.selections[f])&&-1!=f.indexOf("|")&&(builder.selections[shiftPipeIndex(f,c,b)]=g,delete builder.selections[f]);for(f in builder.cascadedSelections)f&&(g=builder.cascadedSelections[f])&&(g.pdomainid&&-1!=g.pdomainid.indexOf("|")&&(g.pdomainid=shiftPipeIndex(g.pdomainid,c,b)),-1!=f.indexOf("|")&&(builder.cascadedSelections[shiftPipeIndex(f,c,b)]=g,delete builder.cascadedSelections[f]));
builder.sections&&builder.sections.sections&&!c&&builder.expandSection(a,b);var n={};for(f in builder.subtableKeys)if(f){var q=f.split(",");g=builder.subtableKeys[f];l=parseInt(q[0]);q=parseInt(q[1]);!c&&q>a?q+=b:c&&l>a&&(l+=b);n[l+","+q]=g}builder.subtableKeys=n;n={};for(f in builder.subtableAliasParents)f&&(q=f.split(","),g=builder.subtableAliasParents[f],l=parseInt(q[0]),q=parseInt(q[1]),!c&&q>a?q+=b:c&&l>a&&(l+=b),n[l+","+q]=g);builder.subtableAliasParents=n;builder.repositionSubtableKey();for(f in builder.freeData)if(f&&
(l=builder.freeData[f])){try{m=parseInt(builder.absolutePositions[f].split(",")[0])}catch(r){m=l.x}0>b&&!c&&l.y>=a&&l.y<=a+Math.abs(b)-1&&(!d||l.x==d)?delete k[l.x+","+l.y]:0>b&&c&&m>=a&&m<=a+Math.abs(b)-1&&(!d||l.y==d)?delete k[l.x+","+l.y]:(e(l,a,b,c,d),k[l.x+","+l.y]=l)}builder.freeData=k;shiftCustAppSeqItems(a,b,c,d);builder.saveStep()}else{c||d||biffdata.subtableShifts.push({y:a,amount:b});for(f=0;f<biffdata.biffs.length;f++)e(biffdata.biffs[f],a,b,c,d);biffdata.maxY++}shiftWidth(c,a,b);c?updateCsTranslatedMapAll():
updateCsTranslatedMap(a)}}
function shiftWidth(a,b,c){if(!biffdata.ifListingPage()){var d,e;a&&biffdata.widthCommand?d=biffdata.widthCommand.split("&"):!a&&biffdata.heightCommand&&(d=biffdata.heightCommand.split("&"));if(d){var f=d.length,g={};for(e=0;d&&e<f;e++){var k=d[e].split("=",2);if(!(2>k.length)){var l=parseInt(k[0]);var m=l+c;l>b&&(d[e]=m+"="+k[1]);-1===c&&l===b&&(d[e]="")}}for(e=0;d&&e<f;e++)b=d[e].split("=",2),2>b.length||Number.isNaN(parseInt(b[0]))||(g[b[0]]=b[1]);d=Object.entries(g).map(function(a){return a[0]+"="+
a[1]}).join("&");a&&biffdata.widthCommand?biffdata.widthCommand=d:biffdata.heightCommand&&(biffdata.heightCommand=d)}}}
function subtableCopyHeight(a,b){if(!biffdata.ifListingPage()){var c,d,e;biffdata.heightCommand&&(c=biffdata.heightCommand.split("&"));if(c){var f=c.length,g=a-b-3,k=c.map(function(a){return a.split("=")[0]});for(d=0;d<f;d++){var l=c[d].split("=",2);if(!(2>l.length)){var m=parseInt(l[0]);if(m===b+3&&m<=a&&0<g&&l[1]!=ctrl.defaultColumnHeightDelta)for(e=1;e<=g;e++){var n=m+e+"";k.includes(n)||c.push(n+"="+l[1])}}}c.sort(function(a,b){return parseInt(a.split("=",2)[0])-parseInt(b.split("=",2)[0])});
biffdata.heightCommand&&(biffdata.heightCommand=c.join("&"))}}}function cleanDefaultWidthHeight(){cleanDefaultWidth();cleanDefaultHeight()}function cleanDefaultWidth(){if(biffdata.widthCommand){var a=biffdata.widthCommand.split("&");a=a.filter(function(a){return parseInt(a.split("=",2)[1])!==ctrl.defaultColumnWidthDelta});a.sort(function(a,c){return parseInt(a.split("=",2)[0])-parseInt(c.split("=",2)[0])});biffdata.widthCommand=a.join("&")}}
function cleanDefaultHeight(){if(biffdata.heightCommand){var a=biffdata.heightCommand.split("&");a=a.filter(function(a){return parseInt(a.split("=",2)[1])!==ctrl.defaultColumnHeightDelta});a.sort(function(a,c){return parseInt(a.split("=",2)[0])-parseInt(c.split("=",2)[0])});biffdata.heightCommand=a.join("&")}}
function copyDataY(a,b,c){for(var d=null,e=--ctrl.minNodeId,f=0;f<biffdata.biffs.length;f++){var g=biffdata.biffs[f];if(g&&g.IPType!=SELECTION&&g.y==a&&(!b||g.x>=b&&g.x<=c)){var k=new Biff(g.sec,g.dataType),l=k.hasAttribute("cg")?k.attr.cg:"";k.y++;k.sec[2]=k.y;k.nodeId=--ctrl.minNodeId;k.value="";k.lazyLoading=g.lazyLoading;k.isSubtableObj=g.isSubtableObj;k.isSubtableObj&&(k.isEmptyRow=!0);biffdata.keyField?(k.parentDomainId=g.parentDomainId,k.parentNodeId=e):d?(k.parentDomainId=d.domainId,k.parentNodeId=
d.nodeId):d=k;mode!=BUILDER&&k.dataType==DATA&&k.format();biffdata.biffs.push(k);if(k.dataType==DATA&&k.parentDomainId){g=k.parentDomainId;var m=void 0;""!==l?isPlainObject(biffdata.subtableDataBiffs[g])&&(m=biffdata.subtableDataBiffs[g][l]):m=biffdata.subtableDataBiffs[g];Array.isArray(m)&&m.push(k)}biffdata.existingCellCords.push(k.x+","+k.y+","+k.domainId+(l?","+l:""))}}}
function _displayReset(){mvpMode||($("nuiform").innerHTML='<input type=hidden name="P_path" value="'+path+'"/><input type=hidden name="P_sheet" value="'+sheet+'"/><input type=hidden name="P_hash" value="'+biffdata.hash+'"/>'+(biffdata.autoSave?"":'<input type=hidden name="P_txn" value="'+biffdata.transactionId+'"/>')+'<input type=hidden name="P_fn" value="'+biffdata.getNUIFileName()+'"/>');nui.init(biffdata.maxY,biffdata.maxX+6);biffdata.updateCellIds=[]}
function _displaySelection(){if(!mvpMode){var a=biffdata,b;selpro.reset();for(b=0;b<a.selections.length;b++){var c=a.selections[b];selpro.removeSelectList(c[1]);var d=selpro.getSelectList(c[1]);d.newUrl=c[2];for(var e=3;e<c.length;e++){var f=c[e].indexOf("|");d.nodeIds.push(c[e].substring(0,f));d.options.push(c[e].substring(f+1,c[e].length))}selpro.domains[c[1]]=d;d.init()}}}
function updateNUIForm(){if(biffdata.autoSave){var a=biffdata.biffs,b=biffdata.ifListingPage(),c=biffdata.rootDomainId,d=biffdata.rootNodeId,e='<input type=hidden name="P_path" value="'+path+'"/><input type="hidden" name="P_sheet" value="'+sheet+'"/><input type="hidden" name="P_hash" value="'+biffdata.hash+'"/><input type="hidden" name="P_fn" value="'+biffdata.getNUIFileName()+'"/>';biffdata.keyField&&!b&&canSaveData()&&(e=0<=d?e+('<input type="hidden" name="M_0000100000_'+c+"_"+d+"_"+biffdata.parentDomainId+
"_"+biffdata.parentNodeId+'" value="" />'):e+('<input type="hidden" name="I_0000100000_'+c+"_"+d+"_"+biffdata.parentDomainId+"_"+biffdata.parentNodeId+'" value="" />'));for(var f=[],g=[],k=0;k<a.length;k++){var l=a[k];if(l){var m=l.dataType;if(m===DATA){var n=l.IPType,q=""+l.nodeId,r=(q=q?q.split("|"):null)?q[q.length-1]:null,p=l.originalNodeId?""+l.originalNodeId.toString().split("|")[0]:null;q=l.domainId;var t=l.x,v=l.y,u=nui._getcell(t,v);if(u){var x=u.ip;if(x){if(l.attr){var E=biffdata.lock;E=
"L"===biffdata.lockMode&&!b||b&&E&&E.includes(l.parentNodeId);x.readOnly=!!(l.attr.ro||E&&!l.attr.nolock);x.readOnly?u.classList.add("read-only_cell"):u.classList.remove("read-only_cell")}n===MSELECTOR&&(x.nodeId=""+x.getNUIFormValue(),x.listdiv=null,x.render());u.biff!==l&&(l.ip=x,x.biff=l,u.biff=l,x.nodeId=l.nodeId);m!==DATA||n!==TYPER&&n!==SELECTOR&&n!==UPLOADER&&n!==GRAPHICS&&n!==MSELECTOR||(b&&biffdata.keyField&&!g.includes(l.parentDomainId+","+l.parentNodeId)&&(e=0>l.parentNodeId?e+('<input type="hidden" name="I_00001000000_'+
l.parentDomainId+"_"+l.parentNodeId+'" value="" />'):e+('<input type="hidden" name="M_00001000000_'+l.parentDomainId+"_"+l.parentNodeId+'" value="" />'),g.push(l.parentDomainId+","+l.parentNodeId)),b||!biffdata.subtableKeyFields.includes(l.parentDomainId)||f.includes(l.parentDomainId+","+l.parentNodeId)||l.parentDomainId===c||(m=biffdata.subtableKeyFields.indexOf(l.parentDomainId),u=c,0<biffdata.subtableKeyFieldAlias[m]&&(u=biffdata.subtableKeyFieldAlias[m]),e=0>l.parentNodeId?e+('<input type="hidden" name="I_00000000001_'+
l.parentDomainId+"_"+l.parentNodeId+"_"+u+"_"+d+'" value="" />'):e+('<input type="hidden" name="M_00000000001_'+l.parentDomainId+"_"+l.parentNodeId+"_"+u+"_"+d+'" value="" />'),f.push(l.parentDomainId+","+l.parentNodeId)),m=createControlBitString(l),n===SELECTOR?(n='<textarea style="display:none" id="IX'+t+"Y"+v+'" name="L_'+m+"_"+l.parentDomainId+"_"+q+"_"+l.parentNodeId+'"aria-hidden="true" aria-label="do not use" aria-readonly="true">'+x.getNUIFormValue()+"</textarea>",l='<textarea style="display:none" id="IUX'+
t+"Y"+v+'" name="U_'+m+"_"+l.parentDomainId+"_"+q+"_"+l.parentNodeId+'"aria-hidden="true" aria-label="do not use" aria-readonly="true">'+(isNaN(parseInt(p))?"":p)+"</textarea>",e+=l+n):n!==MSELECTOR&&(x.nodeId=parseInt(r),n===UPLOADER||n===GRAPHICS?n=l.hasAttribute("multipleImages")||l.hasAttribute("multipleFiles")?createUploadInputElement(l,"L_"+m+"_"+l.parentDomainId+"_"+q+"_"+l.parentNodeId,n===GRAPHICS):createUploadInputElement(l,(0>r||l.hasAttribute("im")?"I":"M")+"_"+m+"_"+q+"_"+r+"_"+l.parentDomainId+
"_"+l.parentNodeId,n===GRAPHICS):(n='<textarea style="display:none" id="IX'+t+"Y"+v+'"',0>r||l.hasAttribute("im")?(n+=' name="I_'+m+"_"+q+"_"+r+"_"+l.parentDomainId+"_"+l.parentNodeId+'"',n=l.hasAttribute("ag")?n+('aria-hidden="true" aria-label="do not use" aria-readonly="true">'+l.attr.ag+"</textarea>"):n+('aria-hidden="true" aria-label="do not use" aria-readonly="true">'+x.getNUIFormValue()+"</textarea>")):(l.hasAttribute("ag")&&x.loadValue(l.value),n+=' name="M_'+m+"_"+q+"_"+r+"_"+l.parentDomainId+
"_"+l.parentNodeId+'"aria-hidden="true" aria-label="do not use" aria-readonly="true">'+x.getNUIFormValue()+"</textarea>")),n&&(e+=n)))}}}}}$("nuiform").innerHTML=e;for(b=0;b<a.length;b++)(c=a[b])&&c.dataType===DATA&&(d=nui._getcell(c.x,c.y))&&(e=d.ip)&&(c.IPType===MSELECTOR&&(e.biff=c,e.listdiv=null,e.render()),c&&!c.hasAttribute("ro")&&biffdata.updateCellIds.push(d.id))}}
function displayData(a){ctrl.displayDataFlag?setTimeout(displayData.bind(null,a),500):(ctrl.displayDataFlag=!0,ctrl.tempScrollTop=nui.main.scrollTop,ctrl.tempScrollLeft=nui.main.scrollLeft,_displayData(a),_process_nuiformContent(),nui.main.scrollTop=ctrl.tempScrollTop,nui.main.scrollLeft=ctrl.tempScrollLeft,nui._updateFocus(),ctrl.displayDataFlag=!1)}
function _process_nuiformContent(){var a=$("nuiform"),b=biffdata,c=b.biffs,d=b.ifListingPage(),e="";b.keyField&&!d&&canSaveData()&&(e=0<=b.rootNodeId?e+('<input type=hidden name="M_0000100000_'+b.rootDomainId+"_"+b.rootNodeId+"_"+b.parentDomainId+"_"+b.parentNodeId+'" value="" />'):e+('<input type=hidden name="I_0000100000_'+b.rootDomainId+"_"+b.rootNodeId+"_"+b.parentDomainId+"_"+b.parentNodeId+'" value="" />'));var f=[],g=[],k;for(k=0;k<c.length;k++){var l=c[k];if(l){var m=l.IPType;if(l.dataType==
DATA){var n=l.x,q=l.y,r=""+l.nodeId,p=(r=r?r.split("|"):null)?r[r.length-1]:null,t=l.originalNodeId?""+l.originalNodeId.toString().split("|")[0]:null;r=l.domainId;var v=l.value?l.value:"";if(!d&&-1!=indexOf(l.parentDomainId,b.subtableKeyFields)&&-1==indexOf(l.parentDomainId+","+l.parentNodeId,f)&&l.parentDomainId!=b.rootDomainId){var u=b.findHeaderFromBiff(l),x=u&&0<=u.originalX&&0<=u.originalY?indexOf(u.originalX+","+u.originalY,b.subtableLocationCheck):indexOf(l.parentDomainId,b.subtableKeyFields);
u=b.rootDomainId;0<b.subtableKeyFieldAlias[x]&&(u=b.subtableKeyFieldAlias[x]);e=0>l.parentNodeId?e+('<input type=hidden name="I_00000000001_'+l.parentDomainId+"_"+l.parentNodeId+"_"+u+"_"+b.rootNodeId+'" value="" />'):e+('<input type=hidden name="M_00000000001_'+l.parentDomainId+"_"+l.parentNodeId+"_"+u+"_"+b.rootNodeId+'" value="" />');f.push(l.parentDomainId+","+l.parentNodeId)}d&&b.keyField&&-1==indexOf(l.parentDomainId+","+l.parentNodeId,g)&&(e=0>l.parentNodeId?e+('<input type=hidden name="I_00001000000_'+
l.parentDomainId+"_"+l.parentNodeId+'" value="" />'):e+('<input type=hidden name="M_00001000000_'+l.parentDomainId+"_"+l.parentNodeId+'" value="" />'),g.push(l.parentDomainId+","+l.parentNodeId));u=createControlBitString(l);m==SELECTOR?(m='<textarea style="display:none" id="IX'+n+"Y"+q+'" name="L_'+u+"_"+l.parentDomainId+"_"+r+"_"+l.parentNodeId+'"aria-hidden="true" aria-label="do not use" aria-readonly="true">'+(isNaN(parseInt(p))?p&&p.startsWith("RAGIC_ATINSZ8_")?p:"":p)+"</textarea>",l='<textarea style="display:none" id="IUX'+
n+"Y"+q+'" name="U_'+u+"_"+l.parentDomainId+"_"+r+"_"+l.parentNodeId+'"aria-hidden="true" aria-label="do not use" aria-readonly="true">'+(isNaN(parseInt(t))?"":t)+"</textarea>",e+=l+m):m!=MSELECTOR&&(m==UPLOADER||m==GRAPHICS?n=l.hasAttribute("multipleImages")||l.hasAttribute("multipleFiles")?createUploadInputElement(l,"L_"+u+"_"+l.parentDomainId+"_"+r+"_"+l.parentNodeId,m==GRAPHICS):createUploadInputElement(l,(0>p||l.attr&&l.attr.im?"I":"M")+"_"+u+"_"+r+"_"+p+"_"+l.parentDomainId+"_"+l.parentNodeId,
m==GRAPHICS):(n='<textarea style="display:none" id="IX'+n+"Y"+q+'"',0>p||l.attr&&l.attr.im?(n+=' name="I_'+u+"_"+r+"_"+p+"_"+l.parentDomainId+"_"+l.parentNodeId+'"',n=l.attr&&l.attr.ag?n+('aria-hidden="true" aria-label="do not use" aria-readonly="true">'+l.attr.ag+"</textarea>"):n+('aria-hidden="true" aria-label="do not use" aria-readonly="true">'+v+"</textarea>")):n+=' name="M_'+u+"_"+r+"_"+p+"_"+l.parentDomainId+"_"+l.parentNodeId+'">'+v+"</textarea>"),e+=n)}}}!mvpMode&&canSaveData()&&(a.innerHTML+=
e)}
function _renderData(a){var b=[],c=[],d=[];$("nuiform");var e=biffdata,f=ctrl,g=nui,k=setBorderClass,l=e.biffs,m=cellRender,n=parseInt,q=e.lock,r=0===e.totalEntry,p,t,v=!0,u=e.ifListingPage(),x="L"==e.lockMode&&!u,E={},D=Array.from(document.querySelectorAll(".outerSelector")).find(function(a){return!("none"===a.style.display||!a.querySelector(".multiSel"))}),A={};for(p=0;p<l.length;p++){var w=l[p];if(w){var F=w.dataType,C=w.IPType,z=(t=""+w.nodeId)?t.split("|"):null,J=z?z[z.length-1]:null;if(z&&1<
z.length&&C===TYPER){z=w.value.split("|");w.value=z[z.length-1];var L=w.displayValue.split("|");w.displayValue=z[L.length-1]}w.originalNodeId&&w.originalNodeId.toString().split("|");var B=w.domainId;z=w.x;L=w.y;A[L]||(A[L]=e.ifRenderRow(L));v&&F===DATA&&(0>J&&(f.pureInsert=!0),v=!1);if(F===HEADER){if(A[L]&&(J=g._getcell(z,L,!0))){J.classList.add("nuiCell","header");DebugToolObj.ifShowDomainId()&&(t=node("div"),t.className="debug_showId",w.getSubtable()&&null==biffdata.findLeftHeader(w)&&(F=node("div"),
F.className="debug_showId",F.appendChild(document.createTextNode(w.getSubtable().domainId)),J.appendChild(F)),t.appendChild(document.createTextNode(B)),J.appendChild(t));if(DebugToolObj.ifShowAttr()&&w&&w.attr){t=!0;B="";for(var y in w.attr)w.attr.hasOwnProperty(y)&&(t&&(B+="attr:\n",t=!1),B+=y+" => "+w.attr[y]+"\n");J.title=B}if(C===FREE){J.classList.add("nuiFreeCell");J.classList.remove("nuiCell","header");z=!1;for(var O in w.attr)if(O&&w.attr[O])try{J.style[O]=w.attr[O],"break-after"===O&&"page"===
w.attr[O]&&(z=!0)}catch(R){}z&&(J.style.display="none");w.action&&(J.action=w.action.startsWith("http")?w.action:"https://"+w.action,J.style.cursor="pointer");L=J.id.split("_");z=parseInt(L[1]);L=parseInt(L[2]);C=w.hasAttribute("cs")?w.attr.cs:null;if(1<C)for(J.colSpan=C,t=1;t<C;t++)g._removecell(z+t,L);if(w.actionButton){if(mode==BROWSE){if(!checkButtonShow(w.actionButton,!0))continue;z=initButtonNode(w.actionButtonId,w.actionButton);setButtonAction(z);J.appendChild(z)}}else z=w.value.replace(/</gim,
"&lt;").replace(/>/gim,"&gt;"),z=cellTextProcess(z),J.action&&(z="<a href="+J.action+' target="_blank" rel="noopener noreferrer nofollow" onmousedown="event.preventDefault();event.stopPropagation();"> '+z+" </a>"),m(J,z);applyCustomBorder(w,J)}else if(C===TYPER||C===SELECTOR||C===UPLOADER||C===GRAPHICS||C===MSELECTOR)if((C=e.ifSubtableBiff(w))&&J.classList.add("table"),w.hasAttribute("cs")&&C&&(J.colSpan=w.attr.cs),w&&w.hasAttribute("hide"))J.classList.add("hide");else{k(J,null);J.biff=w;t=1;C&&(t=
w.attr&&+w.attr.cs||1);B=!0;for(F=0;F<t;++F)if(!ctrl.narrowColumn.includes(w.absoluteX+F)){B=!1;break}B&&J.classList.add("narrowColumn");ctrl.isIE&&w.x<columnSizes.length&&(J.style.width=columnSizes[w.x]+"px");t=node("div");t.classList.add("nuiCellWrapper");B=w.value.replace(/</g,"&lt;").replace(/>/g,"&gt;");w.hasAttribute("must")&&(B='<span class="must"></span>'+B);w.attr&&"true"==w.attr.em&&!u&&(B+=' <sup id="bResendTempId" onmouseover="showTooltip(this,3);" onmouseout="hideTinyTooltip();"><i style="color:#08c;cursor:pointer;margin:0 0 0 2px;font-size:8px;" onclick="resendTempLogInEmail('+
w.domainId+',this)" class="fa fa-envelope"></i></sup>');var K=g._getcell(z-1,L);K&&K.classList.add("hideOverflow");C&&w.attr&&w.attr.fmt_n?(J.classList.add("nuiNumberCell"),t.innerHTML="<span>"+cellTextProcess(B)+"</span>"):t.innerHTML=cellTextProcess(B);J.appendChild(t);applyCustomBorder(w,J);if(u||C)J.domainId=w.domainId,J.showFilterPanel=showFilterPanel,J.listingPageHeader=!0,z=node("i"),z.id="arrow"+w.domainId,z.classList.add("filterPanelButton"),z.classList.add("fas","fa-caret-down"),z.poscell=
J,z.onclick=z.ontouchend=function(a){this.poscell.showFilterPanel();cancelEventBubble(a)},z.onmouseover=function(){this.parentNode.parentNode.classList.add("filterPanelButtonIsHover")},z.onmouseout=function(){this.parentNode.parentNode.classList.remove("filterPanelButtonIsHover")},t.appendChild(z);w.hasAttribute("help")&&(z=node("span"),z.domainId=w.domainId,z.classList.add("nuiCellHint"),z.innerHTML='<a class="help" href=javascript:void(0) onclick="cancelEventBubble(event);openHelpShower(this,this.parentNode.domainId,false,true,false,true,event);"><i class="fas fa-question"></i></a>',
t.appendChild(z))}}}else if(C===TYPER||C===SELECTOR||C===UPLOADER||C===GRAPHICS||C===MSELECTOR)if(F=g._getcell(z,L)){F.classList.add("nuiCell");DebugToolObj.ifShowNodeId()&&(F.classList.add("debug_showNodeId"),F.setAttribute("cellNodeId",w.nodeId));w.hasAttribute("hide")?F.classList.add("hide"):(w.hasAttribute("ro")||e.updateCellIds.push(F.id),u&&r||k(F,1),(K=g._getcell(z-1,L))&&K.classList.add("hideOverflow"),w.hasAttribute("fmt_n")&&(u||e.ifSubtableBiff(w))&&F.classList.add("nuiNumberCell"),w.attr&&
(w.attr.fmt_n||w.attr.ag)&&F.classList.add("noWrapping"),applyCustomBorder(w,F));if(w.ip){var M=w.ip;if(C===SELECTOR||C===MSELECTOR){if(w.hasAttribute("ln")){K=w.attr.ln;var Q=e.findBiff(K,w.y);Q&&Q.nodeId?(M.selectList=selpro.getSelectList(B,K,Q.nodeId),M.filterDomainId=K,M.filterNodeId=Q.nodeId):M.selectList=selpro.getSelectList(B)}else M.selectList=selpro.getSelectList(B);M.listdiv&&(M.listdiv=null)}else if(C===UPLOADER||C===GRAPHICS)M.lastUpdateModeRenderValue=null,f.openSectionFlag&&(M.lastBrowseModeRenderValue=
null)}else if(C===TYPER)M=new Typer;else if(C===SELECTOR){if(w.hasAttribute("ln")?(K=w.attr.ln,M=(Q=e.findBiff(K,w.y))?new Selector(B,K,Q.nodeId):new Selector(B)):(M=new Selector(B),a&&e.notify.includes(B)&&w.attr.dv&&(M.notify=!0)),w.attr&&w.attr.mvp&&(M.mvp=w.attr.mvp),biffdata.cascadedRelation.hasOwnProperty(w.domainId))for(K=biffdata.cascadedRelation[w.domainId],Q=K.length;Q--;){var P=K[Q],G=biffdata.ifSubtableDomainId(P);G=biffdata.findHeader(P,G);if(!G||!G.hasAttribute("l")){P=biffdata.cascadedSelections[P].pbiffs;
for(G=P.length;G--;)P[G].x===w.x&&P[G].y===w.y&&P.splice(G,1);P.push(w)}}}else if(C===MSELECTOR)M=new MSelector;else if(C===UPLOADER||C===GRAPHICS)M=new Uploader(C);w.ip=M;F.ip=M;F.ip.cell=F;M.biff=w;E[B]||(E[B]=0);M.domainNodeSeq=E[B]++;K="";w.value&&(K=w.value);w.hasAttribute("dv")&&canSaveData()&&"#"!==w.attr.dv.charAt(0)&&(!e.ifListingPage()&&e.ifSubtableDataBiff(w)||K||!(0>t)||M.changed||w.updatedBySubform||!canSaveData()||(K=getBiffDefaultValue(w)));M.domainId=n(B);M.nodeId=t;M.loadValue(K,
!w.updatedBySubform);w.updatedBySubform=!1;K=w.value;a||(M.lastFocusValue=K);isNaN(M.nodeId)||(f.minNodeId=f.minNodeId?Math.min(f.minNodeId,M.nodeId):M.nodeId);M.parentDomainId=n(w.parentDomainId);M.parentNodeId=n(w.parentNodeId);e.notify.includes(B)&&(M.notify=!0);if(w.attr){t=x||u&&q&&q.includes(w.parentNodeId);M.readOnly=!!(0>J&&w.attr.ag||w.attr.ro||t&&!w.attr.nolock);if(w.hasAttribute("cs")&&(F.colSpan=w.attr.cs,F.ip.lastBrowseModeRenderValue=null,!biffdata.ifSubtableBiff(w)))for(B=n(w.attr.cs),
t=1;t<B;t++)g._removecell(z+t,L);w.hasAttribute("f")&&(z=w.attr.f,formulaBuilder.add(getCellNameFromDataCache(w),M,z),f.draftLoading||f.cloneAction&&!w.attr.noclone&&!isApprovalFormula(z)||!canSaveData()||w.parentDomainId!==biffdata.rootDomainId||(parseInt(w.nodeId),""===w.value&&w.ip&&!w.ip.changed?c.push({ip:M,f:z}):isInitLoadingFormula(z)&&c.push({ip:M,f:z})));w.hasAttribute("dv_f")&&(formulaBuilder.add(getCellNameFromDataCache(w),M,w.attr.dv_f),!f.draftLoading&&(!f.cloneAction||w.attr.noclone||
isApprovalFormula(w.attr.dv_f))&&canSaveData()&&w.parentDomainId===biffdata.rootDomainId&&0>parseInt(w.nodeId)&&""===w.value&&w.ip&&!w.ip.changed&&c.push({ip:M,f:w.attr.dv_f}));0>J&&w.isRefToOtherFieldAutoGen()&&(autoGenGuessRefValueBuilder.add(M,w.attr.ag),canSaveData()&&w.parentDomainId===biffdata.rootDomainId&&d.push({ip:M,ag:w.attr.ag}))}C===UPLOADER||C===GRAPHICS?M.render(!0,!1,!1,!0):M.render(!0);D&&C===MSELECTOR&&M.listdiv&&M.listdiv.id===D.id&&(M.showList(M.listdiv),M.biff&&M.biff.hasAttribute("usrref")&&
initAvatars());0<F.getElementsByClassName("faicon").length&&F.classList.add("nuiCellHasFieldIcon");!mvpMode&&canSaveData()&&(C==SELECTOR?b.push({ip:M,value:M.userInput}):C!=UPLOADER&&C!=GRAPHICS&&0>J&&w.attr&&w.attr.ag&&b.push({ip:M,value:e.ifSubtableDataBiff(w)&&w.isEmptyRow?"":w.attr.ag,ro:!0}))}}}p=a=p=0;for(a=b.length;p<a;p++)e=b[p],void 0!==e.value&&(e.ip.userInput&&(e.value=e.ip.userInput),e.ip.loadValue(e.value,!0),e.ro&&(e.ip.readOnly=!0),e.ip.render(!0));p=0;for(a=c.length;p<a;p++)b=c[p],
formulaBuilder.updateField(b.ip,b.f),b.ip.render(!0);p=0;for(a=d.length;p<a;p++)c=d[p],autoGenGuessRefValueBuilder.updateField(c.ip),c.ip.render();0!==ctrl.fontSizeRate&&updatePersonalSettingFontSize(ctrl.fontSizeRate)}
function _displayData(a){try{_displayReset(),ctrl.pureInsert=!1,_displaySelection(),ctrl.lazyRendering||processWidth(biffdata.widthCommand,biffdata.heightCommand),_renderData(a),mode!=BUILDER&&showFilterIcons(),nui._updateFocus(),canSaveData()&&0>biffdata.rootNodeId&&processLastEditDefaultValue()}catch(b){processJSExceptionObj(b)}loadingBox&&(loadingBox.style.display="none");ragicLoadBox&&"flex"==ragicLoadBox.style.display&&closeLoadingProgress();try{biffdata.custTheme&&CustThemeHelper.applyTheme(biffdata.custTheme)}catch(b){processJSExceptionObj(b)}try{RagicInteractiveRules.loadRules(biffdata.interactiveRuleString),
RagicInteractiveRules.execute(!0)}catch(b){processJSExceptionObj(b)}try{updateFieldDescriptionFormulas()}catch(b){processJSExceptionObj(b)}try{processEmptyState(),showListingPageSummaryFooter()}catch(b){processJSExceptionObj(b)}try{mode!==UPDATE&&processWidgets()}catch(b){processJSExceptionObj(b)}}function processStar(){var a=biffdata.star;if(a)for(var b in ctrl.listingPageStars)-1!=indexOf(b,a)?listingPageStarFill(b):listingPageStarEmpty(b)}
function canSaveData(){return mode===UPDATE||biffdata.autoSave}
function applyCustomBorder(a,b){var c=!1,d=a.dataType===HEADER,e=a.IPType===FREE,f;for(f in a.attr){try{if(d)if(e)b.style[f]=a.attr[f],b.dataset[f]=a.attr[f];else{if(!f||"style"!=f.substr(0,5)||"styleV"==f.substr(0,6)||!a.attr[f])continue;if("stylefontFamily"==f){var g=b.querySelector("div");g&&(g.style[f.substr(5)]=a.attr[f])}b.style[f.substr(5)]=a.attr[f];b.dataset[f.substr(5)]=a.attr[f]}else{if(!f||"styleV"!=f.substr(0,6)||!a.attr[f])continue;b.style[f.substr(6)]=a.attr[f];b.dataset[f.substr(6)]=
a.attr[f]}}catch(k){}f.includes("border")&&(c=!0)}return c}
function processEmptyState(){if(biffdata.ifListingPage()&&mode===BROWSE&&0===biffdata.totalEntry){var a=biffdata.dataMaxY,b=biffdata.dataminX,c=biffdata.dataMaxX,d=nui._getcell(b,a);c=c-b+1;d.classList.remove("hideOverflow");d.style.whiteSpace="nowrap";for(var e=1;e<c;e++)nui._getcell(b+e,a)&&(nui._getcell(b+e,a).style.display="none");d.classList.remove("nuiCell");d.classList.add("noFocus");a=!1;b=biffdata.filterStatus;for(e=0;e<b.filterItems.length;e++){var f=b.filterItems[e];if(f&&!f.fixed){a=!0;
break}}d.setAttribute("colspan",c);d.innerHTML=a?'<div style="margin:8px 6px 0 0;float:left;">'+lm.emptyStateFilter+' <a href="javascript:void(0);" ontouchend="biffdata.filterStatus.removeFilter(-11);cancelEventBubble(event);" onclick="biffdata.filterStatus.removeFilter(-11);">'+lm.emptyStateClearing+"</a></div>":'<div style="margin:8px 6px 0 0;float:left;">'+lm.emptyStateNoRecord+"</div>"+(!access.singleNew||mvpMode?"":'<div style="margin:8px 0 0 0;float:left;">'+(biffdata.nocreate?"":'<a href="javascript:void(0);" ontouchend="newData();cancelEventBubble(event);" onclick="newData();">'+
lm.emptyStateAddRecord+"</a> "+lm.or.toLowerCase())+' <a href="javascript:void(0);" ontouchend="browse.focusbcell = 0;browseForward();cancelEventBubble(event);" onclick="browseForward();">'+lm.emptyStateGoFormPage+"</a></div>");d.style.paddingLeft="20px";d.style.color="#000";ctrl.editIcon&&(document.body.removeChild(ctrl.editIcon),ctrl.editIcon=null)}}
function showListingPageSummaryFooter(){if(biffdata.ifListingPage()&&mode===BROWSE&&0!==biffdata.totalEntry){var a=nui._getcell(biffdata.dataminX,biffdata.dataMaxY+1);if(a){a.style.whiteSpace="nowrap";a.classList.add("noFocus");var b=0<biffdata.filterStatus.filterItems.length;a.colSpan=8;a.innerHTML='<a href="javascript:void(0);" style="font-size:10px;" onclick="doListingPageSummaryFooter(this.parentNode);"><i class="fa fa-calculator"></i> <span style="color:#aaa;">'+(b?lm.calculateFiltered:lm.calculateAllRecords)+
"</span></a>"}}}
function doListingPageSummaryFooter(a){a.innerHTML='<i class="fa fa-spinner fa-spin" style="margin:25px;"></i>';ajaxget("/sims/totalSummaryFooter.jsp",{a:ap,p:path,fn:sheet},function(b){rm(a);b=JSON.parse(b);var c=biffdata.dataMaxY,d=biffdata.dataminX,e=nui._getcell(d,c+1);e.colSpan=1;for(var f=0;f<biffdata.biffs.length;f++){var g=biffdata.biffs[f];if(g.dataType!=HEADER)break;if(!g.attr||!g.attr.hide){var k=b[g.domainId];e=nui._getcell(d+f,c+1);e.className="totalCell";if(k&&k.total&&0!=k.total){var l=
g.hasAttribute("fmt_n")?g.attr.fmt_n:"#,###.##",m=g.hasAttribute("fmt_n_ds")?g.attr.fmt_n_ds:".";g=g.hasAttribute("fmt_n_ts")?g.attr.fmt_n_ts:",";k=ragic_number_format(k.total,l,g,m);e.style.textAlign="right";e.innerHTML=k}else e.innerHTML="-"}}})}function updateFieldDescriptionFormulas(){setTimeout(_updateFieldDescriptionFormulas,50)}
function _updateFieldDescriptionFormulas(){for(var a=biffdata.biffs,b=nui,c=0;c<a.length;c++){var d=a[c];if(d&&d.dataType===HEADER&&d.IPType===FREE){var e=b._getcell(d.x,d.y,!0);e&&d.value&&d.value.includes("[formula]")&&cellRender(e,cellTextProcess(d.value))}}}
function createControlBitString(a){if(!a)return"00000000000";if(!a.attr)return"0000"+(biffdata.rootDomainId==a.domainId?"1":"0")+"000000";var b=!1;if(a.attr.l){var c=biffdata.findBiff(a.attr.l,a.y);c&&c.hasAttribute("dv")&&(b=!0)}return(a.attr.ag?"1":"0")+(a.attr.dv||a.attr.fs?"1":"0")+(a.attr.im?"1":"0")+(a.attr.em?"1":"0")+(biffdata.rootDomainId==a.domainId?"1":"0")+(a.attr.interm?"1":"0")+("1"==a.attr.usrref?"1":"0")+("1"==a.attr.grpref?"1":"0")+(a.attr.nu?"1":"0")+(a.attr.noDup?"1":"0")+(-1!=
biffdata.subtableKeyFields.indexOf(a.domainId)?"1":"0")+(a.attr.masked?"1":"0")+(a.IPType?GRAPHICS==a.IPType||UPLOADER==a.IPType?"1":"0":"0")+(b?"1":"0")}function builderCellRender(a,b){a&&void 0!==b&&null!==b&&(cellRender(a,b),b=(b+"").replace(/\n/gm,"<br>"),ctrl.isIE&&(a.style.width="100%",b.includes("<br/>")&&(a.style.overflow="auto",a.style.height="100%")))}
function cellRender(a,b){if(a&&void 0!==b&&null!==b){b=(b+"").replace(/\n/gm,"<br/>");b.endsWith("<br/>")&&(b+="\u3000");b.includes("<br/>")&&a.classList.add("hasLinebreak");var c=a.ip,d=c&&c.biff&&c.biff.hasAttribute&&c.biff.hasAttribute("barcode");c&&!mvpMode&&!d&&biffdata.ifSubtableBiff(c.biff)&&(b='<span class="listingLink" onmousedown="if(mode==BROWSE && !ifRightClick(event) && browseForward()){event.stopPropagation();}">'+b+"</span>");a.innerHTML=b}}
function adjustPrevNext(){if($("bPrevPage")){if(mode!=BROWSE||ctrl.queryMode||window.embedEntry)if($("bPrevPage").style.visibility="hidden",$("bNextPage").style.visibility="hidden",$("bFirstPage").style.display="none",!window.embedEntry||!mvpMode)return;mvpMode&&createMVPNavigator();if(biffdata){var a=$("bPrevPage"),b=$("bNextPage"),c=$("bFirstPage");mvpMode&&(a=$("bPrevPage4MVP"),b=$("bNextPage4MVP"),c=$("bFirstPage4MVP"));"F"===biffdata.prevButton&&"F"===biffdata.nextButton?(a.style.display="none",
b.style.display="none",c.style.display="none"):"F"===biffdata.prevButton?(a.style.display="none",a.style.visibility="hidden",b.style.display="",b.style.visibility="",c.style.display="none"):("F"===biffdata.nextButton?(a.style.display="",a.style.visibility="",b.style.display="",b.style.visibility="hidden"):(a.style.display="",a.style.visibility="",b.style.display="",b.style.visibility=""),c.style.display="");biffdata.ifListingPage()||($("bFirstPage").style.display="none")}}}
function processDefaultValueString(a){if(""==a)return"";if(!a||"string"!==typeof a)return null;if(a.includes("$DATE")&&"$DATETIME"!==a)return a=a.replace("$DATE",(new Date).getTime()/864E5),a=Function('"use strict";return ('+a+")")(),formatDate(new Date(864E5*a),"yyyy/M/d");if("$"===a.substr(0,1)){var b=new Date;"$DATE"===a?a=formatDate(b,"yyyy/MM/dd"):"$YEAR"===a?a=b.getFullYear():"$MONTH"===a?a=b.getMonth()+1:"$TIME"===a?a=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds():"$DATETIME"===a?a=formatDate(b,
"yyyy/MM/dd HH:mm:ss"):"$WEEKDAY"===a?a=b.getDay():"$USERID"===a?a=window.user||"":"$USERNAME"===a||"$USER"===a?a=userName||"":"$ACCOUNT"===a?a=window.myapp:"$MGRACCOUNT"===a?a=window.mymgrapp:a.startsWith("$CUR")?(b=a.substr(4,3),a=a.substr(7,3),a=fxrate(b,a),a=ragic_number_format(a,"#.#####")):"$EMPTY_VALUE"===a&&(a="")}return a}function fxrate(a,b){return 1/fxget(a)*fxget(b)}
function fxget(a){ctrl.fx||ajaxget("/sims/fx.jsp",{t:(new Date).getTime()},function(a){ctrl.fx=JSON.parse(a)},!0);return ctrl.fx[a]}function fxset(){var a=$("f_fx_from").options[$("f_fx_from").selectedIndex].value,b=$("f_fx_to").options[$("f_fx_to").selectedIndex].value;builder.setAttributeCurrentCell("dv","$CUR"+a+b)}
function getBiffDefaultValue(a){if(!a)return null;var b=a.attr.dv;if(!b)return b;b=decHTML(b);if("$"===b.substr(0,1)){var c=new Date;"$DATE"===b?b=formatDate(c,"yyyy/MM/dd"):"$TIME"===b?b=LZ(c.getHours())+":"+LZ(c.getMinutes())+":"+LZ(c.getSeconds()):"$DATETIME"===b?b=formatDate(c,"yyyy/MM/dd HH:mm:ss"):"$YEAR"===b?b=c.getFullYear():"$MONTH"===b?b=c.getMonth()+1:"$WEEKDAY"===b?b=c.getDay():"$USERID"===b?b=window.user||"":"$USERNAME"===b||"$USER"===b?b=window.userName||"":"$ACCOUNT"===b?b=window.myapp:
"$MGRACCOUNT"===b?b=window.mymgrapp:"$SEQ"===b?((b=biffdata.findBiff(a.domainId,parseInt(a.y)-1))&&b.y!=parseInt(a.y)-1&&(b=null),b=b?parseInt(b.value)+1:1,isNaN(b)&&(b=a&&a.ip&&a.ip.domainNodeSeq?a.ip.domainNodeSeq+1:1),b+=""):b.startsWith("$CUR")&&(c=b.substr(4,3),b=b.substr(7,3),b=fxrate(c,b),b=ragic_number_format(b,"#.#####"))}else if("#"===b.substr(0,1))if(c=new Date,"#DATE"===b)b=formatDate(c,"yyyy/MM/dd");else if("#TIME"===b)b=LZ(c.getHours())+":"+LZ(c.getMinutes())+":"+LZ(c.getSeconds());
else if("#DATETIME"===b)b=formatDate(c,"yyyy/MM/dd HH:mm:ss");else if("#YEAR"===b)b=c.getFullYear();else if("#MONTH"===b)b=c.getMonth()+1;else if("#WEEKDAY"===b)b=c.getDay();else if("#USERID"===b)b=window.user&&!equalIgnoreCase(window.user,"guest account")?window.user:"";else if("#USERNAME"===b||"#USER"===b)b=window.userName&&!equalIgnoreCase(window.userName,"guest account")?window.userName:"";a.attr&&(a.attr.fmt_d?b=shrinkDateByFormat(b,a.attr.fmt_d):a.attr.fmt_n&&a.attr.fmt_n.includes("%")&&b.includes("%")&&
(a=parseFloat(b.replace(/[^0-9.-]+/g,"")),Number.isNaN(a)||(b=Math.round(a/100*1E12)/1E12)));return b}function shrinkDateByFormat(a,b){if(isNumeric(a))var c=ragic_date_parse(a,b);else c=new Date(a),isNaN(c)&&(c=ragic_date_parse(a,b));if(!c)return a;b.includes("s")||c.setSeconds(0,0);b.includes("m")||c.setMinutes(0);b.includes("H")||b.includes("h")||c.setHours(0);b.includes("d")||c.setDate(1);b.includes("M")||c.setMonth(0);return formatDate(c,getStandardFormat(b))}
function loadVersion(a,b,c,d){var e="";if(a)if(b)$("floatingWin")&&floatWinClose(),e="&v="+a;else{b={a:encodeURIComponent(ap),p:encodeURIComponent(path),fn:encodeURIComponent(sheet),v:a,ifListingPage:builder.ifListingPage()};getPromise("/sims/dev/formVersionLinkAndReferenceCheck.jsp",b).then(function(b){var e=JSON.parse(b);b='<div style="line-height: 1.5em;"><p style="margin:12px 25px;">'+d+"</p>";if(e.ifAlert){b+='<p style="margin:12px 25px; font-weight: bold;">'+getBundleString("designRestoreUnmatchedLinkAndReferences")+
"</p>";b=b+'</div><table style="margin:12px 25px; text-align: left;"><tr style="font-weight: bold; font-size: 13px;"><th style="padding-right: 10px;">'+(getBundleString("domainName")+"("+getBundleString("Doc_InfoLocation")+")\uff1a</th><th>"+getBundleString("referencedSheet")+"\uff1a</th></tr>");e=$jscomp.makeIterator(Object.entries(e.referenceMap));for(var f=e.next();!f.done;f=e.next()){var l=$jscomp.makeIterator(f.value);f=l.next().value;l=l.next().value;b+='<tr><td style="padding-right: 10px;"><input style="text-overflow: ellipsis; font-weight: bold; width:20em;" value="'+
f+'" readonly /></td><td><input style="text-overflow: ellipsis; font-weight: bold; width:20em;" value="'+l+'" readonly /></td></tr>'}b+="</table>"}b+='<p><span style="margin:12px 5px 12px 25px;" class="topButtonWhole" onclick="loadVersion('+a+",true,"+c+')" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.restore+'</span><span style="margin:12px 8px 12px 8px;" class="topButtonWhole" onclick="$(\'floatingWin\').style.display=\'none\';" onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+
lm.cancel+"</span></p>";floatWin(null,b,"",!0)});return}builder.versionLoaded=!0;read(callBuilderLoad,"/sims/form_builder.jsp?a="+encodeURIComponent(ap)+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+e,!0);builder.versionLoaded=!1;a&&b&&!c&&(builder.saveVersion=!0);builder.ifListingPage()&&listingPageFieldHelper(a);ctrl.outOfNUI=!1}
function designModeListingPageHotspot(){var a=window.userProperties.regdate,b=tutorial.getEnabled(),c=biffdata.ifListingPage();a&&!b&&(window.userProperties.hsDesignL||mode!=BUILDER||c||showDesignModeListingPageHotspot())}
function showDesignModeListingPageHotspot(){$("bOtherPage").onmouseover=null;$("bOtherPage").onmouseout=null;videoHotspot($("bOtherPage"),"/intl/"+lm.lang+"/basic3.mp4",2,3,function(){saveUserProperties("hsDesignL","1");placeHotspot($("bOtherPage"),2,builder.switchPage);tooltipV2(ctrl.hotspot,lm.hstry3,3,50)})}
function showDesignModeListingPagePrompt(){preloadVideo("/intl/"+lm.lang+"/basic3.mp4");tooltipV2($("bOtherPage"),function(){var a=$("preloadedVideo");$("tutorialText").appendChild(a);a.loop=!0;a.currentTime=0;a.load();a.play();a.style.width="540px";a.style.height="303.75px";a.style.top="20px";a.id=null},3,50,576,353.75,"#f2f2f2","#aaa")}
function applyHotspots(){var a=window.userProperties.regdate,b=tutorial.getEnabled();if(a&&!b&&(!ctrl.hotspot||""!=ctrl.hotspot.style.display)){a=!biffdata.ifListingPage();b=window.userProperties.hsListForm;var c=window.userProperties.hsDesign,d=window.userProperties.hsDesignL;if(mode==BROWSE){var e=$("_2_2");e&&"none"!=e.style.display||(e=$("_1_2"));b||!e||a?b&&!c&&a&&"none"!=$("v5NUIHeaderDesign").style.display&&($("v5NUIHeaderDesign").onmouseover=null,$("v5NUIHeaderDesign").onmouseout=null,videoHotspot($("v5NUIHeaderDesign"),
"/intl/"+lm.lang+"/basic2.mp4",2,3,function(){saveUserProperties("hsDesign","1");placeHotspot($("v5NUIHeaderDesign"),2,modeBuilder);tooltipV2(ctrl.hotspot,lm.hstry2,3,50)})):videoHotspot(e,"/intl/"+lm.lang+"/basic1.mp4","cl",2,function(){saveUserProperties("hsListForm","1");placeHotspot(e,"cl",browseForward,function(){cellMouseoverByIndex(e.browseIndex)});tooltipV2(ctrl.hotspot,lm.hstry1,3,50)})}else mode==BUILDER&&(resetHotspot(),c&&!d&&a&&$("bOtherPage")&&($("bOtherPage").onmouseover=null,$("bOtherPage").onmouseout=
null,videoHotspot($("bOtherPage"),"/intl/"+lm.lang+"/basic3.mp4",2,3,function(){saveUserProperties("hsDesignL","1");placeHotspot($("bOtherPage"),2,builder.switchPage);tooltipV2(ctrl.hotspot,lm.hstry3,3,50)})))}}
var selpro={domains:{},reset:function(){this.domains={};rm($("selectListGlobalContainer"))},removeSelectList:function(a,b,c){b&&c?delete this.domains[a+"_"+b+"_"+c]:delete this.domains[a]},getSelectList:function(a,b,c){var d=b&&c?this.domains[a+"_"+b+"_"+c]:this.domains[a];if(!d&&(d=new SelectList,d.init(),this.domains[a]=d,d.outerContainer.setAttribute("temp",a),a=biffdata.findBiff(a)[0]))try{var e=a.attr;Object.keys(e).filter(function(a){return a.startsWith("styleV")}).forEach(function(a){d.outerContainer.setAttribute(a,
e[a])})}catch(f){console.log(f)}return d}},DEBUGCOUNT=0;function SelectList(){DEBUGCOUNT++;this.options=[];this.nodeIds=[];this.match=[];this.matchNodeIds=[];this.outerContainer=node("div");this.container=node("table");this.highlighted=-1}
SelectList.prototype.init=function(){var a=this.container,b=this.outerContainer;b.className="outerSelector";b.style.display="none";b.style.zIndex=150;a.className="selector";a.selector=this;b.getAttribute("stylevfontsize")&&(a.style.fontSize=b.getAttribute("stylevfontsize")+"px");b.appendChild(a);b.parentNode&&"selectListGlobalContainer"==b.parentNode.id||$("selectListGlobalContainer").appendChild(b)};SelectList.prototype.remove=function(){document.body.removeChild(this.outerContainer)};
SelectList.prototype.place=function(a){if(a&&!(a&&a.biff&&a.biff.attr&&(a.biff.attr.hide||a.biff.attr.ro))){var b=a.cell,c=this.outerContainer.style,d=this.container,e=b.getBoundingClientRect(),f=document.body.clientHeight-e.bottom,g=$("v5SidebarTD").getBoundingClientRect();c.display="";c.width=Math.max(b.offsetWidth,d.offsetWidth)+"px";d.style.width=c.width;b=d.offsetHeight+(ctrl.isIE?2:0);e.top>f&&f<b?(f=e.top<b?e.top-3:b,c.height=f+"px",c.top=e.top-f+"px"):(c.height=(f<b?f-5:b)+"px",c.top=e.bottom+
"px");c.left=(g.right<e.left?e.left:g.right)+"px";floatingPanels.push(this.outerContainer);this.selector=a;a.biff&&a.biff.hasAttribute("usrref")&&initAvatars()}};SelectList.prototype.processSelectorLocation=function(a){a=findPos(a.cell)[1]+a.cell.clientHeight;ctrl.floatListHeight=document.body.clientHeight+nui.main.scrollTop-a;50>ctrl.floatListHeight&&(ctrl.floatListHeight=document.body.clientHeight/2);ctrl.floatListSize=999};
SelectList.prototype.listAllCascaded=function(a,b){var c,d=this.container,e=d.insertRow(0),f;for(c=0;c<b.length;c++)if(b[c]){f||(f=e.insertCell(e.cells.length));var g=parseInt(b[c].substring(0,b[c].indexOf("|"))),k=b[c].substring(b[c].indexOf("|")+1,b[c].length),l=node("div");l.noWrap=!0;l.className="selItemOff";k=unformatNUIAttr(k).replace(/&#44;/gim,",");l.onmouseover=selItemOn;l.onmouseout=selItemOff;l.option=k;l.nodeId=g;l.container=d;l.selector=a;l.onclick=opdivclick;l.innerHTML=cellTextProcess(k,
mvpMode);f.appendChild(l);this.itemCount++}if(0===this.itemCount||b&&0===b.length)f||(f=e.insertCell(e.cells.length)),f.innerHTML='<div class="selItemOff" style="color:#AAAAAA;white-space:nowrap;">'+lm.noValue+"</div>";this.highlighted=-1};
SelectList.prototype.listAll=function(a){if(a.mvp)clickMVP(a);else{var b=this,c,d=b.container;rm(d);b.itemCount=0;var e=cascadedFilters(a);if(e)this.listAllCascaded(a,e);else{var f=d.insertRow(0),g,k=a.biff,l=k&&k.attr&&k.attr.usrref?k.attr.usrref:null;for(c=0;c<b.options.length;c++)if(b.options[c]&&b.nodeIds[c]&&(!e||-1!==e.indexOf(b.nodeIds[c]+"|"+b.options[c]))){g||(g=f.insertCell(f.cells.length));var m=node("div");m.noWrap=!0;m.className="selItemOff";var n=b.options[c];n=unformatNUIAttr(n).replace(/&#44;/gim,
",");m.onmouseover=selItemOn;m.onmouseout=selItemOff;m.option=n;m.nodeId=b.nodeIds[c];m.container=d;m.selector=a;m.onclick=opdivclick;m.innerHTML=(l?"<div class='avatar optionAvatar'>"+getAvatarHTMLByNodeId(b.nodeIds[c],n.toString().replace(/&#60;/g,"<").replace(/&#62;/g,">"))+"</div>":"")+cellTextProcess(n,mvpMode);g.appendChild(m);b.itemCount++}if(k&&k.hasAttribute("userOps")&&!k.hasAttribute("mvp")&&!k.hasAttribute("usrref")&&!k.hasAttribute("grpref"))allowOptionAdded(f,g);else if(0===b.itemCount||
e&&0===e.length)g||(g=f.insertCell(f.cells.length)),g.innerHTML='<div class="selItemOff" style="color:#AAAAAA;white-space:nowrap;">'+lm.noValue+"</div>";b.newUrl&&0<b.newUrl.length&&(g||(g=f.insertCell(f.cells.length)),m=node("div"),m.noWrap=!0,m.className="selItemOff",m.onmouseover=selItemOn,m.onmouseout=selItemOff,m.selectList=b,m.selector=a,m.onclick=function(){ctrl.newWinCallbackSelector=this.selector;ctrl.newWinCallbackFunction=ctrlNewWinCallbackFunction;window.open(location.protocol+"//"+location.host+
"/"+b.newUrl+"?new&saveClose")},m.style.color="#888888",m.innerHTML=lm.addOptions,g.appendChild(m));a.biff.hasAttribute("mvp")&&(m=node("div"),m.noWrap=!0,m.className="selItemOff",m.onmouseover=selItemOn,m.onmouseout=selItemOff,m.selector=a,m.onclick=function(){clickMVP(this.selector)},m.style.color="#888888",m.innerHTML="View Detail",g.appendChild(m));b.highlighted=-1}}};
function ctrlNewWinCallbackFunction(a){mvpMode&&(ctrl.outOfNUI=!1,disableMVP());ctrl.newWinCallbackSelector&&ctrl.newWinCallbackSelector.loadValueByNodeId(a)}function selItemOn(){this.className="selItemOn"}function selItemOff(){this.className="selItemOff"}
SelectList.prototype.mvpListLoad=function(a,b,c){var d=this;if(a!=d.lastMatch&&(d.lastMatch=a,d.options=[],d.nodeIds=[],!c)){c=-1;b.biff.hasAttribute("stf")?c=parseInt(b.biff.attr.stf):b.biff.hasAttribute("usrref")&&(c=4);var e=b.biff.attr.mvpf,f=b.biff.attr.mvp;e=e?processMVPF(e,b.biff.y):null;read(function(a){a=a.responseText.split("\n");var b;for(b=0;b<a.length;b++){var c=a[b].split("|");2>c.length||(c[1].indexOf("<br/>")&&(c[1]=c[1].replaceAll("<br/>","\n")),d.options.push(c[1]),d.nodeIds.push(c[0]))}},
"/sims/options.jsp?a="+ap+(f?"&mvp="+encodeURIComponent(f):"")+(e?"&mvpf="+e:"")+"&d="+b.biff.domainId+"&st="+encodeURIComponent(a)+(0<c?"&stf="+c:""),!0)}};
SelectList.prototype.listMatch=function(a,b){if(!a&&0!==a||" "===a)return!1;var c,d=this.container;a=a.toString();a=a.replace(/</gim,"&#60;");a=a.replace(/>/gim,"&#62;");this.keyboardMode&&b.biff.lazyLoading&&b.biff.hasAttribute("mvp")&&this.mvpListLoad(a,b);var e=cascadedFilters(b),f=[],g=[];for(c=0;c<this.options.length;c++){var k=this.options[c],l=this.nodeIds[c];if(k&&l&&(!e||-1!==e.indexOf(l+"|"+k))){var m=k.toUpperCase().indexOf(decHTML(a).toUpperCase());0==m&&(f.push(k),g.push(l))}}for(c=0;c<
this.options.length;c++)k=this.options[c],l=this.nodeIds[c],!k||!l||e&&-1===e.indexOf(l+"|"+k)||(m=k.toUpperCase().indexOf(decHTML(a).toUpperCase()),0<m&&(" "==k.charAt(m-1)||ifChinese(k.charAt(m-1))||ifChinese(k.charAt(m)))&&(f.push(k),g.push(l)));if(this.keyboardMode&&!b.biff.lazyLoading&&b.biff.hasAttribute("mvp")&&!g.length<window.selectAutoCompleteMax)for(this.mvpListLoad(a,b),f=[],g=[],c=0;c<this.options.length;c++)k=this.options[c],l=this.nodeIds[c],!k||!l||e&&-1===e.indexOf(l+"|"+k)||(m=k.toUpperCase().indexOf(a.toUpperCase()),
0<=m&&(0==m||" "==k.charAt(m-1)||ifChinese(k.charAt(m-1))||ifChinese(k.charAt(m)))&&(f.push(k),g.push(l)));this.match=f;this.matchNodeIds=g;rm(d);this.itemCount=0;d=d.insertRow(0);var n;for(c=0;c<this.match.length;c++)n||(n=d.insertCell(d.cells.length)),f=node("div"),f.noWrap=!0,f.className="selItemOff",g=this.match[c],f.onmouseover=selItemOn,f.onmouseout=selItemOff,f.option=g,f.nodeId=this.matchNodeIds[c],f.selector=b,f.onclick=opdivclick,g=displayValueProcess(g),m=g.toUpperCase().indexOf(a.toUpperCase()),
f.innerHTML=0>m?g:g.substr(0,m)+'<span style="font-weight:700;">'+g.substr(m,a.length)+"</span>"+g.substring(m+a.length,g.length),n.appendChild(f),this.itemCount++;if(0===this.itemCount||e&&0===e.length)e=b.biff,n||(n=d.insertCell(d.cells.length)),n.innerHTML='<div class="selItemOff" style="color:#AAAAAA;white-space:nowrap;">'+lm.noValue+"</div>",!e||!e.hasAttribute("userOps")||e.hasAttribute("mvp")||e.hasAttribute("usrref")||e.hasAttribute("grpref")||allowOptionAdded(d,n,a.toString());b.mvp||(this.highlighted=
-1);return!0};
SelectList.prototype.moveop=function(a){0<=this.highlighted&&this.highlighted<this.itemCount&&(this.container.rows[0].cells[parseInt(this.highlighted/ctrl.floatListSize)].childNodes[this.highlighted%ctrl.floatListSize].className="selItemOff");this.highlighted+=a;0>this.highlighted?this.highlighted=0:this.highlighted>=this.itemCount&&(this.highlighted=this.itemCount-1);this.outerContainer.scrollTop=19*(this.highlighted-ctrl.floatListHeight/22)+3;0>this.highlighted?this.highlighted=0:(a=this.container.rows[0].cells[parseInt(this.highlighted/
ctrl.floatListSize)].childNodes[this.highlighted%ctrl.floatListSize],a.className="selItemOn",this.selector.mvp||(this.selector.userInput=a.option))};function allowOptionAdded(a,b,c){a.cells.length||c||(b=a.insertCell(0));a=document.createElement("div");a.appendChild(document.createTextNode(lm.addOptions));b.appendChild(a);a.className="multiSel";a.style.color="#AAAAAA";a.setAttribute("nowrap","nowrap");a.setAttribute("onclick","initOptionAdding(event"+(c?",'"+encjs(c)+"'":"")+");")}
function initOptionAdding(a,b){cancelEventBubble(a);ctrl.outOfNUI=!0;ctrl.dropWin=!1;clearDropWin();a="<div>"+lm.addOptions+'\uff1a<input type="text" value="'+(b?decjs(b):"")+'" id="newOp" onkeypress="if (event.key === \'Enter\') { addOption(); cancelEventBubble(event); }" autofocus/>&#32;<button onclick="addOption();" >OK</button></div>';floatWin(null,a,lm.addOptions,!0);$("newOp").focus()}
function addOption(){var a=$("newOp").value.trim();if(a)for(var b=nui._curcell().ip.biff,c=biffdata.selections.length;c--;){if(biffdata.selections[c][1]==b.domainId){var d=biffdata.selections[c],e="",f=-1;c=3;for(var g=d.length;c<g;c++){if(d[c].includes("|")){e=d[c].indexOf("|");var k=parseInt(d[c].slice(0,e));f>=k&&(f=k-1);e=d[c].slice(e+1)}else e=d[c];if(e===a){ctrl.outOfNUI=!1;floatWinWarning(lm.dataDup);return}}postPromise("/"+ap+path+"/"+sheetIndex,{api:"",addOption:"",fid:b.domainId,option:a}).then(function(){d.push(f+
"|"+a);var c=nui._getcell(b.x,b.y).ip;_displaySelection();if(mode===UPDATE)if(c instanceof MSelector&&$("IX"+b.x+"Y"+b.y)){var e="IX"+b.x+"Y"+b.y,g=Array.from($(e).querySelectorAll("input[type='checkbox']")).filter(function(a){return a.checked});$("nuiform").removeChild($(e));c.listdiv=null;c.render();g.forEach(function(a){$(e)&&$(e).querySelector("input[value='"+a.value+"']")&&$(e).querySelector("input[value='"+a.value+"']").parentNode.click()});$(e)&&$(e).querySelector(".multiSel[value='"+a+"']")&&
$(e).querySelector(".multiSel[value='"+a+"']").click()}else c.loadValue(a),c.render();else mode===BROWSE&&c instanceof MSelector&&$("IX"+b.x+"Y"+b.y)&&(g="IX"+b.x+"Y"+b.y,$("nuiform").removeChild($(g)),c.listdiv=null,c.render());ctrl.outOfNUI=!1;$("floatingWin").style.display="none";refreshV6Search()}).catch(function(){ctrl.outOfNUI=!1;$("floatingWin").style.display="none"});break}}else $("newOp").focus()}
function getInput(){var a=$("hin").getValue();if("\n"==a&&!nui._atHighRow())return"";if("\n"==a.charAt(0)&&!nui._atHighRow())return a&&0<a.length?a.substring(1):"";a||(a="");return a}
function opdivclick(){var a=this.selector;mode!=UPDATE&&(biffdata.autoSave?a.lastFocusValue=a.biff.value:modeUpdate());a&&(a.biff.nodeId=this.nodeId,a.loadValue(this.option,!1,0<=this.nodeId?this.nodeId:null),a.highlight=!0,a.render(),$("hin").setValue(this.option));a.selectList.outerContainer&&(a.selectList.outerContainer.style.display="none");hinFocus();biffdata.autoSave&&autoSaveInterval(500)}
function Selector(a,b,c){this.type=SELECTOR;this.domainId=a;this.userInput="";this.typing=this.highlight=!1;this.filterDomainId=b;this.filterNodeId=c;this.selectList=selpro.getSelectList(a,b,c)}Selector.prototype.getSelectList=function(a){return selpro.getSelectList(this.domainId,this.filterDomainId,this.filterNodeId)};
Selector.prototype.keyDown=function(a){if(this.readOnly||this.biff&&this.biff.hasAttribute("hide"))return!0;var b=a.altKey,c=a.ctrlKey,d=a.metaKey,e=checkIfUserCanEdit(!0),f=this.getSelectList();switch(a.keyCode){case KEYCODE.BACKSPACE:if(biffdata.autoSave&&mode===BROWSE&&!e)break;this.highlight?this._backspace():this._backspace(1);break;case KEYCODE.DELETE:if(biffdata.autoSave&&mode===BROWSE&&!e)break;this._backspace();break;case KEYCODE.UP:return!this.changeSelectedOption(-1);case KEYCODE.DOWN:return!this.changeSelectedOption(1);
case KEYCODE.ENTER:a.returnValue=!1;if("none"!==f.outerContainer.style.display&&f.highlighted>=f.itemCount&&(a=f.container.rows[0].cells[parseInt(f.highlighted/ctrl.floatListSize)].childNodes[f.highlighted]))return a.dispatchEvent(new MouseEvent("click")),f.highlighted=f.options.length-1,!1;if(b)return!1;break;default:b||c||d||hinFocus()}return!0};Selector.prototype.setSelectorItemOn=function(a){a&&(a.classList.add("selItemOn"),a.classList.remove("selItemOff"))};
Selector.prototype.setSelectorItemOff=function(a){a&&(a.classList.add("selItemOff"),a.classList.remove("selItemOn"))};
Selector.prototype.changeSelectedOption=function(a){var b=this.getSelectList();if("none"===b.outerContainer.style.display)return!1;var c=b.container.rows[0];if(!c)return!1;var d=Math.floor(b.highlighted/ctrl.floatListSize);-1===d&&(d=0);c=c.cells[d];a=b.highlighted+a;0>a?a=0:a>=c.children.length&&(a=c.children.length-1);d=c.querySelector(".selItemOn");this.setSelectorItemOff(d);b.highlighted=a;0<=a&&a<b.options.length?b.moveop(0):this.setSelectorItemOn(c.childNodes[a]);return!0};
Selector.prototype.keyUp=function(a){if(this.readOnly||this.biff&&this.biff.hasAttribute("hide"))return!1;if(biffdata.autoSave&&mode===BROWSE&&!checkIfUserCanEdit())return!0;var b=getInput();a=a.keyCode;if(b&&0<b.length){if(KEYCODE.isArrowKey(a)||a==KEYCODE.DELETE||a==KEYCODE.ENTER)return hinFocus(),!0;this.typing=!0;this._write(b)}return!0};
Selector.prototype._backspace=function(a){mode==BROWSE&&modeUpdate();var b=this.getSelectList();this.highlight||!a?this.userInput="":(this.userInput=this.userInput.substr(0,Math.max(0,this.userInput.length-a)),this.userInput||(this.userInput=""));this.highlight=!1;b.keyboardMode=!0;b.processSelectorLocation(this);this.userInput?this.delayedListMatch(this.userInput,b):(this.mvp||(b.listAll(this),b.place(this)),this.loadValue(""),this.render())};
Selector.prototype._write=function(a,b){var c=this.biff;if(c&&c.attr&&c.attr.checkbox)a.endsWith(" ")&&nextSelectOption(this);else{testInput=a;this.highlight=!1;this.getSelectList().keyboardMode=!0;if(canSaveData()&&!biffdata.ifListingPage()&&c&&c.ifCreateInsertRow()&&!b){shiftData(c.y,1);if(biffdata.ifSubtableDataBiff(c)){a=c.parentDomainId;var d;c.hasAttribute("cg")?isPlainObject(biffdata.subtableDataBiffs[a])&&(d=biffdata.subtableDataBiffs[a][c.attr.cg]):d=biffdata.subtableDataBiffs[a];if(Array.isArray(d)){a=
0;for(var e=d.length;a<e;a++){var f=d[a];if(void 0===g||f.x<g)var g=f.x;if(void 0===k||f.x>k)var k=f.x;if(void 0!==l&&l<f.y)break;var l=f.y}}}copyDataY(c.y,g,k);biffdata.expandSection(c.y,1);displayData()}c=this.getSelectList();c.processSelectorLocation(this);this.delayedListMatch(testInput,c,b)}};
Selector.prototype.delayedListMatch=function(a,b,c){var d=this,e=d.biff;e.attr&&e.attr.mvp?(ctrl.mvpKeyboardInputing&&clearTimeout(ctrl.timer),ctrl.mvpKeyboardInputing=!0,ctrl.timer=setTimeout(function(){ctrl.mvpKeyboardInputing=!1;b.listMatch(a,d);c||b.place(d);d.mvp&&d.changeSelectedOption(0)},300),d._renderFocus(nui.focus),d.userInput=a):(b.listMatch(a,d),d.userInput=a,""!=d.userInput&&" "!=d.userInput||d.mvp||($("hin").setValue(""),b.listAll(d)),c||b.place(d),d.render())};
Selector.prototype.click=function(){};Selector.prototype.dblclick=function(){};Selector.prototype.focus=function(){this.highlight=!0;this.mvp?(nui.focus.selector=this,nui.focus.onclick=function(a){cancelEventBubble(a);clickMVP(this.selector)},nui.focus.ontouchstart=function(a){cancelEventBubble(a);clickMVP(this.selector)}):(nui.focus.onclick=selectorClick,nui.focus.addEventListener("touchstart",selectorClick));this.biff&&(this.lastFocusValue=this.biff.value)};
Selector.prototype.blur=function(){var a=this.biff;this.typing=this.highlight=!1;nui.focus.onclick=null;nui.focus.ontouchstart=null;var b=this._getSuggest();this.nodeIdSpecified&&a.value==b||(this.userInput&&0<this.userInput.length?this.loadValue(b):this.loadValue(""));this.userInput!=a.value&&(this.userInput=a.value);this.userInput&&0<this.userInput.length&&""==b&&this.loadValue("");this.render();clearDropWin();return!1};
Selector.prototype.validate=function(a){var b="";if(this.biff&&this.biff.hasAttribute("va")){var c=this.biff.attr.va,d="[^ ]"==c;if(!(new RegExp(c)).test(this.userInput)&&(""!=this.userInput||d)){if(!a)return floatWinWarning(lm.valueFormatIncorrect+": <b>"+this.value+"</b>"),!1;b+="FormatError"}}a=nui._curcell();if(this.biff&&this.biff.hasAttribute("must")&&a){if(a=a.ip)a.blur(),a.focus();if(""==this.userInput||null==this.userInput)b+="|Empty"}return b};
Selector.prototype.loadValueByNodeIdAndValue=function(a,b){var c=selpro.getSelectList(this.biff.domainId);c.options||(c.options=[],c.nodeIds=[]);if(0>a)return!1;-1==c.options.indexOf(""+b)&&(b.indexOf("<br/>")&&(b=b.replaceAll("<br/>","\n")),c.options.push(""+b),c.nodeIds.push(""+a));this.lastMatch=b;this.loadValue(b,!1,a?a:Number(0));return!0};
Selector.prototype.loadValueByNodeId=function(a,b,c,d){var e=this.biff,f=selpro.getSelectList(e.domainId),g="";if(0>a)return!1;var k={a:ap,d:e.attr.s||e.domainId,nodeId:a,stf:e.attr.stf};e.attr&&e.attr.mvp&&(k.mvp=e.attr.mvp);ajaxget("/sims/options.jsp",k,function(b){g=b;f.options.push(""+b);f.nodeIds.push(""+a)},!0);if(c&&c!=g)return!1;this.lastMatch=g;this.loadValue(g,b,a?a:Number(0),!1,d);return!0};Selector.prototype.getValue=function(){return this.userInput};
Selector.prototype.getNUIFormValue=function(){return this.nodeId};
Selector.prototype.loadValue=function(a,b,c,d,e,f){var g=this.biff,k=this.getSelectList(),l=g.value;this.userInput=a=a.toString().replace(/</g,"&#60;").replace(/>/g,"&#62;");var m=g.attr&&g.attr.usrref?g.attr.usrref:null,n=g.attr&&g.attr.dv?encHTMLTag(g.attr.dv):null,q=null!==g.nodeId&&""!==g.nodeId&&!isNaN(g.nodeId)&&0<=g.nodeId,r=g.nodeId&&14<g.nodeId.length&&"RAGIC_ATINSZ8_"==g.nodeId.substr(0,14)&&!g.hasAttribute("mvp");k&&k.nodeIds&&isNumeric(g.nodeId)&&0<=g.nodeId&&!k.nodeIds.includes(g.nodeId)&&
(k.nodeIds.push(""+g.nodeId),k.options.push(""+a));if(g&&!mvpMode){var p=selpro.getSelectList(g.domainId);if(b)if(m){var t;g.nodeId&&(t=isNaN(g.nodeId)?g.nodeId.split("|")[0]:g.nodeId);if(n&&canSaveData()&&(biffdata.ifListingPage()||!biffdata.ifSubtableDataBiff(g)))if(("$USER"===n||"$USERNAME"===n)&&(!t||0>parseInt(t))||"#USER"===n||"#USERNAME"===n)0>parseInt(window.userNodeId)&&(delete g.attr.dv,a=this.userInput=""),t=window.userNodeId;else if(m=p.nodeIds[indexOf(n,p.options)],0<=m){var v=n;var u=
m}if(t||0==t)v=indexOf(t,p.nodeIds),0<=v?(v=this.userInput=p.options[v],u=t):(v="",u=null);v||(v="")}else if(q)v=this.userInput,u=g.nodeId;else if(r)v=this.userInput,u=g.nodeId;else if(n&&canSaveData()&&(biffdata.ifListingPage()||!biffdata.ifSubtableDataBiff(g))){if("$USER"===n||"$USERNAME"===n||"#USER"===n||"#USERNAME"===n)n=window.userName;else if("$USERID"===n||"#USERID"===n)n=window.user;m=p.nodeIds[indexOf(n,p.options)];0<=m?(v=n,u=m):g.hasAttribute("mvp")?(v="",u=null,k.mvpListLoad(n,this),
m=p.nodeIds[indexOf(n,p.options)],0<=m&&(v=n,u=m)):(v=this.userInput,u="RAGIC_ATINSZ8_"+n)}else v=this.userInput,u=g.nodeId;else v=this._getSuggest(d),c?(u=c,this.nodeIdSpecified=!0):(u=this._getSuggestNodeId(d),this.nodeIdSpecified=!1),!(0<=parseInt(u))&&f&&g.hasAttribute("mvp")&&n&&canSaveData()&&!biffdata.ifListingPage()&&biffdata.ifSubtableDataBiff(g)&&(k.mvpListLoad(n,this),m=p.nodeIds[indexOf(n,p.options)],0<=m&&(v=n,u=m));g.value=v;this.nodeId=g.nodeId=u;$("IX"+g.x+"Y"+g.y)&&($("IX"+g.x+"Y"+
g.y).value=u);l===g.value||b&&(!n||n.startsWith("#"))||f||processLastEditDefaultValue(b,g);p=(!f||""!==v)&&(this.oldSuggest!=v||c||c===Number(0));void 0===this.oldSuggest&&(this.oldSuggest="");this.notify&&!ctrl.pauseSubtableExtend&&(this.reloadNotify||p&&(!b||n))&&(this.reloadNotify=!1,this.oldSuggest=v,c="/sims/form_subform.jsp?"+(biffdata.ifListingPage()?"listing&":"")+"a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+"&x="+g.x+"&y="+g.y+"&d="+g.domainId+"&n="+(u||""),b&&
ctrl.urlCache[c]&&1E3>(new Date).getTime()-ctrl.urlCache[c]||!u&&d||(ctrl.urlCache[c]=(new Date).getTime(),read(biffdata.loadDataSubform.bind(biffdata),c,!0)));this.oldSuggest=v}if(!b&&(ctrl.pauseSubtableExtend||d||e||subTableExtendProcess(a,g,null),mode===BUILDER||!biffdata.ifSubtableDataBiff(g)||a&&l||f||(checkEmptySubtableRows(g),updateSameSubtableRowBiffsFormulaEngine(g)),p)){if((a=biffdata.cascadedRelation[g.domainId])&&0<a.length)for(d=0,e=a.length;d<e;d++)for(f=biffdata.findBiff(a[d]),l=0,
c=f.length;l<c;l++)if(n=f[l],!biffdata.ifSubtableBiff(g)||n.y===g.y)if(n=n.ip)n.loadValue("",!1),n.render();RagicInteractiveRules.execute(!1,g)}mode!==BUILDER&&(ctrl.formulaResultCache={},this.updateFormulaEngine(b),this.updateAutoGenGuessRefSeq(b));biffdata.autoSave&&!b&&p&&(g&&g.hasAttribute("checkbox")?autoSaveInterval(1E3):autoSaveInterval(500))};
Selector.prototype.updateFormulaEngine=function(a,b){var c=this.biff;try{if(resetFormulaObject(c),!a){var d=getCellNameFromDataCache(c);d&&(formulaBuilder.update(d,c,b),updateFieldDescriptionFormulas())}}catch(e){processJSExceptionObj(e)}};Selector.prototype.updateAutoGenGuessRefSeq=function(a){var b=this.biff;try{mode!==BUILDER&&b&&(resetAutoGenGuessRefValueMapping(b),a||autoGenGuessRefValueBuilder.update(b))}catch(c){processJSExceptionObj(c)}};
function checkboxSymbolRender(a){var b=a.toLowerCase().replace(/^\([^\(]*\)/,"");return"yes"==b?'<i class="fa fa-check checkboxSymbol" style="color:#118811;"></i>':"no"==b?'<i class="fa fa-check checkboxSymbol" style="color:#dfdfdf;"></i>':"star"==b?'<i class="fa fa-star checkboxSymbol" style="color:#ffdd6d;"></i>':"important"==b?'<i class="fa fa-exclamation checkboxSymbol" style="color:#E00;margin:1px 0 0 5px;"></i>':"x"==b?'<i class="fa fa-times checkboxSymbol" style="color:#C00;margin:-1px 0 0 1px;"></i>':
"green"==b?'<i class="fa fa-circle checkboxSymbol" style="color:#118811;"></i>':"lightgreen"==b?'<i class="fa fa-circle checkboxSymbol" style="color:#90EE90;"></i>':"yellow"==b?'<i class="fa fa-circle checkboxSymbol" style="color:#ffdd6d;"></i>':"orange"==b?'<i class="fa fa-circle checkboxSymbol" style="color:#FFA500;"></i>':"red"==b?'<i class="fa fa-circle checkboxSymbol" style="color:#E00;"></i>':"purple"==b?'<i class="fa fa-circle checkboxSymbol" style="color:#800080;"></i>':"blue"==b?'<i class="fa fa-circle checkboxSymbol" style="color:#4584ef;"></i>':
"darkblue"==b?'<i class="fa fa-circle checkboxSymbol" style="color:#00008B;"></i>':"black"==b?'<i class="fa fa-circle checkboxSymbol" style="color:#333;"></i>':"white"==b?'<i class="far fa-circle checkboxSymbol" style="color:#333;"></i>':"toggle-on"==b?'<i class="far fa-toggle-on checkboxSymbol" style="color:#03d626;"></i>':"toggle-off"==b?'<i class="far fa-toggle-on fa-rotate-180 checkboxSymbol" style="color:#dfdcdc"></i>':"thumbs-up"==b?'<i class="fas fa-thumbs-up checkboxSymbol" style="color:#333;"></i>':
"thumbs-down"==b?'<i class="fas fa-thumbs-down checkboxSymbol" style="color:#333;"></i>':"lock"==b?'<i class="fas fa-lock checkboxSymbol" style="color:#333;"></i>':"unlock"==b?'<i class="fas fa-unlock checkboxSymbol" style="color:#333;"></i>':"plus"==b?'<i class="fas fa-plus checkboxSymbol" style="color:#333;"></i>':"minus"==b?'<i class="fas fa-minus checkboxSymbol" style="color:#333;"></i>':"smile"==b?'<i class="far fa-smile checkboxSymbol" style="color:#333;"></i>':"meh"==b?'<i class="far fa-meh checkboxSymbol" style="color:#333;"></i>':
"frown"==b?'<i class="far fa-frown checkboxSymbol" style="color:#333;"></i>':"circle"==b?'<i class="far fa-circle checkboxSymbol" style="color:#7b7b7b;"></i>':"dot-circle"==b?'<i class="far fa-dot-circle checkboxSymbol" style="color:#7b7b7b;"></i>':a}
Selector.prototype.renderCheckbox=function(){var a=this.cell,b=this.biff;a.style.paddingLeft="6px";rm(a);var c=node("div");c.style.display="inline-block";a.appendChild(c);c.innerHTML=checkboxSymbolRender(b.value);var d=this,e=biffdata.ifListingPage();c.onmousedown=function(){d.readOnly||!e&&"L"===biffdata.lockMode&&!b.hasAttribute("nolock")||e&&biffdata.lock&&biffdata.lock.includes(b.parentNodeId)&&!b.hasAttribute("nolock")||(nui._focus(d.biff.x,d.biff.y),nextSelectOption(d))};this.focusClickFunc=
c.onmousedown};
function nextSelectOption(a){if(mode!=BUILDER&&(canSaveData()||modeUpdate(),canSaveData())){1>=a.selectList.options.length&&a.biff.hasAttribute("checkbox")&&(a.selectList.nodeIds=[-1,-2],a.selectList.options=["No","Yes"]);var b=indexOf(a.biff.value,a.selectList.options),c=a.selectList.options[b];b++;b>=a.selectList.options.length&&(b=0);var d=a.selectList.options[b];if(1<a.selectList.options.length)for(;d===c;)b++,b>=a.selectList.options.length&&(b=0),d=a.selectList.options[b];a.loadValue(d);a.render()}}
Selector.prototype.render=function(a){var b=this.cell,c=this.biff;if(!c||!c.hasAttribute("hide")){var d=mode!==BUILDER?biffdata:builder;if(!c||d.ifRenderRow(c.y))if(this.readOnly&&b.classList.add("read-only_cell"),c&&c.hasAttribute("checkbox"))this.renderCheckbox();else{var e=biffdata.ifListingPage();d=nui.focus;rm(b);if(ctrl.isIE)if(b.colSpan){var f=0,g=0;for(g=0;g<b.colSpan;g++)this.biff.x<columnSizes.length&&(f+=columnSizes[this.biff.x]);b.style.width=f+"px"}else this.biff.x<columnSizes.length&&
(b.style.width=columnSizes[this.biff.x]+"px");f=node("div");var k=this;f.style.overflow="hidden";ctrl.isIE&&(f.noWrap=!0,f.style.minHeight="24px");if(biffdata&&!this.readOnly&&(mode===UPDATE||!e)){g=node("i");var l=this.biff.attr.usrref?"fa-user":this.biff.attr.grpref?"fa-users":"fa-caret-down";g.className="fa "+l+" fa-fw faicon";g.cell=b;g.onmouseout=function(){this.className="fa "+l+" fa-fw faicon"};k.mvp?(g.selector=this,g.onmousedown=function(a){cancelEventBubble(a);clickMVP(this.selector)},g.addEventListener("touchstart",
function(a){cancelEventBubble(a);clickMVP(this.selector)})):(g.onmousedown=selectorClick,g.addEventListener("touchstart",selectorClick));f.appendChild(g)}b.appendChild(f);b=k.userInput?k.userInput:"";b=b.toString().replace(/</gim,"&#60;").replace(/>/gim,"&#62;");g=k.getSelectList().newUrl;if(!g&&this.biff.hasAttribute("mvp")){var m=k.biff.attr.mvp;m&&(g=m.split("|")[0],m=m.split("|")[1].split("_")[0],g=ap+g+"/"+m)}e=(m=k.biff.hasAttribute("usrref")||k.biff.hasAttribute("grpref"))&&e||"true"==window.userProperties.fpHoverDisabled;
g&&!m&&(m=this.biff.nodeId&&14<this.biff.nodeId.length&&"RAGIC_ATINSZ8_"==this.biff.nodeId.substr(0,14)&&!c.hasAttribute("mvp")?-1:this.biff.nodeId,b='<a href="javascript:void(0);" style="'+("false"!==window.userProperties.showLinkNLoadAsLink||"true"===window.userProperties.clickLinkFieldToOpenEntry?"":"color:#333")+'" onmousedown="if(mode!=BROWSE){return;}event.stopPropagation();"'+(("false"!=window.userProperties.showLinkNLoadAsLink?" onclick=\"showFpClick('"+g+"',"+m+');"':"")+(e?"":" onmouseover=\"showFp(event,'"+
g+"',"+m+');" onmouseout="resetShowFp(event)"'))+("true"===window.userProperties.clickLinkFieldToOpenEntry?"onclick=\"window.open('/"+g+"/"+m+"','_blank');\"":"")+' onclick="if(mode==BROWSE && !ifRightClick(event)){browseForward();}">'+b+"</a>");e=!1;g=null;if(mode===BROWSE&&k.biff&&(+k.biff.parentDomainId!==+biffdata.rootDomainId||biffdata.ifSubtableDataBiff(k.biff))&&k.biff.hasAttribute("link")&&k.biff.hasAttribute("linkTo")&&0<=k.biff.parentNodeId){var n=k.biff.attr.linkTo;e=n.split("/");4===e.length?
n="/"+ap+"/"+e[2]+"/"+e[3]:3===e.length&&(n="/"+ap+n);e=!0;g=function(){open(n+"/"+k.biff.parentNodeId,"_blank")}}m=a?k.userInput:k._getSuggest(!0);var q=k.emptyValue&&""==k.userInput;a=node("span");a.className=k.highlight&&!q?"cellSuggest":"cellText";var r=node("span");r.className="cellSuggest";f.appendChild(a);f.appendChild(r);q?a.innerHTML=k.emptyValue:b?(this.biff.attr.styleVfontFamily&&(a.style.fontFamily=this.biff.attr.styleVfontFamily),e&&(a.className="fakeLink"),g&&(a.onmousedown=g),a.innerHTML=
cellTextProcess(b,mvpMode)):rm(a);m&&m.substring&&k.userInput?r.innerHTML=m.substring(k.userInput.length,m.length):rm(r);0==r.innerHTML.length&&(r.style.display="none");if(c&&c.attr&&c.attr.ifReadInfo){b=node("span");var p=biffdata.getTask(k.userInput,biffdata.ifListingPage()?""+c.parentNodeId:null);p&&"F"==p.s?(a.onmouseenter=function(){tooltipTiny(this,'<div class="centerLabel" style=color:#888;>'+lm.notified+"</div> "+p.cd+'<br><div class="centerLabel" style=color:#0C0;>'+lm.read+"</div> "+p.fd)},
b.onmouseenter=a.onmouseenter,b.innerHTML='<i style="margin:0 0 0 3px;color:#0a0;font-size:14px;" class="fa fa-check"></i>'):p&&"P"==p.s&&p.cd&&(a.onmouseenter=function(){tooltipTiny(this,'<div class="centerLabel" style=color:#888;>'+lm.notified+"</div> "+p.cd+'<br><div class="centerLabel" style=color:#c00;>'+lm.unread+"</div>")},b.onmouseenter=a.onmouseenter,b.innerHTML='<i style="margin:0 0 0 3px;color:#ccc;font-size:14px;" class="fa fa-check"></i>');a.onmouseout=hideTinyTooltip;b.onmouseout=a.onmouseout;
f.appendChild(b)}k.biff.hasAttribute("nowrap")&&(f.style.whiteSpace="nowrap");k._renderFocus(d)}}};Selector.prototype._setHinSize=function(a){var b=$("hin"),c=b.style,d=$("sizeCalc");d.innerHTML=b.getValue();c.width=Math.max(a.offsetWidth,d.offsetWidth+10)+"px";c.height=Math.max(a.offsetHeight,d.offsetHeight)+"px"};
Selector.prototype._renderFocus=function(a){if(this.biff.x===nui.fcol&&this.biff.y===nui.frow)if(this.typing){var b=$("hin").style;this._setHinSize(a);b.top=a.offsetTop+"px";b.left=a.offsetLeft+"px";b.overflow="hidden";b.display=""}else hideEditElements()};
Selector.prototype._getSuggest=function(a){if(""===this.userInput)return"";var b=this.getSelectList();this.pasting&&(b.keyboardMode=!0);var c=b.match[b.highlighted];b.listMatch(this.userInput,this);c=c?b.match.indexOf(c):b.highlighted;0<=c&&b.match.length>c||(c=indexOf(this.userInput,b.match),a||-1!=c||(c=0));b=b.match[c];return-1==c?"":b?a?b==this.userInput?b:"":b:""};
Selector.prototype._getSuggestNodeId=function(a){var b=this.getSelectList();if(""==this.userInput)return"";var c=indexOf(this.userInput,b.match);a||-1!=c||(c=0);if(0<=c){var d=b.matchNodeIds[c];var e=b.match[c]}return d?0<=d?d:mvpMode?"":"RAGIC_ATINSZ8_"+e:""};Selector.prototype.onpaste=function(){this.readOnly||window.setTimeout(processPaste,5)};Selector.prototype.clear=function(){this.userInput="";this.render()};
Selector.prototype.setReadonly=function(a){this.readOnly=a;this.cell.classList.toggle("read-only_cell",a);this.render();a&&biffdata&&(a=biffdata.updateCellIds.indexOf(this.cell.id),0<=a&&biffdata.updateCellIds.splice(a,1))};
function selectorClick(a){if(this.cell&&!this.cell.classList.contains("hide")){var b=this.cell.ip,c=b.biff;if(!(c&&c.attr&&c.attr.checkbox)){a||(a=window.event);a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation();c=parseInt(this.cell.id.split("_")[1]);var d=parseInt(this.cell.id.split("_")[2]);mode==BROWSE&&2>ctrl.multiSelected.length&&(nui.fcol!=c||nui.frow!=d)&&nui._focus(c,d);if((mode!=BROWSE||checkIfUserCanEdit())&&b.getSelectList){var e=b.getSelectList();e.processSelectorLocation(b);b.readOnly||
("none"!=e.outerContainer.style.display?e.outerContainer.style.display="none":(mode!=BROWSE&&nui._focus(c,d),clearDropWin(),b.biff.hasAttribute("check")?(b.biff.value="Y",b.render()):2>ctrl.multiSelected.length&&(e.listAll(b),e.place(b),0<e.matchNodeIds.length&&""!==b.userInput&&(e.highlighted=e.nodeIds.indexOf(e.matchNodeIds[0]),e.moveop(0)))),cancelEventBubble(a))}}}}
function cascadedFilters(a){var b=null,c=a.domainId;if(biffdata.cascadedSelections.hasOwnProperty(c)){b="";var d=biffdata.cascadedSelections[c].pbiffs;if(1<d.length){a=a.biff;for(var e=0;e<d.length;e++)if(a.y===d[e].y){b=d[e].value;break}}else 1===d.length&&(b=d[0].value);b=biffdata.cascadedSelections[c].collection[b]||[];0===d.length&&(b=[].concat.apply([],Object.values(biffdata.cascadedSelections[c].collection)))}return b}
var mvpController,mvpBrowse,mvpMode=!1,mvpIp,nuiTemp,biffdataTemp,browseTemp,pathTemp,sheetTemp;
function initMVP(a,b,c,d,e,f){!mvpController&&a&&b&&(c||(c=-1),$("mvpWin").style.display="",modeTemp=mode,mode=BROWSE,ctrl.currentNUI=$("mvp"),ctrl.currentNUI_outer=$("mvp_outer"),ctrl.currentNUI.style.width="30000px",ctrl.currentNUI.style.height="30000px",mvpController=new DataController,ctrl.currentController=mvpController,nuiTemp=nui,biffdataTemp=biffdata,pathTemp=path,sheetTemp=sheet,biffdata=nui=null,path=a,sheet=b,sheetIndex=parseInt(sheet.split("_")[0]),f&&f.biff&&f.biff.hasAttribute("mvpMulti")&&
biffdataTemp.ifSubtableBiff(f.biff)&&(ctrl.mvpMulti=!0),modeTemp===BUILDER&&(ctrl.autogenMvp=!0),mvpBrowse=new BrowseController,browseTemp=browse,browse=mvpBrowse,ajaxget("/sims/getListingPageWidth.jsp",{a:ap,p:path,fn:sheet},function(a){a=parseInt(a)||0;$("mvpWin").style.width=a+100+"px";$("mvpWin").style.maxWidth=.9*document.body.clientWidth+"px";$("mvpWin").style.minWidth="700px";$("mvpWinDiv").style.height=.9*document.body.clientHeight+"px"},!0),mvpMode=!0,ctrl.mvpStf=c,a=processMVPF(d,e),ctrl.currentController.load("&mvpcreate",
"&pd=0"+(a||""),function(){mode==BROWSE&&(nui.main.scrollTop=0,browse._init(),browse._focus());$("searchboxMVP").value="";ifMobile||$("searchboxMVP").select()}))}
function tempDisableMVP(){ctrl.tempCurrentNUI=ctrl.currentNUI;ctrl.tempCurrentNUI_outer=ctrl.currentNUI_outer;ctrl.currentNUI=$("nui");ctrl.currentNUI_outer=$("nui_outer");ctrl.tempMvpController=mvpController;mvpController=null;ctrl.currentController=nuiController;ctrl.mvpTemp=nui;ctrl.mvpBiffdata=biffdata;ctrl.mvpPath=path;ctrl.mvpSheet=sheet;ctrl.mvpSheetIndex=sheetIndex;nui=nuiTemp;biffdata=biffdataTemp;path=pathTemp;sheet=sheetTemp;sheetIndex=parseInt(sheet.split("_")[0]);mvpBrowse=browse;browse=
browseTemp;mode=UPDATE;mvpMode=!1}function tempDisableMVPReverse(){ctrl.currentNUI=ctrl.tempCurrentNUI;ctrl.currentNUI_outer=ctrl.tempCurrentNUI_outer;mvpController=ctrl.tempMvpController;ctrl.currentController=mvpController;nui=ctrl.mvpTemp;biffdata=ctrl.mvpBiffdata;path=ctrl.mvpPath;sheet=ctrl.mvpSheet;sheetIndex=ctrl.mvpSheetIndex;browse=mvpBrowse;mode=BROWSE;mode==BROWSE&&browse&&(browse._init(),browse._focus());mvpMode=!0}
function processMVPF(a,b){if(a){var c="";a=a.split("&");for(var d=0;d<a.length;d++)a[d]=replaceDynamicFilter(a[d],b);for(d=0;d<a.length;d++)a[d]&&""!=a[d]&&(c+="&fv2="+a[d]);return c}return null}
function replaceDynamicFilter(a,b){if(!a)return a;a=decodeURIComponent(a);var c=a.split("|");if(2<c.length&&"-1"==c[2])return"";if(2<c.length&&c[1].startsWith("11,")){var d="",e="";a=c[1].split(",");3===a.length?(e=a[1],d=a[2]):2===a.length&&(e=a[1]);c[1]="11";c[2].startsWith("$")&&(a=parseInt(c[2].substr(1)),isNaN(a)?c[2]=processDefaultValueString(c[2]):(c[2]=getValueForField(a,b),c[2]||(c[2]="")));!c[2]&&d?c[2]=d:(c[2]=e.replace("{0}",c[2]),c[2]=encodeURIComponent(c[2]));c=c.join("|")}else if(2<
c.length&&c[2].startsWith("$")){a=parseInt(c[2].substr(1));if(isNaN(a))c[2]=processDefaultValueString(c[2]);else{c[2]=getValueForField(a,b);if(!c[2])return"";"8"===c[1]&&((d=biffdataTemp)||(d=biffdata),(b=d.findBiff(a,b))&&b.IPType===MSELECTOR||(c[2]=escapeRegExp(c[2])));c[2]=encodeURIComponent(c[2])}c=c.join("|")}else c=a;return encodeURIComponent(c)}
function getValueForField(a,b){var c=biffdataTemp;c||(c=biffdata);for(var d=0;d<c.biffs.length;d++){var e=c.biffs[d];if(a==e.domainId&&e.dataType===DATA&&c.ifSubtableBiff(e)&&b==e.y)return e.value}for(d=0;d<c.biffs.length;d++)if(e=c.biffs[d],a==e.domainId&&e.dataType===DATA&&!c.ifSubtableBiff(e))return e.value}
function clickMVP(a){if(!(1<ctrl.multiSelected.length||mvpMode)){if(mode!=UPDATE){ctrl.clickMVP=a;if(!modeUpdate())return;delete ctrl.clickMVP;setTimeout(browse._init.bind(browse),1E3)}var b=a?a:this.cell.ip;if(!b.readOnly){var c=b.biff,d=c.attr.mvp;if(d){d=d.split("|");mvpIp=b;b.getSelectList().keyboardMode=!1;ctrl.callMVP=!0;nui._focus(c.x,c.y,null,!0);var e=c.attr&&c.attr.stf?parseInt(c.attr.stf):-1;b=d[0];var f=d[1];d=f.split("_")[0];initMVP(b,f,e,c.attr&&c.attr.mvpf?c.attr.mvpf:null,c.y,a);ctrl.callMVP=
null;e=checkFormRights(b,d);c=!1;if(6===e.userRight||3===e.userRight||1===e.userRight)e.userRightDetail?"0"===e.userRightDetail.charAt(1)&&(c=!0):c=!0;var g=ap+b+"/"+d;ctrl.newWinCallbackFunction=ctrlNewWinCallbackFunction;ctrl.newWinCallbackSelector=a;a=$("bMvpCreateNew");g&&c?(a.style.visibility="",a.onclick=function(){window.open(location.protocol+"//"+location.host+"/"+g+"?new&saveClose")}):a.style.visibility="hidden";ctrl.currentController.resize()}}}}
function callbackMVP(a,b){mode!=UPDATE&&modeUpdate();if(b)mvpIp.loadValueByNodeIdAndValue(a,b);else if(!mvpIp.loadValueByNodeId(a)){biffdata.addSelectionValue(mvpIp.domainId,a,b);var c=mvpIp.selectList;c.options||(c.options=[],c.nodeIds=[]);c.options.push(""+b);c.nodeIds.push(""+a);mvpIp.loadValueByNodeId(a)}mvpIp.highlight=!0;mvpIp.render();hinFocus()}
function selectMVP(){var a=browse._getCell();if(a){var b=browse._getCell().ip;if(b){var c=biffdata.findBiff(ctrl.mvpStf,b.biff.y);c=c?c.value:null;var d=parseInt(b.biff.parentNodeId);0>d&&(d=parseInt(b.biff.nodeId));ctrl.autogenMvp?(disableMVP(),callbackAutoGenRefFieldValuesMvp(d,c)):ctrl.mvpMulti?(browse.selectRow(a.getAttribute("data-y")-biffdata.dataminY),tempDisableMVP(),callbackMVP(d,c),nui.vmove(1),mvpIp=nui._getcell(nui.fcol,nui.frow).ip,tempDisableMVPReverse(),setTimeout("if(!browse.lastFocus){browse._init();}",
500)):(disableMVP(),callbackMVP(d,c))}}}
function disableMVP(){rm(ctrl.currentNUI);ctrl.currentNUI=$("nui");ctrl.currentNUI_outer=$("nui_outer");mvpController=null;ctrl.currentController=nuiController;nui=nuiTemp;biffdata=biffdataTemp;path=pathTemp;sheet=sheetTemp;sheetIndex=parseInt(sheet.split("_")[0]);RagicInteractiveRules.loadRules(biffdata.interactiveRuleString);browse=browseTemp;mvpBrowse=null;$("mvpWin").style.display="none";mode=modeTemp;RagicInteractiveRules.loadRules(mode===BUILDER?builder.conditionalFormattingString:biffdata.interactiveRuleString);
RagicInteractiveRules.execute(!0);mode==BROWSE&&(browse._init(),browse._focus());mvpMode=!1;ctrl.mvpMulti=!1;ctrl.autogenMvp=!1;nui._updateFocus();scrollIncrement()}
function createMVPNavigator(){var a=document.querySelectorAll(".nuiPageHeader_sheetDesc");var b=a.length;0<b&&--b;if(a=a[b]){a.style.width="750px";b=$("bNextPage4MVP");var c=$("bPrevPage4MVP"),d=$("bFirstPage4MVP");b||(b=node("div"),a.appendChild(b),b.id="bNextPage4MVP",b.className="topButtonWholeRight",b.innerHTML="&gt;",b.onclick=browseNextPage);c||(c=node("div"),a.appendChild(c),c.id="bPrevPage4MVP",c.className="topButtonWholeRight",c.innerHTML="&lt;",c.onclick=browsePrevPage);d||(d=node("div"),
a.appendChild(d),d.id="bFirstPage4MVP",d.className="topButtonWholeRight",d.innerHTML="&lt;&lt;",d.onclick=browseFirstPage)}}function Typer(){this.type=TYPER;this.focused=this.typingLock=this.typing=!1}
Typer.prototype.keyDown=function(a){if(this.readOnly||this.biff&&this.biff.hasAttribute("clockin")||this.biff&&this.biff.hasAttribute("hide"))return!0;var b=a.keyCode,c=a.altKey;if(mode==BROWSE&&(b==KEYCODE.DELETE||b==KEYCODE.BACKSPACE)){if(0<ctrl.multiSelected.length){modeUpdate();return}2>ctrl.multiSelected.length&&!biffdata.autoSave&&(modeUpdate(),a.preventDefault())}var d=checkIfUserCanEdit(!0);switch(b){case KEYCODE.DELETE:case KEYCODE.BACKSPACE:if(biffdata.autoSave&&mode===BROWSE&&!d)return!0;
this.typing?(mode==BUILDER&&this.value&&1==this.value.length&&(this.clear(),this.typing=!0,this.render()),this.needFormulaRecalc=!0):(this.clear(),this.typing=!0,this.render());break;case KEYCODE.KEY_229:this.typing=!0,this.render(),hinFocus()}if(b==KEYCODE.ENTER)if(c||nui._atHighRow())if(canSaveData()){if(this.typing)return a.returnValue=!0,!1;if(c)return!1;a.returnValue=!1}else{if(mode==BUILDER){if(c&&builder.mode===BUILDER_TEXT)return!1;a.returnValue=!1;return!c}}else a.returnValue=!1;return!0};
Typer.prototype.keyUp=function(a){if(this.readOnly||this.biff&&this.biff.hasAttribute("clockin"))return!0;if(1<ctrl.multiSelected.length)return!1;var b=a.keyCode,c=a.altKey,d=$("hin"),e=this.biff;if(a.ctrlKey||ctrl.commandKeyDown||b==KEYCODE.LEFT_WIN)return!1;!this.typing&&ifTextInputKeycode(a)&&(this.typing=!0);if(b==KEYCODE.ENTER){c&&(mode!==BUILDER||builder.mode===BUILDER_TEXT)&&d.setValue(d.getValue()+"\n");if(canSaveData()&&(c||nui._atHighRow()))return this.typing&&(c=d.getValue(),this.loadValue(c),
this.render()),!1;a.returnValue=!1;return!0}if(biffdata.autoSave&&mode===BROWSE&&!checkIfUserCanEdit())return!1;c=d.getValue();mode!==BUILDER||ifTextInputKeycode(a)||a.keyCode===KEYCODE.F12||""!==c||(c=this.getValue());mode!==BUILDER&&e&&e.hasAttribute("fmt_n")&&e.attr.fmt_n.includes("%")&&(a=parseFloat(c.replace(/[^0-9\.-]+/g,"")),c.includes("%")&&(a/=100),isNaN(a)||(c=Math.round(1E12*a)/1E12));e&&(e.keyup=!0);this.loadValue(c);e&&(e.keyup=!1);this.render();ctrl.formulaResultCache={};this.typing&&
subTableExtendProcess(c,e);!KEYCODE.isArrowKey(b)||this.typingLock||this.typing||d.select();return!0};Typer.prototype.onpaste=function(){if(!this.readOnly){if(this.biff&&this.biff.hasAttribute("clockin"))return!0;window.setTimeout(processPaste,5)}};Typer.prototype.click=function(){this.typing&&(this.typingLock=!0,this.render())};
Typer.prototype.dblclick=function(){var a=this.biff;if(this.readOnly||mode!==BUILDER&&a&&a.hasAttribute("clockin"))return!0;mode!=BROWSE||ctrl.outOfNUI||modeUpdate();if(canSaveData()&&this.biff&&this.biff.hasAttribute("sig"))showSignBox();else{var b=this.value;mode!==BUILDER&&a&&a.hasAttribute("fmt_n")&&a.attr.fmt_n.includes("%")?(b=Number((100*this.value).toFixed(7))+"",$("hin").setValue(b+"%")):(mode!==BUILDER&&a&&a.hasAttribute("phone")&&a.hasAttribute("phonefmt")&&(b=ragic_phone_unformat(this.value,
a.attr.phonefmt)),$("hin").setValue(b));canSaveData()&&a&&a.hasAttribute("masked")&&("true"==a.attr.masked||1==a.attr.masked)&&(b="",$("hin").setValue(""));setCaretTo($("hin"),b?b.length:0);this.focused=this.typingLock=this.typing=!0;this.render();mode===BUILDER&&(ctrl.typingLock=!0);if(mode===UPDATE&&a&&a.hasAttribute("email")){var c=function(){mode===UPDATE&&mailSuggestion($("hin").getValue(),function(a,b){var d=nui._curcell().ip;floatWinConfirmV3(lm.mailSuggestionTip+"&nbsp;"+a+"&nbsp;?",function(){$("hin").setValue(a);
d.loadValue(a);d.render()},lm.yes,function(){addMailDomainToLocalStorage(b)},lm.no,null,function(){removeEventFromHin("blur",c)})})};addEventToHin("blur",c)}}};
Typer.prototype.focus=function(){var a=this.biff;this.focused=!0;a&&a.hasAttribute("fmt_d")?(nui.focus.onclick=typerClickForDatePicker,nui.focus.ontouchstart=typerClickForDatePicker):a&&a.hasAttribute("html")?(nui.focus.onclick=RTEUIcontroller.showEditor.bind(RTEUIcontroller,this),nui.focus.ontouchstart=RTEUIcontroller.showEditor.bind(RTEUIcontroller,this)):(nui.focus.onclick=null,nui.focus.ontouchstart=null);a&&(this.lastFocusValue=a.value)};
Typer.prototype.blur=function(){var a=this.biff,b=checkIfUserCanEdit(!0);canSaveData()&&(ctrl.submitSemaphore?this.validate(!0):this.validate(!1));this.typingLock&&($("focus").style.zIndex=50);if(this.typing&&(!biffdata.autoSave||mode!==BROWSE||b)){var c=$("hin").getValue();if(mode!==BUILDER&&this.biff&&this.biff.hasAttribute("fmt_n")&&this.biff.attr.fmt_n.includes("%")){var d=parseFloat(c.replace(/[^0-9\.-]+/g,""));d/=100;isNaN(d)||(c=Math.round(1E12*d)/1E12)}c&&(c.endsWith&&c.endsWith(" ")||c.startsWith&&
c.startsWith(" "))&&(mode!==BUILDER||"F"!==this.biff.objectType)&&(c=c.trim());this.loadValue(c)}this.typingLock=this.typing=!1;this.render();this.focused=!1;$("focus").style.pointerEvents=null;mode===BUILDER&&(ctrl.typingLock=!1);if(biffdata.autoSave&&mode===BROWSE&&!b)return!1;b=mode===BUILDER?this.lastFocusValue!==this.value:a&&this.lastFocusValue!==a.value;mode!==BUILDER&&a&&a.attr.fmt_d&&clearDropWin();mode!==BUILDER&&a&&a.hasAttribute("html")&&RTEUIcontroller.closeEditor($("focus").cell);return b};
Typer.prototype.validate=function(a){var b=this.biff,c=b.ip,d="";this.biff&&this.biff.hasAttribute("email")&&(a?ctrl.submitSemaphore||validateEmail(this.value,this):validateEmailTyper(this.value,this));if(this.biff&&this.biff.hasAttribute("va")){var e=this.biff.attr.va,f="[^ ]"===e;try{var g=new RegExp(e)}catch(k){return alert("The validation regular expression is invalid."),"The validation regular expression is invalid."}g.test(this.value)||""==this.value&&!f?(e="",b.attr.styleVbackgroundColor&&
(e=b.attr.styleVbackgroundColor),c.cell.style.backgroundColor=e):(a||(b.attr.va_cust_msg?floatWinWarning(getCustomValidateErrorMessage(b.attr.va_cust_msg,biffdata.findHeader(b.domainId).value,c.value,b.attr.va,b.domainId)):floatWinWarning(getBundleString("valueFormatIncorrect_validate_all",[biffdata.findHeader(b.domainId).value,b.value])),c.cell.style.backgroundColor="#FFCCCC"),d+="FormatError")}this.biff&&this.biff.hasAttribute("must")&&""==this.value&&(!a&&ctrl.submitSemaphore&&(floatWinWarning(getBundleString("mustValueEmpty_validate_all",
[biffdata.findHeader(b.domainId).value])),c.cell.style.backgroundColor="#FFCCCC"),d+="|Empty");return d};Typer.prototype.getValue=function(){return this.value};Typer.prototype.getNUIFormValue=function(){return this.value};
Typer.prototype.loadValue=function(a,b,c,d,e,f){var g=this.biff;c=!1;a==this.oldValue||b||(RagicInteractiveRules.execute(!1,g),this.needFormulaRecalc=this.changed=!0,f||(c=mode!==BUILDER&&biffdata.ifSubtableDataBiff(g)&&(""===a||""===this.oldValue)&&!biffdata.loadingLastEditDefaultValue,processLastEditDefaultValue(b,g)));g&&a!=g.value&&b&&(g.hasAttribute("ag")||g.hasAttribute("dv")&&!g.attr.dv.startsWith("#"))&&processLastEditDefaultValue(b,g);if(!g||mode!=UPDATE&&mode!=BROWSE)mode===BUILDER&&(this.oldValue=
this.value=a,this.biff&&(this.biff.value=a));else if(g.value=a,b&&!g.hasAttribute("dv")||g.format(!d),this.value=g.value,g&&g.displayValue&&(this.displayValue=g.displayValue),this.oldValue=g.value,a=$("IX"+g.x+"Y"+g.y),!a&&this.changed&&0<=g.nodeId){var k=new MutationObserver(function(a){a.length&&(a=$("IX"+g.x+"Y"+g.y))&&(a.value=g.value);k.disconnect()});k.observe($("nuiform"),{childList:!0})}else a&&!mvpMode&&(a.value=g.value);c&&(checkEmptySubtableRows(g),updateSameSubtableRowBiffsFormulaEngine(g));
mode!==BUILDER&&(this.updateFormulaEngine(b),g.hasAttribute("fmt_d")&&this.updateAutoGenGuessRefSeq(b));return!1};
Typer.prototype.updateFormulaEngine=function(a,b){var c=this.biff;try{var d=getCellNameFromDataCache(c);if(mode!==BUILDER&&c&&d){resetFormulaObject(c);var e=function(){formulaBuilder.update(d,c,b);updateFieldDescriptionFormulas();this.needFormulaRecalc=!1;this.typerFormulaTimeout=null}.bind(this);a&&canSaveData()&&c.value&&c.hasAttribute("dv")&&c.attr.dv.startsWith("#")&&e();a||!this.value&&!this.needFormulaRecalc||(ctrl.callMVP||ctrl.mvpMulti||ctrl.checkEmptySubtableRows||ctrl.submittingNUIForm?
e():(this.typerFormulaTimeout&&clearTimeout(this.typerFormulaTimeout),this.typerFormulaTimeout=setTimeout(e,200)))}}catch(f){processJSExceptionObj(f)}};Typer.prototype.updateAutoGenGuessRefSeq=function(a){var b=this.biff;try{mode!==BUILDER&&b&&(resetAutoGenGuessRefValueMapping(b),a||autoGenGuessRefValueBuilder.update(b))}catch(c){processJSExceptionObj(c)}};
Typer.prototype._setHinSize=function(a,b){b=b.style;var c=$("focus"),d=$("focusDot"),e=$("bbcodeImageEdit"),f=a.offsetWidth||c.offsetWidth,g=a.offsetHeight||c.offsetHeight,k=a.style.fontSize;k=k?parseInt(noUnit(k)):13;var l=findDimV2(nui.main.multiFocus),m=$("nui_outer").offsetLeft,n=l[1],q=l[0],r=ctrl.mainScrollTop>l[3]-140&&ctrl.mainScrollTop<=l[3]-140+n;q=l[2]<m&&l[2]+q>=m;var p=ctrl.mainScrollTop+n>l[3]-140&&l[3]-ctrl.mainScrollTop<=140+n&&l[3]+n-ctrl.mainScrollTop>140+ctrl.nui_outer_height;r&&
p?g-=ctrl.mainScrollTop-(l[3]-140)+(l[3]-ctrl.mainScrollTop+n-(140+ctrl.nui_outer_height))+5:p?(n=l[3]-ctrl.mainScrollTop+n-(140+ctrl.nui_outer_height-5),g-=n):r&&(n=ctrl.mainScrollTop-(l[3]-140),g-=n);q&&(n=m-l[2],f-=n);b.width=f+"px";b.height=g-1+"px";b.fontSize=k+"px";b.lineHeight="150%";c.style.height=g+ctrl.focusHeight+"px";c.style.width=f+ctrl.focusWidth+"px";d.style.top=parseInt(noUnit(c.style.top))+c.clientHeight+"px";d.style.left=parseInt(noUnit(c.style.left))+c.clientWidth+"px";mode===BUILDER&&
a.bbcodeImage&&(e.style.left=parseInt(noUnit(d.style.left))+7+"px",e.style.top=c.style.top)};
Typer.prototype._renderFocus=function(a,b,c){var d=this.biff&&this.biff.hasAttribute("sig"),e=this.biff&&this.biff.hasAttribute("html");if(!this.typing||d||ctrl.focusDotDrag)if(hideEditElements(c),this.value&&"number"!==typeof this.value&&(this.value.includes("http://")||this.value.includes("https://")||this.biff&&this.biff.hasAttribute("url"))){var f=function(b){cancelEventBubble(b);var c={},d;for(d in b)c[d]=b[d];b=new MouseEvent(b.type,c);a.dispatchEvent(b)};$("focus").style.pointerEvents="none";
this.cell.ondblclick=function(a){f(a)};this.cell.oncontextmenu=function(a){f(a)}}else mode==BUILDER?$("focus").style.pointerEvents="none":$("focus").style.pointerEvents=null;else canSaveData()&&e?RTEUIcontroller.showEditor(this):(this._setHinSize(b,c),c.style.top=a.offsetTop+"px",c.style.left=a.offsetLeft+"px",c.style.overflow="auto",c.style.display="",b=this.cell.querySelectorAll(".settingIcon"),this.typingLock?(a.style.pointerEvents="none",b&&b.forEach(function(a){a.style.display="none"}),$("hin").style.zIndex=
40):(a.style.pointerEvents="auto",a.style.zIndex=50,b&&b.forEach(function(a){a.style.display=""})))};
Typer.prototype._renderCell=function(a){var b=this.biff;mode===BUILDER&&a.bbcodeImage&&(a.bbcodeImage=!1,$("bbcodeImageEdit").style.display="none");this.readOnly&&a.classList.add("read-only_cell");if(b)if(mode===BUILDER){var c=RagicBBCodeParser.getImgTagPattern().test(b.value)&&!this.typing;c&&(a.bbcodeImage=!0);builderCellRender(a,cellTextProcessBuilder(b.value,c));c=nui;var d;if(builder.ifAdjacent(b.x,b.y)&&"B"==b.objectType)for(var e=1;e<=ctrl.TABLE_DEF_ROWS;e++){if(d=c._getcell(b.x,b.y+e))rm(d),
setBuilderCellContent(b,a,d,b.IPType,b.x)}else"B"===b.objectType&&(d=c._getcell(b.x+1,b.y))&&(rm(d),setBuilderCellContent(b,a,d,b.IPType,b.x))}else{c=b.displayValue?b.displayValue:b.value;canSaveData()&&(b.updateDisplayValue||""===b.updateDisplayValue)&&(c=b.updateDisplayValue);if(b.attr){var f=this.readOnly;if(b.attr.sig)d=biffdata&&!biffdata.ifListingPage()&&(!b.attr.ro||!canSaveData()),a.innerHTML="",(c=createImageFromUploader(b,b.value))&&a.appendChild(c);else if(1==b.attr.phone&&"false"!=window.userProperties.showTelAsLink)d=
c.replace(/[\(\)\- ]/gim,""),cellRender(a,'<a href="tel:'+d+'" '+getDatasetStyle(a)+'onmousedown="if(mode==BROWSE && !ifRightClick(event)){event.cancelBubble=true;}">'+c+"</a>");else if(b.attr.addr){d=biffdata&&!biffdata.ifListingPage()&&(!f||!canSaveData());var g=b.attr.map;d&&!$("googleMapJavascriptAPI")&&(e=document.createElement("script"),e.setAttribute("id","googleMapJavascriptAPI"),e.setAttribute("src","https://maps.googleapis.com/maps/api/js?key=AIzaSyDhakTAA8w9Rnl3pSsoK8xFVLOD5BbXRY4&libraries=places&language="+
lang),e.setAttribute("type","text/javascript"),e.setAttribute("async",""),e.setAttribute("defer",""),document.head.appendChild(e));var k=encodeURIComponent(mapHelper.convertCoordinateToDecimalDegree(c)).replaceAll("'","%27"),l="//maps.google.com/maps?q="+k,m="mapSelector.open(decodeURIComponent('"+k+"'), addressPickerClick)";e=b.attr.iwidth?b.attr.iwidth:"300";var n=b.attr.iheight?b.attr.iheight:"200",q=b.attr.zoom?b.attr.zoom:null;g&&c?(k="https://maps.googleapis.com/maps/api/staticmap?center="+
k+"&markers="+k+"&size="+(e+"x"+n)+"&maptype=roadmap&key=AIzaSyDhakTAA8w9Rnl3pSsoK8xFVLOD5BbXRY4&language="+lang+(q?"&zoom="+q:""),cellRender(a,'<img title="'+c.replaceAll("'","&apos;").replaceAll('"',"&quot;")+'" style="" src="'+k+'" onmousedown="if(mode==BROWSE && !ifRightClick(event)){event.cancelBubble=true;window.open(\''+l+"')}\"></img>"+(d?'<i class="fas fa-map-marker-alt fa-fw faicon" onmouseover="event.cancelBubble=true;" onmouseout="event.cancelBubble=true;" onmousedown="'+(f?"":m)+'" ontouchstart="'+
(f?"":m)+'"></i>':""))):cellRender(a,'<a href="'+l+'" '+getDatasetStyle(a)+'onmousedown="if(mode==BROWSE && !ifRightClick(event)){event.cancelBubble=true;}" target="_blank" rel="noopener noreferrer nofollow">'+c+"</a>"+(d?'<i class="fas fa-map-marker-alt fa-fw faicon" onmouseover="event.cancelBubble=true;" onmouseout="event.cancelBubble=true;" onmousedown="'+(f?"":m)+'" ontouchstart="'+(f?"":m)+'"></i>':""));wrapRelativeDiv(a);if(g&&c&&100<e){c=!1;for(f=0;f<biffdata.biffs.length;f++)if(d=biffdata.biffs[f],
d.y==b.y&&d.x>b.x){c=!0;break}c||(a.style.overflow="visible",a.childNodes[0].style.overflow="visible",a.childNodes[0].style.width=e+"px")}}else if(b.attr.barcode){d=b.attr.bc_type?b.attr.bc_type:"QR Code";e=b.attr.bc_height?"height:"+b.attr.bc_height+";":"";f=b.attr.bc_append_text?b.attr.bc_append_text:!0;g=b.attr.styleVcolor?b.attr.styleVcolor:"";b.attr.bc_action&&(f=!1);c+="";if(c.startsWith("http://")||c.startsWith("https://"))c=encodeURIComponent(c);"TPCD"==d?cellRender(a,'<img style="max-height:200px;'+
e+'" src="/sims/barcode.jsp?source=web1&bc_type=QR Code&content='+encodeURIComponent(JSON.stringify({content:"default"+path+"/"+sheetIndex+"/"+biffdata.rootNodeId,callback:"https://myform.gov.taipei/api/custom/tpcd.jsp"}))+'&ifAppendText=false" />'):0<c.length?cellRender(a,'<img style="max-height:200px;'+e+'" src="/sims/barcode.jsp?source=web1&bc_type='+d+"&content="+c.replace(/<br\/>/g,"%0A")+"&ifAppendText="+f+"&color="+encodeURIComponent(g)+'" />'):cellRender(a,cellTextProcess(c,mvpMode))}else if(b.attr.url){var r=
c;if(!r){a.innerHTML="";return}d="_blank";if(-1===r.indexOf("://"))if(r.startsWith("mailto:"))d="_self";else if(r.startsWith("javascript:"))r="#";else{e=r.indexOf(":");var p=r.search(/^.+:(?=0$|0\/|[1-9][0-9]*$|[1-9][0-9]*\/)/);["skype","callto","sms","tel"].some(function(a){return r.startsWith(a)?(p=-1,!0):!1});if(-1===e||-1!==p&&e===p)r="http://"+r}"#"===r?cellRender(a,'<a href="#" '+getDatasetStyle(a)+" >"+c+"</a>"):cellRender(a,'<a href="javascript:void(0);" '+getDatasetStyle(a)+" onmousedown=\"if(mode==BROWSE && !ifRightClick(event)){event.cancelBubble=true;window.open('"+
r+"', '"+d+'\');}" rel="noopener noreferrer nofollow">'+c+"</a>")}else if(b.attr.fmt_d)d=biffdata&&!biffdata.ifListingPage()&&(!f||!canSaveData()),e="",b.attr.repeat?(e=new Date(b.value),isNaN(e)||(c=formatRepeatDate(e,b.attr.repeat)),e="fas fa-calendar-check fa-fw faicon"):e=b.attr.clockin?"fas fa-user-clock fa-fw faicon":ifTimeOnly(b.attr.fmt_d)?"far fa-clock fa-fw faicon":"fas fa-calendar-alt fa-fw faicon",cellRender(a,cellTextProcess(c+(d?'<i class="'+e+'" onmouseover="event.cancelBubble=true;" onmouseout="event.cancelBubble=true;" onmousedown="typerClickIconForDatePicker(this.parentNode.parentNode);" ontouchstart="typerClickIconForDatePicker(this.parentNode.parentNode);"></i>':
""),mvpMode)),wrapRelativeDiv(a);else if(b.attr.html)d=biffdata&&!biffdata.ifListingPage()&&(!f||!canSaveData())&&!b.attr.hideEditIcon,cellRender(a,cellTextProcess(c+(d?'<i class="fa fa-pencil faicon" onmouseover="event.cancelBubble=true;" onmouseout="event.cancelBubble=true;" onmousedown="RTEUIcontroller.showEditor(this.parentElement.ip);" ontouchstart="RTEUIcontroller.showEditor(this.parentElement.ip);"></i>':""),!0));else if(1==b.attr.masked||"true"==b.attr.masked){d=biffdata&&!canSaveData();e=
!1;if(d&&b.attr.masked_viewableGroups)for(g=JSON.parse(decodeURIComponent(b.attr.masked_viewableGroups)),f=0;f<g.length;f++)for(l=g[f],m=0;m<groupNodeIds.length;m++)if(equalIgnoreCase(l,groupNodeIds[m])){e=!0;break}cellRender(a,cellTextProcess(c+(d&&e?'<i class="fa fa-eye fa-fw faicon" style="z-index:99;" onmouseover="event.cancelBubble=true;" onmouseout="event.cancelBubble=true;" onmousedown="displayMaskFieldValue(event, this.parentNode.parentNode, '+b.x+", "+b.y+',false);" ontouchstart="displayMaskFieldValue(event, this.parentNode.parentNode, '+
b.x+", "+b.y+',false);"></i>':""),mvpMode));wrapRelativeDiv(a)}else if(b.hasAttribute("fmt_n")&&b.attr.fmt_n.includes("%")&&b.hasAttribute("show_percentBar")&&b.hasAttribute("percentBar")){e=b.y;e=nui.heightObj[e]||0===nui.heightObj[e]?nui.heightObj[e]+ctrl.defaultRowHeight:ctrl.defaultColumnHeightDelta+ctrl.defaultRowHeight;try{d=(new PercentageProgressBar(b.attr.percentBar)).outputBarHTML(b,e,c)||c}catch(t){d=c}cellRender(a,cellTextProcess(d),mvpMode);a.style.padding=0!=b.value?"0":""}else cellRender(a,
cellTextProcess(c,mvpMode))}else cellRender(a,cellTextProcess(c,mvpMode));b.attr&&b.attr.nowrap&&(a.style.whiteSpace="nowrap")}};function getDatasetStyle(a){var b="",c;for(c in a.dataset)"x"!=c&&"y"!=c&&(b="fontFamily"===c?b+("font-family:"+a.dataset[c]+";"):"fontSize"===c?b+("font-size:"+a.dataset[c]+"px;"):b+(c+":"+a.dataset[c]+";"));return""===b?b:' style="'+b+'" '}
Typer.prototype.render=function(){var a=nui.focus,b=this;if(mode===BUILDER||!b.biff||!b.biff.hasAttribute("hide")){var c=mode!==BUILDER?biffdata:builder;if(!b.biff||c.ifRenderRow(b.biff.y))if(b.biff&&b.biff.actionButton){b.cell.innerHTML="";a=b.biff.actionButton;c=b.biff.actionButtonId+"_"+b.biff.parentNodeId;var d=initButtonNode(c,a);if(mode!==BUILDER){if(!checkButtonShow(a,!0))return;biffdata.ifListingPage()&&biffdata.buttons.push(new Button(c,a.type,a.buttonSeq,a.name||"No name",a.action,a.confirmBeforeAction,
a.needApproval,a.userGroups,a.hideButton,a.checkIfUserCanEdit));setButtonAction(d,b.biff.parentNodeId)}b.cell.appendChild(d)}else if(b._renderCell(b.cell),b.focused&&b._renderFocus(a,b.cell,$("hin")),mode===BROWSE&&b.biff&&(+b.biff.parentDomainId!==+biffdata.rootDomainId||biffdata.ifSubtableDataBiff(b.biff))&&(c=indexOf(b.biff.parentDomainId,biffdata.subtableKeyFields),0<=c)){var e=biffdata.subtableKeyUrl[c];if(e&&(a=b.cell.childNodes[0])&&(a&&a.style&&"relative"===a.style.position&&(a=a.childNodes[0]),
a)){var f="";1<biffdata.subtableKeyFields.filter(function(a){return a===b.biff.parentDomainId}).length&&(d=b.biff.getSubtable())&&(f=d.fpUrl);f||(f=biffdata.subtableFpUrls[c]);if(b.biff.hasAttribute("link")&&0<=b.biff.parentNodeId){if(b.biff.attr.linkTo){var g=b.biff.attr.linkTo;c=g.split("/");4===c.length?g="/"+ap+"/"+c[2]+"/"+c[3]:3===c.length&&(g="/"+ap+g);a.onmousedown=function(a){open(g+"/"+b.biff.parentNodeId,"_blank")}}else a.onmousedown=function(a){open("/"+e+"/"+b.biff.parentNodeId,"_blank")};
a.className="fakeLink"}else a.onclick=function(a){showFpClick(f?ap+f:e,b.biff.parentNodeId)};"false"===window.userProperties.subtableHoverShowFp||biffdata.changed&&biffdata.autoSave||(a.onmouseover=function(a){showFp(a,f?ap+f:e,b.biff.parentNodeId)},a.onmouseout=function(a){resetShowFp(a)})}}}};Typer.prototype.clear=function(){$("hin").setValue("");this.needFormulaRecalc=!0;this.loadValue("");mode==BUILDER&&delete this.biff};
Typer.prototype.setReadonly=function(a){this.readOnly=a;this.cell.classList.toggle("read-only_cell",a);this.render();a&&biffdata&&(a=biffdata.updateCellIds.indexOf(this.cell.id),0<=a&&biffdata.updateCellIds.splice(a,1))};
function formulaReplaceHelper(a,b){if(mode!==BROWSE&&ctrl.formulaResultCache[b])return ctrl.formulaResultCache[b];b=b.replace(/&#44;/gm,",").replace(/&#60;/gm,"<").replace(/&#62;/gm,">");a=resolveFormula(b,null,formulaMode.STRING)+"";var c=""===a||" "===a;if(isNumeric(a)||c){var d=Number(resolveFormula(b,null));return(0===d||isNaN(d))&&c||0===d&&isNumeric(a)?ctrl.formulaResultCache[b]=a:ctrl.formulaResultCache[b]=d}return ctrl.formulaResultCache[b]=a}
function cellTextProcessBuilder(a,b){if(!a||!isNaN(a))return a;a=a.toString().replace(/</gim,"&lt;").replace(/>/gim,"&gt;");var c=/\r\n/gim;a=a.replace(c,"<br/>");c=/\n/gim;a=a.replace(c,"<br/>");c=/[ ]{2}/gim;a=a.replace(c,"&nbsp; ");c=/[\t]/gim;a=a.replace(c,"&nbsp;&nbsp;&nbsp; ");b&&(a=RagicBBCodeParser.processToHTML(a));return a}
function cellTextProcess(a,b){if(!a||!isNaN(a))return a;a=a.toString();var c=/\r\n/gim;a=a.replace(c,"<br/>");c=/\n/gim;a=a.replace(c,"<br/>");b||(c=/(^|[^=\[\]"'])((?:https?):(?:\/{1,3}|\\{1})[-a-zA-Z0-9:;,@#!%&()~_?\+=\/\\\.]*[-a-zA-Z0-9+&@#/%=~_|])/gim,a=a.replace(c,"$1<a href='javascript:void(0);' onmousedown=\"if(mode === BROWSE && !ifRightClick(event)) {window.open('$2');cancelEventBubble(event);}\">$2</a>"));a.includes("[/formula]")&&(c=/\[formula\][\s]*(.+?)\[\/formula\]/gim,a=displayValueProcess(a.replace(c,
formulaReplaceHelper)));c=/[ ]{2}/gim;a=a.replace(c,"&nbsp; ");c=/[\t]/gim;a=a.replace(c,"&nbsp;&nbsp;&nbsp; ");a=RagicBBCodeParser.processToHTML(a);b||(c=/\[\[([^\[]+)\]\]/gim,a=a.replace(c,function(a,b){return b.startsWith("@")?(loadUserNames(),b=b.substring(1),userNameEmail[b]?'<a href="mention://'+b.replace(/"/g,"&quot;")+'" onmousedown=\'window.open("/'+ap+"/search?direct&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheetIndex)+"&q="+encodeURIComponent(b).replace(/'/g,"&apos;")+
"\");' target=_blank>@"+b+"</a>":a):'<a href="RagicSearch://'+b.replace(/"/g,"&quot;")+'" onmousedown=\'window.open("/'+ap+"/search?direct&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheetIndex)+"&q="+encodeURIComponent(b).replace(/'/g,"&apos;")+"\");' target=_blank>"+b+"</a>"}));b||/<[a-z][\s\S]*>/i.test(a)||"false"==window.userProperties.showEmailAsLink||(c=/([A-Za-z0-9."'_%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,})+(\\?[^\s><^,^;^.]+)?/gim,a=a.replace(c,function(a,b,c){return'<a href="mailto:'+
b.replace(/"/gm,"&quot;")+'" onmousedown="cancelEventBubble(event);">'+b+"</a>"+(c||"")}));return a}function processComments(){for(var a=1,b;b=$("commentText"+a++);)b.innerHTML=commentTextProcess(b.innerHTML)}function commentTextProcess(a){return a=a.replace(/\[\[([^\[]+)\]\]/gim,"<a href='/"+ap+"/search?direct&a="+ap+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheetIndex)+"&q=$1' target=_blank>$1</a>")}
function fieldHeaderEncode(a){return a&&isNaN(a)?a=a.replace(/,/gim,"&#44;").replace(/\n/gim,"<br>"):a}function fieldHeaderDecode(a){return a&&isNaN(a)?a=a.replace(/&#44;/gim,",").replace(/<br\s*(\/)?>/gim,"\n"):a}function displayValueProcess(a){if(!a||!isNaN(a))return a;"object"===typeof a&&(a=a.toString());a=a.replace(/</gim,"&#60;");a=a.replace(/>/gim,"&#62;");return a=a.replace(/\n/gim,"<br/>")}
function loadTextProcess(a){if(!a||!isNaN(a))return a;a=a.replace(/<br\s*(\/)?>/gim,"\n");a=a.replace(/&#60;/gim,"<");a=a.replace(/&#62;/gim,">");return a=a.replace(/&#44;/gim,",")}function hideEditElements(a){a||(a=$("hin"));a=a.style;ctrl.hinShowMode=!1;ctrl.hinShowMode?(a.top="100px",a.left="100px",a.height="100px"):(a.top="100px",a.left="-10000px",a.height="20px",a.width="5000px")}
function typerClickForDatePicker(){if(mode!==BROWSE||checkIfUserCanEdit()){var a=this.cell;if(mode!=BUILDER&&!(!a||a.picker&&a.picker.div&&"none"!=a.picker.div.style.display||a.ip&&a.ip.readOnly||1<ctrl.multiSelected.length)){var b=new DatePicker(a);a.ip&&a.ip.biff&&a.ip.biff.hasAtLeastOneAttribute("ro","hide")||(a.picker=b,a.ip&&a.ip.biff&&a.ip.biff.hasAttribute("clockin")?b.showClockIn():b.showMonth())}}}
function typerClickIconForDatePicker(a){if(!(mode===BROWSE&&!checkIfUserCanEdit()||!a.ip||a.ip&&a.ip.readOnly)){var b=new DatePicker(a);a.picker=b;a.ip&&a.ip.biff&&a.ip.biff.hasAttribute("clockin")?b.showClockIn():b.showMonth()}}
function datePickerClick(a,b,c,d){mode!==UPDATE&&(ctrl.datePickerCloseTimer&&clearTimeout(ctrl.datePickerCloseTimer),b=b?new DatePicker(a,b):new DatePicker(a),window.webForm&&"true"===findFieldJSON(a.name).attributes.clockin?b.showClockIn():(b.showMonth(),b.dateFormat.includes("H")&&(b=document.querySelector(".timeSel"),(a.ip?a.ip.value:a.value)||(!0===c?b.options[0].selected="true":!0===d&&(b.options[b.options.length-1].selected="true")))),ctrl.datePickerInput=a)}
function DatePicker(a,b){if(nui&&nui.main&&nui.main.contains(a))for(;!a.id;)a=a.parentNode;this.cell=a;this.dateFormat=b||"yyyy/MM/dd";this.minYear=1873;a&&a.ip&&a.ip.biff&&a.ip.biff.hasAttribute("fmt_d")&&(this.dateFormat=a.ip.biff.attr.fmt_d);b=a.ip?a.ip.value:a.value;var c=getDateFromFormat(b,this.dateFormat);isNaN(c)&&(c=getDateFromFormat(b,getStandardFormat(this.dateFormat)));(b=isNaN(c)?smartParseDate(b,this.dateFormat):new Date(c))?this.cellDate=this.myDate=b:this.myDate=new Date;this.hasTime=
this.dateFormat.includes("h")||this.dateFormat.includes("H")||this.dateFormat.includes("m");this.hasDate=this.dateFormat.includes("y")||this.dateFormat.includes("M")||this.dateFormat.includes("d")||this.dateFormat.includes("E");a&&a.ip&&a.ip.biff&&a.ip.biff.attr.repeat&&(this.repeatType=a.ip.biff.attr.repeat)}DatePicker.prototype.addMonth=function(a){this.setMonth(this.myDate.getMonth()+a)};
DatePicker.prototype.setMonth=function(a){document.body.removeChild(this.div);this.myDate=new Date(this.myDate.getFullYear(),a,1);this.showMonth()};DatePicker.prototype.setYear=function(a){document.body.removeChild(this.div);this.myDate=new Date(a,this.myDate.getMonth(),this.myDate.getDate());this.showMonth()};
DatePicker.prototype.showClockIn=function(){var a=this,b=document.querySelector(".datePickerRagic");b&&document.body.removeChild(b);var c=node("div");c.className="datePickerRagic";b=a.cell.ip&&a.cell.ip.biff&&a.cell.ip.biff.hasAttribute("clockin_t")?a.cell.ip.biff.attr.clockin_t:lm.clockin;c.innerHTML='<div class="clockin"><i class="fas fa-user-clock"></i> '+encHTML(b)+"</div>";var d=node("div");d.className="clockinButton";getPromise("/api/http/getServerCurrentTime.jsp").then(function(b){d.innerHTML=
formatDate(new Date(parseInt(b)),a.dateFormat);d.setAttribute("value",d.innerHTML);d.picker=a;d.onclick=datePickerDateClick;c.appendChild(d);c.style.minWidth=a.cell.offsetWidth;a.placeDiv(c)});return c};
DatePicker.prototype.showMonth=function(){var a=this.myDate.getFullYear(),b=this.myDate.getMonth();a<this.minYear&&(a=this.minYear,b=0);a=new Date(a,b,1);var c=a.getDay(),d=new Date(a.getTime());d.setDate(a.getDate()-(c+7-firstDayOfAWeek)%7);a=d;d=formatDate(a,"yyyy/MM/dd");c=node("div");c.className="datePickerRagic";var e=document.querySelector(".datePickerRagic");e&&document.body.removeChild(e);if(this.hasTime){e=node("div");e.className="timeDiv";var f=node("select");f.className="timeSel";f.size=
10;this.timeSel=f;f.onclick=function(){ctrl.dropWin=!0};f.onchange=datePickerTimeChange;var g=/[h]{1,2}/i.exec(this.dateFormat),k=/[m]{1,2}/.exec(this.dateFormat);g=g?g[0]:"HH";k=k?k[0]:"mm";for(var l=g.includes("h"),m=this.cellDate?formatDate(this.cellDate,"HH:mm"):"",n=0;24>n;n++){var q=12>n?"am":"pm",r=n;l&&12<n&&(r-=12);1<g.length&&10>r&&(r="0"+r);var p=(10>n?"0":"")+n,t=p+":00";t=new Option(r+":"+(1<k.length?"00":"0")+(l?q:""),t,!1,t===m);t.picker=this;f.appendChild(t);p+=":30";q=new Option(r+
":30"+(l?q:""),p,!1,p===m);q.picker=this;f.appendChild(q)}e.appendChild(f);c.appendChild(e)}this.repeatType==REPEAT_DATE_TYPE_WEEKLY&&_createDatePickerRepeatWeekSelect(this,c);this.repeatType==REPEAT_DATE_TYPE_MONTHLY&&_createDatePickerRepeatMonthSelect(this,c);if(this.hasDate&&this.repeatType!=REPEAT_DATE_TYPE_WEEKLY&&this.repeatType!=REPEAT_DATE_TYPE_MONTHLY){f=node("div");f.className="dateTableContainer";c.appendChild(f);e=node("table");e.style.margin="10px 10px 0 0";e.className="ymheaderTable";
var v=e.insertRow(-1);g=node("span");g.textContent="<";k=getMonthSel(this.myDate.getMonth());k.picker=this;k.onchange=function(){this.picker.setMonth(this.options[this.selectedIndex].value)};k.onclick=function(){ctrl.dropWin=!0};l=node("span");l.textContent=">";m=getYearSel(this.myDate.getFullYear(),this.minYear);m.picker=this;m.onchange=function(){this.picker.setYear(this.options[this.selectedIndex].value)};m.onclick=function(){ctrl.dropWin=!0};var u=v.insertCell(-1);u.appendChild(g);u.picker=this;
u.onclick=function(){this.picker.addMonth(-1)};u=v.insertCell(-1);u.appendChild(k);u=v.insertCell(-1);u.appendChild(l);u.picker=this;u.onclick=function(){this.picker.addMonth(1)};u=v.insertCell(-1);u.appendChild(m);f.appendChild(e);e=node("table");e.className="calTable";f.appendChild(e);f=lm.DAY_NAMES.slice(7);if(7!==firstDayOfAWeek)for(g=0;g<firstDayOfAWeek;g++){l=f[0];for(k=0;k<f.length;k++)0!==k&&(f[k-1]=f[k]);f[k-1]=l}v=e.insertRow(-1);f.forEach(function(a){u=v.insertCell(-1);u.innerHTML=a});
for(g=f=0;6>f;){for(v=e.insertRow(-1);7>g;)u=v.insertCell(-1),a.getFullYear()>=this.minYear&&(u.innerHTML=a.getDate(),u.setAttribute("value",d),u.picker=this,u.onclick=datePickerDateClick,a.getMonth()!==b&&(u.className="notThisMonth"),d===formatDate(new Date,"yyyy/MM/dd")&&(u.style.border="1px solid #cccccc"),this.cellDate&&d===formatDate(this.cellDate,"yyyy/MM/dd")&&(u.style.backgroundColor="#555555")),d=new Date(a.getTime()),d.setDate(a.getDate()+1),a=d,d=formatDate(a,"yyyy/MM/dd"),g++;f++;g=0}}this.placeDiv(c);
return c};
DatePicker.prototype.placeDiv=function(a){var b=this.cell,c=b.getBoundingClientRect(),d=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop,e=document.documentElement&&document.documentElement.clientHeight||document.body.clientHeight,f=document.documentElement&&document.documentElement.clientWidth||document.body.clientWidth;clearDropWin();this.div=a;document.body.appendChild(a);if(0!==c.top||0!==c.right||0!==c.bottom||0!==c.left)nui&&nui.main?(a.style.top=c.top+a.clientHeight-
d>e?c.top-a.clientHeight+"px":c.top+b.clientHeight+2+"px",c.left+a.clientWidth>f?a.style.right="0":a.style.left=c.left+"px"):(a.style.top=e-c.bottom>a.clientHeight?c.top+b.clientHeight+d+5+"px":c.top-a.clientHeight+d-2+"px",a.style.left=c.left+"px");floatingPanels.push(a);ctrl.dropWin=!0};
function _createDatePickerRepeatWeekSelect(a,b){var c=node("div");c.className="timeDiv";var d=node("select");d.className="timeSel";d.size=7;d.onclick=function(){ctrl.dropWin=!0};d.onclick=datePickerRepeatDateClick;var e=a.myDate.getDay(),f=new Date;f.setDate(a.myDate.getDate()-e);for(a=0;7>a;a++){e=new Date;e.setDate(f.getDate()+a);var g=formatDate(e,"yyyy/MM/dd"),k=node("option");k.innerHTML=formatRepeatDate(e,REPEAT_DATE_TYPE_WEEKLY);k.value=g;d.appendChild(k)}c.appendChild(d);b.appendChild(c)}
function _createDatePickerRepeatMonthSelect(a,b){a=node("div");a.className="timeDiv";var c=node("select");c.className="timeSel";c.size=7;c.onclick=function(){ctrl.dropWin=!0};c.onclick=datePickerRepeatDateClick;for(var d=1;31>=d;d++){var e=new Date;e.setMonth(0);e.setDate(d);var f=formatDate(e,"yyyy/MM/dd"),g=node("option");g.innerHTML=formatRepeatDate(e,REPEAT_DATE_TYPE_MONTHLY);g.value=f;c.appendChild(g)}a.appendChild(c);b.appendChild(a)}
function simpleFormatDate(a){return a?a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate():""}
function datePickerTimeChange(){var a=this.options,b=a[this.selectedIndex].value;a=a[this.selectedIndex].picker;var c=formatDate(a.cellDate?a.cellDate:new Date,"yyyy/MM/dd");b=a.hasDate?c+" "+b+":00":b+":00";nui&&nui._curcell()&&nui._curcell().ip&&mode!==BUILDER&&a.cell.className&&0<=a.cell.className.indexOf("nuiCell")?(canSaveData()||ctrl.outOfNUI||modeUpdate(),$("hin").setValue(b),a=nui._curcell().ip,subTableExtendProcess(b,a.biff),a.loadValue(b),a.render()):(ctrl.datePickerInput.value=b,b=document.createEvent("Event"),
a=document.createEvent("Event"),b.initEvent("change",!0,!1),a.initEvent("paste",!0,!1),ctrl.datePickerInput.dispatchEvent(b),ctrl.datePickerInput.dispatchEvent(a));clearDropWin()}
function datePickerRepeatDateClick(){if(nui&&nui._curcell()&&nui._curcell().ip&&mode!==BUILDER){var a=this.options[this.selectedIndex].value+" 00:00:00";mode!=BROWSE||ctrl.outOfNUI||modeUpdate();$("hin").setValue(a);var b=nui._curcell().ip;subTableExtendProcess(a,b.biff);b.loadValue(a);b.render()}else ctrl.datePickerInput.value=fullString,a=document.createEvent("Event"),b=document.createEvent("Event"),a.initEvent("change",!0,!1),b.initEvent("paste",!0,!1),ctrl.datePickerInput.dispatchEvent(a),ctrl.datePickerInput.dispatchEvent(b);
clearDropWin()}
function datePickerDateClick(){var a=this.getAttribute("value"),b=a;if(this.picker.hasTime&&this.picker.timeSel){b=this.picker.timeSel;var c=this.picker.cellDate?formatDate(this.picker.cellDate,"HH:mm:ss"):"00:00:00";if(-1===b.selectedIndex)if("00:00:00"!==c)b=a+" "+c;else{this.picker.cellDate=parseDate(a);ctrl.dropWin=!0;this.picker.showMonth();return}else c=b.options[b.selectedIndex].value,b=a+" "+c+":00"}nui&&nui._curcell()&&nui._curcell().ip&&mode!==BUILDER&&this.picker.cell.className&&0<=this.picker.cell.className.indexOf("nuiCell")?
(mode==BROWSE&&modeUpdate(),$("hin").setValue(b),a=nui._curcell().ip,subTableExtendProcess(b,a.biff),a.loadValue(b),a.render()):(ctrl.datePickerInput.value=b,a=document.createEvent("Event"),b=document.createEvent("Event"),a.initEvent("change",!0,!1),b.initEvent("paste",!0,!1),ctrl.datePickerInput.dispatchEvent(a),ctrl.datePickerInput.dispatchEvent(b));clearDropWin()}
function addressPickerClick(a){mode==BROWSE&&modeUpdate();$("hin").setValue(a);var b=nui._curcell().ip;subTableExtendProcess(a,b.biff);b.loadValue(a);b.render()}function getYearSel(a,b){var c=(new Date).getFullYear()-b,d=node("select");for(c=50+c;0<=c;){var e=node("option");e.innerHTML=b;e.value=b;b==a&&(e.selected=!0);b++;d.appendChild(e);c--}return d}
function getMonthSel(a){var b=node("select");var c=node("option");c.value=0;c.innerHTML="1 - January";b.appendChild(c);c=node("option");c.value=1;c.innerHTML="2 - February";b.appendChild(c);c=node("option");c.value=2;c.innerHTML="3 - March";b.appendChild(c);c=node("option");c.value=3;c.innerHTML="4 - April";b.appendChild(c);c=node("option");c.value=4;c.innerHTML="5 - May";b.appendChild(c);c=node("option");c.value=5;c.innerHTML="6 - June";b.appendChild(c);c=node("option");c.value=6;c.innerHTML="7 - July";
b.appendChild(c);c=node("option");c.value=7;c.innerHTML="8 - August";b.appendChild(c);c=node("option");c.value=8;c.innerHTML="9 - September";b.appendChild(c);c=node("option");c.value=9;c.innerHTML="10 - October";b.appendChild(c);c=node("option");c.value=10;c.innerHTML="11 - November";b.appendChild(c);c=node("option");c.value=11;c.innerHTML="12 - December";b.appendChild(c);for(var d=0;d<b.options.length;d++)c=b.options[d],parseInt(c.value)==a&&(c.selected=!0);return b}
function displayMaskFieldValue(a,b,c,d,e){a&&cancelEventBubble(a);if(b){var f=function(){if(b.ip&&b.ip.biff)var a=b.ip.biff;else for(var e=0;e<biffdata.biffs.length;e++)if(biffdata.biffs[e].x==c&&biffdata.biffs[e].y==d){a=biffdata.biffs[e];break}return a}();if(f){a=!biffdata.ifListingPage()&&biffdata.ifSubtableBiff(f);var g={ap:ap,path:path,sheetIndex:sheetIndex,domainId:f.domainId,rootNodeId:biffdata.ifListingPage()?f.parentNodeId:biffdata.rootNodeId,ifMasked:!!e};a&&(g.subtableRootNodeId=f.parentNodeId);
postPromise("/sims/getMaskedFieldValue.jsp",g).then(function(a){var c=e?"fa fa-eye fa-fw fa-fw faicon":"fa fa-eye-slash fa-fw faicon";a=a.trim();cellRender(b,cellTextProcess(a+'<i class="'+c+'" style="z-index:99;" onmouseover="event.cancelBubble=true;" onmouseout="event.cancelBubble=true;" onmousedown="displayMaskFieldValue(event, this.parentNode.parentNode, '+f.x+", "+f.y+", "+!e+');" ontouchstart="displayMaskFieldValue(event, this.parentNode.parentNode, '+f.x+", "+f.y+", "+!e+');"></i>',!1));wrapRelativeDiv(b);
$("hin").value=a;f.value=a;f.unmasked=!e})}}}function validateEmailTyper(a,b){a&&0!=a.length&&ajaxget("/sims/emailValidator.jsp",{email:a},function(a){a?(floatWinWarning(getBundleString("emailFormatIncorrect_validate_all",[biffdata.findHeader(b.domainId).value,b.value])),b.cell.style.backgroundColor="#FFCCCC"):b.cell.style.backgroundColor=b.biff.attr.styleVbackgroundColor?b.biff.attr.styleVbackgroundColor:""},!1)}
function validateEmail(a,b){if(!a||0==a.length)return!0;ctrl.temp="valid";ajaxget("/sims/emailValidator.jsp",{email:a},function(a){a?(ifValidateChangeBG()&&(b.cell.style.backgroundColor="#FFCCCC"),ctrl.temp="invalid"):b.cell.style.backgroundColor=b.biff.attr.styleVbackgroundColor?b.biff.attr.styleVbackgroundColor:""},!0);return"invalid"!=ctrl.temp}
HTMLTextAreaElement.prototype.insertAtCaret=function(a){a=a||"";if(document.selection)this.focus(),document.selection.createRange().text=a;else if(this.selectionStart||0===this.selectionStart){var b=this.selectionStart,c=this.selectionEnd;this.value=this.value.substring(0,b)+a+this.value.substring(c,this.value.length);this.selectionStart=b+a.length;this.selectionEnd=b+a.length}else this.value+=a};
function hinInit(){$("hin")&&($("hin").getValue=function(){return this.value},$("hin").setValue=function(a){this.value=a})}hinInit();
function showSignBox(a){canSaveData()||biffdata.autoSave||modeUpdate();floatWin(null,'<div class="signatureBlock"><canvas id="sigcanvas" width="500" height="250" style="background:#f8f8f8;border:1px solid #ccc;border-radius:5px;float:left;clear:left;margin:0 0 8px 0;"></canvas><div class="clearSignatureIcon" onclick="clearSig();"><i class="fas fa-redo-alt"></i></div></div><div id="sigBackgroundDiv"></div><div class="topButtonWhole" style="padding-left:25px;padding-right:25px;float:left;clear:left;margin:0 8px 0 0;" onclick="saveSig();"onmouseover="buttover(this);" onmouseout="buttout(this);" onmousedown="this.style.backgroundPosition=\'0 21px\';" onmouseup="this.style.backgroundPosition=\'0 0\';">'+lm.save+
"</div>","",!0);var b=$("sigcanvas");loadSigScript(b);ctrl.isIE&&ctrl.isObsoleteIE||setSignatureBackgroundBox($("sigBackgroundDiv"));a&&(a=a.split("_"),nui._focus(a[1],a[2]));ctrl.focusLock=!0}
function loadSigScript(a,b){if(window.SignaturePad)ctrl.signaturePad=new SignaturePad(a),b&&ctrl.signaturePad.fromDataURL(b);else{var c=document.createElement("script");c.src="/sims/js/signature.js";c.onload=function(){ctrl.signaturePad=new SignaturePad(a);b&&ctrl.signaturePad.fromDataURL(b)};document.head.appendChild(c)}}
function setSignatureBackgroundBox(a,b){rm(a);a.style.clear="both";a.style.marginBottom="10px";b||(b=node("span"),b.appendChild(document.createTextNode(lm.signatureSetBackground)),a.appendChild(b),b=node("i"),b.className="fa fa-upload",b.style.marginLeft="15px",b.style.cursor="pointer",b.addEventListener("click",function(){var a=node("form"),b=node("input");a.appendChild(b);b.type="file";b.onchange=function(){readBlobAsDataURL(this.files[0]).then(setSignatureBackground)};b.click()}),a.appendChild(b),
b=node("i"),b.className="fa fa-link",b.style.marginLeft="15px",b.style.cursor="pointer",b.addEventListener("click",function(){nativePromptPromise("Please type the image url").then(function(a){if(!a||!a.includes("."))throw Error("No URL");a.startsWith("http")||(a="https://"+a);return fetch(a)}).then(function(a){return a.blob()}).then(readBlobAsDataURL).then(setSignatureBackground).catch(emptyFunction)}),a.appendChild(b),b=node("a"),b.textContent=lm.loadSigFromPersonalSetting,b.href="javascript:void(0);",
b.style.cssFloat="none",b.style.marginTop="10px",b.style.display="block",b.addEventListener("click",function(){getPromise("/sims/reg/getSignature.jsp",{a:ap}).then(function(a){a&&setSignatureBackground(a)})}),a.appendChild(b))}
function saveSig(){ctrl.focusLock=!1;var a="";if(!ctrl.signaturePad.isEmpty()||void 0!=ctrl.signaturePad._isBackGroundEmpty&&!ctrl.signaturePad._isBackGroundEmpty)a=ctrl.signaturePad.toDataURL();var b=nui._curcell().ip;$("hin").setValue(a);b.typing=!1;b.loadValue(a);b.render();biffdata.autoSave&&autoSaveInterval(300);floatWinClose();setTimeout(nui._updateFocus.bind(nui),100)}function clearSig(){ctrl.signaturePad.clear();ctrl.signaturePad._isBackGroundEmpty=!0}
function setSignatureBackground(a){if(ctrl.signaturePad){var b=new Image(ctrl.signaturePad._canvas.width,ctrl.signaturePad._canvas.height);b.src=a;b.onload=function(){var a=ctrl.signaturePad.toData();ctrl.signaturePad.clear();ctrl.signaturePad._canvas.getContext("2d").drawImage(b,0,0,ctrl.signaturePad._canvas.width,ctrl.signaturePad._canvas.height);ctrl.signaturePad._isBackGroundEmpty=!1;ctrl.signaturePad._fromData(a,function(a,b){return ctrl.signaturePad._drawCurve(a,b.start,b.end)},function(a){return ctrl.signaturePad._drawDot(a)})}}}
var currentBiff;
function setPropertyTable(a){if(a&&a.biff)resetPropertyTable(a);else return rm($("prop")),!1;var b=a.biff;b.attr||(b.attr={});currentBiff=b;if(!$("at_name"))return!1;$("at_name").value=b.value;$("at_spid").value=b.domainId?b.domainId:"";$("f_ag").style.display="none";$("f_dv").style.display="";$("f_summary").style.display="none";$("f_mvpMulti").style.display="none";$("f_mvpTypeM").style.display="none";$("show_dv_f").style.display="none";$("f_ch").style.display="";$("show_dv").setAttribute("toggle","sample_dv");
$("f_image").style.display="none";$("f_em").style.display="none";$("f_phone").style.display="none";$("f_fx").style.display="none";$("f_addr").style.display="none";$("f_url").style.display="none";$("f_barcode").style.display="none";$("f_bc_action").style.display="none";$("f_percentBar").style.display="none";$("f_percentBar_setting").style.visibility="hidden";$("at_it").disabled=!1;$("at_noDup").disabled=!1;$("f_mask").style.display="none";$("f_fmt").style.display="none";$("f_hideEditIcon").style.display=
"none";builder.ifListingPage()?($("f_cs").style.display="none",$("formula__advanced").style.display="none"):($("f_cs").style.display="",$("formula__advanced").style.display="");b&&b.attr&&(b.attr.interm||b.attr.l)&&($("at_it").disabled=!0);b.hasAttribute("interm")&&b.hasAttribute("ro")&&($("at_ro").disabled=!0);a=$("at_use_dv_f");var c=$("at_f");b.hasAttribute("dv_f")?(a.checked=!b.attr.f,c&&(c.disabled=b.attr.dv_f.length,$("at_f_wrapper").addEventListener("click",function(){showSingleTooltip(this,
"formulaIsDvFormula",!1,!0,!1,!0)})),$("show_dv").style.display="none",$("show_dv_f").style.display="inline-block"):(a.checked=!1,c&&(c.disabled=!1));a.disabled=b.hasAttribute("f")&&b.attr.f.length||b.IPType===MSELECTOR;a=!(builder.ifListingPage()||!builder.ifAdjacent(b.x,b.y));isNumeric(b.domainId);a?(b.hasAttribute("noDup")||($("f_nd").style.display="none"),b.attr&&!b.attr.ag?$("f_snd").style.display="":$("f_snd").style.display="none"):$("f_snd").style.display="none";b.hasAttribute("dv_f")&&($("f_dv_f_box").style.display=
"");var d=function(a){for(var b={},c=0;c<a.length;c++)b[a[c].value]=c;return b}($("at_it").options);$("must_help").onclick=function(){showSingleTooltip(this,"HELP_MUST",!1,!0,!1,!0)};if(b.IPType===SELECTOR||b.IPType===MSELECTOR)if($("show_dv").removeAttribute("toggle"),b.hasAttribute("vd")||3==b.domainId?$("f_ch").style.display="none":$("f_ch").style.display="",$("at_f").disabled=b.IPType===MSELECTOR,b.attr.mvp||b.mvp){$("f_dv").style.display="";$("f_ch").style.display="none";$("f_usrref").style.display=
"none";$("f_grpref").style.display="none";$("f_mvp").style.display="";a&&($("f_mvpMulti").style.display="",b.attr.mvpMulti&&($("at_mvpMulti").checked=!0));$("f_mvpTypeM").style.display="";"M"==b.IPType&&($("at_mvpTypeM").checked=!0);$("at_it").selectedIndex=d.MVP;0<b.domainId&&($("at_it").disabled=!0);c=b.attr.mvp;d=b.attr.stf;var e=b.attr.vd;c?(c=c.split("|"),initMVPSelector(c[0],c[1],d,$("f_mvp"),mvpSelChange,!1,!0,e,b.domainId)):(floatWin(null,lm.chooseLinkSheet),d=findPos($("f_mvp")),initMVPSelector(path,
null,null,$("f_mvp"),mvpSelChange,!0,!0,null,null),$("floatingWin").style.top=d[1]+$("f_mvp").clientHeight+"px",$("floatingWin").style.left=d[0]+"px")}else b.attr.checkbox?($("at_it").selectedIndex=d.CHECKBOX,$("f_usrref").style.display="none",$("f_grpref").style.display="none",$("f_mvp").style.display="none",$("f_summary").style.display="none",$("at_noDup").disabled=!0,$("userOptionsDiv").style.display="none",$("must_help").onclick=function(){showSingleTooltip(this,"HELP_CHECKBOX_MUST",!1,!0,!1,
!0)},initChoices(b),displayChoicesAsSymbols(),checkCheckboxOptions()):b.attr.usrref||b.attr.grpref?($("f_usrref").style.display=b.attr.usrref?"":"none",$("f_grpref").style.display=b.attr.grpref?"":"none",$("at_usrref_2").checked=b.IPType===MSELECTOR,$("at_grpref_2").checked=b.IPType===MSELECTOR,$("f_mvp").style.display="none",$("f_summary").style.display="none",$("f_ch").style.display="none",0<b.domainId&&($("at_it").disabled=!0),$("at_it").selectedIndex=b.attr.usrref?d.USER:d.GROUP,b.attr.ifReadInfo&&
($("at_it").selectedIndex=d.REVIEWER),a||($("at_noDup").disabled=!0),builder.ifListingPage()?$("editReviewerEmailTemplate").style.display="none":$("editReviewerEmailTemplate").style.display="",b.attr.usrrefgroup?setSelectByValue($("usrrefgroup"),b.attr.usrrefgroup,!0):setSelectByValue($("usrrefgroup"),"")):($("f_usrref").style.display="none",$("f_grpref").style.display="none",$("f_mvp").style.display="none",$("f_summary").style.display="none",a||($("at_noDup").disabled=!0),$("userOptionsDiv").style.display=
"",b.IPType===SELECTOR?($("at_it").selectedIndex=d.L,$("cascadedSelDiv").style.display=""):b.IPType===MSELECTOR&&($("at_it").selectedIndex=d.M,$("f_ch_adv_setting").style.display=""),initChoices(b));else{b.IPType===UPLOADER?($("at_it").selectedIndex=d.U,$("f_dv").style.display="none",b.hasAttribute("vd")&&($("at_multipleFiles").style.display="none",document.querySelector("label[for='at_multipleFiles']").style.display="none")):b.IPType===GRAPHICS&&($("at_it").selectedIndex=d.G,$("f_dv").style.display=
"none",$("f_image").style.display="",b.attr&&b.attr.fixImageMax&&(b.attr.iwidth&&($("at_iwidth").value=b.attr.iwidth),b.attr.iheight&&($("at_iheight").value=b.attr.iheight)),b.hasAttribute("vd")&&($("at_multipleImages").style.display="none",document.querySelector("label[for='at_multipleImages']").style.display="none"));if(b.attr.ag)e=b.attr.ag,$("f_ag").style.display="",$("at_it").selectedIndex=d.AUTOGEN,$("show_dv").removeAttribute("toggle"),$("f_must").style.display="none",c.disabled=!0,builder.ifAdjacent(b.x,
b.y)?($("subtableRagicIdOption").style.display="",$("agAssign").disabled=!0,$("agAssignHelp").style.display=""):$("subtableRagicIdOption").style.display="none",setAutoGenPropertyTableByFormat(e);else if(b.attr.summary||b.summaryField)$("at_it").selectedIndex=d.SUMMARY,$("f_dv").style.display="none",$("f_ch").style.display="none",$("f_usrref").style.display="none",$("f_grpref").style.display="none",$("f_mvp").style.display="none",$("f_mvpTypeM").style.display="none",$("f_must").style.display="none",
$("f_nd").style.display="none",$("f_summary").style.display="",initSummaryConfig();else if(b.attr.dv&&b.attr.dv.startsWith("$CUR"))for($("at_it").selectedIndex=d.FX,$("f_fx").style.display="",$("f_dv").style.display="none",c=b.attr.dv.substr(4,3),e=b.attr.dv.substr(7,3),d=0;d<ctrl.fxcur.length;d++){var f=ctrl.fxcur[d],g=node("option");g.value=f;g.innerHTML=f;var k=node("option");k.value=f;k.innerHTML=f;f==c&&(g.selected=!0);f==e&&(k.selected=!0);$("f_fx_from").appendChild(g);$("f_fx_to").appendChild(k)}else if(b.attr.fmt_n&&
"$"==b.attr.fmt_n.substr(0,1))c=b.attr.fmt_n_ts,e=b.attr.fmt_n_ds,$("at_it").selectedIndex=d.MONEY,$("ex_fmt").innerHTML=formatNumber("12345.67",b.attr.fmt_n,c,e);else if(b.attr.fmt_d)b.attr.repeat?$("at_it").selectedIndex=d.DATE_REPEAT:($("at_it").selectedIndex=d.DATE,$("ex_fmt").innerHTML=formatDate(new Date,b.attr.fmt_d));else if(b.attr.fmt_n&&b.attr.fmt_n.endsWith("%"))c=b.attr.fmt_n_ts,e=b.attr.fmt_n_ds,$("at_it").selectedIndex=d.PERCENTAGE,$("ex_fmt").innerHTML="34%",$("f_percentBar").style.display=
"",b.attr.show_percentBar&&($("f_percentBar_setting").style.visibility="visible");else if(b.attr.fmt_n)c=b.attr.fmt_n_ts,e=b.attr.fmt_n_ds,$("at_it").selectedIndex=d.NUMBER,$("ex_fmt").innerHTML=formatNumber("12345.67",b.attr.fmt_n,c,e);else if(b.attr.sig)$("at_it").selectedIndex=d.SIG,$("f_image").style.display="",$("at_multipleImages_container").style.display="none",$("f_dv").style.display="none",b.attr&&(b.attr.iwidth&&($("at_iwidth").value=b.attr.iwidth),b.attr.iheight&&($("at_iheight").value=
b.attr.iheight));else if(b.attr.html)$("at_it").selectedIndex=d.HTML,$("show_dv").removeAttribute("toggle"),$("f_dv").style.display="none",builder.ifListingPage()||($("f_hideEditIcon").style.display="",$("hideEditIcon").checked=!!b.attr.hideEditIcon);else if(b.attr.barcode)b.attr.bc_action?($("at_it").selectedIndex=d.ACTION_BARCODE,$("f_bc_action").style.display="",$("f_bc").style.display="none",$("f_dv").style.display="none",$("f_nd").style.display="none",$("f_ro").style.display="none",$("f_nc").style.display=
"none",$("f_nowrap").style.display="none",$("f_nolock").style.display="none",initActionBarcode()):($("at_it").selectedIndex=d.BARCODE,$("f_barcode").style.display="",$("f_bc").style.display="none",b.attr.bc_height&&($("bc_height").value=b.attr.bc_height),void 0===b.attr.bc_append_text?$("bc_append_text").checked=!0:$("bc_append_text").checked="true"===b.attr.bc_append_text,defaultSelectElement($("f_barcode_sel"),b.attr.bc_type?b.attr.bc_type:"QR Code"),modifyBarcodePic());else if(b.attr.email)$("at_it").selectedIndex=
d.EMAIL,$("f_em").style.display="",$("show_dv").removeAttribute("toggle"),builder.ifListingPage()?$("editEmailTemplate").style.display="none":$("editEmailTemplate").style.display="";else if(1==b.attr.phone)$("at_it").selectedIndex=d.PHONE,$("f_phone").style.display="",$("f_dv").style.display="",$("f_phone_sel").style.display="",$("f_format_sel").style.display="none",b.attr.phonefmt&&($("at_phonefmt").value=b.attr.phonefmt),defaultSelectElement($("f_phone_sel"),$("at_phonefmt").value,23,b.attr.phonesel);
else if(b.attr.addr)$("at_it").selectedIndex=d.ADDR,$("f_addr").style.display="",b.attr.map?($("addr_map_options").style.display="",b.attr.iwidth&&($("addr_map_width").value=b.attr.iwidth),b.attr.iheight&&($("addr_map_height").value=b.attr.iheight),b.attr.zoom&&($("addr_map_zoom").value=b.attr.zoom)):$("addr_map_options").style.display="none",$("show_dv").removeAttribute("toggle");else if(b.attr.url)$("at_it").selectedIndex=d.URL,$("f_url").style.display="",$("f_dv").style.display="";else if(2==b.attr.phone)$("at_it").selectedIndex=
d.FORMATTED,$("f_phone").style.display="",$("f_dv").style.display="none",$("at_phonefmt").disabled=!1,$("f_phone_sel").style.display="none",$("f_format_sel").style.display="",b.attr.phonefmt?$("at_phonefmt").value=b.attr.phonefmt:$("at_phonefmt").value="XXXXXXXXXX",defaultSelectElement($("f_format_sel"),$("at_phonefmt").value,11);else if(1==b.attr.masked||"true"==b.attr.masked)$("at_it").selectedIndex=d.MASKED,d=function(){var a=$("f_mask_mode").value;if(null==a||""==a||isNaN(parseInt(a)))a=4,$("f_mask_mode").value=
a;b.attr.masked_mode=a},$("f_mask_mode").onchange=d,b.attr.masked_mode?$("f_mask_mode").value=b.attr.masked_mode:d(),c={a:ap,multiple:!0,dispAdmin:!0},b.attr.masked_viewableGroups||(b.attr.masked_viewableGroups=encodeURIComponent(JSON.stringify(["SYSAdmin"]))),c.selectedGroups=b.attr.masked_viewableGroups,postPromise("/sims/groupSelector.jsp",c).then(function(a){$("f_mask_groups").innerHTML=a;var c=enableMultiSelectCombo($("groupSelector")),d=function(){document.querySelector("#groupSelector .multiComboSelectedDiv").style.margin=
"0px";for(var a=document.querySelectorAll("#groupSelector .multiComboValue"),b=0;b<a.length;b++)a[b].style.margin="3px 2px"};c.setAfterChangeItem(function(){d();b.attr.masked_viewableGroups=encodeURIComponent(JSON.stringify(c.getValues()))});d();$("f_mask").style.display=""});$("f_ch").style.display="none";$("f_usrref").style.display="none";$("f_grpref").style.display="none";$("f_mvp").style.display="none"}b.attr.vd&&(d=builder.findField(b.attr.l))&&(c=d.attr.mvp)&&(c=c.split("|"),e=c[0],f=c[1],c=
{},c.a=ap,c.source_path=e,c.source_fn=f,c.source_loadedDomainId=b.attr.vd,c.source_linkedDomainId=d.attr.stf,c.rootDomainId=builder.rootDomainId,c.loadedDomainId=b.domainId,c.linkedDomainId=b.attr.l,c.x=b.x,c.y=b.y,getPromise("/sims/vdSelector.jsp",c).then(function(a){$("f_load").innerHTML=a;if(b.hasAttribute("fixedDesign")||1E6>parseInt(b.domainId))$("vdSelParam").disabled=!0}));b.IPType===UPLOADER&&($("f_f_extensions").style.display="");if(b.hasAttribute("fixedDesign")||ifSystemFieldFixedDesign(b))$("f_it").querySelectorAll("input[type=checkbox], input[type=text], input[type=radio], select, textarea").forEach(function(a){a.disabled=
!0}),$("at_fmt_d").disabled=!1,$("at_fmt_n").disabled=!1,$("dsBox").disabled=!1,$("at_fmt_n_ds").disabled=!1,$("at_fmt_n_ts").disabled=!1,$("fmt_n_sample").disabled=!1,$("fmt_d_sample").disabled=!1,$("at_noDup").disabled=!0,$("at_barcode").disabled=!0,$("at_f").disabled=!0,$("at_va").disabled=!0,$("va_sample").disabled=!0,$("at_utcTime").disabled=!1,$("at_ago").disabled=!1,$("at_countdown").disabled=!1;if(10==b.domainId||43==b.domainId)$("at_ro").disabled=!0,$("at_noclone").disabled=!0;b.attr||(b.attr=
{});if(b.attr)for(var l in b.attr)if(d=l,c=b.attr[l]){"ln"===l&&(d="l");"rf"===l&&(c=b.domainId);"usrref"===l&&($("at_usrref_1").checked=1==c);"grpref"===l&&($("at_grpref_1").checked=1==c);"groupNotify"===l&&($("at_grpref_3").checked=1==c);"ifReadInfo"===l&&($("at_usrref_4").checked=c);"dv"===l&&($("at_usrref_3").checked="$USER"===c||"$USERNAME"===c);"ag"===l&&($("f_dv").style.display="none");e=$("at_"+d);if(!e&&"dv"===d)e=b.IPType!==SELECTOR&&b.IPType!==MSELECTOR||b.attr&&(b.attr.usrref||b.attr.grpref||
b.attr.mvp||b.mvp)?$("at_dv_text"):$("at_dv_sel");else if(!e&&"dv_f"===d)e=$("at_dv_f_text");else if(!e&&("imgfit"===d||"fixImageMax"===d))e=$("at_imgDisplay");else if("maxFileSize_number"===d||"maxFileSize"===d||"maxFileSize_unit"===d)e=document.querySelector((b.IPType===GRAPHICS?"#f_image":"#f_f_extensions")+" #at_"+d);if(e){if("rf"!==d&&"s"!==d&&"l"!==d)if("dv"===d)c&&(c=unformatNUIAttr(c.toString())),e.value=decHTML(c),c.length&&(b.IPType===MSELECTOR&&(b.hasAttribute("sep_m")&&(c=replaceMSelectorDvSep(c,
b.attr.sep_m)),c=c.replace(/%7C/g,"|")),$("show_dv").innerHTML=c);else if("dv_f"===d)c&&(c=unformatNUIAttr(c.toString())),e.value=c,c.length&&($("show_dv_f").innerHTML=c);else if("SELECT"===e.tagName.toUpperCase())if("at_imgDisplay"===e.id)b.hasAttribute("fixImageMax")?e.value="fixImageMax":b.hasAttribute("imgfit")?e.value="imgfit":e.value="default";else for(d=0;d<e.options.length;d++)e.options[d].value===c&&(e.selectedIndex=d);else if("INPUT"===e.tagName.toUpperCase())switch(e.type.toUpperCase()){case "TEXT":c&&
(c=unformatNUIAttr(c.toString()));e.value=c;break;case "CHECKBOX":"percentBar"===l?e.checked=!!b.attr.show_percentBar:"utcTime"===l?checkDateFormatIsValidForUTCTime(b):e.checked=null!=c;break;case "NUMBER":e.value=c}else"TEXTAREA"===e.tagName.toUpperCase()&&(c&&(c=unformatNUIAttr(c.toString())),e.value=c);"fmt_n"===l?(displayFormatType(1),$("at_fmt_n").value=c,checkNumberFormat(b)):"fmt_d"===l&&(b.attr.repeat?displayRepeatDateSetupMenu(b,a):(displayFormatType(2,a||builder.ifListingPage()),checkDateFormatIsValidForUTCTime(b),
$("at_fmt_d").value=c));"fmt_n_ds"===l&&($("at_fmt_n_ds").value=c?c:".",$("dsBox").checked="."===$("at_fmt_n_ds").value&&","===$("at_fmt_n_ts").value,$("at_fmt_n_ds").disabled=$("dsBox").checked,$("at_fmt_n_ts").disabled=$("dsBox").checked,$("number_separator").style.color=$("dsBox").checked?"#808080":"",convertFormatSampleBySeparator());"fmt_n_ts"==l&&($("at_fmt_n_ts").value=c?c:",",$("dsBox").checked="."==$("at_fmt_n_ds").value&&","==$("at_fmt_n_ts").value,$("at_fmt_n_ds").disabled=$("dsBox").checked,
$("at_fmt_n_ts").disabled=$("dsBox").checked,$("number_separator").style.color=$("dsBox").checked?"#808080":"",convertFormatSampleBySeparator());"rmd"==l&&($("at_setRmd").checked=!0,0<=parseInt($("at_rmd").value)?$("at_rmd_b").selectedIndex=0:($("at_rmd").value=Math.abs($("at_rmd").value),$("at_rmd_b").selectedIndex=1));"va_cust_msg"==l&&(e.value=unformatHTMLEntities(unformatNUIAttr(e.value)));"addr"===l&&(b.attr.map?$("at_addr").checked=!0:$("at_addr").checked=!1,$("at_addr").onchange=function(){$("at_addr").checked?
(b.attr.map=!0,$("addr_map_options").style.display="",b.attr.iwidth&&($("addr_map_width").value=b.attr.iwidth),b.attr.iheight&&($("addr_map_height").value=b.attr.iheight),b.attr.zoom&&($("addr_map_zoom").value=b.attr.zoom)):(b.attr.map=!1,$("addr_map_options").style.display="none")});if("maxFileSize"===l){d=b.attr.maxFileSize_unit||"GB";e=document.querySelector((b.IPType===GRAPHICS?"#f_image":"#f_f_extensions")+" #at_maxFileSize_number");switch(d){case "B":b.attr.maxFileSize_number||(e.value=c);e.dataset.max=
1073741824;break;case "KB":b.attr.maxFileSize_number||(e.value=c/1024);e.dataset.max=1048576;break;case "MB":b.attr.maxFileSize_number||(e.value=c/1024/1024);e.dataset.max=1024;break;case "GB":b.attr.maxFileSize_number||(e.value=c/1024/1024/1024),e.dataset.max=1}"DISTR"===licenseType&&(e.dataset.max*=10)}}}ctrl.currentController.resize();return!0}
function changeDomainId(){var a=builder.cellData[nui.fcol+","+nui.frow];if(a&&!(a.hasAttribute("fixedDesign")||1E6>parseInt(a.domainId))){var b=prompt(lm.ChangeDomainId_EnterNewFieldId,a.domainId);b=parseInt(b);if(!isNaN(b))if(300>b)alert(lm.ChangeDomainId_FieldIdTooLow);else{var c=window.user&&window.user.endsWith("@ragic.com");if(301!==b||c){for(var d in builder.cellData)if(c=builder.cellData[d],c.domainId==b){alert("Field id "+b+" already exists as field: "+c.value);return}a.domainId=b;$("at_spid").value=
b}else alert(lm.ChangeDomainId_InvalidFieldId)}}}function builderUpdateDomainName(a){var b=nui._curcell().ip;b&&(b.loadValue(a),b.render())}function builderUpdateDescName(a){builder.setDescription(nui.fcol,nui.frow,a?a:"");$("hin").setValue(a)}
function initChoices(a){var b=a.domainId,c=a.x+"|"+a.y,d=$("at_lov");if(b&&(""===builder.selections[b]||a.attr&&a.attr.l&&a.IPType===SELECTOR))d.value=lm.prop_valueReferencedFromOtherSheet,d.disabled=!0;else if(b&&builder.selections[b]){e=builder.selections[b];f="";if(e)for(g=0;g<e.length;g++)""!==e[g]&&(f+=unformatNUIAttr(e[g]).replace(/&#44;/gim,",")+"\n");d.disabled=!1;d.value=f}else if(builder.selections[c]){var e=builder.selections[c],f="";if(e)for(var g=0;g<e.length;g++)""!==e[g]&&(f+=e[g]+
"\n");d.disabled=!1;d.value=f}else b&&(builder.selections[b]=[],d.disabled=!1,d.value="");builder.cascadedSelections.hasOwnProperty(b)?(b=builder.cascadedSelections[b],a.IPType===MSELECTOR?b.avaliable=!1:b.avaliable&&($("at_cascadedSel").checked=!0,setCascadedSel())):builder.cascadedSelections.hasOwnProperty(c)&&(b=builder.cascadedSelections[c],a.IPType===MSELECTOR?b.avaliable=!1:b.avaliable&&($("at_cascadedSel").checked=!0,setCascadedSel()))}
function displayChoicesAsSymbols(){var a=$("lovSymbol");$("lovSymbol")||(a=node("div"),a.id="lovSymbol",a.style.width="50px",a.style.height="180px",$("lovWrapper").appendChild(a));rm(a);for(var b=$("at_lov").value.split("\n"),c=0;c<b.length;c++){var d=b[c];d&&(a.innerHTML+='<div style="margin:4px 0;">'+checkboxSymbolRender(d)+"</div>")}a.innerHTML+=lm.checkboxTypesLink}
function checkCheckboxOptions(){var a=0;$("at_lov").value.split("\n").forEach(function(b){0<b.trim().length&&a++});1>=a?$("checkboxWarningMsg").style.display="":$("checkboxWarningMsg").style.display="none"}
function initSummaryConfig(){var a={},b=builder.getAttribute(nui.fcol,nui.frow,"summary");b&&(b=decodeURIComponent(b),a=JSON.parse(b));b=$("summaryType");selectOption(b,a.type);0===b.selectedIndex?$("f_summaryFactField").style.display="none":$("f_summaryFactField").style.display="";b.onchange=function(){this.config.type=this.options[this.selectedIndex].value;saveSummaryConfig();initSummaryConfig()};b.config=a;getPromise("/sims/summaryConfig.jsp",{a:ap,summaryKey:builder.rootDomainId}).then(function(b){b=
JSON.parse(b);if(0==b.length)$("f_summary_content").innerHTML="",$("f_summary_content2").innerHTML="",$("totalFieldSel2DescEmpty").style.display="",$("totalFieldSel2Desc").style.display="none";else{$("totalFieldSel2DescEmpty").style.display="none";$("totalFieldSel2Desc").style.display="";for(var c=node("select","summaryDataSheetSel","designModeSel"),e=0;e<b.length;e++){var f=b[e],g=node("option");g.setAttribute("p",f.p);g.setAttribute("si",f.si);g.setAttribute("linkFieldId",f.linkFieldId);g.value=
f.p+"/"+f.si;g.innerHTML=f.sheetName;a.p==f.p&&a.si==f.si&&(g.selected=!0);c.appendChild(g)}var k=node("select","summaryFactFieldSel","designModeSel");for(e=0;e<b.length;e++)if(f=b[e],a.p==f.p&&parseInt(a.si)==parseInt(f.si))for(var l=f.factFields,m=0;m<l.length;m++)g=node("option"),g.innerHTML=l[m].name||lm.count,g.value=l[m].id,a.p==f.p&&parseInt(a.si)==parseInt(f.si)&&parseInt(a.factField)==parseInt(g.value)&&(g.selected=!0),k.appendChild(g);$("f_summary_content").innerHTML="";$("f_summary_content").appendChild(c);
$("f_summary_content2").innerHTML="";$("f_summary_content2").appendChild(k);c.onchange=function(){var b=this.options[this.selectedIndex];a.p=b.getAttribute("p");a.si=b.getAttribute("si");saveSummaryConfig();initSummaryConfig()};k.onchange=function(){saveSummaryConfig()};b=c.options[c.selectedIndex];a.p=b.getAttribute("p");a.si=b.getAttribute("si");saveSummaryConfig()}})}
function saveSummaryConfig(){var a=$("summaryType"),b=$("summaryDataSheetSel"),c=$("summaryFactFieldSel");a=a.options[a.selectedIndex].value;b=b.options[b.selectedIndex];c=c.options[c.selectedIndex];c={a:ap,p:b.getAttribute("p"),si:b.getAttribute("si"),linkField:b.getAttribute("linkFieldId"),factField:"COUNT"!=a&&c?c.value:-1,type:a};builder.setAttribute(nui.fcol,nui.frow,"summary",encodeURIComponent(JSON.stringify(c)))}
function initMVPSelector(a,b,c,d,e,f,g,k,l){d&&(ctrl.mvpSelectorCanvas=d);e&&(ctrl.mvpSelectorCallback=e);d=path+"/"+sheetIndex;ctrl.mvpSelectorCanvas.innerHTML='<i class="fa fa-spinner fa-spin"></i>';read(function(a){ctrl.mvpSelectorCanvas.innerHTML=a.responseText;(a=builder.cellData[nui.fcol+","+nui.frow])&&a.hasAttribute("mvp")&&!a.hasAttribute("s")&&($("mvpSelParam").disabled=!0);a&&(a.hasAttribute("fixedDesign")||1E6>parseInt(a.domainId))&&($("mvpSelParam").disabled=!0,$("stfSelParam")&&($("stfSelParam").disabled=
!0));f&&e()},"/sims/mvpSelector.jsp?a="+ap+(a?"&p="+encodeURIComponent(a):"")+(b?"&fn="+encodeURIComponent(b):"")+(c?"&stf="+c:"")+(k?"&vd="+k:"")+(l?"&d="+l:"")+"&showStfSel="+g+"&curSheet="+d,!1)}function openLinkAndLoad(a,b){"3"===builder.formType?a&&b?linkWizard.displayWizard(a,b):linkWizard.displayWizard():"2"===builder.formType&&floatWin(null,lm.prop_linkManagerOnlyForFormPage)}
function mvpSelChange(a){var b=currentBiff,c=$("mvpSelParam"),d=$("stfSelParam"),e=c.options[c.selectedIndex],f=e.parentNode.dataset?e.parentNode.dataset.selpath:e.parentNode.getAttribute("data-selpath"),g=b.attr.mvp,k=e.getAttribute("rootDomainId"),l=f+"|"+e.value,m=e.value,n=e.textContent,q=d?d.options[d.selectedIndex]:null,r=q?q.getAttribute("domainId"):-1,p;getPromise("/sims/stfSelector.jsp",{a:ap,p:f,fn:m,stf:r}).then(function(a){$("f_stf").innerHTML=a}).then(function(){d=$("stfSelParam");q=
d.options[d.selectedIndex];p=q.getAttribute("isFileField");r=q.getAttribute("domainId");return getPromise("/sims/checkIfNoDup.jsp",{a:ap,di:r,f:p,rdi:k})}).then(function(d){d=JSON.parse(d);var e=d.dupValue;if("error"===d.status)return!1;if(d.noDup){b.hasAttribute("stf")||builder.addLinkAndLoadAction("ADD",b.domainId,r,k,l);if(b.hasAttribute("mvp")&&a&&"mvpSelParam"===a.id)for(var f in builder.cellData)d=builder.cellData[f],d.hasAttribute("l")&&d.attr.l===""+b.domainId&&(delete d.attr.l,delete d.attr.vd,
d.render());if(b.hasAttribute("s")&&b.attr.s!==k&&b.domainId){f="";for(d=0;d<c.options.length;d++)if(e=c.options[d],(e.parentNode.dataset?e.parentNode.dataset.selpath:e.parentNode.getAttribute("data-selpath"))+"|"+e.value===g){f=e.textContent;break}f=lm.change_s_warning.replace("{0}",n).replace("{1}",f);floatWin(null,'<div style="max-width:800px;line-height:2;">'+f+"</div>","")}b.hasAttribute("mvp")&&!b.hasAttribute("s")||builder.setAttribute(b.x,b.y,"s",k);builder.setAttribute(b.x,b.y,"stf",r);builder.setAttribute(b.x,
b.y,"mvp",l)}else return floatWin(null,lm.linkWizard_linkToDupField.replace("{0}",q.value).replace("{1}",e)),!1})}var proptableHTML;
function resetPropertyTable(a){a=a.biff;var b;a&&a.attr&&((b=a.attr.vd)||(b=a.attr.vdn),(b=a.attr.l)||(b=a.attr.ln));proptableHTML?">"===proptableHTML.charAt(proptableHTML.length-1)&&floatWin(null,proptableHTML.substring(proptableHTML.indexOf("<SYSMSG msg='"),proptableHTML.indexOf("' msgend>"))):read(function(a){proptableHTML=a=a.responseText;">"===a.charAt(a.length-1)&&floatWin(null,a.substring(a.indexOf("<SYSMSG msg='"),a.indexOf("' msgend>")))},"/sims/prop.jsp?a="+ap+"&p="+encodeURIComponent(path)+
"&si="+sheetIndex,!0);$("prop").innerHTML=proptableHTML}function addDomainOptions(a,b){var c=node("option");a.appendChild(c);b||(c=node("option"),c.value=4,c.innerHTML="User Name",a.appendChild(c));for(b=0;b<ptable.domainIdList.length;b++)c=node("option"),c.value=ptable.domainIdList[b],c.innerHTML=ptable.domainNameList[b],a.appendChild(c)}var propOn=!1;function toggleProp(){setPropertyTable(nui._curcell())}
function textFocus(a){ctrl.outOfNUI=!0;ctrl.currentTextFocus=a;if("at_dv_text"===a.id){var b=builder.cellData[nui.fcol+","+nui.frow];b.hasAttribute("phonefmt")&&"1"===b.attr.phone&&(a.value=ragic_phone_unformat(a.value,b.attr.phonefmt))}}
var textProcessing=debouncedFn(500,function(a){if(mode===BUILDER&&a){var b=currentBiff,c=a.value;b&&("lov"===a.name&&c&&(c=c.replace(/,/gim,"&#44;")),"va_cust_msg"===a.name&&(c=formatHTMLEntities(c),c=formatNUIAttr(c),c=c.replace(/\n/g,"&#10;")),"f_extensions"===a.name&&c&&(c=c.replace(/\s/g,""),c=formatNUIAttr(c)),builder.setAttribute(b.x,b.y,a.name,c),b.attr&&b.attr.checkbox&&(displayChoicesAsSymbols(),checkCheckboxOptions()),b.attr&&"1"===b.attr.phone&&b.attr.phonefmt&&"at_phonefmt"===a.id&&(a=
$("at_dv_text"),"none"!==a.style.display&&""!==a.value&&(a.value=ragic_phone_reformat(a.value,b.attr.phonefmt),textProcessing(a)),a=$("f_phone_sel"),a.value!==c&&(defaultSelectElement(a,c,23),setPhoneSel(a))),b.hasAttribute("ag")&&setAutoGenPropertyTableByFormat(c),b.hasAttribute("fmt_n")&&(checkNumberFormat(b),$("f_percentBar").style.display=b.attr.fmt_n.endsWith("%")?"":"none"),b.hasAttribute("fmt_d")&&checkDateFormatIsValidForUTCTime(b))}});
function setPhoneSel(a){if(mode===BUILDER&&a){var b=currentBiff,c=a.options[a.selectedIndex].innerText;c===lm.enterYourOwnFormat&&(c="");b&&builder.setAttribute(b.x,b.y,a.name,c)}}function inputboxAutoExpand(a){var b=a.value.length;a.style.width=ctrl.currentTextFocus?Math.min(7*b,document.body.clientWidth-100)+"px":""}
function textBlur(a){ctrl.outOfNUI=!1;ctrl.currentTextFocus=null;"at_lov"===a.id&&validateDV();if("at_dv_text"==a.id){var b=builder.cellData[nui.fcol+","+nui.frow];b&&b.hasAttribute("phonefmt")&&"1"===b.attr.phone&&(a.value=ragic_phone_reformat(a.value,b.attr.phonefmt))}}
function validateDV(){var a=builder.cellData[nui.fcol+","+nui.frow];if(a&&a.hasAttribute("dv")&&(!a.attr||!(a.attr.usrref||a.attr.grpref||a.attr.mvp||a.mvp))){var b=a.domainId?builder.selections[a.domainId]:builder.selections[a.x+"|"+a.y];var c=a.attr.dv,d=$("show_dv"),e=$("at_dv_sel"),f=$("at_dv_msel");c=decHTML(c);if(b)if(a.IPType===SELECTOR)f=b.map(function(a){return a.toUpperCase()}),0>b.indexOf(c)&&(a.attr.checkbox?0<=(c=f.indexOf("NO"))||0<=(c=f.indexOf("UNLOCK"))||0<=(c=f.indexOf("TOGGLE-OFF"))?
(builder.setAttribute(a.x,a.y,"dv",b[c]),d.innerHTML=b[c]):(builder.setAttribute(a.x,a.y,"dv",""),d.innerHTML=lm.notSet):(builder.setAttribute(a.x,a.y,"dv",""),d.innerHTML=lm.notSet,floatWin(null,lm.clearDv.replace("{0}",c),"")),d.style.display="inline-block",e.style.display="none");else{c=c.split("|");var g=!1;e="";for(var k=0;k<c.length;k++){var l=c[k].replace(/%7C/g,"|");0>b.indexOf(l)&&(c.splice(k,1),k--,e+=(0<e.length?", ":"")+l,g=!0)}g&&(b=c.join("|"),builder.setAttribute(a.x,a.y,"dv",b),0===
c.length?d.innerHTML=lm.notSet:(a.hasAttribute("sep_m")&&(b=replaceMSelectorDvSep(b,a.attr.sep_m)),b=b.replace(/%7C/g,"|"),d.innerHTML=b),d.style.display="inline-block",f.style.display="none",floatWin(null,lm.removeSomeDv.replace("{0}",e).replace("{1}",a.value),""))}}}
function showDVSelection(a){var b=builder.cellData[nui.fcol+","+nui.frow],c=b&&isNumeric(b.domainId)&&1E5>b.domainId;if(b){var d=b.IPType===MSELECTOR&&!(b.attr&&(b.attr.usrref||b.attr.grpref||b.attr.mvp||b.mvp));if(b.IPType!==SELECTOR&&b.IPType!==MSELECTOR||b.attr&&(b.attr.usrref||b.attr.grpref))var e=$("at_dv_text");else b.attr.mvp||b.mvp?e=$("at_dv_text"):(e=$("at_dv_sel"),e.multiple=b.IPType===MSELECTOR,e.innerHTML="");d||(e.style.display="");if(b.IPType===SELECTOR||b.IPType===MSELECTOR){var f=
"";b.hasAttribute("dv")&&(f+=b.attr.dv);f=decHTML(f);var g;b.IPType===MSELECTOR&&(g=f.split("|"));if(!b.attr||!(b.attr.usrref||b.attr.grpref||b.attr.mvp||b.mvp)){var k=$("at_lov").value.split("\n");if(b.IPType!==MSELECTOR){var l=node("option");e.appendChild(l)}for(var m=0;m<k.length;m++){var n=k[m];n&&(l=node("option"),l.value=n,l.innerHTML=encHTML(n),b.IPType===SELECTOR&&n===f&&(l.selected=!0),b.IPType===MSELECTOR&&g&&g.includes(n)&&(l.selected=!0),e.appendChild(l))}}$("f_dvAssign").style.display=
"";d&&(l=$("at_dv_msel"),l.innerHTML="",l.style.display="inline-block",BarSelectAgent.modifiedSelector("dv_mbarselect",e,l,{}).setAfterSelectOption(function(a){var b=Array.from(e.options).find(function(b){return b.value===a.value});b&&(b.selected=!b.selected,e.dispatchEvent(new Event("change")))}))}else if(b.hasAttribute("dv_f"))$("sample_dv").style.display="none",$("f_dvAssign").style.display="none",$("f_dv_f_box").style.display="";else if(a.hasAttribute("toggle"))for(d=$("sample_dv"),d.style.display=
"",$("f_dvAssign").style.display="",f=b&&b.attr&&b.attr.fmt_n,g=b&&b.attr&&b.attr.fmt_d,k=b&&builder.ifAdjacent(b.x,b.y),m=0;m<d.options.length;m++)l=d.options[m],l.style.display=f?"$YEAR"===l.value||"$MONTH"===l.value||"$WEEKDAY"===l.value||"#YEAR"===l.value||"#MONTH"===l.value||"#WEEKDAY"===l.value||k&&"$SEQ"===l.value?"":"none":g?"$USER"===l.value||"$USERNAME"===l.value||"$USERID"===l.value||"$WEEKDAY"===l.value||"#USER"===l.value||"#USERNAME"===l.value||"#USERID"===l.value||"#WEEKDAY"===l.value||
"$SEQ"===l.value?"none":"":k||"$SEQ"!==l.value?"":"none";else $("f_dvAssign").style.display="";b.IPType===MSELECTOR&&b.attr&&(b.attr.usrref||b.attr.grpref||b.attr.mvp||b.mvp)&&($("multiSelDVHint").style.display="");c||b.attr.ag||b.attr.sig||b.attr.html||b.attr.dv&&b.attr.dv.startsWith("$CUR")||($("f_dv_f_box").style.display="");e.focus();a.style.display="none";b.hasAttribute("phonefmt")&&"1"===b.attr.phone&&(e.value=ragic_phone_unformat(e.value,b.attr.phonefmt))}}
function showDVF(){var a=$("at_dv_f_text");a.style.display="";$("show_dv_f").style.display="none";$("f_dv_f_box").style.display="";var b=builder.cellData[nui.fcol+","+nui.frow];b&&b.attr&&(a.value=b.attr.dv_f,a.focus())}function replaceMSelectorDvSep(a,b){return b?"space"===b?a.replaceAll("|"," "):"bubble"!==b&&"line-break"!==b?a.replaceAll("|",b):a:a}
function mselectorSepSelChange(a){selChange(a);a=currentBiff;var b=a.attr.dv;b&&(a.hasAttribute("sep_m")&&(b=replaceMSelectorDvSep(b,a.attr.sep_m)),b=b.replace(/%7C/g,"|"),$("show_dv").innerHTML=b,a.render())}
function selChange(a){for(var b=currentBiff,c="",d=0;d<a.options.length;d++){var e=a.options[d];e.selected&&(0<c.length&&(c+="|"),c="at_dv_sel"===a.id&&!0===a.multiple?c+e.value.replace(/[|]/g,"%7C"):c+e.value)}builder.setAttribute(b.x,b.y,a.name,c);"at_it"===a.id&&(setPropertyTable(nui._curcell()),b.IPType===MSELECTOR&&b.hasAttribute("f")&&floatWinConfirmV3(lm.formulaMultiSelectorErr,function(){$("at_f").value="";delete b.attr.f},lm.yes,null,lm.no),"MVP"===c||c!==SELECTOR&&c!==MSELECTOR&&"USER"!==
c&&"GROUP"!==c&&"CHECKBOX"!==c||builder.ifAdjacent(b.x,b.y)||($("at_noDup").checked=!1,$("at_noDup").disabled=!0,builder.setAttribute(b.x,b.y,"noDup","")),delete b.attr.percentBar,delete b.attr.show_percentBar,delete b.multiRangeSlider);if("cs"===a.name)if(builder.ifAdjacent(b.x,b.y))for(d=0;d<=ctrl.TABLE_DEF_ROWS;d++)updateCsTranslatedMap(b.y+d);else updateCsTranslatedMap(b.y);if("at_maxFileSize_unit"===a.id){d=b.IPType===GRAPHICS?"#f_image":"#f_f_extensions";a=document.querySelector(d+" #at_maxFileSize_number");
d=document.querySelector(d+" #at_maxFileSize").value;switch(c){case "B":a.value=d;a.dataset.max=1073741824;break;case "KB":a.value=d/1024;a.dataset.max=1048576;break;case "MB":a.value=d/1024/1024;a.dataset.max=1024;break;case "GB":a.value=d/1024/1024/1024,a.dataset.max=1}"DISTR"===licenseType&&(a.dataset.max*=10);builder.setAttribute(b.x,b.y,"maxFileSize_number",a.value)}tutorialCheckProgress();return!0}
function imgDisplaySelChange(a){var b=currentBiff;a=a.value;"imgfit"===a?(builder.setAttribute(b.x,b.y,a,!0),b.hasAttribute("fixImageMax")&&delete b.attr.fixImageMax):"fixImageMax"===a?(builder.setAttribute(b.x,b.y,a,!0),b.hasAttribute("imgfit")&&delete b.attr.imgfit):(b.hasAttribute("imgfit")&&delete b.attr.imgfit,b.hasAttribute("fixImageMax")&&delete b.attr.fixImageMax)}
function multiSelChange(a,b,c){if(-1!==a.selectedIndex){var d=a.options[a.selectedIndex];"agSampleList"===a.id&&$("ag_refField").checked?(a=(a=b.value.match(/{2,reference,(\d*)}/))?parseInt(a[1]):-1,b.value=addAutoGenRefFormat(d.value,a)):b.value=d.value;textProcessing(b);c&&(a=d.getAttribute("sample"),c.innerHTML=a?a:d.innerHTML);b.focus()}}function setOptionAdding(a){boxChange(a)}
function setCascadedSel(){var a=$("f_ch"),b=builder.cellData[nui.fcol+","+nui.frow],c=$("show_dv");$("at_userOps").checked&&(floatWin(null,lm.cascadedUseGuide1),$("at_userOps").click());if($("at_cascadedSel").checked){$("userOptionsDiv").style.display="none";$("at_lov").style.display="none";var d=currentBiff.domainId||currentBiff.x+"|"+currentBiff.y,e=!!builder.ifAdjacent(currentBiff.x,currentBiff.y);if(builder.cascadedSelections.hasOwnProperty(d)){var f=builder.cascadedSelections[d].pdomainid;builder.cascadedSelections[d].avaliable=
!0}var g=document.createElement("div");g.id="pselDiv";var k=document.createElement("select");k.id="psel";g.appendChild(k);k.appendChild(new Option("",""));for(var l in builder.cellData){var m=builder.cellData[l];if(m.IPType===SELECTOR&&m!==currentBiff&&e===!!builder.ifAdjacent(m.x,m.y)&&(!e||(m.x<currentBiff.x?builder.findFieldInSubtable(currentBiff.domainId,m.x+","+m.y):builder.findFieldInSubtable(m.domainId,currentBiff.x+","+currentBiff.y)))){if(m.hasAttribute("l")){d=m.attr.vd;var n=builder.findListenFieldByLoadedField(m);
n=n?n.attr.mvp:null;if(!d||!n)continue;var q=!0;ajaxget("/sims/checkIfValidCascadedParent.jsp",{a:ap,mvp:n,vd:d},function(a){"false"===a&&(q=!1)},!0);if(!q)continue}d=m.domainId||m.x+"|"+m.y;m=new Option(m.value,d);k.appendChild(m);d===f&&(m.selected="selected")}}1>=k.options.length&&(0<f?(f=node("DIV"),f.style.color="#f00",f.style.fontWeight="400",f.style.marginBottom="5px",f.textContent=lm.cascadedParentNotExist,g.insertBefore(f,k)):(floatWin(null,lm.noOtherSingleSel),$("at_cascadedSel").checked=
!1,setCascadedSel()));k=document.createElement("button");k.className="topButtonWhole";k.style.cssFloat="none";g.appendChild(k);k.appendChild(document.createTextNode(lm.set));k.onclick=spreadOptionSel;a.insertBefore(g,$("cascadedSelDiv").nextSibling);b&&b.hasAttribute("dv")&&(b.originalDV=decHTML(b.attr.dv),builder.setAttribute(nui.fcol,nui.frow,"dv",""),c.innerHTML=lm.notSet);c.onclick=null;c.style.color="#a3a3a3";c.style.display="inline-block";$("at_dv_sel").style.display="none"}else $("userOptionsDiv").style.display=
"",$("at_lov").style.display="",builder.cascadedSelections.hasOwnProperty(currentBiff.domainId)?builder.cascadedSelections[currentBiff.domainId].avaliable=!1:builder.cascadedSelections.hasOwnProperty(currentBiff.x+"|"+currentBiff.y)&&(builder.cascadedSelections[currentBiff.x+"|"+currentBiff.y].avaliable=!1),$("pselDiv")&&a.removeChild($("pselDiv")),b&&void 0!==b.originalDV&&(builder.setAttribute(nui.fcol,nui.frow,"dv",b.originalDV),c.innerHTML=encHTML(b.originalDV)),c.onclick=showDVSelection.bind(null,
c),c.style.color="#08c"}
function spreadOptionSel(){var a=$("psel");if(a.value){var b=currentBiff.domainId||currentBiff.x+"|"+currentBiff.y,c=[],d=Object.values(builder.cellData).find(function(b){return b.domainId===a.value||b.x+"|"+b.y===a.value});d.attr||(d.attr={});if(d.attr.hasOwnProperty("mvp")||d.attr.hasOwnProperty("grpref")||d.attr.hasOwnProperty("usrref"))ajaxget("/sims/options.jsp",{a:ap,d:d.domainId,p:path,si:sheetIndex},function(a){a.trim().split("\n").forEach(function(a){a=a.trim().split("|");c.push(a[1])})},
!0);else if(builder.cascadedSelections.hasOwnProperty(a.value)){var e=builder.cascadedSelections[a.value];d=e.collection;var f=function(a){return a==b?!1:builder.cascadedSelections.hasOwnProperty(a)&&builder.cascadedSelections[a].avaliable?(a=builder.cascadedSelections[a].pdomainid,f(a)):!0};if(!1===f(e.pdomainid))return setPropertyTable(nui._curcell()),floatWin(null,lm.cascadedSelectionsInUsed);for(var g in d){e=0;for(var k=d[g];e<k.length;e++)-1==c.indexOf(k[e])&&c.push(k[e])}}else builder.selections[a.value]?
c=builder.selections[a.value]:builder.selections[d.x+"|"+d.y]&&(c=builder.selections[d.x+"|"+d.y]);g="";if(d=builder.cascadedSelections.hasOwnProperty(b)&&builder.cascadedSelections[b].avaliable)var l=builder.cascadedSelections[b].collection;g+="<div style='width:520px;max-height:400px;overflow:auto;'>";e=c.length;for(var m=0;m<e;m++)k=c[m].replace(/</g,"&#60;").replace(/>/g,"&#62;"),g+="<div class='optionDiv' style='display:inline-block;padding:5px;margin-bottom:5px;' data-pdomainid="+a.value+" data-popt="+
encodeURIComponent(c[m])+" ><div style='width:150px;text-align:center;margin-bottom:5px;'><b>"+k+"</b></div><textarea style='width:150px;height:160px;' onblur='ctrl.outOfNUI=false;' onfocus='outNUI();'>"+(d&&l.hasOwnProperty(k)?l[k].join(ctrl.CRLF):"")+"</textarea></div>";g+="</div>";g=(l=0<e)?g+("<div class='topButtonWhole' onclick='saveCascadedSel();' style='margin:10px 5px 0 5px;'>"+lm.save+"</div>"):g+("<div>"+lm.noOptionHint+"</div>");floatWin(null,g,"",l)}}
function saveCascadedSel(){var a=document.querySelectorAll(".optionDiv"),b=currentBiff.domainId||currentBiff.x+"|"+currentBiff.y;builder.cascadedSelections.hasOwnProperty(b)||(builder.cascadedSelections[b]={});b=builder.cascadedSelections[b];for(var c=0;c<a.length;c++){0===c&&(b.pdomainid=a[c].dataset.pdomainid,b.avaliable=!0,b.collection={});var d=a[c].lastChild.value.trim();d&&(b.collection[decodeURIComponent(a[c].dataset.popt)]=d.split(ctrl.CRLF))}$("floatingWin").style.display="none"}
function autoGenRefBoxChange(){var a=$("agRefFieldSel"),b=$("agRefField_warning"),c=/{2,reference,(\d*)}/,d=currentBiff.attr.ag;if($("ag_refField").checked){var e=!!builder.ifAdjacent(currentBiff.x,currentBiff.y),f=0;d=(c=d.match(c))&&c[1]?parseInt(c[1]):-1;a.innerHTML="";a.appendChild(new Option("",""));for(var g in builder.cellData){var k=builder.cellData[g];if(!(k.IPType!==SELECTOR&&!k.hasAttribute("fmt_d")||k===currentBiff||k.attr.usrref||k.attr.grpref||e!==!!builder.ifAdjacent(k.x,k.y)||e&&!builder.isSameSubtable(currentBiff,
k))&&k.domainId){var l=k.domainId||k.x+"|"+k.y;k=new Option(k.value,l);a.appendChild(k);f++;c&&parseInt(l)===d&&(k.selected="selected")}}a.style.display="";b.style.display=f?"none":""}else a=$("at_ag"),a.value=removeAutoGenRefFormat(a.value),textProcessing(a),delete builder.autoGenRef[parseInt(currentBiff.domainId)]}
function autoGenRefFieldSelChange(a){a=a||$("agRefFieldSel");a=a.options[a.selectedIndex];a=a.value?parseInt(a.value):-1;at_ag=$("at_ag");0<a?(builder.autoGenRef[parseInt(currentBiff.domainId)]=a,at_ag.value=addAutoGenRefFormat(at_ag.value,a)):(at_ag.value=removeAutoGenRefFormat(at_ag.value),delete builder.autoGenRef[parseInt(currentBiff.domainId)]);textProcessing(at_ag)}
function setAutoGenRefFieldValuesSel(a){var b=$("agRefFieldValuesSel"),c=$("agRefFieldValueForSeq"),d=$("agRefFieldValuesList"),e=parseInt(a.domainId),f=builder.selections[e],g=builder.cascadedSelections[e];b.style.display="none";b.innerHTML="";b.onclick=null;b.onmousedown=null;c.style.display="none";c.value="";d.innerHTML="";a.hasAttribute("mvp")?(b.onmousedown=function(a){a.preventDefault()},b.onclick=function(){var b=a.attr.mvp.split("|"),c=b[0];b=b[1];var d=a.hasAttribute("stf")?parseInt(a.attr.stf):
-1;ctrl.callMVP=!0;initMVP(c,b,d);ctrl.callMVP=null;ctrl.autogenReferenceField=a;$("bMvpCreateNew").style.visibility="hidden";ctrl.currentController.resize()},b.style.display=""):g?(c=g.collection,(c?Object.values(c):[]).forEach(function(a){a.forEach(function(a){a=new Option(a);b.appendChild(a)})}),b.style.display=""):f?(f.forEach(function(a){a=new Option(a);b.appendChild(a)}),b.style.display=""):a.hasAttribute("fmt_d")&&(postPromise("/sims/getFieldValues.jsp",{a:ap,p:path,si:sheetIndex,d:e}).then(function(a){JSON.parse(a).forEach(function(a){var b=
node("OPTION");b.setAttribute("value",a);d.appendChild(b)})}),c.style.display="")}function callbackAutoGenRefFieldValuesMvp(a,b){if(!(!a&&0!==a&&!b||0>a)){var c=$("agRefFieldValuesSel");c.innerHTML="";if(!b&&ctrl.autogenReferenceField){var d=ctrl.autogenReferenceField;postPromise("/sims/options.jsp",{a:ap,d:d.attr.s||d.domainId,nodeId:a,stf:d.attr.stf}).then(function(a){b=a;a=new Option(a);c.appendChild(a);ctrl.autogenReferenceField=null})}b&&(a=new Option(b),c.appendChild(a))}}
function addAutoGenRefFormat(a,b){var c=/{([^{]),reference,\d*}/,d="{2,reference,"+b+"}",e=c.test(a);return b&&0<b?e?a.replace(c,d):d+(a.includes("-")?"-":"")+a:a}function removeAutoGenRefFormat(a){return a.replace(/{([^{]),reference,\d*}-*/g,"")}
function genAutoGenSample(a,b){var c=/{0,number,(.*?)}/,d=/{1,date,(.*?)}/,e=/{2,reference,(\d*)}/,f=a.match(c),g=a.match(d),k=a.match(e),l=a;l.includes("{RAGIC_ID}")&&(l=l.replace("{RAGIC_ID}","0"));l.includes("{SUBTABLE_RAGIC_ID}")&&(l=l.replace("{SUBTABLE_RAGIC_ID}","0"));f&&(a=formatNumber(1,f[1]),l=l.replace(c,a));g&&(g=g[1],c=formatDate(new Date,g),g.includes("E")&&"en"!==lm.lang&&(g=lm.DAY_NAMES.slice(0,7),a=lm.DAY_NAMES.slice(7),f=(new Date).getDay(),c=c.replace(g[f],"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ")[f]).replace(a[f],
"Sun Mon Tue Wed Thu Fri Sat".split(" ")[f])),l=l.replace(d,c));if(k){var m=parseInt(k[1]);d=builder.selections[m];k=builder.cascadedSelections[m];return b&&b.hasAttribute("mvp")?new Promise(function(a,c){getPromise("/sims/getFieldValueOfLatestEntry.jsp",{a:ap,p:path,si:sheetIndex,d:m,x:b.x,y:b.y}).then(function(b){b&&(l=l.replace(e,b));a(l)})}):d&&!k?((d=d[0]||"")&&(l=l.replace(e,d)),Promise.resolve(l)):k?(d=(d=k.collection)?Object.values(d):[],(d=d[0]&&d[0][0]?d[0][0]:"")&&(l=l.replace(e,d)),Promise.resolve(l)):
b&&b.hasAttribute("fmt_d")?(d=formatDate(new Date,b.attr.fmt_d),l=l.replace(e,d),Promise.resolve(l)):Promise.reject()}return Promise.resolve(l)}
function validateAutoGenFormat(a){var b=/{([^{]),number,(.*?)}/,c=/{([^{]),date,(.*?)}/,d=/{([^{]),reference,(.*?)}/,e=a.match(b),f=a.match(c),g=a.match(d),k="",l="",m=a;a=-1;e&&"0"!==e[1]&&(l+="number",e=e[2],m=m.replace(b,"{0,number,"+(e?e:"000")+"}"));f&&"1"!==f[1]&&(l+=(0<l.length?", ":"")+"date",b=f[2],m=m.replace(c,"{1,date,"+(b?b:"yyyyMMdd")+"}"));g&&(c=g[2],a=parseInt(c),"2"!==g[1]&&(l+=(0<l.length?", ":"")+"reference",m=m.replace(d,c?"{2,reference,"+c+"}":"")));0<l.length&&(k=lm.agFormatInvalid.replace("{0}",
l).replace("{1}",m));if(g)if(d=builder.findField(a),isNaN(a)||0>a||!d)k+=(0<k.length?"<br>":"")+lm.agRefFieldNotExist;else if(d.IPType!==SELECTOR&&!d.hasAttribute("fmt_d")||d.hasAttribute("usrref")||d.hasAttribute("grpref"))k+=(0<k.length?"<br>":"")+lm.agRefFieldInvalid;return k}
function setAutoGenPropertyTableByFormat(a){var b=a.match(/{2,reference,(\d*)}/),c=$("agRefFieldSel"),d=$("agRvcDiv"),e=$("agRefField_warning"),f=$("agFormat_warning"),g=-1,k=null;$("ag_refField").checked=b?!0:!1;if(b){g=parseInt(b[1]);b=!!builder.ifAdjacent(currentBiff.x,currentBiff.y);var l=0;c.innerHTML="";c.appendChild(new Option("",""));for(var m in builder.cellData){var n=builder.cellData[m];if(!(n.IPType!==SELECTOR&&!n.hasAttribute("fmt_d")||n===currentBiff||n.attr.usrref||n.attr.grpref||b!==
!!builder.ifAdjacent(n.x,n.y)||b&&!builder.isSameSubtable(currentBiff,n))&&n.domainId){var q=n.domainId||n.x+"|"+n.y,r=new Option(n.value,q);c.appendChild(r);l++;parseInt(q)===g&&(r.selected="selected",k=n)}}c.style.display="";e.style.display=l?"none":""}else c.style.display="none",e.style.display="none";genAutoGenSample(a,k).then(function(a){$("ex_ag").innerHTML=a}).catch(function(){});(a=validateAutoGenFormat(a))?(f.innerHTML=a,f.style.display=""):(f.innerHTML="",f.style.display="none");k&&(k.IPType===
SELECTOR||k.hasAttribute("fmt_d"))?(setAutoGenRefFieldValuesSel(k),d.style.display=""):d.style.display="none"}
function getAutoGenSeq(){var a=$("at_ag").value,b=$("agRefFieldValuesSel"),c=$("agRefFieldValueForSeq");if($("ag_refField").checked&&a.includes("{2,reference"))if(""===b.style.display){if(0>b.selectedIndex){floatWin(null,lm.chooseRefValue,"");return}var d=b.options[b.selectedIndex].value}else if(""===c.style.display&&(d=c.value,!document.querySelector('#agRefFieldValuesList option[value="'+d+'"]'))){floatWin(null,"Invalid value","");return}var e;currentBiff&&builder.isSubtable(currentBiff)&&(b=builder.findSubtableHeadField(currentBiff.x,
currentBiff.y))&&(e=b.x+","+b.y);read(function(a){$("agIsv").value=a.responseText},"/sims/seq.jsp?a="+ap+"&ag="+encodeURIComponent(a)+(d?"&rv="+d:"")+"&d="+builder.cellData[currentBiff.x+","+currentBiff.y].domainId+"&p="+path+"&si="+sheetIndex+(e?"&subtableFirstBiffXY="+encodeURIComponent(e):""))}
function setAutoGenSeq(){var a=$("at_ag").value;if($("ag_refField").checked&&a.includes("{2,reference")){a=$("agRefFieldValuesSel");var b=$("agRefFieldValueForSeq");if(""===a.style.display)var c=a.options[a.selectedIndex].value;else""===b.style.display&&(c=b.value)}read(function(a){$("agIsv").value=a.responseText;checkTheTypeOfAg()},"/sims/seq.jsp?a="+ap+"&ag="+encodeURIComponent($("at_ag").value)+(c?"&rv="+c:"")+"&isv="+$("agIsv").value+"&d="+builder.cellData[currentBiff.x+","+currentBiff.y].domainId+
"&p="+path+"&si="+sheetIndex)}function autoGenAssign(){var a={a:ap,p:path,si:sheetIndex,d:builder.cellData[currentBiff.x+","+currentBiff.y].domainId};checkRunningServiceByFormUrl(function(){ajaxget("/sims/mass/assign/autoGenAssign.jsp",a,function(a){eval(a)})})}
function modifyBarcodePic(){var a="/sims/barcode.jsp?source=web1&bc_type="+(currentBiff&&currentBiff.attr.bc_type?currentBiff.attr.bc_type:"QR Code")+"&content=content&ifAppendText="+$("bc_append_text").checked;if($("bc_example_pic"))$("bc_example_pic").src=a;else{var b=node("IMG");b.style["max-height"]="200px";b.id="bc_example_pic";b.src=a;$("bc_example_pic_container").appendChild(b)}}
function initActionBarcode(){var a=$("at_bc_action"),b;for(b in builder.actionButtons){var c=node("option"),d=builder.actionButtons[b];c.value=d.id;c.innerHTML=d.name;a.options.add(c)}}
function noDupBoxChange(a){var b=currentBiff;!a.checked&&b.domainId?getPromise("/sims/checkIfLinkedByOtherFields.jsp",{a:ap,di:b.domainId}).then(function(c){var d=JSON.parse(c);c=d.msg;"error"===d.status?a.checked=!0:c?(d=b.value,c='<div style="line-height:1.5;padding:0 10px;min-width:500px;max-width:800px;">'+c.replace(/\{0\}/g,d)+lm.noDup_cannotRemove.replace(/\{0\}/g,d)+"</div>",floatWinWarning(c),a.checked=!0):boxChange(a)}):boxChange(a)}
function boxChange(a){var b=currentBiff,c=b.attr[a.name],d=a.checked;builder.setAttribute(b.x,b.y,a.name,d);"noDup"===a.name&&a.checked&&b.domainId&&getPromise("/sims/checkIfNoDup.jsp",{a:ap,di:b.domainId,f:b.IPType===UPLOADER||b.IPType===GRAPHICS,rdi:builder.rootDomainId}).then(function(a){var b=JSON.parse(a);a=b.dupValue;b.noDup||(b=node("DIV"),b.style.maxWidth="700px",b.style.lineHeight="1.8",b.innerHTML=lm.noDup_duplicateWarning.replace("{0}",a),floatWin(null,b))});"at_utcTime"===a.id&&(!c&&d?
floatWinWarning(lm.utcTime_Warning):c&&!d&&floatWinWarning(lm.utcTimeNone_Warning));return!0}function changeInputType(a){var b=currentBiff;b.IPType=a;b.render();deleteInvalidListeningLinks(b.domainId)}function formBoxChange(a,b){builder[b]=a.checked}
function rmdChange(){if(null===$("at_fmt_d").value||""===$("at_fmt_d").value)return!0;var a=currentBiff,b=$("at_rmd"),c=$("at_rmd_b");c=c.options[c.selectedIndex].value;$("at_setRmd").checked?builder.setAttribute(a.x,a.y,b.name,"1"===c?b.value:-b.value):builder.setAttribute(a.x,a.y,b.name,null);return!0}
function switchDVFormula(){var a=currentBiff;if(a&&a.hasOwnProperty("attr")){var b=builder.selections[a.domainId]||builder.selections[a.x+"|"+a.y]||a.IPType===SELECTOR&&!a.hasAttribute("s")&&!a.hasAttribute("mvp")&&!a.hasAttribute("stf"),c=$("at_use_dv_f").checked,d=$("at_dv_sel"),e=$("at_dv_text"),f=$("at_dv_f_text");if(a.IPType!==MSELECTOR||!c){if(b){b=d.options[d.selectedIndex];if(c&&""===d.style.display&&!b.value){d.style.display="none";f.style.display="";return}if(!c&&""===f.style.display&&!f.value){d.style.display=
"";f.style.display="none";return}}else if(c&&""===e.style.display){e.style.display="none";f.style.display="";if(""===e.value)return;f.value=e.value}else if(!c&&""===f.style.display){e.style.display="";f.style.display="none";if(""===f.value)return;e.value=f.value}var g;c&&!a.hasAttribute("dv_f")?(builder.setAttribute(a.x,a.y,"dv_f",decHTML(a.attr.dv)||""),a.hasAttribute("dv_f")||(g=!0)):!c&&a.hasAttribute("dv_f")&&(""!==f.value&&(a.attr.dv=encHTML(f.value)),delete a.attr.dv_f,delete a.attr.fdom);g||
setPropertyTable(nui._curcell())}}}function setOwner(a,b){currentBiff.attr[b]=a.checked?"1":"2"}function setAttrByChecked(a,b){a.checked?currentBiff.attr[b]=1:delete currentBiff.attr[b]}
function makeMultipleSelect(a){currentBiff.hasAttribute("mvp")||currentBiff.mvp?(changeInputType(a.checked?MSELECTOR:SELECTOR),$("at_mvpMulti").checked&&$("at_mvpMulti").click()):currentBiff.IPType=a.checked?MSELECTOR:SELECTOR;$("at_f")&&($("at_f").disabled=currentBiff.IPType===MSELECTOR);if(a=$("at_use_dv_f"))a.checked&&a.click(),a.disabled=currentBiff.IPType===MSELECTOR}
function setDefaultValueUser(a){var b=$("at_dv_text"),c=$("show_dv");a.checked?(b.value="$USERNAME",rm(c),c.appendChild(document.createTextNode("$USERNAME"))):(b.value="",rm(c),c.appendChild(document.createTextNode(lm.notSet)));textProcessing(b);b.focus()}
function setStylePane(a){if(a&&a.styling){if(builder.doingCopyStyle)try{var b=nui._curcell().ip.biff;for(c in b.styling)builder.setStyle(b.x,b.y,c,"",!0);if("F"!==b.objectType)for(c in builder.copiedStyles)builder.setStyle(b.x,b.y,c,builder.copiedStyles[c],!0);else for(c in builder.copiedStyles)c.startsWith("V")||builder.setStyle(b.x,b.y,c,builder.copiedStyles[c],!0);builder.keepCopying||(builder.copiedStyles={},builder.doingCopyStyle=!1)}catch(d){}"B"===a.objectType?(b=$("propTab9"),"propTab9"===
ctrl.currentTabContent&&(b.style.display=""),rm(b),b.appendChild(genStyleSettingPanel(a)),b.appendChild(genStyleSettingPanel(a,"V")),b.appendChild(genStyleCopyPanel(a)),b.appendChild(genCustThemePanel(a)),b.appendChild(genLargeInvisible("#f3f3f3"))):(b=$("descSetting"),b.style.display="",rm(b),b.appendChild(genStyleSettingPanel(a)),b.appendChild(genStyleCopyPanel(a)),b.appendChild(genCustThemePanel(a)));if(a.styling.fontFamily&&$("bFamily")){var c=$("bFamily");for(b=0;b<c.options.length;b++)c.options[b].value==
a.styling.fontFamily&&(c.selectedIndex=b)}}}
function initActionButtonDrag(){var a=$("actionButtonDragCol1"),b=$("actionButtonDragCol2");if(!builder.actionButtons||builder.ifListingPage())$("actionButtonDragLabel").style.display="none",rm(a),rm(b);else{$("actionButtonDragLabel").style.display="";rm(a);rm(b);var c=0,d;for(d in builder.actionButtons){var e=builder.actionButtons[d],f=node("div",null,"fieldAdder addField addActionButtonField");f.setAttribute("type","DESC");f.setAttribute("defaultName",e.name);f.actionButton=e;f.actionButtonId=e.id;
f.innerHTML=e.name;(0===c%2?a:b).appendChild(f);c++}}}
function builderHelperPanelSwitch(a){switch(a){case 1:$("addField").style.display="";$("prop").style.display="none";$("formSetting").style.display="none";$("descSetting").style.display="none";$("designHelperMode1").className="selectedDesignHelperMode";$("designHelperMode2").className="";$("designHelperMode3").className="";break;case 2:$("addField").style.display="none";builder.mode==BUILDER_FIELDS?($("prop").style.display="",$("descSetting").style.display="none"):($("prop").style.display="none",$("descSetting").style.display=
"");$("formSetting").style.display="none";$("designHelperMode1").className="";$("designHelperMode2").className="selectedDesignHelperMode";$("designHelperMode3").className="";break;case 3:$("addField").style.display="none",$("prop").style.display="none",$("formSetting").style.display="",$("bRights").onclick(),$("descSetting").style.display="none",$("designHelperMode1").className="",$("designHelperMode2").className="",$("designHelperMode3").className="selectedDesignHelperMode"}}
function changeToFreePlan(a){a={ap:a};for(var b=[],c=[],d=$("selectedSheets"),e=0;e<d.options.length;e++){var f=d.options[e];if(f.classList.contains("sheet_option")){var g={};g.path=f.dataset.path;g.sheetIndex=f.dataset.sheetIndex;b.push(g)}else f.classList.contains("report_option")&&c.push(f.dataset.reportId)}a.sheetPaths=JSON.stringify(b);a.reports=c;floatWin(null,lm.processing,"",!0);ajaxpost("/sims/modifyPlanToFree.jsp?",a,function(a){floatWin(null,a,"",!0)})}
function selectSheet(a,b){var c=$("selectableSheets"),d=$("selectedSheets");if(b)for(b=0;b<d.options.length;b++){var e=d.options[b];e.selected&&(e.selected=!1,d.removeChild(e),b--,c.appendChild(e))}else for(b=0;b<c.options.length;b++)if(e=c.options[b],e.selected)if(e.selected=!1,d.options.length>=a){alert(lm.exceedUpperLimitAlert);break}else if(c.options[b].classList.contains("invalid_sheet_option")){alert(lm.invalidSheetAlert);break}else c.removeChild(e),b--,d.appendChild(e)}
function listingFieldSelector(a){var b=$("formFieldOptions"),c=$("listingFieldOptions");if(a)for(a=0;a<c.options.length;a++){var d=c.options[a];d.selected&&(d.selected=!1,c.removeChild(d),a--,b.appendChild(d))}else for(a=0;a<b.options.length;a++)d=b.options[a],d.selected&&(d.selected=!1,b.removeChild(d),a--,c.appendChild(d))}
function listingFieldSelectorMove(a){var b=$("listingFieldOptions"),c=[];if(a)for(a=b.options.length-1;0<=a;a--){var d=b.options[a];if(d.selected&&!c.includes(d)){if(a>=b.options.length-1)break;b.insertBefore(b.options[a+1],b.options[a]);c.push(d)}}else for(a=0;a<b.options.length;a++)if(d=b.options[a],d.selected&&!c.includes(d)){if(0>=a)break;b.insertBefore(b.options[a],b.options[a-1]);c.push(d)}}
function insertReferencedSubtable(){var a=$("listingFieldOptions");if(a&&a.options)if(2>a.options.length)floatWin(null,lm.prop_youNeedAtLeast2FieldsFromTheOtherSheetToFormASubtable);else{builder.mode=BUILDER_FIELDS;for(var b=0;b<ctrl.NUIColNum;b++)builder.setField(nui.fcol+b,nui.frow,null);b=$("keyField");var c=$("parentAlias");b&&-1!==b.value&&(builder.subtableKeys[nui.fcol+","+nui.frow]=parseInt($("keyField").value));c&&-1!==c.value&&(builder.subtableAliasParents[nui.fcol+","+nui.frow]=parseInt($("parentAlias").value));
for(b=0;b<a.options.length;b++){var d=a.options[b];c=d.getAttribute("value");builder.setField(nui.fcol+b,nui.frow,d.innerHTML);builder.setAttribute(nui.fcol+b,nui.frow,"rf",d.value);builder.setAttribute(nui.fcol+b,nui.frow,"it",d.getAttribute("it"));builder.copyAttribute(nui.fcol+b,nui.frow,d.getAttribute("attr"),null,["noDup"]);if(d.hasAttribute("lov")){var e=d.getAttribute("lov");d=d.getAttribute("cascaded");e&&(e=e.replace(/`/g,ctrl.CRLF),d?addCascadedSelectionFromLOV(e,c,d):builder.setAttribute(nui.fcol+
b,nui.frow,"lov",e))}builder.setAttribute(nui.fcol+b,nui.frow,"noclone",!0)}builder.renderAll();builder.syncCurrentCellData();setPropertyTable(nui._curcell())}}
function addRefSubtableComponent(){read(function(a){var b=$("f_subtable_ref_drag_component");b.innerHTML=a.responseText;var c=builder.subtableKeys,d=builder.subtableAliasParents;b.querySelectorAll(".linkedTarget").forEach(function(a,b){b=a.querySelectorAll(".addField");var e=b.length,f=0;b.forEach(function(b){var g=parseInt(b.dataset.keyfield)||-1,k=parseInt(b.dataset.parentalias)||-1,l;for(l in c){var r=d[l];if(c[l]===g&&((isNaN(r)||-1===r)&&k===builder.rootDomainId||k===r)){builder.cellData[l]&&
(a.removeChild(b),f++);break}}e===f&&(a.style.display="none")})});positionFloatWin($("addRefSubtableDiv"))},"/sims/addRefSubtableComponent.jsp?a="+ap+"&ltd="+builder.rootDomainId)}
function createNewFormFromSubtable(){window.noMoreCreate?floatWin(null,window.sheetLimitMsg):"/ragic-setup"===path?floatWin(null,lm.prop_createNewSheetDisabledForSystemSheets):(floatWin(null,lm.prop_loading,lm.prop_createNewFormFromSubtable,!0),postPromise("/sims/createSheetFromSubtable.jsp",{a:ap,p:path,fn:sheet}).then(function(a){floatWin(null,a,lm.prop_createNewFormFromSubtable,!0)}))}
function createSubtableFromForm(){$("addRefSubtableDiv").style.display="";$("f_subtable_ref_drag").style.display="";addRefSubtableComponent();var a=builder.maxY;a=builder.cellData["1,"+a]&&builder.ifAdjacent(1,a)?a+5:a+2;nui._focus(1,a)}
function recalFormulaConfirm(a,b){var c=!1,d,e;a?$("recalIgnoreFF")&&$("recalIgnoreFF").checked?checkRunningServiceByFormUrl(function(){recalFormula(b,!0)}):checkRunningServiceByFormUrl(function(){recalFormula(b,!1)}):getPromise("/sims/isFixedFilterSet.jsp",{a:ap,p:path,si:sheetIndex}).then(function(a){"true"==a&&(c=!0);d=c?'<div style="line-height:20px;">'+lm.formulaRecalStart+"<br><br>"+lm.formulaRecalIfIgnoreFF+'<br><div style="margin-top:7px;"><input type="radio" id="recalNoIgnoreFF" name="ifIgnoreFF" checked><label for="recalNoIgnoreFF" style="margin-left:3px;">'+
lm.formulaRecalNoIgnoreFF+'</label></div><div style="margin-top:7px;"><input type="radio" id="recalIgnoreFF" name="ifIgnoreFF"><label for="recalIgnoreFF" style="margin-left:3px;">'+lm.formulaRecalIgnoreFF+"</label></div></div>":lm.formulaRecalStart;e=b?lm.formulaRecalAll:lm.formulaRecal;floatWinConfirmV3(d,function(){recalFormulaConfirm(!0,b)},null,null,null,e)})}
function recalFormula(a,b){inNUI();var c={a:ap,p:path,fn:sheet,c:builder.createNUI(),act:"formulaCal"};a?c.order=JSON.stringify(builder.formulaRel.getOrder()):(c.d=currentBiff.domainId,c.cn=getCellName(currentBiff.x,currentBiff.y));builder.ifListingPage()?c.suf="_index_t.nui":c.suf=builder.level3?"_"+builder.level3+".nui":"_index.nui";b&&(c.ignoreff=b);postPromise("/sims/entriesIterating.jsp",c).then(updateSystemTaskProgress)}
function entryManagerReassign(){postPromise("/sims/mass/assign/entryManagerReassign.jsp",{a:ap,p:path,si:sheetIndex}).then(updateSystemTaskProgress)}function guestUserReassign(){postPromise("/sims/mass/assign/guestUserReassign.jsp",{a:ap,p:path,si:sheetIndex}).then(updateSystemTaskProgress)}
function toggleDefaultSeparator(){var a=$("dsBox"),b=$("number_separator"),c=$("at_fmt_n_ds"),d=$("at_fmt_n_ts"),e=$("separator_warn");a.checked?(b.style.color="#808080",c.disabled=!0,d.disabled=!0,c.value=".",d.value=",",rm(e),e.style.display="none",separatorProcessing()):(b.style.color="",c.disabled=!1,d.disabled=!1)}
function separatorProcessing(){var a=$("at_fmt_n_ds"),b=$("at_fmt_n_ts"),c=b.value,d=a.value,e=$("separator_warn");if(d&&c)if(d==c)e.innerHTML=lm.separatorWarn_same,e.style.display="";else{var f=currentBiff;if(f){var g=f.attr.fmt_n_ts||",",k=f.attr.fmt_n_ds||".",l=$("at_fmt_n"),m=l.value;e.style.display="none";if(d!=k||c!=g){convertFormatSampleBySeparator();e=m.split(";");g=e[0];for(m=k=0;m<g.length;m++){var n=g.charAt(m);0!==k||"#"!==n&&"0"!==n?"#"!==n&&"0"!==n&&(1===k?(g=g.replaceAt(m,c),k++):2===
k&&(g=g.replaceAt(m,d),k++)):k=1}m=g+(1<e.length?";"+e[1]:"");l.value=m;$("ex_fmt").innerHTML=formatNumber("12345.67",m,c,d);builder.setAttribute(f.x,f.y,l.name,l.value);"."===d&&","===c?(builder.setAttribute(f.x,f.y,a.name,null),builder.setAttribute(f.x,f.y,b.name,null)):(builder.setAttribute(f.x,f.y,a.name,a.value),builder.setAttribute(f.x,f.y,b.name,b.value))}}}else e.innerHTML=lm.separatorWarn_empty,e.style.display=""}
function convertFormatSampleBySeparator(){var a=$("at_fmt_n_ds"),b=$("at_fmt_n_ts");a=a.value;b=b.value;var c=$("fmt_n_sample").options,d=0;var e=c[d++];e.innerHTML="0";e.value="0";e.setAttribute("sample","12345");e=c[d++];e.innerHTML="0"+a+"00";e.value="0"+a+"00";e.setAttribute("sample","12345"+a+"60");e=c[d++];e.innerHTML="#"+b+"###";e.value="#"+b+"###";e.setAttribute("sample","12"+b+"345");e=c[d++];e.innerHTML="#"+b+"##0";e.value="#"+b+"##0";e.setAttribute("sample","12"+b+"345");e=c[d++];e.innerHTML=
"#"+b+"##0"+a+"00";e.value="#"+b+"##0"+a+"00";e.setAttribute("sample","12"+b+"345"+a+"60");e=c[d++];e.innerHTML="$#"+b+"###";e.value="$#"+b+"###";e.setAttribute("sample","$12"+b+"345");e=c[d++];e.innerHTML="#"+b+"###"+a+"##";e.value="#"+b+"###"+a+"##";e.setAttribute("sample","12"+b+"345"+a+"6");e=c[d++];e.innerHTML="$#"+b+"###"+a+"##";e.value="$#"+b+"###"+a+"##";e.setAttribute("sample","$12"+b+"345"+a+"6");e=c[d++];e.innerHTML="#"+b+"###"+a+"##;(#)";e.value="#"+b+"###"+a+"##;(#)";e.setAttribute("sample",
"(12"+b+"345"+a+"6)");e=c[d++];e.innerHTML="0%";e.value="0%";e.setAttribute("sample","34%");e=c[d++];e.innerHTML="0"+a+"00%";e.value="0"+a+"00%";e.setAttribute("sample","34"+a+"50%")}
var maxFileSizeProcessing=debouncedFn(100,function(a){var b=currentBiff,c=b.IPType===GRAPHICS?"#f_image":"#f_f_extensions",d=document.querySelector(c+" #at_maxFileSize_number"),e=document.querySelector(c+" #at_maxFileSize_unit").value;a=parseFloat(a.value);if(!Number.isNaN(a))if(c=document.querySelector(c+" #at_maxFileSize"),a>parseInt(d.dataset.max))d.parentNode.classList.add("exceedFileMaxSizeError");else{d.parentNode.classList.remove("exceedFileMaxSizeError");switch(e){case "B":c.value=a;break;
case "KB":c.value=1024*a;break;case "MB":c.value=1048576*a;break;case "GB":c.value=1073741824*a}builder.setAttribute(b.x,b.y,"maxFileSize_number",a+"");builder.setAttribute(b.x,b.y,"maxFileSize",c.value+"");builder.setAttribute(b.x,b.y,"maxFileSize_unit",e)}});function outNUI(){ctrl.outOfNUI=!0}function inNUI(){ctrl.outOfNUI=!1}
function showFieldDesignHistory(a){var b=$("fieldDesignHistoryContainer"),c=$("moreFieldDesignHistory");a={a:ap,p:path,si:sheetIndex,d:b.dataset.di,rd:b.dataset.rdi,all:a};var d=node("I");d.classList.add("fa");d.classList.add("fa-spinner");d.classList.add("fa-spin");var e=c.parentElement;e.removeChild(c);e.appendChild(d);getPromise("/sims/fieldDesignHistory.jsp",a).then(function(a){b.innerHTML=a})}function ifSystemFieldFixedDesign(a){a=parseInt(a.domainId);return 1E6>a&&17!=a}
function removeLoadedAttrs(a,b){if(a&&b){var c=builder.cellData[a+","+b];c&&c.attr&&(delete c.attr.l,delete c.attr.vd,(a=nui._getcellV2(a,b))&&setPropertyTable(a))}}function checkNumberFormat(a){var b={f:a.attr.fmt_n,t:(new Date).getTime()};a.hasAttribute("fmt_n_ts")&&(b.ts=a.attr.fmt_n_ts);a.hasAttribute("fmt_n_ds")&&(b.ds=a.attr.fmt_n_ds);getPromise("/sims/checkNumberFormat.jsp",b).then(function(a){JSON.parse(a).valid?$("fmt_warning").style.display="none":$("fmt_warning").style.display=""})}
function checkDateFormatIsValidForUTCTime(a){var b=$("at_utcTime");if(b&&a.hasAttribute("fmt_d")){var c=a.attr.fmt_d,d=c.includes("y")||c.includes("M")||c.includes("E");c=c.toUpperCase().includes("H");d&&!c?(b.checked=!1,b.disabled=!0):(b.checked=!!a.attr.utcTime,b.disabled=!1)}}
function showPercentageProgressBar(a){var b=currentBiff;$("f_percentBar_setting").style.visibility=a.checked?"visible":"hidden";b&&(builder.setAttribute(b.x,b.y,"show_percentBar",a.checked),a.checked&&!b.attr.percentBar&&(currentBiff.multiRangeSlider=new MultiRangeSlider,builder.setAttribute(b.x,b.y,"percentBar",currentBiff.multiRangeSlider.toString())))}
function setPercentageProgressBar(){if(currentBiff){var a={};a.rawData=currentBiff.attr.percentBar;currentBiff.multiRangeSlider=new MultiRangeSlider(a);a=currentBiff.multiRangeSlider.render();a=h("div",{style:"margin-bottom: 50px; padding: 0 70px 70px 70px;"},[h("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"50px"}},[h("div",{id:"percentageProgressReset",class:"round-fluctuate-btn",callback:function(a){a.addEventListener("pointerdown",currentBiff.multiRangeSlider.reset.bind(currentBiff.multiRangeSlider));
a.addEventListener("mouseenter",showTooltip.bind(null,a));a.addEventListener("mouseleave",hideTinyTooltip)}},h("i",{class:"fas fa-redo"}))]),a]);floatWinSubmit(a,savePercentageProgressBar,null,null,null,lm.percentageProgressBar)}}function savePercentageProgressBar(){currentBiff&&builder.setAttribute(currentBiff.x,currentBiff.y,"percentBar",currentBiff.multiRangeSlider.toString())}var setImageWidth=debouncedFn(500,function(a){builderSetAttribute(a)}),setImageHeight=debouncedFn(500,function(a){builderSetAttribute(a)});
function builderSetAttribute(a){if(mode===BUILDER&&a){var b=currentBiff,c=a.value;b&&builder.setAttribute(b.x,b.y,a.name,c)}}window.userProperties||resetUserProperties();
var tutorial={startMode:0,chapter:null,steps:null,videos:null,initedChapter:[],doneChapter:[],enabled:!1,systemLoad:!1,setTuDbName:function(a){RagicStorage.localStorage.setItem("tuDbName",a)},getTuDbName:function(){return getStorage("tuDbName")},setChapter:function(a){(this.chapter=a)?RagicStorage.localStorage.setItem("chapter",a):RagicStorage.localStorage.removeItem("chapter")},getChapter:function(){if(this.chapter)return this.chapter;var a=getStorage("chapter");return a?a:null},setInitedChapter:function(){var a=
this.getInitedChapter(),b=this.getChapter();a.length?-1===a.indexOf(b)&&(this.initedChapter.push(b),saveUserProperties("initedChapter",this.initedChapter.join("|"))):saveUserProperties("initedChapter",b)},getInitedChapter:function(){window.userProperties&&window.userProperties.initedChapter&&(this.initedChapter=window.userProperties.initedChapter.split("|"));return this.initedChapter},setDoneChapter:function(){var a=this.getDoneChapter(),b=this.getChapter();a.length?-1===a.indexOf(b)&&(this.doneChapter.push(b),
saveUserProperties("doneChapter",this.doneChapter.join("|"))):saveUserProperties("doneChapter",b)},getDoneChapter:function(){window.userProperties&&window.userProperties.doneChapter&&(this.doneChapter=window.userProperties.doneChapter.split("|"));return this.doneChapter},getEnabled:function(){return this.enabled?!0:"true"==getStorage("tutEnabled")},setEnabled:function(a){this.enabled=a;RagicStorage.localStorage.setItem("tutEnabled",a)},isSystemLoad:function(){return this.systemLoad?!0:"true"==RagicStorage.localStorage.getItem("systemLoad")},
setSystemLoad:function(a){this.systemLoad=a;RagicStorage.localStorage.setItem("systemLoad",a)},getCurrentStep:function(){return getStorage("tutStep")},setCurrentStep:function(a){RagicStorage.localStorage.setItem("tutStep",a)},nextStep:function(a){if(a==tutorial.steps.length-1){this.setDoneChapter();_tutorialLeave();a=!1;try{a=null!==window.opener&&null!==window.opener.RAGIC}catch(b){}a&&!isFreeDistr&&(window.opener.location.href="/"+ap+"/start");return!1}tutorial.setCurrentStep(parseInt(a)+1);return!0},
isEditionLimited:function(){if("FREE2"===window.edition||"LITE2"===window.edition){var a=0,b;for(b in accountProfile)"/ragic-setup"!==b&&(a+=Object.keys(accountProfile[b].nuiFiles).length);if("FREE2"===window.edition){if(3<=a)return floatWin(null,lm.limitFreeFeature.replace(/\{0\}/,ap)),!0}else if(5<=a)return floatWin(null,lm.limitLiteFeature.replace(/\{0\}/,ap)),!0}return!1},refreshCheckFunc:function(){return delay(5).then(function(){tutorial.getEnabled()&&"1"===getStorage("tutExited")&&(RagicStorage.localStorage.setItem("tutExited",
"0"),tutorial.isSystemLoad()?tutorial.setSystemLoad(!1):_tutorialLeave())})}};function getDemoPath(){var a,b;for(b in accountProfile)if("/ragic-setup"!==b){for(var c in accountProfile[b].nuiFiles)c.includes("Sheet")&&(a=b+"/"+c.split("_")[0]);if(a)break}return a}function checkVideoNumber(){return document.querySelector(".turVideoContainer ").querySelectorAll(".turMedia").length}
function getVideo(a){a&&getPromise("/sims/macro/video_"+a+".jsp",{}).then(eval).then(function(){var a=document.createElement("div");a.classList.add("turVideoContainer","achRightDiv");a.style.display="none";var c=document.createElement("div"),d=document.createElement("span"),e=document.createElement("span"),f=document.createElement("i");f.classList.add("fas","fa-chalkboard-teacher");d.textContent=lm.videoTutorial;c.classList.add("divDescPart");e.style.margin="6px 8px 0 0";e.style["font-size"]="15px";
e.style.float="left";a.appendChild(c);e.appendChild(f);c.appendChild(e);c.appendChild(d);tutorial.videos.filter(function(a){return!RagicStorage.localStorage.getItem("removeTurVideo_"+a.url)}).forEach(function(b){var c=document.createElement("div"),d=document.createElement("video"),e=document.createElement("a"),f=document.createElement("i"),g=document.createElement("a"),r=document.createElement("i"),p=document.createElement("a"),t=document.createElement("i");c.appendChild(d);c.classList.add("turMedia");
d.src=b.url;d.setAttribute("controls","");a.appendChild(c);f.classList.add("fas","fa-external-link","file-features");e.appendChild(f);r.classList.add("far","fa-cloud-download","file-features");g.appendChild(r);t.classList.add("far","fa-times","file-features");p.appendChild(t);e.href="javascript: void(0);";g.href="javascript: void(0);";p.href="javascript: void(0);";e.onclick=function(){window.open(b.url)};g.onclick=function(){window.open(b.url+"&force")};p.onclick=function(){var a=this.closest(".turMedia"),
b=a.querySelector("video").src;console.log(b);a.parentNode.removeChild(a);0===checkVideoNumber()&&(document.querySelector(".turVideoContainer ").style.display="none");RagicStorage.localStorage.setItem("removeTurVideo_"+b,"X")};c.appendChild(e);c.appendChild(g);c.appendChild(p)});document.querySelector(".achRightDivContainer").appendChild(a);0<checkVideoNumber()&&(a.style.display="")})}
function tutorialStart(a,b){if(a=a||tutorial.getChapter()){var c=0;"001"===a||"002"===a?c=1:"003"===a&&(c=2);window.maxSheets-window.activeSheetCount<c?floatWin(null,lm.tutorialQuota.replace(/\{0\}/,c)):(tutorial.setChapter(a),b&&(tutorial.startMode=b),a=getPromise("/sims/macro/basic_"+a+".jsp",{t:(new Date).getTime()}).then(eval),floatWinClose(),b=$("docWinMiddle"),b.style.bottom="-500px",b.setAttribute("displayed",!1),a.then(function(){if(2===tutorial.startMode){var a=tutorial.getTuDbName(),b;a||
(a="Sales");var c=Promise.resolve("");getTuDb(a)||(tutorial.setTuDbName(a),c=postPromise("/sims/appUpdate.jsp",{a:ap,nn:a,msi:menuSetIndex}).then(eval));return c.then(function(){b=getTuDb(a).id.replace("pathTab","");var c=$("pathDrop"+b);setCookie("newSheet",a+(Math.floor(c.children.length/2)+1));location.href="/"+ap+b;return delay(50)})}if(3===tutorial.startMode){tutorial.setSystemLoad(!0);c=RagicStorage.localStorage.getItem("DROPBOX_INSPATH");var g=RagicStorage.localStorage.getItem("DROPBOX_INSSHEETINDEX");
RagicStorage.localStorage.removeItem("DROPBOX_INSPATH");RagicStorage.localStorage.removeItem("DROPBOX_INSSHEETINDEX");location.href="/"+ap+c+"/"+g}return""}).then(function(){RagicStorage.localStorage.setItem("tutExited","0");tutorial.setEnabled(!0);tutorial.setCurrentStep(0);document.documentElement.scrollTop=0;tutorialShow()}))}}function tutorialShow(){tutorial.getChapter()&&tutorial.getEnabled()&&delay(90).then(_tutorialShow)}
function _tutorialShow(){resetScreen();tutorial.steps&&checkTutorialSteps().then(function(){var a=tutorial.steps[tutorial.getCurrentStep()];if(a.delay){var b=a.delay;a.delay=null;return delay(b,a)}return a}).then(function(a){mode===BUILDER&&inNUI();a.preload&&a.preload();if(a.actionObj1){if("_"===a.actionObj1.charAt(0)){var b=a.actionObj1.split("_");b=nui._getcell(b[1],b[2])}else b=$(a.actionObj1);b&&b.focus&&(ctrl.isIE||b.focus())}a.finishCheck?a.actionObj1?tutorialAction():tutorialFreeAction():
a.pickOption1?tutorialPick():tutorialPrompt()})}function tutorialLeave(){$("tutorialPick").style.display=""}
function _tutorialLeave(){ctrl.tooltipLock=!1;tutorial.setInitedChapter();RagicStorage.localStorage.setItem("tutExited","1");tutorial.setEnabled(!1);tutorial.setCurrentStep(0);tutorial.steps=null;tutorial.setChapter(null);clearBlock();1!==tutorial.startMode&&(ctrl.tutNoGoStart||isFreeDistr?(3===tutorial.startMode&&setTimeout(function(){location.href="/"+ap+"/apps/dropbox/manage"},1E3),ctrl.tutNoGoStart=!1):(mode===BUILDER&&saveBuilder(),location.href!==location.origin+"/"+ap+"/start"&&window.setTimeout(function(){location.href=
"/"+ap+"/start"},1E3)))}function checkTutorialSteps(){var a=Promise.resolve("");tutorial.steps||null==tutorial.getChapter()||(a=getPromise("/sims/macro/basic_"+tutorial.getChapter()+".jsp").then(eval));return a}window.addEventListener("beforeunload",function(){tutorial&&tutorial.getEnabled()&&RagicStorage.localStorage.setItem("tutExited","1")});
function clearBlock(){$("tutBlock").style.opacity=0;$("tutBlock_u").style.opacity=0;$("tutBlock_r").style.opacity=0;$("tutBlock_d").style.opacity=0;$("tutBlock_l").style.opacity=0;$("tutBlock_m1").style.opacity=0;$("tutBlock_m2").style.opacity=0;$("tutBlock_m3").style.opacity=0;$("tutorialAction").style.opacity=0;$("tutorialAction2").style.opacity=0;$("tutorial").style.opacity=0;$("tutorialPick").style.opacity=0;window.setTimeout(resetScreen,1E3)}
function resetScreen(){$("tutorial").style.background=null;$("diamond").style.background=null;$("diamond").style.border=null;$("tutorial").style.height="auto";$("tutorial").style.width="350px";$("tutBlock").style.display="none";$("tutBlock_u").style.display="none";$("tutBlock_r").style.display="none";$("tutBlock_d").style.display="none";$("tutBlock_l").style.display="none";$("tutBlock_m1").style.display="none";$("tutBlock_m2").style.display="none";$("tutBlock_m3").style.display="none";$("tutorialAction").style.display=
"none";$("tutorialAction2").style.display="none";$("tutorial").style.display="none";$("tutorialPick").style.display="none";$("tutBlock").style.opacity=.2;$("tutBlock_u").style.opacity=.2;$("tutBlock_r").style.opacity=.2;$("tutBlock_d").style.opacity=.2;$("tutBlock_l").style.opacity=.2;$("tutBlock_m1").style.opacity=.2;$("tutBlock_m2").style.opacity=.2;$("tutBlock_m3").style.opacity=.2;$("tutorialAction").style.opacity=1;$("tutorialAction2").style.opacity=1;$("tutorial").style.opacity=1;$("tutorialPick").style.opacity=
1}function tutorialProgress(){tutorial.getChapter()&&tutorial.getEnabled()&&checkTutorialSteps().then(function(){tutorial.nextStep(tutorial.promptStep);tutorialShow()})}
function pageloadCheckTutorial(){if(!embed&&!ifMobile&&!newUserSkipTutorial)if("1"==getStorage("tutExited")||tutorial.getEnabled()||tutorial.getInitedChapter().length)"?tutorial"==location.search?tutorialStart():tutorial.getEnabled()&&tutorialCheckProgress();else if(owner){var a=getStorage("turVideo");a?getVideo(a):tutorialStart("intro")}else"#gotutorial000b"==location.hash||"#gotutorial000c"==location.hash?(a=getDemoPath())&&0<a.length?"#gotutorial000b"==location.hash?location.href="/"+ap+a+"#tutorial000b":
"#gotutorial000c"==location.hash&&(location.href="/"+ap+a+"#tutorial000c"):location.href="/"+ap:"#tutorial000b"==location.hash?tutorialStart("000b"):"#tutorial000c"==location.hash?tutorialStart("000c"):groupNodeIds.includes("REGISTERED")&&(groupNodeIds.includes("USER")?tutorialStart("000b"):groupNodeIds.includes("X-USER")&&tutorialStart("000c"))}
function tutorialCheckProgress(){tutorial&&tutorial.getChapter()&&tutorial.getEnabled()&&(window.removeEventListener("load",tutorial.refreshCheckFunc),window.addEventListener("load",tutorial.refreshCheckFunc),checkTutorialSteps().then(function(){tutorial.steps[tutorial.getCurrentStep()].finishCheck&&setTimeout(_tutorialCheckProgress,400)}))}
function _tutorialCheckProgress(){if(tutorial.getEnabled()){var a=tutorial.getCurrentStep(),b=tutorial.steps[a];try{if(!b.finishCheck)return;if(!b.finishCheck()){mode===BUILDER&&b.startNUI&&(builder.refreshStartNUI(b.startNUI),builder.loadFromStartNUI(),builder.setDesignHelperStatus(b.startDesignHelper));return}}catch(e){return}if(b.actionObj1){if("_"===b.actionObj1.charAt(0)){var c=b.actionObj1.split("_");var d=nui._getcell(c[1],c[2])}else d=$(b.actionObj1);d&&d.blur&&(ctrl.isIE&&"_"===b.actionObj1.charAt(0)||
d.blur(),"_"===b.actionObj1.charAt(0)&&nui._move(c[1]-nui.fcol,c[2]-nui.frow))}tutorial.nextStep(a);tutorialShow()}}function ifTutorialInited(a){for(var b=tutorial.getInitedChapter(),c=0;c<b.length;c++)if(a==b[c])return!0;return!1}function doneTutorialCheck(){for(var a=tutorial.getDoneChapter(),b,c=0;c<a.length;c++)if(b=document.getElementById("step"+a[c]))b.style.color="#BBB"}
function tutorialPick(){var a=tutorial.getCurrentStep(),b=tutorial.steps[a];tutorial.promptStep=a;a=$("tutorialPick");$("tutorialPickText").innerHTML=b.prompt;$("tutorialPickOption1").innerHTML=b.pickOption1;$("tutorialPickOption2").innerHTML=b.pickOption2;$("tutorialPickOption1").onclick=b.pickOption1Action;$("tutorialPickOption2").onclick=b.pickOption2Action;$("tutBlock").style.display="";$("tutBlock").style.opacity=.2;$("tutorialPick").style.display="";$("tutorialPick").style.opacity=1;$("diamond").style.display=
"none";a.style.top="200px";a.style.left="200px"}
function tutorialPrompt(){var a=tutorial.getCurrentStep(),b=tutorial.steps[a];tutorial.promptStep=a;a=$("tutorial");if(b.pointerObj)if(nui&&"_"===b.pointerObj.charAt(0)){var c=b.pointerObj.split("_");c=nui._getcell(c[1],c[2])}else"nuiPageHeader_sheetName"===b.pointerObj?(c=document.querySelectorAll(".nuiPageHeader_sheetName"),c=c[c.length-1]):c=$(b.pointerObj);$("nextButton").style.display="";c?(pointerWindow(c,b.prompt,b.pointerDir),$("tutBlock").style.display="",$("tutBlock").style.opacity=.2):
"bottom"==b.promptPosition?($("tutBlock").style.display="none",$("tutorial").style.display="",$("tutorial").style.opacity=1,$("tutorialText").innerHTML=b.prompt,$("diamond").style.display="none",a.style.left="200px",b=document.body.scrollHeight,document.documentElement&&(b=Math.min(b,document.documentElement.clientHeight,document.documentElement.scrollHeight)),c=a.getBoundingClientRect(),a.style.top=c.bottom-c.top+500<b?"500px":b-(c.bottom-c.top)+"px"):($("tutBlock").style.display="",$("tutBlock").style.opacity=
.2,$("tutorial").style.display="",$("tutorial").style.opacity=1,$("tutorialText").innerHTML=b.prompt,$("diamond").style.display="none",a.style.top="200px",a.style.left="200px")}
function tooltipTiny(a,b){if(a){ctrl.tinyTooltip&&hideTinyTooltip();ctrl.tinyTooltip=node("div");ctrl.tinyDiamond=node("div");document.body.appendChild(ctrl.tinyTooltip);document.body.appendChild(ctrl.tinyDiamond);ctrl.tinyTooltip.className="tinyTooltip";ctrl.tinyDiamond.className="tinyDiamond";var c=ctrl.tinyTooltip,d=ctrl.tinyDiamond;c.innerHTML=b;b=a.getBoundingClientRect();var e=document.body&&document.body.scrollTop||document.documentElement&&document.documentElement.scrollTop;c.style.left=b.left+
a.offsetWidth/2-c.offsetWidth/2+"px";c.style.top=b.top+a.offsetHeight+5+e+"px";d.style.left=b.left+a.offsetWidth/2-d.offsetWidth/2+"px";d.style.top=b.top+a.offsetHeight+e+"px";c.style.display="none";d.style.display="none";ctrl.timer=setTimeout(_tooltipTiny,300)}}function _tooltipTiny(){ctrl.tinyTooltip&&(ctrl.tinyTooltip.style.display="");ctrl.tinyDiamond&&(ctrl.tinyDiamond.style.display="")}
function hideTinyTooltip(){clearTimeout(ctrl.timer);ctrl.tinyTooltip&&document.body.removeChild(ctrl.tinyTooltip);ctrl.tinyDiamond&&document.body.removeChild(ctrl.tinyDiamond);ctrl.tinyTooltip=null;ctrl.tinyDiamond=null}
function tooltipV2(a,b,c,d,e,f,g,k){if(a){var l=$("tutorial"),m=$("diamond");ctrl.buttoutTimer&&clearTimeout(ctrl.buttoutTimer);ctrl.tooltipAnim?(l.style.opacity=1,l.style.display=""):(l.style.opacity=0,l.style.display="none");isFunction(b)?b():$("tutorialText").innerHTML=b;l.style.height=f?n+"px":"auto";b=e||350;var n=f||l.offsetHeight;l.style.width=b+"px";g?(l.style.background=g,m.style.background=g):(l.style.background=null,m.style.background=null);m.style.display="";m.style.borderTop=null;m.style.borderRight=
null;m.style.borderBottom=null;m.style.borderLeft=null;$("nextButton").style.display="none";$("closeTooltip").onclick=function(){l.style.display="none"};var q=a.getBoundingClientRect();f=getBodyScrolltop();g=ctrl.isFF?document.body.clientHeight:Math.min(document.body.clientHeight,document.documentElement.clientHeight);e=function(){var a=l.cloneNode(!0);a.style.position="fixed";a.style.left="-10000px";a.style.display="";return a}();document.body.appendChild(e);var r=q.top+f-e.offsetHeight-6,p=e.offsetHeight-
21,t=q.top+f+a.offsetHeight+6;switch(c){case 1:c=q.left+b/2+a.offsetWidth/2>document.body.offsetWidth?document.body.offsetWidth-b-18:0>q.left-b/2+a.offsetWidth/2?0:q.left-b/2+a.offsetWidth/2+2;l.style.left=c+"px";a=q.left+a.offsetWidth/2-c-25;m.style.left=a+"px";l.style.top=r+"px";m.style.top=p+"px";0>r-f&&(t+e.clientHeight>g+f?e.offsetHeight<g&&(l.style.top="0",m.style.display="none"):(l.style.top=t+"px",m.style.top="-19px"));k?(l.style.border="1px solid "+k,m.style.borderBottom="1px solid "+k,m.style.borderRight=
"1px solid "+k):(l.style.border=null,m.style.borderBottom=null,m.style.borderRight=null);break;case 2:l.style.top=q.top+f-n/2+a.offsetHeight/2+"px";l.style.left=q.left+a.offsetWidth+12+"px";m.style.top=n/2-20+"px";m.style.left="-33px";k?(l.style.border="1px solid "+k,m.style.borderBottom="1px solid "+k,m.style.borderLeft="1px solid "+k):(l.style.border=null,m.style.borderBottom=null,m.style.borderLeft=null);break;case 3:c=q.left+b/2+a.offsetWidth/2>document.body.offsetWidth?document.body.offsetWidth-
b-18:0>q.left-b/2+a.offsetWidth/2?0:q.left-b/2+a.offsetWidth/2+2;l.style.left=c+"px";a=q.left+a.offsetWidth/2-c-25;m.style.left=a+"px";l.style.top=t+"px";m.style.top="-19px";t+e.clientHeight>g+f&&(0>r-f?e.offsetHeight<g&&(l.style.top=g+f-e.offsetHeight+"px",m.style.display="none"):(l.style.top=r+"px",m.style.top=p+"px"));k?(l.style.border="1px solid "+k,m.style.borderTop="1px solid "+k,m.style.borderLeft="1px solid "+k):(l.style.border=null,m.style.borderBottom=null,m.style.borderLeft=null);break;
case 4:l.style.top=q.top+f-n/2+a.offsetHeight/2+"px",l.style.left=q.left-b-12+"px",m.style.top=n/2-20+"px",m.style.left=b-35+"px"}d?0<=d&&(ctrl.buttoutTimer=setTimeout(_tooltipV2,d)):ctrl.buttoutTimer=setTimeout(_tooltipV2,1500);document.body.removeChild(e)}}function _tooltipV2(){$("tutorial").style.display="";$("tutorial").style.opacity=1}
function pointerWindow(a,b,c,d){if(a){console.log(a.id);$("tutorial").style.display="";$("tutorial").style.opacity=1;$("tutorialText").innerHTML=b;b=$("tutorial");var e=a.getBoundingClientRect();$("diamond").style.display="";d?$("nextButton").style.display="none":("000"==tutorial.getChapter()?$("nextButton").style.marginTop=-40:$("nextButton").style.marginTop="auto",$("nextButton").style.display="");$("closeTooltip").onclick=function(){ctrl.tutNoGoStart=!0;_tutorialLeave()};var f=d=-1E3,g=-1E3,k=
-1E3;switch(c){case 1:d=e.top-b.offsetHeight-12;f=e.left-b.offsetWidth/2+a.offsetWidth/2;g=b.offsetHeight-20;k=(b.offsetWidth-60)/2;break;case 2:d=e.top-b.offsetHeight/2+a.offsetHeight/2;f=e.left+a.offsetWidth+12;g=b.offsetHeight/2-20;k=-33;break;case 3:e.left+b.offsetWidth/2+a.offsetWidth/2>document.body.offsetWidth?(d=e.top+a.offsetHeight+6,f=document.body.offsetWidth-b.offsetWidth-18,g=-18,k=(b.offsetWidth-60)/2+30):(d=e.top+a.offsetHeight+6,f=e.left-b.offsetWidth/2+a.offsetWidth/2+2,g=-18,k=(b.offsetWidth-
60)/2);break;case 4:d=e.top-b.offsetHeight/2+a.offsetHeight/2,f=e.left-b.offsetWidth-12,g=b.offsetHeight/2-20,k=b.offsetWidth-35}0>d&&(d=0);0>f&&(f=0);0<=d&&0<=f&&(b.style.top=d+"px",b.style.left=f+"px",$("diamond").style.top=g+"px",$("diamond").style.left=k+"px")}}
function tutorialFreeAction(){$("tutorial").style.display="none";var a=tutorial.steps[tutorial.getCurrentStep()];$("tutorialAction").style.display="";$("tutorialAction").style.opacity=1;$("tutorialAction").innerHTML=a.prompt;"bottom"==a.promptPosition?($("tutorialAction").style.top="500px",$("tutorialAction").style.left="120px"):$("tutorialAction").style.top=""}function tutorialAction(){$("tutorial").style.display="none";tutorial.steps[tutorial.getCurrentStep()].actionObj1&&updateOverlay()}
function updateOverlay(){if(tutorial.steps){var a=tutorial.steps[tutorial.getCurrentStep()],b=extractWidthHeight(a.actionObj1);a=extractWidthHeight(a.actionObj2);tutorialOverlay(b,a)}}
function extractWidthHeight(a){if(!a)return null;for(var b=a.split(","),c=99999,d=0,e=99999,f=0,g=0;g<b.length;g++){if("_"===b[g].charAt(0)){var k=b[g].split("_");k=nui._getcell(k[1],k[2])}else k=$(b[g]);k&&(k=k.getBoundingClientRect(),c=Math.min(c,k.top),d=Math.max(d,k.bottom),e=Math.min(e,k.left),f=Math.max(f,k.right),ctrl.isIE&&"at"==a.slice(0,2)&&(f+=20))}99999==c&&(c=0);99999==e&&(e=0);return{top:c,left:e,width:f-e,height:d-c}}
function tutorialPointing(a){var b=findPos(a),c=a.clientWidth;a=a.clientHeight;var d=b[0];b=b[1];$("tutorialArrow").style.display="";$("tutorialArrow").style.top=b+a+8+"px";$("tutorialArrow").style.left=d+c/2+"px"}function tutorialOverlay(a,b){a&&!b?_tutorialOverlay1(a):a&&b&&_tutorialOverlay2(a,b)}
function _tutorialOverlay2(a,b){var c=tutorial.steps[tutorial.getCurrentStep()],d=a.width+12,e=a.height+12,f=a.left-6,g=a.top-6;0>g&&(g=0);0>f&&(f=0);var k=b.width+12,l=b.height+12;a=b.left-6;b=b.top-6;0>b&&(b=0);0>a&&(a=0);var m=g<=b,n=Math.min(g,b),q=Math.min(f,a),r=Math.max(g+e,b+l)-n,p=a+k-f;$("tutBlock_u").onmousedown=function(a){return!1};$("tutBlock_r").onmousedown=function(a){return!1};$("tutBlock_d").onmousedown=function(a){return!1};$("tutBlock_l").onmousedown=function(a){return!1};$("tutBlock_m1").onmousedown=
function(a){return!1};$("tutBlock_m2").onmousedown=function(a){return!1};$("tutBlock_m3").onmousedown=function(a){return!1};$("tutorialAction").onmousedown=function(a){return!1};$("tutorialAction2").onmousedown=function(a){return!1};$("tutBlock_u").style.display="";$("tutBlock_r").style.display="";$("tutBlock_d").style.display="";$("tutBlock_l").style.display="";$("tutBlock_m1").style.display="";$("tutBlock_m2").style.display="";$("tutBlock_m3").style.display="";$("tutBlock_u").style.top=0;$("tutBlock_r").style.top=
n+"px";$("tutBlock_d").style.bottom=0;$("tutBlock_l").style.top=n+"px";$("tutBlock_m1").style.top=m?n+e+"px":n+"px";$("tutBlock_m2").style.top=n+"px";$("tutBlock_m3").style.top=m?n+"px":n+l+"px";$("tutBlock_u").style.left=0;$("tutBlock_r").style.right=0;$("tutBlock_d").style.left=0;$("tutBlock_l").style.left=0;$("tutBlock_m1").style.left=q+"px";$("tutBlock_m2").style.left=q+d+"px";$("tutBlock_m3").style.left=a+"px";$("tutBlock_u").style.width=document.body.clientWidth+"px";$("tutBlock_r").style.width=
Math.max(0,document.body.clientWidth-q-p)+"px";$("tutBlock_d").style.width=document.body.clientWidth+"px";$("tutBlock_l").style.width=q+"px";$("tutBlock_m1").style.width=d+"px";$("tutBlock_m2").style.width=Math.max(0,a-f-d)+"px";$("tutBlock_m3").style.width=k+"px";$("tutBlock_u").style.height=n+"px";$("tutBlock_r").style.height=r+"px";$("tutBlock_d").style.height=Math.max(0,document.body.clientHeight-r-n)+"px";$("tutBlock_l").style.height=r+"px";$("tutBlock_m1").style.height=r-e+"px";$("tutBlock_m2").style.height=
r+"px";$("tutBlock_m3").style.height=r-l+"px";$("tutorialAction").style.display="";$("tutorialAction").style.opacity=1;$("tutorialAction").innerHTML=c.prompt;$("tutorialAction2").style.display="";$("tutorialAction2").style.opacity=1;$("tutorialAction2").innerHTML=c.prompt2;c=m?g-$("tutorialAction").clientHeight-8:g+e+8;d=m?b+l+8:b-$("tutorialAction").clientHeight-8;0>c&&(c=g+e+8);0>d&&(d=b+l+8);$("tutorialAction").style.top=c+"px";$("tutorialAction2").style.top=d+"px";e=f+$("tutorialAction").offsetWidth;
g=a+$("tutorialAction2").offsetWidth;e>document.body.clientWidth?$("tutorialAction").style.left=Math.max(0,document.body.clientWidth-"tutorialAction".offsetWidth-8)+"px":$("tutorialAction").style.left=f+"px";g>document.body.clientWidth?$("tutorialAction2").style.left=Math.max(0,document.body.clientWidth-"tutorialAction2".offsetWidth-8)+"px":$("tutorialAction2").style.left=a+"px"}
function _tutorialOverlay1(a){var b=tutorial.steps?tutorial.steps[tutorial.getCurrentStep()]:{prompt:"test"};var c=a.width,d=a.height,e=a.left;a=a.top;c+=12;d+=12;e-=6;a-=6;0>e&&(e=0);0>a&&(a=0);$("tutBlock_u").onmousedown=function(a){return!1};$("tutBlock_r").onmousedown=function(a){return!1};$("tutBlock_d").onmousedown=function(a){return!1};$("tutBlock_l").onmousedown=function(a){return!1};$("tutorialAction").onmousedown=function(a){return!1};$("tutBlock_u").style.display="";$("tutBlock_r").style.display=
"";$("tutBlock_d").style.display="";$("tutBlock_l").style.display="";$("tutBlock_m1").style.display="none";$("tutBlock_m2").style.display="none";$("tutBlock_m3").style.display="none";$("tutBlock_u").style.top=0;$("tutBlock_r").style.top=a+"px";$("tutBlock_d").style.bottom=0;$("tutBlock_l").style.top=a+"px";$("tutBlock_u").style.left=0;$("tutBlock_r").style.right=0;$("tutBlock_d").style.left=0;$("tutBlock_l").style.left=0;$("tutBlock_u").style.width=document.body.clientWidth+"px";c=document.body.clientWidth-
e-c;$("tutBlock_r").style.width=(c&&0<c?c:1)+"px";$("tutBlock_d").style.width=document.body.clientWidth+"px";$("tutBlock_l").style.width=e+"px";$("tutBlock_u").style.height=a+"px";$("tutBlock_r").style.height=d+"px";$("tutBlock_d").style.height=Math.max(0,document.body.clientHeight-d-a)+"px";$("tutBlock_l").style.height=d+"px";d=b.actionObj1;d=d.split(",")[0];pointerWindow($(d),b.prompt,b.pointerDir?b.pointerDir:3,!0)}
function getTuDb(a){var b=[],c;for(c in accountProfile)accountProfile[c].realName===a.trim()&&b.push(c);a="";for(c=0;c<b.length;c++)b[c]>a&&(a=b[c]);return $("pathTab"+a)}
function saveUserProperties(a,b){window.userProperties&&0!==Object.getOwnPropertyNames(window.userProperties).length||resetUserProperties();window.userProperties[a]=b;if(window.userCanLogout){var c={};c[a]=b;postPromise("/sims/sharedProperties.jsp",c).then(JSON.parse).then(function(a){window.userProperties=a})}else RagicStorage.localStorage.setItem("guestUserPref",JSON.stringify(window.userProperties))}
function resetUserProperties(){window.userCanLogout?getPromise("/sims/sharedProperties.jsp").then(JSON.parse).then(function(a){window.userProperties=a}).catch(function(){window.userProperties={}}):window.userProperties=JSON.parse(RagicStorage.localStorage.getItem("guestUserPref"))||{}}
function tuInputComparison(a,b,c){if(!a)return!1;a.value.length>b.length&&(a.value=a.value.trim());if(a.value.length<b.length)return!1;a=a.value.split("\n");for(var d=0;d<a.length;d++)c||(a[d]=a[d].toLowerCase()),a[d]=a[d].trim();return b===a.join("\n")}var BUILDER_FIELDS=1,BUILDER_TEXT=2,BUILDER_NOOP=0,BUILDER_EMPTY_CLASS="builderEmpty",BUILDER_BBCODE_IMAGE_BY_UPLOAD="upload",BUILDER_BBCODE_IMAGE_BY_URL="url",undoSteps=[],redoSteps=[],builder=new DesignModeBuilder;
function DesignModeBuilder(){this.cellData={};this.freeData={};this.relativePositions={};this.absolutePositions={};this.colSpanCells=[];this.rights={};this.rightsDetail={};this.filters={};this.selections={};this.approvalItems=[];this.actionButtons={};this.cascadedSelections={};this.autoGenRef={};this.reminders=[];this.sections={};this.msg={};this.ecmsg={};this.wfmsg={};this.formulaRel=new FormulaRel;this.delta=0;this.unsave=!1;this.newName=null;this.formDesc="";this.approvalFlag=this.approvalType=
null;this.approvalCC=[];this.executeActionButtonAfterApproval=[];this.tempDragDropShiftRow=-1;this.mode=BUILDER_NOOP;this.defaultMode=BUILDER_FIELDS;this.startNUI=null;this.rootDomainId=-1;this.subtableKeys={};this.subtableAliasParents={};this.subtableReferenceURL={};this.subtableFpUrls={};this.subtableFilter={};this.templates={};this.widgets=[];this.custFieldsSets={};this.level3=null;this.createAsListingPage=this.newForm=this.saveVersion=!1;this.custQueryItems="";this.cascadingFormulaRecal=!1;this.recalParentFormula=
!0;this.addParentEntryManager=this.hideEmailHistory=!1;this.emailTemplates=[];this.custAppSeqItems=[];this.autoSave=!1;this.freezeY=this.freezeX=0;this.conditionalFormattingString=""}DesignModeBuilder.prototype.ifValidNewSectionStart=function(a){for(var b in this.subtableKeys){var c=parseInt(b.split(",")[1]);if(a===c+1||a===c+2||a===c+3)return!1}return!0};
DesignModeBuilder.prototype.ifValidNewSectionEnd=function(a){for(var b in this.subtableKeys){var c=parseInt(b.split(",")[1]);if(a===c||a===c+1||a===c+2)return!1}return!0};DesignModeBuilder.prototype.hasSections=function(){return 0<this.getSectionLength()};DesignModeBuilder.prototype.sectionExist=function(a){return this.hasSections()?!!this.sections.sections[a]:!1};DesignModeBuilder.prototype.getSectionStart=function(){return this.sections.start};
DesignModeBuilder.prototype.ifStartFirstSection=function(a){return this.sections&&this.sections.start===a};DesignModeBuilder.prototype.getEndOfLastSection=function(){return this.sections&&this.sections.sections&&0<this.sections.sections.length?this.sections&&this.sections.sections[this.sections.sections.length-1].end:null};
DesignModeBuilder.prototype.expandSection=function(a,b){this.sections.start>a&&(this.sections.start+=b);for(var c=0;c<this.sections.sections.length;c++){var d=this.sections.sections[c];d.end&&d.end>=a&&(d.end+=b)}};DesignModeBuilder.prototype.getSectionLength=function(){return this.sections&&this.sections.sections?this.sections.sections.length:0};
DesignModeBuilder.prototype.isSectionEnd=function(a){if(!a||!this.sections||!this.sections.sections)return!1;for(var b=0;b<this.sections.sections.length;b++)if(this.sections.sections[b].end===a)return!0;return!1};DesignModeBuilder.prototype.getSectionIndex=function(a){if(!this.sections||!this.sections.sections||!this.sections.start||a<this.sections.start)return-1;if(a===this.sections.start)return 0;for(var b=0;b<this.sections.sections.length;b++)if(a<=this.sections.sections[b].end)return b;return-1};
DesignModeBuilder.prototype.ifRenderRow=function(a){if(!this.sections||!this.sections.sections||!this.sections.start||a<this.sections.start)return!0;for(var b=0;b<this.sections.sections.length;b++){var c=this.sections.sections[b];if(a<=c.end)return c.display}return!0};DesignModeBuilder.prototype.getDisplaySection=function(){if(!this.sections||!this.sections.sections||!this.sections.start)return-1;for(var a=0;a<this.sections.sections.length;a++){var b=this.sections.sections[a];if(b&&b.display)return a}return-1};
DesignModeBuilder.prototype.setContent=function(a,b,c){var d=nui._curcell().ip;d.typing&&d.loadValue($("hin").getValue());d.render();if(this.mode==BUILDER_FIELDS)return"E"!=this.setField(a,b,c);if(this.mode==BUILDER_TEXT)return this.setDescription(a,b,c)};
DesignModeBuilder.prototype.repositionSubtableKey=function(){for(var a in this.subtableKeys){var b=this.cellData[a],c=this.subtableKeys[a],d=a.split(","),e=parseInt(d[0]);d=parseInt(d[1]);if(b){for(;this.cellData[e+","+d]&&0<=e;)e--;e++;delete this.subtableKeys[a];this.cellData[e+","+d]&&(this.subtableKeys[e+","+d]=c);this.subtableAliasParents[a]&&(b=this.subtableAliasParents[a],delete this.subtableAliasParents[a],this.cellData[e+","+d]&&(this.subtableAliasParents[e+","+d]=b));this.subtableReferenceURL[a]&&
(b=this.subtableReferenceURL[a],delete this.subtableReferenceURL[a],this.cellData[e+","+d]&&(this.subtableReferenceURL[e+","+d]=b))}else{for(;!this.cellData[e+","+d]&&30>=e;)e++;delete this.subtableKeys[a];this.cellData[e+","+d]&&!this.subtableKeys[e+","+d]&&(this.subtableKeys[e+","+d]=c);this.subtableAliasParents[a]&&(b=this.subtableAliasParents[a],delete this.subtableAliasParents[a],this.cellData[e+","+d]&&!this.subtableAliasParents[e+","+d]&&(this.subtableAliasParents[e+","+d]=b));this.subtableReferenceURL[a]&&
(b=this.subtableReferenceURL[a],delete this.subtableReferenceURL[a],this.cellData[e+","+d]&&!this.subtableReferenceURL[e+","+d]&&(this.subtableReferenceURL[e+","+d]=b));this.subtableFpUrls[a]&&(b=this.subtableFpUrls[a],delete this.subtableFpUrls[a],this.cellData[e+","+d]&&!this.subtableFpUrls[e+","+d]&&(this.subtableFpUrls[e+","+d]=b))}}};
DesignModeBuilder.prototype.isPositionValid=function(a,b,c,d){if(!c&&!d)return this._isPositionValid(a,b);var e=1;if(c&&d){var f=nui._getcell(c,d);f&&f.colSpan&&(e=f.colSpan)}if(1<e){for(f=a;f<a+e;f++)if(!(b==d&&f>=c&&f<c+e||this._isPositionValid(f,b)))return!1;return!0}return this._isPositionValid(a,b)};
DesignModeBuilder.prototype._isPositionValid=function(a,b){for(var c=!0,d,e=a;1<=e;e--)if(d=this.freeData[e+","+b],e==a&&(d||this.cellData[e+","+b])){c=!1;break}else if(d&&d.attr&&d.attr.cs&&parseInt(d.attr.cs)>a-e){c=!1;break}return c};
DesignModeBuilder.prototype.isPositionValidV2=function(a,b,c,d){a=parseInt(a);b=parseInt(b);if(0>=a||0>=b)return{isValid:!1,invalidMsg:"position should >= 1"};var e=null,f=null,g=null,k=1;c&&c instanceof FreeObject?(e=!0,g=f=!1,c.styling&&c.styling.cs&&(k=parseInt(c.styling.cs))):c&&c instanceof BuilderObject&&this.ifAdjacent(c.x,c.y)?(e=!1,g=!0,f=!1):c&&c instanceof BuilderObject?(e=!1,f=!0,g=!1,c.hasAttribute("cs")&&(k=parseInt(c.attr.cs)+1)):d&&null!==d.addSingle&&void 0!==d.addSingle?(e=!1,f=
d.addSingle,g=!d.addSingle,k=(d.cs?d.cs:1)+(f?1:0)):d&&null!==d.addSubtableField&&void 0!==d.addSubtableField?(e=!1,f=!d.addSubtableField,g=d.addSubtableField):d&&null!==d.addFree&&void 0!==d.addFree&&(e=d.addFree)&&(g=f=!1,d.cs&&(k=d.cs));null===e&&null===f&&null===g&&(e=!1);c=this.cellData[a+","+b];d=this.freeData[a+","+b];if(c||d)return{isValid:!1,invalidMsg:"position collide"};if(!e&&this.cellData[a-1+","+b]&&this.cellData[a+1+","+b])return{isValid:!1,invalidMsg:"surrounded by two cells"};for(var l=
!0,m=a-1;0<m;m--)if(c=this.cellData[m+","+b],d=this.freeData[m+","+b],c){m===a-1?e&&!this.ifAdjacent(c.x,c.y)?l=!1:f?l=!1:!1===e&&null===f&&null===g&&(f=!1,g=!0):this.ifAdjacent(c.x,c.y)||(d=c.hasAttribute("cs")?parseInt(c.attr.cs):1,c.x+d>=a&&(l=!1));break}else if(d){c=d.styling&&d.styling.cs?parseInt(d.styling.cs):1;d.x+c-1>=a&&(l=!1);break}if(!l)return{isValid:!1,invalidMsg:"position collide with left side field"};for(m=a+1;m<=this.maxX;m++)if(c=this.cellData[m+","+b],d=this.freeData[m+","+b],
c){c.x===a+1?e?a+k-1>=c.x&&(l=!1):f?l=!1:g?l=!1:!1===e&&null===f&&null===g&&(f=!1,g=!0,l=!1):e||f?a+k-1>=c.x&&(l=!1):!1===e&&null===f&&null===g&&(f=!0,g=!1,k=2,a+k-1>=c.x&&(l=!1));break}else if(d){e||f||g?a+k-1>=d.x&&(l=!1):!1===e&&null===f&&null===g&&(f=!0,g=!1,k=2,a+k-1>=d.x&&(l=!1));break}if(!l)return{isValid:!1,invalidMsg:"position collide with right side field"};!1===e&&null===f&&null===g&&(g=!1,k=2);e=parseInt(this.absolutePositions[a+","+b].split(",")[0]);for(f=b-1;f>=b-3;f--)for(d=e;d<e+k;d++)if((c=
this.cellData[this.relativePositions[d+","+f]])&&this.ifAdjacent(c.x,c.y))return{isValid:!1,invalidMsg:"position collide with subtable above"};if(g){if(!this.cellData[a-1+","+b])return{isValid:!1,invalidMsg:"there is no left field, cannot create subtable field here."};for(g=b+1;g<=b+3;g++)if(k=a+","+g,c=this.cellData[k],d=this.freeData[k],c||d)return{isValid:!1,invalidMsg:"position collide with field below"}}return{isValid:!0}};
DesignModeBuilder.prototype.updateCustAppSeqItems=function(a,b,c,d){if(a&&b&&c&&d){var e=c+","+d,f=a+","+b;builder.custAppSeqItems.forEach(function(a){"DESCRIPTION"==a.type&&e==a.key&&(a.key=f)})}};DesignModeBuilder.prototype.deleteCustAppSeqItem=function(a){if(a)for(var b=this.custAppSeqItems,c=0;c<b.length;c++)if(a==b[c].key){b.splice(c,1);break}};
DesignModeBuilder.prototype.getFirstField=function(){for(var a=1;10>a;a++)for(var b=1;10>b;b++)if(this.cellData[b+","+a])return this.cellData[b+","+a];return null};DesignModeBuilder.prototype.startWithListing=function(){var a=this.getFirstField();return!a||this.cellData[a.x+1+","+a.y]?!0:!!this.onlyOneField()};DesignModeBuilder.prototype.onlyOneField=function(){return 1>=Object.keys(this.cellData).length};
DesignModeBuilder.prototype.setField=function(a,b,c){if(0==a||0==b)return!1;this.unsave=!0;var d=this.cellData[a+","+b],e=this.freeData[a+","+b],f=null;for(k in this.cellData)if(k&&this.cellData[k]){var g=this.cellData[k];g.key=!1;if(!f||g.y<f.y||g.y==f.y&&g.x<f.x)f=g}f&&(f.key=!0);var k=this.cellData[a+1+","+b];g=this.cellData[a-1+","+b]||k;k="E";if(f&&this.ifAdjacent(f.x,f.y)&&!g&&c)return this.ifListingPage()?floatWinWarning('<div style="line-height:1.5;max-width:500px;">'+lm.noSingleFieldInListingPage+
"</div>"):floatWinWarning('<div style="line-height:1.5;max-width:500px;">'+lm.noSubtableOnTop+"</div>"),(a=nui._curcell())&&a.ip&&a.ip.clear(),k;if(c&&""!=c)d?(d.render(),this.cellData[a+","+b].domainId||builder.smartSetAttribute(a,b,c),k="M"):this.freeData[a+","+b]||(e=c.split(","),5<=e.length?(d=e[3],e=new BuilderObject(a,b,e[4],e[0],null,e[5]),ctrl.copyPasteCellRelative&&(ctrl.copyPasteCellRelative[d]=a+"|"+b),ctrl.pastedCells&&ctrl.pastedCells.push(e),builder.selections[d]&&(builder.selections[a+
"|"+b]=builder.selections[d])):e=new BuilderObject(a,b,c,TYPER),this.cellData[a+","+b]=e,delete this.freeData[a+","+b],this.deleteCustAppSeqItem(a+","+b),e.render(),builder.smartSetAttribute(a,b,c),k="I");else{if(d){doDeleteCheck(d);if(d.noDelete)return d.value=d.originalValue,d.render(),k;d.unrender();deleteInvalidListeningLinks(d.domainId);c=-1;for(f=0;f<builder.colSpanCells.length;f++)builder.colSpanCells[f].domainId==d.domainId&&(c=""+f);0<=parseInt(c)&&builder.colSpanCells.splice(parseInt(c),
1);shiftFormula();this.deleteCustAppSeqItem(d.domainId);builder.formulaRel.delFCellRec(a+","+b);showAddSystemFieldElement(d.domainId)}e&&(e.unrender(),this.deleteCustAppSeqItem(a+","+b));delete this.cellData[a+","+b];delete this.freeData[a+","+b];k="D"}builder.saveStep();builder.repositionSubtableKey();builder.newForm&&(builder.createAsListingPage=!!builder.startWithListing());return k};
DesignModeBuilder.prototype.smartSetAttribute=function(a,b,c){if(c){var d=this.cellData[a+","+b];if(d&&!("D"!=d.IPType||d.attr&&Object.keys(d.attr).length)){c=c.toLowerCase();d=c.split(" ");var e,f;for(f in ctrl.smartSet)for(e=0;e<d.length;e++)if(d[e]==f){ctrl.smartSet[f](a,b);break}for(f in ctrl.smartSetZH)if(c.includes(f)){ctrl.smartSetZH[f](a,b);break}}}};
DesignModeBuilder.prototype.setDescription=function(a,b,c){this.unsave=!0;var d=this.freeData[a+","+b];if(!c||""==c){if(d)d.unrender(),nui._getcell(a,b).style.backgroundColor="";else return;delete this.cellData[a+","+b];delete this.freeData[a+","+b];this.deleteCustAppSeqItem(a+","+b)}else if(d){d.value=c;a=determineColspan(a,b,d.value,d.styling);if(!d.styling.cs||builder.bbcodeImage)d.styling.cs=a;d.render()}else if(!this.cellData[a+","+b]){d=c.split(",");if(5<=d.length){var e=d[5];c=new FreeObject(a,
b,d[4]);e=e.split("&");c.action=d[3];for(d=0;d<e.length;d++){var f=e[d].split("=",2);c.styling[f[0]]=f[1]}}else c=new FreeObject(a,b,c);delete this.cellData[a+","+b];this.freeData[a+","+b]=c;a=determineColspan(a,b,c.value,c.styling);c.styling.cs||(c.styling.cs=a);c.render()}builder.saveStep();return!0};DesignModeBuilder.prototype.setAction=function(a,b){this.unsave=!0;(a=this.freeData[a+","+b])&&floatWinPrompt("_setBuilderAction",lm.enterURLLink,"",a.action?a.action:"");builder.saveStep()};
DesignModeBuilder.prototype.setStyle=function(a,b,c,d,e){if(ctrl.multiSelected&&0<ctrl.multiSelected.length)for(a=0;a<ctrl.multiSelected.length;a++){var f=ctrl.multiSelected[a];b=f.dataset.x;f=f.dataset.y;(this.cellData[b+","+f]||this.freeData[b+","+f])&&this._setStyle(b,f,c,d,e)}else this._setStyle(a,b,c,d,e)};
DesignModeBuilder.prototype._setStyle=function(a,b,c,d,e){this.unsave=!0;ctrl.dropWin=!0;nui._curcell()||(nui.frow=a,nui.fcol=b,nui._updateFocus());if(nui._curcell()){var f=nui._curcell().ip,g=$("hin");f&&f.typing&&(builder.setDescription(a,b,g.value),f.typing=!1,f.changed=!0,f.render());g=(f=this.cellData[a+","+b])?this.cellData[a+","+b]:this.freeData[a+","+b];if(!g){if(f)return;g=new FreeObject(a,b," ");this.freeData[a+","+b]=g}if("cs"==c){if(!(f&&this.cellData[a+1+","+b]||isCellColspanSpreadable(a,
b,d))){$("desc_cs").value=g.styling.cs;return}if(g.styling[c])for(a=1,b=g.styling[c];a<=(f?b:b-1);a++){var k=nui.main.nuicelltable.rows[g.y];k&&k.cells&&!(0>g.x)&&k.cells[g.x+a]&&(k.cells[g.x+a].style.display="")}}g.styling[c]=g.styling[c]==d?"":d;g.render();e||setStylePane(g);nui._updateFocus();ctrl.dropWin=!0;builder.saveStep()}};DesignModeBuilder.prototype.clearStyle=function(a){if("F"!==a.objectType)a.styling={};else{var b=a.styling.cs;a.styling={};b&&(a.styling.cs=b)}a.render();setStylePane(a)};
DesignModeBuilder.prototype.clearStyleAll=function(a){Object.values(builder.cellData).forEach(function(a){a.styling={}});Object.values(builder.freeData).forEach(function(a){var b=a.styling.cs;a.styling={};b&&(a.styling.cs=b)});a&&CustThemeHelper.restoreToDefault();builder.renderAll();(a=builder.cellData[nui.fcol+","+nui.frow]||builder.freeData[nui.fcol+","+nui.frow])&&setStylePane(a)};DesignModeBuilder.prototype.copyAttribute=function(a,b,c,d,e){this.cellData[a+","+b].setAttrStr(c,!0,d,e)};
DesignModeBuilder.prototype.isSubtable=function(a){var b=a.x;a=a.y;var c=this.cellData[b+1+","+a];return!(!this.cellData[b-1+","+a]&&!c)};DesignModeBuilder.prototype.findField=function(a,b){for(var c in this.cellData){var d=this.cellData[c];if(b&&this.isSubtable(d)&&d.domainId==a||!b&&d.domainId==a)return d}return null};
DesignModeBuilder.prototype.findFieldInSubtable=function(a,b){var c=parseInt(b.split(",")[0]);b=parseInt(b.split(",")[1]);for(var d=this.cellData[c+","+b];d;){if(d.domainId==a)return d;c++;d=this.cellData[c+","+b]}return null};DesignModeBuilder.prototype.findListenFieldByLoadedField=function(a){if(!a.hasAttribute("l"))return null;var b=a.attr.l,c=!!this.ifAdjacent(a.x,a.y),d;for(d in this.cellData){var e=this.cellData[d];if(e.domainId==b||e.x+"|"+e.y===b)if(!c||this.isSameSubtable(a,e))return e}return null};
DesignModeBuilder.prototype.findSubtableHeadField=function(a,b){a=this.cellData[a+","+b];if(!a||!this.ifAdjacent(a.x,a.y))return null;do var c=a.x;while(a=this.cellData[a.x-1+","+b]);return this.cellData[c+","+b]};DesignModeBuilder.prototype.isSameSubtable=function(a,b){return a&&b&&a.y===b.y&&this.ifAdjacent(a.x,a.y)&&this.ifAdjacent(b.x,b.y)?this.findSubtableHeadField(a.x,a.y)===this.findSubtableHeadField(b.x,b.y):!1};
DesignModeBuilder.prototype.renameAttribute=function(a,b,c,d){a=this.cellData[a+","+b];a.attr[c]&&(this.unsave=!0,a.attr[d]=a.attr[c],delete a.attr[c])};
DesignModeBuilder.prototype._resetInputType=function(a,b){a=this.cellData[a+","+b];a.mvp=!1;a.summaryField=!1;a.attr&&(a.attr.hasOwnProperty("mvp")&&delete a.attr.mvp,a.attr.hasOwnProperty("mvpf")&&delete a.attr.mvpf,a.attr.hasOwnProperty("summary")&&delete a.attr.summary,a.attr.hasOwnProperty("lnls")&&delete a.attr.lnls,a.attr.hasOwnProperty("usrref")&&delete a.attr.usrref,a.attr.hasOwnProperty("grpref")&&delete a.attr.grpref,a.attr.hasOwnProperty("ifReadInfo")&&delete a.attr.ifReadInfo,a.attr.hasOwnProperty("fmt_d")&&
delete a.attr.fmt_d,a.attr.hasOwnProperty("fmt_n")&&delete a.attr.fmt_n,a.attr.hasOwnProperty("ag")&&delete a.attr.ag,a.attr.hasOwnProperty("sig")&&delete a.attr.sig,a.attr.hasOwnProperty("html")&&delete a.attr.html,a.attr.hasOwnProperty("email")&&delete a.attr.email,a.attr.hasOwnProperty("em")&&delete a.attr.em,a.attr.hasOwnProperty("phone")&&delete a.attr.phone,a.attr.hasOwnProperty("addr")&&delete a.attr.addr,a.attr.hasOwnProperty("url")&&delete a.attr.url,a.attr.hasOwnProperty("stf")&&delete a.attr.stf,
a.attr.hasOwnProperty("s")&&delete a.attr.s,a.attr.hasOwnProperty("phonefmt")&&delete a.attr.phonefmt,a.attr.hasOwnProperty("dv")&&delete a.attr.dv,a.attr.hasOwnProperty("dv_f")&&delete a.attr.dv_f,a.attr.hasOwnProperty("checkbox")&&delete a.attr.checkbox,a.attr.hasOwnProperty("barcode")&&(delete a.attr.barcode,delete a.attr.bc_type,delete a.attr.bc_action,delete a.attr.bc_height,delete a.attr.bc_append_text),a.attr.hasOwnProperty("masked")&&(delete a.attr.masked,delete a.attr.masked_mode,delete a.attr.masked_viewableGroups),
a.attr.hasOwnProperty("map")&&(delete a.attr.map,delete a.attr.iwidth,delete a.attr.iheight,delete a.attr.zoom),a.attr.hasOwnProperty("multipleImages")&&delete a.attr.multipleImages,a.attr.hasOwnProperty("multipleFiles")&&delete a.attr.multipleFiles)};
DesignModeBuilder.prototype.resetAttributesForLinking=function(a,b){a=this.cellData[a+","+b];a.mvp=!1;a.attr&&(a.attr.hasOwnProperty("fmt_d")&&delete a.attr.fmt_d,a.attr.hasOwnProperty("fmt_n")&&delete a.attr.fmt_n,a.attr.hasOwnProperty("ag")&&delete a.attr.ag,a.attr.hasOwnProperty("sig")&&delete a.attr.sig,a.attr.hasOwnProperty("html")&&delete a.attr.html,a.attr.hasOwnProperty("email")&&delete a.attr.email,a.attr.hasOwnProperty("em")&&delete a.attr.em,a.attr.hasOwnProperty("phone")&&delete a.attr.phone,
a.attr.hasOwnProperty("addr")&&delete a.attr.addr,a.attr.hasOwnProperty("url")&&delete a.attr.url,a.attr.hasOwnProperty("phonefmt")&&delete a.attr.phonefmt,a.attr.hasOwnProperty("dv")&&delete a.attr.dv,a.attr.hasOwnProperty("dv_f")&&delete a.attr.dv_f)};DesignModeBuilder.prototype.getAttributeByDomainId=function(a,b){for(var c in this.cellData){var d=this.cellData[c];if(d.domainId==a&&d.attr&&d.attr[b])return d.attr[b]}return null};
DesignModeBuilder.prototype.setAttributeByDomainId=function(a,b,c){for(var d in this.cellData){var e=this.cellData[d];if(e.domainId==a){c?e.attr[b]=c:delete e.attr[b];break}}};DesignModeBuilder.prototype.getAttribute=function(a,b,c){return(a=this.cellData[a+","+b])&&a.attr?a.attr[c]:null};DesignModeBuilder.prototype.setAttributeCurrentCell=function(a,b){var c=currentBiff;this.setAttribute(c.x,c.y,a,b)};
DesignModeBuilder.prototype.setAttribute=function(a,b,c,d){this.unsave=!0;var e=this.cellData[a+","+b];if(e){if("it"==c){if("MVP"==d)d="L",this._resetInputType(a,b),e.mvp=!0;else if("SUMMARY"==d)d="D",this._resetInputType(a,b),e.attr.fmt_n=""==defaultNumberFormat||null==defaultNumberFormat?"#"+(null==e.attr.fmt_n_ts?",":e.attr.fmt_n_ts)+"###"+(null==e.attr.fmt_n_ds?".":e.attr.fmt_n_ds)+"#####":defaultNumberFormat,e.summaryField=!0;else if("CHECKBOX"==d)d="L",this._resetInputType(a,b),e.attr.checkbox=
1,e.attr.dv="No",e.domainId?builder.selections[e.domainId]=["No","Yes"]:builder.selections[a+"|"+b]=["No","Yes"];else if("USER"==d)d="L",this._resetInputType(a,b),e.attr.usrref=2;else if("GROUP"==d)d="L",this._resetInputType(a,b),e.attr.grpref=2,e.attr.groupNotify=1;else if("DATE"==d)d="D",this._resetInputType(a,b),e.attr.fmt_d=""==defaultDateFormat||null==defaultDateFormat?"yyyy/MM/dd":defaultDateFormat,e.attr.repeat&&delete e.attr.repeat;else if("DATE_REPEAT"==d)d="D",this._resetInputType(a,b),
e.attr.fmt_d="MM/dd",e.attr.repeat||(e.attr.repeat=REPEAT_DATE_TYPE_YEARLY);else if("NUMBER"==d||"PERCENTAGE"==d){var f=d;d="D";this._resetInputType(a,b);a=!1;""!=e.attr.fmt_n_ds&&"."!=e.attr.fmt_n_ds&&""!=defaultDecimalSeparator&&null!=defaultDecimalSeparator&&"."!=defaultDecimalSeparator&&(e.attr.fmt_n_ds=defaultDecimalSeparator,a=!0);""!=e.attr.fmt_n_ts&&"."!=e.attr.fmt_n_ts&&""!=defaultThousandsSeparator&&null!=defaultThousandsSeparator&&","!=defaultThousandsSeparator&&(e.attr.fmt_n_ts=defaultThousandsSeparator,
a=!0);a&&(null==e.attr.fmt_n_ts&&(e.attr.fmt_n_ts=","),null==e.attr.fmt_n_ds&&(e.attr.fmt_n_ds="."));"NUMBER"==f?e.attr.fmt_n=""==defaultNumberFormat||null==defaultNumberFormat?"#"+(null==e.attr.fmt_n_ts?",":e.attr.fmt_n_ts)+"###"+(null==e.attr.fmt_n_ds?".":e.attr.fmt_n_ds)+"#####":defaultNumberFormat:"PERCENTAGE"==f&&(e.attr.fmt_n="0%")}else"AUTOGEN"==d?(d="D",this._resetInputType(a,b),e.attr.ag="{0,number,00000}"):"SIG"==d?(d="D",this._resetInputType(a,b),e.attr.sig="1",e.attr.cs="3"):"HTML"==d?
(d="D",this._resetInputType(a,b),e.attr.html=!0):"MONEY"==d?(d="D",this._resetInputType(a,b),a=!1,""!=e.attr.fmt_n_ds&&"."!=e.attr.fmt_n_ds&&""!=defaultDecimalSeparator&&null!=defaultDecimalSeparator&&"."!=defaultDecimalSeparator&&(e.attr.fmt_n_ds=defaultDecimalSeparator,a=!0),""!=e.attr.fmt_n_ts&&"."!=e.attr.fmt_n_ts&&""!=defaultThousandsSeparator&&null!=defaultThousandsSeparator&&"."!=defaultThousandsSeparator&&(e.attr.fmt_n_ts=defaultThousandsSeparator,a=!0),a&&(null==e.attr.fmt_n_ts&&(e.attr.fmt_n_ts=
","),null==e.attr.fmt_n_ds&&(e.attr.fmt_n_ds=".")),e.attr.fmt_n=""==defaultMoneyFormat||null==defaultMoneyFormat?"$#"+(null==e.attr.fmt_n_ts?",":e.attr.fmt_n_ts)+"###"+(null==e.attr.fmt_n_ds?".":e.attr.fmt_n_ds)+"##":defaultMoneyFormat):"FX"==d?(d="D",this._resetInputType(a,b),e.attr.fmt_n="$#,###.#####",e.attr.dv="$CUREURUSD"):"REVIEWER"==d?(d="L",this._resetInputType(a,b),e.attr.usrref=2,e.attr.ifReadInfo="1"):"EMAIL"==d?(d="D",this._resetInputType(a,b),e.attr.email="2"):"PHONE"==d?(d="D",this._resetInputType(a,
b),e.attr.phone="1",e.attr.phonefmt="XXXXXXXXXX"):"ACTION_BARCODE"==d?(d="D",this._resetInputType(a,b),e.attr.barcode="1",e.attr.bc_type="QR Code",e.attr.bc_action="0"):"FORMATTED"==d?(d="D",this._resetInputType(a,b),e.attr.phone="2"):"ADDR"==d?(d="D",this._resetInputType(a,b),e.attr.addr="1"):"URL"==d?(d="D",this._resetInputType(a,b),e.attr.url="1"):"BARCODE"==d?(d="D",this._resetInputType(a,b),e.attr.barcode="1",e.attr.bc_type="Code 128",e.attr.bc_append_text=!0):"MASKED"==d?(d="D",this._resetInputType(a,
b),e.attr.masked=!0):"D"==d?(this._resetInputType(a,b),e.attr.text="1"):"G"==d?(this._resetInputType(a,b),e.attr.multipleImages=!0):"U"==d?(this._resetInputType(a,b),e.attr.multipleFiles=!0):this._resetInputType(a,b);e.IPType=d}else if("rf"==c)d&&0<d.length?(e.attr.rf=e.domainId,e.domainId=d):(e.domainId=e.attr.rf,delete e.attr.rf);else if("ei"==c)a=parseInt(d),e.domainId=a,$("at_spid").value=a;else if("lov"===c){d=unformatNUIAttr(d).replace(/,/g,"&#44;").replace(/%7C/g,"|").replace(/&#60;/g,"<").replace(/&#62;/g,
">").trim().split(ctrl.CRLF);for(a=0;a<d.length;a++)d[a]&&d[a].trim&&(d[a]=d[a].trim());e.domainId?this.selections[e.domainId]=d:this.selections[e.x+"|"+e.y]=d}else if("f"===c){var g=$("formula__hint");g.style.color="red";g.style.fontWeight="bold";var k=!1;rm(g);var l=formulaBuilder._findChangeCellNamesInfo(d.toUpperCase());d.trim()&&(this.bindCustomConstant(),function(){var a=l.reduce(function(a,b){return a+"var "+b.cellName+";"},"");try{eval(a),eval(getStandardFormula(d))}catch(v){v instanceof SyntaxError?
(g.textContent=lm.formulaSyntaxErr,k=!0):v instanceof ReferenceError&&(a=/(.*?) is not defined/.exec(v.message),Array.isArray(a)&&(g.innerHTML=lm.formulaReferenceErr.replaceAll("{0}",a[1]),k=!0))}}());if(!k)for(f=0;f<l.length;f++)if(l[f].shouldCheckExists){var m=l[f].cellName,n=getPositionFromCellName(m);if(!builder.cellData.hasOwnProperty(n[0]+","+n[1])){g.textContent=lm.formulaAssignLocErr.replace("{0}",m);k=!0;break}}k||(builder.formulaRel.addFCellRec(a+","+b,d),0===d.trim().length?(e.hasAttribute("f")&&
delete e.attr.f,e.hasAttribute("fdom")&&delete e.attr.fdom):builder.formulaRel.check(e.x,e.y)?(e.attr.f=d,e.attr.fdom=formulaBuilder._translateToDomainRef(d)):builder.formulaRel.delFCellRec(a+","+b),a=$("at_use_dv_f"),a.checked=e.hasAttribute("dv_f")&&e.attr.dv_f.length,a.disabled=e.hasAttribute("f")&&e.attr.f.length||e.IPType===MSELECTOR)}else if("dv"===c)d&&(d=d.trim(),"1"===e.attr.phone&&e.attr.phonefmt&&(d=ragic_phone_reformat(d,e.attr.phonefmt))),d?(e.attr[c]=encHTML(d),e.hasAttribute("dv_f")&&
delete e.attr.dv_f):delete e.attr[c];else if("dv_f"===c){var q=$("dv_f_msg");rm(q);var r=!1,p=formulaBuilder._findChangeCellNamesInfo(d.toUpperCase());d.trim()&&(this.bindCustomConstant(),function(){var a=p.reduce(function(a,b){return a+"var "+b.cellName+";"},"");try{eval(a),eval(getStandardFormula(d))}catch(v){v instanceof SyntaxError?(q.textContent=lm.formulaSyntaxErr,r=!0):v instanceof ReferenceError&&(a=/(.*?) is not defined/.exec(v.message),Array.isArray(a)&&(q.innerHTML=lm.formulaReferenceErr.replaceAll("{0}",
a[1]),r=!0))}}());if(!r)for(f=0;f<p.length;f++)if(p[f].shouldCheckExists&&(m=p[f].cellName,n=getPositionFromCellName(m),!builder.cellData.hasOwnProperty(n[0]+","+n[1]))){q.textContent=lm.formulaAssignLocErr.replace("{0}",m);r=!0;break}r||(builder.formulaRel.addFCellRec(a+","+b,d),0===d.trim().length?(e.hasAttribute("dv_f")&&delete e.attr.dv_f,e.hasAttribute("fdom")&&delete e.attr.fdom):builder.formulaRel.check(e.x,e.y,q)?(e.attr.dv_f=d,e.hasAttribute("dv")&&delete e.attr.dv,e.attr.fdom=formulaBuilder._translateToDomainRef(d)):
builder.formulaRel.delFCellRec(a+","+b),$("at_f").disabled=e.attr.dv_f)}else if("va"==c){try{f=new RegExp(d)}catch(t){floatWinWarning("RegExp SyntaxError : "+d.replace(/</g,"&lt;").replace(/>/g,"&gt;"))}f?e.attr.va=d:delete e.attr.va}else if("va_cust_msg"==c)null!=d&&""!=d?e.attr.va_cust_msg=d:delete e.attr.va_cust_msg;else if("cs"==c){if(!builder.cellData[e.x+1+","+e.y]&&!isCellColspanSpreadable(e.x,e.y,d)){$("at_cs").value=e.attr.cs;return}if(e.attr[c])for(a=1,b=e.attr[c];a<=b;a++)(f=nui.main.nuicelltable.rows[e.y])&&
f.cells&&!(0>e.x)&&f.cells[e.x+a]&&(f.cells[e.x+a].style.display="");if(d){e.attr[c]=d;a=!1;for(b=0;b<builder.colSpanCells.length;b++)f=builder.colSpanCells[b],f.x==e.x&&f.y==e.y&&(a=!0);a||builder.colSpanCells.push(e)}else delete e.attr[c];shiftFormula()}else"hide"==c?d?(e.attr[c]=d,e.render(),nui._updateFocus()):delete e.attr[c]:"bc_type"==c?(a=d.split("|")[0],e.attr.bc_type=a):"bc_append_text"==c?e.attr.bc_append_text=""+d:"noSyncName"==c?e.attr[c]=d:e&&(d?e.attr[c]=d:delete e.attr[c]);e&&("it"!=
c&&"cs"!=c&&"hide"!=c&&"ro"!=c&&"must"!=c&&"fmt_n"!=c&&"fmt_d"!=c&&"dv"!=c&&"f"!=c&&"dv_f"!=c&&"phonefmt"!=c&&"noDup"!=c&&"bc_type"!=c||e.render(),builder.saveStep())}};DesignModeBuilder.prototype.bindCustomConstant=function(){if(this.globalConst)for(var a in this.globalConst)window[a]=this.globalConst[a]};
DesignModeBuilder.prototype.replaceListenTo=function(a,b){var c=this.cellData,d;for(d in c)if(c&&c[d]&&c[d].value){var e=c[d];e.hasAttribute("l")&&e.attr.l==a&&(e.attr.l=b);e.hasAttribute("ln")&&e.attr.ln==a&&(e.attr.ln=b)}};DesignModeBuilder.prototype.setRights=function(a,b){0==b&&(b="0");this.unsave=!0;this.rights[a]=b};DesignModeBuilder.prototype.setRightsConfig=function(a,b,c){a&&(this.unsave=!0,this.rightsDetail[a]||(this.rightsDetail[a]=[0,0]),this.rightsDetail[a][b]=c?0:1)};
DesignModeBuilder.prototype.load=function(a,b,c){this.unsave=!1;var d=builder,e={};if(d.versionLoaded&&d.cellData)for(var f in d.cellData){var g=d.cellData[f];g.domainId&&(e[g.domainId]=g)}d.cellData={};d.fieldDomainIdExist=[];d.relativePositions={};d.absolutePositions={};d.colSpanCells=[];d.rights={};d.rightsDetail={};d.filters={};d.selections={};d.approvalItems=[];d.cascadedSelections={};d.autoGenRef={};d.actionButtons={};d.templates={};d.widgets=[];d.custFieldsSets={};d.reminders=[];d.sections=
{};d.msg={};d.ecmsg={};d.wfmsg={};d.formulaRel=new FormulaRel;d.titleField=null;d.selectionField=null;d.keyField=-1;d.subtableKeys={};d.subtableAliasParents={};d.subtableReferenceURL={};d.subtableFpUrls={};d.subtableAliasOfParentSheet=[];d.formDeleteType=null;d.deleteType=null;d.level3=null;d.newForm=!1;d.createAsListingPage=!1;d.emailTemplates=[];d.custAppSeqItems=[];d.autoSave=!1;d.freezeX=0;d.freezeY=0;this.saveVersion=!1;d.rights.EVERYONE="0";d.rights.USER=3;d.rights.MANAGER=6;d.freeData={};d.tempDragDropShiftRow=
-1;biffdata=new BiffData;biffdata.widthCommand=null;biffdata.heightCommand=null;loadRightsSetting();b&&(undoSteps=[],redoSteps=[]);if(a.split){f=a.split("\n");a=ctrl.NUIColNum;b=ctrl.builderRowNum;var k=!0,l=!1,m=!1,n=!1,q=!1;d.preworkflow="";d.postworkflow="";d.sheetScope="";d.approvalflow="";d.approvalType=null;d.approvalFlag=null;d.approvalCC=[];d.executeActionButtonAfterApproval=[];d.custQueryItems="";d.cascadingFormulaRecal=!1;d.recalParentFormula=!0;d.hideEmailHistory=!1;d.addParentEntryManager=
!1;d.bbcodeImage=null;RagicInteractiveRules.loadRules("");var r={};for(g=0;g<f.length;r={$jscomp$loop$prop$defaultSortings$611:r.$jscomp$loop$prop$defaultSortings$611,$jscomp$loop$prop$defaultFilters$612:r.$jscomp$loop$prop$defaultFilters$612},g++)if(f[g].startsWith("CUST_QUERY_ITEMS"))d.custQueryItems=f[g].split("=")[1];else if(f[g].startsWith("CUST_THEME="))d.custTheme=f[g].split("=")[1];else if(f[g].startsWith("CASCADING_FORMULA_RECAL")){var p=f[g].split("=")[1];d.cascadingFormulaRecal="true"==
p}else if(f[g].startsWith("RECAL_PARENT_FORMULA"))p=f[g].split("=")[1],d.recalParentFormula="true"==p;else if(f[g].startsWith("HIDE_EMAIL_HISTORY"))p=f[g].split("=")[1],d.hideEmailHistory="true"==p;else if(f[g].startsWith("ADD_PARENT_ENTRY_MANAGER"))p=f[g].split("=")[1],d.addParentEntryManager="true"==p;else if("SHEET_SCOPE_START"===f[g])n=!0,q=m=l=!1;else if("PRE_WORKFLOW_START"===f[g])l=n=!1,m=!0,q=!1;else if("SCRIPT_START"===f[g])m=n=!1,l=!0,q=!1;else if("APPROVAL_START"===f[g])l=m=n=!1,q=!0;else if(n)d.sheetScope+=
f[g]+"\n";else if(m)d.preworkflow+=f[g]+"\n";else if(l)d.postworkflow+=f[g]+"\n";else if(q)d.approvalflow+=f[g]+"\n";else if(p=f[g].split(","),"W"===p[0])1<p.length&&(biffdata.widthCommand=p[1]),2<p.length&&(biffdata.heightCommand=p[2]),builder.hiddenColumnIndex=findAllHiddenColumnIndexs();else if("S"===p[0]){var t=void 0,v=[];if(p[2]&&0<p[2].length)this.selections[p[1]]="";else{for(t=3;t<p.length;t++){var u=unformatNUIAttr(p[t]);u=u.replace(/&#60;/g,"<");u=u.replace(/&#62;/g,">");v.push(u)}this.selections[p[1]]=
v}}else if("S2"===p[0]){t={};for(u=4;u<p.length;u++)if(p[u]){var x=unformatNUIAttr(p[u]).split("|");2>x.length||(v=x[0].replace(/%7C/g,"|"),x=x[1].replace(/%7C/g,"|"),t.hasOwnProperty(v)||(t[v]=[]),t[v].push(x))}this.cascadedSelections[p[1]]={pdomainid:p[2],avaliable:!0,collection:t}}else if("K"===p[0])p=f[g].substring(f[g].indexOf(",")+1),p=JSON.parse(p),p.seq=parseInt(p.seq),p.id=parseInt(p.id),p.confirmBeforeAction="true"===p.confirmBeforeAction||!0===p.confirmBeforeAction,p.needApproval="true"===
p.needApproval||!0===p.needApproval,p.hideButton="true"===p.hideButton||!0===p.hideButton,null===p.userGroups&&(p.userGroups=["EVERYONE"]),p.checkIfUserCanEdit=null!=p.checkIfUserCanEdit&&JSON.parse(p.checkIfUserCanEdit),this.actionButtons[p.seq]=p;else if("ACTION_BUTTON_MAX_ID"===p[0])this.maxButtonId=parseInt(p[1]);else if("RMD"===p[0]){t=p[2];for(var E in builder.cellData)if(v=builder.cellData[E],v.domainId===t&&v.attr&&v.attr.fmt_d){t=new Reminder(unformatNUIAttr(p[1]),t,parseInt(p[3]),p[4],p[5],
parseInt(p[6]));7<p.length&&(t.emailMode=p[7]);8<p.length&&(t.custReplyTo=p[8]);t.createTaskWhenRecordSaved=9<p.length?JSON.parse(p[9]):!0;t.originalSeq=10<p.length?parseInt(p[10]):t.seq;t.viewId=11<p.length?parseInt(p[11]):-1;this.reminders.push(t);break}}else if("RMD_MAX_SEQ"===p[0])this.maxRmdSeq=parseInt(p[1]);else if("AGR"===p[0])for(t=void 0,v=1;v<p.length;v++)t=p[v].split("|"),2>t.length||(this.autoGenRef[parseInt(t[0])]=parseInt(t[1]));else if("ALIAS_OF_PARENT"===p[0])for(t=1;t<p.length;t++)this.subtableAliasOfParentSheet.push(parseInt(p[t]));
else if("SEC"===p[0])this.sections=JSON.parse(decodeURIComponent(p[1])),this.hasSections()&&(this.sections.sections[0].display=!0,nui.loadOpenedSectionCache());else if("IR"===p[0])this.conditionalFormattingString=p[1],RagicInteractiveRules.loadRules(this.conditionalFormattingString);else if("N"===p[0])c||(this.newName=decHTML(p[1]).replace(/&#44;/gim,",")),2<p.length&&(this.formDesc=p[2].replace(/<br\s*(\/)?>/g,"\n"))&&this.formDesc.replace(/&#44;/gim,",");else if("TF"===p[0])this.titleField=parseInt(p[1]);
else if("KF"===p[0])this.keyField=parseInt(p[1]),this.rootDomainId=parseInt(p[1]),k=!1;else if("ST"===p[0])t=(p[6]||"").split("&"),r.$jscomp$loop$prop$defaultFilters$612=[],r.$jscomp$loop$prop$defaultSortings$611=[],t.forEach(function(a){return function(b){b=new FilterItem(b);21<=b.operator&&24>=b.operator?a.$jscomp$loop$prop$defaultSortings$611.push([b.domainId,21===b.operator||23===b.operator?1:2]):0<b.operator&&a.$jscomp$loop$prop$defaultFilters$612.push(b)}}(r)),t=new Subtable({x:+p[1],y:+p[2],
domainId:+p[3],domainIdAlias:p[4]||-1,defaultFilters:r.$jscomp$loop$prop$defaultFilters$612,defaultSortings:r.$jscomp$loop$prop$defaultSortings$611,keyUrl:p[5]||""}),biffdata.subtables.push(t),this.subtableKeys[p[1]+","+p[2]]=parseInt(p[3]),4<p.length&&(this.subtableAliasParents[p[1]+","+p[2]]=parseInt(p[4])),5<p.length&&(this.subtableReferenceURL[p[1]+","+p[2]]=p[5]),6<p.length&&(this.subtableFilter[p[1]+","+p[2]]=p[6]),7<p.length&&(this.subtableFpUrls[p[1]+","+p[2]]=p[7]);else if("SF"===p[0])this.selectionField=
parseInt(p[1]);else if("FS"===p[0])this.deleteType=parseInt(p[1]);else if("DS"===p[0])this.formDeleteType=parseInt(p[1]);else if("CR"===p[0]){t=new Template(p[1],p[2],p[3]);t.ifListingMode=4<p.length?"true"===p[4]:!1;t.displayButton=!t.ifListingMode;try{t.displayButton=JSON.parse(p[5])}catch(B){}t.userGroups=[];try{p[6]&&(t.userGroups=JSON.parse(p[6].replace(/`/g,",")))}catch(B){}t.maintainImgAspectRatio=!1;try{t.maintainImgAspectRatio=JSON.parse(p[7])}catch(B){}t.fileNameRefDomainId=-1;try{var D=
parseInt(JSON.parse(p[8]));t.fileNameRefDomainId=isNaN(D)?-1:D}catch(B){}this.templates[p[1]]=t}else if("DCF"===p[0])this.custFieldsSets[p[1]]=new CustFieldsSet(p[1],p[2],p[3]);else if("L3"===p[0])this.level3=p[1];else if("NEWFORM"===p[0])this.newForm=!0;else if("A"===p[0]){x=p[1].split("&");var A;for(A=0;A<x.length;A++){var w=x[A].split("=",2);saveRightsSetting(decodeURIComponent(w[0]),w[1])}d.formType=p[3];BUILDER_EMPTY_CLASS="2"===p[3]?"builderEmptyListing":"builderEmpty"}else if("A2"===p[0])for(x=
p[1].split("&"),A=0;A<x.length;A++)(w=x[A].split("=",2),2>w.length||!(p=w[1]))||("1"===p.charAt(0)&&saveRightsConfigSetting(decodeURIComponent(w[0]),0),"1"===p.charAt(1)&&saveRightsConfigSetting(decodeURIComponent(w[0]),1));else if("F"===p[0]){if(v=p[1],u=p[2],0!=v&&0!=u&&(t=new FreeObject(v,u,fieldHeaderDecode(p[4])),!t.invalid)){x=p[5].split("&");t.action=p[3];for(A=0;A<x.length;A++)if(w=x[A].split("=",2),"actionButton"===w[0])try{var F=x[A].substring(x[A].indexOf("=")+1);t.actionButton=JSON.parse(unformatNUIAttr(F))}catch(B){}else"actionButtonId"===
w[0]?t.actionButtonId=w[1]:t.styling[w[0]]=w[1];d.freeData[v+","+u]=t;parseInt(v)>a&&(a=parseInt(v));parseInt(u)>b&&(b=parseInt(u))}}else if("X"===p[0])"1"===p[2]&&biffdata.filterStatus.addFilters(p[3]);else if("MSG"===p[0])d.msg.type=p[1],p.shift(),p.shift(),d.msg.text=p.join(",").split("\t").join(ctrl.CRLF);else if("ecMSG"===p[0])d.ecmsg.type=p[1],p.shift(),p.shift(),d.ecmsg.text=p.join(",").split("\t").join(ctrl.CRLF);else if("wfMSG"===p[0])d.wfmsg.type=p[1],p.shift(),p.shift(),d.wfmsg.text=p.join(",").split("\t").join(ctrl.CRLF);
else if("WF"===p[0]){if(this.approvalType=p[1],this.approvalFlag=getStdApprovalFlag(p[2]),3<p.length)for(t=3,v=p.length;t<v;t++)if(""!==p[t])if(u=p[t].split("|"),x=3<u.length?u[3]:"","M"===u[1])for(A=JSON.parse(decodeURIComponent(u[2])),w=0;w<A.length;w++){var C=A[w];if(0===w){var z=new ApprovalStep(u[0],C.transactorType,C.transactor,x);C.thresholdNum&&1<=C.thresholdNum&&z.setThresholdNum(C.thresholdNum)}else z=new ApprovalStep("",C.transactorType,C.transactor,""),z.setIfSource(!1);this.approvalItems.push(z)}else this.approvalItems.push(new ApprovalStep(u[0],
u[1],u[2],x))}else if("WF2"===p[0]){var J=0;for(t=1;t<p.length;t++)(v=p[t])?(u=JSON.parse(decodeURIComponent(v)),Array.isArray(u)?u.forEach(function(a){a.rules?this.approvalItems[J].setApprovalRules(encodeURIComponent(JSON.stringify(a))):this.approvalItems[J].setApprovalRules("");J++}.bind(this)):(this.approvalItems[J].setApprovalRules(v),J++)):(this.approvalItems[J].setApprovalRules(v),J++)}else if("WF_CC"===p[0])p.forEach(function(a,b){0<b&&this.approvalCC.push(a)}.bind(this));else if("WF_EXECUTE"===
p[0])p.forEach(function(a,b){0<b&&this.executeActionButtonAfterApproval.push(a)}.bind(this));else if("D"===p[0]||"L"===p[0]||"U"===p[0]||"G"===p[0]||"M"===p[0])t=new BuilderObject(p[1],p[2],fieldHeaderDecode(p[4]),p[0],p[3],p[5]),t.invalid||(k&&(t.key=!0,d.rootDomainId=t.domainId,k=!1),t.hasAttribute("cs")&&d.colSpanCells.push(t),d.cellData[p[1]+","+p[2]]=t,d.fieldDomainIdExist.push(parseInt(p[3])),t=parseInt(p[2]),t>b&&(b=t),p=parseInt(p[1]),p+=d.getColumnSpanTotal(p,t),p>a&&(a=p));else if("ET"===
p[0])for(this.emailTemplates=JSON.parse(decodeURIComponent(p[1].replace(/\+/g,"%20"))),p=0;p<this.emailTemplates.length;p++)this.emailTemplates[p].attributes||(this.emailTemplates[p].attributes={type:"ticket"});else"WIDGET"===p[0]?(v=parseInt(p[1]),u=parseInt(p[2]),t=parseInt(p[3]),x=parseInt(p[4]),p=JSON.parse(decodeURIComponent(p[5])),p.layout.width=t,p.layout.height=x,p.layout.x=v,p.layout.y=u,this.widgets.push(p)):"APPSEQ"===p[0]?this.custAppSeqItems=JSON.parse(decodeURIComponent(p[1])):"FZ"===
p[0]?(p=p[1].split("|").map(Number),this.freezeX=p[0],this.freezeY=p[1]):"PAY"===p[0]?(this.paymentAmountField=p[1],this.paymentCurrency=p[2],this.stripeUserId=p[3],void 0!==p[4]&&null!==p[4]&&(this.checkoutText=unformatNUIAttr(p[4]))):"AUTOSAVE"===p[0]&&"1"==p[1]?this.autoSave=!0:"GCONST"===p[0]&&(this.globalConst=JSON.parse(f[g].substring(f[g].indexOf(",")+1)));$("autoSaveCheckbox").checked=this.autoSave;for(var L in d.cellData)if((t=d.cellData[L])&&(t.hasAttribute("f")||t.hasAttribute("dv_f"))&&
(t.hasAttribute("f")&&t.hasAttribute("dv_f")&&delete t.attr.dv_f,c=t.attr.f||t.attr.dv_f,builder.formulaRel.addFCellRec(t.x+","+t.y,c),t.attr.fdom=formulaBuilder._translateToDomainRef(c)),D=e[t.domainId])"L"===D.IPType&&"D"===t.IPType?(c=D.attr?D.attr.s:null,E=D.attr?D.attr.stf:null,D=D.attr?D.attr.mvp:null,c&&E&&D&&d.addLinkAndLoadAction("REMOVE",t.domainId,E,c,D)):"D"===D.IPType&&"L"===t.IPType?(c=t.attr?t.attr.s:null,E=t.attr?t.attr.stf:null,D=t.attr?t.attr.mvp:null,c&&E&&D&&d.addLinkAndLoadAction("ADD",
t.domainId,E,c,D)):"L"===D.IPType&&"L"===t.IPType&&(c=D.attr?D.attr.s:null,E=D.attr?D.attr.stf:null,D=D.attr?D.attr.mvp:null,F=t.attr?t.attr.s:null,f=t.attr?t.attr.stf:null,g=t.attr?t.attr.mvp:null,c&&E&&D&&F&&f&&g&&(F!=c||f!=E||g!=D)&&(d.addLinkAndLoadAction("REMOVE",t.domainId,E,c,D),d.addLinkAndLoadAction("ADD",t.domainId,f,F,g)));d.newName||(d.newName=sheet.split("_")[1],d.newName=d.newName.replace(/\+/g," "));builder.maxX=a;builder.maxY=b;d.renderAll();updateCsTranslatedMapAll();loadingBox&&
(loadingBox.style.display="none");builder.ifListingPage()||biffdata.keyField||(biffdata.subtables=Object.values(builder.cellData).filter(function(a){return a.isSubtableFirstField()}).map(function(a){return new Subtable(a)}))}};DesignModeBuilder.prototype.getColumnSpanTotal=function(a,b){for(var c,d=builder.colSpanCells,e=0,f=0;f<d.length;f++)c=d[f],c.y==b&&c.x<a&&c.hasAttribute("cs")&&(this.cellData[c.x+1+","+c.y]||this.cellData[c.x-1+","+c.y])&&(e+=parseInt(c.attr.cs)-1);return e};
DesignModeBuilder.prototype.applyRightString=function(a){a=a.split("&");var b;for(b=0;b<a.length;b++){var c=a[b].split("=",2);saveRightsSetting(c[0],c[1])}};DesignModeBuilder.prototype.syncCurrentCellData=function(){var a=builder.cellData[nui.fcol+","+nui.frow];a||(a=builder.freeData[nui.fcol+","+nui.frow]);a&&$("hin").setValue(a.value)};DesignModeBuilder.prototype.ifEmpty=function(){return 0===Object.keys(builder.cellData).length&&0===Object.keys(builder.freeData).length};
DesignModeBuilder.prototype.getField=function(a){for(var b in builder.cellData){var c=builder.cellData[b];if(c.domainId==a)return c}};
DesignModeBuilder.prototype.clearDomainIds=function(){builder.keyField=-1;builder.rootDomainId=-1;builder.titleField=-1;builder.selectionField=-1;var a={};for(e in builder.selections){var b=builder.selections[e],c=builder.getField(e);a[c.x+"|"+c.y]=b}builder.selections=a;a={};for(var d in builder.cellData){var e=builder.cellData[d];e.hasAttribute("l")&&(b=e.attr.l,a.hasOwnProperty(b)?c=a[b]:(c=(c=builder.findField(b))?c.x+"|"+c.y:null)&&(a[b]=c),e.attr.l=c)}for(var f in builder.cellData)builder.cellData[f].domainId=
null;builder.subtableKeys={};builder.subtableAliasParents={};builder.subtableReferenceURL={};builder.subtableFpUrls={}};DesignModeBuilder.prototype.numOfShiftNeeded=function(a,b,c){c||(c=1);if(1==c)return builder.cellData[a+","+b]||builder.freeData[a+","+b]?1:-1;for(var d=0;0<c;){if(builder.cellData[a+","+(b+d)]||builder.freeData[a+","+(b+d)])return c;d++;c--}return-2};
DesignModeBuilder.prototype.renderAll=function(){var a=nui.main.scrollTop,b=nui.main.scrollLeft;nui.init(builder.maxY+20,builder.maxX+5);displayNUIHeader();shiftFormula();processWidth(biffdata.widthCommand,biffdata.heightCommand);var c=builder.cellData,d=builder.freeData,e;for(e in c)c&&c[e]&&c[e].value&&(c[e].render(),e.split(","));for(e in d)d&&d[e]&&d[e].render();builder.renderAllWidgets();builder.custTheme&&CustThemeHelper.applyTheme(builder.custTheme);nui._updateFocus();nui.main.scrollTop=a;
nui.main.scrollLeft=b;ctrl.isIE||(nui.freezeX(1),nui.freezeY(1))};DesignModeBuilder.prototype.insertWidget=function(){builder.widgets.push(getDefaultWidgetConfig());builder.renderAllWidgets()};
DesignModeBuilder.prototype.renderAllWidgets=function(){builder.widgets&&loadChartingLibrary(function(){resetWidgetsBuilder();for(var a={},b=0;b<builder.widgets.length;a={$jscomp$loop$prop$widget$615:a.$jscomp$loop$prop$widget$615},b++)a.$jscomp$loop$prop$widget$615=new ReportWidget(builder.widgets[b]),a.$jscomp$loop$prop$widget$615.callback={deleteCallback:builder.removeWidget.bind(builder,a.$jscomp$loop$prop$widget$615),positionCallback:a.$jscomp$loop$prop$widget$615.positionInBuilder.bind(a.$jscomp$loop$prop$widget$615),
removeSelf:function(a){return function(){a.$jscomp$loop$prop$widget$615.disposeCharts();nui.main.removeChild(a.$jscomp$loop$prop$widget$615.div)}}(a),mouseDownCallback:function(a){return function(b){disableSelection(document.body);b&&(b.cancelBubble=!0);b&&b.target&&"miniReportName"===b.target.className||(20>this.offsetWidth-b.offsetX&&20>this.offsetHeight-b.offsetY?ctrl.widgetResize=!0:(ctrl.builderWidgetMoveStart=a.$jscomp$loop$prop$widget$615,ctrl.builderWidgetMoveFromX=a.$jscomp$loop$prop$widget$615.config.layout.x,
ctrl.builderWidgetMoveFromY=a.$jscomp$loop$prop$widget$615.config.layout.y,ctrl.dragStartX=b.clientX,ctrl.dragStartY=b.clientY))}}(a),mouseUpCallback:function(a){enableSelection(document.body);a&&(a.cancelBubble=!0);if(ctrl.builderWidgetMoveStart)ctrl.builderWidgetMoveStart=null,ctrl.builderWidgetMoveFromX=null,ctrl.builderWidgetMoveFromY=null,ctrl.dragStartX=null,ctrl.dragStartY=null;else if(ctrl.widgetResize){a=this.widget.config;var b=this.offsetWidth-16,c=this.offsetHeight-16;150>b&&(b=150);150>
c&&(c=150);a.layout.width=b;a.layout.height=c;this.widget.positionInBuilder()}}},a.$jscomp$loop$prop$widget$615.renderConfigUI()})};DesignModeBuilder.prototype.removeWidget=function(a){a.callback.removeSelf();for(var b=0;b<builder.widgets.length;b++)if(builder.widgets[b].id===a.config.id){builder.widgets.splice(b,1);break}};
DesignModeBuilder.prototype.createNUI=function(a){a=a||!1;var b=this.cellData,c=builder.freeData;shiftFormula();var d,e="A,",f=!0;for(p in this.rights)f||(e+="&"),e+=encodeURIComponent(p)+"="+this.rights[p],f&&(f=!1);f&&(e+="EVERYONE=3");e+="\n";var g="A2,";f=!0;for(d in this.rightsDetail)f||(g+="&"),g+=encodeURIComponent(d)+"="+this.rightsDetail[d][0]+this.rightsDetail[d][1],f&&(f=!1);"A2,"!==g&&(e+=g+"\n");this.newName&&(a?e+="N,\n":(this.formDesc&&(this.formDesc=this.formDesc.replace(/,/gim,"&#44;")),
e+="N,"+unescapeHTML(this.newName).replace(/,/gim,"&#44;")+","+this.formDesc+"\n"));e=a?e+"W,,\n":e+("W,"+(biffdata.widthCommand?biffdata.widthCommand:"")+","+(biffdata.heightCommand?biffdata.heightCommand:"")+"\n");this.titleField&&(e+="TF,"+this.titleField+"\n");if(this.keyField&&-1!==this.keyField&&(e+="KF,"+this.keyField+"\n",!builder.ifListingPage()))for(var k in this.subtableKeys){f=this.subtableAliasParents[k];g=this.subtableReferenceURL[k];var l=this.subtableFilter[k],m=this.subtableFpUrls[k];
e+="ST,"+k+","+this.subtableKeys[k]+(f?","+f:",")+(g?","+g:",")+(l?","+l:",")+(m?","+m:"")+"\n"}this.selectionField&&(e+="SF,"+this.selectionField+"\n");this.deleteType&&(e+="FS,"+this.deleteType+"\n");this.formDeleteType&&(e+="DS,"+this.formDeleteType+"\n");for(q in this.cascadedSelections)if(k=this.cascadedSelections[q],k.avaliable){this.selections[q]=[];this.selections.hasOwnProperty(q)&&delete this.selections[q];e+="S2,"+q+","+k.pdomainid+",";f={};for(var n in k.collection)f.$jscomp$loop$prop$parentOpt$617=
n,k.collection[f.$jscomp$loop$prop$parentOpt$617].forEach(function(a){return function(b){e+=","+a.$jscomp$loop$prop$parentOpt$617.replace(/\|/g,"%7C").replace(/,/g,"&#44;")+"|"+b.replace(/,/g,"&#44;").replace(/\|/g,"%7C")}}(f)),f={$jscomp$loop$prop$parentOpt$617:f.$jscomp$loop$prop$parentOpt$617};e+="\n"}else delete this.cascadedSelections[q];for(q in this.selections)q&&this.selections[q]&&(e=a?e+("S,,,"+this.selections[q].join(",")+"\n"):e+("S,"+q+",,"+this.selections[q].join(",")+"\n"));var q=0;
for(p in b)if(b[p]){if(a){n=b[p].outputLine().split(",");for(var r in n)e="3"===r?e+",":"0"===r?e+n[r]:e+(","+n[r])}else e+=b[p].outputLine();q++}for(p in c)c[p]&&(e+=c[p].outputLine());builder.hasSections()&&(a=deepCopy(builder.sections),a.sections.forEach(function(a){a.hasOwnProperty("display")&&delete a.display}),e+="SEC,"+encodeURIComponent(JSON.stringify(a))+"\n");for(d in this.filters)e+="X,fixed,1,"+this.filters[d]+"\n";this.approvalType&&(a=getValidApprovalSourceArray(),b=a.map(function(a){if(1===
a.length)return a=a[0],a.name+"|"+a.transactorType+"|"+a.transactor+"|"+(a.stepId?a.stepId:"");if(1<a.length){var b=[],c;a.forEach(function(a,d){var e={};0===d&&(e.thresholdNum=a.thresholdNum,c=a.stepId?a.stepId:"");e.transactor=a.transactor;e.transactorType=a.transactorType;b.push(e)});return a[0].name+"|M|"+encodeURIComponent(JSON.stringify(b))+"|"+c}return""}).join(","),b.length&&(e+="WF,"+this.approvalType+","+this.approvalFlag+","+b+"\n"),a.some(function(a){for(var b=0;b<a.length;b++)if(0<a[b].approvalRules.length)return!0;
return!1})&&(a=a.map(function(a){if(1===a.length)return a[0].approvalRules;if(1<a.length){var b=[];a.forEach(function(a){a.approvalRules?b.push(JSON.parse(decodeURIComponent(a.approvalRules))):b.push({})});return encodeURIComponent(JSON.stringify(b))}return""}).join(","),a.trim().length&&(e+="WF2,"+a+"\n")),0<this.approvalCC.length&&(a=this.approvalCC.join(","),e+="WF_CC,"+a+"\n"),0<this.executeActionButtonAfterApproval.length&&(a=this.executeActionButtonAfterApproval.join(","),e+="WF_EXECUTE,"+a+
"\n"));for(d in this.actionButtons)a=JSON.parse(JSON.stringify(this.actionButtons[d])),a.id+="",a.seq+="",a.confirmBeforeAction+="",a.needApproval+="",a.hideButton+="",e+="K,"+JSON.stringify(a)+"\n";e+="ACTION_BUTTON_MAX_ID,"+this.maxButtonId+"\n";for(d in this.templates){a=this.templates[d];b=null==a.ifListingMode?!1:a.ifListingMode;c=!b;try{null!=a.displayButton&&(c=JSON.parse(a.displayButton))}catch(t){}var p="";try{a.userGroups&&(p=JSON.stringify(a.userGroups).replace(/,/g,"`"))}catch(t){}r=!1;
try{r=!!a.maintainImgAspectRatio}catch(t){}q=-1;try{q=isNaN(a.fileNameRefDomainId)?-1:a.fileNameRefDomainId,builder.findField(q)||(q=-1)}catch(t){}e+="CR,"+a.id+","+a.name+","+a.file+","+b+","+c+","+p+","+r+","+q+"\n"}for(a=0;a<this.widgets.length;a++)b=this.widgets[a],e+="WIDGET,"+b.layout.x+","+b.layout.y+","+b.layout.width+","+b.layout.height+","+encodeURIComponent(JSON.stringify(b))+"\n";for(d in this.custFieldsSets)a=this.custFieldsSets[d],e+="DCF,"+a.id+","+a.name+","+a.domainIdArray+"\n";a=
"";for(d in this.autoGenRef)a+=(0<a.length?",":"")+d+"|"+this.autoGenRef[d];0<a.length&&(e+="AGR,"+a+"\n");this.reminders.forEach(function(a){a="RMD,"+formatNUIAttr(a.name)+","+a.dateDomainId+","+a.days+","+a.mailDomainId+","+a.otherAddr+","+a.seq+","+(a.emailMode?a.emailMode:"")+","+(a.custReplyTo?a.custReplyTo:"")+","+a.createTaskWhenRecordSaved+","+a.originalSeq+","+a.viewId+"\n";e+=a});e+="RMD_MAX_SEQ,"+this.maxRmdSeq+"\n";this.paymentAmountField&&this.stripeUserId?(this.paymentCurrency||(this.paymentCurrency=
"USD"),e=void 0===this.checkoutText||null===this.checkoutText||""===this.checkoutText.trim()?e+("PAY,"+this.paymentAmountField+","+this.paymentCurrency+","+this.stripeUserId+"\n"):e+("PAY,"+this.paymentAmountField+","+this.paymentCurrency+","+this.stripeUserId+","+formatNUIAttr(this.checkoutText.trim())+"\n")):""===this.paymentAmountField&&""===this.stripeUserId&&(e+="PAY,\n");e=RagicInteractiveRules.rules.length?e+("IR,"+RagicInteractiveRules.toJSONString()+"\n"):e+"IR,\n";this.msg.text&&(e+="MSG,"+
this.msg.type+","+this.msg.text.split("\n").join("\t")+"\n");this.ecmsg.text&&(e+="ecMSG,"+this.ecmsg.type+","+this.ecmsg.text.split("\n").join("\t")+"\n");this.wfmsg.text&&(e+="wfMSG,"+this.wfmsg.type+","+this.wfmsg.text.split("\n").join("\t")+"\n");this.custQueryItems&&(e+="CUST_QUERY_ITEMS="+this.custQueryItems+"\n");e+="CUST_THEME="+(this.custTheme?this.custTheme:"")+"\n";this.cascadingFormulaRecal&&(e+="CASCADING_FORMULA_RECAL="+this.cascadingFormulaRecal+"\n");e=null===this.recalParentFormula?
e+"RECAL_PARENT_FORMULA=true\n":e+("RECAL_PARENT_FORMULA="+this.recalParentFormula+"\n");this.hideEmailHistory&&(e+="HIDE_EMAIL_HISTORY="+this.hideEmailHistory+"\n");this.addParentEntryManager&&(e+="ADD_PARENT_ENTRY_MANAGER="+this.addParentEntryManager+"\n");this.emailTemplates&&(e+="ET,"+encodeURIComponent(JSON.stringify(this.emailTemplates))+"\n");this.custAppSeqItems&&(e+="APPSEQ,"+encodeURIComponent(JSON.stringify(this.custAppSeqItems))+"\n");if(0!==this.freezeX||0!==this.freezeY)e+="FZ,"+this.freezeX+
"|"+this.freezeY+"\n";this.autoSave&&(e+="AUTOSAVE,1\n");this.preworkflow&&(e+="PRE_WORKFLOW_START\n"+this.preworkflow.trim()+"\n");this.postworkflow&&(e+="SCRIPT_START\n"+this.postworkflow.trim()+"\n");this.sheetScope&&(e+="SHEET_SCOPE_START\n"+this.sheetScope.trim()+"\n");this.approvalflow&&(e+="APPROVAL_START\n"+this.approvalflow.trim()+"\n");return e};
DesignModeBuilder.prototype.getObjectCopyString=function(a,b){if(1<ctrl.multiSelected.length){a=-1;b="";for(var c=0;c<ctrl.multiSelected.length;c++){var d=ctrl.multiSelected[c],e=parseInt(d.dataset.x),f=parseInt(d.dataset.y),g="";(d=builder.cellData[e+","+f])?g=d.outputLine(!0):(d=builder.freeData[e+","+f])&&(g=d.outputLine());g=g.substr(0,g.length-1);f==a+1&&(b+="\n");b+=g;c!=ctrl.multiSelected.length-1&&(b+="\t");a=f}return b}return(d=builder.cellData[a+","+b])?(d=d.outputLine(!0),d.substr(0,d.length-
1)):(d=builder.freeData[a+","+b])?(d=d.outputLine(),d.substr(0,d.length-1)):""};DesignModeBuilder.prototype.createDesignHelperStatus=function(){var a=-1,b=-1,c=document.querySelectorAll(".selectedDesignHelperMode");0<c.length&&(a=c[0].id.replace("designHelperMode",""));2==a&&(c=document.querySelectorAll(".activeTab"),0<c.length&&(b=c[0].firstChild.id.replace("prop","")));return a+"|"+b};
DesignModeBuilder.prototype.setDesignHelperStatus=function(a){a=a.split("|");var b=a[1];document.getElementById("designHelperMode"+a[0]).onclick();if(-1!==b&&(a=document.getElementById("prop"+b)))a.onclick()};
DesignModeBuilder.prototype.refreshStartNUI=function(a){if(a){a=a.split("\n");var b=this.createNUI().split("\n"),c=0,d;for(d=0;d<a.length&&a[d];d++){var e=a[d].split(","),f=b[c].split(",");if(e[0]===f[0]){for(var g=0,k=Math.max(e.length,f.length);g<k;g++)void 0===e[g]?e.push(f[g]):""===e[g]&&(e[g]=f[g]);a[d]=e.join(",");c++}}this.startNUI=a.join("\n")}else this.formDesc=this.formDesc.replace(/(\r\n|\n|\r)/gm,"<br />"),this.startNUI=this.createNUI()};
DesignModeBuilder.prototype.loadFromStartNUI=function(){var a=this.keyField,b=this.rootDomainId;this.load(this.startNUI);this.keyField=a;this.rootDomainId=b};
DesignModeBuilder.prototype.saveServer=function(a){this.saveVersion||this.createNUI()===this.startNUI||(this.saveVersion=!0);this.unsave=!1;loadingBox&&(loadingBox.style.display="");$("floatingFormRules").style.display="none";floatWinLoading(lm.designSaving);checkStepIds();this.refreshStartNUI();setTimeout(builder._saveServer.bind(builder),1,a)};
DesignModeBuilder.prototype.switchPage=function(a){var b=builder.createNUI();a||b===builder.startNUI?(builder.ifListingPage()?($("floatingWin").style.display="none",modeBuilder("go")):modeBuilder("back"),nui._focus(1,1)):floatWinConfirmV3(lm.saveDesignBeforeExit,"ctrl.switchAfterDesignerSave=true;saveBuilder();",lm.saveAndExit,"builder.switchPage(true);",lm.exitWithoutSaving)};
DesignModeBuilder.prototype._saveServer=function(a){var b=this.startNUI,c=$("widgetType"),d=$("widgetConfigFile");b={a:ap,p:path,fn:sheet,c:b};this.ifListingPage()?b.suf="_index_t.nui":b.suf=this.level3?this.level3+".nui":"_index.nui";this.saveVersion&&(b.sv=!0);this.newForm&&(b.newForm="");c&&(b.wtype=c.value);a&&(b.mo=!0);builder.linkAndLoadActions&&(b.lnlActs=JSON.stringify(builder.linkAndLoadActions));d&&(b.wcf=d.value);c=Object.values(builder.cellData).filter(function(a){return a&&a.originalValue!==
a.value}).map(function(a){return a.domainId});0<c.length&&(b.ncd=JSON.stringify(c));ctrl.designSavingMain=!0;postPromise("/sims/save_builder.jsp?",b).catch(function(){floatWinLoading(lm.saveRetry);setTimeout(function(){builder._saveServer(a)},5E3)}).then(eval).then(function(){var a=[],b;for(b in ajaxcache)(b.startsWith("/sims/listFields.jsp")||b.startsWith("/sims/options.jsp"))&&a.push(b);for(b=0;b<a.length;b++)delete ajaxcache[a[b]];builder.removeLinkAndLoadActions();return!0}).then(function(){delete ctrl.designSavingMain;
ctrl.exitAfterDesignerSave?backToBrowse(!0):ctrl.switchAfterDesignerSave&&(builder.switchPage(),ctrl.switchAfterDesignerSave=!1);setTimeout(refreshV6Search,100);setTimeout(bounce,2E3,"bDesignHistory");setTimeout(loadRightApproval,2E3);return delay(3E3)}).then(function(){ctrl.designModeSaving=!1})};DesignModeBuilder.prototype.checkIfSysFieldDuplicated=function(a){var b=!1;if(!this.cellData||!a)return b;a=parseInt(a);for(var c in this.cellData)if(parseInt(this.cellData[c].domainId)===a){b=!0;break}return b};
function finishDesignModeServerSave(a){inNUI();if(0<a.length){var b=a[0];"floatWinConfirm"===b.windowType?floatWinConfirmV3(b.content,b.okFunc,b.okText,b.cancelFunc,b.cancelText,b.header,b.func):floatWin(null,b.content,"",!0);a.shift()}else $("floatingWin").style.display="none"}DesignModeBuilder.prototype.ifAdjacent=function(a,b){return this.cellData[a+1+","+b]||this.cellData[a-1+","+b]};
DesignModeBuilder.prototype.ifKey=function(a,b){return-1==this.keyField?this.cellData[a+1+","+b]&&!this.cellData[a-1+","+b]||this.cellData[a+","+b]&&this.cellData[a+","+b].key:!1};
DesignModeBuilder.prototype.moveHeader=function(a,b,c,d){if(a&&b&&c&&d){var e=a+","+b,f=c+","+d,g=this.cellData[e],k=!1;g||(g=this.freeData[e],k=!0);if(g){if(this.ifAdjacent(a,b)&&b==d&&a!=c&&this.cellData[c+","+d]&&!k){delete this.cellData[e];if(this.selections[a+"|"+b]){var l=this.selections[a+"|"+b];delete this.selections[a+"|"+b]}if(this.cascadedSelections[a+"|"+b]){var m=this.cascadedSelections[a+"|"+b];delete this.cascadedSelections[a+"|"+b]}e=0<a-c;for(f=a;f!=c;){k=e?f-1:f+1;var n=this.cellData[k+
","+b];if(n){if(this.cellData[f+","+b]=n,n.x=f,this.selections[k+"|"+b]&&(this.selections[f+"|"+d]=this.selections[k+"|"+b],delete this.selections[k+"|"+b]),this.cascadedSelections[k+"|"+b]&&(this.cascadedSelections[f+"|"+d]=this.cascadedSelections[k+"|"+b],delete this.cascadedSelections[k+"|"+b]),f=k,k==c){this.cellData[k+","+b]=g;g.x=c;l&&(this.selections[c+"|"+d]=l);m&&(this.cascadedSelections[c+"|"+d]=m);for(var q in this.cascadedSelections)if(g=this.cascadedSelections[q],g.pdomainid.endsWith("|"+
d)){try{var r=parseInt(g.pdomainid.split("|")[0])}catch(p){}r==a?g.pdomainid=c+"|"+d:e&&r&&r>=c&&r<a?g.pdomainid=r+1+"|"+d:!e&&r&&r>a&&r<=c&&(g.pdomainid=r-1+"|"+d)}break}}else f=k}}else if(this.isPositionValid(c,d,a,b))if(k)this.freeData[f]=g,delete this.freeData[e],g.x=c,g.y=d,this.updateCustAppSeqItems(c,d,a,b);else{this.cellData[f]=g;delete this.cellData[e];g.x=c;g.y=d;this.selections[a+"|"+b]&&(this.selections[c+"|"+d]=this.selections[a+"|"+b],delete this.selections[a+"|"+b]);this.cascadedSelections[a+
"|"+b]&&(this.cascadedSelections[c+"|"+d]=this.cascadedSelections[a+"|"+b],delete this.cascadedSelections[a+"|"+b]);for(q in builder.cascadedSelections)q&&(r=builder.cascadedSelections[q])&&r.pdomainid==a+"|"+b&&(r.pdomainid=c+"|"+d);for(q in builder.cellData)r=builder.cellData[q],r.attr&&r.attr.l==a+"|"+b&&(r.attr.l=c+"|"+d)}this.repositionSubtableKey();this.renderAll();updateCsTranslatedMap(b);updateCsTranslatedMap(d)}}};
DesignModeBuilder.prototype.undo=function(){if(0<undoSteps.length){var a=undoSteps.pop();a&&(redoSteps.push(a),this.load(a))}};DesignModeBuilder.prototype.redo=function(){if(0<redoSteps.length){var a=redoSteps.pop();a&&(undoSteps.push(a),this.load(a))}};DesignModeBuilder.prototype.saveStep=function(){};DesignModeBuilder.prototype.ifListingPage=function(){return"2"===this.formType};
DesignModeBuilder.prototype.getEmailTemplatesByAttribute=function(a){var b=[];if(this.emailTemplates)for(var c=0;c<this.emailTemplates.length;c++)if(this.emailTemplates[c].attributes){var d=Object.keys(a).length,e=Object.keys(this.emailTemplates[c].attributes).length;if(d===e){d=!0;for(var f in a)if(this.emailTemplates[c].attributes[f]!=a[f]){d=!1;break}d&&b.push(this.emailTemplates[c])}}return b};
DesignModeBuilder.prototype.addEmailTemplate=function(a,b,c,d){for(var e=-1,f=0;f<this.emailTemplates.length;f++)this.emailTemplates[f].id>e&&(e=this.emailTemplates[f].id);a=new EmailTemplate(e+1,a,b,c,d);return this.emailTemplates[this.emailTemplates.length]=a};
DesignModeBuilder.prototype.removeEmailTemplateByAttribute=function(a){if(this.emailTemplates)for(var b=0;b<this.emailTemplates.length;b++)if(this.emailTemplates[b].attributes){var c=Object.keys(a).length,d=Object.keys(this.emailTemplates[b].attributes).length;if(c===d){c=!0;for(var e in a)if(this.emailTemplates[b].attributes[e]!=a[e]){c=!1;break}c&&this.emailTemplates.splice(b,1)}}};
function EmailTemplate(a,b,c,d,e){this.id=a;this.name=b;this.subject=c;this.content=d;this.attributes=e?e:{type:"ticket"};this.att=[]}function setInternalUser(){ajaxpost("/sims/reg/userSetInternal.jsp",{apname:ap,rootNodeId:biffdata.rootNodeId},function(a){a=JSON.parse(a);a.ifSuccess?window.location.href="/"+ap+path+"/1/"+biffdata.rootNodeId:floatWinWarning(decodeURIComponent(a.msg))})}
function checkStepIds(){for(var a=0,b=[],c=0;c<builder.approvalItems.length;c++){var d=builder.approvalItems[c];d.ifSource&&(d.stepId?(d=parseInt(d.stepId),d>a&&(a=d)):b.push(d))}b.forEach(function(b){a++;b.setStepId(a)})}function ApprovalStep(a,b,c,d){this.name=a;this.transactorType=b;this.transactor=c;this.approvalRules="";this.ifSource=!0;this.thresholdNum=-1;d&&(this.stepId=d)}ApprovalStep.prototype.setStepId=function(a){this.stepId=a};
ApprovalStep.prototype.setThresholdNum=function(a){this.thresholdNum=a};ApprovalStep.prototype.setIfSource=function(a){this.ifSource=a};ApprovalStep.prototype.setApprovalRules=function(a){this.approvalRules=a};function Reminder(a,b,c,d,e,f){this.name=a;this.dateDomainId=b;this.days=c;this.mailDomainId=d;this.otherAddr=e;this.seq=f;this.emailMode="SEPARATED";this.createTaskWhenRecordSaved=!0}
function ActionButton(a,b,c,d,e){this.type=b;this.seq=c;this.name=d;this.action=e;this.checkIfUserCanEdit=this.hideButton=this.needApproval=this.confirmBeforeAction=!1;this.userGroups=["EVERYONE"];this.id=a}function FreeObject(a,b,c){this.x=parseInt(a);this.y=parseInt(b);if(1E4<this.x||1E4<this.y)this.y=this.x=-1,this.invalid=!0;this.styling={};this.value=decHTML(c);this.objectType="F";this.oldPos=this.x+","+this.y}
FreeObject.prototype.render=function(){var a=nui._getcell(this.x,this.y,!0);if(a){var b=a.id.split("_"),c=parseInt(b[1]);b=parseInt(b[2]);var d=!1;a.classList.forEach(function(a){a.startsWith("_ragic_theme_")&&(d=!0)});a.builderFreeField=!0;a.ip=new Typer;a.ip.loadValue(this.value);a.ip.cell=a;a.ip.biff=this;a.biff=this;for(var e in a.style)if(e&&a.style[e])try{a.style[e]=null}catch(k){}for(e in this.styling)if(e&&this.styling[e])try{"background"===e&&d||(a.style[e]=this.styling[e],e.startsWith("border"))}catch(k){}ctrl.isIE&&
(a.style.width=0);(e=this.styling.cs)?this.styling.cs=e:(e=determineColspan(c,b,this.value,this.styling),1==e&&(e=null));if(1<=e){var f,g=nui;a.colSpan=e;for(f=1;f<e;f++)g._removecell(c+f,b)}a.ip.render();if(a=retrieveFormulaFromDesc(this.value))this.fdom=formulaBuilder._translateToDomainRef(a)}};FreeObject.prototype.hasAttribute=function(a){return this.hasOwnProperty("style")?this.style.hasOwnProperty(a):!1};
function determineColspan(a,b,c,d){var e=nui._getcell(a,0);if(!e)return 1;var f=node("div");f.style.position="absolute";f.style.top="-1000px";f.style.fontSize="13px";document.body.appendChild(f);builder.bbcodeImage?f.innerHTML=builder.bbcodeImage.getImageHtml():f.textContent=c;if(d)for(var g in d)g&&d[g]&&(f.style[g]=d[g]);c=e.offsetWidth;for(d=1;c<f.offsetWidth+15;){e=nui._getcell(++a,0);if(!e)break;if(builder.cellData[a+","+b]||builder.freeData[a+","+b])break;g=!1;for(var k=0;k<ctrl.TABLE_DEF_ROWS;k++)if(builder.cellData[a+
","+(b-1-k)]&&builder.ifAdjacent(a,b-1-k)){g=!0;break}if(g)break;c+=e.offsetWidth;d++}document.body.removeChild(f);return d}FreeObject.prototype.unrender=function(){var a=nui._getcell(this.x,this.y,!0);a.builderFreeField=!1;rm(a);var b=a.colSpan?parseInt(a.colSpan)||1:1;if(a&&1<b){a.removeAttribute("colspan");for(a=1;a<b;a++)nui._getcell(this.x+a,this.y,!0).style.display="";nui._updateFocus()}};
FreeObject.prototype.outputLine=function(){var a="",b=!0,c;for(c in this.styling)c&&this.styling.hasOwnProperty(c)&&this.styling[c]&&(b||(a+="&"),a+=c+"="+this.styling[c],b&&(b=!1));this.actionButton&&(a+="&actionButtonId="+this.actionButtonId+"&actionButton="+formatNUIAttr(JSON.stringify(this.actionButton)));this.insertImageByUpload&&(a+="&insertImageBy=upload");return"F,"+this.x+","+this.y+","+(this.action?this.action:"")+","+fieldHeaderEncode(this.value)+","+a+"\n"};var BUILDER_HASH=1;
function BuilderObject(a,b,c,d,e,f){this.x=parseInt(a);this.y=parseInt(b);if(1E4<this.x||1E4<this.y)this.y=this.x=-1,this.invalid=!0;this.originalValue=this.value=c;this.IPType=d;this.objectType="B";this.domainId=e;this.hash=formatNumber(BUILDER_HASH++,"000000");this.styling={};this.setAttrStr(f);this.attr&&builder.ifListingPage()&&delete this.attr.cs;this._cache={subtable:null,header:null}}
BuilderObject.prototype.hasAttribute=function(a){return this.hasOwnProperty("attr")?this.attr.hasOwnProperty(a):!1};BuilderObject.prototype.getAttribute=function(a){return this.hasAttribute(a)?this.attr[a]:""};BuilderObject.prototype.isSubtableFirstField=function(){return this.objectType!==FREE&&builder.cellData.hasOwnProperty(this.x+1+","+this.y)&&!builder.cellData.hasOwnProperty(this.x-1+","+this.y)};
BuilderObject.prototype.setAttrStr=function(a,b,c,d){this.attr=this.attr&&this.attr.cs?{cs:this.attr.cs}:{};if(a){a.includes("phone=1")&&!a.includes("phonefmt=")&&(a+="&phonefmt=XXXXXXXXXX");a=a.split("&");var e;for(e=0;e<a.length;e++){var f=a[e].indexOf("="),g=[a[e].substring(0,f),a[e].substring(f+1)],k;f=g[0];if(!c||-1!=c.indexOf(f)){var l="style"===f.substr(0,5);g[1]&&(k=unformatNUIAttr(g[1]));if(b){if(d&&-1!=d.indexOf(f))continue;if("fdom"===f)continue;if("cs"===f){isCellColspanSpreadable(this.x,
this.y,parseInt(k))&&(this.attr.cs=parseInt(k),this.render());continue}if("f"===f||"dv_f"===f){g=k;for(var m=!1,n=formulaBuilder._findChangeCellNames(g.toUpperCase()),q=0;q<n.length;q++){var r=getPositionFromCellName(n[q]);if(!builder.cellData.hasOwnProperty(r[0]+","+r[1])){floatWinWarning(lm.formulaAssignLocErr.replace("{0}",n[q]));m=!0;break}}builder.formulaRel.addFCellRec(this.x+","+this.y,g);0<g.length&&!builder.formulaRel.check()&&(builder.formulaRel.delFCellRec(this.x+","+this.y),m=!0);if(m)continue;
else this.attr.fdom=formulaBuilder._translateToDomainRef(g)}}l?this.styling[f.substr(5)]=k:("mvp"===f&&(this.mvp=!0),"help"===f&&k&&(k=k.replace(/<br\s*(\/)?>/gim,"\n").replace(/%26/gim,"&")),this.attr[f]=k)}}}};BuilderObject.prototype.outputLine=function(a){var b=this.domainId,c=this.getAttributeString(a),d=fieldHeaderEncode(" "===this.value?this.value:this.value.trim());return this.IPType+","+this.x+","+this.y+","+(b?b:a?this.x+"|"+this.y:"")+","+d+","+c+"\n"};
BuilderObject.prototype.getAttributeString=function(a){var b="",c=!0,d;for(d in this.attr)if(d&&this.attr[d]&&("fdom"!=d||a)){c||(b+="&");var e=formatNUIAttr(this.attr[d].toString());"help"==d&&(e=e.replace(/\n/gm,"<br>"),e=e.replace(/&/gm,"%26"));b+=d+"="+e;c&&(c=!1)}for(d in this.styling)d&&this.styling[d]&&(c?c=!1:b+="&",e=formatNUIAttr(this.styling[d].toString()),b+="style"+d+"="+e);return b};
BuilderObject.prototype.unrender=function(){var a=nui._getcell(this.x,this.y),b;removeBorderClass(a,BUILDER_EMPTY_CLASS);a.builderField=!1;rm(a);for(b=0;b<this.coloring.length;b++){var c=this.coloring[b];removeBorderClass(c,BUILDER_EMPTY_CLASS);c.builderField=!1;rm(c)}this.hasAttribute("cs")&&(ctrl.tempIp=a.ip,builder.renderAll(),nui._getcell(this.x,this.y).ip=ctrl.tempIp,delete ctrl.tempIp)};
BuilderObject.prototype.render=function(){var a=nui;this.coloring=[];var b=builder.ifAdjacent(this.x,this.y);builder.ifKey(this.x,this.y);var c=a._getcell(this.x,this.y);if(c){rm(c);c.removeAttribute("style");setBorderClass(c,"#E0E7EF");c.builderField=!0;c.biff=this;c.ip=new Typer;c.ip.biff=this;c.ip.cell=c;c.ip.loadValue(this.value);c.ip.render();var d=b?[a._getcell(this.x,this.y+1),a._getcell(this.x,this.y+2),a._getcell(this.x,this.y+3)]:[a._getcell(this.x+1,this.y)],e;for(e in this.styling)if(e){if(this.styling[e])try{if(e.startsWith("V"))for(f=
0;f<d.length;f++)d[f].style[e.substr(1)]=this.styling[e];else c.style[e]=this.styling[e]}catch(g){}else if(delete this.styling[e],e.startsWith("V"))for(var f=0;f<d.length;f++)d[f].style[e.substr(1)]="";else c.style[e]="";e.startsWith("Vborder")||e.startsWith("border")}this.hasAttribute("help")&&(d=node("span"),d.domainId=this.domainId,d.style.margin="0 0 0 6px",d.innerHTML='<a class="help" href=javascript:void(0) onclick="cancelEventBubble(event);openHelpShower(this,this.parentNode.domainId,false,true,false,true,event);"><i class="fas fa-question"></i></a>',
c.appendChild(d));d=parseInt(this.attr.cs);if(b)for(c.colSpan=1<d?d:1,e=1;e<=ctrl.TABLE_DEF_ROWS;e++){if(b=a._getcell(this.x,this.y+e))rm(b),b.className="builderFieldWhite",setBuilderCellContent(this,c,b,this.IPType,this.x),this.coloring.push(b),b.colSpan=1<d?d:1}else if(b=a._getcell(this.x+1,this.y))for(rm(b),b.className="builderFieldWhiteSingle",setBuilderCellContent(this,c,b,this.IPType,this.x),this.coloring.push(b),d=this.hasAttribute("cs")?d:1,b.colSpan=d,setBorderClass(b,1,d),e=1;e<d;e++)a._removecell(this.x+
e+1,this.y);builder.custTheme&&CustThemeHelper.applyThemeToCellData(this,c,builder.custTheme)}};function _setBuilderAction(){builder.freeData[nui.fcol+","+nui.frow].action=$("floatWinPromptInput").value;$("floatingWin").style.display="none"}
function setBuilderCellContent(a,b,c,d){b.textContent=a.value;c.style.position="relative";c.style.paddingRight="21px";var e=node("I");e.style.height="16px";if(a.attr.usrref)c.textContent=lm.userSelect,e.classList.add("fa","fa-user","faiconBuilder"),c.appendChild(e);else if(a.attr.grpref)c.textContent=lm.groupSelect,e.classList.add("fa","fa-users","faiconBuilder"),c.appendChild(e);else if("U"===d)c.textContent=lm.uploadFile,e.classList.add("fa","fa-paperclip","faiconBuilder"),e.style.fontSize="12px",
c.appendChild(e);else if("G"===d)c.textContent=lm.uploadGraphic,e.classList.add("far","fa-image","faiconBuilder"),c.appendChild(e);else if(a.attr.fmt_d)a.attr.repeat?(c.textContent=formatRepeatDate(new Date,a.attr.repeat),e.classList.add("fas","fa-calendar-check","faiconBuilder")):(c.textContent=a.attr.fmt_d,e.classList.add("fas","fa-calendar-alt","faiconBuilder")),c.appendChild(e);else if(a.attr.fmt_n)c.textContent=a.attr.fmt_n;else if(a.attr.ag)c.textContent=lm.AutoGen;else if(a.attr.sig)c.textContent=
lm.signature;else if(a.attr.html)c.textContent=lm.richTextEditor;else if(a.attr.email)c.textContent=lm.email;else if(a.attr.phone)if(a.attr.phonefmt)c.textContent=a.attr.phonefmt;else{var f=parseInt(a.attr.phone);1===f?c.textContent=lm.phone:2===f&&(c.textContent=lm.specialFormat)}else a.attr.addr?(c.textContent=lm.address,e.classList.add("fas","fa-map-marker-alt","faiconBuilder"),c.appendChild(e)):a.attr.url?c.textContent=lm.url:a.attr.bc_type?c.textContent=a.attr.bc_type:a.attr.masked?(c.textContent=
"\u25cf\u25cf\u25cf\u25cf\u25cf\u25cf",e.classList.add("fa","fa-eye","faiconBuilder"),c.appendChild(e)):d===SELECTOR&&a.attr.mvp?(c.textContent=lm.linkOtherSheet,e.classList.add("fa","fa-caret-down","faiconBuilder"),c.appendChild(e)):d===MSELECTOR&&a.attr.mvp?(c.textContent=lm.linkOtherSheetMultiSelect,e.classList.add("fa","fa-caret-down","faiconBuilder"),c.appendChild(e)):d===SELECTOR?(c.textContent=lm.selection,e.classList.add("fa","fa-caret-down","faiconBuilder"),c.appendChild(e)):d===MSELECTOR?
(c.textContent=lm.multiSelect,e.classList.add("fa","fa-caret-down","faiconBuilder"),c.appendChild(e)):c.textContent=lm.freeText;f=new Date;c.style.removeProperty&&c.style.removeProperty("background-color");a.attr.ro?c.style.backgroundColor="#efefef":a.styling.VbackgroundColor&&(c.style.backgroundColor=a.styling.VbackgroundColor);if(a.attr.dv){var g=a.attr.dv;if(g.startsWith("#")||g.startsWith("$"))g.includes("USERNAME")?c.textContent=userName:g.includes("USERID")?c.textContent=user:g.includes("DATETIME")?
c.textContent=a.attr.fmt_d?formatDate(f,a.attr.fmt_d):formatDate(f,"yyyy/MM/dd hh:mm:ss"):g.includes("DATE")?c.textContent=a.attr.fmt_d?formatDate(f,a.attr.fmt_d):formatDate(f,"yyyy/MM/dd"):g.includes("TIME")?c.textContent=a.attr.fmt_d?formatDate(f,a.attr.fmt_d):formatDate(f,"hh:mm:ss"):g.includes("YEAR")?c.textContent=a.attr.fmt_d?formatDate(f,a.attr.fmt_d):f.getFullYear():g.includes("MONTH")&&(c.textContent=a.attr.fmt_d?formatDate(f,a.attr.fmt_d):f.getMonth()+1);else if(c.style.overflow="hidden",
e.classList.add("fa","fa-caret-down","faiconBuilder"),a.IPType===MSELECTOR)d=g,a.hasAttribute("sep_m")&&(d=replaceMSelectorDvSep(d,a.attr.sep_m)),d=decHTML(d).replace(/%7C/g,"|"),c.textContent=d,c.appendChild(e);else if(a.attr.checkbox){if(c.innerHTML=checkboxSymbolRender(g),e=c.querySelector(".checkboxSymbol"))e.style.color=""}else c.textContent=decHTML(a.attr.dv),d===SELECTOR&&c.appendChild(e)}a.attr.must&&(e=node("SPAN"),e.style.color="red",e.textContent="*",b.prepend(e));if(a.attr.f||a.attr.dv_f)d=
a.attr.f||a.attr.dv_f,d=d.replace(/["']/g,"'"),e=node("DIV"),e.classList.add("settingIcon"),e.dataset.formula=d,e.onmouseover=showFormulaTooltip.bind(e),e.onmouseout=hideFormulaTooltip.bind(e),e.onmousedown=settingIconMouseDown.bind(e,a,b),d=getMinimumBrowserFontSize(),d=Math.round(8/d*100)/100,f=node("i","","far fa-function"),f.style.transform="scale("+d+")",e.appendChild(f),appendSettingIcon(b,e);a.attr.noDup&&(d=getMinimumBrowserFontSize(),d=Math.round(8/d*100)/100,e=node("I"),e.style.height="",
e.style.transform="scale("+d+")",e.setAttribute("aria-hidden","true"),e.classList.add("fa","fa-key"),d=node("DIV"),d.classList.add("settingIcon"),d.title=lm.noDup,d.appendChild(e),appendSettingIcon(b,d));a.attr.summary&&(d=getMinimumBrowserFontSize(),d=Math.round(8/d*100)/100,e=node("I"),e.style.height="",e.style.transform="scale("+d+")",e.setAttribute("aria-hidden","true"),e.classList.add("far","fa-sigma"),d=node("DIV"),d.classList.add("settingIcon"),d.title="Summary",d.appendChild(e),appendSettingIcon(b,
d));builder.subtableAliasOfParentSheet.includes(parseInt(a.domainId))&&(d=getMinimumBrowserFontSize(),d=Math.round(8/d*100)/100,e=node("I"),e.style.height="",e.style.transform="scale("+d+")",e.setAttribute("aria-hidden","true"),e.classList.add("fa","fa-external-link-square-alt"),d=node("DIV"),d.classList.add("settingIcon"),d.title=lm.settingIcon_subtableAliasOfParentSheet,d.appendChild(e),appendSettingIcon(b,d));a.attr.mvp&&(e=node("DIV"),e.classList.add("settingIcon"),e.onmousedown=settingIconMouseDown.bind(e,
a,b),e.style.backgroundColor="#0088cc",e.title=lm.settingIcon_linkedField,d=getMinimumBrowserFontSize(),d=Math.round(8/d*100)/100,f=node("DIV"),f.textContent="L",f.style.transform="scale("+d+")",e.appendChild(f),appendSettingIcon(b,e));a.attr.vd&&(e=node("DIV"),e.classList.add("settingIcon"),e.onmousedown=settingIconMouseDown.bind(e,a,b),e.style.backgroundColor=a.attr.lnlsselect?"#AAA":"#555555",e.title=lm.settingIcon_loadedField,d=getMinimumBrowserFontSize(),d=Math.round(8/d*100)/100,f=node("DIV"),
f.textContent="L",f.style.transform="scale("+d+")",e.appendChild(f),appendSettingIcon(b,e));a.attr.hide?(c.style.opacity=.5,b.style.opacity=.5,b.querySelectorAll(".settingIcon").forEach(function(a){})):(c.style.opacity="",b.style.opacity="")}function appendSettingIcon(a,b){var c=a.querySelector(".settingIconContainer");c?c.appendChild(b):(a.style.position="relative",c=node("DIV"),c.classList.add("settingIconContainer"),c.appendChild(b),a.appendChild(c))}
function saveBuilder(){if(!ctrl.designModeSaving)if(ctrl.designModeSaving=!0,formSaveChecker())try{nui._blur(),designModeListingPageHotspot(),builder.saveServer()}catch(a){ctrl.designModeSaving=!1}else ctrl.designModeSaving=!1}
function formSaveChecker(){var a="/ragic-setup"===path&&(1===sheetIndex||5===sheetIndex),b=0,c=0,d;for(d in builder.cellData){var e=builder.cellData[d];if(!f||e.y<f.y||e.y==f.y&&e.x<f.x)var f=e;b++;e.hasAttribute("hide")||c++}if(a&&1!=f.domainId)alert("The field e-mail must be at the top left corner of this form.");else{if(2>b)return builder.ifListingPage(),alert(lm.atLeastFields),!1;if(builder.ifListingPage()&&2>c)return alert(lm.listingAtLeastFields),!1;if(f){b=a=1;for(c=!1;builder.cellData[f.x+
a++ +","+f.y];)b++,c=!0;if(c&&b<Object.keys(builder.cellData).length)return floatWinWarning(lm.noSubtableOnTop),!1}a="/"+ap+path+"/"+sheetIndex;f=document.querySelectorAll(".nuiPageHeader_sheetName");var g=f[0].textContent;"3"===builder.formType&&f[1]&&(g=f[1].textContent);f=$("pathDrop"+path);if(!f)return!0;b=f.querySelector("[href='"+a+"']");a=function(a,b){a.textContent=b;if(window.owner&&("FREE2"==window.edition||"LITE2"==window.edition)){var c=node("span");c.className="bCustomSheetIcon";c.onmouseover=
function(){showTooltip(this,3)};c.onmouseout=function(){hideTinyTooltip()};c.innerHTML='<i class="fa fa-user-edit"></i>';a.appendChild(c)}c=node("SPAN");c.classList.add("outerSheetTriangleIcon");c.addEventListener("click",function(a){menuItemClick(this,a,path,sheetIndex,b,"sheet",!0)});var d=node("SPAN");d.classList.add("smallDownArrow");d.style.visibility="hidden";var e=node("I");e.classList.add("fa","fa-caret-down");d.appendChild(e);c.appendChild(d);a.appendChild(c)};b&&a(b,g);if(builder.isSheetNew){if(b)return builder.isSheetNew=
!1,!0;b=node("a");f.appendChild(b);b.href="/"+ap+path+"/"+sheetIndex;b.className="pathDropItem";b.onmousedown=function(a){menuItemClick(this,a,path,sheetIndex,g,"sheet")};b.onmouseout=function(){this.lastChild.firstChild.style.visibility="hidden"};b.onmouseover=function(){this.lastChild.firstChild.style.visibility="visible"};a(b,g);location.hash="#!/"+sheetIndex;builder.isSheetNew=!1}return!0}}
function updateBuilderWidgetMove(a){var b=ctrl.builderWidgetMoveStart;if(b){var c=a.clientY-ctrl.dragStartY;b.config.layout.x=ctrl.builderWidgetMoveFromX+(a.clientX-ctrl.dragStartX);b.config.layout.y=ctrl.builderWidgetMoveFromY+c;b.positionInBuilder()}}
function updateBuilderMove(a){ctrl.builderMovePrompt||(ctrl.builderMovePrompt=node("div"),ctrl.builderMovePrompt.style.position="absolute",ctrl.builderMovePrompt.innerHTML=ctrl.builderMoveStart.innerHTML,ctrl.builderMovePrompt.style.backgroundColor=ctrl.builderMoveStart.style.backgroundColor,ctrl.builderMovePrompt.style.fontSize="12px",ctrl.builderMovePrompt.style.width=ctrl.builderMoveStart.offsetWidth+"px",ctrl.builderMovePrompt.style.height=ctrl.builderMoveStart.offsetHeight+"px",document.body.appendChild(ctrl.builderMovePrompt));
ctrl.builderMovePrompt.style.top=0;ctrl.builderMovePrompt.style.left=0;ctrl.builderMovePrompt.style.top=a.clientY+"px";ctrl.builderMovePrompt.style.left=a.clientX+"px"}
function endBuilderMove(a){enableSelection(document.body);ctrl.builderColspanStart=null;ctrl.freeDataColspan=null;ctrl.builderMovePrompt&&(document.body.removeChild(ctrl.builderMovePrompt),ctrl.builderMovePrompt=null);var b=a=!1,c=!1,d=[],e=!1,f=ctrl.builderMoveStart.id;if(ctrl.builderMoveStart){var g=ctrl.builderMoveStart;var k=parseInt(f.split("_")[1]);var l=parseInt(f.split("_")[2]);f=k+","+l;ctrl.builderMoveStart=null}builder.cellData[f]||(c=!0);ctrl.builderSysMove||(b=!0);g&&!c&&builder.ifAdjacent(k,
l)&&(e=!0);var m=builder.cellData[k+","+l]&&!e?nui._getcellV2(k+1,l).colSpan+1:nui._getcellV2(k,l).colSpan;for(f=0;f<m;f++)d.push(k+f+"_"+l);if(ctrl.builderMoveEnd){var n=ctrl.builderMoveEnd.id;var q=parseInt(n.split("_")[1]);n=parseInt(n.split("_")[2]);ctrl.builderMoveEnd=null}f=nui._getcellV2(q-1,n);var r=nui._getcellV2(q+1,n);b&&!c&&!e&&(f&&f.builderField&&f!=g||r&&r.builderField&&r!=g)&&(a=!0);if(q&&n&&!e)for(c=0;c<m;c++){var p=nui._getcellV2(q+c,n);if(!(0<=d.indexOf(q+c+"_"+n))&&b&&(p.builderField||
p.builderFreeField||"builderFieldWhite"===p.className||"builderFieldWhiteSingle"===p.className||"none"===p.style.display)){a=!0;break}}if(!a&&e&&(f&&f.builderField&&f!=g||r&&r.builderField&&r!=g)){g=builder.findSubtableHeadField(k,l);b=builder.cellData[k+","+l];do d=b.x;while(b=builder.cellData[b.x+1+","+l]);b=builder.cellData[d+","+l];f.builderField&&!a&&!ctrl.builderSysMove&&builder.findSubtableHeadField(k,l)!==builder.findSubtableHeadField(q-1,n)&&1<Math.abs(k-q)&&(a=!0);r.builderField&&!a&&!ctrl.builderSysMove&&
builder.findSubtableHeadField(k,l)!==builder.findSubtableHeadField(q+1,n)&&1<Math.abs(k-q)&&(a=!0);builder.cellData[k-1+","+l]&&builder.cellData[k+1+","+l]&&(n!=l||q!=b.x+1&&q!=g.x-1||(a=!0))}f=$("dropTarget");g=builder.cellData[k+","+l];f.style.display="none";k&&l&&q&&n||(a=!0);k==q&&l==n&&(a=!0);!a&&!ctrl.builderSysMove&&builder.cellData[k+","+l]&&builder.ifAdjacent(k,l)&&(!builder.ifAdjacent(q,n)||!builder.cellData[q+","+n]&&1>=Math.abs(k-q))&&(a=!0,builder.ifListingPage()||confirmPromise(lm.confirmMoveSubtable).then(shiftSubtable.bind(null,
k,l)).catch(emptyFunction));if(!a&&(!builder.ifListingPage()||!g||builder.cellData[q-1+","+n]&&l==n)){if(g&&!ctrl.builderSysMove&&(f=g.attr.f||g.attr.dv_f)){a=builder.formulaRel;if(builder.ifAdjacent(k,l))for(r=0<k-q,b=k;b!=q;)if(d=r?b-1:b+1,e=builder.cellData[d+","+l]){if(builder.cellData[b+","+l]=e,e.x=b,b=d,d==q){builder.cellData[d+","+l]=g;g.x=q;break}}else b=d;else builder.cellData[q+","+n]=g,delete builder.cellData[k+","+l];shiftFormula();a.addFCellRec(q+","+n,f);a.delFCellRec(k+","+l);f=a.check();
r=builder.cellData[q+","+n];if(builder.ifAdjacent(q,n))for(b=0<q-k,d=q;d!=k;)if(e=b?d-1:d+1,m=builder.cellData[e+","+n]){if(builder.cellData[d+","+n]=m,m.x=d,d=e,e==k){builder.cellData[e+","+n]=r;r.x=k;break}}else d=e;else builder.cellData[k+","+l]=r,delete builder.cellData[q+","+n];if(!f){shiftFormula();f=r.attr.f||r.attr.fs;a.addFCellRec(k+","+l,f);a.delFCellRec(q+","+n);return}}builder.moveHeader(k,l,q,n);shiftCellOrSubtableUpdateFocus(q,n);nui._curcell()&&nui._curcell().ip&&$("hin").setValue(nui._curcell().ip.value);
if(builder.ifListingPage()&&g){k="";for(l=1;l<=builder.maxX;l++)if(builder.cellData[l+",1"]){k=l+",1";break}(new FieldSelector).balanceOptions(k)}builder.tempDragDropShiftRow=-1}}function shiftCellOrSubtableUpdateFocus(a,b){nui.fcol=a;nui.frow=b;nui._updateFocus()}
function shiftSubtable(a,b){for(var c=a,d=a,e,f=0;e=builder.cellData[c-1+","+b];)--c,e.hasAttribute("cs")&&(f+=parseInt(e.attr.cs)-1);for(;e=builder.cellData[d+1+","+b];)d+=1,e.hasAttribute("cs")&&(f+=parseInt(e.attr.cs)-1);e=builder.cellData[a+","+b];e.hasAttribute("cs")&&(f+=parseInt(e.attr.cs)-1);var g=d-c+1+f;floatWin(function(){for(var a=$("posSelect"),e=builder.maxX+3,f=builder.maxY+20,n=Object.values(builder.cellData).map(function(a){return[a.x,a.y]}).filter(function(a){return a[1]!==b||a[0]<
c||a[0]>d}).reduce(function(a,b){a.hasOwnProperty(b[1])||(a[b[1]]=[]);a[b[1]].push(b[0]);return a},{}),q=1;q<=f;q++){for(var r=[],p=n[q],t=!1,v=0,u=1;u<=e;u++)if(builder.freeData.hasOwnProperty(u+","+q)){var x=builder.freeData[u+","+q];x.styling.hasOwnProperty("cs")&&(u+=parseInt(x.styling.cs)-1)}else if(p)if(x=p.includes(u+1),p.includes(u)){var E=p.includes(u-1)||x,D=builder.cellData[u+","+q];D.hasAttribute("cs")&&(E?v+=parseInt(D.attr.cs)-1:u+=parseInt(D.attr.cs)-1);E?(t=!0,x||(u+=1,u+=v,v=0)):
u+=1}else x||r.push(u);else x=node("OPTION"),x.setAttribute("value",getCellName(u,q)),a.appendChild(x);for(p=0;p<r.length;p++)v=r[p],r.length>p+g-1&&v+g-1!==r[p+g-1]||(u=node("OPTION"),u.setAttribute("value",getCellName(v,q)),a.appendChild(u));t&&(q+=3)}},"<div id='shiftSelects'><h3 style='margin-bottom:5px;'>"+lm.moveSubtablePos+"</h3><input id='posLoc' list='posSelect' /><datalist id='posSelect'></datalist><button onclick='_shiftSubtable("+c+","+d+","+b+");' style='float:none;margin-left:5px;' class='topButtonWhole'>"+
lm.move+"</button>\u00a0<span id='invalidMoveHint' style='display: none;color: red;'>"+lm.invalidMoveSubtable+"</span></div>","",!0)}
function _shiftSubtable(a,b,c){var d=$("posLoc").value;if(d&&document.querySelector('#posSelect option[value="'+d+'"]')){b=b-a+1;d=getPositionFromCellName(d);var e=d[1]===c&&d[0]>a,f=a+","+c,g=builder.subtableKeys[f];f=builder.subtableAliasParents[f];var k=nui.fcol-a;ctrl.builderSysMove=!0;if(e)for(;b--;)ctrl.builderMoveStart={id:"_"+(a+b)+"_"+c},ctrl.builderMoveEnd={id:"_"+(d[0]+b)+"_"+d[1]},endBuilderMove();else for(e=0;e<b;e++)ctrl.builderMoveStart={id:"_"+(a+e)+"_"+c},ctrl.builderMoveEnd={id:"_"+
(d[0]+e)+"_"+d[1]},endBuilderMove();shiftCellOrSubtableUpdateFocus(d[0]+k,d[1]);nui._curcell()&&nui._curcell().ip&&$("hin").setValue(nui._curcell().ip.value);ctrl.builderSysMove=null;builder.subtableKeys[d[0]+","+d[1]]=g;builder.subtableAliasParents[d[0]+","+d[1]]=f;inNUI();$("floatingWin").style.display="none"}else $("invalidMoveHint").style.display=""}
function shiftCustAppSeqItems(a,b,c,d){builder.custAppSeqItems.filter(function(a){return"DESCRIPTION"===a.type}).forEach(function(d){try{var e=d.key.split(","),g=parseInt(e[0]),k=parseInt(e[1]);c?g>=a&&(g+=b,0>g?d.toBeRemoved=!0:builder.freeData[g+","+k]?d.key=g+","+k:d.toBeRemoved=!0):k>=a&&(k+=b,0>k?d.toBeRemoved=!0:builder.freeData[g+","+k]?d.key=g+","+k:d.toBeRemoved=!0)}catch(l){console.log(l)}});builder.custAppSeqItems=builder.custAppSeqItems.filter(function(a){return!a.toBeRemoved})}
function shiftFormula(){var a="";Object.values(builder.cellData).filter(function(a){return a&&a.hasAttribute("fdom")}).forEach(function(b){var c=formulaBuilder._translateToSpreadsheetRef(b.attr.fdom);c?b.attr.f?b.attr.f=c:b.attr.dv_f&&(b.attr.dv_f=c):(a+=b.value+" ",b.hasAttribute("f")?delete b.attr.f:b.hasAttribute("dv_f")&&delete b.attr.dv_f)});Object.values(builder.freeData).filter(function(a){return a&&a.fdom&&a.value}).forEach(function(a){var b=formulaBuilder._translateToSpreadsheetRef(a.fdom);
a.value=a.value.replace(/\[formula\][\s]*(.+)\[\/formula\]/gim,"[formula]"+b+"[/formula]")});a&&0<a.length&&floatWinWarning("Your edit has made the formula on fields: "+a+" invalid. The formula has been reset.")}
function builderAddComponent(a,b,c){var d=ctrl.dragging.getAttribute("type"),e=ctrl.dragging.getAttribute("defaultName");if("PARAGRAPH"===d)builder.mode=BUILDER_FIELDS,builder.setField(a,b,e),d="D",ctrl.setWidth(b,100,biffdata.heightCommand,function(a){biffdata.heightCommand=a}),builder.cellData[a+","+b].render();else if("DESC"===d){builder.mode=BUILDER_TEXT;builder.setDescription(a,b,e);var f=c.getAttribute("cellstyle");if(f)for(e=f.split(";"),f=0;f<e.length;f++)d=e[f].split(":"),builder.setStyle(a,
b,d[0],d[1]);c.actionButton&&(builder.freeData[a+","+b].actionButton=c.actionButton,builder.freeData[a+","+b].actionButtonId=c.actionButtonId);builder.freeData[a+","+b].render()}else if("SUBTABLE_NEW"===d){builder.mode=BUILDER_FIELDS;c=parseInt($("subtable_num_of_fields").value);for(f=0;f<c;f++)builder.setField(a+f,b,"subtable"+(f+1));builder.renderAll()}else if("SUBTABLE_REF"===d){builder.mode=BUILDER_FIELDS;b=ctrl.dragging;c=b.closest(".linkedTarget");a=c.dataset.path;c=c.dataset.fn;var g=parseInt(b.dataset.keyfield)||
-1;componentParentAlias=parseInt(b.dataset.parentalias)||-1;_subtableKeys=builder.subtableKeys;_subtableAliasParents=builder.subtableAliasParents;for(f in _subtableKeys)if(_subtableKeys.hasOwnProperty(f)&&(b=_subtableAliasParents[f],_subtableKeys[f]===g)){if(b===componentParentAlias){floatWinWarning(lm.refSubtableInvalidMsg,!0);return}if((isNaN(b)||-1===b)&&componentParentAlias===builder.rootDomainId){floatWinWarning(lm.refSubtableInvalidMsg2,!0);return}}floatWin(null,lm.prop_loading,lm.chooseSubtableFields,
!0);a={a:ap,p:path,fn:sheet,cp:a,cfn:c,ltd:builder.rootDomainId,source:unescapeHTML(builder.newName),pa:componentParentAlias};postPromise("/sims/getSubtableFromSubtableGen.jsp",a).then(function(a){clearDropWin();a=JSON.parse(a);if(a.errorMsg)floatWinWarning(a.errorMsg,!0);else{a.actionName=lm.insertSubtable;a.parentAlias=componentParentAlias;a.keyField=g;a.actionCallback=insertReferencedSubtable;var b=new FieldSelector;b.loadData(a);b.render()}});builder.renderAll()}else if("SUBTABLE_MULTI"===d){a=
ctrl.dragging.getAttribute("url");var k=ctrl.dragging.getAttribute("subtablekey"),l=ctrl.dragging.getAttribute("parentalias");$("addRefHardLinkDiv").style.display="none";floatWin(null,lm.prop_loading,lm.chooseSubtableFields,!0);getPromise("/sims/getSubtableFromMultiVersion.jsp",{url:a,subtableKey:k,parentAlias:l,p:path,si:sheetIndex}).then(function(a){a=JSON.parse(a);a.actionName=lm.insertSubtable;a.actionCallback=insertReferencedSubtable;a.parentAlias=l;a.keyField=k;var b=new FieldSelector;b.loadData(a);
b.render()});builder.renderAll()}else{if("HARD_REF"===d)builder.mode=BUILDER_FIELDS,c=ctrl.dragging,f=c.getAttribute("domainId"),builder.setField(a,b,c.innerHTML),$("hin").setValue(c.innerHTML),c.getAttribute("lnlsselect")||(builder.cellData[a+","+b].domainId=f),builder.setAttribute(a,b,"it",c.getAttribute("it")),builder.copyAttribute(a,b,c.getAttribute("attr"),null,["noDup"]),(e=builder.getAttribute(a,b,"l"))&&(e=builder.getField(e))&&(e.attr.lnlsselected="true"),c.hasAttribute("lov")&&(e=c.getAttribute("lov").replace(/`/g,
ctrl.CRLF),(c=c.getAttribute("cascaded"))?addCascadedSelectionFromLOV(e,f,c):builder.setAttribute(a,b,"lov",e));else if("SYS_FIELD"===d){f=ctrl.dragging.getAttribute("data-domainId");if(builder.checkIfSysFieldDuplicated(f))return;ctrl.dragging.style.display="none";builder.mode=BUILDER_FIELDS;builder.cellData[a+","+b]=new BuilderObject(a,b,e,"D",f,"ro=true&fmt_d=yyyy/MM/dd HH:mm:ss&sysField=true"+("105"===f||"109"===f?"&utcTime=true":""))}else builder.mode=BUILDER_FIELDS,builder.setField(a,b,e),$("hin").setValue(e),
builder.setAttribute(a,b,"it",d);builder.cellData[a+","+b].render()}}function addCascadedSelectionFromLOV(a,b,c){if(a&&b&&c){var d=a.split(ctrl.CRLF);a={};for(var e=0;e<d.length;e++){var f=unformatNUIAttr(d[e]).split("|");if(!(2>f.length)){var g=f[0].replace(/%7C/g,"|");a[g]||(a[g]=[]);a[g].push(f[1].replace(/%7C/g,"|"))}}d=builder.cascadedSelections;d.hasOwnProperty(b)||(d[b]={});d[b].pdomainid=c;d[b].avaliable=!0;d[b].collection=a}}
function showFormTools(){if(!ctrl.showFormToolsFlag){ctrl.showFormToolsFlag=!0;resetHotspot();var a={a:ap,p:path,si:sheetIndex,listing:builder.ifListingPage()};builder.level3&&(a.l3=builder.level3);getPromise("/sims/linkDigest.jsp",a).then(updateLinkDigests).then(function(){return getPromise("/sims/builderFormToolDigest.jsp",a)}).then(updateFormToolsDigests).then(function(){dropWin(this,$("builderFromToolsDrop"))}.bind(this)).then(adjustFromToolsDrop).finally(endShowFormTools)}}
function endShowFormTools(){ctrl.showFormToolsFlag=!1}
function updateLinkDigests(a){var b=JSON.parse(a);a=b.linkAndLoad||[];var c=b.multipleVersion||[],d=b.newSheetFromSubtable||[],e=b.referenceFromExistingSheet||[];b=b.parentSheet||[];var f=new Set;a.forEach(function(a){f.add(a.urlPath+"|"+a.urlFormName)});a&&0<f.size?displayDigests($("linkToolDesc1"),a,getBundleString("linkDigest_linkAndLoad",[f.size,1<f.size?"s":""]),function(a){return a.sheetName},function(a,b){b.specifyForm1LinkField&&(linkWizard.specifyForm1LinkField=b.specifyForm1LinkField);openLinkAndLoad(b.urlPath,
b.urlFormName)},function(a,b){linkNLoadSetting(a,b.linkedFieldId)}):$("linkToolDesc1")&&($("linkToolDesc1").innerHTML=lm.linkDigest_linkAndLoad_noSettings);c&&0<c.length?displayDigests($("linkToolDesc2"),c,getBundleString("linkDigest_multipleVersion",[c.length,1<c.length?"s":""]),function(a){return a.sheetName},function(a,b){migrateFieldFromMultiple(b.url);migrateSubtableFromMultiple(b.url);migrateSubtableFieldsFromMultiple(b.url)},function(a,b){addButtonDuplicate("/"+b.url+"/{id}")}):$("linkToolDesc2")&&
($("linkToolDesc2").innerHTML=lm.linkDigest_multipleVersion_noSettings);d&&0<d.length?displayDigests($("linkToolDesc3"),d,getBundleString("linkDigest_newSheetFromSubtable",[d.length,1<d.length?"s":""]),function(a){return a.linkedSheetName},function(a,b){migrateFieldFromSubtableGen(b.url,b.subtableKey)},function(a,b){newSheetFromSubtableSetting(a,"/"+b.url+"?saveClose&new="+b.stf+"|{id}",b.subtableKey)}):$("linkToolDesc3")&&($("linkToolDesc3").innerHTML=lm.linkDigest_newSheetFromSubtable_noSettings);
e&&0<e.length?displayDigests($("linkToolDesc4"),e,getBundleString("linkDigest_referenceFromExistingSheet",[e.length,1<e.length?"s":""]),function(a){return a.sheetName},function(a,b){migrateFieldFromSubtableGen(b.url,b.subtableKey,b.parentAlias)},function(a,b){newSheetFromSubtableSetting(a,"/"+b.url+"?saveClose&new="+b.stf+"|{id}",b.subtableKey,b.parentAlias)}):$("linkToolDesc4")&&($("linkToolDesc4").innerHTML=lm.linkDigest_referenceFromExistingSheet_noSettings);b&&0<b.length?($("bLinkInterm")&&($("bLinkInterm").style.display=
"",$("bLinkInterm").onclick=function(){migrateFieldFromSource()}),displayDigests($("linkToolDesc5"),b,getBundleString("linkDigest_parentSheet",[b.length,1<b.length?"s":""]),function(a){return a.sheetName},function(a,b){migrateFieldFromSource(b.url)})):$("bLinkInterm")&&($("bLinkInterm").style.display="none")}
function updateFormToolsDigests(a){a=JSON.parse(a);var b=a.digests_convertRecord,c=a.digests_entryUpdater,d=a.digests_fieldUpdater,e=a.digests_sendCustomMail,f=a.digests_mergedButton;b&&0<b.length?displayDigests($("linkToolDesc6"),b,getBundleString("linkDigest_convertRecords",[b.length,1<b.length?"s":""]),function(a){return a.name},function(a,b){copyRecordSettingEdit(a,b.buttonSeq,b.actionId)}):$("linkToolDesc6")&&($("linkToolDesc6").innerHTML=lm.linkDigest_convertRecords_noButtons);c&&0<c.length?
displayDigests($("linkToolDesc7"),c,getBundleString("linkDigest_updateEntries",[c.length,1<c.length?"s":""]),function(a){return a.name},function(a,b){updateRecordSettingEdit(a,b.buttonSeq,b.actionId)}):$("linkToolDesc7")&&($("linkToolDesc7").innerHTML=lm.linkDigest_updateEntries_noButtons);d&&0<d.length?displayDigests($("fieldUpdaterDesc"),d,getBundleString("fieldUpdaterDigest",[d.length,1<d.length?"s":""]),function(a){return a.name},function(a,b){updateFieldSettingEdit(a,b.buttonSeq,b.actionId)}):
$("fieldUpdaterDesc")&&($("fieldUpdaterDesc").innerHTML=lm.fieldUpdaterDigestNo);e&&0<e.length?displayDigests($("sendCustomEmailButtonDesc"),e,getBundleString("sendCustomEmailButton_digest",[e.length,1<e.length?"s":""]),function(a){return a.name},function(a,b){builderModeEmailTemplateEditors.actionButton.open(b.buttonSeq,b.templateKey)}):$("sendCustomEmailButtonDesc")&&($("sendCustomEmailButtonDesc").innerHTML=lm.sendCustomEmailButton_digest_no);f&&0<f.length?displayDigests($("combineButtonsDesc"),
f,getBundleString("combineButtons_digest",[f.length,1<f.length?"s":""]),function(a){return a.name},function(a,b){setMergedActionButton(b.buttonSeq)}):$("combineButtonsDesc")&&($("combineButtonsDesc").innerHTML=lm.combineButtons_digest_no);1>=parseInt(a.totalButtonNum)&&($("customButtonsDiv2").style.display="none");a=parseInt(a.interactiveRulesNum);$("interactiveRuleDesc")&&($("interactiveRuleDesc").innerHTML=0<a?getBundleString("conditionalFormattingDigest",[a]):lm.conditionalFormattingDigestNo)}
function displayDigests(a,b,c,d,e,f){if(a&&b&&c&&d&&e){rm(a);var g=node("div");g.innerHTML=c;a.appendChild(g);var k=node("div");a.appendChild(k);var l=0;b.forEach(function(a){var c=node("div");c.style.display="inline-block";c.style.whiteSpace="nowrap";c.style.marginRight="3px";k.appendChild(c);var g=node("a");g.innerHTML=d(a);g.setAttribute("href","javascript:void(0);");g.onclick=function(b){clearDropWin();cancelEventBubble(b);e(b,a)};c.appendChild(g);if(f){g=node("a");g.setAttribute("href","javascript:void(0);");
g.style.color="#888";var m=node("i");m.classList.add("fa");m.classList.add("fa-cog");g.appendChild(m);g.onclick=function(b){cancelEventBubble(b);f(b,a)};c.appendChild(g)}l<b.length-1&&c.appendChild(document.createTextNode(", "));l++})}}function focusSubtableFirstCell(a,b){if(a&&-1!==a){var c=!b||-1===b||isNaN(b),d=builder.subtableKeys,e=builder.subtableAliasParents,f;for(f in d)if(d[f]===a&&(e[f]===b||isNaN(e[f])&&c)){var g=f;a=f.split(",");nui._move(a[0]-nui.fcol,a[1]-nui.frow);break}return g}}
function resizeApprovalSelectUI(){var a=$("designModeHelper").getBoundingClientRect(),b=document.querySelector("ul[data-actid='actionButtonSelect']"),c=b.querySelector(".multiComboFilterContainer").getBoundingClientRect();b.style["max-height"]=a.height-c.height-10-parseInt(b.style.bottom,10);b.style["max-width"]=a.right-c.left-20}
function initActionButtonAfterApprovalSelect(){if(!$("actionButtonAfterApprovalSetting").querySelector("[data-actid='actionButtonSelect']")){var a=enableMultiSelectCombo($("actionButtonSelect"),!1);a.afterRender=resizeApprovalSelectUI;a.onToggleDropdown=resizeApprovalSelectUI;builder.executeActionButtonAfterApproval.forEach(function(a){(a=$("actionButtonSelect").querySelector('li[data-value="'+a+'"]'))&&a.click()});a.setAfterChangeItem(function(){setExecuteActionButtonAfterApproval(a)})}}
function initApprovalCCSelect(){if(!$("approvalCCSetting").querySelector("[data-actid='approvalCCSelect']")){var a={referContainer:"designModeHelperContent",customDropBoxStyles:{}};lang&&"en-US"!==lang&&(a.customDropBoxStyles.right="0px");var b=enableMultiSelectCombo($("approvalCCSelect"),!1,a);builder.approvalCC.forEach(function(a){(a=$("approvalCCSelect").querySelector('li[data-value="'+a+'"]'))&&a.click()});b.setAfterChangeItem(function(){setApprovalCC(b)});showApprovalPolicy()}}
function getValidApprovalSourceArray(){for(var a=[],b=-1,c=!1,d=0;d<builder.approvalItems.length;d++){var e=builder.approvalItems[d],f=[];e.ifSource?""!==e.name?(c=!1,f.push(e),a.push(f),b++):c=!0:c||-1<b&&a[b].push(e)}return a}
function loadApproval(){var a=$("designModeHelper");"1"!==a.getAttribute("status")&&(a.setAttribute("status","1"),a.removeEventListener("mouseout",closeDesignModeHelper));hoverDesignModeHelper(a);builder.approvalItems.forEach(function(a,c){var b=createApprovalItem(!0);b.approvalItem=a;if(a.stepId){c=b.querySelector(".stepIdTd");var e=node("A");c.appendChild(e);e.style.fontWeight="bold";e.href="javascript:void(0);";e.appendChild(document.createTextNode(a.stepId))}a.name.length?(c=b.querySelector(".titleTd"),
e=c.querySelector(".titleTd input"),e.value=a.name,e.style.display="none",e=node("A"),c.appendChild(e),e.style.fontWeight="bold",e.href="javascript:void(0);",e.onclick=function(){this.style.display="none";this.previousSibling.style.display="";this.previousSibling.focus()},e.appendChild(document.createTextNode(a.name)),a.thresholdNum&&1<=a.thresholdNum&&(c=b.querySelector(".thresholdTd"),e=document.createElement("A"),e.appendChild(document.createTextNode(a.thresholdNum)),e.href="javascript:void(0);",
e.onclick=function(){addThresholdInput.call(b,a.thresholdNum)},rm(c),c.appendChild(e))):a.ifSource||(c=b.querySelector(".titleTd"),c.removeChild(c.querySelector("input")));"A"!==a.transactorType&&(c=b.querySelector(".barSelect"),c=BarSelectAgent.getSelector(c.id),e=c.options.find(function(b){return b.value===a.transactor}),console.log(e),console.log(a),e?c.setOption(e):(e={selected:!0},e.value=a.transactor,e.text=a.transactor+"("+lm.invalid+")",e.disabled=!0,e.display="show",e.isOptionGroup=!1,e.optionDataset=
{},e.groupDataset={designate:a.transactorType},e.customProperties={barSelectStyles:{color:"red"}},c.addNewOption(e),c.setOption(e)))});null!==builder.approvalFlag&&($("approvalAdvanceAnchor").style.display="inline-block",initActionButtonAfterApprovalSelect(),initApprovalCCSelect());processDraggableApprovalTable()}var debounceCheckDraggableApprovalItems=debouncedFn(1E3,checkDraggableApprovalItems);
function checkDraggableApprovalItems(){var a=[],b=document.getElementById("approvalTable");Array.from(b.querySelectorAll("tr[data-index]")).forEach(function(b){b.approvalItem?a.push(b.approvalItem):(console.log("ERROR!"),console.log(b))});builder.approvalItems=a}
function processDraggableApprovalTable(){function a(a){var d=document.querySelectorAll(".draggable-table-drag");Array.from(d).forEach(function(a){c.removeChild(a)});f=a.cloneNode(!0);f.classList.add("draggable-table-drag");f.style.height=b(a,"height");for(d=0;d<a.children.length;d++){var e=a.children[d],g=f.children[d];g.style.width=b(e,"width");g.style.height=b(e,"height");g.style.padding=b(e,"padding");g.style.margin=b(e,"margin")}c.insertBefore(f,c.querySelector("tfoot"));a=a.getBoundingClientRect();
d=f.getBoundingClientRect();f.style.bottom=d.y-a.y+a.height+"px";f.style.left="-1px";document.dispatchEvent(new MouseEvent("mousemove",{view:window,cancelable:!0,bubbles:!0}))}function b(a,b){return(a=getComputedStyle(a)[b])?a:null}var c=document.getElementById("approvalTable"),d=c.querySelector("tbody");c.parentElement.style.position="relative";c.classList.add("draggable-table");var e=null,f=null,g=0,k=0,l=0,m=0,n=!1,q=function(b){if(0!=b.button)return!0;var c=b.target;var d=c.tagName.toLowerCase();
c="td"===d&&c.classList.contains("titleTd")?c.closest("tr"):"tr"===d?c:void 0;c&&(e=c,a(c),e.classList.add("is-dragging"),c=b.clientY,g=b.clientX,k=c,n=!0)},r=function(a){n&&(e.classList.remove("is-dragging"),c.removeChild(f),f=null,n=!1)},p=throttledFn(30,function(a){if(n){var b=a.clientY;l=a.clientX-g;m=b-k;f.style.transform="translate3d("+l+"px, "+m+"px, 0)";b=f.getBoundingClientRect();a=b.y;b=a+b.height;for(var q=c.querySelectorAll("tbody tr"),p=0;p<q.length;p++){var r=q[p],t=r.getBoundingClientRect(),
A=t.y,w=A+t.height;e!==r&&Math.max(a,b)>=Math.min(A,w)&&Math.min(a,b)<=Math.max(A,w)&&Math.abs(a-A)<t.height/2&&(t=p,A=Array.from(d.children).indexOf(e),d.insertBefore(A>t?e:r,A>t?r:e))}debounceCheckDraggableApprovalItems()}});ctrl.approvalDragMouseDownEvent&&document.removeEventListener("mousedown",ctrl.approvalDragMouseDownEvent);ctrl.approvalDragMouseMoveEvent&&document.removeEventListener("mousemove",ctrl.approvalDragMouseMoveEvent);ctrl.approvalDragMouseUpEvent&&document.removeEventListener("mouseup",
ctrl.approvalDragMouseUpEvent);document.addEventListener("mousedown",q);document.addEventListener("mousemove",p);document.addEventListener("mouseup",r);ctrl.approvalDragMouseDownEvent=q;ctrl.approvalDragMouseMoveEvent=p;ctrl.approvalDragMouseUpEvent=r}
function _addThresholdInput(){var a=builder.thresholdRow,b=getRowIndex(a),c=$("floatWinPromptInput").value.trim();if(isMultiSource(b)&&/^$|^(\-|\+)?([0-9]+)$/.test(c)){c=Number(c);var d=a.querySelector(".thresholdTd");if(1<=c){var e=document.createElement("A");e.appendChild(document.createTextNode(c));e.href="javascript:void(0);";e.onclick=function(){addThresholdInput.call(a,c)};rm(d);d.appendChild(e);builder.approvalItems[b].setThresholdNum(c)}else rm(d),builder.approvalItems[b].setThresholdNum(-1);
$("floatingWin").style.display="none"}}function addThresholdInput(a){builder.thresholdRow=this;isNaN(a)&&(a="");floatWinPrompt("_addThresholdInput",lm.setApprovalAccpetedNum,"",a,!1)}function isApprovalSource(a){if(a=builder.approvalItems[a])return a.ifSource}function isMultiSource(a){var b=builder.approvalItems[a];if(0>a||a>=builder.approvalItems.length-1)return!1;if(b)return b.ifSource&&!isApprovalSource(a+1)}
function getAllApprovalItemsInSource(a){var b=[],c=builder.approvalItems,d=getNextApprovalSource(a);a=getThisApprovalSource(a);d=d?c.indexOf(d):builder.approvalItems.length;c=c.indexOf(a);if(-1<d&&-1<c)for(;c<d;c++)b.push(builder.approvalItems[c]);return b}function getPreviousApprovalSource(a){var b=builder.approvalItems;if(0>a||a>=b.length)return null;for(var c=0;0<=a;a--)if(b[a].ifSource&&(c++,2===c))return b[a];return null}
function getNextApprovalSource(a){var b=builder.approvalItems;if(0>a||a>=b.length)return null;for(a+=1;b.length>a;a++)if(b[a].ifSource)return b[a];return null}function getThisApprovalSource(a){var b=builder.approvalItems;if(0>a||a>=b.length)return null;for(;0<=a;a--)if(b[a].ifSource)return b[a]}function getRowIndex(a){a=a.approvalItem;console.log(a);return builder.approvalItems.indexOf(a)}
function createApprovalItem(a,b){b=isNaN(b)?-1:parseInt(b);var c=-1<b,d=null;a||(null===builder.approvalType&&(builder.approvalType="M"),null===builder.approvalFlag&&(builder.approvalFlag=getStdApprovalFlag(),$("approvalAdvanceAnchor").style.display="inline-block",showApprovalPolicy(),initApprovalCCSelect(),initActionButtonAfterApprovalSelect()),c?(d=new ApprovalStep("","A",""),d.setIfSource(!1),builder.approvalItems.splice(b+1,0,d)):(d=new ApprovalStep("","A",""),builder.approvalItems.push(d)));
var e=document.querySelector("#approvalTable TBODY"),f=c?b+1:e.rows.length;a=c?e.insertRow(b+1):e.insertRow(-1);if(c){var g=e.rows.length;for(b+=1;b<g;b++)e.rows[b].dataset.index=""+b}a.dataset.index=""+f;d&&(a.approvalItem=d);builder.approvalItems[f].approvalRules&&0<JSON.parse(decodeURIComponent(builder.approvalItems[f].approvalRules)).rules.length&&(a.style.backgroundColor="lightgrey");a.insertCell(-1).classList.add("stepIdTd");b=a.insertCell(-1);d=document.createElement("INPUT");b.classList.add("titleTd");
c||(d.onblur=function(){inNUI();changeApprovalItem(this)},d.onfocus=outNUI,d.type="text",d.style.width="100%",b.appendChild(d));c=a.insertCell(-1);c.style.padding="3px";var k=BarSelectAgent.modifiedSelector("",document.querySelector(".wfDesignate").cloneNode(!0),c,{});k.setAfterSelectOption(function(a){changeApprovalItemV2(a,k)});b=a.insertCell(-1);c=document.createElement("I");c.classList.add("fa");c.classList.add("fa-cog");b.appendChild(c);a.insertCell(-1).classList.add("thresholdTd");f=isMultiSource(f)?
new DMenu([{name:lm["delete"],func:deleteApprovalItem.bind(a)},{name:lm.approvalRuleSet,func:openApprovalRules.bind(a)},{name:lm.insertApprovalProcess,func:insertApprovalStep.bind(a)},{name:lm.setApprovalAccpetedNum,func:addThresholdInput.bind(a)}],null):new DMenu([{name:lm["delete"],func:deleteApprovalItem.bind(a)},{name:lm.approvalRuleSet,func:openApprovalRules.bind(a)},{name:lm.insertApprovalProcess,func:insertApprovalStep.bind(a)}],null);a.dm=f;f.attach(c,4,{scrollableParentId:"designModeHelper"});
d.focus();return a}
function checkApprovalOption(a){var b=a.parentNode.parentNode.dataset.index,c=getAllApprovalItemsInSource(parseInt(b));b=getPreviousApprovalSource(parseInt(b));b=builder.approvalItems.indexOf(b);b=getAllApprovalItemsInSource(b);null!=b&&1<b.length||1<c.length?(a.querySelector("option[value='DSL']").style.display="none",a.querySelector("option[value='DSL']").setAttribute("disabled","")):(a.querySelector("option[value='DSL']").style.display="",a.querySelector("option[value='DSL']").removeAttribute("disabled"))}
function changeApprovalItemV2(a,b){b=b.parent.parentNode.dataset.index;b<builder.approvalItems.length&&(b=builder.approvalItems[b],b.transactorType=a.groupDataset.designate?a.groupDataset.designate:"A",b.transactor=a.value)}
function changeApprovalItem(a){var b=a.parentNode.parentNode.dataset.index;if(b<builder.approvalItems.length)switch(b=builder.approvalItems[b],a.tagName.toLowerCase()){case "input":if(-1!==a.value.indexOf("|")||-1!==a.value.indexOf(",")){floatWinWarning("Can not use [, |] in Approver Title");a.value=a.value.replace(/[,|]/ig,"");break}b.name=a.value;break;case "select":var c=a.options[a.selectedIndex];b.transactorType=c.parentNode.dataset.designate?c.parentNode.dataset.designate:"A";b.transactor=a.value}}
function setExecuteActionButtonAfterApproval(a){builder.executeActionButtonAfterApproval=a.getValues()}function setApprovalCC(a){builder.approvalCC=a.getValues()}function changeApprovalPolicy(a,b){builder.approvalFlag=builder.approvalFlag.replaceAt(b,a.checked?"1":"0")}
function deleteApprovalItem(){var a=this,b=document.querySelector("#approvalTable TBODY"),c=parseInt(a.dataset.index),d=isApprovalSource(c),e=getAllApprovalItemsInSource(c),f=1;d?f=e.length:2===e.length&&(rm(b.querySelector('tr[data-index="'+(c-1)+'"] .thresholdTd')),getThisApprovalSource(c).setThresholdNum(-1));for(d=f;0<d;d--)a=a.nextSibling,b.deleteRow(c);for(builder.approvalItems.splice(c,f);a;)a.dataset.index=""+c++,a=a.nextSibling;$("floatingApprovalRules").style.display="none";0===builder.approvalItems.length&&
(builder.approvalType=null,builder.approvalFlag=null,$("approvalAdvanceAnchor").style.display="none")}function insertApprovalStep(){var a=getRowIndex(this);createApprovalItem(!1,a);isMultiSource(a)&&(a=this.dm.json,a.find(function(a){return a.name===lm.setApprovalAccpetedNum})||a.push({name:lm.setApprovalAccpetedNum,func:addThresholdInput.bind(this)}))}
function openApprovalRules(){var a=parseInt(this.dataset.index);RagicApprovalRules.loadRules(builder.approvalItems[a].approvalRules,a);RagicApprovalRules.render()}function getReminder(a){if(a){a=parseInt(a);var b=null,c;for(c in builder.reminders)if(a===builder.reminders[c].seq){b=builder.reminders[c];break}return b}}function getCurrentEditReminder(){var a=$("reminderDiv").dataset.seq;if(a)return getReminder(a)}
function loadReminders(){var a=$("at_exeDate"),b=$("at_mailField");a.options.length=0;rm(b);var c=Object.keys(builder.cellData).filter(function(a){a=builder.cellData[a];return!builder.ifAdjacent(a.x,a.y)&&!(a.attr&&a.attr.ag)}),d,e=c.length;for(d=0;d<e;d++){var f=builder.cellData[c[d]];if(f.hasAttribute("fmt_d")&&-1!==f.attr.fmt_d.indexOf("d"))a.options.add(new Option(f.value,f.domainId));else if(-1!==f.value.toLowerCase().search("mail")||-1!==f.value.search("\u4fe1\u7bb1")||-1!==f.value.search("\u90f5\u4ef6")||
-1!==f.value.search("\u90ae\u4ef6"))b.appendChild(new Option(f.value,f.domainId)),f.isMail=!0}for(d=0;d<e;d++)f=builder.cellData[c[d]],f.attr&&f.attr.fmt_d||f.isMail||b.appendChild(new Option(f.value,f.domainId));a.options.length?($("reminderDiv").style.display="",$("NoDateFieldPoster").style.display="none",$("RMD__test__btn").style.display=""):($("reminderDiv").style.display="none",$("NoDateFieldPoster").style.display="",$("RMD__test__btn").style.display="none");for(a=$("reminderTable");1<a.rows.length;)a.deleteRow(-1);
for(d=0;d<builder.reminders.length;d++){b=builder.reminders[d];c=b.days;f=a.insertRow(-1);var g=node("SPAN");g.style.cursor="pointer";g.color="#7A2900";e=g.cloneNode(!1);g=g.cloneNode(!1);var k=node("I");e.setAttribute("seq",b.seq);e.title="load "+b.name;e.onclick=loadReminder.bind(null,b.seq);e.textContent=b.name;g.title=lm["delete"];g.onclick=deleteReminder.bind(null,b.seq);k.classList.add("fal","fa-times");g.appendChild(k);f.insertCell(0).appendChild(e);f.insertCell(1).textContent=Math.abs(c)+
" day"+(1<c||-1>c?"s":"")+" "+(0<c?"before":"after");f.insertCell(2).appendChild(g)}0===builder.reminders.length&&(f=a.insertRow(-1),d=f.insertCell(0),d.textContent=lm.noReminderBuilt,d.colSpan=3,d.style.color="#aaa",d.style.textAlign="center")}
function saveReminder(){var a=$("at_reminderName").value.trim();if(a){var b=builder.maxRmdSeq+1,c=parseInt($("at_days").value);if(Number.isNaN){if(Number.isNaN(c)){floatWinWarning(lm.valueFormatIncorrect);return}}else if(isNaN(c)){floatWinWarning(lm.valueFormatIncorrect);return}var d=$("at_sendTarget").value,e=c*parseInt($("at_timeSet").value),f=$("at_exeDate").value;c=$("reminderEmailModeSeparated").checked;0==d?a=new Reminder(a,f,e,"_notify_user","",b):1==d?(d=$("at_otherAddr").value.trim().replace(",",
";"),a=new Reminder(a,f,e,"",d,b)):a=new Reminder(a,f,e,d,"",b);a.emailMode=c?"SEPARATED":"MERGED";a.custReplyTo="DISTR"==licenseType?"":$("reminderCustReplyTo").value;b=a;c=$("reminderCreateTaskWhenRecordSavedDiv");d=$("reminderCreateTaskWhenRecordSaved");c=c&&d&&"none"!=c.style.display?d.checked:!0;b.createTaskWhenRecordSaved=c;a.originalSeq=a.seq;b=$("reminderApplySharedView");c=$("reminderSharedView");a.viewId=b&&c?b.checked?c.options[c.selectedIndex].value:-1:-1;builder.reminders.push(a);builder.maxRmdSeq++;
$("bReminder").click();return a}floatWinWarning(lm.reminder_noName)}
function loadReminder(a){$("bReminder").click();for(var b=0;b<builder.reminders.length;b++){var c=builder.reminders[b];if(c.seq===a){$("reminderDiv").dataset.seq=a;$("at_reminderName").value=c.name;var d=$("at_exeDate");for(b=0;b<d.options.length;b++)if(d.options[b].value==c.dateDomainId){var e=d.options[b].selected=!0;break}e?(e=!1,d.style.display=""):d.style.display="none";b=$("at_days");0>c.days&&($("at_timeSet").options[1].selected=!0);b.value=Math.abs(c.days);b=$("at_sendTarget");if(c.mailDomainId)if("_notify_user"===
c.mailDomainId)b.options[0].selected=!0;else{d=$("at_mailField");d.style.display="";for(b=0;b<d.childNodes.length;b++)if(d.childNodes[b].value==c.mailDomainId){e=d.childNodes[b].selected=!0;break}e?$("reminder_EmailFieldNotExistedDiv").style.display="none":$("reminder_EmailFieldNotExistedDiv").style.display=""}else e=$("at_otherAddr"),e.style.display="",c.otherAddr&&(e.value=c.otherAddr,b.options[1].selected=!0);$("setCustomReminder").onclick=function(){builderModeEmailTemplateEditors.reminder.open(a)};
$("RMD__test__btn").onclick=function(){testReminder(a)};$("reminderEmailModeSeparatedDiv").style.display="";(e="SEPARATED"===c.emailMode)?$("reminderEmailModeSeparated").setAttribute("checked",!0):$("reminderEmailModeSeparated").removeAttribute("checked");$("reminderEmailModeSeparated").onclick=function(){_displayReminderCustReplyTo(this.checked,c)};_displayReminderCustReplyTo(e,c);$("reminderCreateTaskWhenRecordSavedDiv").style.display="";c.createTaskWhenRecordSaved?$("reminderCreateTaskWhenRecordSaved").setAttribute("checked",
!0):$("reminderCreateTaskWhenRecordSaved").removeAttribute("checked");e=$("reminderSharedView");b=$("reminderApplySharedView");if(-1!=c.viewId&&e&&b){d=-1;for(var f=0;f<e.options.length;f++)if(e.options[f].value==c.viewId){d=f;break}-1!=d?(e.options[d].selected=!0,b.checked=!0,e.style.display=""):(b.checked=!1,e.style.display="none")}break}}}
function updateReminder(){var a=getCurrentEditReminder();if(a)if(a.notSaved)updateBuilderReminder(a);else{var b=a.seq;updateBuilderReminder(a)&&(a.notSaved=!0,builder.maxRmdSeq++,a.seq=builder.maxRmdSeq,0!==b&&builder.getEmailTemplatesByAttribute({type:"reminder",key:b}).forEach(function(b){builder.addEmailTemplate(b.name,b.subject,b.content,{type:"reminder",key:a.seq})}),deleteReminder(b),loadReminder(a.seq))}}
function updateBuilderReminder(a){var b=!1,c=$("at_reminderName").value.trim();if(!c)return $("at_reminderName").value=a.name,floatWinWarning(lm.reminder_noName),!1;c!==a.name&&(b=!0,a.name=c);c=parseInt($("at_days").value);if(Number.isNaN){if(Number.isNaN(c))return $("at_days").value=Math.abs(a.days),floatWinWarning(lm.valueFormatIncorrect),!1}else if(isNaN(c))return $("at_days").value=Math.abs(a.days),floatWinWarning(lm.valueFormatIncorrect),!1;var d=parseInt($("at_timeSet").value);c*=d;c!==a.days&&
(b=!0,a.days=c);a.dateDomainId=$("at_exeDate").value;c=$("at_sendTarget").value;switch(c){case "0":a.mailDomainId="_notify_user";a.otherAddr="";break;case "1":a.mailDomainId="";a.otherAddr=$("at_otherAddr").value.trim().replace(",",";");break;default:a.mailDomainId=c,a.otherAddr=""}a.emailMode=$("reminderEmailModeSeparated").checked?"SEPARATED":"MERGED";a.custReplyTo="DISTR"===licenseType?"":$("reminderCustReplyTo").value;c=$("reminderCreateTaskWhenRecordSavedDiv");d=$("reminderCreateTaskWhenRecordSaved");
c=c&&d&&"none"!==c.style.display?d.checked:!0;a.createTaskWhenRecordSaved=c;c=$("reminderApplySharedView");d=$("reminderSharedView");a.viewId=c&&d?c.checked?d.options[d.selectedIndex].value:-1:-1;b&&($("bReminder").click(),loadReminder(a.seq));return!0}function _displayReminderCustReplyTo(a,b){"DISTR"!=licenseType&&a?($("reminderCustReplyToDiv").style.display="",b.custReplyTo&&($("reminderCustReplyTo").value=b.custReplyTo)):$("reminderCustReplyToDiv").style.display="none"}
function deleteReminder(a){for(var b=0;b<builder.reminders.length;b++)if(builder.reminders[b].seq==a){builder.reminders.splice(b,1);break}$("bReminder").click();builder.removeEmailTemplateByAttribute({type:"reminder",key:a})}function testReminder(a){ajaxpost("/sims/t_reminder.jsp",{a:ap,p:path,si:sheetIndex,seq:a,testRMD:""},function(a){(a=a.trim())?window.open().document.write(a):floatWinWarning(lm.reminder_test_no_match)})}
function selInform(){var a=$("at_otherAddr");"1"==$("at_sendTarget").value?a.style.display="":a.style.display="none"}function getActionButton(a){if(a){a=parseInt(a);var b=null,c;for(c in builder.actionButtons)if(a===builder.actionButtons[c].seq){b=builder.actionButtons[c];break}return b}}function getNextActionButtonSeqNum(){var a=0,b;for(b in builder.actionButtons)parseInt(b)>a&&(a=parseInt(b));return a+1}function getNextActionButtonId(){return++builder.maxButtonId}
function updateBuilderActionButtonCheckBoxValue(a){a.confirmBeforeAction=$("at_actionConfirm").checked;a.confirmBeforeAction&&(a.customConfirmMessage=$("at_actionConfirm_custMsg").value?$("at_actionConfirm_custMsg").value.trim():"");a.needApproval=$("at_actionNeedApproval").checked;a.hideButton=$("at_actionHideButton").checked;a.checkIfUserCanEdit=$("at_actionCheckIfUserCanEdit").checked;var b=MultiSelectComboAgent.selectCombo.actionButtonAccessRightsSelect;b&&(a.userGroups=b.getValues())}
function addActionButton(){$("at_actionSeq").value="";var a=$("at_actionName").value,b=$("at_actionType").value,c=$("at_actionUrl").value;if(a&&b&&c){var d=getNextActionButtonSeqNum(),e=getNextActionButtonId();a=new ActionButton(e,b,d,a,formatNUIAttr(c));updateBuilderActionButtonCheckBoxValue(a);builder.actionButtons[d]=a;$("bActionButtons").click()}else floatWinWarning(lm.action_msg)}
function updateBuilderActionButton(){var a=$("at_actionSeq").value;if(a){var b=getActionButton(a);if(b){var c=!1,d=$("at_actionName").value,e=$("at_actionType").value,f=$("at_actionUrl").value;d&&e&&f?(b.name!==d&&(c=!0,b.name=d),b.type!==e&&(c=!0,b.type=e),b.action=formatNUIAttr(f),updateBuilderActionButtonCheckBoxValue(b),c&&getActionButtons(a)):($("at_actionName").value=b.name,$("at_actionType").value=b.type,$("at_actionUrl").value=b.action,floatWinWarning(lm.action_msg))}}}
function getActionButtons(a){var b=$("actionButtonsDiv"),c=Object.values(builder.actionButtons),d=0<c.length;rm(b);var e=node("TABLE");e.classList.add("panelGrid");for(var f=0;f<c.length;f++){var g=c[f],k=!1,l=e.insertRow(-1),m=l.insertCell(-1),n=l.insertCell(-1);l=l.insertCell(-1);var q=node("SPAN"),r=node("SPAN");m.width="54%";q.style.cursor="pointer";q.style.color="#7A2900";q.onclick=getActionButtons.bind(null,g.seq);q.textContent=g.name||"No name";m.appendChild(q);n.width="38%";"F"===g.type?n.textContent=
"URL":"B"===g.type?n.textContent="JS Workflow":g.type.startsWith("T_")&&(n.textContent="Tool",k=!0);l.width="8%";r.title=lm["delete"];r.style.cursor="pointer";r.style.color="blue";r.onclick=delActionButton.bind(null,g.seq);r.textContent="x";l.appendChild(r);a&&g.seq==a&&(m=$("at_actionUrl"),$("at_actionName").value=g.name,$("at_actionType").value=g.type,m.value=unformatNUIAttr(g.action),m.setAttribute("title",m.value),$("at_actionSeq").value=g.seq,$("at_actionConfirm").checked=g.confirmBeforeAction,
$("at_actionConfirm_custMsg_container").style.display=g.confirmBeforeAction?"":"none",g.customConfirmMessage&&($("at_actionConfirm_custMsg").value=g.customConfirmMessage),$("at_actionNeedApproval").checked=g.needApproval,$("at_actionHideButton").checked=g.hideButton,$("at_actionCheckIfUserCanEdit").checked=g.checkIfUserCanEdit,$("action_access_right_div").style.display="",displayActionButtonAccessRightSelection(g.userGroups),k?(m.readOnly=!0,m.classList.add("actionLock")):(m.readOnly=!1,m.classList.remove("actionLock")),
"B"===g.type&&m.value&&0==m.value.indexOf("_RAGIC_AUTOGEN_")?($("at_actionAdd").onclick=null,$("at_actionAdd").classList.remove("theButton4"),$("at_actionAdd").classList.add("theButton4_locked")):($("at_actionAdd").onclick=addActionButton,$("at_actionAdd").classList.add("theButton4"),$("at_actionAdd").classList.remove("theButton4_locked")))}a||($("at_actionAdd").onclick=addActionButton,$("at_actionAdd").classList.add("theButton4"),$("at_actionAdd").classList.remove("theButton4_locked"));d||(a=e.insertRow(-1).insertCell(-1),
a.style.color="#aaa",a.textContent="No action configured for this form yet.");b.appendChild(e);d||($("actionButtonsSortBtn").style.display="none");showToolButton()}function showToolButton(){var a=Array.from($("at_actionType").options);builder.ifListingPage()?a.forEach(function(a){a.classList.contains("listingPageToolButton")&&(a.style.display="block")}):a.forEach(function(a){a.classList.contains("formPageToolButton")&&(a.style.display="block")})}
function delActionButton(a){if(a){if("B"==builder.actionButtons[a].type){var b=builder.actionButtons[a].action.split("(")[0];if(isRagicAutoGeneratedActionButtonScript(b)&&1>=function(a){var b=0,c;for(c in builder.actionButtons){if(1<b)break;var d=builder.actionButtons[c].action;d&&(d=d.split("(")[0],d==a&&b++,d==a+"_REVERSE"&&this.delActionButton(c))}return b}(b)){b.endsWith("_REVERSE")?builder.sheetScope=deleteBetweenLines(builder.sheetScope,"function "+b+"(nodeId){","}//END"+b.replace("_REVERSE",
"")):builder.sheetScope=deleteBetweenLines(builder.sheetScope,"function "+b+"(nodeId){","}//END"+b);for(var c=(b.endsWith("_REVERSE")?builder.preworkflow:builder.postworkflow).split("\n"),d="",e=0;e<c.length;e++)c[e].startsWith(b)||(d+=c[e]+"\n");b.endsWith("_REVERSE")?builder.preworkflow=d:builder.postworkflow=d;b.startsWith("_RAGIC_AUTOGEN_SEND_CUSTOM_MAIL_")&&builder.removeEmailTemplateByAttribute({type:"actionButton",key:a});Object.values(builder.actionButtons).forEach(function(a){if((a=a.action)&&
-1!=a.indexOf("_RAGIC_AUTOGEN_MERGED_BUTTON_")&&-1!=a.indexOf("(")){a=a.substring(0,a.indexOf("("));var c=retrieveBetweenLines(builder.sheetScope,"function "+a+"(nodeId","}//END"+a);if(c&&-1!=c.indexOf(b)){c=c.split("\n");for(var d=0;d<c.length;d++)try{var e=c[d];e=e.replace("nodeId",'"${NODEID}"');var f=JSON.parse(e);if(f.ACTIONS){var n=f.ACTIONS.filter(function(a){return a!=b});f.ACTIONS=n;var q=JSON.stringify(f);q=q.replace('"${NODEID}"',"nodeId");c[d]=q}}catch(r){}e=c.join("\n");deleteBetweenLines(builder.sheetScope,
"function "+a+"(nodeId","}//END"+a);builder.sheetScope+=e}}})}}delete builder.actionButtons[a];a=builder.executeActionButtonAfterApproval.indexOf(a+"");-1<a&&builder.executeActionButtonAfterApproval.splice(a,1);$("bActionButtons").click()}}
function displayActionButtonAccessRightSelection(a){var b={a:ap,multiple:!0,dispAdmin:!0,id:"actionButtonAccessRightsSelect"};b.selectedGroups=a?encodeURIComponent(JSON.stringify(a)):encodeURIComponent(JSON.stringify(["EVERYONE"]));ajaxpost("/sims/groupSelector.jsp",b,function(a){$("actionButtonAccessRightsDiv").innerHTML=a;enableMultiSelectCombo($("actionButtonAccessRightsSelect"),!1,{fixedValues:["SYSAdmin"]}).setAfterChangeItem(function(){updateBuilderActionButton()})})}
function actionButtonSortingTool(){var a="<table id='listingFieldSelectorTable'><colgroup><col style='width:250px;'><col></colgroup><tr><td style='vertical-align:top;'><select id='listingFieldOptions' multiple='multiple' style='height:100%;width:100%;' size='10'>",b;for(b in builder.actionButtons){var c=builder.actionButtons[b];a+="<option value='"+c.seq+"'>"+c.name+"</option>"}floatWin(null,a+"</select></td><td><div onclick='listingFieldSelectorMove();' class='topButtonWhole topButtonWholeLight' style='padding:3px 8px;'><i class='fa fa-caret-up' style='font-size:15px;'></i></div><div onclick='listingFieldSelectorMove(true);' class='topButtonWhole topButtonWholeLight' style='padding:3px 8px;clear:left;'><i class='fa fa-caret-down' style='font-size:15px;'></i></div><tr></table>",
"Sort Action Buttons",!1);$("floatingOKButton").removeEventListener("click",sortActionButtons);$("floatingOKButton").addEventListener("click",sortActionButtons)}
function sortActionButtons(){for(var a=$("listingFieldOptions").options,b,c={},d=builder.actionButtons,e=0;e<a.length;e++)b=a[e],b=d[parseInt(b.value)],b.seq=e+1,c[e+1]=b;builder.actionButtons=c;rm($("actionButtonsDiv"));getActionButtons();$("floatingWin").style.display="none";$("floatingOKButton").removeEventListener("click",sortActionButtons)}
function loadRightsSetting(){for(var a in builder.rights){var b=builder.rights[a];b?saveRightsSetting(a,b):saveRightsSetting(a,0)}for(var c in builder.rightsDetail)a=builder.rightsDetail[c],1===a[0]&&saveRightsConfigSetting(c,0),1===a[1]&&saveRightsConfigSetting(c,1)}
function saveRightsSetting(a,b,c){c=void 0===c?!1:c;if(a){b||(b=0);b=parseInt(b);var d=builder.rights[a];"EVERYONE"==a&&c&&0<b&&0==d&&floatWin(null,lm.everyoneRightOpenWarn);builder.setRights(a,b);a=a.toUpperCase();$("rights_desc_"+a)&&($("rights_desc_"+a).innerHTML=$("rights_"+b).innerHTML,0===b?$("rights_desc_"+a).style.color="#aaa":$("rights_desc_"+a).style.color="");$("dropdown").style.display="none";$(a+"_accessDetail")&&(1==b||3==b?$(a+"_accessDetail").style.display="":$(a+"_accessDetail").style.display=
"none")}}function saveRightsConfigSetting(a,b,c){a&&(builder.setRightsConfig(a,b,c),$(a+"_accessDetail")&&!c&&(0===b&&($(a+"_noedit").checked=!0),1===b&&($(a+"_nocreate").checked=!0)))}function saveBuilderMode(a,b){var c=nui,d=c.fcol,e=c.frow;a||(a=builder.defaultMode);b?(builder.defaultMode=a,builder.cellData[d+","+e]||builder.freeData[d+","+e]||(builder.mode=a,c._focus(d,e))):builder.mode=a;$("bBuilderModeText").innerHTML=$("builderMode"+a).innerHTML;$("builderModes").style.display="none"}
function displayFormatType(a,b){1==a?($("f_fmt").style.display="",$("fmt_n_sample").style.display="",$("fmt_d_sample").style.display="none",$("fmt_n_adv_setting").style.display="inline-block",$("at_fmt_n").style.display="",$("f_fmt_asetting").style.display="",$("div_ago").style.display="none",$("div_utcTime").style.display="none",$("fmt_d_reminderLink").style.display="none"):2==a&&($("f_fmt").style.display="",$("fmt_n_sample").style.display="none",$("fmt_d_sample").style.display="",$("fmt_n_adv_setting").style.display=
"none",$("at_fmt_d").style.display="",$("f_fmt_asetting").style.display="",$("div_ago").style.display="",$("div_utcTime").style.display="",b||($("fmt_d_reminderLink").style.display=""))}var REPEAT_DATE_TYPE_YEARLY="1",REPEAT_DATE_TYPE_MONTHLY="2",REPEAT_DATE_TYPE_WEEKLY="3";
function displayRepeatDateSetupMenu(a,b){if(a&&a.attr){var c=a.attr.repeat;if(c){$("f_repeatDate").style.display="";var d=function(a,b){a&&a.attr&&(a.attr.repeat=b)};switch(c){case REPEAT_DATE_TYPE_YEARLY:$("repeatType_yearly").checked=!0;break;case REPEAT_DATE_TYPE_MONTHLY:$("repeatType_monthly").checked=!0;break;case REPEAT_DATE_TYPE_WEEKLY:$("repeatType_weekly").checked=!0}$("repeatType_yearly").onclick=function(){d(a,this.value)};$("repeatType_monthly").onclick=function(){d(a,this.value)};$("repeatType_weekly").onclick=
function(){d(a,this.value)};b||($("fmt_d_reminderLink").style.display="");$("f_dv").style.display="none"}}}function hasUnsavedFields(){var a=Object.keys(builder.cellData).some(function(a){return!builder.cellData[a].domainId}),b=builder.fieldDomainIdExist.some(function(a){return!builder.findField(a)});return a||b?(floatWinConfirmV3(lm.hasUnsavedFields,"saveBuilder();","Yes","ctrl.outOfNUI=false;$('floatingWin').style.display='none';","No"),!0):!1}var linkWizard=new LinkWizard;
function LinkWizard(){}LinkWizard.prototype.init=function(){document.body.style.overflowY="auto";var a=node("div");a.id="linkWizard";a.className="clearfix";document.body.appendChild(a);var b=node("div");b.id="linkWizardCanvas";document.body.appendChild(b);var c=a.offsetLeft;b.style.top=a.offsetTop+"px";b.style.left=c+"px";ctrl.isIE&&($("focus").style.display="none",$("focusDot").style.display="none");return getPromise("/sims/graph/raphael.js").then(eval)};
LinkWizard.prototype.displayWizard=function(a,b){a&&(this.path2=a,b||(this.formName2=null));b&&(this.formName2=b);a=$("linkWizard")?Promise.resolve(""):this.init();var c={a:ap,p1:path,fn1:sheet,c:builder.createNUI()};this.path2&&(c.p2=this.path2);this.formName2&&(c.fn2=this.formName2);this.specifyForm1LinkField&&(c.specify=this.specifyForm1LinkField);a.then(function(){return postPromise("/sims/domainLinker.jsp",c)}).then(function(a){$("linkWizard").innerHTML=a;rm($("linkWizardCanvas"));$("domainLinkerScript")&&
eval($("domainLinkerScript").innerHTML);ctrl.outOfNUI=!0;ctrl.resizeLinkWizardFlag&&(ctrl.resizeLinkWizardFlag=!1)})};LinkWizard.prototype.closeWizard=function(){document.body.style.overflowY="hidden";document.body.removeChild($("linkWizard"));document.body.removeChild($("linkWizardCanvas"));ctrl.form1SelectedCell=null;ctrl.form2SelectedCell=null;ctrl.outOfNUI=!1;builder.renderAll();ctrl.isIE&&($("focus").style.display="",$("focusDot").style.display="")};
function svg_prompt(a,b,c){a.rect(0,0,document.body.clientWidth,90).attr({fill:"#3d3d3d"});b=a.text(50,-50,b);b.attr({"text-anchor":"start",fill:"#ffffff","font-size":"28px"});b.animate({y:30},300,"<>");c&&(c=a.text(52,-50,c),c.attr({"text-anchor":"start",fill:"#ffffff","font-size":"14px"}),c.animate({y:60},300,"<>"));c=$("linkWizardCanvas").offsetWidth-200;500>c&&(c=500);a=a.text(c,25,lm.exitLinkManager);a.attr({"text-anchor":"end","font-size":"14px",cursor:"pointer",fill:"#e2dd4a"});a.click(function(){linkWizard.closeWizard()})}
function svg4rep_prompt(a,b,c){a.rect(0,0,document.body.clientWidth,90).attr({fill:"#3d3d3d"});b=a.text(50,-50,b);b.attr({"text-anchor":"start",fill:"#ffffff","font-size":"28px"});b.animate({y:30},300,"<>");c&&(c=a.text(52,-50,c),c.attr({"text-anchor":"start",fill:"#ffffff","font-size":"14px"}),c.animate({y:60},300,"<>"));a=a.text($("reportWizardCanvas").offsetWidth-50,25,lm.exitReportMaker);a.attr({"text-anchor":"end","font-size":"14px",cursor:"pointer",fill:"#e2dd4a"});a.click(function(){reportWizard.closeWizard()})}
function getRafaLoc(a,b){if(!a)return"0,0";var c=findPos(a);return c[0]+(b?a.offsetWidth:0)+","+(c[1]+a.offsetHeight/2)}function initRectData(a,b){var c=b.id.split("_");a.data("form",c[2]);a.data("x",c[3]);a.data("y",c[4]);a.data("obj",b)}var domainLinker1PosX=[],domainLinker1PosY=[],domainLinker2PosX=[],domainLinker2PosY=[];
function initDomainLinkerCellPos(){var a;findPos($("domainDisplay_1"));for(var b=$("domainPicker_1").getAttribute("maxY"),c=1;a=$("_dd_1_"+c+"_"+b)||8>=c;c++)if(a){var d=findPos(a);domainLinker1PosX[c]=d[0];var e=a}domainLinker1PosX[c]=d[0]+e.offsetWidth;for(c=1;a=$("_dd_1_1_"+c);c++)d=findPos(a),domainLinker1PosY[c]=d[1],e=a;domainLinker1PosY[c]=d[1]+e.offsetWidth;if($("domainPicker_2")){findPos($("domainDisplay_2"));b=$("domainPicker_2").getAttribute("maxY");for(c=1;a=$("_dd_2_"+c+"_"+b)||8>=c;c++)a&&
(d=findPos(a),domainLinker2PosX[c]=d[0],e=a);domainLinker2PosX[c]=d[0]+e.offsetWidth;for(c=1;a=$("_dd_2_1_"+c);c++)d=findPos(a),domainLinker2PosY[c]=d[1],e=a;domainLinker2PosY[c]=d[1]+e.offsetWidth}}
function getDomainLinkerMouseoverCell(a){var b=a.clientX+(document.body.scrollLeft?document.body.scrollLeft:document.documentElement.scrollLeft);a=a.clientY+(document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop);var c=0,d=0,e;if(b<domainLinker1PosX[1]||b>domainLinker2PosX[domainLinker2PosX.length-1]||b>domainLinker1PosX[domainLinker1PosX.length-1]&&(0==domainLinker2PosX.length||b<domainLinker2PosX[1]))return null;if(b<domainLinker2PosX[1]){for(e=1;e<domainLinker1PosX.length;e++)if(b<
domainLinker1PosX[e]){c=e-1;break}for(e=1;e<domainLinker1PosY.length;e++)if(a<domainLinker1PosY[e]){d=e-1;break}return(b=$("_dd_1_"+c+"_"+d))&&b.hasAttribute("subtableCellWhite")?null:b}for(e=1;e<domainLinker2PosX.length;e++)if(b<domainLinker2PosX[e]){c=e-1;break}for(e=1;e<domainLinker2PosY.length;e++)if(a<domainLinker2PosY[e]){d=e-1;break}return(b=$("_dd_2_"+c+"_"+d))&&b.hasAttribute("domainId")&&-1!=b.getAttribute("domainId")?b:null}
function svg_hl(a,b,c,d,e,f,g,k,l,m){if(!a||!d)return null;var n=findPos(b),q=a.rect(n[0],n[1]+1,b.offsetWidth,b.offsetHeight);initRectData(q,b);q.data("domainId",c);q.data("defColor",d);b.rect=q;q.attr({stroke:d,"stroke-width":2,fill:"#fff","fill-opacity":0});q.toFront();e&&f&&q.hover(e,f);g&&q.click(g);k&&l&&m&&q.drag(k,l,m);b.getAttribute("attr");c=b.getAttribute("domainid");c=parseInt(c)||-1;a=a.image("/sims/img/delete.png",n[0]+b.offsetWidth+3,n[1]+5,12,12);q.data("removeImg",a);a.click(function(a){cancelEventBubble(a);
deleteEditingLink()});a.hide();return q}function dragLinkedFieldStart(a,b,c){ctrl.dragLinkedFieldStart=getDomainLinkerMouseoverCell(c)}function dragLinkedFieldMove(a,b,c,d,e){ctrl.form1LinkedTargetRoot.getAttribute("domainId");(a=getDomainLinkerMouseoverCell(e))&&a.getAttribute("domainId")&&5>a.getAttribute("level")?(ctrl.linkFieldDragHL&&ctrl.linkFieldDragHL.remove(),ctrl.linkFieldDragHL=svg_hl(this.paper,a,0,"#08c")):ctrl.linkFieldDragHL&&ctrl.linkFieldDragHL.remove()}
function dragLinkedFieldEnd(a){var b=ctrl.form1LinkedTargetRoot.getAttribute("domainId"),c=getDomainLinkerMouseoverCell(a);if(ctrl.dragLinkedFieldStart&&c&&ctrl.dragLinkedFieldStart.id==c.id)ctrl.dragLinkedFieldStart=null;else if(c&&(c.getAttribute("it")&&"L"===c.getAttribute("it")||c.getAttribute("attr")&&c.getAttribute("attr").includes("fmt_n")||c.getAttribute("attr")&&c.getAttribute("attr").includes("masked")||c.getAttribute("attr")&&c.getAttribute("attr").includes("sig")||c.getAttribute("attr")&&
c.getAttribute("attr").includes("html")))ctrl.dragLinkedFieldStart=null,floatWinWarning(lm.linkWizard_invalidStf),linkWizard.displayWizard();else if(c&&c.getAttribute("domainId")&&5>c.getAttribute("level")){a=c.getAttribute("domainId");var d=c.getAttribute("it")===UPLOADER||c.getAttribute("it")===GRAPHICS;getPromise("/sims/checkIfNoDup.jsp",{a:ap,di:a,f:d,rdi:ctrl.form2RootDomainId}).then(function(a){a=JSON.parse(a);var d=a.noDup,e=a.dupValue;if("error"===a.status)return linkWizard.displayWizard(),
!1;if(d)builder.setAttributeByDomainId(b,"stf",c.getAttribute("domainId")),linkWizard.displayWizard();else return floatWinWarning(lm.linkWizard_linkToDupField.replace("{0}",c.getAttribute("value")).replace("{1}",e)),linkWizard.displayWizard(),!1})}else ctrl.linkFieldDragHL&&ctrl.linkFieldDragHL.remove()}
function svg_link(a,b,c,d,e,f,g){if(!a||!b||!c)return null;d||(d="#ccc");a=a.path("M"+getRafaLoc(b,!0)+"T"+getRafaLoc(c));a.data("defColor",d);a.attr({stroke:d,"stroke-width":2});b.rect&&c.rect&&(b.rect.data("obj1",b.rect),b.rect.data("obj2",c.rect),b.rect.data("path",a),c.rect.data("obj1",b.rect),c.rect.data("obj2",c.rect),c.rect.data("path",a),a.data("obj1",b.rect),a.data("obj2",c.rect),a.data("path",a));e&&f&&a.hover(e,f);g&&a.click(g);return a}
function linkStep1HoverRectClick(a){var b=parseInt(this.data("x")),c=parseInt(this.data("y"));a=this.data("form");var d=this.data("domainId");b=$("_dd_"+a+"_"+b+"_"+c);if(!(5<=b.getAttribute("level")||4<=b.getAttribute("level")&&"2"==a)&&("1"==a?ctrl.form1SelectedCell?(ctrl.form1SelectedCell.rect&&ctrl.form1SelectedCell.rect.remove(),ctrl.hoverRect.attr({"stroke-opacity":0}),b.id!=ctrl.form1SelectedCell.id&&(ctrl.form1SelectedCell=b,svg_hl(ctrl.paper,b,d,"#a00"))):(ctrl.form1SelectedCell=b,svg_hl(ctrl.paper,
b,d,"#a00")):"2"==a&&(ctrl.form2SelectedCell?(ctrl.form2SelectedCell.rect&&ctrl.form2SelectedCell.rect.remove(),ctrl.form2SelectedCell=null,ctrl.hoverRect.attr({"stroke-opacity":0}),b!=ctrl.form2SelectedCell&&(ctrl.form2SelectedCell=b,svg_hl(ctrl.paper,b,d,"#a00"))):(ctrl.form2SelectedCell=b,svg_hl(ctrl.paper,b,d,"#a00"))),ctrl.form1SelectedCell&&ctrl.form2SelectedCell)){var e=ctrl.form1SelectedCell.rect.data("x"),f=ctrl.form1SelectedCell.rect.data("y");a=ctrl.form1SelectedCell.rect.data("domainId");
var g=ctrl.form2SelectedCell.rect.data("domainId"),k=ctrl.form2SelectedCell.rect.data("obj").getAttribute("it")===UPLOADER||ctrl.form2SelectedCell.rect.data("obj").getAttribute("it")===GRAPHICS;ctrl.form1RootDomainId==ctrl.form2RootDomainId&&a===g?(floatWinWarning(lm.linkWizardAlert1),ctrl.form1SelectedCell=null,ctrl.form2SelectedCell=null,linkWizard.displayWizard()):getPromise("/sims/checkIfLinkedByOtherFields.jsp",{a:ap,di:a}).then(function(a){var b=JSON.parse(a);a=b.msg;return"error"===b.status?
Promise.reject():a?(b=ctrl.form1SelectedCell.getAttribute("value"),a='<div style="line-height:1.5;padding:0 10px;max-width:800px;">'+lm.linkWizard_sourceFieldCantLink1+a.replace(/\{0\}/g,b)+lm.linkWizard_sourceFieldCantLink2.replace(/\{0\}/g,b)+"</div>",floatWinWarning(a),Promise.reject()):getPromise("/sims/checkIfNoDup.jsp",{a:ap,di:g,f:k,rdi:ctrl.form2RootDomainId})}).then(function(a){a=JSON.parse(a);var b=a.noDup,c=a.dupValue;if("error"===a.status)return Promise.reject();if(!b)return floatWinWarning(lm.linkWizard_linkToDupField.replace("{0}",
ctrl.form2SelectedCell.rect.data("obj").getAttribute("value")).replace("{1}",c)),Promise.reject()}).then(function(){if(!builder.cellData[e+","+f])if(builder.isPositionValid(e,f))if(builder.isPositionValidV2(e,f,null,{addFree:!1}).isValid)builder.setField(e,f,ctrl.form2SelectedCell.rect.data("obj").getAttribute("value")),ctrl.form2SelectedCell.hasAttribute("lov")&&builder.setAttribute(e,f,"lov",ctrl.form2SelectedCell.getAttribute("lov").replace(/`/g,ctrl.CRLF));else return Promise.reject();else return Promise.reject();
builder.resetAttributesForLinking(e,f);builder.setAttribute(e,f,"it","L");linkWizard.specifyForm1LinkField=e+"|"+f;if(1==ctrl.form2RootDomainId&&4==g)builder.setAttribute(e,f,"usrref","2");else if(3==ctrl.form2RootDomainId&&3==g)builder.setAttribute(e,f,"grpref","2");else{var a=ctrl.form2RootDomainId,b=null;builder.setAttribute(e,f,"s",""+a);builder.setAttribute(e,f,"stf",""+g);ctrl.linkManagerPath2&&ctrl.linkManagerFormName2&&(b=ctrl.linkManagerPath2+"|"+ctrl.linkManagerFormName2,builder.setAttribute(e,
f,"mvp",b));builder.addLinkAndLoadAction("ADD",ctrl.form1SelectedCell.getAttribute("domainid"),g,a,b)}ctrl.form1SelectedCell=null;ctrl.form2SelectedCell=null;ctrl.linkToForm2RootFieldDomainId=!0;linkWizard.displayWizard()}).catch(function(a){a&&console.log(a);ctrl.form1SelectedCell=null;ctrl.form2SelectedCell=null;linkWizard.displayWizard()})}}
DesignModeBuilder.prototype.addLinkAndLoadAction=function(a,b,c,d,e){a&&b&&c&&d&&e&&(a={action:a,domainId:b,stf:c,s:d,mvp:e},null==this.linkAndLoadActions&&(this.linkAndLoadActions=[]),this.linkAndLoadActions.push(a))};DesignModeBuilder.prototype.removeLinkAndLoadActions=function(){this.linkAndLoadActions&&delete this.linkAndLoadActions};
function hideHoverLinks(){if(ctrl.hoverPath){try{ctrl.hoverPath.remove()}catch(a){}ctrl.hoverPath=null}ctrl.hoverRect&&ctrl.hoverRect.attr({"stroke-opacity":0});ctrl.hoverRect2&&ctrl.hoverRect2.attr({"stroke-opacity":0})}
function linkStep1Mousemove(a){a=a?a:window.event;a=getDomainLinkerMouseoverCell(a);if(!a||!ctrl.hoverRect||5<=a.getAttribute("level"))hideHoverLinks(),hideTinyTooltip();else{var b=findPos(a),c=a.id.split("_"),d=c[2];if(a.firstChild&&a.firstChild.firstChild){var e=a.getAttribute("value");hideTinyTooltip();tooltipTiny(a,e)}else hideTinyTooltip();if("true"===a.dataset.disable)hideHoverLinks();else{ctrl.hoverRect.attr({x:b[0]+1,y:b[1]+1,width:a.offsetWidth,height:a.offsetHeight,stroke:"#a00","stroke-width":2,
"stroke-opacity":1,fill:"#fff","fill-opacity":0});ctrl.hoverRect.data("x",c[3]);ctrl.hoverRect.data("y",c[4]);ctrl.hoverRect.data("form",d);ctrl.hoverRect.data("domainId",a.getAttribute("domainId"));if(ctrl.hoverPath){try{ctrl.hoverPath.remove()}catch(f){}ctrl.hoverPath=null}ctrl.form1SelectedCell&&"2"==c[2]?ctrl.hoverPath=svg_link(ctrl.paper,ctrl.form1SelectedCell,a,"#a00"):ctrl.form2SelectedCell&&"1"==c[2]&&(ctrl.hoverPath=svg_link(ctrl.paper,a,ctrl.form2SelectedCell,"#a00"))}}}
function linkStep2HoverRectClick(a){var b=parseInt(this.data("x")),c=parseInt(this.data("y")),d=this.data("form");a=this.data("domainId");b=$("_dd_"+d+"_"+b+"_"+c);c=ctrl.form1LinkedTargetRoot;c.getAttribute("it")===MSELECTOR?floatWinWarning(lm.linkWizard_multiSelectLinkedField.replace("{0}",c.getAttribute("value"))):("1"==d?ctrl.form1SelectedCell?(ctrl.form1SelectedCell.rect&&ctrl.form1SelectedCell.rect.remove(),ctrl.hoverRect.attr({"stroke-opacity":0}),b.id!=ctrl.form1SelectedCell.id&&(ctrl.form1SelectedCell=
b,svg_hl(ctrl.paper,b,a,"#a00"))):(ctrl.form1SelectedCell=b,svg_hl(ctrl.paper,b,a,"#a00")):"2"==d&&(ctrl.form2SelectedCell?(ctrl.form2SelectedCell.rect&&ctrl.form2SelectedCell.rect.remove(),ctrl.form2SelectedCell=null,ctrl.hoverRect.attr({"stroke-opacity":0}),b!=ctrl.form2SelectedCell&&(ctrl.form2SelectedCell=b,svg_hl(ctrl.paper,b,a,"#a00"))):(ctrl.form2SelectedCell=b,svg_hl(ctrl.paper,b,a,"#a00"))),ctrl.form1SelectedCell&&ctrl.form2SelectedCell&&(d=ctrl.form1SelectedCell.rect.data("x"),b=ctrl.form1SelectedCell.rect.data("y"),
a=ctrl.form2SelectedCell.rect.data("domainId"),doListenLink(d,b,a)))}
function checkCreateNewField(a,b){if(!builder.cellData[a+","+b])if(builder.isPositionValid(a,b)){builder.setField(a,b,ctrl.form2SelectedCell.rect.data("obj").getAttribute("value"));var c=ctrl.form2SelectedCell.rect.data("obj").getAttribute("attr");if(c){c=c.split("&");for(var d=0;d<c.length;d++){var e=c[d].split("=");"fmt_d"!=e[0]&&"fmt_n"!=e[0]&&"checkbox"!=e[0]&&"barcode"!=e[0]&&"bc_type"!=e[0]||builder.setAttribute(a,b,e[0],e[1])}}}else return!1;return!0}
function doListenLink(a,b,c){var d=ctrl.form2SelectedCell.getAttribute("level"),e=ctrl.form1SelectedCell?ctrl.form1SelectedCell.getAttribute("level"):"2";if("5"==d||"5"==e)floatWinWarning("You cannot link to a field in the parent form");else if("3"==d)floatWinWarning("You cannot link to a subtable field.");else if("4"==d)floatWinWarning("You cannot link to a subtable field");else if("1"==d||"2"==d){if(!checkCreateNewField(a,b))return;builder.resetAttributesForLinking(a,b);d=ctrl.form2SelectedCell.getAttribute("it");
builder.setAttribute(a,b,"it",d);builder.copyAttribute(a,b,ctrl.form2SelectedCell.getAttribute("attr"),"fmt_n fmt_d usrref grpref sig html email phone addr url phonefmt s mvp stf checkbox masked masked_mode masked_viewableGroups repeat barcode bc_type multipleImages multipleFiles".split(" "),["noDup"]);builder.setAttribute(a,b,"vd",""+c);builder.setAttribute(a,b,"l",""+ctrl.linkToForm2RootFieldDomainId);c=builder.getAttribute(a,b,"mvp");d=builder.getAttribute(a,b,"stf");d=c&&d;e=!builder.getAttribute(a,
b,"s");d&&e&&ajaxget("/sims/nuiLookup.jsp",{a:ap,lf:"kf",mvpString:c},function(c){c=JSON.parse(c);builder.setAttribute(a,b,"s",c.kf)})}linkWizard.displayWizard();ctrl.form1SelectedCell=null;ctrl.form2SelectedCell=null}
function linkStep2Mousemove(a){a=a?a:window.event;if((a=getDomainLinkerMouseoverCell(a))&&ctrl.hoverRect){var b=findPos(a),c=a.id.split("_"),d=c[2],e=c[3],f=c[4];if("2"==d&&(!a.hasAttribute("domainId")||-1==a.getAttribute("domainId")||2<a.getAttribute("level")))ctrl.hoverRect.attr({"stroke-opacity":0});else{if(a.firstChild&&a.firstChild.firstChild){var g=a.getAttribute("value");tooltipTiny(a,g)}else hideTinyTooltip();if("1"==d&&"5"==a.getAttribute("level"))ctrl.hoverRect.attr({"stroke-opacity":0}),
hideHoverLinks();else if(a.hasAttribute("hasLink"))ctrl.hoverRect.attr({"stroke-opacity":0}),hideHoverLinks();else if("true"===a.dataset.disable||"true"===a.dataset.isfree)ctrl.hoverRect.attr({"stroke-opacity":0}),hideHoverLinks();else{ctrl.hoverRect.attr({x:b[0],y:b[1]+1,width:a.offsetWidth,height:a.offsetHeight,stroke:"#a00","stroke-width":2,"stroke-opacity":1,fill:"#fff","fill-opacity":0});ctrl.hoverRect.data("form",d);ctrl.hoverRect.data("x",e);ctrl.hoverRect.data("y",f);ctrl.hoverRect.data("domainId",
a.getAttribute("domainId"));ctrl.hoverRect.toFront();(b=$("_dd_2_"+(e-1)+"_"+f))&&b.rect&&(b=b.rect.data("removeImg"))&&b.toFront();if(ctrl.hoverPath){try{ctrl.hoverPath.remove()}catch(k){}ctrl.hoverPath=null}ctrl.form1SelectedCell&&"2"==c[2]?ctrl.hoverPath=svg_link(ctrl.paper,ctrl.form1SelectedCell,a,"#a00"):ctrl.form2SelectedCell&&"1"==c[2]&&(ctrl.hoverPath=svg_link(ctrl.paper,a,ctrl.form2SelectedCell,"#a00"))}}}else hideHoverLinks(),hideTinyTooltip()}
function linkStep2HoverIn(a){a=this.data("obj1");var b=this.data("obj2"),c=this.data("path");a.attr({"stroke-width":4});b.attr({"stroke-width":4});c.attr({"stroke-width":4})}function linkStep2HoverOut(a){a=this.data("path");if(ctrl.editingPath!=a){var b=this.data("obj1"),c=this.data("obj2");b.attr({"stroke-width":2});c.attr({"stroke-width":2});a.attr({"stroke-width":2})}}
function linkStep2Click(a){this.data("obj1");a=this.data("obj2");var b=this.data("path"),c;ctrl.editingPath&&(ctrl.editingPath.data("obj1").attr({"stroke-width":2}),ctrl.editingPath.data("obj2").attr({"stroke-width":2}),ctrl.editingPath.data("path").attr({"stroke-width":2}),(c=ctrl.editingPath.data("obj2").data("removeImg"))&&c.hide());ctrl.editingPath==b?(ctrl.editingPath=null,(c=a.data("removeImg"))&&c.hide()):(ctrl.editingPath=b,(c=a.data("removeImg"))&&c.show())}
function linkWizardKeydown(a){a||(a=window.event);switch(a.keyCode){case 8:case 46:case 68:return deleteEditingLink(),!1}return!0}
function deleteInvalidListeningLinks(a){for(var b in builder.cellData){var c=builder.cellData[b];c.hasAttribute("l")&&c.attr.l==a?(builder.setAttribute(c.x,c.y,"l"),builder.setAttribute(c.x,c.y,"vd"),builder.setAttribute(c.x,c.y,"stf"),builder.setAttribute(c.x,c.y,"mvp"),builder.setAttribute(c.x,c.y,"mvpf"),builder.setAttribute(c.x,c.y,"lnls"),builder.setAttribute(c.x,c.y,"s")):c.hasAttribute("ln")&&c.attr.ln==a&&(builder.setAttribute(c.x,c.y,"ln"),builder.setAttribute(c.x,c.y,"vdn"),builder.setAttribute(c.x,
c.y,"stf"),builder.setAttribute(c.x,c.y,"mvp"),builder.setAttribute(c.x,c.y,"mvpf"),builder.setAttribute(c.x,c.y,"lnls"))}}
function deleteMainLink(a){var b=a.x,c=a.y;a.attr&&a.attr.rf&&(builder.setAttribute(b,c,"rf"),builder.setAttribute(b,c,"stf"),builder.setAttribute(b,c,"mvp"),builder.setAttribute(b,c,"mvpf"),builder.setAttribute(b,c,"lnls"));if(a.attr&&a.attr.s){var d=!0;ajaxget("/sims/checkIfSubtableAliasOfParentSheet.jsp",{a:ap,p:path,si:sheetIndex,d:a.domainId},function(a){(a=JSON.parse(a))&&!0===a.isSubtableAliasOfParentSheet&&(d=!1)},!0);if(d){var e=a.attr.s?parseInt(a.attr.s):-1,f=a.attr.stf?parseInt(a.attr.stf):
-1,g=a.attr.mvp;builder.setAttribute(b,c,"s");builder.setAttribute(b,c,"stf");builder.setAttribute(b,c,"mvp");builder.setAttribute(b,c,"mvpf");builder.setAttribute(b,c,"lnls");builder.addLinkAndLoadAction("REMOVE",a.domainId,f,e,g);builder.setAttribute(b,c,"it","D");for(var k in builder.cellData)if((e=builder.cellData[k])&&e.attr){if(e.attr.l==a.domainId||e.attr.l==b+"|"+c)builder.setAttribute(e.x,e.y,"l"),builder.setAttribute(e.x,e.y,"vd"),builder.setAttribute(e.x,e.y,"stf"),builder.setAttribute(b,
c,"mvp"),builder.setAttribute(b,c,"mvpf"),builder.setAttribute(b,c,"lnls");if(e.attr.ln==a.domainId||e.attr.l==b+"|"+c)builder.setAttribute(e.x,e.y,"ln"),builder.setAttribute(e.x,e.y,"vdn"),builder.setAttribute(e.x,e.y,"stf"),builder.setAttribute(b,c,"mvp"),builder.setAttribute(b,c,"mvpf"),builder.setAttribute(b,c,"lnls");e.attr.s&&$("_dd_1_"+e.x+"_"+e.y).hasAttribute("haslink")&&(builder.setAttribute(e.x,e.y,"s"),builder.setAttribute(e.x,e.y,"stf"),builder.setAttribute(e.x,e.y,"mvp"),builder.setAttribute(e.x,
e.y,"mvpf"),builder.setAttribute(e.x,e.y,"lnls"),e.domainId==a.attr.ln&&(builder.setAttribute(b,c,"ln"),builder.setAttribute(b,c,"vdn"),builder.setAttribute(b,c,"stf")))}a&&a.domainId&&deleteInvalidListeningLinks(a.domainId);ctrl.linkToForm2RootFieldDomainId=null}else floatWinWarning('<div style="line-height:1.5;">'+lm.linkWizard_subtableAliasNoDelete+"</div>")}else a.attr&&a.attr.stf&&!a.attr.s&&floatWinWarning(lm.linkWizard_hardLinkNoDelete)}
function deleteListenLink(a){var b=a.x,c=a.y;a.attr&&a.attr.l&&(builder.setAttribute(b,c,"l"),builder.setAttribute(b,c,"vd"),builder.setAttribute(b,c,"stf"),builder.setAttribute(b,c,"mvp"),builder.setAttribute(b,c,"mvpf"),builder.setAttribute(b,c,"lnls"),builder.setAttribute(b,c,"s"));a.attr&&a.attr.ln&&(builder.setAttribute(b,c,"ln"),builder.setAttribute(b,c,"vdn"),builder.setAttribute(b,c,"stf"),builder.setAttribute(b,c,"mvp"),builder.setAttribute(b,c,"mvpf"),builder.setAttribute(b,c,"lnls"))}
function deleteEditingLink(){if(ctrl.editingPath){var a=ctrl.editingPath.data("obj1"),b=a.data("x"),c=a.data("y"),d=builder.cellData[b+","+c];if(!d)return!0;var e=parseInt(d.domainId)||-1;1E6>e&&-1!==e||d.hasAttribute("fixedDesign")?floatWinWarning('<div style="line-height:1.5;max-width:600px;">'+lm.linkWizard_fixedDesignNoDelete+"</div>"):(e=ctrl.form1LinkedTargetRoot.rect,e==a?deleteMainLink(d):d&&d.attr&&(d.attr.l||d.attr.ln)?deleteListenLink(d):(d.hasAttribute("rf")&&builder.setAttribute(b,c,
"rf"),d.hasAttribute("s")&&builder.setAttribute(b,c,"s"),builder.setAttribute(b,c,"stf"),builder.setAttribute(b,c,"mvp"),builder.setAttribute(b,c,"mvpf"),builder.setAttribute(b,c,"lnls"),a=e.data("x"),b=e.data("y"),builder.setAttribute(a,b,"ln"),c=builder.getAttribute(a,b,"vdn"),builder.setAttribute(a,b,"rf",c),builder.setAttribute(a,b,"vdn"),ctrl.hasCategoryLink=!1),linkWizard.displayWizard())}}
function toggleLinkWizardDisabledFieldMsg(a){a=a.target.closest(".linkWizard-disabledFieldMsgsContainer");a.style.right="0px"!==a.style.right?"0":"-350px"}
function designHistory(){var a=$("bDesignHistory"),b=$("designHistoryDiv"),c=findPos(a);b.style.width="400px";b.style.height="200px";b.style.overflowY="auto";b.style.overflowX="hidden";b.style.top=c[1]+a.offsetHeight+"px";b.style.left=c[0]+"px";a={a:ap,p:path,fn:sheet,ft:builder.formType};builder.level3&&(a.level=builder.level3);getPromise("/sims/designHistory.jsp",a).then(function(a){b.innerHTML=a})}
function getStdApprovalFlag(a){if(!a)return"00100000";if(8>a.length)for(var b=a.length;8>b;b++)a+="0";return a}
function showApprovalPolicy(){"1"===builder.approvalFlag.charAt(0)&&($("approvalPolicyStrict").checked="checked");"1"===builder.approvalFlag.charAt(1)&&($("approvalPolicyReject").checked="checked");"1"===builder.approvalFlag.charAt(2)&&($("approvalPolicyLock").checked="checked");"1"===builder.approvalFlag.charAt(3)&&($("autoApproval").checked="checked");"1"===builder.approvalFlag.charAt(4)&&($("approvalManuallySign").checked="checked");"1"===builder.approvalFlag.charAt(5)&&($("approvalOnlyNofitySubmitter").checked=
"checked");"1"===builder.approvalFlag.charAt(6)&&($("cancelProhibited").checked="checked");"1"===builder.approvalFlag.charAt(7)&&($("dontShowCommentBlock").checked="checked")}
function isCellColspanSpreadable(a,b,c){if(!c)return!0;var d=builder.cellData,e=builder.freeData,f=nui;d[a+","+b]||c--;for(var g=1;g<=c;g++){var k=a+g+","+b,l=f._getcellV2(a+g,b);if(d.hasOwnProperty(k)||e.hasOwnProperty(k)||l&&l.classList.contains("builderFieldWhite"))return floatWinWarning(lm.columnSpanCollision),!1}return!0}function genLargeInvisible(a){var b=node("div");b.style.color=a;for(a=0;100>a;a++)b.innerHTML+=a;return b}
function genStyleSettingPanel(a,b){if(!a)return node("div");b||(b="");var c=a.objectType===FREE,d=node("div");d.className="stylePanel";var e=node("div");d.appendChild(e);c||(e.className="fieldLabelStyle");e.textContent=c?"":"V"===b?lm.valueStyle:lm.labelStyle;if(c){e=node("div");e.style.overflow="auto";e.innerHTML="<b>"+lm.descContent+":</b><br/>";var f=node("input");f.classList.add("styleTextInput");f.classList.add("text");f.style.width="100%";f.type="text";f.onblur=textBlur.bind(f,f);f.onfocus=
textFocus.bind(f,f);f.onkeyup=function(){builderUpdateDescName(this.value)};f.value=a.value;e.appendChild(f);d.appendChild(e)}f=node("div",null,"styleContainer");d.appendChild(f);f.setAttribute("style",c?"margin: 8px 0px !important":"margin: 0px !important");e=node("div");f.appendChild(e);e.className="topIcon styleTopIcon topIcon_bBold";e.title=lm.Bold;e.style.clear="left";e.onclick=function(){builder.setStyle(nui.fcol,nui.frow,b+"fontWeight","bold")};a.styling&&"bold"===a.styling[b+"fontWeight"]&&
panelover(e);e=node("div");f.appendChild(e);e.className="topIcon styleTopIcon topIcon_bItalic";e.title=lm.Italic;e.onclick=function(){builder.setStyle(nui.fcol,nui.frow,b+"fontStyle","italic")};a.styling&&"italic"===a.styling[b+"fontStyle"]&&panelover(e);e=node("div");f.appendChild(e);e.className="topIcon styleTopIcon topIcon_bUnder";e.title=lm.Underline;e.onclick=function(){builder.setStyle(nui.fcol,nui.frow,b+"textDecoration","underline")};a.styling&&"underline"===a.styling[b+"textDecoration"]&&
panelover(e);e=node("div");f.appendChild(e);e.className="topIcon styleTopIcon topIcon_bAlignL";e.title=lm.AlignLeft;e.onclick=function(){builder.setStyle(nui.fcol,nui.frow,b+"textAlign","left")};a.styling&&"left"===a.styling[b+"textAlign"]&&panelover(e);e=node("div");f.appendChild(e);e.className="topIcon styleTopIcon topIcon_bAlignM";e.title=lm.AlignCenter;e.onclick=function(){builder.setStyle(nui.fcol,nui.frow,b+"textAlign","center")};a.styling&&"center"===a.styling[b+"textAlign"]&&panelover(e);
e=node("div");f.appendChild(e);e.className="topIcon styleTopIcon topIcon_bAlignR";e.title=lm.AlignRight;e.onclick=function(){builder.setStyle(nui.fcol,nui.frow,b+"textAlign","right")};a.styling&&"right"===a.styling[b+"textAlign"]&&panelover(e);e=node("div");f.appendChild(e);e.className="topIcon styleTopIcon topIcon_bAlignVT";e.title=lm.VerticalAlignTop;e.onclick=function(){builder.setStyle(nui.fcol,nui.frow,b+"verticalAlign","top")};a.styling&&"top"===a.styling[b+"verticalAlign"]&&panelover(e);e=
node("div");f.appendChild(e);e.className="topIcon styleTopIcon topIcon_bAlignVM";e.title=lm.VerticalAlignMiddle;e.onclick=function(){builder.setStyle(nui.fcol,nui.frow,b+"verticalAlign","middle")};a.styling&&"middle"===a.styling[b+"verticalAlign"]&&panelover(e);e=node("div");f.appendChild(e);e.className="topIcon styleTopIcon topIcon_bAlignVB";e.title=lm.VerticalAlignBottom;e.onclick=function(){builder.setStyle(nui.fcol,nui.frow,b+"verticalAlign","bottom")};a.styling&&"bottom"===a.styling[b+"verticalAlign"]&&
panelover(e);e=node("div");f.appendChild(e);e.className="topIcon styleTopIcon topIcon_bFColor";e.title=lm.FontColor;e.onclick=function(c){DesignHelperColorPicker.setCallback(null);var d=$("bColorPicker");dropWin(c,d,!1,!0);a.styling&&("V"===b?a.styling.Vcolor?(DHelpType="Vcolor",DesignHelperColorPicker.setHex(a.styling.Vcolor),DesignHelperColorPicker.setOriginHex(a.styling.Vcolor)):(DesignHelperColorPicker.reset(),DesignHelperColorPicker.setOriginHex("")):a.styling.color?(DHelpType="color",DesignHelperColorPicker.setHex(a.styling.color),
DesignHelperColorPicker.setOriginHex(a.styling.color)):(DesignHelperColorPicker.reset(),DesignHelperColorPicker.setOriginHex("")));DesignHelperColorPicker.setCallback(function(c){"V"===b?(DHelpType="Vcolor",a.styling.Vcolor!==c&&builder.setStyle(nui.fcol,nui.frow,"Vcolor",c)):(DHelpType="color",a.styling.color!==c&&builder.setStyle(nui.fcol,nui.frow,"color",c))})};e=node("div");f.appendChild(e);e.className="topIcon styleTopIcon topIcon_bBColor";e.title=lm.BackgroundColor;e.onclick=function(c){DesignHelperColorPicker.setCallback(null);
var d=$("bColorPicker");dropWin(c,d,!1,!0);a.styling&&("V"===b?a.styling.VbackgroundColor?(DesignHelperColorPicker.setHex(a.styling.VbackgroundColor),DesignHelperColorPicker.setOriginHex(a.styling.VbackgroundColor),DHelpType="VbackgroundColor"):(DesignHelperColorPicker.reset(),DesignHelperColorPicker.setOriginHex("")):a.styling.backgroundColor?(DesignHelperColorPicker.setHex(a.styling.backgroundColor),DesignHelperColorPicker.setOriginHex(a.styling.backgroundColor),DHelpType="backgroundColor"):(DesignHelperColorPicker.reset(),
DesignHelperColorPicker.setOriginHex("")));DesignHelperColorPicker.setCallback(function(c){"V"===b?(DHelpType="VbackgroundColor",a.styling.VbackgroundColor!==c&&builder.setStyle(nui.fcol,nui.frow,"VbackgroundColor",c)):(DHelpType="backgroundColor",a.styling.backgroundColor!==c&&builder.setStyle(nui.fcol,nui.frow,"backgroundColor",c))})};f=node("div",null,"styleContainer");f.setAttribute("style",c?"margin: 8px 0px !important":"margin: 0px !important");d.appendChild(f);e=node("div");f.appendChild(e);
e.className="borderIcon borderIcon_1";e.style.backgroundSize="60% 60%";e.style.float="none";c&&(e.style.margin="0px");e.title=lm.Border;_setDefaultBorder();e.onclick=function(c){dropWin(c,$("bBorderHelper"),!1,!0);$("bBorderHelper_color").onclick=function(a){"none"!==$("bBorderStyleHelper").style.display&&$("bBorderHelper_style").click();DesignHelperColorPicker.setCallback(null);dropWin($("bBorderHelper_color"),$("bColorPicker"),!1,!0);DesignHelperColorPicker.setHex(builder.defaultBorder.color);DesignHelperColorPicker.setOriginHex(builder.defaultBorder.color);
DesignHelperColorPicker.setCallback(function(a){_setDefaultBorder(null,null,a)})};$("bBorderHelper_style").onclick=function(a){"none"!==$("bColorPicker").style.display&&$("bBorderHelper_color").click();dropWin($("bBorderHelper_style"),$("bBorderStyleHelper"),!1,!0);$("borderStyleIcon_1").onclick=function(a){_setDefaultBorder("1px","solid",null);_displayBorderStyleSelected(1);cancelEventBubble(a)};$("borderStyleIcon_2").onclick=function(a){_setDefaultBorder("2px","solid",null);_displayBorderStyleSelected(2);
cancelEventBubble(a)};$("borderStyleIcon_3").onclick=function(a){_setDefaultBorder("3px","solid",null);_displayBorderStyleSelected(3);cancelEventBubble(a)};$("borderStyleIcon_4").onclick=function(a){_setDefaultBorder(null,"dashed",null);_displayBorderStyleSelected(4);cancelEventBubble(a)};$("borderStyleIcon_5").onclick=function(a){_setDefaultBorder(null,"dotted",null);_displayBorderStyleSelected(5);cancelEventBubble(a)};$("borderStyleIcon_6").onclick=function(a){_setDefaultBorder(null,"double",null);
_displayBorderStyleSelected(6);cancelEventBubble(a)}};$("borderIcon_1").onclick=function(c){var d="V"===b?"V":"";a.styling[d+"border-top"]=null;a.styling[d+"border-right"]=null;a.styling[d+"border-bottom"]=null;a.styling[d+"border-left"]=null;builder.setStyle(nui.fcol,nui.frow,d+"border-left",builder.defaultBorder.toCSS());builder.setStyle(nui.fcol,nui.frow,d+"border-bottom",builder.defaultBorder.toCSS());builder.setStyle(nui.fcol,nui.frow,d+"border-top",builder.defaultBorder.toCSS());builder.setStyle(nui.fcol,
nui.frow,d+"border-right",builder.defaultBorder.toCSS());cancelEventBubble(c)};$("borderIcon_2").onclick=function(c){var d="V"===b?"V":"";a.styling[d+"border-left"]=null;builder.setStyle(a.x,a.y,d+"border-left",builder.defaultBorder.toCSS());cancelEventBubble(c)};$("borderIcon_3").onclick=function(c){var d="V"===b?"V":"";a.styling[d+"border-bottom"]=null;builder.setStyle(nui.fcol,nui.frow,d+"border-bottom",builder.defaultBorder.toCSS());cancelEventBubble(c)};$("borderIcon_4").onclick=function(c){var d=
"V"===b?"V":"";a.styling[d+"border-top"]=null;builder.setStyle(nui.fcol,nui.frow,d+"border-top",builder.defaultBorder.toCSS());cancelEventBubble(c)};$("borderIcon_5").onclick=function(c){var d="V"===b?"V":"";a.styling[d+"border-right"]=null;builder.setStyle(a.x,a.y,d+"border-right",builder.defaultBorder.toCSS());cancelEventBubble(c)};$("borderIcon_6").onclick=function(a){var c="V"===b?"V":"";builder.setStyle(nui.fcol,nui.frow,c+"border-top","");builder.setStyle(nui.fcol,nui.frow,c+"border-right",
"");builder.setStyle(nui.fcol,nui.frow,c+"border-bottom","");builder.setStyle(nui.fcol,nui.frow,c+"border-left","");cancelEventBubble(a)}};c&&(e=node("div"),f.appendChild(e),e.className="topIcon topIcon_bAction",e.title=lm.URLToOpenWhenClickedON,e.onclick=function(){builder.setAction(nui.fcol,nui.frow)});e=node("div",null,"flex-center");d.appendChild(e);e.style.margin="0";f=node("select");e.append(f);f.onclick=function(){ctrl.dropWin=!0};f.onchange=function(){builder.setStyle(nui.fcol,nui.frow,b+
"fontFamily",this.options[this.selectedIndex].value)};f.style.margin="0 10px 8px 0";f.innerHTML='<option value="">'+lm.fontFamily+'</option><optgroup label="Generic Font Families"><option value="Serif">Serif</option><option value="Sans-serif">Sans-serif</option><option value="Monospace">Monospace</option><option value="Cursive">Cursive</option><option value="Fantasy">Fantasy</option></optgroup><optgroup label="Common Fonts"><option value="Arial">Arial</option><option value="Arial Black">Arial Black</option><option value="Comic Sans MS">Comic Sans</option><option value="Courier New">Courier New</option><option value="Georgia">Georgia</option><option value="Impact">Impact</option><option value="Times New Roman">Times New Roman</option><option value="Trebuchet MS">Trebuchet</option><option value="Verdana">Verdana</option><option value="Symbol">Symbol</option><option value="Webdings">Webdings</option><option value="Lato">Lato</option><option value="Roboto">Roboto</option><option value="Bai Jamjuree">Bai Jamjuree</option>'+
("zh-TW"!==langv5?"":'<option value="PMingLiU">\u65b0\u7d30\u660e\u9ad4</option><option value="DFKai-SB">\u6a19\u6977\u9ad4</option><option value="Microsoft JhengHei">\u5fae\u8edf\u6b63\u9ed1\u9ad4</option><option value="Microsoft YaHei">\u5fae\u8edf\u96c5\u9ed1\u9ad4</option>')+"</optgroup>";if(a.styling[b+"fontFamily"])for(var g=0;g<f.options.length;g++)f.options[g].value===a.styling[b+"fontFamily"]&&(f.selectedIndex=g);f=node("div");e.append(f);f.style.margin="0 0 10px 0";e=node("span");f.append(e);
e.textContent=lm.fontSize;e.style.marginRight="3px";e=node("input");f.append(e);e.setAttribute("type","text");e.setAttribute("autocomplete","off");e.classList.add("text");e.style.width="50px";e.style.height="25px";e.onfocus=textFocus.bind(e,e);e.onblur=textBlur.bind(e,e);e.oninput=debouncedFn(500,function(){var a=parseInt(this.value)||0;0<a?builder.setStyle(nui.fcol,nui.frow,b+"fontSize",""+a,!0):builder.setStyle(nui.fcol,nui.frow,b+"fontSize","",!0)});a.styling[b+"fontSize"]&&(e.value=a.styling[b+
"fontSize"]);if(c){c=node("div");e=node("select");e.innerHTML='<option value="">'+lm.auto+"</option>";for(f=1;51>f;f++)g=node("option"),g.value=f,g.textContent=f,e.appendChild(g);e.name="cs";e.id="desc_cs";e.onchange=function(){builder.setStyle(nui.fcol,nui.frow,this.name,this.options[this.selectedIndex].value)};(f=builder.freeData[nui.fcol+","+nui.frow])&&f.styling.cs&&(e.value=f.styling.cs);c.innerHTML="<br><b>"+lm.columnSpan+":</b>";c.appendChild(e);d.appendChild(c)}return d}
function _setDefaultBorder(a,b,c){builder.defaultBorder||(builder.defaultBorder={width:"1px",style:"solid",color:"#000000",toCSS:function(){return"double"!=this.style?this.width+" "+this.style+" "+this.color:parseInt(this.width.substr(0,1))+2+"px "+this.style+" "+this.color}});a&&(builder.defaultBorder.width=a);b&&(builder.defaultBorder.style=b);c&&(builder.defaultBorder.color=c)}
function _displayBorderStyleSelected(a){for(var b=document.querySelectorAll(".borderStyleSelected"),c=1;c<=b.length;c++)b[c-1].style.visibility=c==a?"visible":"hidden"}
function genClearStyleButtons(a){var b=node("div");b.style.marginTop="12px";var c=node("div");c.classList.add("topButtonWhole");b.appendChild(c);c.textContent=lm.clearStyle;c.style.padding="8px 20px";c.style.margin="0 0 5px 0";c.onclick=function(){floatWinConfirmV3(lm.clearStyleConfirm,function(){builder.clearStyle(a)},null,null,null,lm.clearStyle)};c=node("div");c.classList.add("topButtonWhole");b.appendChild(c);c.textContent=lm.clearStyleAll;c.style.padding="8px 20px";c.style.margin="0 0 10px 0";
c.style.clear="left";c.onclick=function(){var a=node("div");a.textContent=lm.clearStyleAllConfirm;var b=node("div");b.style.marginTop="15px";a.appendChild(b);var c=node("input");c.type="checkbox";c.id="clearAllStyles_includeTheme";c.style.marginRight="5px";b.appendChild(c);c=node("label");c.htmlFor="clearAllStyles_includeTheme";c.textContent=lm.clearStyleAll_includeTheme;b.appendChild(c);floatWinConfirmV3(a,function(){$("clearAllStyles_includeTheme").checked?builder.clearStyleAll(!0):builder.clearStyleAll(!1)},
null,null,null,lm.clearStyleAll)};return b}
function genStyleCopyPanel(a){var b=node("div");b.className="stylePanel";"F"==a.objectType&&(b.style.margin="12px 0 12px 0");var c=node("div");b.appendChild(c);c.className="fieldLabelStyle";c.textContent=lm.otherStyleSettings;c=node("div");b.appendChild(c);var d=node("div"),e=node("div");e.style.backgroundImage="url(/sims/img/icons/BuilderTool/Field-Style-Settings/copy_styles.svg)";e.style.backgroundRepeat="no-repeat";e.style.width="18px";e.style.height="18px";e.style.display="inline-block";e.style.verticalAlign=
"middle";e.style.margin="2px 7px 2px 0px";d.appendChild(e);e=node("div");e.style.display="inline-block";e.style.verticalAlign="middle";e.style.margin="0";e.id="copyText";e.textContent=builder.doingCopyStyle?lm.cancelCopyStyle:lm.copyStyle;d.appendChild(e);d.className="topButtonWhole";d.style.display="inline-block";d.style.verticalAlign="middle";d.style.margin="0";d.id="bCopyStyle";d.onmouseover=buttover(d);d.onmouseout=buttout(d);d.onmouseup=function(){d.style.backgroundPosition="0 0"};d.onmousedown=
function(){d.style.backgroundPosition="0 21px"};builder.copyStyleClickTimer=null;d.onclick=function(b){builder.copyStyleClickTimer&&clearTimeout(builder.copyStyleClickTimer);builder.copyStyleClickTimer=setTimeout(function(){builder.copiedStyles={};if(builder.doingCopyStyle){if(builder.doingCopyStyle=!1,b=d.querySelector("#copyText"))b.textContent=lm.copyStyle}else{builder.doingCopyStyle=!0;var b=d.querySelector("#copyText");b&&(b.textContent=lm.cancelCopyStyle);for(var c in a.styling)builder.copiedStyles[c]=
a.styling[c]}},250);b&&cancelEventBubble(b)};d.ondblclick=function(a){builder.copyStyleClickTimer&&clearTimeout(builder.copyStyleClickTimer);$("keepCopyingCheckbox").checked||builder.doingCopyStyle||($("keepCopyingCheckbox").click(),d.onclick())};c.appendChild(d);e=node("div");e.style.padding="10px";e.style.clear="left";var f=node("input","keepCopyingCheckbox");f.type="checkbox";f.style.verticalAlign="middle";f.style.marginRight="5px";f.checked=builder.keepCopying;f.onchange=function(a){cancelEventBubble(a);
builder.keepCopying=this.checked};e.appendChild(f);f=node("label");f.htmlFor="keepCopyingCheckbox";f.textContent=lm.keepCopyingStyle;e.appendChild(f);c.appendChild(e);c=genClearStyleButtons(a);b.appendChild(c);return b}
function genCustThemePanel(a){a=node("div");a.className="stylePanel";var b=node("div");a.appendChild(b);b.className="fieldLabelStyle";b.textContent=lm.custTheme_setting;b=node("div");var c=node("div");c.setAttribute("class","formSettingIconSmall formSettingIconSmall_custTheme");c.style.width="22px";c.style.height="22px";c.style.display="inline-block";c.style.verticalAlign="middle";c.style.margin="0";c.style.cssFloat="none";b.appendChild(c);c=node("div");c.style.display="inline-block";c.style.verticalAlign=
"middle";c.style.margin="0";c.id="getCustThemes";c.textContent=lm.custTheme_getAllThemes;b.onclick=CustThemeHelper.displayAllThemes;b.appendChild(c);b.className="topButtonWhole";b.style.display="inline-block";b.style.verticalAlign="middle";b.style.margin="0";a.appendChild(b);return a}
function migrateFieldFromMultiple(a){var b=$("addRefHardLinkDiv"),c=b.querySelector(".floatingWinHeaderText"),d=$("f_hardlink_ref_drag");b.args=arguments;getPromise("/sims/hardLinkFieldSelector.jsp",{u:a,a:ap,p:path,si:sheetIndex}).then(function(a){clearDropWin();d.innerHTML=a;Array.from(d.childNodes).forEach(function(a){builder.findField(a.getAttribute("domainId"))&&d.removeChild(a)});d.hasChildNodes()?($("f_hardlink_dragguide").style.display="",$("f_hardlink_emptyView").style.display="none"):($("f_hardlink_emptyView").style.display=
"",$("f_hardlink_dragguide").style.display="none");c.textContent=lm.linkToolTitle2;b.style.display=""})}
function migrateSubtableFromMultiple(a){var b=$("createSubtableFromMultiple");getPromise("/sims/hardLinkSubtableSelector.jsp",{u:a,a:ap,p:path,si:sheetIndex}).then(function(a){clearDropWin();b.innerHTML=a;Array.from(b.childNodes).forEach(function(a){var c=a.querySelector(".addField");if(c)for(var d in builder.subtableKeys)if(c.getAttribute("subtableKey")==builder.subtableKeys[d]&&(!c.getAttribute("parentAlias")||c.getAttribute("parentAlias")==builder.subtableAliasParents[d])){b.removeChild(a);break}});
0<b.childNodes.length?($("f_hardlink_subtable_dragguide").style.display="",$("createSubtableFromMultiple").style.display=""):($("f_hardlink_subtable_dragguide").style.display="none",$("createSubtableFromMultiple").style.display="none")})}
function migrateSubtableFieldsFromMultiple(a){var b=$("addSubtableFieldsFromMultiple");getPromise("/sims/multipleVersionBothExistSubtables.jsp",{u:a,a:ap,p:path,si:sheetIndex}).then(function(a){clearDropWin();b.innerHTML=a;0<b.childNodes.length?($("f_subtableField_dragguide").style.display="",$("addSubtableFieldsFromMultiple").style.display=""):($("f_subtableField_dragguide").style.display="none",$("addSubtableFieldsFromMultiple").style.display="none")})}
function getSubtableFieldSelectorFromMultiple(a,b,c){$("addRefHardLinkDiv").style.display="none";floatWin(null,lm.prop_loading,lm.chooseSubtableFields,!0);var d=focusSubtableFirstCell(b,c),e={};e.url=a;e.p=path;e.si=sheetIndex;e.subtableKey=b;e.parentAlias=c;getPromise("/sims/getSubtableFromMultiVersion.jsp",e).then(function(a){a=JSON.parse(a);a.actionName=lm.insertSubtable;a.actionCallback=insertFromSubtableGen;a.callback=focusSubtableFirstCell.bind(null,b,c);a.parentAlias=c;a.keyField=b;var e=new FieldSelector;
e.loadData(a);e.render();e.balanceOptions(d)})}
function migrateFieldFromSubtableGen(a,b,c){floatWin(null,lm.prop_loading,lm.chooseSubtableFields,!0);focusSubtableFirstCell(b,c);a=a.split("/");var d=nui.fcol+","+nui.frow;a={a:ap,p:path,fn:sheet,cp:"/"+a[1],cfn:a[2]+"_Sheet"+a[2],ltd:builder.rootDomainId,source:unescapeHTML(builder.newName),pa:c};postPromise("/sims/getSubtableFromSubtableGen.jsp",a).then(function(a){clearDropWin();a=JSON.parse(a);if(a.errorMsg)floatWinWarning(a.errorMsg,!0);else{a.actionName=lm.updateSubtable;a.parentAlias=c;a.keyField=
b;a.callback=focusSubtableFirstCell.bind(null,b,c);a.actionCallback=insertFromSubtableGen;var e=new FieldSelector;e.loadData(a);e.render();e.balanceOptions(d)}})}
function insertFromSubtableGen(){var a=$("listingFieldOptions"),b;if(a){for(var c=0,d=0;d<builder.maxX&&builder.cellData[nui.fcol+d+","+nui.frow];d++)c++;d=nui.fcol+c-1;var e=a.options.length-c;if(0<e){var f=[];for(b=1;b<=e;b++)for(var g=0;4>g;g++){var k=d+b+","+(nui.frow+g);(builder.cellData[k]||builder.freeData[k])&&f.push(getCellName(d+b,nui.frow+g))}k=d+e+1+","+nui.frow;builder.cellData[k]&&f.push(getCellName(d+e+1,nui.frow));if(0<f.length){var l="";f.forEach(function(a){l+=(0<l.length?", ":"")+
a});floatWinWarning(lm.noSpaceForNewCells.replace("{0}",l));return}}builder.mode=BUILDER_FIELDS;d={};e={};k={};f={};for(g=0;g<a.options.length;g++){var m=a.options[g].value;if(b=builder.findFieldInSubtable(m,nui.fcol+","+nui.frow))d[m]={},d[m].hash=b.hash,b.hasAttribute("fdom")&&(d[m].fdom=b.attr.fdom),b.hasOwnProperty("styling")&&(e[m]=b.styling),b.hasOwnProperty("attr")&&(f[m]=b.attr),k[m]=b.value}g=parseInt($("keyField").value);b=parseInt($("parentAlias").value);for(var n={},q=0;q<c;n={$jscomp$loop$prop$cd$619:n.$jscomp$loop$prop$cd$619,
$jscomp$loop$prop$removeIndex$620:n.$jscomp$loop$prop$removeIndex$620},q++)n.$jscomp$loop$prop$cd$619=builder.cellData[nui.fcol+q+","+nui.frow],n.$jscomp$loop$prop$cd$619&&(n.$jscomp$loop$prop$removeIndex$620=-1,builder.colSpanCells.forEach(function(a){return function(b,c){b.domainId==a.$jscomp$loop$prop$cd$619.domainId&&(a.$jscomp$loop$prop$removeIndex$620=""+c)}}(n)),0<=parseInt(n.$jscomp$loop$prop$removeIndex$620)&&builder.colSpanCells.splice(parseInt(n.$jscomp$loop$prop$removeIndex$620),1)),delete builder.cellData[nui.fcol+
q+","+nui.frow],delete builder.freeData[nui.fcol+q+","+nui.frow],builder.formulaRel.delFCellRec(nui.fcol+q+","+nui.frow);g&&0<a.options.length?builder.subtableKeys[nui.fcol+","+nui.frow]=g:delete builder.subtableKeys[nui.fcol+","+nui.frow];b&&0<a.options.length?builder.subtableAliasParents[nui.fcol+","+nui.frow]=b:delete builder.subtableAliasParents[nui.fcol+","+nui.frow];for(c=0;c<a.options.length;c++){var r=a.options[c];g=nui.fcol+c;n=nui.frow;builder.setField(g,n,r.innerHTML);q=builder.cellData[g+
","+n];q.domainId=r.value;builder.setAttribute(g,n,"it",r.getAttribute("it"));builder.copyAttribute(g,n,r.getAttribute("attr"),null,["noDup"]);if(r.hasAttribute("lov")){var p=r.getAttribute("lov");r=r.getAttribute("cascaded");p&&(p=p.replace(/`/g,ctrl.CRLF),r?addCascadedSelectionFromLOV(p,q.domainId,r):builder.setAttribute(g,n,"lov",p))}!isNaN(b)&&0<b&&builder.setAttribute(g,n,"noclone",!0);d.hasOwnProperty(q.domainId)&&(q.hash=d[q.domainId].hash);e.hasOwnProperty(q.domainId)&&(q.styling=e[q.domainId]);
k.hasOwnProperty(q.domainId)&&(q.value=k[q.domainId]);f.hasOwnProperty(q.domainId)&&(q.attr=f[q.domainId],1<q.attr.cs&&builder.colSpanCells.push(q))}for(m in d)b=builder.findFieldInSubtable(m,nui.fcol+","+nui.frow),b.attr||(b.attr={}),d[m].fdom&&(b.attr.fdom=d[m].fdom,f[m].dv_f?b.attr.dv_f=formulaBuilder._translateToSpreadsheetRef(b.attr.fdom):b.attr.f=formulaBuilder._translateToSpreadsheetRef(b.attr.fdom));builder.renderAll();builder.syncCurrentCellData();setPropertyTable(nui._curcell())}}
function migrateFieldFromSource(a){var b=$("addRefHardLinkDiv"),c=$("f_hardlink_ref_drag"),d=b.querySelector(".floatingWinHeaderText"),e={a:ap,p:path,si:sheetIndex};a&&(e.url=a);getPromise("/sims/sourceFormFieldSelector.jsp",e).then(function(a){clearDropWin();c.innerHTML=a;Array.from(c.childNodes).forEach(function(a){builder.findField(a.getAttribute("domainId"))&&c.removeChild(a)});c.hasChildNodes()?($("f_hardlink_dragguide").style.display="",$("f_hardlink_emptyView").style.display="none"):($("f_hardlink_emptyView").style.display=
"",$("f_hardlink_dragguide").style.display="none");$("f_hardlink_subtable_dragguide").style.display="none";$("createSubtableFromMultiple").style.display="none";$("f_subtableField_dragguide").style.display="none";$("addSubtableFieldsFromMultiple").style.display="none";d.textContent=lm.linkToolTitle5;b.style.display=""})}function formatNUIAttr(a){return a.replace(/,/gim,"`").replace(/&/gim,"%26")}function unformatNUIAttr(a){return a.replace(/`/gim,",").replace(/%26/gim,"&")}
function formatHTMLEntities(a){return a.replace(/ /g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function unformatHTMLEntities(a){return a.replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#10;/g,"\n")}
function getButtonSeqAction(a){if(!builder.actionButtons)return null;for(var b in builder.actionButtons){var c=builder.actionButtons[b];if(c.seq==a)return a=c.action,a.substring(0,a.indexOf("("))}}function deleteBetweenLines(a,b,c){for(var d=a.split("\n"),e=!0,f="",g=0;g<d.length;g++){var k=d[g];k.includes(b)&&(e=!1);e&&(f+=k+"\n");k.includes(c)&&(e=!0);if(g==d.length-1&&!e)return a}return f}
function retrieveBetweenLines(a,b,c){a=a.split("\n");for(var d=!1,e=!1,f="",g=0;g<a.length;g++){var k=a[g];k.includes(b)&&(d=!0);d&&!e&&(f+=k+"\n");k.includes(c)&&(e=!0)}return f}function updateLinkNLoadSetting(a){a&&(a=parseInt(a.selectedOptions[0].value)||-1,0>a||linkNLoadSetting(null,a))}
function linkNLoadSetting(a,b){a&&(a.cancelBubble=!0);clearDropWin();ctrl.floatWinCallback=function(){var a=builder.getAttributeByDomainId(b,"mvp").split("|"),d=a[1].split("_"),e=builder.findField(b),f=!builder.ifAdjacent(e.x,e.y);ctrl.linkNLoadActionBuilder.config.currentDomainId=b;ctrl.linkNLoadActionBuilder.config.items[0].optionPath=a[0];ctrl.linkNLoadActionBuilder.config.items[0].optionSheetIndex=d[0];ctrl.linkNLoadActionBuilder.config.items[0].optionSheetNoSubtable=!0;ctrl.linkNLoadActionBuilder.config.items[2].optionPath=
path;ctrl.linkNLoadActionBuilder.config.items[2].optionSheetIndex=sheetIndex;f?(ctrl.linkNLoadActionBuilder.config.items[2].optionSheetNoSubtable=!0,delete ctrl.linkNLoadActionBuilder.config.items[2].sameSubtableWith):(delete ctrl.linkNLoadActionBuilder.config.items[2].optionSheetNoSubtable,ctrl.linkNLoadActionBuilder.config.items[2].sameSubtableWith=e.x+","+e.y);ctrl.linkNLoadActionBuilder.loadResult(builder.getAttributeByDomainId(b,"mvpf"));ctrl.linkNLoadActionBuilder.renderActionBuilder($("dynamicFilter"));
$("lnls").checked=builder.getAttributeByDomainId(b,"lnls")};floatWin(function(){return"/sims/linkNLoadSetting.jsp?a="+ap+"&p="+path+"&si="+sheetIndex+"&d="+b},null,lm.dynamicFilterSetting,!0)}
function newSheetFromSubtableSetting(a,b,c,d){a.cancelBubble=!0;clearDropWin();ctrl.floatWinCallback=function(){};floatWin(function(){return"/sims/newSheetFromSubtableSetting.jsp?a="+ap+"&p="+path+"&si="+sheetIndex+"&sk="+c+"&pa="+d+"&url="+encodeURIComponent(formatNUIAttr(b))+"&temp="+ctrl.newSheetFromSubtableLinkSelectChangeTemp},null,null,!0)}
function newSheetFromSubtableLinkSelectChange(a){for(var b=0;b<$("newSheetFromSubtableLinkSelect").options.length;b++){var c=$("newSheetFromSubtableLinkSelect").options[b];parseInt(c.value);var d=c.dataset.loc||"0,0";c=parseInt(d.split(",")[0]);d=parseInt(d.split(",")[1]);c&&d&&0<c&&0<d&&(builder.setAttribute(c,d,"link",null),builder.setAttribute(c,d,"linkTo",null))}b=$("newSheetFromSubtableLinkSelect").options[$("newSheetFromSubtableLinkSelect").selectedIndex];c=b.dataset.loc||"0,0";d=parseInt(c.split(",")[0]);
var e=parseInt(c.split(",")[1]);!b||isNaN(d)||isNaN(e)||(builder.setAttribute(d,e,"link","true"),builder.setAttribute(d,e,"linkTo",a),ctrl.newSheetFromSubtableLinkSelectChangeTemp=c);$("floatingWin").style.display="none"}function newSheetFromSubtableFpSelectChange(a){var b=$("newSheetFromSubtableFpSelect").selectedOptions[0].value;b?builder.subtableFpUrls[a]=b:delete builder.subtableFpUrls[a];$("floatingWin").style.display="none"}
function changeLinkedFieldSelector(){linkWizard.specifyForm1LinkField=$("linkAndLoadLinkedFieldSelector").options[$("linkAndLoadLinkedFieldSelector").selectedIndex].value;linkWizard.displayWizard()}function setLnls(a){var b=$("lnls").checked;builder.setAttributeByDomainId(a,"lnls",b?"true":null)}
function showFormulaTooltip(){var a=this.dataset.formula;if(a){var b=$("formulaTooltip");b.style.display="";var c=this.getBoundingClientRect();b.textContent=a;a=b.getBoundingClientRect();b.style.left=c.left+10+a.width<=window.innerWidth?c.left+10+"px":c.left+10-a.width+"px";b.style.top=c.top+25+a.height<=window.innerHeight?c.top+25+"px":c.top-5-a.height+"px"}}function hideFormulaTooltip(){$("formulaTooltip").style.display="none"}
function settingIconMouseDown(a,b){a.attr.f&&openTab($("prop6"),$("propTab6"),$("propSel"),$("propSpace"));(a.attr.dv_f||a.attr.mvp||a.attr.vd)&&openTab($("prop1"),$("propTab1"),$("propSel"),$("propSpace"));ctrl.highlightCallback=function(){ctrl.highlightedCellPos=ctrl.highlightedCellPos||{};var c=[];(a.attr.f||a.attr.dv_f)&&formulaBuilder._findChangeCellNames((a.attr.f||a.attr.dv_f).toUpperCase()).forEach(function(a){a=getPositionFromCellName(a);var b=nui._getcell(a[0],a[1]);b&&(b.style.border="2px solid #FF4853",
c.push(a))});if(a.attr.mvp){b.style.border="2px solid #0088cc";c.push([a.x,a.y]);for(var d in builder.cellData){var e=builder.cellData[d];if(e&&e.hasAttribute("l")&&e.attr.l===a.domainId){var f=nui._getcell(e.x,e.y);f&&(f.style.border=e.hasAttribute("lnlsselect")?"2px solid #AAA":"2px solid #555",c.push([e.x,e.y]))}}}if(a.attr.vd){d=a.attr.l;if(e=builder.findField(d))if(f=nui._getcell(e.x,e.y))f.style.border="2px solid #0088cc",c.push([e.x,e.y]);for(var g in builder.cellData)(e=builder.cellData[g])&&
e.hasAttribute("l")&&e.attr.l===d&&(f=nui._getcell(e.x,e.y))&&(f.style.border=e.hasAttribute("lnlsselect")?"2px solid #AAA":"2px solid #555",c.push([e.x,e.y]))}ctrl.highlightedCellPos[a.x+","+a.y]=c}}function toFormSettingTab(a,b,c){builderHelperPanelSwitch(3);openTab(a,null,$("designerInfoTab"));createPromiseRequest({method:"GET",url:b}).then(function(a){$("designerInfoContent").innerHTML=a;c()})}
function adjustFromToolsDrop(){var a=$("bFormTool").getBoundingClientRect(),b=document.documentElement.clientHeight,c=Math.floor((document.documentElement.clientWidth-a.left)/300);if(builder.ifListingPage())var d=2;else d=3,1<getMaxActionButtonSeq()&&"none"!=$("customButtonsDiv2").style.display&&(d+=1);var e=d;d=2>c?1:c>=e?e:e-1;var f=1<d&&e>d;e=300*d;var g=document.querySelectorAll("#builderFromToolsDrop .linkToolDesc"),k;for(k=0;k<g.length;k++)g[k].style.maxWidth="205px",g[k].style.minWidth="205px";
var l=document.querySelectorAll("#builderFromToolsDrop .toolsDivSection");for(k=0;k<l.length;k++){if(f&&"formSettingTools"==l[k].id)if(builder.ifListingPage())for(l[k].style.clear="",l[k].style.border="",l[k].style["border-width"]="",l[k].style["padding-top"]="0px",m=document.querySelectorAll("#formSettingTools .dropdownOptionv6"),g=0;g<m.length;g++)m[g].style.width="",m[g].style.display="formSetting_listing_interactiveRuleDiv"==m[g].id||"formSetting_listing_configApprovalDiv"==m[g].id||"formSetting_listing_reminderDiv"==
m[g].id?"none":"block";else{l[k].style.clear="both";l[k].style.border="solid rgb(225, 225, 225)";l[k].style["border-width"]="1px 0 0 0";l[k].style.maxWidth=300*d+"px";l[k].style.minWidth=300*d+"px";l[k].style["padding-top"]="15px";var m=document.querySelectorAll("#formSettingTools .dropdownOptionv6");for(g=0;g<m.length;g++)m[g].style.width=297.6-63+"px",m[g].style.display="inline-block";continue}l[k].style.maxWidth="300px";l[k].style.minWidth="300px"}f=document.querySelectorAll("#builderFromToolsDrop .formToolTitle");
for(k=0;k<f.length;k++)f[k].style.maxWidth="205px",f[k].style.minWidth="205px";k=$("builderFromToolsDrop");k.style.maxHeight=.9*(b-a.bottom);a=parseInt(k.style.left.replace("px",""));d>c&&(a-=300*(d-c));k.style.left=a+"px";k.style.width=e+"px";c=k.clientWidth;e>c&&(k.style.width=e+(e-c));if(c=$("custAppSeqItems_title"))rm(c),c.appendChild(document.createTextNode(builder.ifListingPage()?lm.custAppSeqItems_title_listing:lm.custAppSeqItems_title));ctrl.dropWin=!1}
function updateCsTranslatedMapAll(){for(var a=nui.main.nuicelltable,b=0;b<a.rows.length;b++)updateCsTranslatedMap(b)}function updateCsTranslatedMap(a){for(var b=nui.main.nuicelltable,c=-1,d=builder.relativePositions,e=builder.absolutePositions,f=0;f<=b.rows[0].cells.length;f++){var g=nui._getcellV2(++c,a);if(g){d[f+","+a]=c+","+a;e[c+","+a]=f+","+a;var k=nui._getcellV2(c+1,a);if(g.colSpan&&1<g.colSpan&&k&&"none"!=k.style.display)for(k=1;k<g.colSpan;k++)d[++f+","+a]=c+","+a}}}
function manualAddAttr(){builder.setAttribute(nui.fcol,nui.frow,$("manualAttrName").value,$("manualAttrValue").value);$("manualAttrName").value="";$("manualAttrValue").value=""}function liveTemplates(a){showMsg("/sims/liveTemplate.jsp?"+(a?"p="+a:""),350,!0,!0)}function liveTemplateSelChange(a){a&&a.options[a.selectedIndex]&&liveTemplates(a.options[a.selectedIndex].value)}
function syncFieldNamesToListingPage(a){for(var b=$("syncFieldContent").querySelectorAll("input[type=checkbox]"),c=[],d=[],e=0;e<b.length;e++){var f=b[e].dataset.domainid;f&&(a||!b[e].checked?(d.push(f),f=builder.findField(f),builder.setAttribute(f.x,f.y,"noSyncName","true"),builder.refreshStartNUI()):b[e].checked&&c.push(f))}(0<c.length||0<d.length)&&ajaxpost("/sims/syncFieldNames.jsp",{a:ap,p:path,si:sheetIndex,sd:JSON.stringify(c),nsd:JSON.stringify(d)},function(){finishDesignModeServerSave(ctrl.promptStr)})}
function addFieldsToMultipleVersionsAfterSaving(){var a=$("addedFieldContent"),b=$("multipleVersionsContent");a=a.querySelectorAll("input[type=checkbox]");b=b.querySelectorAll("input[type=checkbox]");var c=[],d=[],e=[];a.forEach(function(a){var b=a.dataset.domainid,c=a.dataset.loc;b&&a.checked&&d.push(b);c&&a.checked&&e.push(c)});b.forEach(function(a){var b=a.dataset.url;b&&a.checked&&c.push(b)});b={a:ap,p:path,si:sheetIndex,d:JSON.stringify(d),u:JSON.stringify(c),loc:JSON.stringify(e)};postPromise("/sims/addFieldsToMultipleVersions.jsp",
b).then(function(){finishDesignModeServerSave(ctrl.promptStr)})}
function removeLnlsAfterSaving(){var a={};$("lnlsRemovalContainer").querySelectorAll(".lnlsRemovalFieldContent").forEach(function(b){var c=b.querySelector(".lnlsRemovalCheckbox");if(c.checked){c=c.dataset.domainid;var e=[];b.querySelectorAll("a").forEach(function(a){a=a.getAttribute("href");e.push(a)});a[c]=e}});var b={a:ap,data:JSON.stringify(a)};postPromise("/sims/removeLnls.jsp",b).then(function(){finishDesignModeServerSave(ctrl.promptStr)})}
function loadDefaultValuesAfterSaving(){for(var a=$("dvFieldsContent").querySelectorAll("input[type=checkbox]"),b=[],c=0;c<a.length;c++){var d=a[c].dataset.domainid;d&&a[c].checked&&b.push(d)}checkRunningServiceByFormUrl(function(){ajaxget("/sims/mass/assign/dvAssign.jsp",{a:ap,p:path,si:sheetIndex,c:JSON.stringify(b)},eval)});finishDesignModeServerSave(ctrl.promptStr)}
function hideColumn(a){var b=getOriginWidth(a),c=nui._getcell(parseInt(a),0);nui.setWidth(parseInt(a),null,-100);ctrl.setWidth(parseInt(a),-100,biffdata.widthCommand,function(a){biffdata.widthCommand=a;builder.hiddenColumnIndex=findAllHiddenColumnIndexs()},b);nui.showUnhideColumnArrows(parseInt(a),!0);(ctrl.isIE||ctrl.isEdge||ctrl.isFF||ctrl.isChrome)&&c&&(c.style.padding="0px",c.style.borderWidth="0px");c&&(c.style.transition="")}
function unhideColumn(a,b){if(!ifRightClick(event)){b=b?"-1":"+1";var c=parseInt(a.parentNode.dataset.x)+eval(b);do a=getOriginWidth(c),nui.setWidth(c,null,parseInt(a)),ctrl.setWidth(c,a,biffdata.widthCommand,function(a){biffdata.widthCommand=a;builder.hiddenColumnIndex=findAllHiddenColumnIndexs()}),nui.showUnhideColumnArrows(c,!1,!1),unhideTransition(c),c=parseInt(c)+eval(b);while(isHiddenColumn(c));nui._updateFocus();cancelEventBubble(event)}}
function unhideTransition(a){var b=nui._getcell(a,0);var c=b.style.backgroundColor;b.style.backgroundColor="rgb(140,140,140)";b.style.color="white";setTimeout(function(){b.style.transition="background-color 1s";b.style.backgroundColor=c;b.style.color="#888"},10);transitionEndListener(b,function(){b.style.transition=""});b.style.padding="1px";b.style.borderWidth="1px"}
function getOriginWidth(a){if(0>=a)return!1;if(!biffdata.widthCommand)return"-100";var b=(b=biffdata.widthCommand.split("&").find(function(b){return b.split("=",2)[0]==a}))?b.split("=",2)[1]:"35";1<b.split("_").length&&(b=b.split("_")[1]);"-100"===b&&(b=embed?"-30":"35");return b}function isHiddenColumn(a){return builder.hiddenColumnIndex.includes(a)}
function findAllHiddenColumnIndexs(){return biffdata.widthCommand?biffdata.widthCommand.split("&").filter(function(a){try{return"-100"===a.split("=",2)[1].split("_")[0]}catch(b){return!1}}).map(function(a){return parseInt(a.split("=",2)[0])}):[]}function fixImageMax(a){boxChange(a);var b=currentBiff;a.checked&&(builder.setAttribute(b.x,b.y,"iwidth",$("at_iwidth").value),builder.setAttribute(b.x,b.y,"iheight",$("at_iheight").value))}
function setNUIColWidth(){if(ctrl.multiSelected&&0<ctrl.multiSelected.length){var a=prompt(lm.setColWidthPrompt),b=parseInt(a);isNaN(b)||(ctrl.multiSelected.forEach(function(a){ctrl.setWidth(a.dataset.x,b-100,biffdata.widthCommand,function(a){biffdata.widthCommand=a})}),builder.renderAll())}else a=(a=nui._getcell(ctrl.rightClickCol,0))?parseInt(a.style.width):135,a=prompt(lm.setColWidthPrompt,a),a=parseInt(a),isNaN(a)||ctrl.setWidth(ctrl.rightClickCol,a-100,biffdata.widthCommand,function(a){biffdata.widthCommand=
a;builder.renderAll()})}
function setNUIRowHeight(){if(ctrl.multiSelected&&0<ctrl.multiSelected.length){var a=prompt(lm.setRowHeightPrompt),b=parseInt(a);isNaN(b)||(ctrl.multiSelected.forEach(function(a){ctrl.setWidth(a.dataset.y,b-16,biffdata.heightCommand,function(a){biffdata.heightCommand=a})}),builder.renderAll())}else a=(a=nui._getcell(0,ctrl.rightClickRow))?parseInt(a.style.height):28,a=prompt(lm.setRowHeightPrompt,a),a=parseInt(a),isNaN(a)||ctrl.setWidth(ctrl.rightClickRow,a-16,biffdata.heightCommand,function(a){biffdata.heightCommand=
a;builder.renderAll()})}function getFieldPickerBuilderMode(a,b){var c=node("select"),d=node("option");c.appendChild(d);d.value="-1";for(var e in builder.cellData){var f=builder.cellData[e];f&&(d=node("option"),builder.cellData[f.x+1+","+f.y]||builder.cellData[f.x-1+","+f.y]||f.hasAttribute("interm")||b&&!b(f)||(a==f.domainId&&(d.selected=!0),d.value=f.domainId,d.innerHTML=f.value,c.appendChild(d)))}return c}
function loadFormBasicSetting(){if(builder.ifListingPage())$("titleFieldDiv").style.display="none";else{$("titleFieldDiv").style.display="";var a=getFieldPickerBuilderMode(builder.titleField,function(a){return!a.hasAttribute("fmt_n")}),b=getFieldPickerBuilderMode(builder.selectionField,function(a){return!a.hasAttribute("fmt_n")});$("titleFieldPickDiv").appendChild(a);$("selectionFieldPickDiv").appendChild(b);a.onchange=function(){builder.titleField=this.options[this.selectedIndex].value};b.onchange=
function(){builder.selectionField=this.options[this.selectedIndex].value}}a=$("at_formDeleteType");a.value=builder.formDeleteType;a.onchange=function(){builder.formDeleteType=this.options[this.selectedIndex].value};a=$("at_deleteType");a.value=builder.deleteType;a.onchange=function(){builder.deleteType=this.options[this.selectedIndex].value};if(builder.ifListingPage())openCustomSetting.parentNode.style.display="none";else{var c=$("createCustomMessage").lastChild,d=$("savingCustomMessage").lastChild;
c.oninput=function(){builder.ecmsg.text=c.value};d.oninput=function(){builder.msg.text=d.value};$("openCreateCustomSetting").onclick=function(){this.checked?($("createCustomMessage").style.display="",builder.ecmsg.type||(builder.ecmsg.type="0")):(c.value="",builder.ecmsg.text="",$("createCustomMessage").style.display="none")};$("openCustomSetting").onclick=function(){this.checked?($("savingCustomMessage").style.display="",builder.msg.type||(builder.msg.type="0")):(d.value="",builder.msg.text="",$("savingCustomMessage").style.display=
"none")};builder.ecmsg.text&&(builder.ecmsg.type&&"1"===builder.ecmsg.type&&$("createCustomMessage").childNodes[1].click(),$("openCreateCustomSetting").checked||$("openCreateCustomSetting").click(),c.value=builder.ecmsg.text);builder.msg.text&&(builder.msg.type&&"1"===builder.msg.type&&$("savingCustomMessage").childNodes[1].click(),$("openCustomSetting").checked||$("openCustomSetting").click(),d.value=builder.msg.text);$("cascadingFormulaRecal").checked=builder.cascadingFormulaRecal;$("cascadingFormulaRecal").onclick=
function(){builder.cascadingFormulaRecal=$("cascadingFormulaRecal").checked};$("recalParentFormula").checked=builder.recalParentFormula;$("recalParentFormula").onclick=function(){builder.recalParentFormula=$("recalParentFormula").checked};$("hideEmailHistory").checked=builder.hideEmailHistory;$("hideEmailHistory").addEventListener("click",function(){builder.hideEmailHistory=$("hideEmailHistory").checked},!1);$("addParentEntryManager").checked=builder.addParentEntryManager;$("addParentEntryManager").addEventListener("click",
function(){builder.addParentEntryManager=$("addParentEntryManager").checked},!1)}}
function loadPaymentSetting(){var a=getFieldPickerBuilderMode(builder.paymentAmountField,function(a){return a.hasAttribute("fmt_n")});a.onchange=function(){builder.paymentAmountField=this.options[this.selectedIndex].value};$("paymentFieldPickDiv").appendChild(a);a=$("currencyFieldPick");for(var b=0;b<a.options.length;b++)if(a.options[b].value==builder.paymentCurrency){a.selectedIndex=b;break}$("checkoutTextInput").value=builder.checkoutText?builder.checkoutText:"";confirmStripeConnection()}
function startStripeConnect(a){window.open("https://connect.stripe.com/oauth/authorize?response_type=code&client_id="+a+"&scope=read_write&redirect_uri="+encodeURIComponent("https://"+location.host+"/sims/payment/connect.jsp")+"&state=","stripeConnectWin");$("stripeConnectButton").textContent="Click to confirm connection";$("stripeConnectButton").onclick=confirmStripeConnection;$("stripeConnectButton").style.background="#cc0000";$("stripeConnectButton").style.color="#fff"}
function removePaymentConfig(){builder.stripeUserId="";builder.paymentAmountField="";builder.paymentCurrency="";read(function(a){$("designerInfoContent").innerHTML=a.responseText;loadPaymentSetting()},"/sims/payment/t_payment.jsp?a="+ap,!0)}
function confirmStripeConnection(){ajaxget("/sims/payment/retrieveStripeUserId.jsp",{id:builder.stripeUserId?builder.stripeUserId:""},function(a){if(a=a&&JSON.parse(a))a.error?$("stripeConnectText").innerHTML=a.error:(builder.stripeUserId=a.id,$("stripeConnectButton").innerHTML="Connection confirmed!",$("stripeConnectButton").style.background="#08c",a.name?$("stripeConnectText").innerHTML="Connected to: <b>"+a.name+"</b>":$("stripeConnectText").innerHTML="Connected.")})}
function loadFieldReferences(){var a=builder.cellData[nui.fcol+","+nui.frow];a&&a.domainId&&ajaxget("/sims/references.jsp",{a:ap,p:path,si:sheetIndex,d:a.domainId},function(a){$("propTab10").innerHTML=a})}
function openFreezeSetting(){function a(a){builder.freezeX=a;openFreezeSetting()}function b(a){builder.freezeY=a;openFreezeSetting()}var c=document.createElement("DIV"),d=5;builder.hasSections()&&d>builder.getSectionStart()&&(d=builder.getSectionStart()-1);0>d&&(d=0);if(!builder.ifListingPage()){var e=document.createElement("H2");e.style.textAlign="center";e.textContent=lm.rows+": "+builder.freezeY;var f=document.createElement("UL");f.classList.add("freezeSettingGroup");var g=document.createElement("LI");
g.textContent=lm.freezeNoRows;g.addEventListener("click",b.bind(null,0));g.classList.add("unfreeze");var k=document.createElement("LI"),l=document.createElement("SPAN");l.textContent=lm.freezeTo;l.style.marginRight="3px";k.appendChild(l);l=document.createElement("SELECT");for(var m=0;m<=d;m++){var n=node("option",null,null,m.toString());n.value=m.toString();l.appendChild(n)}l.selectedIndex=builder.freezeY||0;l.style.marginRight="3px";l.addEventListener("change",function(a){a=parseInt(this.selectedOptions[0].value)||
0;b(a)});k.appendChild(l);l=document.createElement("SPAN");l.textContent=lm.rows;k.appendChild(l);f.appendChild(g);f.appendChild(k);c.appendChild(e);c.appendChild(f);c.appendChild(document.createElement("BR"));c.appendChild(document.createElement("HR"))}d=document.createElement("H2");d.style.textAlign="center";d.textContent=lm.cols+": "+builder.freezeX;e=document.createElement("UL");e.classList.add("freezeSettingGroup");f=document.createElement("LI");f.textContent=lm.freezeNoCols;f.addEventListener("click",
a.bind(null,0));f.classList.add("unfreeze");g=document.createElement("LI");l=document.createElement("SPAN");l.textContent=lm.freezeTo;l.style.marginRight="3px";g.appendChild(l);l=document.createElement("SELECT");l.innerHTML='<option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>';l.selectedIndex=builder.freezeX||0;l.style.marginRight="3px";l.addEventListener("change",function(b){b=parseInt(this.selectedOptions[0].value)||
0;a(b)});g.appendChild(l);l=document.createElement("SPAN");l.textContent=lm.cols;g.appendChild(l);e.appendChild(f);e.appendChild(g);c.appendChild(d);c.appendChild(e);floatWin(null,c,lm.freeze)}
function mobileLayoutSelectorShow(a,b){var c=$("mobileLayoutSelector"),d=$("mobileLayoutSelect");if("true"!==d.dataset.open){var e=document.querySelector(".mobileLayoutSelectorFocus");e&&e.classList.remove("mobileLayoutSelectorFocus");a.classList.add("mobileLayoutSelectorFocus");c.style.display="";c.style.top=(b?a.clientHeight-1:0)+"px";c.style.left=0;d.dataset.mobileAttr=a.dataset.mobileAttr;a.appendChild(c);d.selectedIndex=findSelectedIndex(d,a.dataset.domainId)}}
function mobileLayoutSelectorHide(a,b){"true"!==$("mobileLayoutSelect").dataset.open&&null!==a.relatedTarget&&($("mobileLayoutSelector").style.display="none")}function mobileLayoutSelectorChange(a){a&&ajaxget("/sims/custAppLayoutExec.jsp",{a:ap,p:path,si:sheetIndex,d:a.options[a.selectedIndex].value,attr:a.dataset.mobileAttr},reloadMobileAppLayout)}
function reloadMobileAppLayout(){floatWin(function(){return"/sims/custAppLayout.jsp?a="+ap+"&p="+path+"&si="+sheetIndex},null,lm.custAppSeqItems_title,!0)}function findSelectedIndex(a,b){for(var c=0;c<a.options.length;c++)if(a.options[c].value==b)return c;return-1}
function nuiSectionCreateBySelect(){if(!builder.ifListingPage()){var a=-1,b=-1;if(ctrl.multiSelected&&0<ctrl.multiSelected.length)for(var c=0;c<ctrl.multiSelected.length;c++){var d=parseInt(ctrl.multiSelected[c].dataset.y);if(d<a||-1===a)a=d;d>b&&(b=d)}for(;!builder.ifValidNewSectionStart(a);)a--;for(;!builder.ifValidNewSectionEnd(b);)b++;builder.sections&&builder.sections.sections&&0<builder.sections.sections.length?builder.sections.sections.push({name:"Section "+(builder.sections.sections.length+
1),end:b}):(b={name:"Section 1",end:parseInt(b)},builder.sections={start:parseInt(a),sections:[]},b.display=!0,builder.sections.sections.push(b));builder.renderAll();ctrl.multiSelected=[]}}
function nuiSectionCreatePrompt(){if(!builder.ifListingPage()&&builder.hasSections()){for(var a='<div style="float:left;margin:0 12px 12px 0;">'+lm.newSectionPrompt+'</div><div style="float:left;clear:left;margin:0 12px 0 0;"><select id="nuiSectionTabAppend">',b=nui.maxY,c=builder.sections.sections[builder.sections.sections.length-1].end+1;c<=b;c++)builder.ifValidNewSectionEnd(c)&&(a+='<option value="'+c+'">'+c+"</option>");a+='</select></div><div onclick="nuiSectionCreateSave();" class="topButtonWhole">'+
lm.save+"</div>";floatWin(null,a,"Create new section",!0)}}function nuiSectionCreateSave(a){floatWinClose();a||(a=$("nuiSectionTabAppend").options[$("nuiSectionTabAppend").selectedIndex].value);a={name:"Section "+builder.sections.sections.length,end:parseInt(a)};builder.sections.sections.push(a);builder.renderAll()}
function nuiSectionDelete(a){builder.sections.sections.splice(a,1);0==builder.sections.sections.length?builder.sections=null:builder.sections.sections[0].display=!0;builder.renderAll()}function nuiSectionRename(a){var b=$("nuiSectionTab"+a).innerText;$("nuiSectionTab"+a).innerHTML='<input type="text" id="nuiSectionTabRename" sectionIndex="'+a+'" value="'+b+'" onfocus="ctrl.outOfNUI=true;" onblur="nuiSectionRenameSave('+a+');" />';$("nuiSectionTabRename").select()}
function nuiSectionRenameSave(a){ctrl.outOfNUI=!1;builder.sections.sections[a].name=$("nuiSectionTabRename").value;builder.renderAll()}function insertField(){saveBuilderMode(BUILDER_FIELDS,!0);ctrl.dragging=$("addField_D");var a=nui._curcell();a&&!a.ip&&(ctrl.builderMoveEnd=a,endBuilderComponentDrop(),a.ip.dblclick(),$("hin").select())}
function insertDesc(){saveBuilderMode(BUILDER_TEXT,!0);ctrl.dragging=$("addField_DESC");var a=nui._curcell();a&&!a.ip&&(ctrl.builderMoveEnd=a,endBuilderComponentDrop(),a.ip.dblclick(),$("hin").select())}function insertActionButton(a){var b=$("actionButtonDrag").querySelectorAll(".addActionButtonField");b=Array.from(b).find(function(b){return b.actionButton.seq===a});saveBuilderMode(BUILDER_TEXT,!0);ctrl.dragging=b;(b=nui._curcell())&&!b.ip&&(ctrl.builderMoveEnd=b,endBuilderComponentDrop())}
function insertImageBBCode(a){saveBuilderMode(BUILDER_TEXT,!0);a=a?a.biff.value.match(RagicBBCodeParser.getImgTagPattern()):[];var b=a[2]?a[2].slice(1):null,c=a[3];getPromise("/sims/insertImageBBCode.jsp").then(function(a){floatWin(null,a,lm.insertImage,!0);builder.bbcodeImage=new BBCodeImage(b,c);a=document.querySelector(".insertImageByUpload-main-upload");a.addEventListener("dragenter",dragFileIn);a.addEventListener("dragover",dragFileIn);a.addEventListener("dragleave",dragFileOut);a.addEventListener("drop",
dropBBCodeImage);setTimeout(function(){var a=$("insertImageByUrl-main-preview-image");a.addEventListener("load",insertImageByUrlPreviewSuccess);a.addEventListener("error",insertImageByUrlPreviewError)},100)})}var insertImageByUrlInput=debouncedFn(300,function(a){$("insertImageByUrl-main-preview-image").src=a.value});
function insertImageByUrlPreviewSuccess(){var a=builder.bbcodeImage;this.nextElementSibling.classList.remove("insertImageByUrl-main-preview-error--active");this.style.display="block";this.error=!1;a.setImageUrl(this.src);a.initSize(null,this.naturalWidth,this.naturalHeight);a.activeSetting(this.naturalWidth,this.naturalHeight)}
function insertImageByUrlPreviewError(){if(!this.error){var a=builder.bbcodeImage;this.nextElementSibling.classList.add("insertImageByUrl-main-preview-error--active");this.style.display="none";this.error=!0;a.setImageUrl(null);a.deactiveSetting()}}
function previewBBCodeImage(a,b){if((b=b||a.files[0])&&isImageFile(b.name)){var c=a.parentElement;a=a.parentElement;var d=c.querySelector("img");a.classList.add("insertImageBy-main--fileUploaded");readBlobAsDataURL(b).then(function(a){var e=new Image;e.addEventListener("load",function(){builder.bbcodeImage.initSize(b,e.naturalWidth,e.naturalHeight);builder.bbcodeImage.activeSetting(e.naturalWidth,e.naturalHeight);d?d.src=a:(e.style.maxWidth="300px",c.appendChild(e));ctrl.isIE&&e.removeEventListener("load",
arguments.callee)},{once:!0});e.src=a})}else alert(lm.insertNotImageWarning)}function dropBBCodeImage(a){cancelEventBubble(a);a=a.dataTransfer.files;var b=this.querySelector("input[type=file]");this.style.outline="";this.style.backgroundColor="";previewBBCodeImage(b,a[0])}
function setImageRatioResize(a){builder.bbcodeImage.setImageRatioResize(a.checked);if(a.checked){var b=builder.bbcodeImage.getWidth();a=builder.bbcodeImage.getHeight();b=getPrecisedFloat(b/builder.bbcodeImage.getImageRatio());b!==a&&(builder.bbcodeImage.setNewHeight(b),builder.bbcodeImage.heightInput.value=b)}}
function resizeBBCodeImage(a,b){a=getPrecisedFloat(a.value);if(!a||1>a)a=1;b?(builder.bbcodeImage.setNewWidth(a),1===a&&(builder.bbcodeImage.widthInput.value=1),builder.bbcodeImage.isImageRatioResize()&&(b=getPrecisedFloat(a/builder.bbcodeImage.getImageRatio()),b!==builder.bbcodeImage.getHeight()&&(builder.bbcodeImage.setNewHeight(b),builder.bbcodeImage.heightInput.value=b))):(builder.bbcodeImage.setNewHeight(a),1===a&&(builder.bbcodeImage.heightInput.value=1),builder.bbcodeImage.isImageRatioResize()&&
(b=getPrecisedFloat(a*builder.bbcodeImage.getImageRatio()),b!==builder.bbcodeImage.getWidth()&&(builder.bbcodeImage.setNewWidth(b),builder.bbcodeImage.widthInput.value=b)))}
DesignModeBuilder.prototype.uploadImageByInsertImageBBCode=function(){var a=this;if(a.bbcodeImage&&a.bbcodeImage.isValid())if(a.bbcodeImage.type===BUILDER_BBCODE_IMAGE_BY_UPLOAD){var b=new FormData,c=a.bbcodeImage.getFile();b.append("uf",c,c.name);postFormDataPromise("/sims/quickUpload.jsp?a="+ap+"&insertImageBBCodeByUpload",b).then(function(b){b=b.trim();a.bbcodeImage.setImageUrl(location.protocol+"//"+location.host+getFileDownloadURL(b));a.setDescription(nui.fcol,nui.frow,a.bbcodeImage.getImageBBCode());
a.freeData[nui.fcol+","+nui.frow]instanceof FreeObject&&(a.freeData[nui.fcol+","+nui.frow].insertImageByUpload=!0);builderHelperPanelSwitch(2);setStylePane(builder.freeData[nui.fcol+","+nui.frow]);floatWinClose()})}else a.setDescription(nui.fcol,nui.frow,a.bbcodeImage.getImageBBCode()),builderHelperPanelSwitch(2),setStylePane(builder.freeData[nui.fcol+","+nui.frow]),floatWinClose();else alert(lm.insertImageByUploadOrUrlWarning)};
function BBCodeImage(a,b){this.type=BUILDER_BBCODE_IMAGE_BY_UPLOAD;this.info={};this.info[BUILDER_BBCODE_IMAGE_BY_UPLOAD]=new BBCodeImageInfo;this.info[BUILDER_BBCODE_IMAGE_BY_URL]=new BBCodeImageInfo;this.widthInput=$("insertImage-setting-width");this.heightInput=$("insertImage-setting-height");this.widthHeightSetting=$("insertImage-setting");this.urlInput=document.querySelector("#insertImageByUrl-main input");this.byUploadCheckbox=$("insertImageByUpload");this.byUploadMain=$("insertImageByUpload-main");
this.byUrlCheckbox=$("insertImageByUrl");this.byUrlMain=$("insertImageByUrl-main");this.ratioSize=$("insertImage-ratio");this.initSize=function(a,b,c){var d=this.info[this.type];this.type===BUILDER_BBCODE_IMAGE_BY_UPLOAD&&(d.file=a);d.natrualWidth=b;d.natrualHeight=c;d.newWidth=0;d.newHeight=0;d.imageRatio=b/c};this.getWidth=function(){var a=this.info[this.type];return a.newWidth||a.natrualWidth};this.getNewWidth=function(){return this.info[this.type].newWidth};this.setNewWidth=function(a){this.info[this.type].newWidth=
a};this.getHeight=function(){var a=this.info[this.type];return a.newHeight||a.natrualHeight};this.getNewHeight=function(){return this.info[this.type].newHeight};this.setNewHeight=function(a){this.info[this.type].newHeight=a;return this};this.getImageUrl=function(){return this.info[this.type].url};this.setImageUrl=function(a){this.info[this.type].url=a;return this};this.getImageBBCode=function(){var a=this.info[this.type],b=a.newWidth||a.natrualWidth,c=a.newHeight||a.natrualHeight;return"[img"+(b!==
a.natrualWidth||c!==a.natrualHeight?"="+b+"X"+c:"")+"]"+a.url+"[/img]"};this.getImageHtml=function(){var a=this.info[this.type];return"<img width='"+(a.newWidth||a.natrualWidth)+"' height='"+(a.newHeight||a.natrualHeight)+"' src='"+a.url+"'>"};this.getFile=function(){var a=this.info[this.type];return this.type===BUILDER_BBCODE_IMAGE_BY_UPLOAD?a.file:null};this.isValid=function(){var a=this.info[this.type];return this.type===BUILDER_BBCODE_IMAGE_BY_UPLOAD?!!a.file:!!a.url};this.isImageRatioResize=
function(){return this.info[this.type].isRatioResize};this.setImageRatioResize=function(a){this.info[this.type].isRatioResize=a};this.getImageRatio=function(){return this.info[this.type].imageRatio};this.setImageRatio=function(a,b){this.info[this.type].imageRatio=a/b};this.activeSetting=function(a,b){this.widthHeightSetting.classList.add("insertImage-setting--active");this.widthInput.value=a;this.heightInput.value=b;this.ratioSize.checked=this.isImageRatioResize()};this.deactiveSetting=function(){this.widthHeightSetting.classList.remove("insertImage-setting--active")};
this.toggleInsertImageBy=function(){this.byUploadMain.classList.toggle("insertImageBy-main--active");this.byUrlMain.classList.toggle("insertImageBy-main--active");this.byUrlMain.classList.contains("insertImageBy-main--active")?(this.type=BUILDER_BBCODE_IMAGE_BY_URL,this.urlInput.focus(),this.byUrlCheckbox.checked=!0):(this.type=BUILDER_BBCODE_IMAGE_BY_UPLOAD,this.byUploadCheckbox.checked=!0);var a=this.getWidth(),b=this.getHeight();this.isValid()?this.activeSetting(a,b):this.deactiveSetting()};if(b){this.type=
BUILDER_BBCODE_IMAGE_BY_URL;this.setImageUrl(b);var c=$("insertImageByUrl-main-preview-image");c.src=b;c.style.display="block";a?(c=a.toUpperCase().split("X"),a=getPrecisedFloat(c[0]),c=getPrecisedFloat(c[1]),this.setNewWidth(a),this.setNewHeight(c),this.setImageRatio(a,c)):this.initSize(null,c.naturalWidth,c.naturalHeight);this.urlInput.value=b;this.toggleInsertImageBy()}}
function BBCodeImageInfo(){this.newHeight=this.natrualHeight=this.newWidth=this.natrualWidth=0;this.url=null;this.isRatioResize=!0}function Uploader(a){this.type=UPLOADER;this.IPType=a}
Uploader.prototype.keyDown=function(a){if(this.readOnly||this.biff&&this.biff.hasAttribute("hide"))return!0;var b=a.keyCode;if(!canSaveData()&&(b===KEYCODE.DELETE||b===KEYCODE.BACKSPACE)&&2>ctrl.multiSelected.length){if(modeUpdate())return!0;a.preventDefault()}var c=checkIfUserCanEdit(!0);switch(b){case KEYCODE.DELETE:if(!this.typing){if(mode===BROWSE&&!c)return!0;c=!biffdata.keyField;if(canSaveData()&&c){c=(c=nui._getcell(nui.fcol-1,nui.frow))&&c.ip;var d=nui._getcell(nui.fcol+1,nui.frow,!0);d=d&&
d.ip;!c&&d&&deleteEntry(this.domainId,this.nodeId)}this.clear();this.typing=!0;this.render()}break;case KEYCODE.BACKSPACE:if(mode===BROWSE&&!c)return!0;this.clear();this.typing=!0;this.render()}return a.altKey&&13==b?!1:!0};Uploader.prototype.keyUp=function(){return!0};Uploader.prototype.onpaste=emptyFunction;
Uploader.prototype.click=function(){if(!this.readOnly&&(mode!==BROWSE||checkIfUserCanEdit())){var a=$("IX"+this.biff.x+"Y"+this.biff.y);a||(modeUpdate(),a=$("IX"+this.biff.x+"Y"+this.biff.y));if(canSaveData()){this.biff.hasAttribute("multipleImages")||this.biff.hasAttribute("multipleFiles")?(a=a.querySelector("input[type=file]"),a.multiple=!0):("DIV"===a.tagName&&a.classList.contains("loadValueFromOther")&&(a=a.querySelector("#IX"+this.biff.x+"Y"+this.biff.y+"_file")),a.type="file");var b=this.biff.attr.f_extensions;
b&&(a.accept=unformatNUIAttr(b));a.value=null;a.click();biffdata.ifListingPage()&&nui.focus&&!nui.focus.classList.contains("focusPointNone")&&nui.focus.classList.add("focusPointNone");ctrl.isMac||setTimeout(function(){endMultiSelect()},500)}}};Uploader.prototype.dblclick=emptyFunction;
Uploader.prototype.focus=function(){var a=this;if(!(mode===BROWSE&&biffdata.ifListingPage()||mode===BUILDER)){$("focus").classList.add("focusPointNone");var b=nui._curcell();b.getBoundingClientRect();nui.focus.getBoundingClientRect();b.onmousedown=function(b){var c;b.which?c=3==b.which:b.button&&(c=2==b.button);c||2>ctrl.multiSelected.length&&a.click()};ctrl.uploadTargetCell=b}};
Uploader.prototype.blur=function(){var a=this.biff;$("focus").classList.remove("focusPointNone");if(!ctrl.uploadTargetCell)return!1;ctrl.uploadTargetCell.onmousedown=emptyFunction;ctrl.uploadTargetCell=null;return mode===BUILDER?this.lastFocusValue!==this.value:a&&this.lastFocusValue!==a.value};Uploader.prototype.getValue=function(){return this.value};Uploader.prototype.getNUIFormValue=function(){return this.value};
Uploader.prototype.loadValue=function(a,b,c,d,e,f){var g=this,k=g.biff,l=k.hasAttribute("multipleImages")||k.hasAttribute("multipleFiles"),m=k.hasAttribute("l")||k.hasAttribute("f");d=!1;if(!(a&&512<a.length)||a.startsWith("data:image")||l||a.includes("|")){if(!b){var n=$("P_clear_X"+k.x+"Y"+k.y);n&&(n.value=""!==a?"":"1")}g.oldValue=g.value;k.oldValue=k.value;var q=k.oldValue.split("|").reduce(function(a,b){b&&a.push(truncateFilenameMultiDotsToOne(b));return a},[]),r=a.split("|").reduce(function(a,
b){b&&a.push(truncateFilenameMultiDotsToOne(b));return a},[]);a=r.join("|");var p=0<r.length&&r.every(function(a){return"@"===a.charAt(8)||"@"===a.charAt(10)||"DROPBOX://"===a.substr(0,10)});n=p&&q.length>r.length&&r.every(function(a){return q.includes(a)});if(p||""===a){var t=r.map(function(a){return location.protocol+"//"+location.host+getFileDownloadURL(a)}).join("|");b||g.value===t||processLastEditDefaultValue(b,k);g.value=t;k.value=a}else a.startsWith("data:image")&&(b||g.value===a||processLastEditDefaultValue(b,
k),g.value=a,k.value=a);p&&1<r.length&&!l&&!k.hasAttribute("vd")&&(g.value=location.protocol+"//"+location.host+getFileDownloadURL(r[0]),k.value=r[0]);g.render();if(!b){var v=c?c.target:$("IX"+k.x+"Y"+k.y);if(v){g.currentUploadXhr&&g.currentUploadXhr.abort();"DIV"===v.tagName&&(v=v.classList.contains("loadValueFromOther")&&!l?v.querySelector("#IX"+k.x+"Y"+k.y+"_file"):v.querySelector("input[type=file]"));if(v&&"INPUT"===v.tagName&&!p)if(a.length&&("file"===v.type&&v.files.length||Array.isArray(e))){var u=
Array.from(e?e:v.files);g.validateExtension(a);g.validateMaxSize(u);u=g.filterOutValidFiles(u);var x=new FormData,E=g.createUploadXHR(),D=[];d=!0;g.currentUploadXhr=E;u.forEach(function(a){D.push(resizeImage(a,k))});g.showUploadErrorWin();0<D.length?Promise.all(D).then(function(a){a.forEach(function(a,b){x.append("uf",a,u[b].name)});E.open("POST","/sims/quickUpload.jsp?a="+ap+"&p="+path+"&si="+sheetIndex+"&ud="+g.domainId+"&n="+g.nodeId+(window.rmlc?"&rmlc":"")+"&fc="+a.length);E.send(x);E.onreadystatechange=
function(){if(4===E.readyState){var a=E.response.trim();if(a){var c=a.split("|");l&&g.oldValue&&k.oldValue?(g.value=g.oldValue+"|"+c.map(function(a){return location.protocol+"//"+location.host+getFileDownloadURL(a)}).join("|"),k.value=k.oldValue+"|"+a):(g.value=c.map(function(a){return location.protocol+"//"+location.host+getFileDownloadURL(a)}).join("|"),k.value=a);g.value!==g.oldValue&&(processLastEditDefaultValue(b,k),biffdata.ifSubtableDataBiff(k)&&""===g.oldValue&&checkEmptySubtableRows(k));
g.oldValue=g.value;k.oldValue=k.value;if(l){a=$("IX"+k.x+"Y"+k.y).querySelector("div.input");for(var d=$$("input",a).length,e=0;e<c.length;e++){var f=node("input");f.id="IX"+k.x+"Y"+k.y+"_file"+(d+e);f.type="checkbox";f.name=g.nuiName;f.value="RAGIC_ATINSZ8_"+c[e];f.checked=!0;f.style.display="none";a.appendChild(f)}}else v=$("IX"+k.x+"Y"+k.y),v.classList.contains("loadValueFromOther")&&(v=$("IX"+k.x+"Y"+k.y+"_file")),v.type="hidden",v.value=a;resetFormulaObject(k);RagicInteractiveRules.execute(!1,
k);g.render();subTableExtendProcess(g.value,k);g.updateFormulaEngine(!1)}else g.calcelUpload||alert("Your file was not uploaded, probably due to not having access right to upload file or one of the files is too big to upload.")}}}):g.currentUploadXhr=null}else l?(c=$("IX"+k.x+"Y"+k.y).querySelector("div.input"),$$("input",c).forEach(function(a){a.checked=!1})):v.value="",RagicInteractiveRules.execute(!1,k);else if(!l)v.type="hidden",v.value=a;else if(m){var A=$("IX"+k.x+"Y"+k.y).querySelector("div.input");
c=new Set(r);var w=$$("input",A);n?q.forEach(function(a,b){!r.includes(a)&&w[b]&&(w[b].checked=!1)}):(w[0]&&(A.innerHTML=""),Array.from(c).forEach(function(a,b){var c=node("input");c.id="IX"+k.x+"Y"+k.y+"_file"+b;c.type="checkbox";c.name=g.nuiName;c.value="RAGIC_ATINSZ8_"+a;c.checked=!0;c.style.display="none";A.appendChild(c)}))}mode===BUILDER||d||""!==a||f||checkEmptySubtableRows(k)}}mode!==BUILDER&&g.updateFormulaEngine(b);return!1}};
Uploader.prototype.validateExtension=function(a){var b=this.biff;if("string"===typeof a){a=a.split("|");if(b.IPType===GRAPHICS)var c=".bmp .cr2 .gif .ico .ithmb .jpeg .jpg .nef .png .raw .svg .tif .tiff .wbmp .webp .jfif".split(" ");else if(b.IPType===UPLOADER){var d=b.attr.f_extensions;d&&(c=unformatNUIAttr(d).split(","))}if(Array.isArray(c)){b=b.IPType===GRAPHICS?lm.uploadErrorImgTypeNotMatch:getBundleString("uploadErrorFileTypeNotMatch",[c.join(",  ")]);d={};for(var e=0,f=d.$jscomp$loop$prop$v$622=
void 0,g=a.length;e<g;d={$jscomp$loop$prop$v$622:d.$jscomp$loop$prop$v$622},e++)d.$jscomp$loop$prop$v$622=a[e],(f=c.some(function(a){return function(b){return a.$jscomp$loop$prop$v$622.substring(a.$jscomp$loop$prop$v$622.lastIndexOf(".")).toLowerCase()===b}}(d)))||this.catchUploadError(d.$jscomp$loop$prop$v$622,new UploadError(UploadError.WRONG_EXTENSION,b))}}};
Uploader.prototype.catchUploadError=function(a,b){!a||!b instanceof UploadError||(this.uploadErrors||(this.uploadErrors={}),this.uploadErrors[a]||(this.uploadErrors[a]={}),this.uploadErrors[a].errors||(this.uploadErrors[a].errors=[]),this.uploadErrors[a].errors.push(b))};
Uploader.prototype.showUploadErrorWin=function(){if(this.uploadErrors&&Object.keys(this.uploadErrors).length){var a=Object.keys(this.uploadErrors);var b="<h3>"+getBundleString("uploadErrorTitle",[a.length])+"</h3>";b+="<div class='uploadError' style='margin-top: 10px; background-color: lightgrey; font-weight: bolder;'><div>"+lm.uploadErrorFileName+"</div><div>"+lm.uploadErrorFileReason+"</div></div>";for(var c=0,d,e,f=a.length;c<f;c++)if(d=a[c],e=this.uploadErrors[d].errors,Array.isArray(e)){b+="<div class='uploadError'><div>"+
d+"</div><div>";d=0;for(var g=e.length;d<g;d++)b+='<p style="margin-bottom: '+(d===g-1?"0":"10px")+'; padding-left: 5px;">',b+='<i class="fas fa-exclamation-circle"></i>',b+=e[d].message,b+="</p>";b+="</div></div>"}floatWinError(b+"<div style='margin: 30px 0;'></div>");this.uploadErrors=null}};
Uploader.prototype.validateMaxSize=function(a){var b=this.biff;if(b&&b.attr&&Array.isArray(a)){var c=parseInt(b.attr.maxFileSize||("DISTR"===licenseType?10737418240:1073741824)),d=b.attr.maxFileSize_number||("DISTR"===licenseType?"10":"1"),e=b.attr.maxFileSize_unit||"GB";b=a.filter(function(a){return a.size>c});if(a=b.length){d=getBundleString("uploadErrorExceedMaxFileSize",[d,e]);e=void 0;for(var f=0;f<a;f++)e=b[f],this.catchUploadError(e.name,new UploadError(UploadError.EXCEED_MAX_SIZE,d))}}};
Uploader.prototype.filterOutValidFiles=function(a){if(!this.uploadErrors)return a;var b=Object.keys(this.uploadErrors);return b.length?a.filter(function(a){return!b.includes(a.name)}):a};function UploadError(a,b){this.type=a;this.message=b}UploadError.WRONG_EXTENSION=0;UploadError.EXCEED_MAX_SIZE=1;function unitizeFile(a){for(var b="KB MB GB TB PB EB".split(" "),c="Bytes",d=0;1024<=a;)a/=1024,c=b[d++];return formatNumber(a,"#,###.#")+" "+c}
Uploader.prototype.loadValues=function(a,b,c){var d=this.biff;!a instanceof FileList||0===a.length||(d.IPType===GRAPHICS&&!d.hasAttribute("multipleImages")&&1<a.length?floatWinWarning(lm.multipleImagesWarning):d.IPType===UPLOADER&&!d.hasAttribute("multipleFiles")&&1<a.length?floatWinWarning(lm.multipleFilesWarning):(a=Array.from(a),d=a.map(function(a){return a.name}).join("|"),this.loadValue(d,b,c,!1,a)))};
Uploader.prototype.updateFormulaEngine=function(a,b){var c=this.biff;try{var d=getCellNameFromDataCache(c);d&&mode!==BUILDER&&c&&(resetFormulaObject(c),a||(formulaBuilder.update(d,c,b),updateFieldDescriptionFormulas()))}catch(e){processJSExceptionObj(e)}};
function deleteFile(a,b){if(!ifRightClick(event)){a=parseInt(a.dataset.index);var c=b.value.split("|"),d=b.ip;if(b.hasAttribute("multipleImages")||b.hasAttribute("multipleFiles"))b=$("IX"+b.x+"Y"+b.y).querySelector("div.input"),$$("input",b).filter(function(a){return a.checked})[a].checked=!1;c.splice(a,1);d.loadValue(c.join("|"));autoSaveInterval(500)}}
function getFileDownloadURL(a,b){return a&&a.startsWith("data:image")?a:lm.cdn+"/sims/file.jsp?a="+ap+"&f="+encodeURIComponent(a)+(b?"&force":"")}
function getIconName(a){if(!a||0===a.length)return"";a=a.toLowerCase();a=a.split(".");var b="";1<a.length&&(b=a[a.length-1]);var c;"doc dochtml docm docx docxml dot dothtml dotm dotx".split(" ").includes(b)?c="word":["pdf"].includes(b)?c="acrobat":"bmp cr2 gif ico ithmb jpeg jpg nef png raw svg tif tiff wbmp webp jfif".split(" ").includes(b)?c="picture":["xls","xlsx","csv","tsv"].includes(b)?c="excel":["txt","log"].includes(b)?c="text":["zip","rar","tar","gz"].includes(b)?c="compressed":"3g2 3gp 3gpp 3gpp2 asf avi dv dvi flv m2t m4v mkv mov mp4 mpeg mpg mts ogv ogx rm rmvb ts vob webm wmv".split(" ").includes(b)?
c="film":"pot pothtml potm potx ppa ppam pps ppsm ppsx ppt ppthtml pptm pptx pptxml".split(" ").includes(b)?c="powerpoint":"aac aif aifc aiff au flac m4a m4b m4p m4r mid mp3 oga ogg opus ra ram spx wav wma".split(" ").includes(b)?c="sound":"applescript as as3 c cc clisp coffee cpp cs css cxx def diff erl fountain ft h hpp htm html hxx inc ini java js json less log lua m markdown mat md mdown mkdn mm mustache mxml patch php phtml pl plist properties py rb sass scss sh shtml sql tab taskpaper tex text tmpl url vb xhtml xml yaml yml".split(" ").includes(b)&&
(c="code");return c}function getIcon(a){return(a=getIconName(a))&&0!==a.length?"/integration/dropbox/icons/page_white"+(a?"_"+a:"")+".gif":"/integration/dropbox/icons/page_white.gif"}function isOfficeFile(a){a=a.toLowerCase();a=a.split(".");var b="";1<a.length&&(b=a[a.length-1]);return"doc dochtml docm docx docxml dot dothtml dotm dotx".split(" ").includes(b)||"pot pothtml potm potx ppa ppam pps ppsm ppsx ppt ppthtml pptm pptx pptxml".split(" ").includes(b)||[".xls","xlsx"].includes(b)}
function isPDFFile(a){a=a.toLowerCase();a=a.split(".");var b="";1<a.length&&(b=a[a.length-1]);return"pdf"===b}function isImageFile(a){return"picture"===getIconName(a)}
function deleteImage(){var a=this.x,b=this.y,c=this.ip;if(!ifRightClick(event)){var d=this.hasAttribute("multipleImages")||this.hasAttribute("multipleFiles"),e=e_target(event).parentNode.children[1].children[0].dataset.index;if(d){var f=this.value.split("|");a=$("IX"+a+"Y"+b).querySelector("div.input");a=$$("input",a).filter(function(a){return a.checked});f.splice(e,1);a[e].checked=!1;setTimeout(function(){c.loadValue(f.join("|"))},20)}else setTimeout(function(){c.loadValue("")},20);autoSaveInterval(500)}}
function createImageFromUploader(a,b,c,d,e){if(b){var f=node("img"),g,k=120,l=a.value.split("|").length,m=a.hasAttribute("imgheader")&&!biffdata.ifListingPage(),n=biffdata.findHeaderFromBiff(a);n=nui._getcell(n.x,n.y);n=nui._getcell(a.x-1,a.y)===n;var q=node("div"),r=node("div"),p=a.ip.cell,t=node("i",!1,"fal fa-times closeIcon imageDel"),v=a.hasAttribute("imgfit"),u=a.hasAttribute("fixImageMax"),x=p.offsetWidth/l-2;c=c||0;q.style.position="relative";v&&!u&&1<l&&(q.style.flex="1 1 "+100/l+"%");r.style.position=
"relative";v&&!u?(r.style.width="100%",q.style.width="100%"):(r.style.maxWidth="100%",c!==l-1&&(q.style.marginRight="2px"));f.dataset.index=c;canSaveData()&&!a.ip.readOnly&&checkIfUserCanEdit(!0)&&(r.appendChild(t),c=function(b){deleteImage.call(a);cancelEventBubble(b)},t.addEventListener("mousedown",c),t.addEventListener("touchstart",c));e?(e.appendChild(f),r.appendChild(e)):r.appendChild(f);q.appendChild(r);u?(q.style.overflow="visible",p.style.overflow="visible",a.hasAttribute("iwidth")&&(g=a.attr.iwidth),
a.hasAttribute("iheight")&&(k=a.attr.iheight),k&&(f.style.maxHeight=k+"px"),f.style.maxWidth=g&&g<=x?g+"px":x+"px",f.src=getFileDownloadURL(b),a.hasAttribute("imageResize")&&(f.src=f.src+"&imageResize="+g+","+k),imageOrientationRotate(f),a.ip.readOnly||f.addEventListener("load",function(){t.style.left=f.offsetLeft+f.offsetWidth-t.offsetWidth+"px"})):(q.style.display="flex",q.style.alignItems="flex-end",f.src=getFileDownloadURL(b),k=Math.max(120,p.offsetHeight),a.hasAttribute("iwidth")&&(g=a.attr.iwidth),
a.hasAttribute("iheight")&&(k=a.attr.iheight),m&&n&&(p.style.overflow="visible"),v?(f.style.height=p.offsetHeight+"px",f.style.width="100%",d&&(d.style.marginLeft=0)):(k&&(f.style.maxHeight=k+"px"),f.style.maxWidth=g&&g<=x?g+"px":x+"px"),imageOrientationRotate(f));return a.hasAttribute("sig")?f:q}}var dropFileFunc;
Uploader.prototype.render=function(a,b,c,d){var e=this.biff;a=this.cell;var f=this;if(!(e&&e.hasAttribute("hide")||mode===BUILDER)&&biffdata.findHeaderFromBiff(e)&&(b=mode!==BUILDER?biffdata:builder,!e||b.ifRenderRow(e.y))){f.readOnly&&a.classList.add("read-only_cell");if(canSaveData()){if(e.value===f.lastUpdateModeRenderValue&&!c&&!d)return;f.lastUpdateModeRenderValue=e.value}else if(mode===BROWSE){if(e.value===f.lastBrowseModeRenderValue&&!c)return;f.lastBrowseModeRenderValue=e.value}var g=[],k=
[],l=e.hasAttribute("multipleImages")||e.hasAttribute("multipleFiles");d=biffdata.findHeaderFromBiff(e);var m=nui._getcell(d.x,d.y);b=nui._getcell(e.x-1,e.y);var n=b===m,q=e.hasAttribute("imgheader");d=e.hasAttribute("fixImageMax");var r=e.hasAttribute("imgfit");g=e.value.splitIgnoreEmpty("|").filter(function(a){return a});!e.hasAttribute("vd")&&!l&&1<g.length&&(g=g.slice(0,1));for(l=0;l<g.length;l++){var p=g[l];"@"===p.charAt(8)?p=p.substr(9):"@"===p.charAt(10)?p=p.substr(11):"DROPBOX://"===p.substr(0,
10)&&(p=p.split("/")[2]);var t=getIcon(p),v=getIconName(p),u=void 0;t&&0<t.length&&(u=node("img"),u.className="fileIcon",u.src=t,u.style.width="16px",u.style.height="16px");t=p;e.hasAttribute("hideExt")&&(t=p.substring(0,p.lastIndexOf(".")));k.push({fileName:t,originalFileName:p,iconName:v,icon:u})}v=biffdata&&!biffdata.ifListingPage()&&(!f.readOnly||!canSaveData());l=function(a){var b;a.which?b=3==a.which:a.button&&(b=2==a.button);b||(f.click.call(f),a.target.closest("[id^=_]")===nui._curcell()&&
cancelEventBubble(a))};if(v){var x=node("i");x.classList.add("fa","fa-paperclip","fa-fw","faicon");x.style.fontSize="12px";x.addEventListener("mousedown",l);x.addEventListener("touchstart",l);var E=node("i");E.classList.add("far","fa-image","fa-fw","faicon");E.addEventListener("mousedown",l);E.addEventListener("touchstart",l);var D=node("i","downloadMultiFiles","fileIcon");D.className="fas fa-arrow-alt-to-bottom file-features";D.style.position="absolute";D.style.left="5px";D.style.bottom="5px";D.addEventListener("mousedown",
downloadAllFiles.bind(D,e));D.addEventListener("mouseenter",showTooltip.bind(null,D));D.addEventListener("mouseleave",hideTinyTooltip);D.addEventListener("touchstart",function(a){1===a.touches.length&&downloadAllFiles(e)})}rm(a);a.style.padding=0;p=node("a");l=node("div");l.attr({marginLeft:0,display:"inline-flex"});if(e.hasAttribute("styleVverticalAlign"))switch(e.attr.styleVverticalAlign){case "top":l.style.alignItems="flex-start";break;case "middle":l.style.alignItems="center";break;case "bottom":l.style.alignItems=
"flex-end"}r&&!d&&(l.style.width="calc(100%"+(q&&n?" + "+(b.offsetWidth-b.clientLeft)+"px":"")+")");d&&l.attr({position:"absolute",top:0,left:0});p.href="javascript:void(0);";p.style.textDecoration="none";p.style.width="100%";r=1===g.length;u=f.IPType===GRAPHICS;if(!canSaveData())if(u)if(g.length){x=[];for(D=0;D<g.length;D++)v=p.cloneNode(!0),E=createImageFromUploader(e,g[D],D,l,v),l.appendChild(E),E.querySelector("img").addEventListener("load",function(){f.afterRender(c)}),x.push(v);a.appendChild(l);
x.forEach(function(a,b){a.onmousedown=function(a){if(ifRightClick(a))return!1;var c=g.map(function(a){return getFileDownloadURL(a)});lightbox(c,!0,null,e,b);a.cancelBubble=!0};a.onmouseover=function(a){nui._curcell()!==f.cell&&showFilePreview(e,k,a.target.dataset.index)};a.onmouseout=cancelPreview})}else v&&a.appendChild(E),wrapRelativeDiv(a,!1,!0);else{E=[];u={};for(t=0;t<g.length;u={$jscomp$loop$prop$bVal$626:u.$jscomp$loop$prop$bVal$626,$jscomp$loop$prop$video$627:u.$jscomp$loop$prop$video$627},
t++){u.$jscomp$loop$prop$bVal$626=g[t];var A=k[t],w=p.cloneNode(!0);E.push(w);var F=node("a"),C=node("i");F.href="javascript:void(0);";F.onmousedown=function(a){return function(b){if(ifRightClick(b))return!1;downloadFile(e,a.$jscomp$loop$prop$bVal$626);b.stopPropagation()}}(u);F.addEventListener("touchstart",function(a){return function(b){1===b.touches.length&&(downloadFile(e,a.$jscomp$loop$prop$bVal$626),cancelEventBubble(b))}}(u));C.classList.add("far","fa-cloud-download","file-features");var z=
(u.$jscomp$loop$prop$bVal$626.endsWith(".mp4")||u.$jscomp$loop$prop$bVal$626.endsWith(".mov"))&&!e.hasAttribute("videoOnlyShowName"),J=u.$jscomp$loop$prop$bVal$626.endsWith(".mp3");if(J)z=node("audio"),J=node("div",!1,"media"),r||J.classList.add("mediaWrap"),J.dataset.index=t+"",z.controls=!0,z.src=getFileDownloadURL(u.$jscomp$loop$prop$bVal$626),z.style.maxWidth="100%",z.addEventListener("mousedown",function(a){a.stopPropagation()}),F.appendChild(C),J.appendChild(z),J.appendChild(F),w.appendChild(J),
a.appendChild(w);else if(z){A=function(a){return function(b){if("mousedown"!==b.type||1===b.which)cancelEventBubble(b),window.open(a.$jscomp$loop$prop$bVal$626.endsWith(".mp4")?a.$jscomp$loop$prop$video$627.src:"/sims/videoNewWin.jsp?a="+ap+"&f="+encodeURIComponent(a.$jscomp$loop$prop$bVal$626),"_blank")}}(u);u.$jscomp$loop$prop$video$627=node("video");var L=node("div",!1,"media"),B=node("div");r||L.classList.add("mediaWrap");L.dataset.index=t+"";u.$jscomp$loop$prop$video$627.controls=!0;u.$jscomp$loop$prop$video$627.src=
getFileDownloadURL(u.$jscomp$loop$prop$bVal$626);u.$jscomp$loop$prop$video$627.style.maxWidth="100%";u.$jscomp$loop$prop$video$627.addEventListener("mousedown",function(a){a.stopPropagation()});L.appendChild(u.$jscomp$loop$prop$video$627);var y=node("a"),O=node("i");y.href="javascript: void(0);";y.addEventListener("mousedown",A);y.addEventListener("touchstart",A);O.classList.add("fas","fa-external-link","file-features");y.appendChild(O);F.appendChild(C);B.appendChild(y);B.appendChild(F);B.style.textAlign=
"left";L.appendChild(B);w.appendChild(L);z&&w.setAttribute("isMovie",!0);J&&w.setAttribute("isAudio",!0);a.appendChild(w)}else z&&w.setAttribute("isMovie",!0),J&&w.setAttribute("isAudio",!0),a.appendChild(f.renderMultiFiles(u.$jscomp$loop$prop$bVal$626,t,A,!1,w,r))}E.forEach(function(a){var b=a.getAttribute("isMovie"),c=a.getAttribute("isAudio");b||c||(a.onmouseover=function(a){showFilePreview(e,k,a.currentTarget.children[0].dataset.index)},a.onmouseout=cancelPreview)});v&&(a.appendChild(x),wrapRelativeDiv(a,
!1,!0),1<g.length&&(x=node("div"),x.style.padding="15px",x.style.textAlign="left",x.appendChild(D),a.appendChild(x)))}else if(canSaveData()){D=1===g.length;if(g.length){r=[];for(t=0;t<g.length;t++)J=g[t],A=k[t],w=A.fileName,F=p.cloneNode(!0),C=(J.endsWith(".mp4")||J.endsWith(".mov"))&&!e.hasAttribute("videoOnlyShowName"),z=J.endsWith(".mp3"),u?(J=createImageFromUploader(e,J,t,l,F),A=J.querySelector("img"),A.addEventListener("load",function(){f.afterRender(c)}),A.title=w,l.appendChild(J)):a.appendChild(f.renderMultiFiles(J,
t,A,!0,F,D)),C&&F.setAttribute("isMovie",!0),z&&F.setAttribute("isAudio",!0),r.push(F);u?(a.appendChild(l),r.forEach(function(a){var b=a.getAttribute("isMovie"),c=a.getAttribute("isAudio");b||c||(a.onmouseover=function(a){nui._curcell()!==f.cell&&showFilePreview(e,k,a.target.dataset.index)},a.onmouseout=cancelPreview)})):r.forEach(function(a){var b=a.getAttribute("isMovie"),c=a.getAttribute("isAudio");b||c||(a.onmouseover=function(a){showFilePreview(e,k,a.currentTarget.children[0].dataset.index)},
a.onmouseout=cancelPreview)})}setTimeout(f.afterRender.bind(f,c),50);v&&a.appendChild(u?E:x);wrapRelativeDiv(a,!!e.value,!0)}if(f.IPType===GRAPHICS&&!biffdata.ifListingPage()&&(x=l.offsetWidth,p=a.offsetWidth,m=n?b:m,q&&m&&m.firstChild&&(0<g.length?(m.firstChild.style.display="none",m.style.background="none",m.style.border="none"):n?(m.firstChild.style.display=null,m.style.background=null,m.style.border=null):biffdata.ifSubtableBiff(e)&&biffdata.findSubtableDataBiffs(e.domainId,e.getSubtable()).every(function(a){return""===
a.value})&&(m.firstChild.style.display=null,m.style.background=null,m.style.border=null)),0<g.length))if(q&&n)if(b=b.offsetWidth-b.clientLeft,l.style.marginLeft=0,d)if(e.hasAttribute("styleVtextAlign"))switch(e.attr.styleVtextAlign){case "left":l.style.left=-b+"px";break;case "center":l.style.left=(b+p-x)/2-b+"px";break;case "right":l.style.right=0,l.style.left=null}else l.style.left=-b+"px";else l.style.marginLeft=-b+"px";else if(d&&e.hasAttribute("styleVtextAlign"))switch(e.attr.styleVtextAlign){case "left":l.style.left=
0;break;case "center":l.style.left=(p-x)/2+"px";break;case "right":l.style.right=0,l.style.left=null}mode===BUILDER||a.dataset.hasDragListener||(a.addEventListener("dragenter",dragFileIn,!0),a.addEventListener("dragover",dragFileIn,!0),a.addEventListener("dragleave",dragFileOut,!0),a.addEventListener("drop",dropFile.bind(f),!0),a.dataset.hasDragListener="true")}};
Uploader.prototype.renderMultiFiles=function(a,b,c,d,e,f){var g=c.fileName,k=c.iconName;c=c.icon;var l=node("div",!1),m=node("i",!1,"fal fa-times closeIcon"),n=this.biff;f?(l.style.display="inline-flex",m.className="fal fa-times singleClose"):l.classList.add("uploadedMultiFile");l.style.position="relative";l.style.paddingLeft="5px";l.dataset.value=a;l.dataset.index=b;b=node("a");b.href="javascript:void(0)";n.hasAttribute("officeFilePreviewOnly")&&isOfficeFile(a)&&(b.style.textDecoration="none");n.hasAttribute("pdfFilePreviewOnly")&&
isPDFFile(a)&&(b.style.textDecoration="none");n.hasAttribute("fileOverflow")?b.style.overflow="auto":(b.style.overflow="hidden",b.style.whiteSpace="nowrap",b.style.textOverflow="ellipsis");b.title=g;b.addEventListener("mousedown",function(b){if(ifRightClick(b))return!1;downloadFile(n,a,d)});b.addEventListener("touchstart",function(b){1===b.touches.length&&(downloadFile(n,a,d),cancelEventBubble(b))});f=function(a,b,c){deleteFile(a,b);cancelEventBubble(c)};m.addEventListener("mousedown",f.bind(null,
l,n));m.addEventListener("touchstart",f.bind(null,l,n));c&&""!==k&&l.appendChild(c);b.appendChild(text(g));l.appendChild(b);canSaveData()&&!this.readOnly&&checkIfUserCanEdit(!0)&&l.appendChild(m);e.appendChild(l);return e};
Uploader.prototype.afterRender=function(a){canSaveData()&&nui._updateFocus();var b=this.biff;a||(""!==b.value&&b.hasAttribute("imgfit")&&biffdata.imgFitBiffsRenderAgain.add(b),biffdata.imgFitBiffsRenderAgain.forEach(function(a){if(a.x!==b.x&&a.y===b.y&&""!==a.value){var c=a.ip.cell,e=c.querySelector("img");e&&2<Math.abs(e.offsetHeight-c.offsetHeight)&&a.ip.render(!1,!1,!0)}}))};
function dragFileIn(a){cancelEventBubble(a);this===nui.focus?(nui.focus.style.border="2px dashed #F47C7C",nui.focus.style.backgroundColor="rgba(255,192,194,0.53)",nui.focusDot.style.backgroundColor="#F47C7C"):(this.style.outline="2px dashed #F47C7C",this.style.backgroundColor="rgba(255,192,194,0.53)")}
function dragFileOut(a){cancelEventBubble(a);this===nui.focus?(nui.focus.style.border="",nui.focus.style.backgroundColor="",nui.focusDot.style.backgroundColor=""):(this.style.outline="",this.style.backgroundColor="")}
function dropFile(a){cancelEventBubble(a);if(!this.readOnly){canSaveData()||modeUpdate();var b=a.currentTarget===nui.focus?nui._curcell().id.split("_"):this.cell.id.split("_");nui._focus(b[1],b[2],!1,!1);a=a.dataTransfer;b=a.files;var c=this,d=nui.focus,e=nui.focusDot,f=c.cell;f.style.outline="";f.style.backgroundColor="";d.style.outline="";d.style.backgroundColor="";e.style.backgroundColor="black";if(ctrl.isIE)c.loadValues(b);else{var g=function(a){try{return new Promise(function(b,c){return a.file(b,
c)})}catch(q){console.log(q)}};d=[];var k=[];e=!1;f={};for(var l=0;l<a.items.length;f={$jscomp$loop$prop$directoryReader$629:f.$jscomp$loop$prop$directoryReader$629},l++){var m=a.items[l].webkitGetAsEntry();if(m)if(m.isDirectory)e=!0,f.$jscomp$loop$prop$directoryReader$629=m.createReader(),d.push(new Promise(function(a){return function(b,c){a.$jscomp$loop$prop$directoryReader$629.readEntries(function(a){a.forEach(function(a){k.push(g(a))});b()})}}(f)));else{c.loadValues(b);break}}e&&Promise.all(d).then(function(){Promise.all(k).then(function(a){c.loadValues(a)})})}}}
function downloadFile(a,b,c){if(b&&0!==b.length)if(a.hasAttribute("officeFilePreviewOnly")&&isOfficeFile(b)||a.hasAttribute("pdfFilePreviewOnly")&&isPDFFile(b))floatWin(null,lm.tt_disableDownloadAll,null);else{setTimeout(endMultiSelect,50);if(!c){a=b.toLowerCase().split(".");var d="";1<a.length&&(d=a[a.length-1]);"pdf htm html gif jpg jpeg png bmp tiff".split(" ").includes(d)&&(c=!0)}c?window.open(getFileDownloadURL(b),"_blank"):window.location=getFileDownloadURL(b,!0)}}
function downloadAllFiles(a){function b(a){return new Promise(function(b,c){fetch(a).then(function(a){return a.arrayBuffer()}).then(function(a){b(a)})})}if(ifRightClick(event))return!1;var c=a.value.split("|"),d=biffdata.findHeaderFromBiff(a).displayValue,e;c=c.filter(function(b){return!(a.hasAttribute("officeFilePreviewOnly")&&isOfficeFile(b))&&!(a.hasAttribute("pdfFilePreviewOnly")&&isPDFFile(b))});if(e=c.length)if(1===e)window.location=getFileDownloadURL(c[0],!0);else{c=c.map(function(a){return getFileDownloadURL(a)});
var f=$("floatingDownloadAll");ctrl.downloadingFiles.set(a,e);f.style.opacity="1";f.style.bottom="50px";$("floatingWinDownloadAllOuterContent").innerHTML="";ctrl.downloadingFiles.forEach(function(a,b,c){c=biffdata.findHeaderFromBiff(b).displayValue;$("floatingWinDownloadAllOuterContent").innerHTML+='<div id="dlAll'+b.domainId+'" style="display:flex" >\n            <div class="dlAllStatus">\n                <img src=\'/sims/img/working.gif\' style="width: 15px; height: 15px;" />\n            </div>\n            <div class="downloadAllContent" style="padding:10px;">\n'+
getBundleString("downloadingAll",[c,a])+"            </div>\n        </div>"});(function(c){var g=new JSZip,l=[],m=[];c.forEach(function(a){var c=b(a).then(function(b){for(var c=decodeURIComponent(a.substring(a.lastIndexOf("&f=")+3)).split("@")[1],d=1,e=c.substring(0,c.lastIndexOf(".")),f=c.substring(c.lastIndexOf("."));m.includes(c);)c=e+"("+d++ +")"+f;m.push(c);g.file(c,b,{binary:!0})});l.push(c)});Promise.all(l).then(function(){g.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:1}}).then(function(b){saveAs(b,
d+".zip");b=$("dlAll"+a.domainId);b.querySelector(".dlAllStatus").innerHTML="<i class='fa fa-check' style='color:#29c529'></i>";b.querySelector(".downloadAllContent").innerHTML=getBundleString("downloadingAllFinish",[d,e]);ctrl.downloadingFiles.delete(a);setTimeout(function(){0===ctrl.downloadingFiles.size&&(f.style.opacity="0",f.style.bottom="-1000px")},2E3)})})})(c);cancelEventBubble(event)}}Uploader.prototype.clear=function(){this.loadValue("")};
function createUploadInputElement(a,b,c){var d=a.value,e=a.nodeId+"",f=a.hasAttribute("multipleImages")||a.hasAttribute("multipleFiles"),g=a.hasAttribute("l")||a.hasAttribute("f");f&&a.ip&&(a.ip.nuiName=b);var k=b.replace("L","U"),l="",m=""===d,n=d.splitIgnoreEmpty("|");e=e.splitIgnoreEmpty("|");var q=n.length;1<q&&!f&&!b.includes("L")&&(b=b.split("_"),b=["L",b[1],b[4],b[2],b[5]].join("_"),k=b.replace("L","U"),f=!0);d=n.filter(function(a){return a}).join("|");if(f){l='<div id="IX'+a.x+"Y"+a.y+'"'+
(g?"class='loadValueFromOther'":"")+'><input  aria-hidden="true"aria-label="do not use"aria-readonly="true" type="file" style=\'display:none;\' '+(c?'accept="image/*"':"")+'onchange="nui._getcell('+a.x+","+a.y+').ip.loadValues(this.files, false, event);" /><input type="hidden" id="P_clear_X'+a.x+"Y"+a.y+'" name="P_clear_'+b+'" value="'+(m?1:"")+'" />';l+='<div class="input">';c=a.displayValue!==a.value;g=a.hasAttribute("l");for(d=0;d<q;d++)m=(n[d].startsWith("RAGIC_ATINSZ8_")?"":"RAGIC_ATINSZ8_")+
n[d],f=g&&c||!e[d]||0>e[d]?m:e[d],m=""===f,l+='<input id="IX'+a.x+"Y"+a.y+"_file"+d+'" type="checkbox" name="'+b+"\" style='display:none;' "+(m?"":' value="'+f+'"')+"checked />";l=l+'</div><input type="checkbox" name="'+(k+'" style="display:none;" checked  aria-hidden="true"aria-label="do not use"aria-readonly="true" /></div>')}else g&&(l='<div id="IX'+a.x+"Y"+a.y+'" class="loadValueFromOther">'),l+='<input type="'+(m?"file":"hidden")+'" id="IX'+a.x+"Y"+a.y+(g?"_file":"")+'" name="'+b+"\" style='display:none;' "+
(c?'accept="image/*"':"")+'onchange="nui._getcell('+a.x+","+a.y+").ip.loadValue((this.files[0] instanceof File ? this.files[0].name : ''), false, event);\" "+(m?"":' value="'+d+'"')+'  aria-hidden="true"aria-label="do not use"aria-readonly="true" /><input type="hidden" id="P_clear_X'+a.x+"Y"+a.y+'" name="P_clear_'+b+'" value="'+(m?1:"")+'" aria-hidden="true"aria-label="do not use"aria-readonly="true"  />',g&&(l+="</div>");return l}
Uploader.prototype.createUploadXHR=function(){function a(){c.currentUploadXhr=null;document.body.contains(e)&&document.body.removeChild(e);nui.main.addEventListener("scroll",b,{passive:!0})}function b(){l=c.cell.getBoundingClientRect();var a=nui.main.getBoundingClientRect();l.top>a.top&&l.bottom<a.bottom&&l.left>a.left&&l.right<a.right?(e.style.top=l.top+"px",e.style.left=l.left+"px",e.style.display=""):e.style.display="none"}var c=this,d=new XMLHttpRequest,e=node("div"),f=node("div"),g=node("progress"),
k=node("div"),l=c.cell.getBoundingClientRect(),m=c.cell.offsetWidth,n=c.cell.offsetHeight;c.calcelUpload=!1;d.addEventListener("loadstart",function(){g.max=1;g.min=0;g.value=0;g.classList.add("uploadProgress");k.classList.add("uploadProgressClose");k.textContent="X";k.onclick=function(){c.calcelUpload=!0;d.abort()};f.classList.add("uploadElemInnerDiv");f.appendChild(g);f.appendChild(k);e.appendChild(f);e.classList.add("uploadElemDiv");e.style.cssText="width:"+m+"px;height:"+n+"px;top:"+l.top+"px;left:"+
l.left+"px;";document.body.appendChild(e);nui.main.addEventListener("scroll",b,{passive:!0})},!1);d.upload.addEventListener("progress",function(a){a.lengthComputable&&(g.value=a.loaded/a.total)},!1);d.addEventListener("load",function(){a();autoSaveInterval()},!1);d.addEventListener("error",function(){a();floatWin(null,"Upload Failure:"+c.biff.value);c.value=c.oldValue;c.biff.value=c.biff.oldValue;c.render()},!1);d.addEventListener("abort",function(){a();c.value=c.oldValue;c.biff.value=c.biff.oldValue;
c.render();var b=$("IX"+c.biff.x+"Y"+c.biff.y),d=b.cloneNode(!0);b.parentNode.replaceChild(d,b);"DIV"!==d.tagName||d.classList.contains("floatingWin")?"INPUT"===d.tagName&&(d.value=""):(b=d.querySelector("input[type=file]"),b.value="")},!1);return d};Uploader.prototype.validate=function(){return this.biff?this.biff.hasAttribute("must")&&0===this.biff.value.length?"Empty":"":""};
Uploader.prototype.setReadonly=function(a){this.readOnly=a;this.cell.classList.toggle("read-only_cell",a);this.render(!1,!1,!1,!0);a&&biffdata&&(a=biffdata.updateCellIds.indexOf(this.cell.id),0<=a&&biffdata.updateCellIds.splice(a,1))};function MSelector(){this.type=MSELECTOR;this.userInput="";this.typing=!1;this.typingValueList=[];this.typingNodeList=[]}MSelector.prototype._setHinSize=function(a,b){};
MSelector.prototype.enterTypingMode=function(){var a=this.cell.querySelector(".msTypingTextarea");if(a){if(this.biff.hasAttribute("mvp")&&this.biff.attr.mvpf){this.mvpListLoad(this);var b=$("IX"+this.biff.x+"Y"+this.biff.y);b.removeChild(b.querySelector("table"));var c=this.getSelectList().listMulti(this);b.appendChild(c.querySelector("table"))}this.msWidth=b=measureMsTypingTextarea(this);this.typing=!0;a.style.width=20<b?b+"px":"100%";a.style.display="";nui._updateFocus(void 0,void 0,void 0,void 0,
!0);this.initTypingList(!0);b=$("hin");c=a.getBoundingClientRect();b.style.width=a.offsetWidth;b.style.top=c.top+"px";b.style.left=c.left+"px";b.style.overflow="hidden";b.setValue("");hinFocus()}};
MSelector.prototype.refreshTypingTextarea=function(){var a=$("hin"),b=a.value,c=$("msCalSpan"),d=this.cell.querySelector(".msTypingTextarea");c.textContent=b;b=c.offsetWidth;this.msWidth||(this.msWidth=measureMsTypingTextarea(this));b>this.msWidth-2&&(d.style.width="100%",d.style.display="",b=d.getBoundingClientRect(),this.cell.querySelector(".faicon")&&(a.style.width=d.offsetWidth-this.cell.querySelector(".faicon").offsetWidth),a.style.top=b.top,a.style.left=b.left,nui._updateFocus(void 0,void 0,
void 0,void 0,!0))};function measureMsTypingTextarea(a){for(var b=a.cell.querySelectorAll(".selectedMultiOption"),c=$("focus").offsetWidth,d,e=b.length;0<e;e--){var f=b[e-1],g=f.offsetTop;f=f.offsetWidth;if(e!==b.length&&d!==g)break;else c=c-f-3;d=g}a.cell.querySelector(".faicon")&&(c-=a.cell.querySelector(".faicon").offsetWidth);return c-4-4-2}
MSelector.prototype.leaveTypingMode=function(){if(this.typing&&this.typingValueList){var a=this.typingNodeList,b=this.typingValueList.map(function(a){return a.replace(/[|]/g,"%7C")}).join("|");this.typing=!1;var c=$("IX"+this.biff.x+"Y"+this.biff.y);this.userInput="";a=a.join("|");this.biff.nodeId=a;this.biff.value=b;this.loadValue(b);this.render();canSaveData()&&nui._updateFocus();b=this.getSelectList().listMultiMatch("",this);c.replaceChild(b,c.querySelector(".selector"));c.style.display="none";
c=$("hin");c.setValue("");c.style.top="";c.style.left="";hinBlur();clearDropWin();if(c=this.cell.querySelector(".msTypingTextarea"))c.style.display="none"}};MSelector.prototype.removeOptionInMs=function(a,b){var c=this.cell.querySelector(".msContainer");if(c){var d=c.querySelectorAll(".selectedMultiOption");void 0===b&&(b=d.length-1);0<d.length&&(b=d[b],c.removeChild(b),a=a.querySelector(".multiSel[nodeid='"+b.dataset.nodeId+"']"))&&(a.ip=this,a.click())}};
MSelector.prototype.removeSelectedOption=function(a){var b=$("focus").cell,c=b.querySelector(".selectedMultiOption.chosen");if(c){var d=Array.from(b.querySelectorAll(".selectedMultiOption")),e=d.indexOf(c);this.typing?(this.handleTypingValue(c,!0),b.firstChild.removeChild(c)):this.removeOptionInMs(a,e);d=Array.from(b.querySelectorAll(".selectedMultiOption"));e<d.length&&d[e].classList.add("chosen")}else this.removeOptionInMs(a)};
MSelector.prototype.keyDown=function(a){if(this.readOnly)return!0;var b=a.key,c=a.altKey,d=a.ctrlKey,e=a.metaKey,f=$("IX"+this.biff.x+"Y"+this.biff.y),g=$("hin"),k=checkIfUserCanEdit(!0);switch(b){case "Backspace":if(biffdata.autoSave&&mode===BROWSE&&!k)break;this.typing?(this._backspace(1),g&&0===g.selectionStart&&0===g.selectionEnd&&this.removeSelectedOption(f)):(mode==BROWSE&&(modeUpdate(),$("focus").classList.add("pointNone")),this.removeSelectedOption(f));break;case "Delete":if(biffdata.autoSave&&
mode===BROWSE&&!k)break;this.removeSelectedOption(f);break;case "F12":case "Shift":case "F5":break;case "ArrowLeft":case "ArrowRight":case "Right":case "Left":if(this.typing&&mode===UPDATE)f=this.cell;else break;g=$("hin");if(f)var l=f.querySelector(".selectedMultiOption.chosen");if(l)if(g=Array.from(f.querySelectorAll(".selectedMultiOption")),f=g.indexOf(l),"ArrowLeft"===b||"Left"===b)f--,0<=f&&(l.classList.remove("chosen"),g[f].classList.add("chosen"));else{if("ArrowRight"===b||"Right"===b)f++,
f<g.length?(l.classList.remove("chosen"),g[f].classList.add("chosen")):f===g.length&&(l.classList.remove("chosen"),hinFocus(),a.preventDefault())}else"ArrowLeft"!==b&&"Left"!==b||0!==g.selectionStart||(g=Array.from(f.querySelectorAll(".selectedMultiOption")),g[g.length-1].classList.add("chosen"),f.querySelector(".selectedMultiOption.chosen"),hinBlur());return!1;case "ArrowDown":case "ArrowUp":if(!0===this.typing&&"none"!==f.style.display)return a=Array.from(f.querySelectorAll(".multiSel")),0<a.length&&
((l=f.querySelector(".multiSel.chosen"))?(f=a.indexOf(l),"ArrowDown"===b?f++:"ArrowUp"===b&&f--,f<a.length&&0<=f&&(l.classList.remove("chosen"),a[f].classList.add("chosen"))):a[0].classList.add("chosen")),!1;break;case "Enter":if(this.typing)return(l=f.querySelector(".multiSel.chosen"))&&(l.firstChild.checked?this.handleTypingValue(l,!0):this.handleTypingValue(l,!1)),this.maintainOrder=!0,this.leaveTypingMode(),!1;if(c)return!1;break;default:!ifTextInputKeycode(a)||a.keyCode===KEYCODE.F2&&biffdata.autoSave&&
mode===BROWSE&&!k||(this.typing?(c||d||e||hinFocus(),(l=this.cell.querySelector(".selectedMultiOption.chosen"))&&l.classList.remove("chosen")):this.enterTypingMode())}return!0};function getMatchInput(){var a=$("hin").value;if("\n"==a&&!nui._atHighRow())return"";if("\n"==a.charAt(0)&&!nui._atHighRow())return a&&0<a.length?a.substring(1):"";a||(a="");return a}
MSelector.prototype.initTypingList=function(a){!0===a?(this.typingValueList=this.maintainOrder?this.typingValueList:this.valueList.slice(),this.biff.nodeId&&(isNaN(this.biff.nodeId)?this.typingNodeList=this.biff.nodeId.split("|"):this.typingNodeList=this.biff.nodeId.toString().split("|"))):(this.valueList=[],this.typingValueList=[],this.typingNodeList=[])};
MSelector.prototype.keyUp=function(a){if(this.readOnly)return!1;if(mode==BROWSE&&!checkIfUserCanEdit())return!0;a=a.key;var b=getMatchInput();b&&0<b.length&&(this.typing||(this.enterTypingMode(),$("focus").classList.add("focusPointNone")),this.typing=!0);if(this.typing){this.refreshTypingTextarea();if("ArrowUp"===a||"ArrowDown"===a||"Enter"===a)return!0;this._debounceWrite(this,b)}return!0};MSelector.prototype._debounceWrite=debouncedFn(100,function(a,b){a._write(b)});
MSelector.prototype._write=function(a,b){var c=this.biff;if(canSaveData()&&!biffdata.ifListingPage()&&c&&c.ifCreateInsertRow()&&!b){shiftData(c.y,1);if(biffdata.ifSubtableDataBiff(c)){b=c.parentDomainId;var d;c.hasAttribute("cg")?isPlainObject(biffdata.subtableDataBiffs[b])&&(d=biffdata.subtableDataBiffs[b][c.attr.cg]):d=biffdata.subtableDataBiffs[b];if(Array.isArray(d)){b=0;for(var e=d.length;b<e;b++){var f=d[b];if(void 0===g||f.x<g)var g=f.x;if(void 0===k||f.x>k)var k=f.x;if(void 0!==l&&l<f.y)break;
var l=f.y}}}copyDataY(c.y,g,k);biffdata.expandSection(c.y,1);displayData()}c=this.getSelectList();c.processSelectorLocation(this);this.delayedListMatch(a,c)};
MSelector.prototype.delayedListMatch=function(a,b){var c=this.biff;c=$("IX"+c.x+"Y"+c.y);this.userInput=a;a=b.listMultiMatch(a,this);a.ip=this;b=$("IX"+this.biff.x+"Y"+this.biff.y);b.replaceChild(a,b.querySelector(".selector"));this.showList(b);this.biff&&this.biff.hasAttribute("usrref")&&(initAvatars(),checkAllGroupItemStatus(this,b,!0));c=Array.from(c.querySelectorAll(".multiSel"));0<c.length&&c[0].classList.add("chosen")};MSelector.prototype._renderNode=emptyFunction;
MSelector.prototype._renderFocus=emptyFunction;MSelector.prototype.blur=function(){if(canSaveData()&&this.typing)this.leaveTypingMode();else if(canSaveData()){var a=this.cell,b=a.querySelector(".selectedMultiOption.chosen");b&&b.classList.remove("chosen");if(a=a.querySelector(".msTypingTextarea"))a.style.display="none"}$("focus").classList.remove("pointNone","focusPointNone","firstFocus");clearDropWin();return!1};MSelector.prototype.onpaste=function(){this.readOnly||(this.enterTypingMode(),clearDropWin())};
MSelector.prototype.click=function(){this.render()};MSelector.prototype.dblclick=function(){this.readOnly||(this.enterTypingMode(),clearDropWin())};MSelector.prototype.focus=function(){canSaveData()&&$("focus").classList.add("focusPointNone","firstFocus");nui.focus.onclick=mselectorClick;nui.focus.ontouchstart=mselectorClick;this.lastFocusValue=this.value};MSelector.prototype.validate=function(a){a="";this.biff&&this.biff.hasAttribute("must")&&""==this.value&&(a+="Empty");return a};
MSelector.prototype.getSelectList=function(a){return selpro.getSelectList(this.domainId)};MSelector.prototype._backspace=function(a){var b=this.getSelectList();a?(this.userInput=this.userInput.substr(0,Math.max(0,this.userInput.length-a)),this.userInput||(this.userInput="")):this.userInput="";b.keyboardMode=!0};MSelector.prototype.getNUIFormValue=function(){for(var a=this.typingNodeList,b="",c=0;c<a.length;c++){var d=a[c];b&&(b+="|");b+=d}return b};
MSelector.prototype.getRawValue=function(){return this.maintainOrder?this.typingValueList:this.valueList};
MSelector.prototype.getValue=function(){var a=this.biff,b="",c=0,d="";a&&a.attr&&a.attr.sep_m?d=a.attr.sep_m:window.defaultMultiSelectSeparator&&(d=window.defaultMultiSelectSeparator);"line-break"===d&&(d="<br>");"space"===d&&(d=" ");"bubble"===d&&(d="");var e=selpro.getSelectList(a.domainId),f=this.maintainOrder?this.typingValueList:this.valueList;c=a.attr.styleVfontFamily;var g=a.attr.styleVfontSize;g=(c?";font-family:"+c:"")+(g?";font-size:"+g:"");var k=e.options;f.sort(function(a,b){return k.indexOf(a)-
k.indexOf(b)});var l=checkIfUserCanEdit(!0);if(a&&a.attr&&a.attr.ifReadInfo)for(c=0;c<f.length;c++){0<c&&(b+=d+(","===d?" ":""));var m=f[c],n=biffdata.getTask(m,biffdata.ifListingPage()?""+a.parentNodeId:null),q=e.nodeIds[e.options.indexOf(m)];0>q&&!a.hasAttribute("mvp")&&(q="RAGIC_ATINSZ8_"+m);b+='<div style="'+g+'" class="selectedMultiOption" data-value="'+m+'" data-node-id="'+q+'">';b=n&&"F"==n.s?b+('<a href="javascript:void(0);" style="color:inherit;" onmouseenter="tooltipTiny(this,\'<div class=centerLabel style=color:#888;>'+
lm.notified+"</div> "+n.cd+"<br><div class=centerLabel style=color:#0C0;>"+lm.read+"</div> "+n.fd+'\');" onmouseleave="hideTinyTooltip();">'+m+'<i style="margin:0 0 0 2px;color:#0a0;font-size:13px;" class="fa fa-check"></i></a>'):n&&"P"==n.s&&n.cd?b+('<a href="javascript:void(0);" style="color:inherit;" onmouseenter="tooltipTiny(this,\'<div class=centerLabel style=color:#888;>'+lm.notified+"</div> "+n.cd+"<br><div class=centerLabel style=color:#c00;>"+lm.unread+'</div>\');" onmouseleave="hideTinyTooltip();">'+
m+'<i style="margin:0 0 0 2px;color:#ccc;font-size:13px;" class="fa fa-check"></i></a>'):b+('<a href="javascript:void(0);" style="color:inherit;">'+m+"</a>");canSaveData()&&!this.readOnly&&l&&(b+='<i class="fal fa-times closeIcon" ontouchstart="mselectorSelectedMultiOptionClick(this.parentNode, true)"></i>');b+="</div>"}else for(c=0;c<f.length;c++){0<c&&(b+=d+(","===d?" ":""));m=f[c].replace(/%7C/g,"|");q=e.nodeIds[e.options.indexOf(m)];0>q&&!a.hasAttribute("mvp")&&(q="RAGIC_ATINSZ8_"+m);n=m;n=e.newUrl;
if(!n&&a.attr&&a.attr.mvp){var r=a.attr.mvp;r&&(n=r.split("|")[0],r=r.split("|")[1].split("_")[0],n=ap+n+"/"+r)}r=biffdata.ifListingPage()||"true"==window.userProperties.fpHoverDisabled;var p=a.attr&&(a.attr.usrref||a.attr.grpref);n=n&&!p?'<a href="javascript:void(0);" style="'+("false"!=window.userProperties.showLinkNLoadAsLink?"":"color:#333")+'" onmousedown="if(mode!=BROWSE){return;}event.stopPropagation();"'+(("false"!=window.userProperties.showLinkNLoadAsLink?" onclick=\"showFpClick('"+n+"',"+
q+');"':"")+(r?"":" onmouseover=\"showFp(event,'"+n+"',"+q+');" onmouseout="resetShowFp(event)"'))+' onclick="if(mode==BROWSE && !ifRightClick(event)){browseForward();}">'+m+"</a>":'<a href="javascript:void(0);" style="color:inherit;">'+m+"</a>";""===d?(b+='<div style="'+g+'" class="selectedMultiOption" data-value="'+m+'" data-node-id="'+q+'">',b+=n,canSaveData()&&!this.readOnly&&l&&(b+='<i class="fal fa-times closeIcon" ontouchstart="mselectorSelectedMultiOptionClick(this.parentNode, true)"></i>'),
b+="</div>"):b+='<a href="javascript:void(0);" style="color:inherit;">'+m+"</a>"}this.readOnly||(b+='<textarea aria-hidden="true"  cols="1" rows="1" style="display:none" class="msTypingTextarea"></textarea>');return b};
MSelector.prototype.loadValue=function(a,b,c,d,e,f){c=this.biff;var g=selpro.getSelectList(c.domainId);a=a.toString().replace(/</g,"&#60;").replace(/>/g,"&#62;");var k=!1;this.value!==a&&(b?c.hasAttribute("dv")&&!c.attr.dv.startsWith("#")&&processLastEditDefaultValue(b,c):(RagicInteractiveRules.execute(!1,c),f||(k=mode!==BUILDER&&biffdata.ifSubtableDataBiff(c)&&(""===a||""===this.value),processLastEditDefaultValue(b,c))));if(mvpMode&&biffdata&&0===g.nodeIds.length)for(f=0;f<biffdata.selections.length;f++){var l=
biffdata.selections[f];if(l[1]===""+c.domainId)for(var m=2;m<l.length;m++){var n=l[m],q=l[m].indexOf("|");-1<q&&(g.nodeIds.push(n.substring(0,q)),g.options.push(n.substring(q+1)))}}if(c.nodeId&&c.value)for(l=(""+c.nodeId).split("|"),m=c.value.split("|"),c.hasAttribute("usrref")&&l.length!==m.length&&(m=c.value.split(",")),f=0;f<l.length;f++)n=l[f],q=m[f],g&&g.nodeIds&&0<=n&&-1==g.nodeIds.indexOf(n)&&(g.nodeIds.push(n),g.options.push(q));var r;if(c.attr&&c.attr.usrref){b||""!==a?c.nodeId&&(isNaN(c.nodeId)?
r=c.nodeId.split("|"):0<=c.nodeId&&(r=c.nodeId.toString().split("|"))):r=[];r||!canSaveData()||!c.attr.dv||b&&!biffdata.ifListingPage()&&biffdata.ifSubtableDataBiff(c)||(f=c.attr.dv,f=encHTMLTag(f),"$USER"===f||"$USERNAME"===f?(r=window.userNodeId.toString().split("|"),this.nodeId=window.userNodeId.toString()):"$GROUP"!==f&&f&&(l=f.split("|").map(function(a){return a.replace(/%7C/g,"|")}),r=[],l.forEach(function(a){a=g.nodeIds[indexOf(decHTML(a),g.options)];0<=Number(a)&&r.push(a)})));d&&(r=[],l=
a.split("|").map(function(a){return a.replace(/%7C/g,"|")}),l.forEach(function(a){a=g.nodeIds[indexOf(a,g.options)];0<=Number(a)&&r.push(a)}));d=[];this.nodeId=this.value="";for(f=0;f<g.nodeIds.length;f++)-1!=indexOf(g.nodeIds[f],r)&&(this.value&&0<this.value.length&&(this.value+=","),this.value+=g.options[f],this.nodeId&&0<this.nodeId.length&&(this.nodeId+="|"),this.nodeId+=g.nodeIds[f],d.push(g.options[f]));c.value=this.value;c.nodeId=this.nodeId;this.valueList_v2=d}else{var p=[],t=a;if(b&&this.biff&&
this.biff.nodeId&&"string"==typeof this.biff.nodeId){d=this.biff.nodeId.split("|");var v=this.getSelectList();t="";d.forEach(function(b){b=v.nodeIds.indexOf(b);-1<b&&(0<a.length&&(t+="|"),p.push(v.options[b]),t+=v.options[b].replace(/[|]/g,"%7C"))})}this.valueList_v2=p;this.value=a;if(c.attr&&c.attr.dv&&(!c.nodeId||0>c.nodeId||c.nodeId.startsWith("-"))&&canSaveData())if(this.value=this.nodeId="",""!==a){l=encHTMLTag(c.attr.dv).split("|").map(function(a){return a.replace(/%7C/g,"|")});for(f=0;f<l.length;f++)d=
indexOf(decHTML(l[f]),g.options),-1!=d&&(0<this.nodeId.length&&(this.nodeId+="|",this.value+="|"),0<=g.nodeIds[d]?this.nodeId+=g.nodeIds[d]:(m=g.options[d].replace(/[|]/g,"%7C"),this.nodeId+="RAGIC_ATINSZ8_"+m),this.value+=g.options[d].replace(/[|]/g,"%7C"));c.value=this.value;c.nodeId=this.nodeId}else c.value=this.value="",c.nodeId=this.nodeId="";else!b&&canSaveData()&&""===a&&(c.value=this.value="",c.nodeId=this.nodeId="")}var u=!1;b||(ctrl.pauseSubtableExtend||e||subTableExtendProcess(this.value,
c,function(){u=!0}),k&&checkEmptySubtableRows(c),c.value&&-1!==c.value.search(/[|]/g)||updateSameSubtableRowBiffsFormulaEngine(c));this.valueList=c.attr&&c.attr.usrref?b&&this.valueList_v2&&0<this.valueList_v2.length?this.valueList_v2:sortValueList(this.value.toString().splitIgnoreEmpty(","),g):b&&this.valueList_v2&&0<this.valueList_v2.length?this.valueList_v2:sortValueList(this.value.toString().splitIgnoreEmpty("|"),g);this.maintainOrder&&(this.typingValueList=this.valueList);!b&&biffdata.autoSave&&
autoSaveInterval(1E3);mode!==BUILDER&&(e="",k=c.value,c.hasAttribute("sep_m")?e=c.attr.sep_m+(","===c.attr.sep_m?" ":""):window.defaultMultiSelectSeparator&&(e=window.defaultMultiSelectSeparator),c.value=c.value.replace(/[|]/g,"line-break"===e?"<br>":"space"===e?" ":"bubble"===e?"":e),this.updateFormulaEngine(b),c.value=k);b&&this.initTypingList(!0);return u};
MSelector.prototype.updateFormulaEngine=function(a,b){var c=this.biff;try{if(resetFormulaObject(c),!a){var d=getCellNameFromDataCache(c);d&&(formulaBuilder.update(d,c,b),updateFieldDescriptionFormulas())}}catch(e){processJSExceptionObj(e)}};function sortValueList(a,b){b=b.options;for(var c=[],d=0;d<b.length;d++){var e=a.indexOf(b[d]);-1!=e&&(a[e]=null,c.push(b[d]))}for(d=0;d<a.length;d++)a[d]&&c.push(a[d]);return c}
MSelector.prototype.showList=function(a){var b=this.cell,c=a.querySelector(".selector");a.style.display="";this.selectList.processSelectorLocation(this);a.style.height="";var d=a.offsetHeight;a.style.width=Math.max(b.offsetWidth,c.offsetWidth)+"px";b=b.getBoundingClientRect();var e=document.body.clientHeight-b.bottom,f=$("v5SidebarTD").getBoundingClientRect();b.top>e&&e<d?(d=b.top<d?b.top-3:d,a.style.height=d+"px",a.style.top=b.top-d+"px"):(a.style.height=(e<d?e-5:d)+"px",a.style.top=b.bottom+"px");
a.style.left=(f.right<b.left?b.left:f.right)+"px";c.style.width=a.style.width;floatingPanels.push(a);ctrl.dropWin=!0};MSelector.prototype.render=function(a,b){a=this.biff;var c=mode!==BUILDER?biffdata:builder;a&&!c.ifRenderRow(a.y)||this.drawCell();this.listdiv&&!b||!canSaveData()&&biffdata.ifListingPage()||this.renderDropdown()};
MSelector.prototype.renderDropdown=function(){var a=this.biff;this.selectList=selpro.getSelectList(this.domainId);if(this.listdiv=this.selectList.listMulti(this)){this.listdiv.firstChild.ip=this;var b=$("IX"+a.x+"Y"+a.y);b&&$("nuiform").removeChild(b);this.listdiv.id="IX"+a.x+"Y"+a.y;$("nuiform").appendChild(this.listdiv);this.listdiv.style.display="none";a&&a.attr&&a.hasAttribute("usrref")&&checkAllGroupItemStatus(this,this.listdiv,!0)}};
MSelector.prototype.drawCell=function(){var a=this.cell,b=this.biff;if(!(b&&b.attr&&b.attr.hide)){rm(a);this.readOnly&&a.classList.add("read-only_cell");if(ctrl.isIE)if(a.colSpan){b=0;var c;for(c=0;c<a.colSpan;c++)this.biff.x<columnSizes.length&&(b+=columnSizes[this.biff.x]);a.style.width=b+"px"}else this.biff.x<columnSizes.length&&(a.style.width=columnSizes[this.biff.x]);b=node("div");b.innerHTML=this.getValue();b.classList.add("msContainer");b.style.overflow="hidden";b.style["min-width"]="95px";
b.style["min-height"]=this.cell.offsetHeight-3+"px";0==b.innerHTML.length&&(b.innerHTML="&nbsp;");c=biffdata.ifListingPage();var d=canSaveData();biffdata&&!this.readOnly&&(c&&d||!c)&&(c=node("i"),c.className="fa "+(this.biff.attr.usrref?"fa-user":this.biff.attr.grpref?"fa-users":"fa-caret-down")+" fa-fw faicon",c.cell=a,c.onclick=mselectorClick,c.addEventListener("touchstart",mselectorClick),this.arrow=c,b.appendChild(c));this.cell.appendChild(b);this.biff.hasAttribute("nowrap")&&(this.cell.style.whiteSpace=
"nowrap")}};MSelector.prototype.setReadonly=function(a){this.readOnly=a;this.cell.classList.toggle("read-only_cell",a);this.render();a&&biffdata&&(a=biffdata.updateCellIds.indexOf(this.cell.id),0<=a&&biffdata.updateCellIds.splice(a,1))};
function listGroupInfo(a,b,c){var d=null!==c&&void 0!==c;if(d&&""!==c)b.classList.add("showGroupInfo");else{a=node("div");a.nowrap=!0;a.classList.add("multiSel","groupsTitle");var e=node("span");e.appendChild(document.createTextNode(lm.multiUserFieldChooseGroup));a.appendChild(e);b.appendChild(a)}biffdata.groupsInfo&&biffdata.groupsInfo.forEach(function(a){if(0!==a.users.length){var e=node("div");e.nowrap=!0;e.classList.add("multiSel","groupInfo");e.setAttribute("value",a.group);e.setAttribute("nodeIds",
a.userNodeIds.join("|"));e.setAttribute("userNames",a.userNames.map(function(a){return a.replace(/[|]/g,"%7C")}).join("|"));var f=node("input");f.type="checkbox";f.style["vertical-align"]="middle";f.style.margin="3px 5px 0 0";f.onclick=function(){return!1};e.appendChild(f);f=node("span");var l=node("div");l.style.margin="2px 5px 0px 2px";l.style.width="20px";l.style.height="20px";l.style.background="#808080";l.classList.add("avatar","optionAvatar");var m=node("i");m.classList.add("fa","fa-users",
"groupsInfoIcon");l.appendChild(m);f.appendChild(l);e.appendChild(f);if(d&&""!==c){l=a.group;var n=l.toUpperCase().indexOf(c.toUpperCase());-1<n&&(a=node("span"),a.style.position="relative",a.style.top="2px",m=l.substr(n,c.length),f=l.substr(0,n),n=l.substr(n+c.length),l=node("SPAN"),m=document.createTextNode(m),f=document.createTextNode(f),n=document.createTextNode(n),l.style["font-weight"]="700",l&&l.appendChild(m),a.appendChild(f),a.appendChild(l),a.appendChild(n),e.appendChild(a),b.appendChild(e))}else a=
document.createTextNode(a.group),f=node("span"),f.style.position="relative",f.style.top="2px",f.appendChild(a),e.appendChild(f),b.appendChild(e)}})}
SelectList.prototype.listMultiMatch=function(a,b){a=a.toString();a=a.replace(/</gim,"&#60;").replace(/>/gim,"&#62;");var c=b.domainId,d=b.parentDomainId,e=b.parentNodeId,f=b.biff.originalNodeId;b.userInput=a;var g=node("table");g.classList.add("selector");var k=g.insertRow(0),l=b.typingNodeList;f=f.toString().split("|");var m="L_"+createControlBitString(b.biff)+"_"+d+"_"+c+"_"+e;c="U_"+createControlBitString(b.biff)+"_"+d+"_"+c+"_"+e;this.itemCount=0;if(b.biff&&b.biff.attr&&b.biff.hasAttribute("usrref")){if(!n){var n=
k.insertCell(k.cells.length);n.style.verticalAlign="top"}listGroupInfo(b,n,a)}for(d=0;d<this.options.length;d++)if(this.options[d]&&this.nodeIds[d]){n||(n=k.insertCell(k.cells.length),n.style.verticalAlign="top");e=this.options[d];var q=e.toUpperCase().indexOf(a.toUpperCase());if(0<=q&&(0===q||" "===e.charAt(q-1)||ifChinese(e.charAt(q-1))||ifChinese(e.charAt(q)))||""===a){var r=this.nodeIds[d],p=r;0>r&&(r="RAGIC_ATINSZ8_"+this.options[d]);var t=-1!=indexOf(r,l),v=-1!=indexOf(p,f),u=(p=b.biff)&&p.attr&&
p.attr.usrref?p.attr.usrref:null,x=!0;b.nodeIds&&p.hasAttribute("mvp")&&(b.nodeIds.includes(r)||(x=!1));var E=node("div");E.nowrap=!0;E.className="multiSel";E.setAttribute("value",e);x||(E.style.display="none");0<=r?(E.setAttribute("nodeId",this.nodeIds[d]),E.innerHTML='<input style="margin:0 5px 0 0;" type=checkbox name="'+m+'" value="'+this.nodeIds[d]+'" '+(t?'checked="checked"':"")+"  />"):(E.setAttribute("nodeId","RAGIC_ATINSZ8_"+e),E.innerHTML='<input style="margin:0 5px 0 0;" type=checkbox name="'+
m+'" '+(t?'checked="checked"':"")+"  />",E.firstChild.value="RAGIC_ATINSZ8_"+e);r=node("span");q=""===a?e:e.substr(0,q)+'<span style="font-weight:700;">'+e.substr(q,a.length)+"</span>"+e.substring(q+a.length,e.length);r.innerHTML=(u?"<div class='avatar optionAvatar' style='margin:2px 5px 0 2px;width:20px;height:20px;'>"+getAvatarHTMLByNodeId(this.nodeIds[d],e.toString().replace(/&#60;/g,"<").replace(/&#62;/g,">"))+"</div>":"")+"<span style='position: relative;top:2px;'>"+q+"</span>";E.appendChild(r);
e=node("div");e.style.display="none";e.innerHTML='<input type="checkbox" aria-hidden="true" name="'+c+'" value="'+this.nodeIds[d]+'" '+(v?'checked="checked"':"")+"/>";E.appendChild(e);n.appendChild(E);this.itemCount++}}p&&p.attr&&p.attr.userOps&&!p.attr.mvp&&allowOptionAdded(k,n);return g};
SelectList.prototype.listMulti=function(a,b){if(!mvpMode){var c=a.biff,d=a.domainId,e=c.parentDomainId,f=c.parentNodeId,g=a.nodeId,k=c.originalNodeId,l=node("div");l.className="outerSelector";var m=node("table");m.className="selector";l.appendChild(m);m=m.insertRow(0);b=b?a.typingNodeList:g.toString().splitIgnoreEmpty("|");k=k.toString().split("|");g="L_"+createControlBitString(a.biff)+"_"+e+"_"+d+"_"+f;d="U_"+createControlBitString(a.biff)+"_"+e+"_"+d+"_"+f;e=a.biff.value.split("|");f=!1;for(var n=
0;n<b.length;n++)0<=b[n]&&-1==indexOf(b[n],this.nodeIds)&&(this.options.push(e[n]),this.nodeIds.push(b[n]),f=!0);f&&a.drawCell();this.itemCount=0;if(c&&c.attr&&c.hasAttribute("usrref")){if(!q){var q=m.insertCell(m.cells.length);q.style.verticalAlign="top"}listGroupInfo(a,q)}for(e=0;e<this.options.length;e++)if(this.options[e]&&this.nodeIds[e]){q||(q=m.insertCell(m.cells.length),q.style.verticalAlign="top");f=this.options[e];var r=this.nodeIds[e];n=r;0>r&&(r="RAGIC_ATINSZ8_"+this.options[e]);var p=
-1!=indexOf(r,b);n=-1!=indexOf(n,k);var t=a.biff,v=t&&t.hasAttribute("usrref")?t.attr.usrref:null,u=!0;a.nodeIds&&t.hasAttribute("mvp")&&(a.nodeIds.includes(r)||(u=!1));t=node("div");t.nowrap=!0;t.className="multiSel";t.setAttribute("value",f);u||(t.style.display="none");0<=r?(t.setAttribute("nodeId",this.nodeIds[e]),t.innerHTML='<input aria-hidden="true" aria-label="do not use" aria-readonly="true" style="vertical-align:middle;margin:3px 5px 0 0;" type=checkbox name="'+g+'" value="'+this.nodeIds[e]+
'" '+(p?'checked="checked"':"")+"  />"):(t.setAttribute("nodeId","RAGIC_ATINSZ8_"+f),t.innerHTML='<input aria-hidden="true" aria-label="do not use" aria-readonly="true" style="vertical-align:middle;margin:3px 5px 0 0;" type=checkbox name="'+g+'" '+(p?'checked="checked"':"")+"  />",t.firstChild.value="RAGIC_ATINSZ8_"+f);r=node("span");r.innerHTML=(v?"<div class='avatar optionAvatar' style='margin:2px 5px 0 2px;width:20px;height:20px;'>"+getAvatarHTMLByNodeId(this.nodeIds[e],f.toString().replace(/&#60;/g,
"<").replace(/&#62;/g,">"))+"</div>":"")+"<span style='position: relative;top:2px;'>"+f+"</span>";t.appendChild(r);f=node("div");f.style.display="none";f.innerHTML='<input aria-hidden="true" aria-label="do not use" aria-readonly="true" type="checkbox" name="'+d+'" value="'+this.nodeIds[e]+'" '+(n?'checked="checked"':"")+"/>";t.appendChild(f);q.appendChild(t);this.itemCount++}c&&c.attr&&c.attr.userOps&&!c.attr.mvp?allowOptionAdded(m,q):0==this.itemCount&&(q=m.insertCell(0),q.innerHTML='<div class="multiSel" style="color:#AAAAAA;" nowrap>'+
lm.noValue+"</div>");return l}};
MSelector.prototype.mvpListLoad=function(a,b){var c=this;c.options=[];c.nodeIds=[];if(!b){b=-1;a.biff.hasAttribute("stf")?b=parseInt(a.biff.attr.stf):a.biff.hasAttribute("usrref")&&(b=4);var d=a.biff.attr.mvpf,e=a.biff.attr.mvp;d=d?processMVPF(d,a.biff.y):null;read(function(a){a=a.responseText.split("\n");var b;for(b=0;b<a.length;b++){var d=a[b].split("|");2>d.length||(d[1].indexOf("<br/>")&&(d[1]=d[1].replaceAll("<br/>","\n")),c.options.push(d[1]),c.nodeIds.push(d[0]))}},"/sims/options.jsp?a="+ap+
(e?"&mvp="+encodeURIComponent(e):"")+(d?"&mvpf="+d:"")+"&d="+a.biff.domainId+"&st&ms"+(0<b?"&stf="+b:""),!0)}};MSelector.prototype.clear=emptyFunction;
MSelector.prototype.handleTypingValue=function(a,b){if(a.classList.contains("groupInfo")){var c=a.getAttribute("nodeIds").split("|");a=a.getAttribute("userNames").split("|");var d=this;b?(c.forEach(function(a){a=d.typingNodeList.indexOf(a);-1!==a&&d.typingNodeList.splice(a,1)}),a.forEach(function(a){a=d.typingValueList.indexOf(a);-1!==a&&d.typingValueList.splice(a,1)})):(c.forEach(function(a){-1===d.typingNodeList.indexOf(a)&&d.typingNodeList.push(a)}),a.forEach(function(a){-1===d.typingValueList.indexOf(a)&&
d.typingValueList.push(a)}))}else a.classList.contains("multiSel")?(c=a.getAttribute("value"),a=a.getAttribute("nodeId"),b?(-1!==this.typingValueList.indexOf(c)&&this.typingValueList.splice(this.typingValueList.indexOf(c),1),-1!==this.typingNodeList.indexOf(a)&&this.typingNodeList.splice(this.typingNodeList.indexOf(a),1)):(-1===this.typingValueList.indexOf(c)&&this.typingValueList.push(c),-1===this.typingNodeList.indexOf(a)&&this.typingNodeList.push(a))):a.classList.contains("selectedMultiOption")&&
(c=a.querySelector("a").textContent,a=a.dataset.nodeId,b&&(b=this.typingValueList.indexOf(c),a=this.typingNodeList.indexOf(a),-1!==b&&this.typingValueList.splice(b,1),-1!==a&&this.typingNodeList.splice(a,1)))};
function mselectorClick(){if((mode!==BROWSE||checkIfUserCanEdit())&&this.cell){var a=this.cell.ip;if(a&&!a.readOnly){if(a.biff.hasAttribute("mvp")&&a.biff.attr.mvpf){var b=$("IX"+a.biff.x+"Y"+a.biff.y);if("none"===b.style.display){a.mvpListLoad(a);b.removeChild(b.querySelector("table"));var c=a.getSelectList().listMulti(a,!0);b.appendChild(c.querySelector("table"))}}b=a.getSelectList();c=$("IX"+a.biff.x+"Y"+a.biff.y);c||(a.renderDropdown(),c=$("IX"+a.biff.x+"Y"+a.biff.y));c.ip=a;c&&""===c.style.display?
(c.style.display="none",clearDropWin()):2>ctrl.multiSelected.length&&(clearDropWin(),b.processSelectorLocation(a),a.showList(c));a.biff&&a.biff.hasAttribute("usrref")&&initAvatars()}}}function mselectorSelectedMultiOptionClick(a,b){if(b){var c=a.closest(".msContainer");b=a.dataset.nodeId;c.removeChild(a);a=$("focus").cell.ip;if(b=$("IX"+a.biff.x+"Y"+a.biff.y).querySelector(".multiSel[nodeid='"+b+"']"))b.ip=a,b.click()}}
function checkAllGroupItemStatus(a,b,c){a=a.biff;b=Array.from(b.querySelectorAll(".multiSel"));a=a.nodeId.split("|");for(var d=0;d<b.length;d++){var e=b[d];if(!e.classList.contains("groupsTitle"))if(e.classList.contains("groupInfo")){for(var f=e.getAttribute("nodeIds").split("|"),g=!0,k=!1,l=0;l<f.length;l++)if(a.includes(f[l]))k=!0;else if(g=!1,k&&!g)break;g?(e.querySelector("input[type=checkbox]").checked="checked",e.classList.remove("partInclude"),e.classList.add("allInclude")):!g&&k?(e.querySelector("input[type=checkbox]").checked=
!1,e.classList.remove("allInclude"),e.classList.add("partInclude")):(e.querySelector("input[type=checkbox]").checked=!1,e.classList.remove("allInclude","partInclude"))}else c||(f=e.getAttribute("nodeId"),a.includes(f)?e.querySelector("input[type=checkbox]").checked=!0:e.querySelector("input[type=checkbox]").checked=!1)}}
function groupItemClick(a,b){(b=nui._curcell().ip.listdiv)?b=b.id:(b=nui._curcell().id.split("_"),b="IX"+b[1]+"Y"+b[2]);canSaveData()||(modeUpdate(),$("focus").classList.add("pointNone"));var c=nui._curcell().ip;if(c.typing)a.querySelector("input[type='checkbox']").checked?c.handleTypingValue(a,!0):c.handleTypingValue(a,!1),c.leaveTypingMode();else{var d=a.getAttribute("nodeIds").split("|"),e=a.getAttribute("userNames").split("|"),f=c.biff.nodeId.split("|"),g=c.biff.value.split(",");if(a.querySelector("input[type='checkbox']").checked)for(a=
0;a<d.length;a++)e=d[a],f.includes(e)&&(e=f.indexOf(e),f.splice(e,1),g.splice(e,1));else for(a=0;a<d.length;a++){var k=d[a];f.includes(k)||(f.push(k),g.push(e[a]))}c.biff.nodeId=f.join("|");c.biff.value=g.join(",");c.loadValue(g.join("|"));c.render();ggla=c}"none"!==$(b).style.display&&c.showList($(b));canSaveData()&&(c.typing&&(c.maintainOrder=!0,c.leaveTypingMode()),nui._updateFocus(),c.getSelectList().listMultiMatch("",c),"none"!==$(b).style.display&&c.showList($(b)));checkAllGroupItemStatus(c,
$(b))}function groupTitleClick(a,b){canSaveData()?a.parentNode.classList.toggle("showGroupInfo"):(modeUpdate(),$("focus").classList.add("pointNone"),a=nui._curcell().id.split("_"),a="IX"+a[1]+"Y"+a[2],nui._curcell().ip.showList($(a)),$(a).querySelector("td").classList.toggle("showGroupInfo"),checkAllGroupItemStatus(nui._curcell().ip,$(a),!0),initAvatars())}
function mselectorItemClick(a,b){if(a.classList.contains("groupsTitle"))groupTitleClick(a,b);else if(a.classList.contains("groupInfo"))groupItemClick(a,b);else{var c=a.getAttribute("nodeId"),d=nui._curcell().ip,e=nui._curcell().ip.listdiv;e?e=e.id:(e=nui._curcell().id.split("_"),e="IX"+e[1]+"Y"+e[2]);if(canSaveData()){b||(a.childNodes[0].checked=!a.childNodes[0].checked);a.childNodes[2]&&(a.childNodes[2].firstChild.checked=!a.childNodes[0].checked);c=$(e).getElementsByTagName("*");if(d.typing){for(a=
0;a<c.length;a++)if(c[a]&&(b=c[a],b.firstChild)){var f=b.getAttribute("value"),g=b.getAttribute("nodeId");f&&g&&(b.firstChild.checked?d.handleTypingValue(b,!1):d.handleTypingValue(b,!0))}d.maintainOrder=!0;d.leaveTypingMode()}else{var k="",l="";for(a=0;a<c.length;a++)c[a]&&(b=c[a],b.firstChild&&(f=b.getAttribute("value"),g=b.getAttribute("nodeId"),f&&g&&(b.firstChild.checked?(f=f.replace(/[|]/g,"%7C"),d.handleTypingValue(b,!1),0<k.length?(k+="|"+f,l+="|"+g):(k+=f,l+=g)):d.handleTypingValue(b,!0))));
d.biff.nodeId=l;d.biff.value=k;d.loadValue(k);d.render();canSaveData()&&(nui._updateFocus(),"none"!==$(e).style.display&&d.showList($(e)))}checkAllGroupItemStatus(d,$(e),!0)}else{modeUpdate();$("focus").classList.add("pointNone");d=$(e).getElementsByTagName("*");for(a=d.length;a--;)if(d[a].getAttribute("nodeId")===c){d[a].ip=nui._curcell().ip;d[a].click();d[a].ip&&d[a].ip.showList($(e));break}nui._curcell().ip.biff&&nui._curcell().ip.biff.hasAttribute("usrref")&&initAvatars()}}}
var RuleConditionOperator={},ruleConditionSelectProvider={};Object.defineProperties(RuleConditionOperator,{Equals:{value:"ffEquals"},NotEquals:{value:"ffNotEquals"},Contains:{value:"ffContains"},NotContains:{value:"ffNotContains"},Greater:{value:"ffGreater"},Less:{value:"ffLess"},StartWith:{value:"ffStartWith"},EndWith:{value:"ffEndWith"},Special:{value:"Special"}});
window.webForm||Object.defineProperties(ruleConditionSelectProvider,{operatorText:{get:function(){var a=document.createElement("SELECT");a.add(new Option(lm.is,RuleConditionOperator.Equals));a.add(new Option(lm.isNot,RuleConditionOperator.NotEquals));a.add(new Option(lm.contains,RuleConditionOperator.Contains));a.add(new Option(lm.doesNotContains,RuleConditionOperator.NotContains));a.add(new Option(lm.beginsWith,RuleConditionOperator.StartWith));a.add(new Option(lm.endsWith,RuleConditionOperator.EndWith));
return a}},operatorDate:{get:function(){var a=document.createElement("SELECT");a.add(new Option(lm.isOn,RuleConditionOperator.Equals));a.add(new Option(lm.isBefore,RuleConditionOperator.Less));a.add(new Option(lm.isAfter,RuleConditionOperator.Greater));return a}},operatorNumber:{get:function(){var a=document.createElement("SELECT");a.add(new Option(lm.isEqualTo,RuleConditionOperator.Equals));a.add(new Option(lm.isNotEqualTo,RuleConditionOperator.NotEquals));a.add(new Option(lm.isLessThan,RuleConditionOperator.Less));
a.add(new Option(lm.isGreaterThan,RuleConditionOperator.Greater));return a}},operatorSignature:{get:function(){var a=document.createElement("SELECT");a.add(new Option(lm.hasSignature,RuleConditionOperator.NotEquals));a.add(new Option(lm.noSignature,RuleConditionOperator.Equals));return a}},operatorFile:{get:function(){var a=document.createElement("SELECT");a.add(new Option(lm.hasFile,RuleConditionOperator.NotEquals));a.add(new Option(lm.noFile,RuleConditionOperator.Equals));return a}},operatorSingleSelect:{get:function(){var a=
document.createElement("SELECT");a.add(new Option(lm.is,RuleConditionOperator.Equals));a.add(new Option(lm.isNot,RuleConditionOperator.NotEquals));return a}},operatorMultipleSelect:{get:function(){var a=document.createElement("SELECT");a.add(new Option(lm.contains,RuleConditionOperator.Contains));a.add(new Option(lm.doesNotContains,RuleConditionOperator.NotContains));return a}},conditionDate:{get:function(){var a=document.createElement("SELECT");a.add(new Option(lm.today,"$TODAY"));a.add(new Option(lm.yesterday,
"$YESTERDAY"));a.add(new Option(lm.tomorrow,"$TOMORROW"));a.add(new Option(lm.past7,"$PAST7"));a.add(new Option(lm.next7,"$NEXT7"));a.add(new Option(lm.past30,"$PAST30"));a.add(new Option(lm.next30,"$NEXT30"));a.add(new Option(lm.thisWeek,"$THISWEEK"));a.add(new Option(lm.lastWeek,"$LASTWEEK"));a.add(new Option(lm.nextWeek,"$NEXTWEEK"));a.add(new Option(lm.thisMonth,"$THISMONTH"));a.add(new Option(lm.lastMonth,"$LASTMONTH"));a.add(new Option(lm.nextMonth,"$NEXTMONTH"));a.add(new Option(lm.chosenPastDays,
"$PASTDAYS"));a.add(new Option(lm.chosenNextDays,"$NEXTDAYS"));a.add(new Option(lm.chosenDate,""));return a}},conditionDateCompare:{get:function(){var a=document.createElement("SELECT");a.add(new Option(lm.today,"$TODAY"));a.add(new Option(lm.chosenDate,""));return a}}});
var ruleConditionHelper=function(){var a={},b={};if(window.webForm)return b;Object.defineProperties(b,{getOperatorSelect:{value:function(a){return a.IPType===SELECTOR?ruleConditionSelectProvider.operatorSingleSelect:a.IPType===MSELECTOR?ruleConditionSelectProvider.operatorMultipleSelect:a.hasAttribute("fmt_d")?ruleConditionSelectProvider.operatorDate:a.hasAttribute("fmt_n")?ruleConditionSelectProvider.operatorNumber:a.hasAttribute("sig")?ruleConditionSelectProvider.operatorSignature:a.IPType===UPLOADER||
a.IPType===GRAPHICS?ruleConditionSelectProvider.operatorFile:ruleConditionSelectProvider.operatorText}},createDefaultConditionJSON:{value:function(){var a={domainId:builder.titleField,value:""},b=builder.findField(builder.titleField);if(!b){var e=Object.keys(builder.cellData);e.length&&(a.domainId=builder.cellData[e[0]].domainId,b=builder.findField(a.domainId))}b.IPType===SELECTOR?a.operator=RuleConditionOperator.Equals:b.IPType===MSELECTOR?a.operator=RuleConditionOperator.Contains:b.hasAttribute("fmt_n")?
a.operator=RuleConditionOperator.Greater:b.hasAttribute("fmt_d")?b.attr.fmt_d.includes("y")?(a.operator=RuleConditionOperator.Special,a.value="$TODAY"):a.operator=RuleConditionOperator.Greater:b.hasAttribute("sig")||b.IPType===UPLOADER||b.IPType===GRAPHICS?a.operator=RuleConditionOperator.NotEquals:a.operator=RuleConditionOperator.Equals;return a}},getSelectDomainOptions:{value:function(b){var c=builder.findField(b),e=builder.selections[b];if(312===parseInt(b)||312===parseInt(c.getAttribute("vd")))return Promise.resolve([{text:lm.approval_status_new,
value:"N"},{text:lm.approval_status_process,value:"P"},{text:lm.approval_status_finish,value:"F"},{text:lm.approval_status_rejected,value:"REJ"}]);Array.isArray(e)&&0!==e.length?(e=e.map(function(a){a=a.replace(/&#44;/g,",");return{text:a,value:a}}),e=Promise.resolve(e)):a.hasOwnProperty(b)?e=a[b]:(e=getPromise("/sims/options.jsp",{a:ap,d:b,p:path,si:sheetIndex}).then(function(a){a=a.replace(/^\n|\n$/g,"").split("\n").map(function(a){a=a.substring(a.indexOf("|")+1);return{text:a,value:a}});c.hasAttribute("usrref")&&
a.push({text:lm.loggedInUser,value:"$USER"});return a}),a[b]=e,setTimeout(function(){delete a[b]},2E4));return e}}});return b}(),RagicInteractiveRules=function(){function a(a){var b=this;this.version=a.version||0;this.cons=a.cons.map(function(a){return new m(a.domainId,a.operator,a.value,a.isSubtable)});this.conLogic=a.conLogic;this.actions=a.actions.map(function(a){if(!window.webForm){var c=mode===BUILDER?builder.ifListingPage():biffdata.ifListingPage();if(B(b.version,a.action)&&!c){var d=a.domainId;
c=(mode===BUILDER?Object.values(builder.actionButtons):biffdata.buttons).find(function(a){return parseInt(a.seq)===parseInt(d)});return new n(c.id,a.action,a.actionValue,a.isSubtable)}}return new n(a.domainId,a.action,a.actionValue,a.isSubtable)});mode===BUILDER&&1!==this.version&&(this.version=1);this.actSubtableRoot=a.actSubtableRoot||-1;this.id="_rule_"+V++}function b(){var a=ruleConditionHelper.createDefaultConditionJSON();this.cons.push(new m(a.domainId,a.operator,a.value,a.isSubtable));this.render()}
function c(a){a=a.target.closest("._form_rule_condition");a=parseInt(a.dataset.condition_index);this.cons.splice(a,1);this.resetActSubtableRoot();this.render()}function d(){var a=node("div");a.classList.add("_form_rule_action");return a}function e(){var a="",b=function(b){return b.action===a},c=function(b){this.actions.push(new n(-1,a,b&&b.actionValue?b.actionValue:"",!1));this.render()}.bind(this);a=FormRuleActionType.Show;this.actions.some(b)?(a=FormRuleActionType.Hide,this.actions.some(b)?(a=FormRuleActionType.ShowFreeData,
this.actions.some(b)?(a=FormRuleActionType.HideFreeData,this.actions.some(b)?(a=FormRuleActionType.Message,this.actions.some(b)?(a=FormRuleActionType.ShowActionButton,this.actions.some(a)?(a=FormRuleActionType.HideActionButton,this.actions.some(b)?(a=FormRuleActionType.LockActionButton,this.actions.some(b)?(a=FormRuleActionType.ValueColor,c({actionValue:generateColorCode()})):c()):c()):c()):c()):c()):c()):c()):c()}function f(a){a=a.target.closest("._form_rule_action_delete_wrapper");var b=a.parentElement.firstElementChild.value,
c=a.dataset.color;this.actions=c?this.actions.filter(function(a){return a.action!==b||a.actionValue!==c}):this.actions.filter(function(a){return a.action!==b});this.resetActSubtableRoot();this.render()}function g(a){var b=node("div"),c=node("i");c.classList.add("fa","fa-times");b.appendChild(c);b.classList.add("_form_rule_action_delete_wrapper");b.addEventListener("click",f.bind(a));return b}function k(a){var b=document.querySelector("#FormRuleColorPicker");dropWin(a,b,!1,!0);this.color&&(FormRuleColorPicker.setCallback(null),
FormRuleColorPicker.setHex(this.color),FormRuleColorPicker.setOriginHex(this.color));FormRuleColorPicker.setCallback(l.bind(this))}function l(a){this.actions.forEach(function(b){b.actionValue=a});var b=y.rules.find(function(a){return a.actions.includes(this.actions[0])}.bind(this));b&&b.render()}function m(a,b,c,d){this.domainId=parseInt(a);this.value=c;this.isSubtable=d;var e,f=!1;f=mode===BUILDER?(e=builder.findField(a))&&e.IPType===MSELECTOR:window.webForm?(e=webForm._form.querySelector('DIV[domainId="'+
a+'"]'))&&(!!e.querySelector("*[multiple]")||!!e.querySelector('INPUT[type="checkbox"]')):(e=biffdata.findHeader(a))&&e.IPType===MSELECTOR;this.getDomainHeader=function(){return e};this.isMultiple=function(){return f};this.operator=b;if(e&&mode===BUILDER)if(f)this.operator!==RuleConditionOperator.Contains&&this.operator!==RuleConditionOperator.NotContains&&(this.operator=RuleConditionOperator.Contains);else if(e.IPType===SELECTOR)this.operator!==RuleConditionOperator.Equals&&this.operator!==RuleConditionOperator.NotEquals&&
(this.operator=RuleConditionOperator.Equals);else if(e.hasAttribute("fmt_n"))this.operator!==RuleConditionOperator.Equals&&this.operator!==RuleConditionOperator.NotEquals&&this.operator!==RuleConditionOperator.Less&&this.operator!==RuleConditionOperator.Greater&&(this.operator=RuleConditionOperator.Equals);else if(e.hasAttribute("fmt_d"))this.operator!==RuleConditionOperator.Equals&&this.operator!==RuleConditionOperator.Less&&this.operator!==RuleConditionOperator.Greater&&this.operator!==RuleConditionOperator.Special&&
(this.operator=RuleConditionOperator.Equals);else if(e.hasAttribute("sig")||e.IPType===UPLOADER||e.IPType===GRAPHICS)this.operator!==RuleConditionOperator.Equals&&this.operator!==RuleConditionOperator.NotEquals&&(this.operator=RuleConditionOperator.NotEquals);else if(this.operator===RuleConditionOperator.Greater||this.operator===RuleConditionOperator.Less)this.operator=RuleConditionOperator.Equals}function n(a,b,c,d){this.domainId=parseInt(a);this.action=b;this.actionValue=c;this.isSubtable=d}function q(a){a&&
(a=nui._getcell(a.x,a.y))&&a.classList.add("hide")}function r(a){a&&(a=nui._getcell(a.x,a.y))&&a.classList.remove("hide")}function p(a){a&&(a.style.display="none")}function t(a){a&&(a.style.display="")}function v(a,b,c){this.element=a;this.assignedStyle=b;this.assignStyleValue=c}function u(a,b){this.element=a;this.assignedStyle=b}function x(a,b,c){var d=nui._getcell(a.x,a.y);d&&((a=N.find(function(a){return a.element===d&&a.assignedStyle===b}))?a.assignStyleValue=c:N.push(new v(d,b,c)))}function E(a,
b){var c=nui._getcell(a.x,a.y);c&&(N.find(function(a){return a.element===c&&a.assignedStyle===b})||H.find(function(a){return a.element===c&&a.assignedStyle===b})||H.push(new u(c,b)))}function D(a,b,c){var d=N.find(function(c){return c.element===a&&c.assignedStyle===b});d?d.assignStyleValue=c:N.push(new v(a,b,c))}function A(a,b){N.find(function(c){return c.element===a&&c.assignedStyle===b})||H.find(function(c){return c.element===a&&c.assignedStyle===b})||H.push(new u(a,b))}function w(a,b){if(a){var c=
biffdata.ifListingPage(),d=biffdata.lock,e=a.attr&&"true"===a.attr.nolock,f="L"===biffdata.lockMode&&!e;d=d&&d.includes(a.parentNodeId)&&!e;a&&a.ip&&(c?!d:!f)&&a.ip.setReadonly(b)}}function F(a,b){a&&webForm.setReadOnly(a,b)}function C(a,b){var c=G.find(function(b){return b.index===a});c?c.force=b:G.push({index:a,force:b})}function z(a,b,c){Number.isInteger(c)&&(a.dataset.condition_index=c);a.dataset.mapping=b}function J(){M=[];mode===BUILDER?builder.ifListingPage()||(M=Object.values(builder.cellData).filter(function(a){return!!builder.findSubtableHeadField(a.x,
a.y)})):M=window.webForm?window.fieldsJSON?fieldsJSON.filter(function(a){return a.hasOwnProperty("subGroup")}).map(function(a){return{domainId:a.domainId,subgroup:a.subGroup}}):Array.from(document.querySelectorAll("DIV[subgroup]"),function(a){return{domainId:parseInt(a.getAttribute("domainId")),subgroup:parseInt(a.getAttribute("subgroup"))}}):biffdata.subtableDomainIds.slice()}function L(a,b,c){return c?a&&b:a||b}function B(a,b){return 1>a&&(b===FormRuleActionType.HideActionButton||b===FormRuleActionType.LockActionButton)}
var y={},O,K,M,Q,P,G=[],R=[],N=[],H=[],I,U=!1,T,V=0,S=[];y.rules=[];y.toJSONString=function(){var a="",b=O,c=!0;try{if(-1!==nui.frow){J();for(var d={},e=0,f=y.rules.length;e<f;d={$jscomp$loop$prop$rule$632:d.$jscomp$loop$prop$rule$632},e++)d.$jscomp$loop$prop$rule$632=y.rules[e],d.$jscomp$loop$prop$rule$632.cons=d.$jscomp$loop$prop$rule$632.cons.filter(function(a){return function(b){b=builder.findField(b.domainId,b.isSubtable);if(!b)return!1;if(M.includes(b)){var c=builder.findSubtableHeadField(b.x,
b.y);if(void 0===builder.subtableKeys[c.x+","+c.y])return!1}return!(-1===a.$jscomp$loop$prop$rule$632.actSubtableRoot&&!builder.ifListingPage()&&M.includes(b))}}(d)),d.$jscomp$loop$prop$rule$632.actions=d.$jscomp$loop$prop$rule$632.actions.filter(function(a){return function(b){if(b.action===FormRuleActionType.Message)return!0;if(b.action===FormRuleActionType.ShowFreeData||b.action===FormRuleActionType.HideFreeData){if(!builder.freeData.hasOwnProperty(b.actionValue)){var c=Object.values(builder.freeData).find(function(a){return b.actionValue===
a.oldPos});c&&(b.actionValue=c.x+","+c.y,c.oldPos=b.actionValue)}return builder.freeData.hasOwnProperty(b.actionValue)}if(b.action===FormRuleActionType.ShowActionButton||b.action===FormRuleActionType.HideActionButton||b.action===FormRuleActionType.LockActionButton){c=builder.ifListingPage()&&Object.keys(builder.cellData).find(function(a){return parseInt(builder.cellData[a].domainId)===parseInt(b.domainId)});var d=Object.values(builder.actionButtons).find(function(a){return parseInt(a.id)===b.domainId});
return c||d}if(b.action===FormRuleActionType.ShowSection||b.action===FormRuleActionType.HideSection)return builder.sections&&builder.sections.hasOwnProperty("sections")&&builder.sections.sections[b.domainId];if(b.domainId===builder.rootDomainId||Object.keys(builder.subtableKeys).some(function(a){return builder.subtableKeys[a]===b.domainId}))return!0;c=builder.findField(b.domainId,b.isSubtable);return!c||c.hasAttribute("hide")||M.includes(c)&&(d=builder.findSubtableHeadField(c.x,c.y),void 0===builder.subtableKeys[d.x+
","+d.y])?!1:!(-1===a.$jscomp$loop$prop$rule$632.actSubtableRoot&&!builder.ifListingPage()&&M.includes(c))}}(d));y.rules=y.rules.filter(function(a){return 0===a.cons.length||0===a.actions.length||-1!==a.actSubtableRoot&&(a=Object.keys(builder.subtableKeys),0===a.length||!a.some(function(a){return void 0!==builder.subtableKeys[a]}))?!1:!0})}a=encodeURIComponent(JSON.stringify(y))}catch(ca){c=!1,console.error(ca)}finally{c&&(b=a)}return b};y.loadRules=function(a){a?(O=a,K=JSON.parse(decodeURIComponent(a))):
(O="",K=null,y.rules=[]);V=0;M=null;I=[]};y.setTimeoutId=function(a){T=a};y.getTimeoutId=function(){return T};y.hasTimeoutId=function(){return!!T};y.removeTimeoutId=function(){T=null};y.execute=function(b,c){K&&(M||(J(),y.rules=K.rules.filter(function(a){return a.cons&&a.cons.length&&a.actions&&a.actions.length}).map(function(b){return new a(b)})),U=!!biffdata&&biffdata.ifListingPage(),c&&(c=parseInt(window.webForm?c.getAttribute("domainId"):c.domainId),S.includes(c)||S.push(c)),b?(S=[],y._execute()):
(y.hasTimeoutId()&&(window.clearTimeout(y.getTimeoutId()),y.removeTimeoutId()),y.setTimeoutId(window.setTimeout(y._execute.bind(y),250))))};y._execute=function(){U!==!!biffdata&&biffdata.ifListingPage()||mode===BUILDER||0<S.length&&!y.rules.some(function(a){return S.length?a.cons.some(function(a){return S.includes(a.domainId)}):!0})||(y.rules.forEach(function(a){a.execute()}),y.removeTimeoutId(),S=[],y.hideSections(),mode!==BROWSE&&R.length&&(I&&I.join()===R.join()||y._showMessage(R),I=R.slice(0),
R.length=0),H.length&&(y._unstyleElements(),H.length=0),N.length&&(y._styleElements(),N.length=0))};y.hideSections=function(){};y._showMessage=function(a){window.webForm?window.webForm.showMsg(a.join("\n")):floatWin(null,a.join("<br/>"),lm.interactiveRule)};y._styleElements=function(){N.forEach(function(a){a.element.style[a.assignedStyle]=a.assignStyleValue;if(a=a.element.querySelector("a"))a.style.color="inherit"})};y._unstyleElements=function(){H.forEach(function(a){a.element.style[a.assignedStyle]=
"";a.element.dataset[a.assignedStyle]&&(a.element.style[a.assignedStyle]=a.element.dataset[a.assignedStyle])})};y.render=function(){if(mode===BUILDER&&(M||(J(),K?y.rules=K.rules.map(function(b){return new a(b)}):y.rules.length=0),!hasUnsavedFields())){P=node("DIV");P.id="_ragic_form_rules";y.rules.forEach(function(a,b){a.render().dataset.index=b+""});var b=$("floatingFormRules"),c=b.lastElementChild.lastElementChild;rm(c);c.appendChild(P);b.querySelector("#form_rules_top_action SPAN").onclick=y.addRule;
b.style.display="";document.addEventListener("click",function(a){var b=a.target.closest(".dropDown-wrapper");document.querySelectorAll(".dropDown-wrapper.show").forEach(function(a){b!==a&&a.classList.toggle("show")})})}};y.addRule=function(){var b={cons:[ruleConditionHelper.createDefaultConditionJSON()],actions:[{domainId:-1,action:FormRuleActionType.Show,actionValue:""}],conLogic:"AND",actSubtableRoot:-1,version:1};b=new a(b);y.rules.unshift(b);y.render()};y.deleteRule=function(a){y.rules.splice(a,
1);y.render()};y.ruleMoveUp=function(a){a=a.target.closest("._form_rule_container");var b=parseInt(a.dataset.index);for(a=1;a<y.rules.length;++a)if(b===a){b=y.rules[a-1];y.rules[a-1]=y.rules[a];y.rules[a]=b;break}y.render()};y.ruleMoveDown=function(a){a=a.target.closest("._form_rule_container");var b=parseInt(a.dataset.index);for(a=0;a<y.rules.length-1;++a)if(b===a){b=y.rules[a+1];y.rules[a+1]=y.rules[a];y.rules[a]=b;break}y.render()};a.prototype.getVersion=function(){return this.version};a.prototype.getId=
function(){return this.id};a.prototype.isConditionAnd=function(){return"AND"===this.conLogic};a.prototype.matchCondition=function(){var a=1,b=this.isConditionAnd();if(-1!==this.actSubtableRoot){var c=this.actSubtableRoot;if(window.webForm){var d=document.querySelector("DIV[subRoot='"+this.actSubtableRoot+"']");d&&(a=Array.from(d.children).filter(function(a){return!a.classList.contains("webformSettingConf")}).length)}else Q=biffdata.biffs.filter(function(a){return a.parentDomainId===c}).map(function(a){return a.y}).filter(function(a,
b,c){return c.indexOf(a)===b}),a=Q.length+1}!window.webForm&&biffdata.ifListingPage()&&(a=biffdata.dataRowCount+1);var e=Array.from({length:a},function(){return b});this.cons.forEach(function(a){a.matchCondition(e,b)});return e};a.prototype.render=function(){if(P){var a=P.querySelector("#"+this.getId()),b=this.actSubtableRoot,c=[];Object.keys(builder.cellData).forEach(function(a){a=builder.cellData[a];if(-1===b)c.push(a);else{var d=builder.findSubtableHeadField(a.x,a.y);d&&void 0===builder.subtableKeys[d.x+
","+d.y]||c.push(a)}});var d=node("fieldset"),e=node("div"),f=this.renderRuleControlWrapper(),g=this.renderConditionContainer(c),k=this.renderActionContainer(c);d.id=this.getId();d.classList.add("_form_rule_container");d.appendChild(f);d.appendChild(e);e.appendChild(g);e.appendChild(k);e.classList.add("_form_rule_main");a?P.replaceChild(d,a):P.appendChild(d);d.addEventListener("paste",this.updateRule.bind(this));d.addEventListener("change",this.updateRule.bind(this));d.addEventListener("mouseover",
function(a){a=a.target;a.classList.contains("fa-angle-up")?(a.classList.remove("fa-angle-up"),a.classList.add("fa-chevron-circle-up")):a.classList.contains("fa-angle-down")&&(a.classList.remove("fa-angle-down"),a.classList.add("fa-chevron-circle-down"))});d.addEventListener("mouseout",function(a){a=a.target;a.classList.contains("fa-chevron-circle-up")?(a.classList.remove("fa-chevron-circle-up"),a.classList.add("fa-angle-up")):a.classList.contains("fa-chevron-circle-down")&&(a.classList.remove("fa-chevron-circle-down"),
a.classList.add("fa-angle-down"))});return d}};a.prototype.renderRuleControlWrapper=function(){var a=node("aside"),b=node("I"),c=node("I"),d=node("div"),e=node("div"),f=node("i"),g=node("div");b.className="fas fa-angle-up";d.classList.add("_form_rule_button");d.appendChild(b);c.className="fas fa-angle-down";e.classList.add("_form_rule_button");e.appendChild(c);d.addEventListener("click",y.ruleMoveUp);e.addEventListener("click",y.ruleMoveDown);f.classList.add("fa","fa-times");f.setAttribute("aria-hidden",
"true");g.classList.add("_form_rule_delete");g.appendChild(f);g.addEventListener("click",function(a){a=a.target.closest("._form_rule_container").dataset.index;y.deleteRule(a)});a.classList.add("_form_rule_control");a.appendChild(d);a.appendChild(g);a.appendChild(e);return a};a.prototype.renderConditionContainer=function(a){for(var d=this,e=node("div"),f=d.isConditionAnd(),g={$jscomp$loop$prop$i$639:0},k=d.cons.length;g.$jscomp$loop$prop$i$639<k;g={$jscomp$loop$prop$condition$637:g.$jscomp$loop$prop$condition$637,
$jscomp$loop$prop$fields$635:g.$jscomp$loop$prop$fields$635,$jscomp$loop$prop$optionSelect$636:g.$jscomp$loop$prop$optionSelect$636,$jscomp$loop$prop$optionWrapper$638:g.$jscomp$loop$prop$optionWrapper$638,$jscomp$loop$prop$i$639:g.$jscomp$loop$prop$i$639},g.$jscomp$loop$prop$i$639++){g.$jscomp$loop$prop$condition$637=d.cons[g.$jscomp$loop$prop$i$639];var l=g.$jscomp$loop$prop$condition$637.getDomainHeader();if(l){if(0<g.$jscomp$loop$prop$i$639){var n=node("div"),p=node("SELECT");p.add(new Option(lm.and,
"AND",f,f));p.add(new Option(lm.or,"OR",!f,!f));n.classList.add("conLogic");n.appendChild(p);p.dataset.mapping="rule_logic";e.appendChild(n)}n=node("div");n.classList.add("_form_rule_condition");p=node("div");p.textContent=lm["if"];p.style.cssText="min-width: 48px; text-align: center;";n.appendChild(p);p=node("div");p.classList.add("_form_rule_condition_field_wrapper");n.appendChild(p);g.$jscomp$loop$prop$fields$635=selectTemplateProvider.getSelectableDomainSelect(a);p.appendChild(g.$jscomp$loop$prop$fields$635);
var q=Array.from(g.$jscomp$loop$prop$fields$635.options).findIndex(function(a){return function(b){var c=a.$jscomp$loop$prop$condition$637.isSubtable?b.dataset.issubtable===a.$jscomp$loop$prop$condition$637.isSubtable+"":!0;return parseInt(b.value)===parseInt(a.$jscomp$loop$prop$condition$637.domainId)&&c}}(g));g.$jscomp$loop$prop$fields$635.selectedIndex=q;z(g.$jscomp$loop$prop$fields$635,"condition_domainId",g.$jscomp$loop$prop$i$639);p=BarSelectAgent.modifiedSelector(d.getId()+"_condition_domainId_"+
g.$jscomp$loop$prop$i$639,g.$jscomp$loop$prop$fields$635,p,{});p.setAfterSelectOption(function(a){return function(b){var c=a.$jscomp$loop$prop$fields$635.value=b.value;b="true"===b.optionDataset.issubtable;var e=a.$jscomp$loop$prop$fields$635.dataset.condition_index,f=builder.findField(c,b),g=d.cons[e],k=g.getDomainHeader(),l=k.hasAttribute("fmt_d"),n=f.hasAttribute("fmt_d"),p=g.operator,q=g.value;g.operator===RuleConditionOperator.Special&&(q="");!l&&n&&(f.attr.fmt_d.includes("y")?(p=RuleConditionOperator.Special,
q="$TODAY"):q="");if(f.hasAttribute("sig")||f.IPType===UPLOADER||f.IPType===GRAPHICS)q="";f=!builder.ifListingPage()&&-1!==d.actSubtableRoot&&M.includes(k)&&!M.includes(f)||-1===d.actSubtableRoot&&!M.includes(k)&&M.includes(f);d.cons[e]=new m(c,p,q,b);f&&d.resetActSubtableRoot();triggerEvent(a.$jscomp$loop$prop$fields$635,"change")}}(g));p.setOnToggleDropdown(function(a){if(a){var b=[];a=Object.keys(BarSelectAgent.selectors).filter(function(a){return a.includes("_condition_domainId_")});a.forEach(function(a){a=
BarSelectAgent.getSelector(a);document.body.contains(a.element)&&(a=a.options.findIndex(function(a){return a.selected}),-1!==a&&b.push(a))});a.forEach(function(a){var c=BarSelectAgent.getSelector(a);b.forEach(function(a){c.options[a].customProperties.barSelectOptionClasses=["hasChosenOption"]})})}});n.dataset.condition_index=g.$jscomp$loop$prop$i$639+"";p=ruleConditionHelper.getOperatorSelect(l);l.IPType===SELECTOR&&(g.$jscomp$loop$prop$condition$637.operator===RuleConditionOperator.Contains?g.$jscomp$loop$prop$condition$637.operator=
RuleConditionOperator.Equals:g.$jscomp$loop$prop$condition$637.operator===RuleConditionOperator.NotContains&&(g.$jscomp$loop$prop$condition$637.operator=RuleConditionOperator.NotEquals));p.value=g.$jscomp$loop$prop$condition$637.operator;n.appendChild(p);z(p,"condition_operator",g.$jscomp$loop$prop$i$639);if(l.IPType===SELECTOR)g.$jscomp$loop$prop$optionWrapper$638=node("div"),g.$jscomp$loop$prop$optionWrapper$638.classList.add("_form_rule_condition_option_wrapper"),n.appendChild(g.$jscomp$loop$prop$optionWrapper$638),
g.$jscomp$loop$prop$optionSelect$636=node("select"),g.$jscomp$loop$prop$optionSelect$636.style.display="none",g.$jscomp$loop$prop$optionSelect$636.add(new Option("","")),z(g.$jscomp$loop$prop$optionSelect$636,"condition_option",g.$jscomp$loop$prop$i$639),ruleConditionHelper.getSelectDomainOptions(l.domainId).then(function(a){return function(b){b.reduce(function(a,b){a.appendChild(new Option(b.text,b.value));return a},a.$jscomp$loop$prop$optionSelect$636);a.$jscomp$loop$prop$optionSelect$636.value=
a.$jscomp$loop$prop$condition$637.value;""===a.$jscomp$loop$prop$optionSelect$636.value&&0<a.$jscomp$loop$prop$optionSelect$636.options.length&&(b=a.$jscomp$loop$prop$optionSelect$636.options[0].value,a.$jscomp$loop$prop$optionSelect$636.value=b,a.$jscomp$loop$prop$condition$637.value=b);a.$jscomp$loop$prop$optionWrapper$638.appendChild(a.$jscomp$loop$prop$optionSelect$636);BarSelectAgent.modifiedSelector(d.getId()+"_condition_option_"+a.$jscomp$loop$prop$i$639,a.$jscomp$loop$prop$optionSelect$636,
a.$jscomp$loop$prop$optionWrapper$638,{}).setAfterSelectOption(function(b){a.$jscomp$loop$prop$optionSelect$636.value=b.value;triggerEvent(a.$jscomp$loop$prop$optionSelect$636,"change")})}}(g));else if(l.IPType===MSELECTOR)p=node("SELECT"),z(p,"condition_option",g.$jscomp$loop$prop$i$639),ruleConditionHelper.getSelectDomainOptions(l.domainId).then(function(a){a.reduce(function(a,b){a.appendChild(new Option(b.text,b.value));return a},this.select);this.select.value=this.condition.value;""===this.select.value&&
0<this.select.options.length&&(a=this.select.options[0].value,this.select.value=a,this.condition.value=a)}.bind({condition:g.$jscomp$loop$prop$condition$637,select:p})),n.appendChild(p);else if(!l.hasAttribute("sig")&&l.IPType!==UPLOADER&&l.IPType!==GRAPHICS)if(l.hasAttribute("fmt_d")){q=void 0;if(g.$jscomp$loop$prop$condition$637.operator===RuleConditionOperator.Special){if("$FUTURE"===g.$jscomp$loop$prop$condition$637.value?(q=ruleConditionSelectProvider.conditionDateCompare,p.value=RuleConditionOperator.Greater,
q.value="$TODAY"):"$PAST"===g.$jscomp$loop$prop$condition$637.value?(q=ruleConditionSelectProvider.conditionDateCompare,p.value=RuleConditionOperator.Less,q.value="$TODAY"):(q=ruleConditionSelectProvider.conditionDate,p.value=RuleConditionOperator.Equals,g.$jscomp$loop$prop$condition$637.value.startsWith("$PASTDAYS")||g.$jscomp$loop$prop$condition$637.value.startsWith("$NEXTDAYS")?q.value=g.$jscomp$loop$prop$condition$637.value.slice(0,9):q.value=g.$jscomp$loop$prop$condition$637.value),z(q,"condition_option",
g.$jscomp$loop$prop$i$639),n.appendChild(q),g.$jscomp$loop$prop$condition$637.value.startsWith("$PASTDAYS")||g.$jscomp$loop$prop$condition$637.value.startsWith("$NEXTDAYS"))p=node("input"),p.type="number",p.min="1",p.value=g.$jscomp$loop$prop$condition$637.value.slice(9),p.dataset.special="customDays",z(p,"condition_input",g.$jscomp$loop$prop$i$639),n.appendChild(p),p.onfocus=outNUI,p.onblur=inNUI}else(l.attr.fmt_d.includes("y")||l.attr.fmt_d.includes("M")||l.attr.fmt_d.includes("d"))&&!l.attr.hasOwnProperty("repeat")&&
(q=p.value===RuleConditionOperator.Greater||p.value===RuleConditionOperator.Less?ruleConditionSelectProvider.conditionDateCompare:ruleConditionSelectProvider.conditionDate,z(q,"condition_option",g.$jscomp$loop$prop$i$639),n.appendChild(q),q.value="");g.$jscomp$loop$prop$condition$637.operator!==RuleConditionOperator.Special&&(p=node("input"),p.type="text",p.value=g.$jscomp$loop$prop$condition$637.value,z(p,"condition_input",g.$jscomp$loop$prop$i$639),n.appendChild(p),p.onfocus=outNUI,p.onblur=inNUI,
p.onclick=datePickerClick.bind(null,p,l.attr.fmt_d),ragic_date_parse(g.$jscomp$loop$prop$condition$637.value,l.attr.fmt_d)||(g.$jscomp$loop$prop$condition$637.value="",p.value=""))}else l=node("input"),l.type="text",l.value=g.$jscomp$loop$prop$condition$637.value,z(l,"condition_input",g.$jscomp$loop$prop$i$639),n.appendChild(l),l.onfocus=outNUI,l.onblur=inNUI;1<k&&(l=node("div"),p=void 0,p=node("i"),p.classList.add("fa","fa-times"),p.addEventListener("click",c.bind(this)),l.appendChild(p),l.classList.add("_form_rule_condition_delete_wrapper"),
n.appendChild(l));e.appendChild(n)}}a=node("div");f=node("i");f.classList.add("fa","fa-plus-circle");f.addEventListener("click",b.bind(this));a.classList.add("_form_rule_condition_add_wrapper");e.classList.add("_form_rule_condition_list");a.appendChild(f);e.appendChild(a);return e};a.prototype.renderActionContainer=function(a){var b=this,c=node("div"),f=[],l=[],m=[],p=[],q=[],r=[],t="",u=[],w=[],E=[],D=[],x=[],v=[],J="",A=null,y=null,F=null,H=null,C=null,B=null,L=null,I=null,W=null,K=null,O=null;
this.actions.forEach(function(a){if(a.action===FormRuleActionType.Show)A||(A=d(),c.appendChild(A)),f.push({domainId:a.domainId,isSubtable:a.isSubtable});else if(a.action===FormRuleActionType.Hide)y||(y=d(),c.appendChild(y)),l.push({domainId:a.domainId,isSubtable:a.isSubtable});else if(a.action===FormRuleActionType.ShowFreeData)F||(F=d(),c.appendChild(F)),m.push(a.actionValue);else if(a.action===FormRuleActionType.HideFreeData)H||(H=d(),c.appendChild(H)),p.push(a.actionValue);else if(a.action===FormRuleActionType.ShowSection)C||
(C=d(),c.appendChild(C)),q.push(a.domainId);else if(a.action===FormRuleActionType.HideSection)B||(B=d(),c.appendChild(B)),r.push(a.domainId);else if(a.action===FormRuleActionType.Message)L=d(),t=a.actionValue,c.appendChild(L);else if(a.action===FormRuleActionType.ShowActionButton)I||(I=d(),c.appendChild(I)),E.push(a.domainId);else if(a.action===FormRuleActionType.HideActionButton)W||(W=d(),c.appendChild(W)),D.push(a.domainId);else if(a.action===FormRuleActionType.LockActionButton)K||(K=d(),c.appendChild(K)),
J=a.actionValue,x.push(a.domainId);else if(a.action===FormRuleActionType.Readonly)O||(O=d(),c.appendChild(O)),v.push({domainId:a.domainId,isSubtable:a.isSubtable});else{var b=u.find(function(b){return b.action===a.action&&b.color===a.actionValue});b?b.actions.push(a):(b=d(),u.push({actions:[a],wrapper:b,action:a.action,color:a.actionValue}),c.appendChild(b))}});var Q=1<c.childElementCount;A&&w.push(FormRuleActionType.Show);y&&w.push(FormRuleActionType.Hide);F&&w.push(FormRuleActionType.ShowFreeData);
H&&w.push(FormRuleActionType.HideFreeData);C&&w.push(FormRuleActionType.ShowSection);B&&w.push(FormRuleActionType.HideSection);L&&w.push(FormRuleActionType.Message);I&&w.push(FormRuleActionType.ShowActionButton);W&&w.push(FormRuleActionType.HideActionButton);K&&w.push(FormRuleActionType.LockActionButton);O&&w.push(FormRuleActionType.Readonly);builder.ifListingPage()&&(w.push(FormRuleActionType.ShowSection),w.push(FormRuleActionType.HideSection),w.push(FormRuleActionType.HeaderBGColor),w.push(FormRuleActionType.HeaderColor),
w.push(FormRuleActionType.ShowFreeData),w.push(FormRuleActionType.HideFreeData));if(A){A.appendChild(selectTemplateProvider.getAvailableActions(w,FormRuleActionType.Show));var G=node("div");G.classList.add("_form_rule_action_field_wrapper");A.appendChild(G);var U=selectTemplateProvider.getSelectableDomainSelect(a.filter(function(a){return!l.find(function(b){return void 0!==b.isSubtable?parseInt(b.domainId)===parseInt(a.domainId)&&builder.isSubtable(a)===b.isSubtable:parseInt(b.domainId)===parseInt(a.domainId)})&&
!a.hasAttribute("hide")}),{multiple:!0});Array.from(U.options).forEach(function(a){a.selected=f.find(function(b){var c=void 0!==b.isSubtable?a.dataset.issubtable===b.isSubtable+"":!0;return parseInt(b.domainId)===parseInt(a.value)&&c})});z(U,"action_show");G.appendChild(U);BarSelectAgent.modifiedSelector(b.getId()+"_action_domainId_show",U,G,{}).setAfterSelectOption(function(a){var c=Array.from(U.options).find(function(b){return b.value===a.value&&b.dataset.issubtable===a.optionDataset.issubtable});
if(c){c.selected=!c.selected;var d=parseInt(c.value),e="true"===c.dataset.issubtable,f=builder.findField(d,e);f=builder.isSubtable(f);c.selected?b.actions.push(new n(d,FormRuleActionType.Show,"",e)):(b.actions=b.actions.filter(function(a){return a.domainId!==d||a.action!==FormRuleActionType.Show}),0===b.actions.length&&b.actions.push(new n(-1,FormRuleActionType.Show,"",!1)));f&&(b.actSubtableRoot=-1,c=b.actions.find(function(a){return M.includes(builder.findField(a.domainId,a.isSubtable))}))&&(c=
builder.findField(c.domainId,c.isSubtable),c=builder.findSubtableHeadField(c.x,c.y),b.actSubtableRoot=builder.subtableKeys[c.x+","+c.y])}});Q&&A.appendChild(g(this))}if(y){y.appendChild(selectTemplateProvider.getAvailableActions(w,FormRuleActionType.Hide));G=node("div");G.classList.add("_form_rule_action_field_wrapper");y.appendChild(G);var S=selectTemplateProvider.getSelectableDomainSelect(a.filter(function(a){return!f.find(function(b){return void 0!==b.isSubtable?parseInt(b.domainId)===parseInt(a.domainId)&&
builder.isSubtable(a)===b.isSubtable:parseInt(b.domainId)===parseInt(a.domainId)})&&!a.hasAttribute("hide")}),{multiple:!0});Array.from(S.options).forEach(function(a){a.selected=l.find(function(b){var c=void 0!==b.isSubtable?a.dataset.issubtable===b.isSubtable+"":!0;return parseInt(b.domainId)===parseInt(a.value)&&c})});z(S,"action_hide");G.appendChild(S);BarSelectAgent.modifiedSelector(b.getId()+"_action_domainId_hide",S,G,{}).setAfterSelectOption(function(a){var c=Array.from(S.options).find(function(b){return b.value===
a.value&&b.dataset.issubtable===a.optionDataset.issubtable});c&&(c.selected=!c.selected);var d=parseInt(c.value),e="true"===c.dataset.issubtable,f=builder.findField(d,e);f=builder.isSubtable(f);c.selected?b.actions.push(new n(d,FormRuleActionType.Hide,"",e)):(b.actions=b.actions.filter(function(a){return a.domainId!==d||a.action!==FormRuleActionType.Hide}),0===b.actions.length&&b.actions.push(new n(-1,FormRuleActionType.Hide,"",!1)));f&&(b.actSubtableRoot=-1,c=b.actions.find(function(a){return M.includes(builder.findField(a.domainId,
a.isSubtable))}))&&(c=builder.findField(c.domainId,c.isSubtable),c=builder.findSubtableHeadField(c.x,c.y),b.actSubtableRoot=builder.subtableKeys[c.x+","+c.y])});Q&&y.appendChild(g(this))}if(F){F.appendChild(selectTemplateProvider.getAvailableActions(w,FormRuleActionType.ShowFreeData));G=node("div");G.classList.add("_form_rule_action_field_wrapper");F.appendChild(G);var T=node("select");T.multiple=!0;T.style.display="none";Object.keys(builder.freeData).forEach(function(a){var b=new Option(builder.freeData[a].value,
a);b.selected=m.includes(a);T.appendChild(b)});z(T,"action_show_free");G.appendChild(T);BarSelectAgent.modifiedSelector(b.getId()+"_action_domainId_show_free",T,G,{}).setAfterSelectOption(function(a){a.selected?b.actions.push(new n(-1,FormRuleActionType.ShowFreeData,a.value)):(b.actions=b.actions.filter(function(b){return b.actionValue!==a.value||b.action!==FormRuleActionType.ShowFreeData}),0===b.actions.length&&b.actions.push(new n(-1,FormRuleActionType.ShowFreeData,"")))});Q&&F.appendChild(g(this))}if(H){H.appendChild(selectTemplateProvider.getAvailableActions(w,
FormRuleActionType.HideFreeData));G=node("div");G.classList.add("_form_rule_action_field_wrapper");H.appendChild(G);var P=node("select");P.multiple=!0;P.style.display="none";Object.keys(builder.freeData).forEach(function(a){var b=new Option(builder.freeData[a].value,a);b.selected=p.includes(a);P.appendChild(b)});z(P,"action_hide_free");G.appendChild(P);BarSelectAgent.modifiedSelector(b.getId()+"_action_domainId_hide_free",P,G,{}).setAfterSelectOption(function(a){a.selected?b.actions.push(new n(-1,
FormRuleActionType.HideFreeData,a.value)):(b.actions=b.actions.filter(function(b){return b.actionValue!==a.value||b.action!==FormRuleActionType.HideFreeData}),0===b.actions.length&&b.actions.push(new n(-1,FormRuleActionType.HideFreeData,"")))});Q&&H.appendChild(g(this))}if(C){C.appendChild(selectTemplateProvider.getAvailableActions(w,FormRuleActionType.ShowSection));G=node("div");G.classList.add("_form_rule_action_field_wrapper");C.appendChild(G);var N=node("select");N.multiple=!0;N.style.display=
"none";(builder.sections.sections||[]).forEach(function(a,b){a=new Option(a.name,b+"");a.selected=q.includes(b);N.appendChild(a)});z(N,"action_show_section");G.appendChild(N);BarSelectAgent.modifiedSelector(b.getId()+"_action_domainId_show_section",N,G,{}).setAfterSelectOption(function(a){a.selected?b.actions.push(new n(parseInt(a.value),FormRuleActionType.ShowSection,"")):(b.actions=b.actions.filter(function(b){return b.domainId!==parseInt(a.value)||b.action!==FormRuleActionType.ShowSection}),0===
b.actions.length&&b.actions.push(new n(-1,FormRuleActionType.ShowSection,"")))});Q&&C.appendChild(g(this))}if(B){B.appendChild(selectTemplateProvider.getAvailableActions(w,FormRuleActionType.HideSection));G=node("div");G.classList.add("_form_rule_action_field_wrapper");B.appendChild(G);var R=node("select");R.multiple=!0;R.style.display="none";(builder.sections.sections||[]).forEach(function(a,b){a=new Option(a.name,b+"");a.selected=r.includes(b);R.appendChild(a)});z(R,"action_hide_section");G.appendChild(R);
BarSelectAgent.modifiedSelector(b.getId()+"_action_domainId_hide_section",R,G,{}).setAfterSelectOption(function(a){a.selected?b.actions.push(new n(parseInt(a.value),FormRuleActionType.HideSection,"")):(b.actions=b.actions.filter(function(b){return b.domainId!==parseInt(a.value)||b.action!==FormRuleActionType.HideSection}),0===b.actions.length&&b.actions.push(new n(-1,FormRuleActionType.HideSection,"")))});Q&&B.appendChild(g(this))}L&&(L.appendChild(selectTemplateProvider.getAvailableActions(w,FormRuleActionType.Message)),
G=node("input"),L.appendChild(G),G.type="text",G.classList.add("_form_rule_action_message_input"),G.value=t,G.dataset.mapping="action_message_input",G.onfocus=outNUI,G.onblur=inNUI,Q&&L.appendChild(g(this)));if(I){I.appendChild(selectTemplateProvider.getAvailableActions(w,FormRuleActionType.ShowActionButton));G=node("div");G.classList.add("_form_rule_action_field_wrapper");I.appendChild(G);var V=node("select");V.multiple=!0;V.style.display="none";Object.values(builder.actionButtons).forEach(function(a){var b=
new Option(a.name,a.id);b.selected=E.includes(parseInt(a.id));V.appendChild(b)});Object.keys(builder.cellData).filter(function(a){return builder.cellData[a].attr&&builder.cellData[a].attr.actionButton}).forEach(function(a){a=builder.cellData[a];var b=new Option(a.value+"[Field]",a.domainId);b.selected=E.includes(parseInt(a.domainId));V.appendChild(b)});z(V,"action_show_actionButton");G.appendChild(V);BarSelectAgent.modifiedSelector(b.getId()+"_action_domainId_show_actionButton",V,G,{}).setAfterSelectOption(function(a){a.selected?
b.actions.push(new n(a.value,FormRuleActionType.ShowActionButton,"")):(b.actions=b.actions.filter(function(b){return b.domainId!==parseInt(a.value)||b.action!==FormRuleActionType.ShowActionButton}),0===b.actions.length&&b.actions.push(new n(-1,FormRuleActionType.ShowActionButton,"")))});Q&&I.appendChild(g(this))}if(W){W.appendChild(selectTemplateProvider.getAvailableActions(w,FormRuleActionType.HideActionButton));G=node("div");G.classList.add("_form_rule_action_field_wrapper");W.appendChild(G);var Z=
node("select");Z.multiple=!0;Z.style.display="none";Object.values(builder.actionButtons).forEach(function(a){var b=new Option(a.name,a.id);b.selected=D.includes(parseInt(a.id));Z.appendChild(b)});Object.keys(builder.cellData).filter(function(a){return builder.cellData[a].attr&&builder.cellData[a].attr.actionButton}).forEach(function(a){a=builder.cellData[a];var b=new Option(a.value+"[Field]",a.domainId);b.selected=D.includes(parseInt(a.domainId));Z.appendChild(b)});z(Z,"action_hide_actionButton");
G.appendChild(Z);BarSelectAgent.modifiedSelector(b.getId()+"_action_domainId_hide_actionButton",Z,G,{}).setAfterSelectOption(function(a){a.selected?b.actions.push(new n(a.value,FormRuleActionType.HideActionButton,"")):(b.actions=b.actions.filter(function(b){return b.domainId!==parseInt(a.value)||b.action!==FormRuleActionType.HideActionButton}),0===b.actions.length&&b.actions.push(new n(-1,FormRuleActionType.HideActionButton,"")))});Q&&W.appendChild(g(this))}if(K){K.appendChild(selectTemplateProvider.getAvailableActions(w,
FormRuleActionType.LockActionButton));G=node("div");G.classList.add("_form_rule_action_field_wrapper");K.appendChild(G);var aa=node("select");aa.multiple=!0;aa.style.display="none";Object.values(builder.actionButtons).forEach(function(a){var b=new Option(a.name,a.id);b.selected=x.includes(parseInt(a.id));aa.appendChild(b)});Object.keys(builder.cellData).filter(function(a){return builder.cellData[a].attr&&builder.cellData[a].attr.actionButton}).forEach(function(a){a=builder.cellData[a];var b=new Option(a.value+
"[Field]",a.domainId);b.selected=x.includes(parseInt(a.domainId));aa.appendChild(b)});z(aa,"action_lock_actionButton");G.appendChild(aa);BarSelectAgent.modifiedSelector(b.getId()+"_action_domainId_lock_actionButton",aa,G,{}).setAfterSelectOption(function(a){a.selected?b.actions.push(new n(a.value,FormRuleActionType.LockActionButton,Y.value)):(b.actions=b.actions.filter(function(b){return b.domainId!==parseInt(a.value)||b.action!==FormRuleActionType.LockActionButton}),0===b.actions.length&&b.actions.push(new n(-1,
FormRuleActionType.LockActionButton,"")))});var Y=node("input");Y.type="text";Y.classList.add("_form_rule_lockActionButton_input");Y.placeholder=lm.customMessage;Y.value=J;Y.dataset.mapping="action_lockActionButton_input";Y.onblur=inNUI;Y.onfocus=outNUI;K.appendChild(Y);Q&&K.appendChild(g(this))}if(O){O.appendChild(selectTemplateProvider.getAvailableActions(w,FormRuleActionType.Readonly));G=node("div");G.classList.add("_form_rule_action_field_wrapper");O.appendChild(G);var ha=selectTemplateProvider.getSelectableDomainSelect(a.filter(function(a){return!a.hasAttribute("hide")}),
{multiple:!0});Array.from(ha.options).forEach(function(a){a.selected=v.find(function(b){var c=void 0!==b.isSubtable?a.dataset.issubtable===b.isSubtable+"":!0;return parseInt(b.domainId)===parseInt(a.value)&&c})});z(ha,"action_readonly");G.appendChild(ha);BarSelectAgent.modifiedSelector(b.getId()+"_action_domainId_readonly",ha,G,{}).setAfterSelectOption(function(a){var c=Array.from(ha.options).find(function(b){return b.value===a.value&&b.dataset.issubtable===a.optionDataset.issubtable});c&&(c.selected=
!c.selected);var d=parseInt(c.value),e="true"===c.dataset.issubtable,f=builder.findField(d,e);f=builder.isSubtable(f);c.selected?b.actions.push(new n(d,FormRuleActionType.Readonly,"",e)):(b.actions=b.actions.filter(function(a){return a.domainId!==d||a.action!==FormRuleActionType.Readonly}),0===b.actions.length&&b.actions.push(new n(-1,FormRuleActionType.Readonly,"",!1)));f&&(b.actSubtableRoot=-1,c=b.actions.find(function(a){return M.includes(builder.findField(a.domainId,a.isSubtable))}))&&(c=builder.findField(c.domainId,
c.isSubtable),c=builder.findSubtableHeadField(c.x,c.y),b.actSubtableRoot=builder.subtableKeys[c.x+","+c.y])});Q&&O.appendChild(g(this))}G={};for(var la=0,sa=u.length;la<sa;G={$jscomp$loop$prop$styleAction$643:G.$jscomp$loop$prop$styleAction$643,$jscomp$loop$prop$fields$358$642:G.$jscomp$loop$prop$fields$358$642,$jscomp$loop$prop$styleColor$646:G.$jscomp$loop$prop$styleColor$646},la++){G.$jscomp$loop$prop$styleAction$643=u[la];G.$jscomp$loop$prop$styleColor$646=G.$jscomp$loop$prop$styleAction$643.color;
var ma=G.$jscomp$loop$prop$styleAction$643.wrapper,ea=selectTemplateProvider.getAvailableActions(w,G.$jscomp$loop$prop$styleAction$643.action);ea.dataset.color=G.$jscomp$loop$prop$styleColor$646;ma.appendChild(ea);var ia=node("input"),na=node("div");na.classList.add("_form_rule_action_field_wrapper");ma.appendChild(na);G.$jscomp$loop$prop$fields$358$642=selectTemplateProvider.getSelectableDomainSelect(a,{isStyleAction:!0,multiple:!0});G.$jscomp$loop$prop$fields$358$642.dataset.mapping="action_"+G.$jscomp$loop$prop$styleAction$643.action;
na.appendChild(G.$jscomp$loop$prop$fields$358$642);Array.from(G.$jscomp$loop$prop$fields$358$642.options).forEach(function(a){return function(b){b.selected=a.$jscomp$loop$prop$styleAction$643.actions.find(function(a){var c=void 0!==a.isSubtable?b.dataset.issubtable===a.isSubtable+"":!0;return parseInt(a.domainId)===parseInt(b.value)&&c})}}(G));BarSelectAgent.modifiedSelector(b.getId()+"_action_domainId_"+la,G.$jscomp$loop$prop$fields$358$642,na,{}).setAfterSelectOption(function(a){return function(c){var d=
Array.from(a.$jscomp$loop$prop$fields$358$642.options).find(function(a){return a.value===c.value&&a.dataset.issubtable===c.optionDataset.issubtable});if(d){var e=u.find(function(b){return b.action===a.$jscomp$loop$prop$styleAction$643.action&&b.color===a.$jscomp$loop$prop$styleColor$646});d.selected=!d.selected;var f=parseInt(d.value),g="true"===d.dataset.issubtable,k=builder.findField(f,g);k=g||builder.isSubtable(k);d.selected?(d=new n(f,a.$jscomp$loop$prop$styleAction$643.action,a.$jscomp$loop$prop$styleColor$646,
g),b.actions.push(d),e&&e.actions.push(d)):(b.actions=b.actions.filter(function(b){return b.domainId!==f||b.action!==a.$jscomp$loop$prop$styleAction$643.action||b.actionValue!==a.$jscomp$loop$prop$styleAction$643.color}),e&&(e.actions=e.actions.filter(function(a){return b.actions.includes(a)}),e.actions.length||(d=new n(-1,a.$jscomp$loop$prop$styleAction$643.action,a.$jscomp$loop$prop$styleColor$646,!1),b.actions.push(d),e.actions.push(d))));k&&b.resetActSubtableRoot()}}}(G));if(!G.$jscomp$loop$prop$styleColor$646){for(;G.$jscomp$loop$prop$styleColor$646=
generateColorCode(),!u.every(function(a){return function(b){return a.$jscomp$loop$prop$styleColor$646!==b.color}}(G)););ea.dataset.color=G.$jscomp$loop$prop$styleColor$646;G.$jscomp$loop$prop$styleAction$643.color=G.$jscomp$loop$prop$styleColor$646;G.$jscomp$loop$prop$styleAction$643.actions.forEach(function(a){return function(b){b.actionValue=a.$jscomp$loop$prop$styleColor$646}}(G))}ia.classList.add("_form_rule_color_input");ia.style.backgroundColor=G.$jscomp$loop$prop$styleColor$646;ia.readOnly=
!0;ia.onclick=k.bind(G.$jscomp$loop$prop$styleAction$643);ma.appendChild(ia);Q&&(ea=g(this),ea.dataset.color=G.$jscomp$loop$prop$styleColor$646,ma.appendChild(ea))}a=node("DIV");w=node("I");w.classList.add("fa","fa-plus-circle");w.addEventListener("click",e.bind(this));a.classList.add("_form_rule_action_add_wrapper");a.appendChild(w);c.classList.add("_form_rule_action_list");c.appendChild(a);return c};a.prototype.updateRule=function(a){var b=a.target;a=b.dataset.mapping;var c=b.dataset.condition_index;
if("rule_logic"===a)this.conLogic=b.value;else if("undefined"!==typeof c){c=this.cons[c];var d=c.getDomainHeader(),e=d.hasAttribute("fmt_d");"condition_operator"===a?e?c.value.startsWith("$")?b.value===RuleConditionOperator.Equals?c.value="$TODAY":b.value===RuleConditionOperator.Less?c.value="$PAST":b.value===RuleConditionOperator.Greater&&(c.value="$FUTURE"):c.operator=b.value:c.operator=b.value:"condition_option"===a?e?c.operator===RuleConditionOperator.Special&&""===b.value?(c.operator=b.previousSibling.value,
c.value=""):""!==b.value&&(c.operator=RuleConditionOperator.Special,c.value=b.value,"$TODAY"===b.value&&(b.previousSibling.value===RuleConditionOperator.Less?c.value="$PAST":b.previousSibling.value===RuleConditionOperator.Greater&&(c.value="$FUTURE"))):c.value=b.value:"condition_input"===a&&(d.hasAttribute("fmt_n")?c.value=b.value.replace(/[^0-9\.-]+/g,""):"customDays"===b.dataset.special?(a=c.value.slice(0,9),c.value=a+b.value):c.value=b.value)}else if("action_select"===a){var f=b.dataset.setAction,
g=b.value;if(f===FormRuleActionType.Show&&g===FormRuleActionType.Hide||f===FormRuleActionType.Hide&&g===FormRuleActionType.Show)this.actions.forEach(function(a){a.action===f&&(a.action=g)});else{var k=b.dataset.color;void 0!==k?this.actions.filter(function(a){return a.action===f&&k===a.actionValue}).forEach(function(a){a.action=g;g.includes("Color")||(a.actionValue="")}):(a=this.actions.find(function(a){return a.action===f}),a.action=g,a.actionValue="",a.domainId=-1,this.actions=this.actions.filter(function(a){return a.action!==
f}))}}else"action_message_input"===a?this.actions.find(function(a){return"message"===a.action}).actionValue=b.value:"action_lockActionButton_input"===a&&this.actions.filter(function(a){return"lockActionButton"===a.action}).forEach(function(a){a.actionValue=b.value});"INPUT"!==b.tagName&&this.render()};a.prototype.resetActSubtableRoot=function(){this.actSubtableRoot=-1;if(!builder.ifListingPage()){var a=this.cons.length;for(var b={},c=0;c<a;b={$jscomp$loop$prop$_condition$648:b.$jscomp$loop$prop$_condition$648},
c++){b.$jscomp$loop$prop$_condition$648=this.cons[c];var d=M.find(function(a){return function(b){return a.$jscomp$loop$prop$_condition$648.domainId===parseInt(b.domainId)}}(b));if(d){d=builder.findSubtableHeadField(d.x,d.y);this.actSubtableRoot=builder.subtableKeys[d.x+","+d.y];break}}a=this.actions.length;b={};for(c=0;c<a;b={$jscomp$loop$prop$_action$651:b.$jscomp$loop$prop$_action$651},c++)if(b.$jscomp$loop$prop$_action$651=this.actions[c],d=M.find(function(a){return function(b){return a.$jscomp$loop$prop$_action$651.domainId===
parseInt(b.domainId)}}(b))){d=builder.findSubtableHeadField(d.x,d.y);this.actSubtableRoot=builder.subtableKeys[d.x+","+d.y];break}else Object.values(builder.subtableKeys).some(function(a){return function(b){return b===a.$jscomp$loop$prop$_action$651.domainId}}(b))&&(this.actSubtableRoot=b.$jscomp$loop$prop$_action$651.domainId)}};a.prototype.execute=function(){for(var a=this.matchCondition(),b=this.actions.length,c={},d=0;d<b;c={$jscomp$loop$prop$_act$656:c.$jscomp$loop$prop$_act$656,$jscomp$loop$prop$domainId$655:c.$jscomp$loop$prop$domainId$655},
d++)c.$jscomp$loop$prop$_act$656=this.actions[d],!window.webForm&&biffdata.ifListingPage()&&biffdata.rootDomainId===c.$jscomp$loop$prop$_act$656.domainId?biffdata.biffs.forEach(function(b){return function(c){c.dataType!==HEADER||c.hasAttribute("hide")||(new n(c.domainId,b.$jscomp$loop$prop$_act$656.action,b.$jscomp$loop$prop$_act$656.actionValue,!0)).act(a)}}(c)):!window.webForm&&biffdata.subtableKeyFields.includes(c.$jscomp$loop$prop$_act$656.domainId)?M.forEach(function(b){return function(c){var d=
biffdata.findBiffV2(c,!0)[0];d.parentDomainId!==b.$jscomp$loop$prop$_act$656.domainId||d.hasAttribute("hide")||(new n(c,b.$jscomp$loop$prop$_act$656.action,b.$jscomp$loop$prop$_act$656.actionValue,!0)).act(a)}}(c)):window.webForm&&document.querySelector("DIV[subRoot='"+c.$jscomp$loop$prop$_act$656.domainId+"']")?(c.$jscomp$loop$prop$domainId$655=document.querySelector("DIV[subRoot='"+c.$jscomp$loop$prop$_act$656.domainId+"']").getAttribute("domainId"),M.forEach(function(b){return function(c){c.subgroup===
b.$jscomp$loop$prop$domainId$655&&(new n(c.domainId,b.$jscomp$loop$prop$_act$656.action,b.$jscomp$loop$prop$_act$656.actionValue,!0)).act(a)}}(c))):c.$jscomp$loop$prop$_act$656.act(a)};m.prototype.matchCondition=function(a,b){window.webForm?this._matchCondition_WebForm(a,b):this._matchCondition_NUI(a,b)};m.prototype._matchCondition_NUI=function(a,b){var c=biffdata.findBiffV2(this.domainId,this.isSubtable),d=a.length;if(c.length){var e=c.map(function(a){return a.ip?a.ip.biff:null}).every(function(a){return biffdata.ifSubtableDataBiff(a)});
var f=M.includes(this.domainId)&&e;e=c.length<d-2;if(this.isMultiple())if(f){var g=0;for(f=1;f<d;f++)if(!e||!(g>=c.length||Q[f-1]!==c[g].y)){var k=c[g++].ip.valueList;k=this.matchListValues(k);a[f]=L(a[f],k,b)}a[0]=a.slice(1).some(function(a){return a})}else{if(c[0].ip)for(k=c[0].ip.valueList,k=this.matchListValues(k),f=0;f<d;f++)a[f]=L(a[f],k,b)}else if(f){g=0;for(f=1;f<d;f++)if(!e||!(g>=c.length||Q[f-1]!==c[g].y))if(k=c[g++])k=k.value,k=this.matchValue(k),a[f]=L(a[f],k,b);a[0]=a.slice(1).some(function(a){return a})}else for(k=
c[0].value,k=this.matchValue(k),f=0;f<d;f++)a[f]=L(a[f],k,b)}return a};m.prototype._matchCondition_WebForm=function(a,b){var c,d=[];var e=0;for(c=webForm.widgets.length;e<c;e++){var f=webForm.widgets[e];if(parseInt(f.getAttribute("domainId"))===this.domainId){c=1;for(e=f.childElementCount;c<e;c++)f.children[c].classList.contains("webformSettingConf")||d.push(f.children[c]);break}}c=a.length;if(d.length){f=function(a){var b=a.querySelector(".fieldData, [webForm]");if(!b)return"";if("option"===b.getAttribute("webForm")&&
"DIV"===b.tagName){var c=[];b=b.closest("DIV");do{var d=b.querySelector("input"),e=webForm.unformatValue(d.value,a.parentElement);d.checked&&c.push(e);b=b.nextElementSibling||nextElementSibling(b)}while(b&&!b.classList.contains("webformSettingConf"));return c.join("|")}return webForm.unformatValue(b.value,a.parentElement)};var g=this.domainId;e=M.some(function(a){return a.domainId===g});if(this.isMultiple())if(e){for(e=1;e<c;e++){var k=f(d[e-1]);k=this.matchListValues(k);a[e]=L(a[e],k,b)}a[0]=a.slice(1).some(function(a){return a})}else for(k=
f(d[0]),k=this.matchListValues(k),e=0;e<c;e++)a[e]=L(a[e],k,b);else if(e){for(e=1;e<c;e++)k=f(d[e-1]),k=this.matchValue(k),a[e]=L(a[e],k,b);a[0]=a.slice(1).some(function(a){return a})}else for(k=f(d[0]),k=this.matchValue(k),e=0;e<c;e++)a[e]=L(a[e],k,b)}return a};m.prototype.matchListValues=function(a){var b=this.getDomainHeader(),c=this.value;"$USER"===c&&b.hasAttribute("usrref")&&(c=userName);return this.operator===RuleConditionOperator.Contains?a.includes(c):!a.includes(c)};m.prototype.matchValue=
function(a){var b=this.getDomainHeader();if(!b)return!1;var c=b.hasAttribute("fmt_n")&&b.getAttribute("fmt_n").includes("%"),d=this.value;312===this.domainId&&("N"===d?d=lm.approval_status_new:"P"===d?d=lm.approval_status_process:"F"===d?d=lm.approval_status_finish:"REJ"===d&&(d=lm.approval_status_rejected));if(this.operator===RuleConditionOperator.Equals)return"$USER"===d&&b.hasAttribute("usrref")&&(d=userName),c&&(d=parseFloat(d)/100),a==d;if(this.operator===RuleConditionOperator.NotEquals)return"$USER"===
d&&b.hasAttribute("usrref")&&(d=userName),c&&(d=parseFloat(d)/100),a!=d;if(this.operator===RuleConditionOperator.Contains)return a.includes(d);if(this.operator===RuleConditionOperator.NotContains)return!a.includes(d);if(this.operator===RuleConditionOperator.Greater){if(!window.webForm&&b.hasAttribute("fmt_d"))return ragic_date_parse(a,b.attr.fmt_d)>ragic_date_parse(d,b.attr.fmt_d);if(window.webForm&&b.getAttribute("fmt_d"))return a>parseDateLong(d,b.getAttribute("fmt_d"));if(isNaN(a)||isNaN(d))return a>
d;c&&(d=parseFloat(d)/100);return parseFloat(a)>parseFloat(d)}if(this.operator===RuleConditionOperator.Less){if(!window.webForm&&b.hasAttribute("fmt_d"))return ragic_date_parse(a,b.attr.fmt_d)<ragic_date_parse(d,b.attr.fmt_d);if(window.webForm&&b.getAttribute("fmt_d"))return a<parseDateLong(d,b.getAttribute("fmt_d"));if(isNaN(a)||isNaN(d))return a<d;c&&(d=parseFloat(d)/100);return parseFloat(a)<parseFloat(d)}if(this.operator===RuleConditionOperator.StartWith)return a.startsWith(d);if(this.operator===
RuleConditionOperator.EndWith)return a.endsWith(d);if(this.operator===RuleConditionOperator.Special){if(!a)return!1;c=!1;if(!window.webForm&&b.hasAttribute("fmt_d")){var e=ragic_date_parse(a,b.attr.fmt_d);c=b.attr.fmt_d.includes("HH:mm")||b.attr.fmt_d.includes("hh:mm a")}else window.webForm&&b.getAttribute("fmt_d")&&(e=new Date(a*DAY_MILLI));if(e){a=new Date;c||a.setHours(0,0,0,0);if("$TODAY"===d)return e.getDate()===a.getDate()&&e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear();if("$YESTERDAY"===
d)return c=new Date,c.setDate(a.getDate()-1),e.getDate()===c.getDate()&&e.getMonth()===c.getMonth()&&e.getFullYear()===c.getFullYear();if("$TOMORROW"===d)return c=new Date,c.setDate(a.getDate()+1),e.getDate()===c.getDate()&&e.getMonth()===c.getMonth()&&e.getFullYear()===c.getFullYear();if("$PAST7"===d)return c=new Date,c.setDate(c.getDate()-7),c.setHours(0,0,0,0),c<e&&e<=a;if("$NEXT7"===d)return c=new Date,c.setDate(c.getDate()+7),c.setHours(0,0,0,0),c>e&&e>=a;if("$PAST30"===d)return c=new Date,c.setDate(c.getDate()-
30),c.setHours(0,0,0,0),c<e&&e<=a;if("$NEXT30"===d)return c=new Date,c.setDate(c.getDate()+30),c.setHours(0,0,0,0),c>e&&e>=a;if("$THISWEEK"===d)return a=dayjs(a),e=dayjs(e),a.week()===e.week()&&a.weekYear()===e.weekYear();if("$LASTWEEK"===d)return a.setDate(a.getDate()-7),a=dayjs(a),e=dayjs(e),a.week()===e.week()&&a.weekYear()===e.weekYear();if("$NEXTWEEK"===d)return a.setDate(a.getDate()+7),a=dayjs(a),e=dayjs(e),a.week()===e.week()&&a.weekYear()===e.weekYear();if("$THISMONTH"===d)return e.getMonth()===
a.getMonth()&&e.getFullYear()===a.getFullYear();if("$LASTMONTH"===d)return e.getMonth()===a.getMonth()-1&&e.getFullYear()===a.getFullYear()||a.getMonth()===e.getMonth()-11&&a.getFullYear()-1===e.getFullYear();if("$NEXTMONTH"===d)return e.getMonth()===a.getMonth()+1&&e.getFullYear()===a.getFullYear()||a.getMonth()-11===e.getMonth()&&a.getFullYear()===e.getFullYear()-1;if("$PAST"===d)return e<a;if("$FUTURE"===d)return e>a;if(d.startsWith("$PASTDAYS"))return d=parseInt(d.slice(9)),b=new Date,b.setDate(b.getDate()-
d),c||b.setHours(0,0,0,0),b<=e&&e<=a;if(d.startsWith("$NEXTDAYS"))return d=parseInt(d.slice(9)),b=new Date,b.setDate(b.getDate()+d),c||b.setHours(0,0,0,0),b>=e&&e>=a}}return!1};n.prototype.act=function(a){window.webForm?this._act_on_WebForm(a):this._act_on_NUI(a)};n.prototype._act_on_NUI=function(a){var b=void 0!==this.isSubtable?this.isSubtable:M.includes(this.domainId),c=a.length,d=!0,e=biffdata.findBiffV2(this.domainId,b),f=biffdata.findHeader(this.domainId,b);switch(this.action){case FormRuleActionType.Show:if(e.length)if(b){b=
e.length<c-2;for(var g=0,k=1;k<c;k++)b&&(g>=e.length||Q[k-1]!==e[g].y)||(a[k]?(r(e[g++]),d=!1):q(e[g++]));d?q(f):r(f)}else a[0]?(r(e[0]),r(f)):(q(e[0]),q(f));break;case FormRuleActionType.Hide:if(e.length)if(b){b=e.length<c-2;g=0;for(k=1;k<c;k++)b&&(g>=e.length||Q[k-1]!==e[g].y)||(a[k]?q(e[g++]):(r(e[g++]),d=!1));d?q(f):r(f)}else a[0]?(q(e[0]),q(f)):(r(e[0]),r(f));break;case FormRuleActionType.ShowFreeData:if(this.actionValue){var l=this.actionValue.split(",");c=biffdata.biffs.find(function(a){return a.IPType===
FREE&&a.originX===parseInt(l[0])&&a.originY===parseInt(l[1])});a[0]?r(c):q(c)}break;case FormRuleActionType.HideFreeData:if(this.actionValue){var m=this.actionValue.split(",");c=biffdata.biffs.find(function(a){return a.IPType===FREE&&a.originX===parseInt(m[0])&&a.originY===parseInt(m[1])});a[0]?q(c):r(c)}break;case FormRuleActionType.ShowSection:biffdata.sections.sections&&biffdata.sections.sections.length&&C(this.domainId,!a[0]);break;case FormRuleActionType.HideSection:biffdata.sections.sections&&
biffdata.sections.sections.length&&C(this.domainId,a[0]);break;case FormRuleActionType.Message:mode!==BROWSE&&a[0]&&R.push(this.actionValue);break;case FormRuleActionType.ShowActionButton:mode===BROWSE&&(g=$("actionButton_"+this.domainId))&&(g.style.display=a[0]?"":"none");if(biffdata.ifListingPage()&&e.length&&b){b=e.length<c-2;g=0;for(k=1;k<c;k++)b&&(g>=e.length||Q[k-1]!==e[g].y)||(a[k]?(r(e[g++]),d=!1):q(e[g++]));d?q(f):r(f)}if(!biffdata.ifListingPage()){var n=this.domainId;biffdata.biffs.filter(function(a){return a.IPType===
FREE&&a.actionButton&&parseInt(a.actionButton.id)===n}).forEach(function(b){a[0]?r(b):q(b)})}break;case FormRuleActionType.HideActionButton:mode===BROWSE&&(g=$("actionButton_"+this.domainId))&&(g.style.display=a[0]?"none":"");if(biffdata.ifListingPage()&&e.length&&b){b=e.length<c-2;g=0;for(k=1;k<c;k++)b&&(g>=e.length||Q[k-1]!==e[g].y)||(a[k]?q(e[g++]):(r(e[g++]),d=!1));d?q(f):r(f)}if(!biffdata.ifListingPage()){var p=this.domainId;biffdata.biffs.filter(function(a){return a.IPType===FREE&&a.actionButton&&
parseInt(a.actionButton.id)===p}).forEach(function(b){a[0]?q(b):r(b)})}break;case FormRuleActionType.LockActionButton:if(mode===BROWSE){var t=this.domainId;if(d=$("actionButton_"+t))f=biffdata.buttons.find(function(a){return parseInt(a.id)===t}),f.formRuleLockActionButton=!!a[0],f.lockMessage=this.actionValue,a[0]?(d.classList.remove("topButtonWholeLight"),d.classList.add("topButtonWholeGrey")):(d.classList.remove("topButtonWholeGrey"),d.classList.add("topButtonWholeLight"));biffdata.biffs.filter(function(a){return a.IPType===
FREE&&a.actionButton&&parseInt(a.actionButton.id)===t}).forEach(function(b){if(b=nui._getcell(b.x,b.y).querySelector(".topButtonWhole"))a[0]?(b.classList.remove("topButtonWholeLight"),b.classList.add("topButtonWholeGrey")):(b.classList.remove("topButtonWholeGrey"),b.classList.add("topButtonWholeLight"))})}if(biffdata.ifListingPage()&&e.length&&b)for(d=e.length<c-2,f=0,b={},g=1;g<c;b={$jscomp$loop$prop$topButtonWhole$658:b.$jscomp$loop$prop$topButtonWhole$658},g++)if(!d||!(f>=e.length||Q[g-1]!==e[f].y)){k=
e[f];k=nui._getcell(k.x,k.y);b.$jscomp$loop$prop$topButtonWhole$658=k.querySelector(".topButtonWhole");if(k=biffdata.buttons.find(function(a){return function(b){return b.id===a.$jscomp$loop$prop$topButtonWhole$658.id}}(b)))k.formRuleLockActionButton=!!a[g],k.lockMessage=this.actionValue,a[g]?(b.$jscomp$loop$prop$topButtonWhole$658.classList.remove("topButtonWholeLight"),b.$jscomp$loop$prop$topButtonWhole$658.classList.add("topButtonWholeGrey")):(b.$jscomp$loop$prop$topButtonWhole$658.classList.remove("topButtonWholeGrey"),
b.$jscomp$loop$prop$topButtonWhole$658.classList.add("topButtonWholeLight"));++f}break;case FormRuleActionType.Readonly:if(e.length)if(b)for(d=e.length<c-2,f=0,b=1;b<c;b++)d&&(f>=e.length||Q[b-1]!==e[f].y)||w(e[f++],a[b]);else w(e[0],a[0]);break;case FormRuleActionType.HeaderBGColor:f&&(a[0]?x(f,"backgroundColor",this.actionValue):E(f,"backgroundColor"));break;case FormRuleActionType.HeaderColor:f&&(a[0]?x(f,"color",this.actionValue):E(f,"color"));break;case FormRuleActionType.ValueBGColor:if(e.length)if(b)for(d=
e.length<c-2,f=0,b=1;b<c;b++)d&&(f>=e.length||Q[b-1]!==e[f].y)||(g=e[f++])&&(a[b]?x(g,"backgroundColor",this.actionValue):E(g,"backgroundColor"));else a[0]?x(e[0],"backgroundColor",this.actionValue):E(e[0],"backgroundColor");break;case FormRuleActionType.ValueColor:if(e.length)if(b)for(d=e.length<c-2,f=0,b=1;b<c;b++)d&&(f>=e.length||Q[b-1]!==e[f].y)||(a[b]?x(e[f++],"color",this.actionValue):E(e[f++],"color"));else a[0]?x(e[0],"color",this.actionValue):E(e[0],"color")}};n.prototype._act_on_WebForm=
function(a){var b=this.domainId,c=void 0!==this.isSubtable?this.isSubtable:M.some(function(a){return a.domainId===b}),d=a.length,e=!0,f=[],g=location.href.includes("ver=new");Array.from(webForm.widgets).filter(function(a){return parseInt(a.getAttribute("domainId"))===b}).filter(function(a){return g&&c?a.hasAttribute("subgroup"):!0}).forEach(function(a){Array.from(a.children).forEach(function(a,b){0<b&&f.push(a)})});switch(this.action){case FormRuleActionType.Show:if(f.length)if(c){for(var k=1;k<d;k++)a[k]?
(t(f[k-1]),e=!1):p(f[k-1]);e?p(f[0].parentElement):t(f[0].parentElement)}else a[0]?(t(f[0]),t(f[0].parentElement)):(p(f[0]),p(f[0].parentElement));break;case FormRuleActionType.Hide:if(f.length)if(c){for(k=1;k<d;k++)a[k]?p(f[k-1]):(t(f[k-1]),e=!1);e?p(f[0].parentElement):t(f[0].parentElement)}else a[0]?(p(f[0]),p(f[0].parentElement)):(t(f[0]),t(f[0].parentElement));break;case FormRuleActionType.ShowFreeData:if(this.actionValue){var l=this.actionValue.split(",");d=Array.from(document.querySelectorAll(".webformFreeValue")).find(function(a){return a.dataset.x===
l[0]&&a.dataset.y===l[1]});a[0]?t(d):p(d)}break;case FormRuleActionType.HideFreeData:if(this.actionValue){var m=this.actionValue.split(",");d=Array.from(document.querySelectorAll(".webformFreeValue")).find(function(a){return a.dataset.x===m[0]&&a.dataset.y===m[1]});a[0]?p(d):t(d)}break;case FormRuleActionType.Message:a[0]&&R.push(this.actionValue);break;case FormRuleActionType.Readonly:if(f.length)if(c)for(e=1;e<d;e++)F(f[e-1],a[e]);else F(f[0],a[0]);break;case FormRuleActionType.HeaderBGColor:f.length&&
(a[0]?D(f[0].parentElement.querySelector(".webFormfieldValue"),"backgroundColor",this.actionValue):A(f[0].parentElement.querySelector(".webFormfieldValue"),"backgroundColor"));break;case FormRuleActionType.HeaderColor:f.length&&(a[0]?D(f[0].parentElement.querySelector(".webFormfieldValue"),"color",this.actionValue):A(f[0].parentElement.querySelector(".webFormfieldValue"),"color"));break;case FormRuleActionType.ValueBGColor:if(f.length)if(c)for(e=1;e<d;e++)a[e]?D(f[e-1],"backgroundColor",this.actionValue):
A(f[e-1],"backgroundColor");else a[0]?D(f[0],"backgroundColor",this.actionValue):A(f[0],"backgroundColor");break;case FormRuleActionType.ValueColor:if(f.length)if(c)for(e=1;e<d;e++)a[e]?D(f[e-1],"color",this.actionValue):A(f[e-1],"color");else a[0]?D(f[0],"color",this.actionValue):A(f[0],"color")}};return y}(),RagicApprovalRules=function(){function a(){q=[];mode===BUILDER&&(q=Object.values(builder.cellData).filter(function(a){return!!builder.findSubtableHeadField(a.x,a.y)}))}function b(a){this.cons=
a.cons.map(function(a){return new f(a.domainId,a.operator,a.value)});this.conLogic=a.conLogic;this.isConditionAnd=function(){return"AND"===this.conLogic};this.actions=a.actions.map(function(a){return new g(a.action,a.actionValue)});this.actSubtableRoot=a.actSubtableRoot;var b="_rule_"+p++;this.getId=function(){return b}}function c(){l.deleteRule(this.parentNode.dataset.index)}function d(){var a=ruleConditionHelper.createDefaultConditionJSON();this.cons.push(new f(a.domainId,a.operator,a.value));this.render()}
function e(a){a=a.target.closest("._form_rule_condition").dataset.condition_index;this.cons.splice(a,1);this.resetActSubtableRoot();this.render()}function f(a,b,c){this.domainId=parseInt(a);this.value=c;var d,e=!1;mode===BUILDER&&(e=(d=builder.findField(a))&&d.IPType===MSELECTOR);this.getDomainHeader=function(){return d};this.isMultiple=function(){return e};this.operator=b;if(d&&mode===BUILDER)if(e)this.operator!==RuleConditionOperator.Contains&&this.operator!==RuleConditionOperator.NotContains&&
(this.operator=RuleConditionOperator.Contains);else if(d.IPType===SELECTOR)this.operator!==RuleConditionOperator.Equals&&this.operator!==RuleConditionOperator.NotEquals&&(this.operator=RuleConditionOperator.Equals);else if(d.hasAttribute("fmt_n"))this.operator!==RuleConditionOperator.Equals&&this.operator!==RuleConditionOperator.NotEquals&&this.operator!==RuleConditionOperator.Less&&this.operator!==RuleConditionOperator.Greater&&(this.operator=RuleConditionOperator.Equals);else if(d.hasAttribute("fmt_d"))this.operator!==
RuleConditionOperator.Equals&&this.operator!==RuleConditionOperator.Less&&this.operator!==RuleConditionOperator.Greater&&this.operator!==RuleConditionOperator.Special&&(this.operator=RuleConditionOperator.Equals);else if(d.hasAttribute("sig")||d.IPType===UPLOADER||d.IPType===GRAPHICS)this.operator!==RuleConditionOperator.Equals&&this.operator!==RuleConditionOperator.NotEquals&&(this.operator=RuleConditionOperator.NotEquals);else if(this.operator===RuleConditionOperator.Greater||this.operator===RuleConditionOperator.Less)this.operator=
RuleConditionOperator.Equals}function g(a,b){this.action=a;this.actionValue=b}function k(a,b,c){Number.isInteger(c)&&(a.dataset.condition_index=c);a.dataset.mapping=b}var l={},m,n=-1,q,r,p=0,t={};Object.defineProperty(t,"ExecuteCheck",{value:"ExecuteCheck"});var v={};window.webForm||Object.defineProperties(v,{getSelectableDomainSelect:{value:function(a){return a.reduce(function(a,b){a.appendChild(new Option(b.value,b.domainId));return a},document.createElement("SELECT"))}}});l.rules=[];l.toJSONString=
function(){return encodeURIComponent(JSON.stringify(this))};l.loadRules=function(a,b){a?m=JSON.parse(decodeURIComponent(a)):(m=null,this.rules=[]);n=b;q=null};l.render=function(){if(mode===BUILDER&&(q||(a(),m?l.rules=m.rules.map(function(a){return new b(a)}):l.rules.length=0),!hasUnsavedFields())){r=document.createElement("DIV");r.id="_ragic_approval_rules";this.rules.forEach(function(a,b){a.render().dataset.index=b});var c=document.querySelector("#floatingApprovalRules"),d=c.querySelector("#approvalRulesEmptyView"),
e=c.querySelector("#floatingApprovalRulesContent"),f=document.querySelector("#approvalTable TBODY").rows[n];rm(e);0===this.rules.length?(d.style.display="",e.style.display="none",f.style.backgroundColor=""):(d.style.display="none",e.style.display="",f.style.backgroundColor="lightgrey");e.appendChild(r);c.querySelector("#approval_rules_new_button").onclick=this.addRule.bind(this);c.querySelector(".close").onclick=function(){c.style.display="none";builder.approvalItems[n].approvalRules=RagicApprovalRules.toJSONString()};
c.style.display=""}};l.addRule=function(){var a={cons:[ruleConditionHelper.createDefaultConditionJSON()],actions:[{action:t.ExecuteCheck,actionValue:""}],conLogic:"AND",actSubtableRoot:-1};a=new b(a);this.rules.unshift(a);this.render()};l.deleteRule=function(a){this.rules.splice(a,1);this.render()};b.prototype.render=function(){if(r){var a=document.createElement("DIV"),b=document.createElement("DIV"),f=document.createElement("DIV"),g=r.querySelector("#"+this.getId()),l=document.createElement("DIV"),
m=document.createElement("DIV"),n=this.actSubtableRoot,p;a.classList.add("_form_rule_container");b.classList.add("_form_rule_delete");f.classList.add("_form_rule_main");l.classList.add("_form_rule_condition_list");m.classList.add("_form_rule_action_list");var t=[];Object.keys(builder.cellData).forEach(function(a){a=builder.cellData[a];if(!q.includes(a))if(-1===n)t.push(a);else{var b=builder.findSubtableHeadField(a.x,a.y);b&&builder.subtableKeys[b.x+","+b.y]!==n||t.push(a)}});var J=this.isConditionAnd();
var L=0;for(p=this.cons.length;L<p;L++){var B=this.cons[L],y=B.getDomainHeader();if(y){if(0<L){var O=document.createElement("div"),K=document.createElement("SELECT");K.add(new Option(lm.and,"AND",J,J));K.add(new Option(lm.or,"OR",!J,!J));O.classList.add("conLogic");O.appendChild(K);K.dataset.mapping="rule_logic";l.appendChild(O)}K=v.getSelectableDomainSelect(t);O=document.createElement("DIV");O.classList.add("_form_rule_condition");K.value=B.domainId;k(K,"condition_domainId",L);O.dataset.condition_index=
L+"";O.textContent=lm["if"];O.appendChild(K);y.IPType===SELECTOR&&(K=document.createElement("SELECT"),K.add(new Option("","")),k(K,"condition_option",L),ruleConditionHelper.getSelectDomainOptions(y.domainId).then(function(a){a.reduce(function(a,b){a.appendChild(new Option(b.text,b.value));return a},this.select);this.select.value=this.condition.value;""===this.select.value&&0<this.select.options.length&&(a=this.select.options[0].value,this.select.value=a,this.condition.value=a)}.bind({condition:B,
select:K})),O.appendChild(K));var M=ruleConditionHelper.getOperatorSelect(y);y.IPType===SELECTOR&&(B.operator===RuleConditionOperator.Contains?B.operator=RuleConditionOperator.Equals:B.operator===RuleConditionOperator.NotContains&&(B.operator=RuleConditionOperator.NotEquals));M.value=B.operator;O.appendChild(M);k(M,"condition_operator",L);y.IPType===SELECTOR?O.appendChild(document.createTextNode(lm.checked)):y.IPType===MSELECTOR?(K=document.createElement("SELECT"),k(K,"condition_option",L),ruleConditionHelper.getSelectDomainOptions(y.domainId).then(function(a){a.reduce(function(a,
b){a.appendChild(new Option(b.text,b.value));return a},this.select);this.select.value=this.condition.value;""===this.select.value&&0<this.select.options.length&&(a=this.select.options[0].value,this.select.value=a,this.condition.value=a)}.bind({condition:B,select:K})),O.appendChild(K)):y.hasAttribute("sig")||y.IPType===UPLOADER||y.IPType===GRAPHICS||(y.hasAttribute("fmt_d")?(B.operator===RuleConditionOperator.Special?("$FUTURE"===B.value?(K=ruleConditionSelectProvider.conditionDateCompare,M.value=
RuleConditionOperator.Greater,K.value="$TODAY"):"$PAST"===B.value?(K=ruleConditionSelectProvider.conditionDateCompare,M.value=RuleConditionOperator.Less,K.value="$TODAY"):(K=ruleConditionSelectProvider.conditionDate,M.value=RuleConditionOperator.Equals,K.value=B.value),k(K,"condition_option",L),O.appendChild(K)):y.attr.fmt_d.includes("y")&&(K=M.value===RuleConditionOperator.Greater||M.value===RuleConditionOperator.Less?ruleConditionSelectProvider.conditionDateCompare:ruleConditionSelectProvider.conditionDate,
k(K,"condition_option",L),O.appendChild(K),K.value=""),B.operator!==RuleConditionOperator.Special&&(K=document.createElement("input"),K.type="text",K.value=B.value,k(K,"condition_input",L),O.appendChild(K),K.onfocus=outNUI,K.onblur=inNUI,K.onclick=datePickerClick.bind(null,K,y.attr.fmt_d),ragic_date_parse(B.value,y.attr.fmt_d)||(B.value="",K.value=""))):(K=document.createElement("input"),K.type="text",K.value=B.value,k(K,"condition_input",L),O.appendChild(K),K.onfocus=outNUI,K.onblur=inNUI));1<p&&
(B=document.createElement("DIV"),y=document.createElement("I"),y.classList.add("fa","fa-times"),y.addEventListener("click",e.bind(this)),B.appendChild(y),B.classList.add("_form_rule_condition_delete_wrapper"),O.appendChild(B));l.appendChild(O)}}L=document.createElement("DIV");p=document.createElement("I");p.classList.add("fa","fa-plus-circle");p.addEventListener("click",d.bind(this));L.classList.add("_form_rule_condition_add_wrapper");L.appendChild(p);l.appendChild(L);L=document.createElement("I");
L.classList.add("fa","fa-times");L.setAttribute("aria-hidden","true");b.appendChild(L);b.addEventListener("click",c);a.appendChild(b);a.appendChild(f);f.appendChild(l);f.appendChild(m);a.id=this.getId();g?r.replaceChild(a,g):r.appendChild(a);a.addEventListener("paste",this.updateRule.bind(this));a.addEventListener("change",this.updateRule.bind(this));return a}};b.prototype.updateRule=function(a){a=a.target;var b=a.dataset.mapping,c=a.dataset.condition_index;if("rule_logic"===b)this.conLogic=a.value;
else if("undefined"!==typeof c){var d=this.cons[c],e=d.getDomainHeader(),g=e.hasAttribute("fmt_d");if("condition_domainId"===b){var k=a.value;b=builder.findField(k);var l=b.hasAttribute("fmt_d"),m=d.operator,p=d.value;d.operator===RuleConditionOperator.Special&&(p="");!g&&l&&(b.attr.fmt_d.includes("y")?(m=RuleConditionOperator.Special,p="$TODAY"):p="");if(b.hasAttribute("sig")||b.IPType===UPLOADER||b.IPType===GRAPHICS)p="";d=new f(k,m,p);e=!builder.ifListingPage()&&-1!==this.actSubtableRoot&&q.includes(e)&&
!q.includes(b)||-1===this.actSubtableRoot&&!q.includes(e)&&q.includes(b);this.cons[c]=d;e&&this.resetActSubtableRoot()}else"condition_operator"===b?g?d.value.startsWith("$")?a.value===RuleConditionOperator.Equals?d.value="$TODAY":a.value===RuleConditionOperator.Less?d.value="$PAST":a.value===RuleConditionOperator.Greater&&(d.value="$FUTURE"):d.operator=a.value:d.operator=a.value:"condition_option"===b?g?d.operator===RuleConditionOperator.Special&&""===a.value?(d.operator=a.previousSibling.value,d.value=
""):""!==a.value&&(d.operator=RuleConditionOperator.Special,d.value=a.value,"$TODAY"===a.value&&(a.previousSibling.value===RuleConditionOperator.Less?d.value="$PAST":a.previousSibling.value===RuleConditionOperator.Greater&&(d.value="$FUTURE"))):d.value=a.value:"condition_input"===b&&(e.hasAttribute("fmt_n")?d.value=a.value.replace(/[^0-9\.-]+/g,""):d.value=a.value)}builder.approvalItems[n].approvalRules=RagicApprovalRules.toJSONString();"INPUT"!==a.tagName&&this.render()};b.prototype.resetActSubtableRoot=
function(){this.actSubtableRoot=-1;var a,b;var c=this.cons.length;for(b=0;b<c;b++){var d=this.cons[b];if(a=q.find(function(a){return d.domainId===parseInt(a.domainId)})){a=builder.findSubtableHeadField(a.x,a.y);this.actSubtableRoot=builder.subtableKeys[a.x+","+a.y];break}}c=this.actions.length;for(b=0;b<c;b++){var e=this.actions[b];if(a=q.find(function(a){return e.domainId===parseInt(a.domainId)})){a=builder.findSubtableHeadField(a.x,a.y);this.actSubtableRoot=builder.subtableKeys[a.x+","+a.y];break}else for(var f in builder.subtableKeys)if(builder.subtableKeys.hasOwnProperty(f)&&
builder.subtableKeys[f]===e.domainId){this.actSubtableRoot=e.domainId;break}}};return l}();RegExp.quote=function(a){return a.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")};
var dayjs=function(){var a=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,b=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,c=function(a,b,c){var d=String(a);return!d||d.length>=b?a:""+Array(b+1-d.length).join(c)+a},d={s:c,z:function(a){a=-a.utcOffset();var b=Math.abs(a),d=b%60;return(0>=a?"+":"-")+c(Math.floor(b/60),2,"0")+":"+c(d,2,"0")},m:function(a,b){var c=12*(b.year()-a.year())+(b.month()-a.month()),d=a.clone().add(c,
"month"),e=0>b-d;a=a.clone().add(c+(e?-1:1),"month");return Number(-(c+(b-d)/(e?d-a:a-d))||0)},a:function(a){return 0>a?Math.ceil(a)||0:Math.floor(a)},p:function(a){return{M:"month",y:"year",w:"week",d:"day",h:"hour",m:"minute",s:"second",ms:"millisecond",Q:"quarter"}[a]||String(a||"").toLowerCase().replace(/s$/,"")},u:function(a){return void 0===a}},e={name:lm.lang,weekdays:lm.DAY_NAMES&&14===lm.DAY_NAMES.length?lm.DAY_NAMES.slice(0,7):"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),
weekdaysShort:lm.DAY_NAMES&&14===lm.DAY_NAMES.length?lm.DAY_NAMES.slice(7):"Sun Mon Tue Wed Thu Fri Sat".split(" "),weekStart:1,yearStart:4,months:lm.MONTH_NAMES&&24===lm.MONTH_NAMES.length?lm.MONTH_NAMES.slice(0,12):"January February March April May June July August September October November December".split(" "),monthsShort:lm.MONTH_NAMES&&24===lm.MONTH_NAMES.length?lm.MONTH_NAMES.slice(12):"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),dayPeriods:lm.DAY_PERIODS&&2===lm.DAY_PERIODS.length?
lm.DAY_PERIODS:["AM","PM"],rocEraFull:lm.ROC_ERA_NAMES&&4===lm.ROC_ERA_NAMES.length?lm.ROC_ERA_NAMES.slice(0,2):["Before Republic of China","Republic of China"],rocEraShort:lm.ROC_ERA_NAMES&&4===lm.ROC_ERA_NAMES.length?lm.ROC_ERA_NAMES.slice(2,4):["Before R.O.C.","R.O.C."],japaneseEraFull:lm.JAPANESE_ERA_NAMES&&15===lm.JAPANESE_ERA_NAMES.length?lm.JAPANESE_ERA_NAMES.slice(0,5):["Meiji","Taisho","Showa","Heisei","Reiwa"],japaneseEraMedium:lm.JAPANESE_ERA_NAMES&&15===lm.JAPANESE_ERA_NAMES.length?lm.JAPANESE_ERA_NAMES.slice(5,
10):["M","T","S","H","R"],japaneseEraShort:lm.JAPANESE_ERA_NAMES&&15===lm.JAPANESE_ERA_NAMES.length?lm.JAPANESE_ERA_NAMES.slice(10):["M","T","S","H","R"]},f=lm.lang,g={};g[f]=e;var k=function(a){return a instanceof n},l=function(a,b,c){var d;if(!a)return f;"string"==typeof a?(g[a]&&(d=a),b&&(g[a]=b,d=a)):(b=a.name,g[b]=a,d=b);return c||(f=d),d},m=function(a,b,c){if(k(a))return a.clone();b=b?"string"==typeof b?{format:b,pl:c}:b:{};return b.date=a,new n(b)};d.l=l;d.i=k;d.w=function(a,b){return m(a,
{locale:b.$L,utc:b.$u,$offset:b.$offset})};var n=function(){function c(a){this.$strictParse=!0;this.$L=this.$L||l(a.locale,null,!0);this.parse(a)}var e=c.prototype;return e.parse=function(b){this.$d=function(b){var c=b.date;b=b.utc;if(null===c)return new Date(NaN);if(d.u(c))return new Date;if(c instanceof Date)return new Date(c);if("string"==typeof c&&!/Z$/i.test(c)){var e=c.match(a);if(e)return b?new Date(Date.UTC(e[1],e[2]-1,e[3]||1,e[4]||0,e[5]||0,e[6]||0,e[7]||0)):new Date(e[1],e[2]-1,e[3]||1,
e[4]||0,e[5]||0,e[6]||0,e[7]||0)}return new Date(c)}(b);this.init()},e.init=function(){var a=this.$d;this.$y=a.getFullYear();this.$M=a.getMonth();this.$D=a.getDate();this.$W=a.getDay();this.$H=a.getHours();this.$m=a.getMinutes();this.$s=a.getSeconds();this.$ms=a.getMilliseconds()},e.$utils=function(){return d},e.isValid=function(){return"Invalid Date"!==this.$d.toString()},e.isSame=function(a,b){a=m(a);return this.startOf(b)<=a&&a<=this.endOf(b)},e.isAfter=function(a,b){return m(a)<this.startOf(b)},
e.isBefore=function(a,b){return this.endOf(b)<m(a)},e.$g=function(a,b,c){return d.u(a)?this[b]:this.set(c,a)},e.year=function(a){return this.$g(a,"$y","year")},e.month=function(a){return this.$g(a,"$M","month")},e.day=function(a){return this.$g(a,"$W","day")},e.date=function(a){return this.$g(a,"$D","date")},e.hour=function(a){return this.$g(a,"$H","hour")},e.minute=function(a){return this.$g(a,"$m","minute")},e.second=function(a){return this.$g(a,"$s","second")},e.millisecond=function(a){return this.$g(a,
"$ms","millisecond")},e.unix=function(){return Math.floor(this.valueOf()/1E3)},e.valueOf=function(){return this.$d.getTime()},e.startOf=function(a,b){var c=this,e=!!d.u(b)||b,f=d.p(a);a=function(a,b){a=d.w(c.$u?Date.UTC(c.$y,b,a):new Date(c.$y,b,a),c);return e?a:a.endOf("day")};var g=function(a,b){return d.w(c.toDate()[a].apply(c.toDate(),(e?[0,0,0,0]:[23,59,59,999]).slice(b)),c)},k=this.$W;b=this.$M;var l=this.$D,m="set"+(this.$u?"UTC":"");switch(f){case "year":return e?a(1,0):a(31,11);case "month":return e?
a(1,b):a(0,b+1);case "week":return f=this.$locale().weekStart||0,k=(k<f?k+7:k)-f,a(e?l-k:l+(6-k),b);case "day":case "date":return g(m+"Hours",0);case "hour":return g(m+"Minutes",1);case "minute":return g(m+"Seconds",2);case "second":return g(m+"Milliseconds",3);default:return this.clone()}},e.endOf=function(a){return this.startOf(a,!1)},e.$set=function(a,b){var c;a=d.p(a);var e="set"+(this.$u?"UTC":"");e=(c={},c.day=e+"Date",c.date=e+"Date",c.month=e+"Month",c.year=e+"FullYear",c.hour=e+"Hours",c.minute=
e+"Minutes",c.second=e+"Seconds",c.millisecond=e+"Milliseconds",c)[a];b="day"===a?this.$D+(b-this.$W):b;"month"===a||"year"===a?(c=this.clone().set("date",1),c.$d[e](b),c.init(),this.$d=c.set("date",Math.min(this.$D,c.daysInMonth())).toDate()):e&&this.$d[e](b);return this.init(),this},e.set=function(a,b){return this.clone().$set(a,b)},e.get=function(a){return this[d.p(a)]()},e.add=function(a,b){var c,e=this;a=Number(a);b=d.p(b);var f=function(b){var c=m(e);return d.w(c.date(c.date()+Math.round(b*
a)),e)};if("month"===b)return this.set("month",this.$M+a);if("year"===b)return this.set("year",this.$y+a);if("day"===b)return f(1);if("week"===b)return f(7);b=(c={},c.minute=6E4,c.hour=36E5,c.second=1E3,c)[b]||1;c=this.$d.getTime()+a*b;return d.w(c,this)},e.subtract=function(a,b){return this.add(-1*a,b)},e.format=function(a){var c=this;if(!this.isValid())return"Invalid Date";var e=a||"YYYY-MM-DDTHH:mm:ssZ",f=d.z(this),g=this.$locale();a=this.$H;var k=this.$m,l=this.$M,m=g.weekdays,n=g.months,p=function(a,
b,d,f){return a&&(a[b]||a(c,e))||d[b].substr(0,f)},q=g.meridiem||function(a,b,c){b=g.dayPeriods;a=12>a?b[0]:b[1];return c?a.toLowerCase():a},r={YY:String(this.$y).slice(-2),YYYY:this.$y,M:l+1,MM:d.s(l+1,2,"0"),MMM:p(g.monthsShort,l,n,3),MMMM:n[l]||n(this,e),D:this.$D,DD:d.s(this.$D,2,"0"),d:String(this.$W),dd:p(g.weekdaysMin,this.$W,m,2),ddd:p(g.weekdaysShort,this.$W,m,3),dddd:m[this.$W],H:String(a),HH:d.s(a,2,"0"),h:d.s(a%12||12,1,"0"),hh:d.s(a%12||12,2,"0"),a:q(a,k,!0),A:q(a,k,!1),m:String(k),mm:d.s(k,
2,"0"),s:String(this.$s),ss:d.s(this.$s,2,"0"),SSS:d.s(this.$ms,3,"0"),Z:f};return e.replace(b,function(a,b){return b||r[a]||f.replace(":","")})},e.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},e.diff=function(a,b,c){var e;b=d.p(b);var f=m(a);a=6E4*(f.utcOffset()-this.utcOffset());var g=this-f;f=d.m(this,f);return f=(e={},e.year=f/12,e.month=f,e.quarter=f/3,e.week=(g-a)/6048E5,e.day=(g-a)/864E5,e.hour=g/36E5,e.minute=g/6E4,e.second=g/1E3,e)[b]||g,c?f:d.a(f)},e.daysInMonth=
function(){return this.endOf("month").$D},e.$locale=function(){return g[this.$L]},e.locale=function(a,b){if(!a)return this.$L;var c=this.clone();a=l(a,b,!0);return a&&(c.$L=a),c},e.clone=function(){return d.w(this.$d,this)},e.toDate=function(){return new Date(this.valueOf())},e.toJSON=function(){return this.isValid()?this.toISOString():null},e.toISOString=function(){return this.$d.toISOString()},e.toString=function(){return this.$d.toUTCString()},e.setStrictParse=function(a){this.$strictParse=a},
c}();return m.prototype=n.prototype,m.extend=function(a,b){return a(b,n,m),m},m.locale=l,m.isDayjs=k,m.unix=function(a){return m(1E3*a)},m.en=g[f],m.Ls=g,m}();
dayjs.extend(function(){return function(a,b,c){var d=(new Date).getTimezoneOffset();a=b.prototype;c.utc=function(a,c){return new b({date:a,utc:!0,format:c})};a.utc=function(){return c(this.toDate(),{locale:this.$L,utc:!0})};a.local=function(){return c(this.toDate(),{locale:this.$L,utc:!1})};var e=a.parse;a.parse=function(a){a.utc&&(this.$u=!0);this.$utils().u(a.$offset)||(this.$offset=a.$offset);e.call(this,a)};var f=a.init;a.init=function(){if(this.$u){var a=this.$d;this.$y=a.getUTCFullYear();this.$M=
a.getUTCMonth();this.$D=a.getUTCDate();this.$W=a.getUTCDay();this.$H=a.getUTCHours();this.$m=a.getUTCMinutes();this.$s=a.getUTCSeconds();this.$ms=a.getUTCMilliseconds()}else f.call(this)};var g=a.utcOffset;a.utcOffset=function(a){var b=this.$utils().u;if(b(a))return this.$u?0:b(this.$offset)?g.call(this):this.$offset;b=16>=Math.abs(a)?60*a:a;0!==a?(a=this.local().add(b+d,"minute"),a.$offset=b):a=this.utc();return a};var k=a.format;a.format=function(a){return k.call(this,a||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":
""))};a.valueOf=function(){var a=this.$utils().u(this.$offset)?0:this.$offset+d;return this.$d.valueOf()-6E4*a};a.isUTC=function(){return!!this.$u};a.toISOString=function(){return this.toDate().toISOString()};a.toString=function(){return this.toDate().toUTCString()}}}());
dayjs.extend(function(){return function(a,b,c){a=b.prototype;var d=a.format;c.en.ordinal=function(a){var b=["th","st","nd","rd"],c=a%100;return"["+a+(b[(c-20)%10]||b[c]||b[0])+"]"};a.format=function(a){var b=this.$locale(),c=this.$utils();a=(a||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|gggg|Do|X|x|k{1,2}|K{1,2}|S/g,function(a){switch(a){case "Q":return Math.ceil((this.$M+1)/3);case "Do":return b.ordinal(this.$D);case "gggg":return this.weekYear();case "wo":return b.ordinal(this.week(),
"W");case "w":case "ww":return c.s(this.week(),"w"===a?1:2,"0");case "k":case "kk":return c.s(String(0===this.$H?24:this.$H),"k"===a?1:2,"0");case "K":case "KK":return c.s(String(this.$H%12),"K"===a?1:2,"0");case "X":return Math.floor(this.$d.getTime()/1E3);case "x":return this.$d.getTime();default:return a}}.bind(this));return d.bind(this)(a)}}}());
dayjs.extend(function(){var a,b=/(\[[^[]*\])|([-:/.()\s]+)|(A|a|YYYY|YY?|MM?M?M?|Do|DD?|dddd?|hh?|HH?|kk?|KK?|mm?|ss?|S{1,3}|z|ZZ?|CMM|CDD|[RJ]G{1,3}|[RJ]YY?|[RJ]CYY?)/g,c=/\d\d/,d=/\d\d?/,e=/\d{1,4}|\u5143/,f=/\d*[^\s\d-:/.()]+/,g=/[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341]+/,k=/[\u96f6\u5143\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u842c]+/,l=function(a,b){return function(c){this[a]=+c;if(b&&this[a]>b)throw Error();}},m=[/[+-]\d\d:?\d\d/,function(a){var b=
this.zone||(this.zone={});a=a.match(/([+-]|\d\d)/g);var c=+(60*a[1])+ +a[2];b.offset=0===c?0:"+"===a[0]?-c:c}],n=function(b,c){return[c,function(c){switch(b){case "RGGG":this.beforeMinguoEra=c===a.rocEraFull[0];break;case "RGG":case "RG":this.beforeMinguoEra=c===a.rocEraShort[0]}this.beforeMinguoEra&&this.minguoYear&&(this.year=1912-minguoYear)}]},q=function(a,b){return[e,function(c){if("\u5143"===c&&!b)throw Error("`\u5143` is not accepted by "+a);this.minguoYear="\u5143"===c?1:parseInt(c);this.year=
1E3<this.minguoYear?this.minguoYear:this.beforeMinguoEra?1912-this.minguoYear:this.minguoYear+1911}]},r=function(a,b){return[k,function(c){if("\u5143"===c&&!b)throw Error("`\u5143` is not accepted by "+a);this.minguoYear="\u5143"===c?1:chineseNumberToArabic(c);this.year=1E3<this.minguoYear?minguoYear:this.beforeMinguoEra?1912-this.minguoYear:this.minguoYear+1911}]},p=function(b,c){return[c,function(c){switch(b){case "JGGG":a.japaneseEraFull.includes(c)&&(this.jpShortEra=a.japaneseEraShort[a.japaneseEraFull.indexOf(c)]);
break;case "JGG":a.japaneseEraMedium.includes(c)&&(this.jpShortEra=a.japaneseEraShort[a.japaneseEraMedium.indexOf(c)]);break;case "JG":a.japaneseEraShort.includes(c)&&(this.jpShortEra=c)}this.jpEraStartYear=japaneseDate.eraStartYear[this.jpShortEra]}]},t=function(a,b){return[e,function(c){if("\u5143"===c&&!b)throw Error("`\u5143` is not accepted by "+a);this.jpEraStartYear&&(this.year=("\u5143"===c?1:parseInt(c))+this.jpEraStartYear-1)}]},v=function(a,b){return[k,function(c){if("\u5143"===c&&!b)throw Error("`\u5143` is not accepted by "+
a);this.jpEraStartYear&&(this.year=("\u5143"===c?1:chineseNumberToArabic(c))+this.jpEraStartYear-1)}]},u={S:[/\d/,function(a){this.milliseconds=100*+a}],SS:[c,function(a){this.milliseconds=10*+a}],SSS:[/\d{3}/,function(a){this.milliseconds=+a}],s:[d,l("seconds",60)],ss:[d,l("seconds",60)],m:[d,l("minutes",60)],mm:[d,l("minutes",60)],H:[d,l("hours",24)],h:[d,l("hours",12)],HH:[d,l("hours",24)],hh:[d,l("hours",12)],k:[d,l("hours",23)],K:[d,l("hours",11)],kk:[d,l("hours",23)],KK:[d,l("hours",11)],D:[d,
l("day",31)],DD:[d,l("day",31)],Do:[f,function(b){var c=a.ordinal;this.day=b.match(/\d+/)[0];if(c)for(var d=1;31>=d;d+=1)c(d).replace(/\[|\]/g,"")===b&&(this.day=d)}],M:[d,l("month",12)],MM:[d,l("month",12)],MMM:[f,function(b){var c=a.months,d=a.monthsShort;c=d?d.findIndex(function(a){return a===b}):c.findIndex(function(a){return a.substr(0,3)===b});if(0>c)throw Error();this.month=c+1}],MMMM:[f,function(b){b=a.months.indexOf(b);if(0>b)throw Error();this.month=b+1}],CMM:[g,function(a){this.month=chineseNumberToArabic(a)}],
CDD:[g,function(a){this.day=chineseNumberToArabic(a)}],Y:[/[+-]?\d+/,l("year")],YY:[c,function(a){a=+a;this.year=a+(68<a?1900:2E3)}],YYYY:[/\d{4}/,l("year")],Z:m,ZZ:m},x=function(a,c,d,e){try{var f=function(a){a.includes("RY")||a.includes("RCY")||a.includes("JG")?a=a.replaceAll(/\W/g,"[$&]"):e=!0;var c=a.match(b),d=c.length;for(a=0;a<d;a+=1){var f=c[a],g=u[f],k=g&&g[0];g=g&&g[1];c[a]=g?{regex:k,parser:g}:f.replace(/^\[|\]$/g,"")}return function(a){for(var b={},f=0,g=0;f<d;f+=1){var k=c[f];if("string"===
typeof k)if(k!==a.substr(g,k.length)){if(void 0!==b.year&&void 0!==b.month&&void 0!==b.day&&void 0!==b.hours&&void 0!==b.minutes&&void 0===b.seconds)break;if(e)throw Error();}else g+=k.length;else{var l=k.regex;k=k.parser;var m=a.substr(g);l=l.exec(m);if(e)l=l[0];else if(Array.isArray(l)&&1<=l.length)l=l[0];else continue;k.call(b,l);a=a.replace(l,"")}}if(1>=c.length&&a.match(new RegExp(/[-:/.()\s]+/g)))throw Error();a=b.afternoon;void 0!==a&&(f=b.hours,a?12>f&&(b.hours+=12):12===f&&(b.hours=0),delete b.afternoon);
return b}}(c)(a),g=f.year,k=f.month,l=f.day,m=f.hours,n=f.minutes,p=f.seconds,q=f.milliseconds,r=f.zone,t=f.jpShortEra;if(r)return new Date(Date.UTC(g,k-1,l,m||0,n||0,p||0,q||0)+6E4*r.offset);if(!e&&!g)throw Error("Invalid Date");var w=new Date,E=g||w.getFullYear(),x=0<k?k-1:w.getMonth(),D=l||(g||k?1:w.getDate());a=m||0;n=n||0;p=p||0;q=q||0;var v=d?new Date(Date.UTC(E,x,D,a,n,p,q)):new Date(E,x,D,a,n,p,q);if(t){if(1873>g)throw Error("#Error: only parse date after 1873/01/01");}else if(c.includes("JG"))throw Error("Japanese date has no era");
return v}catch(I){return new Date("")}},E=function(){var b=new RegExp(a.dayPeriods.map(function(a){return RegExp.quote(a)}).join("|")),c=new RegExp(a.dayPeriods.map(function(a){return RegExp.quote(a.toLowerCase())}).join("|")),d=new RegExp(a.weekdays.map(function(a){return RegExp.quote(a)}).join("|")),e=new RegExp(a.weekdaysShort.map(function(a){return RegExp.quote(a)}).join("|")),f=new RegExp(a.rocEraFull.map(function(a){return RegExp.quote(a)}).join("|")),g=new RegExp(a.rocEraShort.map(function(a){return RegExp.quote(a)}).join("|")),
k=new RegExp(a.japaneseEraFull.map(function(a){return RegExp.quote(a)}).join("|")),l=new RegExp(a.japaneseEraMedium.map(function(a){return RegExp.quote(a)}).join("|")),m=new RegExp(a.japaneseEraShort.map(function(a){return RegExp.quote(a)}).join("|"));u.A=[b,function(b){this.afternoon=a.dayPeriods[1]===b}];u.a=[c,function(b){this.afternoon=a.dayPeriods[1].toLowerCase()===b}];u.ddd=[e,emptyFunction];u.dddd=[d,emptyFunction];u.RGGG=n("RGGG",f);u.RGG=n("RGG",g);u.RG=n("RG",g);u.RYY=q("RYY",!0);u.RY=
q("RY",!1);u.RCYY=r("RCYY",!0);u.RCY=r("RCY",!1);u.JGGG=p("JGGG",k);u.JGG=p("JGG",l);u.JG=p("JG",m);u.JYY=t("JYY",!0);u.JY=t("JY",!1);u.JCYY=v("JCYY",!0);u.JCY=v("JCY",!1)};return function(b,c,d){b=c.prototype;var e=b.parse;b.parse=function(b){var c=b.date,f=b.format,g=b.pl,k=b.utc;this.$u=k;f?(a=g?d.Ls[g]:this.$locale(),E(),this.$d=x(c,f,k,this.$strictParse),this.init(b),g&&(this.$L=g)):e.call(this,b)}}}());
dayjs.extend(function(){return function(a,b,c){a=b.prototype;var d=a.format;a.format=function(a){var b=this.$locale().rocEraFull,c=this.$locale().rocEraShort,e=this.year()-1911;a=(a||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|RG{1,3}|RYY?|RCYY?|CMM|CDD/g,function(a){switch(a){case "RGGG":return"["+b[1>e?0:1]+"]";case "RGG":case "RG":return"["+c[1>e?0:1]+"]";case "RYY":return 1<e?e:1===e?"zh-TW"===lm.lang||"zh-CN"===lm.lang||"ja"===lm.lang?"\u5143":1:1-e;case "RY":return 1<=e?e:1-e;case "RCYY":return 1<
e?arabicNumberToChinese(e):1===e?"\u5143":arabicNumberToChinese(1-e);case "RCY":return arabicNumberToChinese(1<=e?e:1-e);case "CMM":return arabicNumberToChinese(this.month()+1);case "CDD":return arabicNumberToChinese(this.date());default:return a}}.bind(this));return d.bind(this)(a)}}}());
dayjs.extend(function(){return function(a,b,c){a=b.prototype;var d=a.format,e={M:1868,T:1912,S:1926,H:1989,R:2019};a.japaneseEra=function(a){a=a===JAPANESE_ERA_FULL?this.$locale().japaneseEraFull:a===JAPANESE_ERA_MEDIUM?this.$locale().japaneseEraMedium:a===JAPANESE_ERA_SHORT?this.$locale().japaneseEraShort:this.$locale().japaneseEraFull;return this.isSame(c("1873/01/01"))||this.isAfter(c("1873/01/01"))&&this.isBefore(c("1912/07/30"))?a[0]:this.isSame(c("1912/07/30"))||this.isAfter(c("1912/07/30"))&&
this.isBefore(c("1926/12/25"))?a[1]:this.isSame(c("1926/12/25"))||this.isAfter(c("1926/12/25"))&&this.isBefore(c("1989/01/08"))?a[2]:this.isSame(c("1989/01/08"))||this.isAfter(c("1989/01/08"))&&this.isBefore(c("2019/05/01"))?a[3]:this.isSame(c("2019/05/01"))||this.isAfter(c("2019/05/01"))?a[4]:null};a.japaneseEraYear=function(){var a=this.japaneseEra(JAPANESE_ERA_SHORT);return this.year()-e[a]+1};a.japaneseDayPeriod=function(){return this.$locale().dayPeriods[12>this.hour()?0:1]};a.format=function(a){if(a.includes("JG")&&
this.isBefore(c(new Date("1873/01/01"))))return"#Error: only format date after 1873/01/01";var b=this.japaneseEraYear();a=(a||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|JG{1,3}|JYY?|JCYY?|CMM|CDD/g,function(a){switch(a){case "JGGG":return"["+this.japaneseEra(JAPANESE_ERA_FULL)+"]";case "JGG":return"["+this.japaneseEra(JAPANESE_ERA_MEDIUM)+"]";case "JG":return"["+this.japaneseEra(JAPANESE_ERA_SHORT)+"]";case "JYY":return"zh-TW"!==lm.lang&&"zh-CN"!==lm.lang&&"ja"!==lm.lang||1!==b?b:"\u5143";case "JY":return b;
case "JCYY":return a=arabicNumberToChinese(b),"\u4e00"===a?"\u5143":a;case "JCY":return arabicNumberToChinese(b);case "CMM":return arabicNumberToChinese(this.month()+1);case "CDD":return arabicNumberToChinese(this.date());default:return a}}.bind(this));return d.bind(this)(a)}}}());dayjs.extend(function(){return function(a,b){b.prototype.isLeapYear=function(){return 0===this.$y%4&&0!==this.$y%100||0===this.$y%400}}}());
dayjs.extend(function(){return function(a,b){a=b.prototype;a.week=function(a){if(void 0===a&&(a=null),null!==a)return this.add(7*(a-this.week()),"day");a=this.$locale().yearStart||1;if(11===this.month()&&25<this.date()){var b=this.startOf("year").add(1,"year").date(a),c=this.endOf("week");if(b.isBefore(c))return 1}a=this.startOf("year").date(a).startOf("week").subtract(1,"millisecond");a=this.diff(a,"week",!0);return 0>a?this.startOf("week").week():Math.ceil(a)};a.weeks=function(a){return void 0===
a&&(a=null),this.week(a)}}}());dayjs.extend(function(){return function(a,b){b.prototype.weekYear=function(){var a=this.month(),b=this.week(),e=this.year();return 1===b&&11===a?e+1:e}}}());
dayjs.extend(function(){var a={},b={},c={d:"D",dd:"DD",y:"YYYY",yy:"YY",yyy:"YYYY",yyyy:"YYYY",a:"A",A:"A",M:"M",MM:"MM",MMM:"MMM",MMMM:"MMMM",h:"h",hh:"hh",H:"H",HH:"HH",m:"m",mm:"mm",s:"s",ss:"ss",S:"SSS",SS:"SSS",SSS:"SSS",E:"ddd",EE:"ddd",EEE:"ddd",EEEE:"dddd",EEEEE:"dddd",EEEEEE:"dddd",D:"DDD",w:"W",ww:"WW",z:"ZZ",zzzz:"Z",Z:"ZZ",X:"ZZ",XX:"ZZ",XXX:"Z",u:"E"},d={D:"d",DD:"dd",YY:"yy",YYY:"yyyy",YYYY:"yyyy",a:"a",A:"a",M:"M",MM:"MM",MMM:"MMM",MMMM:"MMMM",h:"h",hh:"hh",H:"H",HH:"HH",m:"m",mm:"mm",
s:"s",ss:"ss",S:"S",SS:"S",SSS:"S",ddd:"E",dddd:"EEEE",DDD:"D",W:"w",WW:"ww",ZZ:"z",Z:"XXX",E:"u"},e=function(a,b){for(var c=a.length,d=0,e=-1,g=null,k,p="";d<c;d++){k=a.charAt(d);if(null===g||g!==k)p=f(a,b,e,d,p),e=d;g=k}return f(a,b,e,d,p)},f=function(a,b,c,d,e){-1!==c&&(a=a.substring(c,d),b[a]&&(a=b[a]),e+=a);return e};return function(f,k,l){var g=k.prototype;g.__translateJavaFormat=e;g.toDayjsFormatString=function(b){if(!a[b]){for(var d="",f=/[^']+|('[^']*')/g,g;g=f.exec(b);)g=g[0],d=g.match(/'(.*?)'/)?
d+("["+g.substring(1,g.length-1)+"]"):d+e(g,c);a[b]=d}return a[b]};l.toDayjsFormatString=function(a){return g.toDayjsFormatString(a)};g.formatWithJDF=function(a){return this.format(this.toDayjsFormatString(a))};g.toJDFString=function(a){b[a]||(b[a]=e(a,d));return b[a]}}}());
dayjs.extend(function(){var a={Ryy:"RYY",Ry:"RY",RCyy:"RCYY",RCy:"RCY",Jyy:"JYY",Jy:"JY",JCyy:"JCYY",JCy:"JCY"};return function(b,c,d){var e=c.prototype;e.toUpperCaseFormat=function(b){for(var c in a)b=b.replaceAll(new RegExp(c,"g"),a[c]);return b};d.toUpperCaseFormat=function(a){return e.toUpperCaseFormat(a)};e.formatWithREDF=function(a){return this.formatWithJDF(this.toUpperCaseFormat(a))}}}());Date.prototype.isValid=function(){return!isNaN(this.getTime())};
function LZ(a){return(0>a||9<a?"":"0")+a}function formatDate(a,b){a||console.log("formatDate() needs a date");b+="";return dayjs(a).formatWithREDF(b)}
function formatRepeatDate(a,b){var c="";switch(b){case REPEAT_DATE_TYPE_YEARLY:b=lm.MONTH_NAMES[a.getMonth()];a=a.getDate();switch(a){case 1:c="st";break;case 2:c="nd";break;case 3:c="rd";break;default:c="th"}c=getBundleString("repeatDate_display_yearly",[b,a,c]);break;case REPEAT_DATE_TYPE_MONTHLY:a=a.getDate();switch(a){case 1:c="st";break;case 2:c="nd";break;case 3:c="rd";break;default:c="th"}c=getBundleString("repeatDate_display_monthly",[a,c]);break;case REPEAT_DATE_TYPE_WEEKLY:a=lm.DAY_NAMES[a.getDay()+
7],c=getBundleString("repeatDate_display_weekly",[a])}return c}function getDateFromFormat(a,b){a+="";if(!a||!b)return NaN;a=dayjs(a,dayjs.toDayjsFormatString(dayjs.toUpperCaseFormat(b.trim())));return a.isValid()?a.toDate().getTime():NaN}
function smartParseDate(a,b,c){var d=b.match(/y{4}|M{3,4}|RG{2,3}|JG{2,3}|Ryy|Jyy|RCyy|JCyy/g),e={yyyy:"y",MMMM:"MM",MMM:"MM",RGGG:"RG",RGG:"RG",JGGG:"JG",JGG:"JG",Ryy:"Ry",Jyy:"Jy",RCyy:"RCy",JCyy:"JCy"};for(f in e)b=b.replace(f,e[f]);var f=null;for(var g=!1,k=0;k<SMART_DATE_FORMATS.length;k++)if(SMART_DATE_FORMATS[k].includes(b)){f=SMART_DATE_FORMATS[k];g=3===k;break}c&&g&&!isNaN(parseFloat(a))&&!a.includes(":")&&(b=parseInt(a),c=Math.floor(b/60),b%=60,a=Math.round(60*(parseFloat(a)-parseInt(a))),
a=(10>c?"0"+c:""+c)+":"+(10>b?"0"+b:""+b)+":"+(10>a?"0"+a:""+a));if(!f)return parseDate(a);for(b=0;b<f.length;b++){c=a;var l=f[b];if(Array.isArray(d))for(var m=0;m<d.length;m++)g=d[m],(k=e[g])&&(l=l.replace(k,g));g=l;c=getDateFromFormat(c,g);if(!isNaN(c))return new Date(c)}return parseDate(a)}
function parseDate(a,b){var c=[];c=c.concat(ROC_SUGGEST_FORMATS);c=c.concat(JAPANESE_SUGGEST_FORMATS);c=b?c.concat("y/M/d","y-M-d","yMd","y/MM/dd","y-MM-dd","yMMdd","MMM d, y","MMM d, yy","MMM d,y","MMM d,yy","y-MMM-d","yy-MMM-d","d-MMM-y","d-MMM-yy","MMM d","y/M/d HH:mm:ss","yMdHHmmss","y/MM/dd HH:mm:ss","yMMddHHmmss","M/d/y","M/d/yy","M-d-y","M-d-yy","M.d.y","M.d.yy","MM/dd/y","MM/dd/yy","MM-dd-y","MM-dd-yy","MM.dd.y","MM.dd.yy","MMM-d","M/d","M-d","d/M/y","d/M/yy","d-M-y","d-M-yy","d.M.y","d.M.yy",
"d-MMM","d/M","d-M"):c.concat("y/M/d","y-M-d","yMd","Mdy","Mdyy","dMy","dMyy","MMM d, y","MMM d, yy","MMM d,y","MMM d,yy","y-MMM-d","yy-MMM-d","d-MMM-y","d-MMM-yy","MMM d","y/M/d HH:mm:ss","yy/M/d HH:mm:ss","yMdHHmmss","yyMdHHmmss","M/d/y","M/d/yy","M-d-y","M-d-yy","M.d.y","M.d.yy","MMM-d","M/d","M-d","Md","d/M/y","d/M/yy","d-M-y","d-M-yy","d.M.y","d.M.yy","d-MMM","d/M","d-M","dM","d");for(var d=0;d<c.length;d++)if(b=getDateFromFormat(a,c[d]),!isNaN(b))return new Date(b);return null}
var normalizedCache={};
function normalizeFormat(a,b,c){normalizedCache||(normalizedCache={});if(normalizedCache[a+b+c])return normalizedCache[a+b+c];a+="";var d=[-1,"","","",-1,-1,"","",1,-1],e=a.split(";");if(1<e.length){var f="",g="",k=!1;for(m=0;m<e[1].length;m++){var l=e[1].charAt(m);"#"==l||"0"==l||l==b||l==c?k=!0:k?g+=l:f+=l}d[6]=f;d[7]=g}e=e[0];var m;f=1;var n=k=g=-1,q=-1,r=-1,p=0;for(m=0;m<e.length;m++)l=e.charAt(m),"#"==l||"0"==l||l==b||l==c?(1==f&&(f=2),2==f?(l==b?g=m:l==c&&-1==k?k=m:"0"==l&&(-1==k?-1==q?q=1:
q++:-1==r?r=1:r++),("#"==l||"0"==l)&&-1!=k&&(-1==p?p=1:p++),l!=b&&(d[f]+=e.charAt(m))):d[f]+=e.charAt(m)):(2==f&&(f=3),d[f]+=e.charAt(m));-1!=g&&(n=m-g-1);d[0]=n;d[4]=q;d[5]=r;d[9]=p;-1!=d[3].indexOf("%")?d[8]=100:-1!=d[3].indexOf("\u2030")&&(d[8]=1E3);return normalizedCache[a+b+c]=d}
function cleanUpNumber(a,b,c){if(!a)return a;b||c||(b=",",c=".");a=a.toString();/^(-)?[0-9]+(\.[0-9]+)?$/.test(a)||(a=a.split(b).join(" ").split(c).join(".").split(" ").join(","));b=a.includes(",");if(!isNaN(parseFloat(a))&&!b)return a;for(var d=!1,e=0,f=!1,g=0;g<a.length;g++)c=a.charCodeAt(g),48<=c&&57>=c?d=!0:46==c?f=!0:44==c&&(b=!0),d||46==c||e++;0<e&&(a=a.substring(e));f&&(a="0"+a);b&&(a=a.replace(/,/g,""));return a}
function formatNumber(a,b,c,d){c||d||(c=",",d=".");b=normalizeFormat(b,c,d);a*=b[8];var e=parseInt(b[9]),f=a.toString(),g="-"===f.charAt(0);0<=e&&(a=g?-1*Math.round(-1*a*Math.pow(10,e))/Math.pow(10,e):Math.round(a*Math.pow(10,e))/Math.pow(10,e));f=a.toString();(g="-"===f.charAt(0))&&(f=f.substring(1));a=f.split(".");var k=f=0;-1!=b[4]&&(f=b[4]-a[0].length);-1!=b[5]&&(k=b[5]-(1<a.length?a[1].length:0));var l="",m="";for(e=0;e<f;e++)l+="0";for(e=0;e<k;e++)m+="0";a[0]=l+a[0];a[1]=(a[1]?a[1]:"")+m;if(-1!=
b[0]){f="";k=0;for(e=a[0].length;0<=e;e--)f=a[0].charAt(e)+f,0==k%3&&0!=k&&0<e&&(f=c+f),k++;a[0]=f}return g&&(0<b[6].length||0<b[7].length)?b[6]+a[0]+(0<a[1].length?d+a[1]:"")+b[7]:(g?"-":"")+b[1]+a[0]+(0<a[1].length?d+a[1]:"")+b[3]}function ragic_phone_ifFormatMatch(a,b){if(!a)return!1;for(var c=0;c<b.length;c++){var d=a.charAt(c),e=b.charAt(c);if(!d)break;if("X"===e||"x"===e){if(!/[0-9]/.test(d))return!1}else if(d!==e)return!1}return a.length>b.length&&/[^\d]/.test(a.slice(b.length))?!1:!0}
function ragic_phone_unformat(a,b){if(!a)return"";if(-1===b.search(/[^X]/gim))return a;if(ragic_phone_ifFormatMatch(a,b)){for(var c="",d=0;d<b.length;d++){var e=a.charAt(d),f=b.charAt(d);if(!e)break;if("X"===f||"x"===f)c+=e}return c+=a.slice(b.length)}if(/^8-[0-9]{4}-[0-9]{2}-[0-9]{2}-[0-9]{2}$/.test(a))return a.substr(2).replace(/-/g,"");a=a.replace(/\+(\d*)/g,"").replace(/[()]/g,"");b=b.replace(/\+(\d*)/g,"").replace(/[()]/g,"").replace(/\d/g,"").replace(/x/gim,"");for(c=0;c<b.length;c++)d=b.charAt(c),
a=a.replace(new RegExp(RegExp.quote(d),"gm"),"");-1!==a.search(/\./gim)&&(a=a.replace(/\./gim,""));return a}function ragic_phone_format(a,b){if(!a)return"";if(!b.charAt)return a;for(var c="",d=0,e=0;e<b.length;e++)"X"===b.charAt(e)||"x"===b.charAt(e)?d<a.length&&(c+=a.charAt(d),d++):c+=b.charAt(e);for(;d<a.length;d++)c+=a.charAt(d);return c}function ragic_phone_reformat(a,b){return ragic_phone_format(ragic_phone_unformat(a,b),b)}
function ragic_date_parse(a,b,c,d){a+="";if(!a||0===a.length)return null;var e=getDateFromFormat(a,b);isNaN(e)||(e=new Date(e));e||(e=getDateFromFormat(a,getStandardFormat(b)),isNaN(e)||(e=new Date(e)));e||!d&&isNumeric(a)&&(!b.includes("y")||b.includes("M")||b.includes("d"))||(e=smartParseDate(a,b,c));return e}
function ragic_date_format(a,b){if(!a||0===a.length)return"";var c=getDateFromFormat(a,b);isNaN(c)||(c=new Date(c));if(!c){var d=getStandardFormat(b);c=getDateFromFormat(a,d);isNaN(c)&&!d.includes("y")&&(c=getDateFromFormat(a,"yyyy/MM/dd HH:mm:ss"));isNaN(c)||(c=new Date(c))}c||(c=smartParseDate(a,b));return c?formatDate(c,b):""}
function ragic_date_parseV2(a,b){var c=getStandardFormat(b),d=getDateFromFormat(a,b);isNaN(d)||(d=new Date(d));d||(d=getDateFromFormat(a,c),isNaN(d)&&!c.includes("y")&&(d=getDateFromFormat(a,"yyyy/MM/dd HH:mm:ss")),isNaN(d)||(d=new Date(d)));d||(d=smartParseDate(a,b));return d}
function ragic_number_format(a,b,c,d){if(!a)return a;a=""+a;if(/[+-]?\d+(\.\d+)?(e[+-]?\d+)/g.test(a))var e=Number.parseFloat(a).toFixed(20);else e=a.match(/[+-]?\d+(\.\d+)?/g),e=parseFloat(e.reduce(function(a,b){return a+Math.abs(b)}));return isNaN(e)?a:formatNumber(e,b,c,d)}
function getStandardFormat(a,b,c){b=b&&18<b.length;if(!a)return"yyyy/MM/dd";var d=a.includes("y")||a.includes("M")||a.includes("d")||a.includes("E"),e=a.includes("H")||a.includes("h")||a.includes("m")||a.includes("s");a=c&&!a.includes("s");return d&&e||b?a?"yyyy/MM/dd HH:mm":"yyyy/MM/dd HH:mm:ss":d?"yyyy/MM/dd":e?a?"HH:mm":"HH:mm:ss":"yyyy/MM/dd"}function newlineTranslate(a){return a.replace(/\r\n/g,"\n")}function arabicNumberToChinese(a){return SPELLNUMBER(a,"cht",{smallCase:!0})}
function chineseNumberToArabic(a){var b=a.length,c="\u96f6O\uff2f\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d".split("");if(3<=b){for(var d="",e=0;e<b;e++){if(!c.includes(a[e]))return _chineseNumberToArabic(a);d+=String(_chineseNumberToArabic(a[e]))}return parseInt(d)}return _chineseNumberToArabic(a)}
function _chineseNumberToArabic(a){var b=0,c=0,d=1,e;a=a.split("");for(var f={"\u96f6":0,O:0,"\uff2f":0,"\u4e00":1,"\u4e8c":2,"\u5169":2,"\u4e09":3,"\u56db":4,"\u4e94":5,"\u516d":6,"\u4e03":7,"\u516b":8,"\u4e5d":9},g={"\u5341":{value:10,secUnit:!1},"\u767e":{value:100,secUnit:!1},"\u5343":{value:1E3,secUnit:!1},"\u842c":{value:1E4,secUnit:!0},"\u5104":{value:1E8,secUnit:!0}},k=0;k<a.length;k++){var l=f[a[k]];"undefined"!==typeof l?(d=l,k===a.length-1&&(c+=d)):(l=g[a[k]].value,(e=g[a[k]].secUnit)?
(c=(c+d)*l,b+=c,c=0):c+=d*l,d=0)}return b+c}var ani_obj,ani_rx,ani_xy,ani_speed=10;function animate(a,b,c,d){ani_obj=a;ani_xy=d;ani_obj.rx||(a=d?ani_obj.style.top:ani_obj.style.right,ani_obj.rx=parseInt(a.substring(0,a.length-2)));ani_rx=10>Math.abs(ani_obj.rx-b)?c:b;_animate()}
function _animate(){if(ani_obj&&0!==Math.abs(ani_obj.rx-ani_rx)){var a=ani_speed;a>Math.abs(ani_obj.rx-ani_rx)&&(a=a/4>Math.abs(ani_obj.rx-ani_rx)?Math.abs(ani_obj.rx-ani_rx):a/2>Math.abs(ani_obj.rx-ani_rx)?a/4:a/2);a>Math.abs(ani_obj.rx-ani_rx)&&(a=Math.abs(ani_obj.rx-ani_rx));ani_obj.rx>ani_rx?ani_obj.rx-=a:ani_obj.rx<ani_rx&&(ani_obj.rx+=a);ani_xy?ani_obj.style.top=ani_obj.rx+"px":ani_obj.style.right=ani_obj.rx+"px";requestAnimationFrame(_animate)}}var scrollAmount,scrollTimer,scrollCallback;
function animateScroll(a,b){a&&(scrollAmount=a);scrollCallback=b;lockAll();_animateScroll()}function _animateScrollv2(){lockAllUnlock();ctrl.currentController._load();scrollCallback&&scrollCallback();var a=ctrl.currentNUI.offsetLeft+scrollAmount;ctrl.currentNUI.style.scrollBehavior="smooth";ctrl.currentNUI_outer.style.scrollBehavior="smooth";ctrl.currentNUI.scrollLeft=a+"px"}
function _animateScroll(){var a=ctrl.isIE?360:200;a>Math.abs(scrollAmount)&&(a=Math.abs(scrollAmount));0<scrollAmount?(ctrl.currentNUI_outer.scrollLeft+=a,scrollAmount-=a):0>scrollAmount&&(ctrl.currentNUI_outer.scrollLeft-=a,scrollAmount+=a);0==scrollAmount?(lockAllUnlock(),window.clearInterval(scrollTimer),ctrl.currentController._load(),scrollCallback&&scrollCallback()):requestAnimationFrame(_animateScroll)}function lockAll(){}function lockAllUnlock(){}var nui=null,biffdata=null;
function DataController(){this.nuichain=[];this.biffchain=[];this.nui=ctrl.currentNUI;this.NONE=0;this.LEFT=1;this.RIGHT=2;this.DOWN=3;this.UP=5}
DataController.prototype.load=function(a,b,c,d,e){if(!this.semaphore&&(this.semaphore=!0,$("tutorial")&&biffdata&&biffdata.autoSave&&($("tutorial").style.display="none"),this.headerQS=a,this.dataQS=b,this.callBack=c,ctrl.NUIRowNum&&(this.dataQS+="&epp="+ctrl.NUIRowNum),mvpMode&&(ctrl.tmpMvpFilter=b),nui&&!biffdata.autoSave&&nui._focus(),this.nui)){a=this.nui.childNodes;this.ifNullResponse=!1;switch(d){case this.LEFT:ctrl.lazyRendering&&(nui.main.style.transform="translateX(100%)");1<a.length?(this.nuichain.pop(),
this.biffchain.pop(),nui=this.nuichain[this.nuichain.length-1],ctrl.lazyRendering?nui.main.style.transform="translateX(0)":nui.main.scrollLeft=0,biffdata=this.biffchain[this.biffchain.length-1],this.ifNullResponse=!0,builderCellTopPos=null):(nui=new NUI,biffdata=new BiffData,this.nuichain=[nui],this.biffchain=[biffdata],this.nui.prepend(nui.main),nui.main.style.height=ctrl.nui_outer_height+"px",ctrl.lazyRendering?(nui.main.style.transform="translateX(-20%)",setTimeout("nui.main.style.transform='translateX(0)';",
1)):ctrl.currentNUI_outer.scrollLeft=ctrl.nuiNormSize);ctrl.lazyRendering?(ctrl.currentController._load(),setTimeout("ctrl.currentController.nui.removeChild(ctrl.currentController.nui.childNodes[ctrl.currentController.nui.childNodes.length-1])",500),topButtonDisplay(),browse._trav(!1),updatePaging()):animateScroll(-1*ctrl.nuiNormSize,function(){var a=ctrl.currentController;a.nui.removeChild(a.nui.childNodes[a.nui.childNodes.length-1]);topButtonDisplay();browse._trav(!1);updatePaging()});biffdata&&
biffdata.ifListingPage()&&(nui.main.scrollTop=ctrl.tempListingScrollTop);break;case this.RIGHT:hideListingPageStuff();nui=new NUI;biffdata=new BiffData;ctrl.lazyRendering?(this.nuichain.push(nui),this.biffchain.push(biffdata),this.nui.childNodes[0].style.transform="translateX(-20%)",this.nui.appendChild(nui.main),nui.main.style.transform="translateX(-60%)",nui.main.style.zIndex=1,setTimeout("nui.main.style.transform='translateX(-100%)';ctrl.currentController._load();",1),nui.main.style.height=ctrl.nui_outer_height+
"px"):(this.nuichain.push(nui),this.biffchain.push(biffdata),this.nui.appendChild(nui.main),nui.main.style.height=ctrl.nui_outer_height+"px",animateScroll(ctrl.nuiNormSize));break;default:nui?biffdata.reset():(nui=new NUI,this.nuichain.push(nui),biffdata=new BiffData,this.biffchain.push(biffdata),this.nui.appendChild(nui.main)),e||this._load(),updatePaging(),forceRedraw(),biffdata.autoSave&&(showSubtableRowDelete(nui.fcol,nui.frow),nui._updateDelIcon())}resetHotspot()}};
DataController.prototype._load=function(){mvpMode||ctrl.silentAutoReload||(formulaBuilder.listenMapping={},resetAutoGenGuessSeq());var a=this,b=window.rmlc&&27<window.rmlc.length&&("r"===window.rmlc[12]||"w"===window.rmlc[12])?"&rmlc="+window.rmlc:"";if(sheet&&path&&ap)if(biffdata.transactionId=(new Date).getTime(),a.ifNullResponse)getPromise("/sims/form_headers.jsp","a="+encodeURIComponent(ap)+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+(mvpMode?"&mvp":"")+a.headerQS+b).then(function(a){ctrl.readRetry&&
(ctrl.readRetry=!1,floatWinSuccess(lm.reconnected),setTimeout(function(){floatWinClose()},2E3));ctrl.currentController.callBack&&ctrl.currentController.callBack();ctrl.currentController.semaphore=!1;biffdata.hasButtons()&&switchRightDock($("actionButtonWin"),$("actionButtonMain"),loadActionButtons,1);$("paymentWin")&&""==$("paymentWin").style.display&&switchRightDock($("paymentWin"),$("paymentWin"),null,2);ctrl.browseLeftResetted&&(silentReload(),ctrl.browseLeftResetted=!1)},function(){floatWinLoading(lm.saveRetry);
setTimeout(function(){ctrl.readRetry=!0;a._load()},5E3)});else if(ctrl.lazyRendering)getPromise("/sims/form_headers.jsp","a="+encodeURIComponent(ap)+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+(mvpMode?"&mvp":"")+a.headerQS+b).then(function(c){biffdata.loadHeader(c);c=sheet.split("_")[0];var d=biffdata.ifListingPage()?"psort":"psort_st",e=d+"/secondary";d=RagicStorage.localStorage.getItem(d+"/"+ap+path+"/"+c);e=RagicStorage.localStorage.getItem(e+"/"+ap+path+"/"+c);c=[];if(!ctrl.applySorting&&
d){d=d.split(",");var f=d[0];d=d[1];var g=parseInt(d)===SORT_ASC?FILTER_OPERAND.SORT_ASC:FILTER_OPERAND.SORT_DESC;d="filterPriority="+LOCALSTORAGE_PRIORITY;f=getFV2String(d+"&fv2add&fv2=",f,g,"x");c.push(f);if(e){f=e.substring(6,e.lastIndexOf("&ssd"));g=e.substring(e.lastIndexOf("&ssd")+5);e=f.split(",");f=g.split(",");g=0;for(var k=e.length;g<k;g++){var l=f[g];""!==e[g]&&""!==l&&(l=parseInt(l)===SORT_ASC?FILTER_OPERAND.SECONDARY_SORT_ASC:FILTER_OPERAND.SECONDARY_SORT_DESC,l=getFV2String(d+"&fv2add&fv2=",
e[g],l,"x"),c.push(l))}}}ctrl.applySorting=!1;getPromise("/sims/form_update.jsp","a="+encodeURIComponent(ap)+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+(mvpMode?"&mvp":"")+a.dataQS+"&"+c.join("&")+b+"&t="+(new Date).getTime()).then(function(a){biffdata.loadData(a);ctrl.currentController.callBack&&ctrl.currentController.callBack();ctrl.currentController.semaphore=!1;ctrl.isIE||(biffdata.ifListingPage()?(nui.freezeX(biffdata.dataminX+biffdata.freezeX),nui.freezeY(biffdata.dataminY)):
(biffdata.freezeX&&nui.freezeX(biffdata.dataminX+biffdata.freezeX),biffdata.freezeY&&nui.freezeY(biffdata.dataminY+biffdata.freezeY)))})});else{read(biffdata.loadHeader.bind(biffdata),"/sims/form_headers.jsp?a="+encodeURIComponent(ap)+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+(mvpMode?"&mvp":"")+a.headerQS+b,!0);var c=sheet.split("_")[0],d=biffdata.ifListingPage()?"psort":"psort_st",e=d+"/secondary";d=RagicStorage.localStorage.getItem(d+"/"+ap+path+"/"+c);e=RagicStorage.localStorage.getItem(e+
"/"+ap+path+"/"+c);c=[];if(!ctrl.applySorting&&d){d=d.split(",");var f=d[0];d=d[1];var g=parseInt(d)===SORT_ASC?FILTER_OPERAND.SORT_ASC:FILTER_OPERAND.SORT_DESC;d="filterPriority="+LOCALSTORAGE_PRIORITY;f=getFV2String(d+"&fv2add&fv2=",f,g,"x");c.push(f);if(e){f=e.substring(6,e.lastIndexOf("&ssd"));g=e.substring(e.lastIndexOf("&ssd")+5);e=f.split(",");f=g.split(",");g=0;for(var k=e.length;g<k;g++){var l=f[g];""!==e[g]&&""!==l&&(l=parseInt(l)===SORT_ASC?FILTER_OPERAND.SECONDARY_SORT_ASC:FILTER_OPERAND.SECONDARY_SORT_DESC,
l=getFV2String(d+"&fv2add&fv2=",e[g],l,"x"),c.push(l))}}}ctrl.applySorting=!1;read(function(a){biffdata.loadData(a);ctrl.currentController.callBack&&ctrl.currentController.callBack();ctrl.currentController.semaphore=!1},"/sims/form_update.jsp?a="+encodeURIComponent(ap)+"&p="+encodeURIComponent(path)+"&fn="+encodeURIComponent(sheet)+(mvpMode?"&mvp":"")+a.dataQS+"&"+c.join("&")+b+"&t="+(new Date).getTime(),!0);doFreeze()}else this.semaphore=!1};
function doFreeze(){ctrl.isIE||(biffdata.ifListingPage()?(nui.freezeX(biffdata.dataminX+biffdata.freezeX),nui.freezeY(biffdata.dataminY)):(biffdata.freezeX&&nui.freezeX(biffdata.dataminX+biffdata.freezeX),biffdata.freezeY&&nui.freezeY(biffdata.dataminY+biffdata.freezeY)))}DataController.prototype.resetBrowseLeft=function(){biffdata.ifListingPage()?setTimeout(silentReload,1E3):0>biffdata.rootNodeId||(ctrl.browseLeftResetted=!0)};
DataController.prototype.resize=function(){var a=$("v5Sidebar"),b=$("v5SidebarTD");if(a&&b){var c=b.offsetWidth;ctrl.isIE&&"none"===b.style.display&&(c=0);c||(c=mode===BUILDER?360:180);window.embed&&window.embedHideSidebar&&(c=0);var d=document.body.clientWidth;b=ctrl.isFF?document.body.clientHeight:Math.min(document.body.clientHeight,document.documentElement.clientHeight);var e=document.documentElement.clientWidth,f=$("sheetButton_toolbar"),g=$("sideCreateNewApp"),k=$("notificationTab"),l=$("searchboxDiv"),
m=$("tabsContainer"),n=f?f.clientWidth:0;g=g?g.clientWidth:0;k=k?k.clientWidth:0;ctrl.nuiNormSize=d-c;ctrl.userWidth||(ctrl.userWidth=$("user")?$("user").clientWidth:0);c=ctrl.nuiNormSize;ctrl.relTopOffset=window.embed?70:135;var q=Math.max(30,d-ctrl.userWidth-300);l&&(30===q?(l.style.display="none",l.parentElement.style.justifyContent="flex-end"):(l.style.display="",l.parentElement.style.justifyContent="space-between",$("searchbox").style.width=(500<q?500:q)+"px"));m&&(m.style.maxWidth=e+"px",e=
$("topTabs"),n=d-305-n-g-k,m=e.querySelectorAll(".undragTab"),l=e.querySelectorAll(".v6TopTabOn"),m.length&&(m=m[m.length-1].getBoundingClientRect().right-m[0].getBoundingClientRect().left,e.style.width=Math.min(m,n)+"px",e.scrollWidth>e.clientWidth+10?(f.style.display="",l.length&&(l=l[0].getBoundingClientRect(),l.right-180>n&&(e.scrollLeft+=l.right-180-n)),0===e.scrollLeft?f.children[0].style.color="#ccc":e.scrollWidth-e.clientWidth===e.scrollLeft&&(f.children[1].style.color="#ccc")):f.style.display=
"none"));0<$("mfWorkflowContent").childNodes.length&&(f=$("txtiframe"),f.style.height=b-f.getBoundingClientRect().top+"px",f.style.width=c+"px");if(f=$("accessWrapper"))n=f.getBoundingClientRect(),f.style.height=b-(n.y+1)+"px",f.style.width=d-n.x+"px";if(d=ctrl.currentNUI_outer){f=d.getBoundingClientRect();ctrl.ctrlHeight=d.offsetTop;mode===BUILDER&&(n=$("addField"),e=$("linkToolsDrop"),l=$("propSpace"),m=$("designerInfoContent"),g=$("descSetting"),n&&(n.style.height=b-f.top+"px"),e&&(e.style.maxHeight=
b-f.top+"px"),l&&(l.style.height=b-f.top-80+"px"),m&&(m.style.height=b-f.top-80+"px"),g&&(g.style.height=b-f.top-50+"px"));$("v6Query")&&(a.style.height=b-f.top+44+"px");d.style.height=b-f.top+"px";ctrl.nui_outer_height=b-f.top;d.style.width=c+"px";ctrl.nui_outer_width=d.offsetWidth;if(mvpMode){b=$("mvpWinDiv");for(a=0;a<this.nuichain.length;a++)this.nuichain[a].main.style.width=b.clientWidth+"px",this.nuichain[a].main.style.height=b.clientHeight+"px";d.style.overflow="hidden"}else for(a=0;a<this.nuichain.length;a++)this.nuichain[a].main.style.width=
ctrl.nuiNormSize+"px",this.nuichain[a].main.style.height=ctrl.nui_outer_height+"px";this.nuichain&&0<this.nuichain.length&&!ctrl.lazyRendering&&(d.scrollLeft=(this.nuichain.length-1)*this.nuichain[0].main.offsetWidth);nui&&(nui._updateFocus(),document.body.scrollTop=0,""===$("excelImport").style.display||""===$("massFileImport").style.display||$("linkWizard")?document.body.style.overflowY="auto":document.body.style.overflowY="hidden",ctrl.isIE&&((a=$("stickyHeader"))&&document.body.removeChild(a),
nui._updateStickyHeader()));$("linkWizard")&&resizeLinkWizard();builderCellLeftPos=builderCellTopPos=null;tutorialShow();updateListingPageAddRowButton()}}};var nuiController=new DataController;ctrl.currentController=nuiController;
function updateSidebarWidth(a){void 0===a&&(a={});var b=a.noSidebar||!1;a=window.userProperties.sidebarWidth;a=void 0!==ctrl.sidebarWidth?ctrl.sidebarWidth:void 0!==a?a:180;b?a=0:540<a?a=540:5>=a&&(a=5);$("v6SidebarStart")&&(a="zh-TW"===lm.lang||"zh-CN"===lm.lang?250:350);$("v5Sidebar").style.width=a+"px";$("v5SidebarTD").style.width=a+"px";$("collapseDiv").style.left=a+"px";var c,d;if((b=document.querySelectorAll(".personalQueryString"))&&(c=document.querySelectorAll(".outerQueryTriangleIcon"))&&
(d=document.querySelector(".sidebarIcon"))){d=d.offsetWidth;for(var e=0;e<c.length;e++)b[e].style.width=a-(d+b[e].offsetLeft)-32,c[e].style.left=b[e].offsetWidth+b[e].offsetLeft}setTimeout(ctrl.currentController.resize.bind(ctrl.currentController),0)}
function topButtonDisplay(){if($("bDoneBuild")){$("bSave").className="topButtonWhole";if(mode===BUILDER){var a=$("v5NUIHeaderDesign");a&&(a.style.display="none");$("bShare").style.display="none";$("bEmbed").style.display="none";$("bWebview").style.display="none";$("bReportSimple")&&($("bReportSimple").style.display="none");$("divEditing")&&($("divEditing").style.display="none");$("bDoneBuild").style.display="";$("bBrowse").style.display="none";$("bEdit").style.display="none";$("bMoreActions").style.display=
"none";$("bReports").style.display="none";$("bSave").style.display="none";$("bBack").style.display="none";$("bReload").style.display="none";$("bNewData").style.display="none";$("bDeleteEntry").style.display="none";$("bClone").style.display="none";$("bBuilderSave").style.display="";$("bDesignHistory").style.display="";$("bOtherPage").style.display="";$("entryCount").style.display="none";$("bClearFilterB").style.display="none";$("bBuilderMode").style.display="";$("bFormTool").style.display="";$("bAutoSave").style.display=
"";$("dockBarRight").style.display="none";$("dockWinRight").style.display="none";$("designModeHelper").style.display="none";builder.ifListingPage()?($("bLinkManager").style.display="none",$("bCreateSubtableFromForm").style.display="none",$("bCopyRecord").style.display="none",$("bUpdateRecord").style.display="none",$("bUpdateField").style.display="none",$("customButtonsDiv").style.display="none",$("customButtonsDiv2").style.display="none",$("bConditionalFormatting").style.display="",$("bCreateFormFromSubtable").style.display=
"none",$("sheetLinkingTitle").style.visibility="hidden",$("bOtherPage").innerHTML='<i class="fas fa-long-arrow-alt-right" style="font-size:15px;color:#555;"></i>',$("bOtherPage").title=lm.goToFormPage):(builder.newForm||($("designModeHelper").style.display=""),$("bLinkManager").style.display="",$("bCreateSubtableFromForm").style.display="",$("bCopyRecord").style.display="",$("bUpdateRecord").style.display="",$("bUpdateField").style.display="",$("customButtonsDiv").style.display="",$("customButtonsDiv2").style.display=
"",$("bConditionalFormatting").style.display="none",$("bCreateFormFromSubtable").style.display="",$("sheetLinkingTitle").style.visibility="visible",$("bOtherPage").innerHTML='<i class="fas fa-long-arrow-alt-left" style="font-size:15px;color:#555;"></i>',$("bOtherPage").title=lm.goToListingPage);displayNUIHeader()}else if(mode===UPDATE){if(a=$("v5NUIHeaderDesign"))a.style.display="none";$("designModeHelper").style.display="none";$("bEmbed").style.display="none";$("bShare").style.display="none";$("bWebview").style.display=
"none";$("bReportSimple")&&($("bReportSimple").style.display="none");$("divEditing")&&($("divEditing").style.display="none");$("bDoneBuild").style.display="none";$("bEdit").style.display="none";$("bMoreActions").style.display="none";$("bReports").style.display="none";$("bBrowse").style.display="";biffdata.autoSave?($("bSave").style.display="none",$("bBrowse").innerHTML=lm.exit):$("bSave").style.display="";$("bBack").style.display="none";$("bReload").style.display="none";$("bNewData").style.display=
"none";$("bDeleteEntry").style.display="none";$("bClone").style.display="none";$("bBuilderSave").style.display="none";$("bDesignHistory").style.display="none";$("bOtherPage").style.display="none";$("bBuilderMode").style.display="none";$("bLinkManager").style.display="none";$("entryCount").style.display="none";$("bClearFilterB").style.display="none";$("dockBarRight").style.display="none";$("dockWinRight").style.display="none";displayNUIHeader()}else if(mode==BROWSE){a=biffdata;if(owner){var b=$("v5NUIHeaderDesign");
b&&(b.style.display="")}window.access_webembed&&($("bWebview").style.display="");1<=a.role&&!window.embedHideTop?($("bMoreActions").style.display="",$("bCreateReport").style.display="",$("bReportSimple")&&($("bReportSimple").style.display="")):($("bMoreActions").style.display="none",$("bReportSimple")&&($("bReportSimple").style.display="none"),$("bCreateReport").style.display="none");$("designModeHelper").style.display="none";$("bEmbed").style.display="";$("bShare").style.display="";if(a&&!a.ifListingPage()){if(0==
a.role||2==a.role?($("divEditing")&&($("divEditing").style.display="none"),$("bNewData").style.display="none",$("bEdit").style.display="none",$("bDeleteEntry").style.display="none",$("bClone").style.display="none",$("divImport").style.display="none"):0>a.rootNodeId?($("divEditing")&&($("divEditing").style.display="none"),a.nocreate||window.embedHideTop?($("bNewData").style.display="none",$("divImport").style.display="none"):access.singleNew&&($("bNewData").style.display="",$("divImport").style.display=
""),$("bEdit").style.display="none",$("bDeleteEntry").style.display="none",$("bClone").style.display="none"):("R"!=a.rights&&!a.noedit||access.singleCopy?$("divEditing")&&($("divEditing").style.display=""):$("divEditing")&&($("divEditing").style.display="none"),"W"==a.rights?(a.nocreate||window.embedHideTop?$("bNewData").style.display="none":access.singleNew&&($("bNewData").style.display=""),a.noedit?($("bEdit").style.display="none",$("bDeleteEntry").style.display="none"):($("bEdit").style.display=
"",$("bDeleteEntry").style.display=""),access.singleDelete||($("bDeleteEntry").style.display="none"),a.nocreate||a.noedit?$("divImport").style.display="none":$("divImport").style.display="",$("bEditText")&&($("bEditText").innerHTML=lm.editEntry)):(a.nocreate||window.embedHideTop?$("bNewData").style.display="none":access.singleNew&&($("bNewData").style.display=""),$("divImport").style.display="none",$("bEdit").style.display="none",$("bDeleteEntry").style.display="none"),a.nocreate||window.embedHideTop||
!access.singleCopy?$("bClone").style.display="none":$("bClone").style.display=""),$("bClearFilter")&&($("bClearFilter").style.display="none"),$("bClearFilter2")&&($("bClearFilter2").style.display="none"),$("bClearFilterB").style.display="none",$("getTotalButton").style.display="none",$("bBatchExec").style.display="none",$("bMassEdit").style.display="none",$("bMassCreate")&&($("bMassCreate").style.display="none"),$("bMassClone")&&($("bMassClone").style.display="none"),$("bMassDel").style.display="none",
$("bDeleteSelected").style.display="none",$("bMassEmail").style.display="none",$("bDLExcelorCSV").style.display="none",$("bDownloadAttachments")&&($("bDownloadAttachments").style.display="none"),$("bPublish").style.display="none",$("bExportReport").style.display="none",$("bImportMassFile")&&($("bImportMassFile").style.display="none"),access.dlForm?($("bDLHTML").style.display="",$("bDLExcel").style.display="",$("bDLCusReport").style.display="",$("bDLPDF")&&($("bDLPDF").style.display="")):($("bDLHTML").style.display=
"none",$("bDLExcel").style.display="none",$("bDLCusReport").style.display="none",$("bDLPDF")&&($("bDLPDF").style.display="none")),access.dlForm?$("divExport").style.display="":$("divExport").style.display="none",window.ifExternalv2&&access.magicShareEntry&&($("divShare").style.display=""),$("bMassSMS").style.display="none",$("bMagicShareEntry").style.display="",$("bLineShare")&&($("bLineShare").style.display="flex"),$("bWhatsAppShare")&&($("bWhatsAppShare").style.display="flex"),$("bBack").style.display=
"",window.embedHideTop?$("bReload").style.display="none":$("bReload").style.display="",$("dockBarRight").style.display="",$("dockWinRight").style.display="",$("bReports").style.display="",$("subtableDefaultFilterPanel").style.display="none",window.embedShowComment&&($("dockBarRight").style.display="block",$("paymentButton").style.display="none",$("commentButton").style.display="",$("emailButton").style.display="none",$("actionButton").style.display="none",$("wfButton").style.display="none",$("infoButton").style.display=
"none"),window.embedEntry){$("bBack").style.display="none";if(a=$("v5NUIHeaderDesign"))a.style.display="none";$("embedSearchBoxDiv").style.display="none"}}else getCheckedRootNodeIds(),$("divEditing")&&($("divEditing").style.display=""),$("bBack").style.display="none",$("bShare").style.display="none",$("bSpreadsheetMode")&&($("bSpreadsheetMode").style.display=""),window.embedHideTop?$("bReload").style.display="none":$("bReload").style.display="",$("bEditText")&&($("bEditText").innerHTML=lm.editEntries),
access.multiEdit?a.noedit?$("bEdit").style.display="none":$("bEdit").style.display="":$("bEdit").style.display="none",access.massEdit?a.noedit?($("bBatchExec").style.display="none",$("bMassEdit").style.display="none"):($("bBatchExec").style.display="",$("bMassEdit").style.display=""):($("bBatchExec").style.display="none",$("bMassEdit").style.display="none"),"W"==a.rights?($("divEditing").style.display="",a.nocreate||window.embedHideTop?($("bNewData").style.display="none",$("divImport").style.display=
"none"):access.singleNew&&($("bNewData").style.display="",$("divImport").style.display=""),access.massDelete&&($("bMassDel").style.display=""),0<getCheckedRootNodeIds().length&&($("bDeleteSelected").style.display="")):($("divEditing").style.display="none",$("bNewData").style.display="none",$("bMassDel").style.display="none",$("divImport").style.display="none"),"T"==biffdata.nextButton&&0<biffdata.role?$("getTotalButton").style.display="":$("getTotalButton").style.display="none",$("bMassCreate")&&
($("bMassCreate").style.display=""),$("bMassClone")&&($("bMassClone").style.display=""),$("bMassEmail").style.display="",$("bMassSMS").style.display="",$("bDLExcel").style.display="none",$("bMagicShareEntry").style.display="none",$("bLineShare")&&($("bLineShare").style.display="none"),$("bWhatsAppShare")&&($("bWhatsAppShare").style.display="none"),$("bImportMassFile")&&($("bImportMassFile").style.display=""),access.dlList?($("bDLHTML").style.display="",$("bDLPDF")&&($("bDLPDF").style.display=""),
$("bDLCusReport").style.display="",$("bPublish").style.display="",$("bExportReport").style.display="",$("bDLExcelorCSV").style.display=""):($("bDLExcelorCSV").style.display="none",$("bDLHTML").style.display="none",$("bDLPDF")&&($("bDLPDF").style.display="none"),$("bDLCusReport").style.display="none",$("bPublish").style.display="none",$("bExportReport").style.display="none"),access.dlListAttachments?$("bDownloadAttachments")&&($("bDownloadAttachments").style.display=""):$("bDownloadAttachments")&&
($("bDownloadAttachments").style.display="none"),access.multiEdit||access.massDelete||access.massEdit||access.massCreate||access.massClone?$("divEditing").style.display="":$("divEditing").style.display="none",access.dlList||access.dlListAttachments?$("divExport").style.display="":$("divExport").style.display="none",$("bDeleteEntry").style.display="none",$("bClone").style.display="none",$("dockBarRight").style.display="none",biffdata.buttons&&($("dockWinRight").style.display=""),$("bReports").style.display=
"",$("subtableDefaultFilterPanel").style.display="none";if(a=$("bClearFilterB"))a.style.display="none";if(biffdata&&biffdata.filteredDomains&&0<biffdata.filteredDomains.length)$("bClearFilter")&&($("bClearFilter").style.display=""),$("bClearFilter2")&&($("bClearFilter2").style.display=""),a.style.display="",mvpMode&&($("bMvpClearFilter").style.display="");else if(biffdata&&0<biffdata.orderDomain.length&&-1!==biffdata.orderDomain[0]){b=biffdata.filterStatus.getFilterItems(biffdata.orderDomain[0]);
for(var c=!1,d=0;d<b.length;d++)if(!0===b[d].fixed){c=!0;break}!1===c&&($("bClearFilter")&&($("bClearFilter").style.display=""),$("bClearFilter2")&&($("bClearFilter2").style.display=""),a.style.display="",mvpMode&&($("bMvpClearFilter").style.display=""))}else $("bClearFilter")&&($("bClearFilter").style.display="none"),$("bClearFilter2")&&($("bClearFilter2").style.display="none"),a.style.display="none",mvpMode&&($("bMvpClearFilter").style.display="none");biffdata&&(biffdata.noedit&&($("bEdit").style.display=
"none",$("divImport").style.display="none"),biffdata.nocreate||window.embedHideTop)&&($("bNewData").style.display="none",$("divImport").style.display="none");$("bDoneBuild").style.display="none";$("bBrowse").style.display="none";$("bSave").style.display="none";$("bBuilderSave").style.display="none";$("bDesignHistory").style.display="none";$("bOtherPage").style.display="none";$("entryCount").style.display="";$("bBuilderMode").style.display="none";$("bFormTool").style.display="none";$("bAutoSave").style.display=
"none";$("bLinkManager").style.display="none";displayNUIHeader()}adjustPrevNext();updateFormPageStar();updateSidebarViewHighlight()}}function displayNUIHeader(){biffdata&&(displayNUIHeaderv6(),nui._updateFocus())}
function displayNUIHeaderv6(){function a(a){c(a,!0)}function b(a){c(a,!1)}function c(a,b){a.preventDefault();var c=a.clipboardData||window.clipboardData;b=b?c.getData("Text").replace(/(\r\n|\n|\r)/gm," "):c.getData("Text");b=removeHTML(b);a=a.target;c=window.getSelection();c.rangeCount?(a=c.getRangeAt(0),a.deleteContents(),a.insertNode(document.createTextNode(b)),a.collapse()):a.innerHTML+=b}var d=biffdata;if(mode==BUILDER&&builder){document.title=lm.designModeTitle+":"+unescapeHTML(builder.newName);
d=nui.nuiPageHeader.childNodes[0];var e=nui.nuiPageHeader.childNodes[1];d.innerHTML=builder.newName?builder.newName:"";e.innerHTML=builder.formDesc?builder.formDesc:"<span style='color:#aaaaaa;'>Optional description of your form</span>";d.setAttribute("contentEditable",!0);e.setAttribute("contentEditable",!0);d.onfocus=outNUI;d.onblur=function(){inNUI();builder.newName=getInnerText(this)};d.onkeyup=function(){builder.newName=getInnerText(this)};e.onfocus=function(){outNUI();if(!builder.formDesc){rm(this);
var a=window.getSelection(),b=document.createRange();b.setStart(this,0);b.setEnd(this,0);a.removeAllRanges();a.addRange(b)}};e.onblur=function(){inNUI();builder.formDesc=getInnerText(this);builder.formDesc||(this.innerHTML="<span style='color:#aaaaaa;'>Optional description of your form</span>")};d.onmouseover=function(){this.style.border="1px solid #cccccc"};d.onmouseout=function(){this.style.border="1px solid #fafafa"};e.onmouseover=function(){this.style.border="1px solid #cccccc"};e.onmouseout=
function(){this.style.border="1px solid #fafafa"};d.onkeyup=function(){builder.newName=getInnerText(this)};e.onkeyup=function(){nui._updateFocus();builder.formDesc=getInnerText(this)};e.onpaste=b;d.onpaste=a;nui.nuiPageHeader.style.background="#f6f6f6";nui.nuiPageHeader.style.border="1px solid #efefef"}else{if(d.ifListingPage()){if(d&&d.displaySheetName){mvpMode||(document.title=unescapeHTML(d.displaySheetName));nui.nuiPageHeader.childNodes[0].innerHTML=d.displaySheetName;e=!1;for(var f=d.filterStatus,
g=0;g<f.filterItems.length;g++)f.filterItems[g].fixed||(e=!0);nui.nuiPageHeader.childNodes[0].innerHTML=e?d.displaySheetName+'<i class="fal fa-table" style="font-size:15px;margin:0 0 0 12px;"></i><i class="fas fa-filter" style="font-size:8px;vertical-align: super;"></i></span>':d.displaySheetName;nui.nuiPageHeader.childNodes[1].innerHTML=createTextLinks(d.formDesc)}}else 1==d.getFormPageLevel()&&d&&d.displaySheetName&&(e="",e=0>parseInt(d.rootNodeId)&&d.anydata?lm["new"]+lm.space+d.displaySheetName:
d.displaySheetName,mvpMode||(document.title=unescapeHTML(e)),nui.nuiPageHeader.childNodes[0].innerHTML=e+'<div id="starWrapper"></div>',nui.nuiPageHeader.childNodes[1].innerHTML=createTextLinks(d.formDesc),ctrl.mainScrollTop&&10<ctrl.mainScrollTop&&(nui.main.scrollTop=ctrl.mainScrollTop));1===biffdata.role&&(e=$("nuiPageHeader_sheetDesc"))&&!e.textContent&&(e.textContent=lm.surveyUserPrompt);d.ifListingPage()&&!mvpMode&&(processStar(),updateListingPageAddRowButton());mvpMode||clearListingPageCheckbox()}}
function updateFormPageStar(a){if(mode==BROWSE){var b=0>parseInt(biffdata.rootNodeId)&&biffdata.anydata,c=$("starWrapper");b||(a=a?"check"==a:-1!=biffdata.star.indexOf(parseInt(biffdata.rootNodeId)),c&&(c.innerHTML='<div class="'+(a?"fas fa-star formPageStarchecked":"far fa-star formPageStar")+'" onclick="formPageStarClick('+(a?"true":"false")+');"></div>'))}}function resizeLinkWizard(){ctrl.resizeLinkWizardFlag||(ctrl.resizeLinkWizardFlag=!0,setTimeout(_resizeLinkWizard,300))}
function _resizeLinkWizard(){linkWizard.displayWizard()}var cal=new RagicCal,DAY_MILLI=864E5,MINUTE_MILLI=6E4;function RagicCal(){this.ragicEvents={};this.fieldNames=[];this.start_date=new Date}
RagicCal.prototype.retrieveDataMonth=function(a,b){this.ragicEvents={};this.fieldNames=[];this.start_date=a;a=new Date(this.start_date.getFullYear()+"/"+(this.start_date.getMonth()+1)+"/1");this.ui_start_date=new Date(a.getTime()-a.getDay()*DAY_MILLI);read(function(a){cal.ragicEvents=eval("("+a.responseText+")");cal.renderCalendarView()},"/sims/cal/dat.jsp?a="+ap+"&p="+path+"&fn="+encodeURIComponent(sheet)+"&fd="+getISODate(this.ui_start_date)+"&td="+getISODate(new Date(this.ui_start_date.getTime()+
b*DAY_MILLI)))};
RagicCal.prototype.renderMonthStub=function(){var a=this.ui_start_date,b=new Date,c=0,d=$("monthRowAll");rm(d);for(var e,f,g;35>c;){a.getFullYear();var k=a.getMonth()+1,l=a.getDate(),m=c%7;f=parseInt(c/7);0==m&&(e=node("div"),e.id="w"+f,e.className="monthRow",e.style.top=20*f+"%",f=node("table"),f.className="monthRowTable",g=f.insertRow(0),e.appendChild(f),d.appendChild(e));e=g.insertCell(m);e.innerHTML=" ";k==b.getMonth()+1&&l==b.getDate()?e.className="todayStubCell":e.className="stubCell";a=new Date(a.getTime()+
DAY_MILLI);c++}};
RagicCal.prototype.renderMonth=function(){var a=this.ui_start_date;$("current").innerHTML=this.start_date.getFullYear()+"/"+(this.start_date.getMonth()+1);for(var b=new Date,c=0,d,e;35>c;){var f=a.getFullYear(),g=a.getMonth()+1,k=a.getDate(),l=f+"/"+g+"/"+k,m=k;f=c%7;var n=parseInt(c/7);if(0==f){d=node("table");d.className="monthRowTable2";e=d.insertRow(0);e.className="dayLegend";for(var q=1;6>q;q++)for(var r=d.insertRow(q),p=0;7>p;p++)r.insertCell(p);$("w"+n).appendChild(d)}n=e.insertCell(f);n.innerHTML=
m;g==b.getMonth()+1&&k==b.getDate()&&(n.className="todayCell");g!=this.start_date.getMonth()+1&&(n.style.color="#CCCCCC");1==k&&(n.innerHTML=g+"/"+k);if(g=this.ragicEvents[l])for(k=0;k<g.length;k++)l=g[k],m=indexOf(l.field,this.fieldNames),-1==m&&(this.fieldNames.push(l.field),m=this.fieldNames.length-1),3<k?(n=d.rows[5].cells[f],n.className="moreEventCell",n.moreEvents||(n.moreEvents=[]),l.fieldTypeIndex=m,n.moreEvents.push(l),n.innerHTML="+"+n.moreEvents.length+" more",n.onclick=calMoreClick):(n=
d.rows[k+1].cells[f],n.className="eventCell"+m,n.innerHTML=l.title,n.ev=l,n.onclick=caleventClick);a=new Date(a.getTime()+DAY_MILLI);c++}};RagicCal.prototype.renderLegend=function(){var a=$("legendCal");rm(a);var b;for(b=0;b<this.fieldNames.length;b++){var c=node("div");c.className="eventCell"+b;c.innerHTML=this.fieldNames[b];a.appendChild(c)}};
RagicCal.prototype.renderSmallMonth=function(){var a=this.ui_start_date,b=new Date,c=0,d=$("smallMonthTableBody"),e;rm(d);for($("smallCalTitle").innerHTML=this.start_date.getFullYear()+"/"+(parseInt(this.start_date.getMonth())+1);42>c;){var f=a.getFullYear(),g=a.getMonth()+1,k=a.getDate();f=f+"/"+g+"/"+k;var l=c%7;var m=parseInt(c/7);0==l&&(e=d.insertRow(m));l=e.insertCell(l);l.innerHTML=k;l.date=f;l.onclick=smallCalDateClick;g==b.getMonth()+1&&k==b.getDate()&&(l.className="todaySmallCell");g==this.start_date.getMonth()+
1&&(l.className+=" bgSmallCell");this.ragicEvents[f]&&(l.className+=" eventSmallCell");a=new Date(a.getTime()+DAY_MILLI);c++}};RagicCal.prototype.renderWeek=function(){};RagicCal.prototype.renderItem=function(){};RagicCal.prototype.deltaDay=function(a){a=new Date(this.start_date.getTime()+a*DAY_MILLI);cal.retrieveDataMonth(a,35)};RagicCal.prototype.setDate=function(a){cal.retrieveDataMonth(a,35)};
RagicCal.prototype.renderCalendarView=function(){cal.ragicEvents.Msg&&floatWin(null,cal.ragicEvents.Msg);cal.renderMonthStub();cal.renderMonth();cal.renderSmallMonth();cal.renderLegend()};RagicCal.prototype.close=function(){$("calPanel")&&($("calPanel").style.display="none")};function smallCalDateClick(){cal.setDate(new Date(this.date))}function caleventClick(){calBrowseForward(this.ev.nodeId);cal.close();biffdata.calendarOn=!0}
function calMoreClick(a){a||(a=window.event);var b=node("div");b.className="moreEventsDiv";var c=findPos(this);b.style.top=c[1]+"px";b.style.left=c[0]+"px";for(c=0;c<this.moreEvents.length;c++){var d=this.moreEvents[c],e=node("div");e.className="eventCell"+d.fieldTypeIndex;e.innerHTML=d.title;e.ev=d;e.onclick=caleventClick;b.appendChild(e)}document.body.appendChild(b);a.cancelBubble=!0;floatingPanels.push(b)}
function RagicEvent(a,b,c,d){this.start_date=a;this.end_date=b;this.title=c;this.nodeId=d}function getISODate(a){return a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()}
function initReportQuery(){if($("yearPick")){var a=new Date,b=a.getFullYear();a=a.getMonth()+1;for(var c=0;c<$("yearPick").options.length;c++){var d=$("yearPick").options[c];d.value==b&&(d.selected=!0)}for(c=0;c<$("monthPick").options.length;c++)d=$("monthPick").options[c],d.value==a&&(d.selected=!0);3>=a?$("quarterPick").selectedIndex=0:6>=a?$("quarterPick").selectedIndex=1:9>=a?$("quarterPick").selectedIndex=2:12>=a&&($("quarterPick").selectedIndex=3);reportChooseInterval();reportChooseFact();reportChooseDimension(1);
reportChooseDimension(2)}}initReportQuery();
function buildReportQuery(a){var b=parseInt($("factFieldSelect").options[$("factFieldSelect").selectedIndex].value),c=$("dimFieldSelect1").options[$("dimFieldSelect1").selectedIndex],d=parseInt(c.value),e=$("dimFieldSelect2").options[$("dimFieldSelect2").selectedIndex],f=parseInt(e.value),g=parseInt($("dateField").options[$("dateField").selectedIndex].value),k=getDateFromTo(),l=$("dimFieldAgg1").options[$("dimFieldAgg1").selectedIndex].value,m=$("dimFieldAgg2").options[$("dimFieldAgg2").selectedIndex].value,n=
[],q=[];2<=currentReportType&&(d&&(n[0]=d),"date"==c.getAttribute("type")&&(q[0]=l),3==currentReportType&&(f&&(n[1]=f),"date"==e.getAttribute("type")&&(q[1]=m)));b||(b=0);b={apname:$("apname").value,path:$("path").value,sheetIndex:parseInt($("sheetIndex").value),factDomainId:b,dimensions:n,aggregation:q,filters:[g+",gte,"+k[0],g+",lte,"+k[1]],format:4==currentReportType?1:0};a?window.open("/api/olap/html.jsp?q="+encodeURIComponent(JSON.stringify(b))+"&print"):(floatWin(null,"Loading...",lm.ach13,
!0),read(function(a){window.setTimeout(function(){floatWinClose()},1E3);1==currentReportType?($("reportFactPick").style.position="",$("reportPickerDiv").appendChild($("reportFactPick")),$("reportType1Div").innerHTML=a.responseText):2==currentReportType?($("reportDimension1Pick").style.position="",$("reportFactPick").style.position="",$("reportPickerDiv").appendChild($("reportDimension1Pick")),$("reportPickerDiv").appendChild($("reportFactPick")),$("reportType2Div").innerHTML=a.responseText,$("reportType2Dim1").appendChild($("reportDimension1Pick")),
$("reportType2Fact").appendChild($("reportFactPick"))):3==currentReportType?($("reportDimension1Pick").style.position="",$("reportDimension2Pick").style.position="",$("reportFactPick").style.position="",$("reportPickerDiv").appendChild($("reportDimension1Pick")),$("reportPickerDiv").appendChild($("reportDimension2Pick")),$("reportPickerDiv").appendChild($("reportFactPick")),$("reportType3Div").innerHTML=a.responseText,$("reportType3Dim1").appendChild($("reportDimension1Pick")),$("reportType3Dim2").appendChild($("reportDimension2Pick")),
$("reportType3Fact").appendChild($("reportFactPick"))):4==currentReportType&&($("reportDimension1Pick").style.position="",$("reportFactPick").style.position="",$("reportPickerDiv").appendChild($("reportDimension1Pick")),$("reportPickerDiv").appendChild($("reportFactPick")),$("reportType4Div").innerHTML=a.responseText,$("reportType4Dim1").appendChild($("reportDimension1Pick")),$("reportType4Fact").appendChild($("reportFactPick")))},"/api/olap/html.jsp?q="+encodeURIComponent(JSON.stringify(b))))}
function reportPreview(a,b,c){var d=parseInt($("factFieldSelect").options[$("factFieldSelect").selectedIndex].value),e=$("dimFieldSelect1").options[$("dimFieldSelect1").selectedIndex],f=parseInt(e.value),g=$("dimFieldSelect2").options[$("dimFieldSelect2").selectedIndex],k=parseInt(g.value),l=$("dimFieldAgg1").options[$("dimFieldAgg1").selectedIndex].value,m=$("dimFieldAgg2").options[$("dimFieldAgg2").selectedIndex].value,n=[],q=[];2<=currentReportType&&(f&&(n[0]=f),"date"==e.getAttribute("type")&&
(q[0]=l),3==currentReportType&&(k&&(n[1]=k),"date"==g.getAttribute("type")&&(q[1]=m)));d||(d=0);b={repName:$("reportTitle").value,apname:a,path:b,sheetIndex:parseInt(c),factDomainId:d,dimensions:n,aggregation:q,filters:[],views:[],format:4==currentReportType?1:0};c=document.getElementsByName("usingView");for(d=0;d<c.length;d++)if(c[d].checked)for(e=c[d].value.split("&fv2="),f=1;f<e.length;f++)e[f]&&b.views.push(e[f]);a&&(a=findPos($("previewSpan1")),window.open("/api/olap/html.jsp?q="+encodeURIComponent(JSON.stringify(b))+
"&print&preview","","height=360, width=500,top="+a[1]+",left="+a[0]))}function clearReportViews(){for(var a=document.getElementsByName("usingView"),b=0;b<a.length;b++)a[b].checked=!1}
function reportNext(){var a=parseInt($("reportStep").value)+1;if(2==a){if($("reportNoForm")){alert("Please choose a sheet for your report.There is no sheet in this tab!");return}if("null"==$("formName2").value){alert("Please choose a sheet from the bottom tabs.");return}}$("reportStep").value=a;$("bReortBack").style.display="";$("sheetSelector").style.display="none";if(2==a){$("rpStep1").style.display="none";$("rpStep2").style.display="";$("rpStep3").style.display="none";for(var b=document.getElementsByName("reportTemplate"),
c=0;c<b.length;c++)if(b[c].checked){reportTypeOverlay(c+1);break}}else $("rpStep1").style.display="none",$("rpStep2").style.display="none",$("rpStep3").style.display="",$("bReortNext").style.display="none",$("bReortSave").style.display="";svg4rep_prompt(ctrl.paper,lm.reportGenerator,lm["reportWizard"+a+"_desc"])}
function reportBack(){var a=parseInt($("reportStep").value)-1;$("reportStep").value=a;$("bReortNext").style.display="";$("bReortSave").style.display="none";if(2==a){$("rpStep1").style.display="none";$("rpStep2").style.display="";$("rpStep3").style.display="none";for(var b=document.getElementsByName("reportTemplate"),c=0;c<b.length;c++)if(b[c].checked){reportTypeOverlay(c+1);break}}else $("rpStep1").style.display="",$("rpStep2").style.display="none",$("rpStep3").style.display="none",$("bReortBack").style.display=
"none",$("sheetSelector").style.display="";svg4rep_prompt(ctrl.paper,lm.reportGenerator,lm["reportWizard"+a+"_desc"])}
function designPreviewSave(a,b,c,d,e){var f=parseInt($("factFieldSelect").options[$("factFieldSelect").selectedIndex].value),g=$("dimFieldSelect1").options[$("dimFieldSelect1").selectedIndex],k=parseInt(g.value),l=$("dimFieldSelect2").options[$("dimFieldSelect2").selectedIndex],m=parseInt(l.value),n=$("dimFieldAgg1").options[$("dimFieldAgg1").selectedIndex].value,q=$("dimFieldAgg2").options[$("dimFieldAgg2").selectedIndex].value,r=[],p=[];2<=currentReportType&&(k&&(r[0]=k),"date"==g.getAttribute("type")&&
(p[0]=n),3==currentReportType&&(m&&(r[1]=m),"date"==l.getAttribute("type")&&(p[1]=q)));f||(f=0);f={repName:$("reportTitle").value,path:b,sheetIndex:parseInt(c.split("_")[0]),factDomainId:f,dimensions:r,aggregation:p,filters:[],views:[],userFilters:[],format:4==currentReportType?1:0};if(2==d)for(k=document.getElementsByName("usingView"),g=0;g<k.length;g++)if(k[g].checked)for(l=k[g].value.split("&fv2="),m=1;m<l.length;m++)l[m]&&f.views.push(l[m]);l=k="";for(g=0;100>g;g++)$("m"+g)&&$("m"+g).checked&&
(k=(""==k?"":k+"_")+$("m"+g).value),$("s"+g)&&$("s"+g).checked&&(l=(""==l?"":l+"_")+$("s"+g).value);if(1==d)a="/sims/v5frame/v6Report.jsp?a="+a+"&p="+b+"&si="+sheetIndex+"&psq="+encodeURIComponent(JSON.stringify(f))+(""!=k?"&mf="+k:"")+(""!=l?"&sf="+l:""),b=findPos($("previewSpan2")),window.open(a,"","height=360, width=500,top="+b[1]+",left="+b[0]);else{g=0;d=1;for(g in accountProfile[b])m=g.split("_"),parseInt(m[0])>d&&(d=parseInt(m[0]));d++;a="/sims/saveReport.jsp?a="+a+"&p="+b+"&fn="+c+"&cp="+
e+"&psq="+encodeURIComponent(JSON.stringify(f))+(""!=k?"&mf="+k:"")+(""!=l?"&sf="+l:"")+"&nsi="+d;read(evalJS,a)}}function reportChooseDimension(a){$("dimFieldSelect"+a)&&("date"==$("dimFieldSelect"+a).options[$("dimFieldSelect"+a).selectedIndex].getAttribute("type")?$("dimFieldAgg"+a).style.display="":$("dimFieldAgg"+a).style.display="none")}
function reportChooseFact(){var a=$("factFieldSelect"),b=$("dimFieldSelect1"),c=$("dimFieldSelect2");if(a)if(a.options[a.selectedIndex].parentNode.hasAttribute("root")){for(a=0;a<b.childNodes.length;a++){var d=b.childNodes[a];1!=d.nodeType||d.hasAttribute("root")||(d.disabled=!0)}for(a=0;a<c.childNodes.length;a++)d=c.childNodes[a],1!=d.nodeType||d.hasAttribute("root")||(d.disabled=!0)}else{for(a=0;a<b.childNodes.length;a++)d=b.childNodes[a],1==d.nodeType&&(d.disabled=!1);for(a=0;a<c.childNodes.length;a++)d=
c.childNodes[a],1==d.nodeType&&(d.disabled=!1)}}
function getDateFromTo(){var a=$("interval").options[$("interval").selectedIndex].value,b=parseInt($("yearPick").options[$("yearPick").selectedIndex].value);if("D"!=a){if("M"==a){a=parseInt($("monthPick").options[$("monthPick").selectedIndex].value);var c=parseDate((12==a?b+1:b)+"/"+(12==a?1:a+1)+"/1");c=new Date(c.getTime()-DAY_MILLI);return[b+"/"+a+"/1",b+"/"+a+"/"+c.getDate()]}if("Q"==a){a=parseInt($("quarterPick").options[$("quarterPick").selectedIndex].value);if(1==a)return[b+"/1/1",b+"/3/31"];
if(2==a)return[b+"/4/1",b+"/6/30"];if(3==a)return[b+"/7/1",b+"/9/30"];if(4==a)return[b+"/10/1",b+"/12/31"]}else if("Y"==a)return[b+"/1/1",b+"/12/31"]}return[$("dailyPick").value,$("dailyPick").value]}
function reportChooseInterval(){var a=$("interval").options[$("interval").selectedIndex].value;"D"==a?($("dailyPick").style.display="",$("monthPick").style.display="none",$("quarterPick").style.display="none",$("yearPick").style.display="none",$("dimFieldAgg1")&&($("dimFieldAgg1").selectedIndex=0),$("dimFieldAgg2")&&($("dimFieldAgg2").selectedIndex=0)):"M"==a?($("dailyPick").style.display="none",$("monthPick").style.display="",$("quarterPick").style.display="none",$("yearPick").style.display="",$("dimFieldAgg1")&&
($("dimFieldAgg1").selectedIndex=0),$("dimFieldAgg2")&&($("dimFieldAgg2").selectedIndex=0)):"Q"==a?($("dailyPick").style.display="none",$("monthPick").style.display="none",$("quarterPick").style.display="",$("yearPick").style.display="",$("dimFieldAgg1")&&($("dimFieldAgg1").selectedIndex=0),$("dimFieldAgg2")&&($("dimFieldAgg2").selectedIndex=0)):"Y"==a&&($("dailyPick").style.display="none",$("monthPick").style.display="none",$("quarterPick").style.display="none",$("yearPick").style.display="",$("dimFieldAgg1")&&
($("dimFieldAgg1").selectedIndex=1),$("dimFieldAgg2")&&($("dimFieldAgg2").selectedIndex=1))}var currentReportType;
function reportTypeOverlay(a){reportChooseDimension(1);reportChooseDimension(2);$("reportHeader").style.display="";$("generateReport")&&($("generateReport").style.display="");$("printReport")&&($("printReport").style.display="");$("reportType1").style.display="none";$("reportType2").style.display="none";$("reportType3").style.display="none";$("reportType4").style.display="none";$("reportType"+a).style.display="";$("reportButton1").style.width="100px";$("reportButton1").style.height="75px";$("reportButton2").style.width=
"100px";$("reportButton2").style.height="75px";$("reportButton3").style.width="100px";$("reportButton3").style.height="75px";$("reportButton4").style.width="100px";$("reportButton4").style.height="75px";$("reportButtonOuter1").style.width="100px";$("reportButtonOuter1").style.height="75px";$("reportButtonOuter2").style.width="100px";$("reportButtonOuter2").style.height="75px";$("reportButtonOuter3").style.width="100px";$("reportButtonOuter3").style.height="75px";$("reportButtonOuter4").style.width=
"100px";$("reportButtonOuter4").style.height="75px";$("reportButtonText1").style.fontSize="12px";$("reportButtonText2").style.fontSize="12px";$("reportButtonText3").style.fontSize="12px";$("reportButtonText4").style.fontSize="12px";$("reportButtonText1").style.width="100px";$("reportButtonText2").style.width="100px";$("reportButtonText3").style.width="100px";$("reportButtonText4").style.width="100px";$("reportTypePick")&&($("reportTypePick").style.fontSize="12px");currentReportType=a;1==a?($("reportPickerDiv")&&
$("reportPickerDiv").appendChild($("reportFactPick")),$("reportType1Div").innerHTML=$("reportType1Sample").innerHTML,$("reportFactPick")&&($("reportType1Div").appendChild($("reportFactPick")),$("reportFactPick").style.position="absolute",$("reportFactPick").style.top="40px",$("reportFactPick").style.left="50px")):2==a?($("reportPickerDiv")&&($("reportPickerDiv").appendChild($("reportDimension1Pick")),$("reportPickerDiv").appendChild($("reportFactPick"))),$("reportType2Div").innerHTML=$("reportType2Sample").innerHTML,
$("reportDimension1Pick")&&($("reportType2Div").appendChild($("reportDimension1Pick")),$("reportDimension1Pick").style.position="absolute",$("reportDimension1Pick").style.top="60px",$("reportDimension1Pick").style.left="10px"),$("reportFactPick")&&($("reportType2Div").appendChild($("reportFactPick")),$("reportFactPick").style.position="absolute",$("reportFactPick").style.top="60px",$("reportFactPick").style.left="150px")):3==a?($("reportPickerDiv")&&($("reportPickerDiv").appendChild($("reportDimension1Pick")),
$("reportPickerDiv").appendChild($("reportDimension2Pick")),$("reportPickerDiv").appendChild($("reportFactPick"))),$("reportType3Div").innerHTML=$("reportType3Sample").innerHTML,$("reportDimension1Pick")&&($("reportType3Div").appendChild($("reportDimension1Pick")),$("reportDimension1Pick").style.position="absolute",$("reportDimension1Pick").style.top="60px",$("reportDimension1Pick").style.left="10px"),$("reportDimension2Pick")&&($("reportType3Div").appendChild($("reportDimension2Pick")),$("reportDimension2Pick").style.position=
"absolute",$("reportDimension2Pick").style.top=0,$("reportDimension2Pick").style.left="200px"),$("reportFactPick")&&($("reportType3Div").appendChild($("reportFactPick")),$("reportFactPick").style.position="absolute",$("reportFactPick").style.top="60px",$("reportFactPick").style.left="200px")):4==a&&($("reportPickerDiv")&&($("reportPickerDiv").appendChild($("reportDimension1Pick")),$("reportPickerDiv").appendChild($("reportFactPick"))),$("reportType4Div").innerHTML=$("reportType4Sample").innerHTML,
$("reportDimension1Pick")&&($("reportType4Div").appendChild($("reportDimension1Pick")),$("reportDimension1Pick").style.position="absolute",$("reportDimension1Pick").style.top="120px",$("reportDimension1Pick").style.left="300px"),$("reportFactPick")&&($("reportType4Div").appendChild($("reportFactPick")),$("reportFactPick").style.position="absolute",$("reportFactPick").style.top="60px",$("reportFactPick").style.left="-20px"))}
function GraphCache(a){this.group=null;this.dateDomain=-1;this.currentInterval="D";this.mode=a;this.jsonCache=null;this.series=[]}GraphCache.prototype.loadForm=function(a,b,c){this.loadingScreen();this.apname=a;this.path=b;this.sheetIndex=c;this.loadDateRangeOption($("dateRangeOption").options[$("dateRangeOption").selectedIndex].value)};
GraphCache.prototype.loadDateRangeOption=function(a,b){this.loadingScreen();(b||0===b)&&RagicStorage.localStorage.setItem("cdr_"+ap,b);a=a.split("_");b=new Date;switch(a[0]){case "ld":var c=new Date(b.getTime()-864E5*parseInt(a[1]));var d=b;break;case "m":c=new Date;c.setDate(1);c.setMonth(c.getMonth()-parseInt(a[1]));d=new Date;d.setMonth(c.getMonth()+1-parseInt(a[1]));d.setDate(1);d=new Date(d.getTime()-864E5);break;case "q":a=b.getMonth();c=new Date;d=new Date;c.setDate(1);3>a?(c.setMonth(0),d.setMonth(2),
d.setDate(31)):6>a?(c.setMonth(3),d.setMonth(5),d.setDate(30)):9>a?(c.setMonth(6),d.setMonth(8),d.setDate(30)):(c.setMonth(9),d.setMonth(11),d.setDate(31));break;case "y":c=new Date,c.setDate(1),c.setMonth(0),c.setFullYear(c.getFullYear()-parseInt(a[1])),d=new Date,d.setMonth(11),d.setDate(31),d.setFullYear(d.getFullYear()-parseInt(a[1]))}graph.loadDateRange(c,d)};
GraphCache.prototype.loadDateRange=function(a,b){var c=this;this.currentDateFrom=a;this.currentDateTo=b;if(1==c.mode)read(function(a){c.jsonCache=window.JSON?JSON.parse(a.responseText):eval("("+a.responseText+")");c.initSelectionFacts();c.drawGraph(c.currentFactIndex,c.currentInterval)},"/api/olap/index.jsp?df="+formatDate(a,"yyyy/M/d")+"&dt="+formatDate(b,"yyyy/M/d")+"&a="+this.apname+"&p="+this.path+"&si="+this.sheetIndex+(-1!=this.dateDomain?"&dd="+this.dateDomain:""),!1);else if(2==c.mode){var d=
$("rowDimSelect").options[$("rowDimSelect").selectedIndex].value,e=$("colDimSelect").options[$("colDimSelect").selectedIndex].value;read(function(a){c.jsonCache=window.JSON?JSON.parse(a.responseText):eval("("+a.responseText+")");c.drawPivot(c.currentFactIndex)},"/api/olap/index.jsp?ns&df="+formatDate(a,"yyyy/M/d")+"&dt="+formatDate(b,"yyyy/M/d")+"&gp="+d+(e?"&ngd&gp="+e:"")+"&a="+this.apname+"&p="+this.path+"&si="+this.sheetIndex+(-1!=this.dateDomain?"&dd="+this.dateDomain:""),!1)}};
GraphCache.prototype.loadingScreen=function(a){a?($("homeDashboard").style.opacity=1,$("homeDashboard").style.filter="alpha(opacity=100);"):($("homeDashboard").style.opacity=.2,$("homeDashboard").style.filter="alpha(opacity=20);")};
GraphCache.prototype.drawPivot=function(a,b){$("pivotTableDiv").innerHTML="";RagicStorage.localStorage.setItem("cdf_"+ap,$("factSelect").selectedIndex);this.loadingScreen();this.currentFactIndex=a;if(this.jsonCache){ptable=new PivotTable(b);b=this.jsonCache.data;for(var c=0;c<b.length;c++){var d=b[c];ptable.readEntry(d.d[0],d.d[1],d.f[a])}ptable.draw($("pivotTableDiv"));this.loadingScreen(!0)}};
GraphCache.prototype.drawGraph=function(a,b){RagicStorage.localStorage.setItem("cdf_"+ap,$("factSelect").selectedIndex);RagicStorage.localStorage.setItem("cdi_"+ap,b);this.loadingScreen();this.currentInterval=b;this.currentFactIndex=a;this.series=[];if(this.jsonCache){var c=this.jsonCache.data,d=this.jsonCache.def.f;this.factSum=Array(d.length+1);for(var e=0;e<this.factSum.length;e++)this.factSum[e]=0;for(e=0;e<c.length;e++){var f=c[e],g=f.f;f=f.d[0];f="D"==b?f:intervalDate(f,b);if(f!=k){k&&l&&this.series.push({date:k,
visits:l});var k=f;var l=0}l+=g[a];for(f=0;f<g.length;f++){var m=parseFloat(g[f]);if(m&&!isNaN(m)){if(isNaN(this.factSum[f]))break;this.factSum[f]+=m}}}k&&l&&this.series.push({date:k,visits:l});b=lm.numOfEntries+": <span class=factNumber>"+graphTextFormatNumber(this.factSum[0],"#,###")+"</span><br/>";0<a&&(b+=d[a-1].name+" "+lm.total+": <span class=factNumber>"+graphTextFormatNumber(this.factSum[a],"#,###")+"</span><br/>",b+=d[a-1].name+" "+lm.average+": <span class=factNumber>"+graphTextFormatNumber(this.factSum[a]/
this.factSum[0],"#,###.00")+"</span><br/>");$("textSummary").innerHTML=b;$("mainChart").src?window.mainChart.reloadData():$("mainChart").src="/sims/graph.jsp";this.loadingScreen(!0)}};GraphCache.prototype.initSelectionFacts=function(){$("selectionPick").innerHTML="";for(var a=this.jsonCache.def.s,b=0;b<a.length;b++){var c=a[b];if(!(2>graph.jsonCache.selections[c.id].length)){var d=node("li");d.value=c.id;d.innerHTML=c.name;d.onclick=oSelPicker;$("selectionPick").appendChild(d)}}};
function oSelPicker(){var a=this.getAttribute("value");a=graph.jsonCache.selections[""+a];var b=$("factSelect").selectedIndex;a.sort(function(a,c){return c.f[b]-a.f[b]});var c=$("selectionRank");c.innerHTML="";for(var d=0;d<a.length;d++){var e=a[d],f=e.d,g=e.f[b];e=c.insertRow(d);var k=e.insertCell(0);k.innerHTML=d+1+".";k.style.width="30px";k=e.insertCell(1);k.innerHTML=f;k.noWrap=!0;f=e.insertCell(2);f.innerHTML=graphTextFormatNumber(g,"#,###.##");f.style.textAlign="right";f=e.insertCell(3);f.style.textAlign=
"right";g=graphTextFormatNumber(100*g/graph.factSum[b],"#.##");f.innerHTML=g+"%";e.insertCell(4).innerHTML='<div style="width:'+g+';">&nbsp;</div>'}}function graphTextFormatNumber(a,b){return isNaN(a)?0:ragic_number_format(a,b)}
function intervalDate(a,b){a=new Date(getDateFromFormat(a,"yyyy/M/d"));switch(b){case "W":b=a.getDay();a=new Date(a.getTime()-864E5*b);break;case "M":a.setDate(1);break;case "Q":b=a.getMonth();a.setDate(1);3>b?a.setMonth(0):6>b?a.setMonth(3):9>b?a.setMonth(6):a.setMonth(9);break;case "Y":a.setDate(1),a.setMonth(0)}return formatDate(a,"yyyy/M/d")}
function pickInterval(a,b){graph.loadingScreen();for(var c=$("intervalButtonSet").childNodes,d=0;d<c.length;d++){var e=c[d];e&&e.firstChild&&(e.firstChild.className="")}a.className="optionButtonSelected";graph.drawGraph(graph.currentFactIndex,b)}var graph;
function initPivot(){$("pivotTableDiv").innerHTML="";graph=new GraphCache(2);var a=getStorage("cdf_"+ap),b=getStorage("cdd_"+ap),c=getStorage("cdr_"+ap);a&&($("factSelect").selectedIndex=a);b&&($("timeSelect").selectedIndex=b);c&&($("dateRangeOption").selectedIndex=c);graph.currentFactIndex=$("factSelect").selectedIndex;graph.dateDomain=$("timeSelect").options[$("timeSelect").selectedIndex].value;$("dateDimOption").innerHTML=$("timeSelect").options[$("timeSelect").selectedIndex].innerHTML;toggleIntervalSelectDiv();
try{graph.loadForm(ap,dashPath,dashSheetIndex)}catch(d){alert(d)}}
function initGraph(){if($("textSummary")){$("textSummary").innerHTML="";graph=new GraphCache(1);var a=getStorage("cdf_"+ap),b=getStorage("cdd_"+ap),c=getStorage("cdr_"+ap),d=getStorage("cdi_"+ap);a&&($("factSelect").selectedIndex=a);b&&($("timeSelect").selectedIndex=b);c&&($("dateRangeOption").selectedIndex=c);d&&pickInterval($("interval"+d),d);graph.currentFactIndex=$("factSelect").selectedIndex;graph.dateDomain=$("timeSelect").options[$("timeSelect").selectedIndex].value;$("dateIntervalSelect")&&
(graph.level=$("dateIntervalSelect").options[$("dateIntervalSelect").selectedIndex].value);try{graph.loadForm(ap,dashPath,dashSheetIndex)}catch(e){}}}var ptable;
function PivotTable(a){this.colMapper=dateMapper;this.rowMapper=null;this.colValueGenerator=dateValueGenerator;this.rowValueGenerator=null;this.level=a?a:"2";this.currentRowLevel=this.currentColLevel=0;this.colValues=this.colValueGenerator?this.colValueGenerator(this.level):[];this.rowValues=this.rowValueGenerator?this.rowValueGenerator(this.level):[];this.data=[]}
function dateValueGenerator(a){var b=[],c=new Date(graph.currentDateFrom),d=new Date(graph.currentDateTo);switch(a){case "1":for(;c.getTime()<d.getTime();c=new Date(c.getTime()+864E5))b.push(formatDate(c,"yyyy/M/d"));break;case "2":for(;c.getTime()<d.getTime();){b.push(formatDate(c,"yyyy/M"));a=c.getFullYear();var e=c.getMonth();11==e?(e=0,a++):e++;c.setFullYear(a);c.setMonth(e)}break;case "3":for(;c.getTime()<d.getTime();)a=dateMapper(formatDate(c,"yyyy/M"),"3"),b.push(a),a=c.getFullYear(),e=c.getMonth()+
3,9<=e&&a++,c.setFullYear(a),c.setMonth(e)}return b}function dateMapper(a,b){switch(b){case "1":return a;case "2":return ragic_date_format(a,"yyyy/M");case "3":return a=ragic_date_format(a,"yyyy/M"),b=a.split("/"),"1"==b[1]||"2"==b[1]||"3"==b[1]?b[0]+" Q1":"4"==b[1]||"5"==b[1]||"6"==b[1]?b[0]+" Q2":"7"==b[1]||"8"==b[1]||"9"==b[1]?b[0]+" Q3":"10"==b[1]||"11"==b[1]||"12"==b[1]?b[0]+" Q4":a;case "4":return ragic_date_format(a,"yyyy")}}
PivotTable.prototype.readEntry=function(a,b,c){this.colMapper&&(a=this.colMapper(a,this.level));var d=indexOf(b,this.rowValues);-1==d&&(this.rowValues.push(b),d=this.rowValues.length-1);b=indexOf(a,this.colValues);-1==b&&(this.colValues.push(a),b=this.colValues.length-1);this.data[d]||(this.data[d]=[]);a=this.data[d][b];this.data[d][b]=a?a+c:c};
PivotTable.prototype.draw=function(a){a.innerHTML="";var b=node("table");a.appendChild(b);this.colValues.push("Total");var c,d=b.insertRow(0),e=d.insertCell(0);e.className="pivotHeaderTop";for(a=0;a<this.colValues.length;a++)e=d.insertCell(d.cells.length),e.innerHTML=this.colValues[a],e.className="pivotHeaderTop";var f=[],g=0,k=0;for(a=0;a<this.rowValues.length;a++){d=b.insertRow(-1);e=d.insertCell(0);e.innerHTML=this.rowValues[a];e.className="pivotHeaderLeft";for(c=0;c<this.colValues.length-1;c++){e=
(this.data[a]||[])[c]||"";var l=parseFloat(e);d.insertCell(d.cells.length).innerHTML=graphTextFormatNumber(e,"#,###");isNaN(l)||(g+=l,f[c]=f[c]?f[c]+l:l,k+=l)}e=d.insertCell(-1);e.innerHTML=graphTextFormatNumber(g,"#,###");e.style.fontWeight="bold";e.className="pivotHeaderLeft";g=0}d=b.insertRow(-1);d.style.fontWeight="bold";e=d.insertCell(0);e.innerHTML="Total";e.className="pivotHeaderLeft";for(c=0;c<this.colValues.length-1;c++)e=d.insertCell(-1),e.innerHTML=graphTextFormatNumber(f[c],"#,###"),e.className=
"pivotHeaderLeft";e=d.insertCell(-1);e.innerHTML=graphTextFormatNumber(k,"#,###");e.className="pivotHeaderLeft"};function toggleIntervalSelectDiv(a){a||(a=$("colDimSelect"));0==a.selectedIndex?$("intervalSelectDiv").style.display="":$("intervalSelectDiv").style.display="none"}function ReportQuery(a,b){this.formFieldJSON=a;this.configJSON=b}
ReportQuery.prototype.render=function(a){a.innerHTML="";var b=node("table");b.id="reportGenerationTable";a.appendChild(b);var c=b.insertRow(-1);a=c.insertCell(-1);a.innerHTML=lm.reportType+":";a=c.insertCell(-1);var d=this.configJSON.timeRangeType;c=getRagicSelection("rTimeRanges",this.timeRanges,d);c.onchange=function(){reportQuery.modifyItem("timeRangeType",this.options[this.selectedIndex].value,-1,!0);reportQuery.setDateRange(new Date);reportQuery.render($("rCanvas"))};a.appendChild(c);c=b.insertRow(-1);
a=c.insertCell(-1);a=c.insertCell(-1);if("Y"==d||"Q"==d||"M"==d)c=getRagicSelection("rYear",getRagicYearSelection(),this.getCurrentStartDate().getFullYear()),c.onchange=function(){var a=reportQuery.getCurrentStartDate();a.setFullYear(this.options[this.selectedIndex].value);reportQuery.setDateRange(a)},a.appendChild(c);"M"==d&&(c=getRagicSelection("rMonth",lm.monthsSelection,reportQuery.getCurrentStartDate().getMonth()),c.onchange=function(){var a=reportQuery.getCurrentStartDate();a.setMonth(this.options[this.selectedIndex].value);
reportQuery.setDateRange(a)},a.appendChild(c));"D"==d&&(c=node("input"),c.type="text",c.size=10,c.style.height="20px",c.cell=c,c.value=this.configJSON.startDate?this.configJSON.startDate:formatDate(new Date,"yyyy/MM/dd"),c.onclick=function(){datePickerClick(this)},c.onchange=function(){var a=parseDate(this.value);reportQuery.setDateRange(a)},c.onkeyup=function(){var a=parseDate(this.value);reportQuery.setDateRange(a)},a.appendChild(c));"C"==d&&(d=node("input"),d.type="text",d.size=10,d.style.height=
"20px",d.cell=d,d.value=this.configJSON.startDate?this.configJSON.startDate:formatDate(new Date,"yyyy/MM/dd"),d.onclick=function(){datePickerClick(this)},d.onchange=function(){var a=parseDate(this.value),b=parseDate(this.endDate.value);reportQuery.setDateRange(a,b)},d.onkeyup=function(){var a=parseDate(this.value),b=parseDate(this.endDate.value);reportQuery.setDateRange(a,b)},a.appendChild(d),c=node("span"),c.innerHTML=" ~ ",a.appendChild(c),c=node("input"),c.type="text",c.size=10,c.style.height=
"20px",c.cell=c,c.value=this.configJSON.startDate?this.configJSON.startDate:formatDate(new Date,"yyyy/MM/dd"),c.onclick=function(){datePickerClick(this)},c.onchange=function(){var a=parseDate(this.startDate.value),b=parseDate(this.value);reportQuery.setDateRange(a,b)},c.onkeyup=function(){var a=parseDate(this.startDate.value),b=parseDate(this.value);reportQuery.setDateRange(a,b)},a.appendChild(c),d.endDate=c,c.startDate=d);c=getRagicSelection("rTimeField",this.getFieldSelection("T",null,!0),this.configJSON.time);
c.onchange=function(){reportQuery.modifyItem("time",this.options[this.selectedIndex].value)};a.appendChild(c);c=b.insertRow(-1);a=c.insertCell(-1);a=c.insertCell(-1);for(d=0;d<this.configJSON.analyzeItems.length;d++)a.appendChild(this.getAnalyzeItemDisplay(this.configJSON.analyzeItems[d],d));d=node("a");d.href="javascript:void(0);";d.innerHTML=lm.addAnotherField;d.onclick=function(){reportQuery.insertItem()};a.appendChild(d);c=b.insertRow(-1);a=c.insertCell(-1);a.innerHTML="";a=c.insertCell(-1);a.id=
"generateReportButtons";a.style.paddingTop="12px";d=node("div");d.id="viewReportButton";d.style.margin="12px 12px 12px 0";d.style.backgroundImage="url(/sims/img/buttonBlue.png)";d.style.color="#ffffff";d.style.border="1px solid #333333";makeButton(d);d.innerHTML=lm.viewReport;d.style.display="none";a.appendChild(d);d=node("div");d.id="fullReportButton";makeButton(d);d.style.margin="12px 12px 12px 0";d.style.clear="left";d.className="topButtonWhole";d.onclick=function(){generateReport(!1)};a.appendChild(d);
d=node("div");d.id="quickReportButton";makeButton(d);d.style.margin="12px 12px 12px 0";d.className="topButtonWhole";d.onclick=function(){generateReport(!0)};a.appendChild(d);c=b.insertRow(-1);a=c.insertCell(-1);a.innerHTML="";a=c.insertCell(-1);a.id="generateReportButtons";a.style.paddingTop="12px";c=b.insertRow(-1);a=c.insertCell(-1);a.innerHTML="";a=c.insertCell(-1);a.id="generateReportProgress";a.style.paddingTop="12px"};
ReportQuery.prototype.getFormFieldJSON=function(a){for(var b=0;b<this.formFieldJSON.length;b++)if(this.formFieldJSON[b].domainId==a)return this.formFieldJSON[b];return null};ReportQuery.prototype.getFieldSelection=function(a,b,c){var d=[],e=this.getSubtableKey();c||d.push([-1," ",-1]);for(c=0;c<this.formFieldJSON.length;c++){var f=this.formFieldJSON[c];a&&f.type!=a||e&&0<e&&0<f.subtableKey&&f.subtableKey!=e||b&&f.type==b||d.push([f.domainId,f.name,f.subtableKey])}return d};
ReportQuery.prototype.getSubtableKey=function(){for(var a=this.configJSON.analyzeItems,b=0;b<a.length;b++){var c=this.getSubtableKeyForField(a[b].domainId);if(0<c)return c}return-1};ReportQuery.prototype.getSubtableKeyForField=function(a){for(var b=0;b<this.formFieldJSON.length;b++){var c=this.formFieldJSON[b];if(c.domainId==a)return c.subtableKey}};
ReportQuery.prototype.getAnalyzeItemDisplay=function(a,b){var c=node("div");a="D"==a.type?this.getAnalyzeDim(a,b):"FP"==a.type?this.getAnalyzeFactPercentage(a,b):"FN"==a.type?this.getAnalyzeFactNumber(a,b):this.getAnalyzeDefault(b);c.appendChild(a);0<b&&(a=node("i"),a.className="fa fa-times rButton",a.onclick=function(){reportQuery.deleteItem(b)},c.appendChild(a));return c};
ReportQuery.prototype.getAnalyzeDefault=function(a){var b=node("span"),c=getRagicSelection(null,this.getFieldSelection(null,"T"));c.index=a;c.onchange=changeFieldSelection;b.appendChild(c);return b};function changeFieldSelection(){var a=this.index,b=this.options[this.selectedIndex].value,c=reportQuery.getFormFieldJSON(b);"D"==c.type?reportQuery.modifyItem("type","D",a,!0):"F"==c.type&&reportQuery.modifyItem("type","FN",a,!0);reportQuery.modifyItem("domainId",b,a)}
ReportQuery.prototype.getAnalyzeFactPercentage=function(a,b){var c=this.getFormFieldJSON(a.domainId),d=node("span"),e=getRagicSelection(null,this.getFieldSelection(null,"T"),a.domainId);e.index=b;e.onchange=changeFieldSelection;a=getOptionSelection(null,c.options,a.filterValue);a.onchange=function(){reportQuery.modifyItem("filterValue",this.options[this.selectedIndex].value,b)};d.appendChild(e);d.appendChild(a);return d};
ReportQuery.prototype.getAnalyzeFactNumber=function(a,b){var c=node("span"),d=getRagicSelection(null,this.getFieldSelection(null,"T"),a.domainId);d.index=b;d.onchange=changeFieldSelection;a=getRagicSelection(null,[["SUM","SUM"],["AVG","AVG"]],a.summaryType);a.onchange=function(){reportQuery.modifyItem("summaryType",this.options[this.selectedIndex].value,b)};c.appendChild(d);c.appendChild(a);return c};
ReportQuery.prototype.getAnalyzeDim=function(a,b){var c=this.getFormFieldJSON(a.domainId),d=node("span"),e=getRagicSelection(null,this.getFieldSelection(null,"T"),a.domainId);e.index=b;e.onchange=changeFieldSelection;a=getOptionSelection(null,c.options,a.filterValue);a.onchange=function(){var a=this.options[this.selectedIndex].value;"ALL"==a?(reportQuery.modifyItem("type","D",b,!0),reportQuery.modifyItem("filterValue","ALL",b)):(reportQuery.modifyItem("type","FP",b,!0),reportQuery.modifyItem("filterValue",
a,b))};d.appendChild(e);d.appendChild(a);return d};ReportQuery.prototype.modifyItem=function(a,b,c,d){0<=c?this.configJSON.analyzeItems[c][a]=b:this.configJSON[a]=b;d||this.render($("rCanvas"))};ReportQuery.prototype.insertItem=function(a){var b={type:"U",domainId:-1,summaryType:"SUM"};a?this.configJSON.analyzeItems.splice(a+1,0,b):this.configJSON.analyzeItems.push(b);this.render($("rCanvas"))};ReportQuery.prototype.deleteItem=function(a){this.configJSON.analyzeItems.splice(a,1);this.render($("rCanvas"))};
ReportQuery.prototype.getCurrentStartDate=function(){return parseDate(reportQuery.configJSON.startDate)};
ReportQuery.prototype.setDateRange=function(a,b){var c=reportQuery.configJSON.timeRangeType;a instanceof String&&(a=parseDate(a));if(a&&("C"!=c||b)){a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);var d=new Date(a.getTime());a=new Date(a.getTime());"D"==c?a.setDate(d.getDate()+1):"C"==c?a.setTime(b.getTime()):"M"==c?(d.setDate(1),a.setMonth(d.getMonth()+1),a.setDate(1)):"Y"==c&&(d.setDate(1),d.setMonth(0),a.setDate(1),a.setMonth(0),a.setFullYear(d.getFullYear()+1));reportQuery.configJSON.startDate=
formatDate(d,"yyyy/MM/dd");reportQuery.configJSON.endDate=formatDate(a,"yyyy/MM/dd")}};function getOptionSelection(a,b,c){var d=node("select");a&&(d.id=a);var e=node("optgroup");d.appendChild(e);e.label="-----------------";a=node("optgroup");d.appendChild(a);a.label="-----------------";var f=node("option");f.value="ALL";e.appendChild(f);for(e=0;b&&e<b.length;e++)f=node("option"),f.value=b[e][0],f.innerHTML=b[e][1],c==b[e][0]&&(f.selected=!0),a.appendChild(f);return d}
function getRagicSelection(a,b,c){var d=node("select");a&&(d.id=a);a=b&&b[0]&&3<=b[0].length;for(var e,f,g=0;b&&g<b.length;g++){var k=node("option");k.value=b[g][0];k.innerHTML=b[g][1];c==b[g][0]&&(k.selected=!0);if(a){var l=b[g][2];e!=l&&(e=l,f=node("optgroup"),f.label="---------------",d.appendChild(f));f.appendChild(k)}else d.appendChild(k)}return d}function getRagicDateSelection(a,b){var c=node("input");c.id=a;c.type="text";c.onclick=function(){datePickerClick(this)};c.value=b}
function getRagicYearSelection(){for(var a=(new Date).getFullYear(),b=[],c=-10;5>=c;c++)b.push([a+c,a+c]);return b}var reportQuery;
function generateReport(a){var b=encodeURIComponent(JSON.stringify(reportQuery.configJSON));$("viewReportButton").style.display="none";$("generateReportProgress").innerHTML="";var c=smallProgress(1,!0);c.style.width="300px";c.style.cssFloat="left";$("fullReportButton").style.display="none";$("quickReportButton").style.display="none";$("generateReportProgress").appendChild(c);c=node("div");c.id="generateReportProgressText";c.style.cssFloat="left";$("generateReportProgress").appendChild(c);runpbar(.15);
ctrl.needCheckProgress=!0;setTimeout(checkReportGenStatus,2E3);read(function(a){eval(a.responseText)},"/sims/report/queryexec.jsp?"+(a?"quick&":"")+"a="+ap+"&p="+path+"&fn="+encodeURIComponent(sheet)+"&q="+b)}function checkReportGenStatus(){ctrl.needCheckProgress&&read(function(a){eval(a.responseText);ctrl.reportGenTimer=setTimeout(checkReportGenStatus,2E3)},"/sims/report/checkReportGenStatus.jsp")}
function showReportQuery(){read(function(a){a=JSON.parse(a.responseText);reportQuery=new ReportQuery(a.formFields,a.defaultReport);reportQuery.setDateRange(new Date);floatWin(null,'<div id="rCanvas"></div>',null,!0);reportQuery.render($("rCanvas"))},"/sims/report/getReports.jsp?a="+ap+"&p="+path+"&fn="+encodeURIComponent(sheet))}var rtpPasteTimer;
function initExcelSmartImport(){lightbox("/sims/excel-to-db.jsp?a="+ap);$("conversionReceiver").focus();rtpPasteTimer=window.setTimeout(rtppasteChecker,200)}function rtppasteChecker(){var a=$("conversionReceiver");a&&-1!=a.value.indexOf("\t")?rtppaste():(a&&1<a.value.length&&(alert("That does not look like data copied from Excel or any spreadsheet."),a.value=""),rtpPasteTimer=window.setTimeout(rtppasteChecker,200))}var rtpmode="H",rtppasted=!1;
function rtppaste(){var a=$("conversionReceiver");a&&-1!=a.value.indexOf("\t")&&(rtppasted=!0,$("rtpstep1").style.display="none",$("rtpstep2").style.display="",ragictp.paste(a.value,$("conversionTable")))}function rtprowclick(){var a=this.getAttribute("y");ragictp.calculateAll(a,$("conversionTable"))}
var ragictp={source:null,data:[[]],formType:"L",maxX:0,maxY:0,appName:null,fieldKeywords1:"date amount name qty quantity price total notes memo owner email phone mobile fax url title contact subject priority address status number desc description id code \u65e5 \u50f9 \u91d1\u984d \u6578\u91cf \u540d\u7a31 \u63cf\u8ff0 \u5099\u8a3b \u4eba".split(" "),dateKeywords:["date","\u65e5"],paste:function(a,b){this.source=a;this.parseSource();this.markFields(this.analyzeHighrow());this.print(b)},calculateAll:function(a,
b){this.parseSource();this.markFields(a);this.print(b)},parseSource:function(){var a,b=1,c=this.data=[[]];tsvparser.load(this.source);for(var d;d=tsvparser.readNext();){c[b]||(c[b]=[]);for(a=1;a-1<d.length;a++){var e=d[a-1];e&&!this.appName&&(e=e.replace(/[ ]{2,}/gm," "),this.appName=e.substr(0,50));c[b][a]=new RagicTPField(e);a>this.maxX&&(this.maxX=a)}b>this.maxY&&(this.maxY=b);b++}d=[];for(b=1;b<c.length;b++)for(a=1;a<c[b].length;a++)1!=d[a]&&(e=c[b][a])&&e.value&&0<e.value.length&&(d[a]=1);e=
0;for(a=1;a<d.length;a++)if(1!=d[a]){for(b=1;b<c.length;b++)c[b].splice(a-e,1);e++}},analyzeHighrow:function(){var a,b,c=this.data,d=[];for(b=c.length-1;1<=b;b--)for(a=1;a<c[b].length;a++){var e=c[b][a];if(e)if(e.isText){var f=d[a]||0;e.listingModifier*=Math.min(1.2*f,3);e.formModifier/=Math.min(1.1*f,3);d[a]=0}else 1<e.specialCharCount?1<a&&(e=c[b][a-1])&&1<e.specialCharCount&&(d[a-1]=d[a-1]?d[a-1]+1:1,d[a]=d[a]?d[a]+1:1):d[a]=0;else d[a]=0}for(b=1;b<c.length;b++)for(a=1;a<c[b].length;a++)(e=c[b][a])&&
e.value&&0<e.value.length&&(1<b&&(d=c[b-1][a])&&d.value&&0<d.value.length&&70<e.fhscore&&(d.formModifier*=1.3,d.listingModifier/=1.3),b+1<c.length&&(d=c[b+1][a])&&d.value&&0<d.value.length&&70<e.fhscore&&(d.formModifier*=1.3),1<a&&(d=c[b][a-1])&&d.value&&0<d.value.length&&70<e.fhscore&&(.5>e.fhscore&&(d.formModifier*=1.3),d.listingModifier*=1.3),a+1<c[b].length&&(d=c[b][a+1])&&d.value&&0<d.value.length&&70<e.fhscore&&(d.formModifier/=1.3,d.listingModifier*=1.3));f=[];for(b=1;b<c.length;b++){d=0;for(a=
1;a<c[b].length;a++)(e=c[b][a])&&e.value&&(d+=Math.round(e.fhscore*e.listingModifier)||0);f[b]=d}a=d=0;for(b=1;b<f.length;b++)f[b]>a&&(a=f[b],d=b);var g=f=0;for(b=1;b<c.length;b++)for(a=1;a<c[b].length;a++)e=c[b][a],g++,e&&e.value&&0<e.value.length&&f++;return d},markFields:function(a){a&&(a=parseInt(a));var b,c,d=this.data;this.highrow=a;if("L"==this.formType){var e;for(b=1;b<d[a].length;b++){var f=d[a][b];if(f&&f.value&&0<f.value.length||e){f.value||(f.value="\u3000");f.cellType="H";e||(e=b);var g=
b}else a+1<d.length&&(c=d[a+1][b])&&c.value&&0<c.value.length&&(f.value="\u3000",f.cellType="H",e||(e=b),g=b)}for(b=e;b<=g;b++){var k=[0,0,0];var l={};for(c=a+1;c<d.length;c++)f=d[c][b],k[0]++,f.asDate?k[1]++:f.asNumber?k[2]++:f.value&&(l[f.value]?l[f.value]++:l[f.value]=1);if(2*k[1]>k[0])d[a][b].inputType="DATE";else if(2*k[2]>k[0])d[a][b].inputType="NUMBER";else{f=0;for(var m in l)1<l[m]&&(f+=l[m]);2*f>k[0]&&(d[a][b].inputType="L",d[a][b].existingValue=l)}}for(c=a+1;c<d.length;c++)for(b=1;b<d[c].length;b++){f=
d[c][b];if(!f.value){k=(g=d[c-1][b])&&g.value&&"D"==g.cellType;for(l=1;b-l>=e;){if((m=d[c][b-l])&&m.value&&!m.filledValue){k=!1;break}l++}k&&(f.value=g.value,f.filledValue=!0)}f.cellType="D"}for(c=a-1;1<=c;c--)for(b=1;b<d[c].length;b++)f=d[c][b],f.cellType=f&&f.value?"F":"I"}},print:function(a){var b,c;rm(a);var d=this.maxX,e=this.maxY;for(c=1;c<=e;c++){var f=a.insertRow(-1);f.onclick=rtprowclick;f.setAttribute("y",c);for(b=1;b<=d;b++){var g=f.insertCell(-1);g.id="c"+b+"_"+c}}for(c=1;c<this.data.length;c++)for(b=
1;b<this.data[c].length;b++)g=$("c"+b+"_"+c),g.rtp=this.data[c][b],g.rtp.cell=g,g.rtp.render();a=document.body.clientWidth;b=document.body.clientHeight;$("conversionTableDiv").style.width=.6*a+"px";$("conversionTableDiv").style.height=.8*b+"px"},exportSheet:function(){$("rtpcontent").value=this._createNUI();$("rtpimport").value=this._prepareImportData();$("rtpform").submit()},_prepareImportData:function(){var a,b,c=this.data,d="";for(b=1;b<c.length;b++){for(a=1;a<c[b].length;a++){var e=c[b][a];"D"==
e.cellType&&(d=e.value?e.asNumber?d+(e.asNumber+"\t"):d+(e.value+"\t"):d+"\t")}d+="\n"}return d},_createNUI:function(){var a="";this.appName&&(a+="N,"+this.appName+"\n");0==$("rtpac").selectedIndex?a+="A,MANAGER=6&EVERYONE=0&USER=1,3,3,\n":1==$("rtpac").selectedIndex?a+="A,MANAGER=6&EVERYONE=0&USER=2,3,3,\n":2==$("rtpac").selectedIndex?a+="A,MANAGER=6&EVERYONE=0&USER=3,3,3,\n":3==$("rtpac").selectedIndex?a+="A,MANAGER=6&EVERYONE=1&USER=1,3,3,\n":4==$("rtpac").selectedIndex?a+="A,MANAGER=6&EVERYONE=2&USER=2,3,3,\n":
5==$("rtpac").selectedIndex&&(a+="A,MANAGER=6&EVERYONE=3&USER=3,3,3,\n");var b,c,d=this.data,e={};for(c=1;c<d.length;c++)for(b=1;b<d[c].length;b++){var f=d[c][b];"H"==f.cellType?"D"==f.inputType?a+="D,"+b+","+c+",,"+f.value+",\n":"L"==f.inputType?(a+="L,"+b+","+c+",,"+f.value+",\n",e[b+"|"+c]=f):"DATE"==f.inputType?a+="D,"+b+","+c+",,"+f.value+",fmt_d=yyyy/M/d\n":"NUMBER"==f.inputType&&(a+="D,"+b+","+c+",,"+f.value+",fmt_n=#`###\n"):"F"==f.cellType&&(a+="F,"+b+","+c+",,"+f.value+",\n")}for(var g in e){f=
e[g];b=f.existingValue;c="";d=!0;for(var k in b)d?d=!1:c+=",",c+=k;a+="S,"+g+",,"+c+"\n"}return a},hasKeyword:function(a){for(var b=this.fieldKeywords1,c=0;c<b.length;c++)if(-1!=a.indexOf(b[c]))return!0;return!1},fieldLengthScore:function(a){var b=a.split(" ").length;b=3<b?.05:3==b?.2:2==b?.7:1;a=encodeURIComponent(a);a=a.replace(/%/gm,"");a=a.length;45<a?b*=.2:35<a?b*=.7:20<a&&(b*=.9);return b},specialCharCount:function(a){for(var b=0,c=0,d=0;d<a.length;d++){var e=a.charCodeAt(d),f=a.charAt(d);33<=
e&&64>=e&&":"!=f&&"\uff1a"!=f?b++:c++}return.5<b/(b+c)?10:b},getNumber:function(a){a=a.replace(/[,\$]?/g,"");return/^\d+$/g.test(a)?a:null},getDate:function(a){return parseDate(a,!0)}};
function RagicTPField(a){this.value=a.replace(/\n/gm,"<br>");this.value=this.value.replace(/[ ]{2,}/gm," ");this.fhscore=100;this.formModifier=this.listingModifier=1;this.asNumber=ragictp.getNumber(a);this.asDate=ragictp.getDate(a);this.specialCharCount=ragictp.specialCharCount(a);this.isText=1< !this.specialCharCount&&a&&0<a.length;this.fhscore*=ragictp.fieldLengthScore(a);1<this.specialCharCount?this.fhscore*=.1:1==this.specialCharCount&&(this.fhscore*=.7);ragictp.hasKeyword(a)&&(this.fhscore=Math.min(100,
this.fhscore+50));this.inputType=this.cellType="D"}
RagicTPField.prototype.render=function(){var a=this.cell;if(a)switch(a.innerHTML=this.value?this.value:"&nbsp;",this.cellType){case "E":a.style.background="#dbdbdb";break;case "D":a.style.background="#ffffff";break;case "H":a.style.background="#E0E7EF";var b=node("select");b.className="rtpselect";a.appendChild(b);b.onclick=function(a){a||(a=window.event);a.cancelBubble=!0};a=node("option");a.value="D";a.innerHTML="Text";b.appendChild(a);a=node("option");a.value="L";a.innerHTML="Selection";b.appendChild(a);
a=node("option");a.value="DATE";a.innerHTML="Date";b.appendChild(a);a=node("option");a.value="NUMBER";a.innerHTML="Number";b.appendChild(a);b=b.options;for(a=0;a<b.length;a++)b[a].value==this.inputType&&(b[a].selected=!0);break;case "F":a.style.background="#dbdbdb";a.style.color="#888888";break;case "I":a.style.background="#dbdbdb",a.style.color="#cccccc"}};
var tsvparser={content:[],currentLine:0,load:function(a){this.content=a.split("\n");this.currentLine=0},readNext:function(a){a=this.getNextLine(a);return this.parseLine(a)},getNextLine:function(a){for(;this.currentLine<this.content.length;){var b=this.content[this.currentLine++];if(a)return b?b:" ";for(var c=0;c<b.length;c++)if("\t"!=b.charAt(c)&&"\n"!=b.charAt(c)&&" "!=b.charAt(c))return b}return null},parseLine:function(a){if(!a)return null;for(var b=[],c="",d=!1,e=!0;d||e;){e=!1;if(d&&(c+="\n",
a=this.getNextLine(),null==a))break;for(var f=0;f<a.length;f++){var g=a.charAt(f);'"'==g?d&&a.length>f+1&&'"'==a.charAt(f+1)?(c+=a.charAt(f+1),f++):(d=!d,2<f&&"\t"!=a.charAt(f-1)&&a.length>f+1&&"\t"!=a.charAt(f+1)&&(c+=g)):"\t"!=g||d?c+=g:(b.push(trim11(c)),c="")}}b.push(trim11(c));return b}};function trim11(a){a=a.replace(/^\s+/,"");for(var b=a.length-1;0<=b;b--)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a}
function rtpSave(){$("rtpSavePanel").style.display="";$("appName").value=ragictp.appName;$("appPath").value=ragictp.appName}
function tablePasteMapper(a){for(var b=biffdata.biffs,c={},d={},e=0;e<b.length;e++){var f=b[e];f.dataType==HEADER&&(c[f.domainId]=f.value)}for(e=0;e<b.length;e++)if(f=b[e],f.dataType==DATA){var g=c[f.domainId];d[g]||(d[g]=[]);d[g].push(f)}for(tsvparser.load(a);b=tsvparser.readNext();)for(c=0;c<b.length;c++){var k=b[c];for(g in d)g==k&&(e=d[g][0].ip,f=ragictp.getNumber(b[c+1]),e.loadValue(f?f:b[c+1]),e.render())}tsvparser.load(a);for(a=tsvparser.readNext();b=tsvparser.readNext(!0);)for(1>=b.length&&
(a=tsvparser.readNext()),c=1;c<b.length;c++)for(g in d)if(g==b[0]+a[c]||g==a[c]+b[0])e=d[g][0].ip,f=ragictp.getNumber(b[c]),e.loadValue(f?f:b[c]),e.render()}
function oldTablePaste(a){var b=nui,c;a=a.split(ctrl.CRLF);var d=b._curcell();var e=parseInt(d.id.split("_")[1]),f=parseInt(d.id.split("_")[2]);if(mode==BUILDER){for(d=0;d<a.length;d++){var g=a[d].split("\t");for(c=0;c<g.length;c++)builder.setContent(e+c,f+d,g[c]);if(1<g.length)break}builder.renderAll()}else if(mode==UPDATE)for(d=0;d<a.length;d++)for(g=a[d].split("\t"),c=0;c<g.length;c++)if(0==d&&0==c)$("hin").setValue(g[c]);else{var k=b._getcell(e+c,f+d);k&&k.ip&&(k.ip.loadValue(g[c]),k.ip.render())}}
var RTEUIcontroller=function(){function a(){var a=$("RTEframe"),d=document,e=ctrl;a&&!a.src&&(a.addEventListener("load",function(){e.RTEeditor=this.contentWindow.editor;l=e.RTEeditor;b();for(var a=d.querySelectorAll(".RTEitem"),k=a.length;k--;){var m=a[k];m.addEventListener("click","saveContent"===m.dataset.action?f:g)}l.addEventListener("click",c);l.setHTML(RagicBBCodeParser.processToHTML(RTEUIcontroller.typer.getValue()));p=l.getRoot().innerHTML;q.style.display="";l.focus()}),a.src="/sims/RTEContainer.jsp")}
function b(){var a,b=q.querySelectorAll(".RTEDropdown");q.querySelector(".floatingWinContent").addEventListener("mouseup",function(d){var e=d.target;if("I"===e.tagName){if(!e.classList.contains("RTEquit")){cancelEventBubble(d);return}}else for(a=b.length;a--;)if(b[a].contains(e)){cancelEventBubble(d);return}c()},!1);var d={};for(a=b.length;a--;d={$jscomp$loop$prop$fontSelect$662:d.$jscomp$loop$prop$fontSelect$662,$jscomp$loop$prop$fontFamilySelect$663:d.$jscomp$loop$prop$fontFamilySelect$663}){var e=
b[a],f=void 0,g=void 0;switch(e.id){case "RTEIndentInput":e.querySelector(".RTEbtn").onclick=function(){var a=$("RTEIndent");"increase"===a.options[a.selectedIndex].value?ctrl.RTEeditor.increaseIndent():ctrl.RTEeditor.decreaseIndent();ctrl.RTEeditor.focus()};break;case "RTETableInput":e.querySelector(".RTEbtn").onclick=function(){var a=$("RTErows"),b=$("RTEcols");ctrl.RTEeditor.makeTable(b.value||1,a.value||1);ctrl.RTEeditor.focus();a.value="";b.value=""};break;case "RTELinkInput":e.querySelector(".RTEbtn").onclick=
function(){var a=$("insertRTElink"),b=a.value;b&&(b.startsWith("http://")||b.startsWith("https://")||(b="http://"+b),b.match(/[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)?/gi)?(ctrl.RTEeditor.makeLink(b),a.value="",$("RTELinkMessage").innerText=""):$("RTELinkMessage").innerText="Url Invalid");ctrl.RTEeditor.focus()};break;case "RTEImageInput":e.querySelector(".RTEbtn").onclick=function(){var a=$("insertRTEimage"),b=a.value;b&&(b.startsWith("http://")||b.startsWith("https://")||
(b="http://"+b),ctrl.RTEeditor.insertImage(b),a.value="");ctrl.RTEeditor.focus()};break;case "RTEOLInout":f=e.querySelectorAll(".RTEDropdownOption");for(g=f.length;g--;)f[g].onclick=function(){var a=this.dataset.style;ctrl.RTEeditor.makeOrderedList();for(var b=ctrl.RTEeditor.getSelection().startContainer;"OL"!==b.tagName;)b=b.parentNode;b.style.listStyleType=a;ctrl.RTEeditor.focus()};break;case "RTEULInout":f=e.querySelectorAll(".RTEDropdownOption");for(g=f.length;g--;)f[g].onclick=function(){var a=
this.dataset.style;ctrl.RTEeditor.makeUnorderedList();for(var b=ctrl.RTEeditor.getSelection().startContainer;"UL"!==b.tagName;)b=b.parentNode;b.style.listStyleType=a;ctrl.RTEeditor.focus()};break;case "RTEFont":d.$jscomp$loop$prop$fontSelect$662=e.querySelector("#RTEFontSize");["",10,12,14,16,18,20,22,24,28,36,48,72].forEach(function(a){return function(b){a.$jscomp$loop$prop$fontSelect$662.appendChild(new Option(b,b))}}(d));d.$jscomp$loop$prop$fontFamilySelect$663=e.querySelector("#RTEFontFamily");
f=";Open Sans;Arial;Lucida Grande;Monospace;Noto Sans".split(";");"zh-TW"===langv5?(f.push("\u65b0\u7d30\u660e\u9ad4"),f.push("\u5fae\u8edf\u6b63\u9ed1\u9ad4"),f.push("Noto Sans CJK TC")):"zh-CN"===langv5&&f.push("Noto Sans CJK SC");f.forEach(function(a){return function(b){a.$jscomp$loop$prop$fontFamilySelect$663.appendChild(new Option(b,b))}}(d));e.querySelector(".RTEbtn").onclick=function(a){return function(){a.$jscomp$loop$prop$fontSelect$662.value&&(ctrl.RTEeditor.setFontSize(a.$jscomp$loop$prop$fontSelect$662.value+
"px"),a.$jscomp$loop$prop$fontSelect$662.value="");if(a.$jscomp$loop$prop$fontFamilySelect$663.value)try{ctrl.RTEeditor.setFontFace(a.$jscomp$loop$prop$fontFamilySelect$663.value),a.$jscomp$loop$prop$fontFamilySelect$663.value=""}catch(w){}c();ctrl.RTEeditor.focus()}}(d);break;case "RTEColorPickerDrop":m||(f=e.querySelector("#RTEColorPicker"),m=new ColorPicker(f.querySelector(".slide"),f.querySelector(".picker"),f.querySelector(".color_input"),f.querySelector(".ragic_color_palette"),f.querySelector(".slide-indicator"),
f.querySelector(".picker-indicator")),f.classList.add("safari-picker"),m.setCallback(function(a){c();ctrl.RTEeditor.setTextColour(a)}),e.querySelector(".topIcon_bFColor").addEventListener("click",function(){this.classList.contains("RTE_CP_Type_Color")||this.classList.add("RTE_CP_Type_Color");this.classList.contains("RTE_CP_Type_BG")&&this.classList.remove("RTE_CP_Type_BG")}.bind(e))),n||(f=e.querySelector("#RTEBGColorPicker"),n=new ColorPicker(f.querySelector(".slide"),f.querySelector(".picker"),
f.querySelector(".color_input"),f.querySelector(".ragic_color_palette"),f.querySelector(".slide-indicator"),f.querySelector(".picker-indicator")),f.classList.add("safari-picker"),n.setCallback(function(a){c();ctrl.RTEeditor.setHighlightColour(a)}),e.querySelector(".topIcon_bBColor").addEventListener("click",function(){this.classList.contains("RTE_CP_Type_Color")&&this.classList.remove("RTE_CP_Type_Color");this.classList.contains("RTE_CP_Type_BG")||this.classList.add("RTE_CP_Type_BG")}.bind(e)))}}}
function c(){for(;r.length;)r.shift().style.display="none"}function d(a,b){c();a=$(a);r.push(a);for(b=b.target;"DIV"!==b.tagName;)b=b.parentNode;b=b.getBoundingClientRect();var d=q.getBoundingClientRect();a.style.cssText="right:"+(d.right-b.right)+"px;top:"+(b.bottom-d.top+1)+"px;display:block;";(a=a.querySelector("INPUT"))&&a.focus()}function e(){var a=RTEUIcontroller.typer;a&&(a.focused&&setTimeout(function(){a.blur()},100),RTEUIcontroller.typer=null,c())}function f(){var a=l.getRoot(),b=$("hin"),
c=RagicBBCodeParser.processToBBCode(a);c="[br][/br]"===c?"":c;b.setValue(c);RTEUIcontroller.typer.loadValue(c);p=a.innerHTML;subTableExtendProcess(c,RTEUIcontroller.typer.biff);biffdata.autoSave&&autoSaveInterval(300);RTEUIcontroller.closeEditor()}function g(a){var b=ctrl.RTEeditor,c=this.dataset.action,e=b.testPresenceinSelection("bold",c,"B",/>B\b/),f=b.testPresenceinSelection("italic",c,"I",/>I\b/),g=b.testPresenceinSelection("underline",c,"U",/>U\b/),k=b.testPresenceinSelection("makeOrderedList",
-1!==c.indexOf("rderedList")?"makeOrderedList":c,"OL",/>OL\b/),l=b.testPresenceinSelection("makeUnorderedList",-1!==c.indexOf("rderedList")?"makeUnorderedList":c,"UL",/>UL\b/),p=b.testPresenceinSelection("makeLink",c,"A",/>A\b/),q=b.testPresenceinSelection("increaseQuoteLevel",c,"blockquote",/>blockquote\b/);e||f||g||l||k||p||q?(e&&b.removeBold(),f&&b.removeItalic(),g&&b.removeUnderline(),p&&b.removeLink(),(k||l)&&b.removeList(),q&&b.decreaseQuoteLevel()):"makeLink"===c?d("RTELinkInput",a):"insertImage"===
c?d("RTEImageInput",a):"tint"===c?(b=b.getFontInfo(),b.color?(c=b.color.match(/^rgb?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/))&&m.setRgb({r:c[1],g:c[2],b:c[3]}):document.querySelector("#RTEColorPicker .color_input").value="",b.backgroundColor?(c=b.backgroundColor.match(/^rgb?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/))&&n.setRgb({r:c[1],g:c[2],b:c[3]}):document.querySelector("#RTEBGColorPicker .color_input").value="",d("RTEColorPickerDrop",a)):"increaseIndent"===c?d("RTEIndentInput",a):"makeTable"===
c?d("RTETableInput",a):"makeUnorderedList"===c?d("RTEULInout",a):"makeOrderedList"===c?d("RTEOLInout",a):"selectFont"===c?d("RTEFont",a):(b[c](),b.focus())}var k={typer:null},l,m,n,q=$("floatingRTE"),r=[],p;k.showEditor=function(b){mode!=BROWSE||ctrl.outOfNUI||modeUpdate();this.typer=b;outNUI();(l=ctrl.RTEeditor)?""!==q.style.display&&(l.setHTML(RagicBBCodeParser.processToHTML(b.getValue().replace(/</g,"&lt;").replace(/>/g,"&gt;"))),p=l.getRoot().innerHTML,q.style.display="",l.focus()):a()};k.closeEditor=
function(a){a=a?a.ip:null;"none"!==q.style.display&&a!==this.typer&&(l.getRoot().innerHTML!==p&&confirm(lm.RTE_save_confirm)&&f(),e(),q.style.display="none",inNUI())};return k}(),RagicBBCodeParser=function(){function a(a){return a.replace(/"/gm,"&quot;")}function b(a){return a=a.replace(/<([^>][^>]*?)>/gi,function(a,b){return null===b.match(/^bbcl=([0-9]+) /)?"<bbcl=0 "+b+">":"<"+b.replace(/^(bbcl=)([0-9]+)/,function(a,b,c){return b+(parseInt(c,10)+1)})+">"})}function c(a){for(;a!==(a=a.replace(/\[list([ =][^\]]*)?\]([^>]*?)(\[\/list])/gi,
function(a,b,c){for(;a!==(a=a.replace(/\[\*\]([^\[]*?)(\[\*\]|\[\/list])/i,function(a,b,c){c="[/list]"===c.toLowerCase()?"[/*][/list]":"[/*][*]";return"[*]"+b+c})););return a})););return a}function d(a){for(;a!==(a=a.replace(p,function(a,c,d,e){return b("<"+c+(d||"")+">"+e+"</"+c+">")})););return a}var e={},f=/^(?:https?|mailto?):(?:\/{0,3}|\\{1})[-a-zA-Z0-9:;,@#!%&()~_?\+=\/\\\.]*$/,g=/^(?:aliceblue|antiquewhite|aqua|aquamarine|azure|beige|bisque|black|blanchedalmond|blue|blueviolet|brown|burlywood|cadetblue|chartreuse|chocolate|coral|cornflowerblue|cornsilk|crimson|cyan|darkblue|darkcyan|darkgoldenrod|darkgray|darkgreen|darkkhaki|darkmagenta|darkolivegreen|darkorange|darkorchid|darkred|darksalmon|darkseagreen|darkslateblue|darkslategray|darkturquoise|darkviolet|deeppink|deepskyblue|dimgray|dodgerblue|firebrick|floralwhite|forestgreen|fuchsia|gainsboro|ghostwhite|gold|goldenrod|gray|green|greenyellow|honeydew|hotpink|indianred|indigo|ivory|khaki|lavender|lavenderblush|lawngreen|lemonchiffon|lightblue|lightcoral|lightcyan|lightgoldenrodyellow|lightgray|lightgreen|lightpink|lightsalmon|lightseagreen|lightskyblue|lightslategray|lightsteelblue|lightyellow|lime|limegreen|linen|magenta|maroon|mediumaquamarine|mediumblue|mediumorchid|mediumpurple|mediumseagreen|mediumslateblue|mediumspringgreen|mediumturquoise|mediumvioletred|midnightblue|mintcream|mistyrose|moccasin|navajowhite|navy|oldlace|olive|olivedrab|orange|orangered|orchid|palegoldenrod|palegreen|paleturquoise|palevioletred|papayawhip|peachpuff|peru|pink|plum|powderblue|purple|red|rosybrown|royalblue|saddlebrown|salmon|sandybrown|seagreen|seashell|sienna|silver|skyblue|slateblue|slategray|snow|springgreen|steelblue|tan|teal|thistle|tomato|turquoise|violet|wheat|white|whitesmoke|yellow|yellowgreen)$/,
k=/^#?[a-fA-F0-9]{6}$/,l=/^rgb?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/,m=/[^\s@]+@[^\s@]+\.[^\s@]+/,n,q=[],r,p,t,v;var u={b:{openTag:function(a,b){return"<b>"},closeTag:function(a,b){return"</b>"}},i:{openTag:function(a,b){return"<i>"},closeTag:function(a,b){return"</i>"}},u:{openTag:function(a,b){return"<u>"},closeTag:function(a,b){return"</u>"}},s:{openTag:function(a,b){return"<s>"},closeTag:function(a,b){return"</s>"}},sub:{openTag:function(a,b){return"<sub>"},closeTag:function(a,b){return"</sub>"}},
sup:{openTag:function(a,b){return"<sup>"},closeTag:function(a,b){return"</sup>"}},h2:{openTag:function(a,b){return"<h2>"},closeTag:function(a,b){return"</h2>"}},h3:{openTag:function(a,b){return"<h3>"},closeTag:function(a,b){return"</h3>"}},code:{openTag:function(a,b){return"<pre>"},closeTag:function(a,b){return"</pre>"},noParse:!0},table:{openTag:function(a,b){return'<table class="R_table">'},closeTag:function(a,b){return"</table>"}},tbody:{openTag:function(a,b){return"<tbody>"},closeTag:function(a,
b){return"</tbody>"}},tfoot:{openTag:function(a,b){return"<tfoot>"},closeTag:function(a,b){return"</tfoot>"}},thead:{openTag:function(a,b){return"<thead>"},closeTag:function(a,b){return"</thead>"}},td:{openTag:function(a,b){return'<td class="R_td">'},closeTag:function(a,b){return"</td>"}},th:{openTag:function(a,b){return"<th>"},closeTag:function(a,b){return"</th>"}},tr:{openTag:function(a,b){return"<tr>"},closeTag:function(a,b){return"</tr>"}},ol:{openTag:function(b,c){return b?'<ol class="R_ol" style="list-style-type:'+
a(b)+'">':'<ol class="R_ol">'},closeTag:function(a,b){return"</ol>"}},ul:{openTag:function(b,c){return b?'<ul class="R_ul" style="list-style-type:'+a(b)+'">':'<ul class="R_ul">'},closeTag:function(a,b){return"</ul>"}},list:{openTag:function(b,c){return b?'<ul class="R_ul" style="list-style-type:'+a(b)+'">':'<ul class="R_ul">'},closeTag:function(a,b){return"</ul>"}},li:{openTag:function(a,b){return'<li class="R_li">'},closeTag:function(a,b){return"</li>"}},color:{openTag:function(a,b){a=(a||"").toLowerCase()||
"black";g.lastIndex=0;k.lastIndex=0;g.test(a)||l.test(a)||(k.test(a)?"#"!==a.substr(0,1)&&(a="#"+a):a="black");return'<span style="color:'+a+'">'},closeTag:function(a,b){return"</span>"}},bgcolor:{openTag:function(a,b){a=(a||"").toLowerCase()||"black";g.lastIndex=0;k.lastIndex=0;g.test(a)||l.test(a)||(k.test(a)?"#"!==a.substr(0,1)&&(a="#"+a):a="black");return'<span style="background-color:'+a+'">'},closeTag:function(a,b){return"</span>"}},font:{openTag:function(b,c){b||(b="'Open Sans','Noto Sans CJK TC','Noto Sans CJK SC','Noto Sans CJK JP','Noto Sans CJK KR','Lucida Grande',Tahoma,arial,sans-serif;");
return'<span style="font-family:'+a(b)+'">'},closeTag:function(a,b){return"</span>"}},size:{openTag:function(a,b){a=parseInt(a);isNaN(a)&&(a=14);return'<span style="font-size:'+a+'px;">'},closeTag:function(a,b){return"</span>"}},indent:{openTag:function(b,c){return b?'<p style="margin-left:'+a(b)+';">':'<p style="margin-left:25px;">'},closeTag:function(a,b){return"</p>"}},center:{openTag:function(a,b){return'<div style="text-align:center;">'},closeTag:function(a,b){return"</div>"}},left:{openTag:function(a,
b){return'<div style="text-align:left;">'},closeTag:function(a,b){return"</div>"}},right:{openTag:function(a,b){return'<div style="text-align:right;">'},closeTag:function(a,b){return"</div>"}},justify:{openTag:function(a,b){return'<div style="text-align:justify;">'},closeTag:function(a,b){return"</div>"}},start:{openTag:function(a,b){return'<div style="text-align:start;">'},closeTag:function(a,b){return"</div>"}},end:{openTag:function(a,b){return'<div style="text-align:end;">'},closeTag:function(a,
b){return"</div>"}},img:{openTag:function(b,c){c=c.replace(/[\u0080-\u9fff]+/gm,encodeURIComponent);f.lastIndex=0;c.startsWith("http://")||c.startsWith("https://")||c.startsWith("data:image")||(c="https://"+c);if(!f.test(c)&&!c.startsWith("data:image"))return'<img alt="image">';if(b&&b.toLowerCase().includes("x")){var d=b.toLowerCase().split("x");if(1<d.length&&(b=getPrecisedFloat(d[0]),d=getPrecisedFloat(d[1]),b&&d))return'<img style="width:'+b+"px;height:"+d+'px;" src="'+a(c)+'"'+(mode===BUILDER?
' class="bbcodeImage" onload="nui._updateFocus(null, null, null, null, true)"':"")+" >"}return'<img src="'+a(c)+'"'+(mode===BUILDER?' class="bbcodeImage" onload="nui._updateFocus(null, null, null, null, true)"':"")+" >"},closeTag:function(a,b){return""},displayContent:!1},url:{openTag:function(b,c){b=b.replace(/[\u0080-\u9fff]+/gm,encodeURIComponent);f.lastIndex=0;b.startsWith("http://")||b.startsWith("https://")||b.startsWith("mailto:")||(b="https://"+b);return f.test(b)?'<a href="'+a(b)+'" target="_blank" rel="noopener noreferrer nofollow" onmousedown="event.preventDefault();event.stopPropagation();">':
"<a>"},closeTag:function(a,b){return"</a>"}},addr:{openTag:function(a,b){return'<iframe src="/sims/gmap.jsp?addr='+encodeURIComponent(b)+'" style="border:none;width:510px;height:310px;">'},closeTag:function(a,b){return"</iframe>"},displayContent:!1},embed:{openTag:function(b,c){c=c.replace(/[\u0080-\u9fff]+/gm,encodeURIComponent);f.lastIndex=0;c.startsWith("http://")||c.startsWith("https://")||(c="https://"+c);if(!f.test(c))return"<embed>";if(b&&b.toLowerCase().includes("x")){var d=b.toLowerCase().split("x");
if(1<d.length&&(b=parseInt(d[0]),d=parseInt(d[1]),b&&d))return'<embed width="'+b+'" height="\'+_height+\'" wmode=transparent src="'+a(c)+'">'}return'<embed width=600 height=500 wmode=transparent src="'+a(c)+'">'},closeTag:function(a,b){return""},displayContent:!1},email:{openTag:function(b,c){b=b?b:c;m.lastIndex=0;return m.test(b)?'<a href="mailto:'+a(b)+'" onmousedown="event.preventDefault();event.stopPropagation();">':"<a>"},closeTag:function(a,b){return"</a>"}},quote:{openTag:function(a){return'<blockquote class="R_quote">'},
closeTag:function(a){return"</blockquote>"}},br:{openTag:function(a){return""},closeTag:function(a){return"<br>"}},fa:{openTag:function(b,c){var d="fa";switch(b){case "fas":case "far":case "fal":case "fab":d=b}return'<i class="'+d+" "+a(c)+'" aria-hidden="true">'},closeTag:function(a,b){return"</i>"},displayContent:!1},"*":{openTag:function(a,b){return"<li>"},closeTag:function(a,b){return"</li>"}}};(function(){n=[];Object.keys(u).forEach(function(a){"*"===a?n.push("\\"+a):(n.push(a),u[a].noParse&&
q.push(a))});r=new RegExp("<bbcl=([0-9]+) ("+n.join("|")+")([ =][^>]*?)?>((?:.|[\\r\\n])*?)<bbcl=\\1 /\\2>","gi");p=new RegExp("\\[("+n.join("|")+")([ =][^\\]]*?)?\\]([^]*?)\\[/\\1\\]","gi");t=new RegExp("\\[("+q.join("|")+")([ =][^\\]]*?)?\\]([\\s\\S]*?)\\[/\\1\\]","gi");v=/^\[(img)([ =][^\]]*?)?\]([^\[]*?)\[\/\1\]$/i;(function(){for(var a=[],b=0;b<n.length;b++)"\\*"!==n[b]&&a.push("/"+n[b]);n.join("|");a.join("|")})()})();var x=function(a,b,c,d,e){c=c.toLowerCase();d=d?d.trim().substring(1):"";
a=u[c];e=a.noParse?e.replace(/<bbcl=[0-9]+ \/\*>/gi,"").replace(/<bbcl=[0-9]+ /gi,"&#91;").replace(/>/gi,"&#93;"):e.replace(r,x);b=a.openTag(d,e);d=a.closeTag(d,e);!1===a.displayContent&&(e="");return b+e+d};e.processToHTML=function(a){for(;a!==(a=a.replace(t,function(a,b,c,d){d=d.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;");return"["+b+(c||"")+"]"+(d||"")+"[/"+b+"]"})););a=c(a);a=d(a);return a.replace(r,x)};e.processToBBCode=function(a){if(a.nodeType===Node.TEXT_NODE)return a.nodeValue.replace(/(\r\n|\n|\r)/gm,
" ");if(a.nodeType===Node.ELEMENT_NODE){var b=a.tagName.toLowerCase(),c=a.childNodes,d="",f="",g="";if("*"===b)return a.outerHTML;if("pre"===b)return"[code]"+a.innerHTML+"[/code]";if(u.hasOwnProperty(b)){if("ol"===b||"ul"===b)d=a.style.listStyleType,d="["+b+(d?"="+d:"")+"]";else{if("embed"===b)return"["+b+"]"+a.src+"[/"+b+"]";if("img"===b){d="";var k=a.style;k&&k.width&&k.height&&(d="="+parseInt(k.width)+"x"+parseInt(k.height));return"["+b+d+"]"+a.src+"[/"+b+"]"}if("i"===b&&(a.classList.contains("fa")||
a.classList.contains("fas")||a.classList.contains("far")||a.classList.contains("fal")||a.classList.contains("fab"))){f=a.classList.contains("fas")?"fas":a.classList.contains("far")?"far":a.classList.contains("fab")?"fab":a.classList.contains("fal")?"fal":"fas";c=0;for(g=a.classList.length;c<g;c++)if(d=a.classList.item(c),"fa"!==d&&d.startsWith("fa-"))return"[fa="+f+"]"+d+"[/fa]";return""}d="["+b+"]"}f="[/"+b+"]"}else if("p"===b){if(k=a.style)a=k.marginLeft||k.paddingLeft||k.textIndent,"0px"!==a&&
(d="[indent="+a+"]",f="[/indent]")}else if("h1"===b)d="[b][size=22]",f="[/size][/b]";else if("h2"===b)d="[h2]",f="[/h2]";else if("h3"===b)d="[h3]",f="[/h3]";else if("div"===b)(k=a.style)&&""!==k.textAlign&&(d="["+k.textAlign+"]"+d,f=f+"[/"+k.textAlign+"]");else if("span"===b)k=a.style,""!==k.fontFamily&&(d="[font="+k.fontFamily+"]"+d,f+="[/font]"),""!==k.fontSize&&(d="[size="+k.fontSize+"]"+d,f+="[/size]"),""!==k.color&&(d="[color="+k.color+"]"+d,f+="[/color]"),""!==k.backgroundColor&&(d="[bgcolor="+
k.backgroundColor+"]"+d,f+="[/bgcolor]");else if("a"===b)a=a.href,a.startsWith("mailto")?(d="[email="+a.substring(7)+"]",f="[/email]"):a.toLowerCase().startsWith("javascript")||(d="[url="+a+"]",f="[/url]");else if("iframe"===b){if(a=a.src,a.includes("/sims/gmap.jsp?addr="))return"[addr]"+decodeURIComponent(a.substring(a.indexOf("addr=")+5))+"[/addr]"}else"blockquote"===b&&(d="[quote]",f="[/quote]");a=0;for(b=c.length;a<b;a++)g+=e.processToBBCode(c[a]);return d+g+f}};e.getImgTagPattern=function(){return v};
return e}(),MultiSelectComboAgent=function(){function a(a,b,c,d,e,f){this.id=a;this.options=b||[];this.attachedContainer=c;this.form_element_name=d||"";this.spread=e||!1;this.renderWithFormElement=!1;this.afterRender=this.afterChangeItem=this.afterRemoveItem=this.beforeRemoveItem=this.afterSelectItem=this.beforeSelectItem=this.onToggleDropdown=null;this.filterValue="";this.filterInputInDropDown=!0;this.customOption=f||{}}function b(a){var b=document.createElement("DIV"),c=a.options.filter(function(a){return a.hidden?
!1:a.selected});if(c.length)for(var d=0,f=c.length;d<f;d++){var k=document.createElement("DIV"),m=c[d];m.fixedValue?k.classList.add("multiComboFixedValue"):k.classList.add("multiComboValue");k.textContent=m.text;q?k.dataset.value=m.value:k.setAttribute("data-value",m.value);b.appendChild(k);m.fixedValue?k.addEventListener("click",function(a){l(a)}):k.addEventListener("click",g);m.onclick&&k.addEventListener("click",e.bind(k,m.onclick,[]))}else b.appendChild(document.createTextNode("\u00a0"));q?b.dataset.actid=
a.id:b.setAttribute("data-actid",a.id);b.classList.add("multiComboSelectedDiv");return b}function c(a){var b=a.element_dropdown;Array.from(b.querySelectorAll("LI")).filter(function(a){return!a.classList.contains("multiComboFilterContainer")}).forEach(function(a){b.removeChild(a)});d(a,b,!1)}function d(a,b,c){for(var d=0,f=a.options.length;d<f;d++){var k=a.options[d],l=document.createElement("LI");if(!k.hidden&&(!a.filterValue||k.text.toUpperCase().includes(a.filterValue.toUpperCase()))){q?l.dataset.value=
k.value:l.setAttribute("data-value",k.value);l.textContent=k.text;if(k.icon){var m=document.createElement("I");m.classList.add("fa",k.icon);m["aria-hidden"]=!0;l.insertBefore(m,l.firstChild)}k.id&&(l.id=k.id);k.selected&&(l.classList.add("multiComboSelected"),k.fixedValue&&l.classList.add("multiComboFixedSelected"));if(0===d&&c&&a.filterInputInDropDown){m=document.createElement("LI");var n=document.createElement("INPUT"),p=document.createElement("I");m.classList.add("multiComboFilterContainer");p.classList.add("fas",
"fa-search","multiComboFilterIcon");n.classList.add("multiComboFilterInput");n.title=lm.accessibility_filterByKeyword;m.appendChild(n);m.appendChild(p);b.appendChild(m);n.onfocus=function(){outNUI()};n.onblur=function(){inNUI()};n.onkeyup=debouncedFn(100,function(){a.filterValue=this.value;a.processFilter()})}b.appendChild(l);k.fixedValue||l.addEventListener("click",g);k.onclick&&l.addEventListener("click",e.bind(l,k.onclick,[]))}}}function e(a,b){if(q){var c=this.parentNode.dataset.actid;var d=this.dataset.value}else c=
this.parentNode.getAttribute("data-actid"),d=this.getAttribute("data-value");c=m.selectCombo[c];var e=c.options.find(function(a){return a.value+""===d});Array.isArray(b)||(b=[]);e&&a&&a.apply(null,[c,e].concat($jscomp.arrayFromIterable(b)))}function f(a){var b=document.createElement("UL");a.options.length?d(a,b,!0):(a=document.createElement("LI"),a.appendChild(document.createTextNode(n)),a.addEventListener("click",k),q?a.dataset.nooption="true":a.setAttribute("data-nooption","true"),b.appendChild(a));
return b}function g(a){l(a);q?m.clickOnOption(this.parentNode.dataset.actid,this.dataset.value):m.clickOnOption(this.parentNode.getAttribute("data-actid"),this.getAttribute("data-value"))}function k(a){l(a);q?m.getMultiSelectCombo(this.parentNode.dataset.actid).toggle():m.getMultiSelectCombo(this.parentNode.getAttribute("data-actid")).toggle()}function l(a){a.preventDefault();a.stopPropagation()}var m={selectCombo:{}},n="No options",q=!!document.createElement("DIV").dataset,r="",p=0;m.createMultiSelectCombo=
function(b,c,d,e,f,g){b||(b="multiCombo"+p++);c=new a(b,c,d,e,f,g);return this.selectCombo[b]=c};m.getMultiSelectCombo=function(a){return this.selectCombo[a]};m.removeMultiSelectCombo=function(a){var b=this.selectCombo[a];b&&(b.dispose(),this.selectCombo[a]=null,r===a&&(r=""))};m.clickOnOption=function(a,b){var c=this.selectCombo[a];if(c){c.filterValue&&(c.filterValue="",c.processFilter());var d=c.options.find(function(a){return a.value+""===b});if(d){var e=!d.selected;e&&c.beforeSelectItem?c.beforeSelectItem(d):
!e&&c.beforeRemoveItem&&c.beforeRemoveItem(d);var f=c.element_dropdown.scrollTop;d.selected=!d.selected;e&&c.afterSelectItem?c.afterSelectItem(d):!e&&c.afterRemoveItem&&c.afterRemoveItem(d);c.afterChangeItem&&c.afterChangeItem(d);document.body.contains(c.attachedContainer)?c.render():c=this.selectCombo[a];f&&c&&(c.element_dropdown.scrollTop=f)}}};m.setTextNoOption=function(a){n=a};document.addEventListener("click",function(){r&&m.getMultiSelectCombo(r).toggle()});a.prototype.setOnToggleDropdown=function(a){this.onToggleDropdown=
a};a.prototype.setBeforeSelectItem=function(a){this.beforeSelectItem=a};a.prototype.setAfterSelectItem=function(a){this.afterSelectItem=a};a.prototype.setBeforeRemoveItem=function(a){this.beforeRemoveItem=a};a.prototype.setAfterRemoveItem=function(a){this.afterRemoveItem=a};a.prototype.setAfterChangeItem=function(a){this.afterChangeItem=a};a.prototype.setRenderWithFormElement=function(a){this.renderWithFormElement=a};a.prototype.getValues=function(){return this.options.filter(function(a){return a.selected}).map(function(a){return a.value})};
a.prototype.render=function(){this.element=document.createElement("DIV");this.element.id=this.id;this.element.classList.add("multiComboBox");if(this.customOption.hasOwnProperty("customComboBoxStyles"))for(var a in this.customOption.customComboBoxStyles)this.element.style[a]=this.customOption.customComboBoxStyles[a];this.customOption.hasOwnProperty("customComboBoxClasses")&&this.customOption.customComboBoxClasses.forEach(function(a){this.element.classList.add(a)}.bind(this));this.element.addEventListener("click",
l);a=b(this);var c=f(this);q?c.dataset.actid=this.id:c.setAttribute("data-actid",this.id);this.element_dropdown=c;this.element.appendChild(a);this.element.appendChild(c);a.addEventListener("click",this.toggle.bind(this));this.renderWithFormElement&&this.generateFormElement();(c=this.attachedContainer.querySelector("#"+this.id))?this.attachedContainer.replaceChild(this.element,c):this.attachedContainer.appendChild(this.element);if(!this.filterInputInDropDown){var d=this;c=document.createElement("INPUT");
c.classList.add("multiComboFilterInputNotInDropMenu");c.title=lm.accessibility_multiSelect;c.onclick=function(a){l(a)};c.onfocus=function(){outNUI()};c.onblur=function(){inNUI()};c.onkeyup=debouncedFn(100,function(){d.filterValue=this.value;d.processFilter();d.spread||d.toggle()});a.append(c)}this.spread&&(this.measureDropDownPosition(),this.element.classList.add("multiCombo_drop_show"));this.afterRender&&this.afterRender()};a.prototype.toggle=function(){(this.spread=!this.spread)?(r&&r!==this.id&&
m.getMultiSelectCombo(r).spread&&m.getMultiSelectCombo(r).toggle(),r=this.id,this.measureDropDownPosition()):r===this.id&&(r="");this.element.classList.toggle("multiCombo_drop_show");if(this.onToggleDropdown)this.onToggleDropdown(this.spread,this.element_dropdown)};a.prototype.measureDropDownPosition=function(){for(var a=!1,b=this.attachedContainer,c=7;b&&c--&&b!==document.body;){a=window.getComputedStyle(b).overflowY;if(a="visible"!==a&&"hidden"!==a)break;b=b.parentNode}c=this.attachedContainer.getBoundingClientRect();
a?(a=b.getBoundingClientRect(),b=a.bottom-c.bottom,175<b||50>c.top-a.top?this.element_dropdown.style.maxHeight=b-5+"px":(this.element_dropdown.style.bottom=c.height+"px",this.element_dropdown.style.maxHeight=c.top-a.top-5+"px")):(b=window.innerHeight-c.bottom,175<b?this.element_dropdown.style.maxHeight=b+"px":(a=this.customOption.referContainer)?(a=document.getElementById(a).getBoundingClientRect(),this.element_dropdown.style.bottom=c.height+"px",this.element_dropdown.style.maxHeight=a.height-c.height-
b+"px"):(this.element_dropdown.style.bottom=c.height+"px",this.element_dropdown.style.maxHeight=c.top-5+"px"));this.element_dropdown.style.minWidth=this.element.offsetWidth+"px";if(this.customOption.hasOwnProperty("customDropBoxStyles"))for(var d in this.customOption.customDropBoxStyles)this.element_dropdown.style[d]=this.customOption.customDropBoxStyles[d]};a.prototype.generateFormElement=function(){var a=document.createElement("DIV"),b=this.getValues();a.classList.add("multiComboFormElementDiv");
var c=this.element.querySelector(".multiComboFormElementDiv");if(b.length){for(var d=0,e=b.length;d<e;d++){var f=document.createElement("INPUT");f.type="checkbox";f.setAttribute("aria-hidden","true");f.setAttribute("aria-label","do not use");f.setAttribute("aria-readonly","true");f.name=this.form_element_name;f.checked=!0;f.value=b[d];a.appendChild(f)}c?this.element.replaceChild(a,c):this.element.appendChild(a)}else c&&this.element.removeChild(c)};a.prototype.processFilter=function(){c(this)};a.prototype.dispose=
function(){this.attachedContainer=this.options=null;this.element&&(this.element.parentNode.removeChild(this.element),this.element_dropdown=this.element=null);this.customOption=this.afterChangeItem=this.afterRemoveItem=this.beforeRemoveItem=this.afterSelectItem=this.beforeSelectItem=this.onToggleDropdown=null};return m}();MultiSelectComboAgent.setTextNoOption(lm.noOptionHint);
function enableMultiSelectCombo(a,b,c){if(a&&a.options){for(var d=[],e,f,g=0;g<a.options.length;g++)e=a.options[g],f={value:e.value,text:e.textContent,selected:e.selected},e.id&&(f.id=e.id),c&&c.fixedValues&&-1!=c.fixedValues.indexOf(f.value)&&(f.selected=!0,f.fixedValue=!0),e.dataset.icon&&(f.icon=e.dataset.icon),e.onclick&&(f.onclick=e.onclick),""===f.text&&""===f.value||d.push(f);"DIV"!==a.parentNode.tagName&&(e=document.createElement("div"),a.parentNode.replaceChild(e,a),e.appendChild(a));a=MultiSelectComboAgent.createMultiSelectCombo(a.id,
d,a.parentNode,a.name||"",null,c);a.setRenderWithFormElement(!b);a.render();a.setOnToggleDropdown(function(a){!a||c&&c.keepDropWinOnToggleDropdown||clearDropWin()});return a}}
var EUSelector=function(){var a={win:$("floatingEntryUpdater"),close:function(){a.win.style.display="none"},showUrl:function(b,c){a.win.style.display="";read(function(a){$("floatingEntryUpdaterContent").innerHTML=a.responseText;c&&c()},b)},showText:function(b){a.win.style.display="";$("floatingEntryUpdaterContent").innerHTML=b}};return a}();
(function(a,b,c){function d(a,c,d){a=b.createElementNS("http://www.w3.org/2000/svg",a);for(var e in c)a.setAttribute(e,c[e]);"[object Array]"!=Object.prototype.toString.call(d)&&(d=[d]);c=0;for(e=d[0]&&d.length||0;c<e;c++)a.appendChild(d[c]);return a}function e(a){var b,c=a.h%360/60;var d=a.v*a.s;var e=d*(1-Math.abs(c%2-1));var f=b=a=a.v-d;c=~~c;f+=[d,e,0,0,e,d][c];b+=[e,d,d,e,0,0][c];a+=[0,0,e,d,d,e][c];e=Math.floor(255*f);b=Math.floor(255*b);a=Math.floor(255*a);return{r:e,g:b,b:a,hex:"#"+(16777216|
a|b<<8|e<<16).toString(16).slice(1)}}function f(a){var b=a.r,c=a.g,d=a.b;if(1<a.r||1<a.g||1<a.b)b/=255,c/=255,d/=255;a=Math.max(b,c,d);var e=a-Math.min(b,c,d);return{h:(0==e?0:a==b?(c-d)/e+(c<d?6:0):a==c?(d-b)/e+2:(b-c)/e+4)%6*60,s:0==e?0:e/a,v:a}}function g(b,d,f){return function(g){g=g||a.event;g={x:g.offsetX,y:g.offsetY};b.h=g.y/d.offsetHeight*360+15;var k=e({h:b.h,s:1,v:1}),l=e({h:b.h,s:b.s,v:b.v});f.style.backgroundColor=k.hex;b.callback&&b.callback(l.hex,{h:b.h-15,s:b.s,v:b.v},{r:l.r,g:l.g,
b:l.b},c,g)}}function k(b,c){return function(d){d=d||a.event;d={x:d.offsetX,y:d.offsetY};var f=c.offsetHeight;b.s=d.x/c.offsetWidth;b.v=(f-d.y)/f;f=e(b);b.callback&&b.callback(f.hex,{h:b.h-15,s:b.s,v:b.v},{r:f.r,g:f.g,b:f.b},d)}}function l(a,b,c,d,e,f){this.pickerElement=b;this.slideElement=a;this.inputElement=c;this.paletteContainer=d;if(this.inputElement){var l;this.inputElement.addEventListener("input",function(){l&&clearTimeout(l);l=setTimeout(function(){r.test(this.inputElement.value)?this.setHex(this.inputElement.value):
this.inputElement.value.length||this.noColorCallback&&this.noColorCallback();l=null}.bind(this),550)}.bind(this))}n.bind(this)();e&&f&&(this.slideIndicator=e,this.pickerIndicator=f,this.fixIndicators());this.h=0;this.v=this.s=1;a=p.cloneNode(!0);b=t.cloneNode(!0);c=a.querySelector("linearGradient");d=a.querySelector("rect");e=b.querySelectorAll("linearGradient");e=[e[0],e[1]];f=b.querySelectorAll("rect");c.id="gradient-hsv-"+v;d.setAttribute("fill","url(#"+c.id+")");e[0].id="gradient-black-"+v;e[1].id=
"gradient-white-"+v;f[0].setAttribute("fill","url(#"+e[1].id+")");f[1].setAttribute("fill","url(#"+e[0].id+")");this.slideElement.appendChild(a);this.pickerElement.appendChild(b);v++;this.slideElement.addEventListener("click",g(this,this.slideElement,this.pickerElement));this.pickerElement.addEventListener("click",k(this,this.pickerElement))}function m(a,b,c,d){a.h=b.h%360;a.s=b.s;a.v=b.v;b=e(a);var f={y:a.h*a.slideElement.offsetHeight/360,x:0},g=a.pickerElement.offsetHeight;g={x:a.s*a.pickerElement.offsetWidth,
y:g-a.v*g};a.pickerElement.style.backgroundColor=e({h:a.h,s:1,v:1}).hex;a.callback&&a.callback(d||b.hex,{h:a.h,s:a.s,v:a.v},c||{r:b.r,g:b.g,b:b.b},g,f);return a}function n(){var a=this.paletteContainer,d=b.createElement("TABLE"),e,f;if(a){var g=Array(10);g[0]="FFFFFF CCCCCC C0C0C0 999999 666666 333333 000000".split(" ");g[1]="FFCCCC FF6666 FF0000 CC0000 990000 660000 330000".split(" ");g[2]="FFCC99 FF9966 FF9900 FF6600 CC6600 993300 663300".split(" ");g[3]="FFFF99 FFFF66 FFCC66 FFCC33 CC9933 996633 663333".split(" ");
g[4]="FFFFCC FFFF33 FFFF00 FFCC00 999900 666600 333300".split(" ");g[5]="99FF99 66FF99 33FF33 33CC00 009900 006600 003300".split(" ");g[6]="99FFFF 33FFFF 66CCCC 00CCCC 339999 336666 003333".split(" ");g[7]="CCFFFF 66FFFF 33CCFF 3366FF 3333FF 000099 000066".split(" ");g[8]="CCCCFF 9999FF 6666CC 6633FF 6600CC 333399 330099".split(" ");g[9]="FFCCFF FF99FF CC66CC CC33CC 993399 663366 330033".split(" ");for(e=0;7>e;e++){var k=d.insertRow(-1);for(f=0;10>f;f++){var l=k.insertCell(-1),m=b.createElement("SPAN");
q?m.dataset.hex="#"+g[f][e]:m.setAttribute("data-hex",g[f][e]);m.style.backgroundColor="#"+g[f][e];l.appendChild(m)}}this.paletteContainer.addEventListener("click",function(a){a=a.target;var b;q?b=a.dataset.hex:a.hasAttribute("data-hex")&&(b=a.getAttribute("data-hex"));b!==c&&this.setHex(b)}.bind(this));e=d.insertRow(-1).insertCell(-1);f=b.createElement("I");e.classList.add("ragic_no_color");f.classList.add("fa","fa-times");e.colSpan=10;e.appendChild(f);a.appendChild(d)}}var q=!!b.createElement("DIV").dataset,
r=/^#(?:[A-Fa-f0-9]{3}){1,2}$/;var p=d("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[d("defs",{},d("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[d("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),d("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),d("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),d("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),d("stop",{offset:"50%","stop-color":"#00FFFF",
"stop-opacity":"1"}),d("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),d("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),d("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),d("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),d("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})]);var t=d("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[d("defs",{},[d("linearGradient",{id:"gradient-black",
x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[d("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),d("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),d("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[d("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),d("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),d("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"}),d("rect",{x:"0",y:"0",width:"100%",
height:"100%",fill:"url(#gradient-black)"})]);var v=0;l.prototype.setHsv=function(a){return m(this,a)};l.prototype.setRgb=function(a){return m(this,f(a),a)};l.prototype.setHex=function(a){a.startsWith("#")&&4===a.length&&(a=a.replace(/([^#])/gi,"$1$1"));var b=a;b={r:parseInt(b.substr(1,2),16),g:parseInt(b.substr(3,2),16),b:parseInt(b.substr(5,2),16)};return m(this,f(b),c,a)};l.prototype.setOriginHex=function(a){this.originHex=a};l.prototype.resetToOriginHex=function(){this.originHex?this.setHex(this.originHex):
this.noColorCallback&&this.noColorCallback()};l.prototype.setCallback=function(a){this.callback=function(b,c,d,e,f){this.slideIndicator&&this.pickerIndicator&&this.positionIndicators(f,e);this.inputElement&&(this.inputElement.value=b);a&&a(b,c,d)}};l.prototype.setNoColorCallback=function(a){if(this.paletteContainer){var b=this.paletteContainer.querySelector(".ragic_no_color");b&&((this.noColorCallback=a)?(b.onclick=this.noColorCallback,b.style.display="table-cell"):(b.onclick=null,b.style.display=
""))}};l.prototype.reset=function(){this.inputElement&&(this.inputElement.value="");this.pickerIndicator&&(this.pickerIndicator.style.top="",this.pickerIndicator.style.left="")};l.prototype.positionIndicators=function(a,b){a&&(this.slideIndicator.style.top=a.y-this.slideIndicator.offsetHeight/2+"px");b&&(this.pickerIndicator.style.top=b.y-this.pickerIndicator.offsetHeight/2+"px",this.pickerIndicator.style.left=b.x-this.pickerIndicator.offsetWidth/2+"px")};l.prototype.fixIndicators=function(){this.pickerIndicator.style.pointerEvents=
"none";this.slideIndicator.style.pointerEvents="none"};a.ColorPicker=l})(window,window.document);var DesignHelperColorPicker,DHelpType,FormRuleColorPicker,MultiRangeSliderColorPicker;
document.addEventListener("DOMContentLoaded",function(){var a=document.querySelector("#bColorPicker"),b=document.querySelector("#FormRuleColorPicker"),c=document.querySelector("#multiRangeSliderColorPicker"),d=function(){outNUI();this.focused=!0},e=function(){inNUI();this.focused=!1},f=function(a,b){a.style.display="none";removeFloatingColorPicker(a,b)},g=function(a){var b=a.querySelector(".color_input"),c=new ColorPicker(a.querySelector(".slide"),a.querySelector(".picker"),b,a.querySelector(".ragic_color_palette"),
a.querySelector(".slide-indicator"),a.querySelector(".picker-indicator"));a.addEventListener("click",function(){ctrl.dropWin=!0});a.addEventListener("focus",d);a.addEventListener("blur",e);b.addEventListener("focus",d);b.addEventListener("blur",e);a.querySelector(".ragic_color_footer-ok").addEventListener("click",f.bind(null,a,!1));a.querySelector(".fa-times").addEventListener("click",f.bind(null,a,!0));a.querySelector(".ragic_color_footer-cancel").addEventListener("click",f.bind(null,a,!0));ctrl.isSafari&&
a.classList.add("safari-picker");return a.colorPicker=c};a&&(DesignHelperColorPicker=g(a),DesignHelperColorPicker.setNoColorCallback(function(){builder.setStyle(nui.fcol,nui.frow,DHelpType,"");DesignHelperColorPicker.reset()}));b&&(FormRuleColorPicker=g(b));c&&(MultiRangeSliderColorPicker=g(c))});
function EmailTemplateInputBuilder(a){var b=this;this.defaultTemplate="";if(!a.inputTemplate)throw Error("Init EmailTemplateInputBuilder failed: config.inputTemplate not found");this.inputTemplate=a.inputTemplate;a.autoFillFunc&&(this.autoFillFunc=a.autoFillFunc);a.findSelectOptionFieldsFunc&&(this.findSelectOptionFieldsFunc=a.findSelectOptionFieldsFunc);var c=node("label");c.style.margin="8px";c.classList.add("emailTemplateLabel");c.appendChild(document.createTextNode(a.label?a.label+": ":" "));
if(a.help){var d=node("a");d.classList.add("tooltipQ");d.style.float="none";d.onclick=function(){showSingleTooltip(this,a.help,!1,!0,!1,!0)};var e=node("i");e.classList.add("fas");e.classList.add("fa-question");d.appendChild(e);c.appendChild(d)}d=node("div");d.style.display="table-cell";d.style.verticalAlign="middle";d.appendChild(c);e=function(){var a=node("input");a.type="text";a.style.backgroundColor="rgb(255, 239, 239)";a.classList.add("emailTempalteInlineInput");a.style.display="none";a.setCustTemplate=
function(a){if(a||""==a)this.value=a};a.getCustTemplate=function(){return this.value.replace(/\+/g,"%2B")};a.hide=function(){this.style.display="none"};a.display=function(){this.style.display=""};a.onkeyup=function(){b.isTemplateModified()&&(b.restoreButton.style.visibility="")};a.onfocus=function(){outNUI()};return a};var f=function(){var a=node("input");a.type="text";a.setAttribute("readOnly","");a.classList.add("emailTempalteInlineInput");a.setDisplayValue=function(a){this.value=a};a.getDisplayValue=
function(){return this.value};a.hide=function(){this.style.display="none"};a.display=function(){this.style.display=""};a.onfocus=function(){b.editMode();b.inputItem.focus()};return a},g=function(){var a=node("textArea");a.style.width="500px";a.style.height="160px";a.style.backgroundColor="rgb(255, 239, 239)";a.classList.add("emailTempalteBlockInput");a.style.display="none";a.setCustTemplate=function(a){if(a||""==a)this.value=a=a.replace(/<br>/g,"<br/>")};a.getCustTemplate=function(){return this.value.replace(/\n/g,
"").replace(/\+/g,"%2B")};a.hide=function(){this.style.display="none"};a.display=function(){this.style.display=""};a.onkeyup=function(){b.isTemplateModified()&&(b.restoreButton.style.visibility="")};a.onfocus=function(){outNUI()};return a},k=function(){var a=node("div");a.classList.add("emailTempalteBlockInput");a.setDisplayValue=function(a){this.innerHTML=a};a.getDisplayValue=function(){return this.value};a.hide=function(){this.style.display="none"};a.display=function(){this.style.display=""};a.onclick=
function(){b.editMode();b.inputItem.focus()};return a},l=function(){for(var a=node("select"),b="emailTemplateInputSelect_"+genRandom(5);MultiSelectComboAgent.getMultiSelectCombo(b);)b="emailTemplateInputSelect_"+genRandom(5);a.setAttribute("id",b);a.setAttribute("multiple",!0);a.setCustTemplate=function(a){};a.getCustTemplate=function(){};return a};c=a.inputType;switch(c){case this.INPUT_TYPE.FREETEXT:this.inputItem=e();this.displayItem=f();break;case this.INPUT_TYPE.HTML:this.inputItem=g();this.displayItem=
k();break;case this.INPUT_TYPE.SELECT:this.inputItem=this.inputSelect=l();this.displayItem=f();break;case this.INPUT_TYPE.FREESELECT:this.inputSelect=l();this.inputText=e();this.switchModeContainer=node("div");this.switchToTextModeButton=node("label");this.switchToTextModeButton.style.float="right";this.switchToTextModeButton.style.color="grey";this.switchToTextModeButton.style.cursor="pointer";this.switchToTextModeButton.style.display="none";this.switchToTextModeButton.appendChild(document.createTextNode(lm.sendCustomEmailButton_input_by_text));
this.switchToTextModeButton.onclick=function(){b.switchToTextMode(b.getCustTemplate())};this.switchModeContainer.appendChild(this.switchToTextModeButton);this.switchToSelectModeButton=node("label");this.switchToSelectModeButton.style.float="right";this.switchToSelectModeButton.style.color="grey";this.switchToSelectModeButton.style.cursor="pointer";this.switchToSelectModeButton.style.display="none";this.switchToSelectModeButton.appendChild(document.createTextNode(lm.sendCustomEmailButton_input_by_select));
this.switchToSelectModeButton.onclick=function(){b.switchToSelectMode(b.getCustTemplate())};this.switchModeContainer.appendChild(this.switchToSelectModeButton);this.switchModeContainer.style.display="none";this.displayItem=f();a.defaultInputType&&a.defaultInputType!=this.INPUT_TYPE.SELECT?(this.inputItem=this.inputText,this.defaultInputType=this.INPUT_TYPE.FREETEXT):(this.inputItem=this.inputSelect,this.defaultInputType=this.INPUT_TYPE.SELECT);break;default:throw Error("Incorrect input type: "+c);
}this.inputType=c;e=node("div");e.style.display="table-cell";c==this.INPUT_TYPE.FREESELECT?(e.appendChild(this.inputSelect),e.appendChild(this.inputText),e.appendChild(this.switchModeContainer)):e.appendChild(this.inputItem);e.appendChild(this.displayItem);this.previewButton=node("div");this.previewButton.classList.add("emailTemplateControlButton");this.previewButton.style.color="rgb(0, 13, 204)";this.previewButton.setAttribute("title",lm.preview);c=node("i");c.classList.add("fa");c.classList.add("fa-eye");
this.previewButton.style.display="inline-block";this.previewButton.style.visibility="hidden";this.previewButton.appendChild(c);this.restoreButton=node("div");this.restoreButton.classList.add("emailTemplateControlButton");this.restoreButton.style.color="rgb(0, 134, 255)";this.restoreButton.setAttribute("title",lm.restore);c=node("i");c.classList.add("fa");c.classList.add("fa-sync");this.restoreButton.style.display="inline-block";this.restoreButton.style.visibility="hidden";this.restoreButton.appendChild(c);
c=node("div");c.style.display="table-cell";c.style.verticalAlign="middle";c.appendChild(this.previewButton);c.appendChild(this.restoreButton);this.container=node("div");this.container.style.display="table-row";this.container.appendChild(d);this.container.appendChild(e);this.container.appendChild(c)}EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE={REPLAY_TO:"replyTo",RECIPIENTS:"recipients",CC:"CC",BCC:"BCC",SUBJECT:"subject",CONTENT:"content"};
EmailTemplateInputBuilder.prototype.INPUT_TYPE={FREETEXT:"freetext",HTML:"html",SELECT:"select",FREESELECT:"free_select"};EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS={RECORD_LINK:"RECORD_LINK",EXCEL:"EXCEL",PDF:"PDF",MAIL_MERGE:"MAIL_MERGE",FILE_FIELD:"FILE_FIELD",MAGIC_RECORD_LINK_READONLY:"MAGIC_RECORD_LINK_READONLY",MAGIC_RECORD_LINK_EDITABLE:"MAGIC_RECORD_LINK_EDITABLE"};EmailTemplateInputBuilder.prototype.render=function(a){a&&a.appendChild(this.container)};
EmailTemplateInputBuilder.prototype.editMode=function(){this.inputItem.display();this.displayItem.hide();this.previewButton.style.visibility="";this.isTemplateModified()&&(this.restoreButton.style.visibility="");this.switchModeContainer&&(this.switchModeContainer.style.display="")};EmailTemplateInputBuilder.prototype.isTemplateModified=function(){return!this.getDefaultTemplate()&&""!=this.getDefaultTemplate()||this.getCustTemplate().replace(/\n/g,"")!=this.getDefaultTemplate().replace(/\n/g,"")};
EmailTemplateInputBuilder.prototype.previewMode=function(){this.inputItem.hide();this.displayItem.display();this.previewButton.style.visibility="hidden";this.restoreButton.style.visibility="hidden";this.switchModeContainer&&(this.switchModeContainer.style.display="none")};EmailTemplateInputBuilder.prototype.setDefaultTemplate=function(a){this.defaultTemplate=a};EmailTemplateInputBuilder.prototype.getDefaultTemplate=function(){return this.defaultTemplate};
EmailTemplateInputBuilder.prototype.getCustTemplate=function(){return this.inputItem.getCustTemplate()};EmailTemplateInputBuilder.prototype.setCustTemplate=function(a){this.inputItem.setCustTemplate(a)};EmailTemplateInputBuilder.prototype.getDisplayValue=function(){return this.displayItem.getDisplayValue()};EmailTemplateInputBuilder.prototype.setDisplayValue=function(a){this.displayItem.setDisplayValue(a)};
EmailTemplateInputBuilder.prototype.createSelectCombo=function(a){var b=this;b.inputSelectCombo||(rm(b.inputSelect),a.forEach(function(a){var c=node("option");c.appendChild(document.createTextNode(a.name));c.setAttribute("value",a.value);b.inputSelect.appendChild(c)}),b.inputSelectCombo=enableMultiSelectCombo(b.inputSelect,!1,{customComboBoxClasses:["emailTempalteInlineInput"],customComboBoxStyles:{backgroundColor:"rgb(255, 239, 239)",padding:"0",cursor:"pointer"}}),b.inputSelectCombo.getCustTemplate=
function(){return this.getValues().join()},b.inputSelectCombo.setCustTemplate=function(a){if(a||""==a){var c=a.replace(/ /g,"").replace(/;/g,",").split(","),e=b.inputSelect.options;a=[];for(var f in c){var g=c[f],k;for(k in e)if(g==e[k].value){a.push(g);break}}c=this.getValues();for(f in a)for(k in c)a[f]==c[k]&&(a.splice(f,1),c.splice(k,1),f--,k--);f=c.concat(a);var l=this.id;f.forEach(function(a){MultiSelectComboAgent.clickOnOption(l,a)})}this.render()},b.inputSelectCombo.display=function(){this.element.style.display=
""},b.inputSelectCombo.hide=function(){this.element.style.display="none"},b.inputSelectCombo.focus=function(){},b.inputSelectCombo.afterChangeItem=function(){b.isTemplateModified()&&(b.restoreButton.style.visibility="")});b.inputItem=b.inputSelectCombo};
EmailTemplateInputBuilder.prototype.switchToTextMode=function(a){this.inputItem=this.inputText;this.setCustTemplate(a);this.switchToTextModeButton.style.display="none";this.switchToSelectModeButton.style.display="";this.inputText.display();this.inputSelectCombo.hide();this.inputType==EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT&&(this.defaultInputType=EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT)};
EmailTemplateInputBuilder.prototype.switchToSelectMode=function(a){this.inputItem=this.inputSelectCombo;this.setCustTemplate(a);this.switchToTextModeButton.style.display="";this.switchToSelectModeButton.style.display="none";this.inputText.hide();this.inputSelectCombo.display();this.inputType==EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT&&(this.defaultInputType=EmailTemplateInputBuilder.prototype.INPUT_TYPE.SELECT)};
function BuilderModeEmailTemplateEditor(a){var b=a.type,c=a.inputConfigs,d=a.supportedAttachTypes||[],e=a.supportAttachFile||!1;a=a.templateDesc;if(!b)throw Error("EmailTemplateEditor init failed: parameter type not defined!");var f=this;f.type=b;f.inputBuilders=[];f.inputBuilderMap={};f.supportedAttachTypes=d;f.supportAttachFile=e;a&&(f.templateDesc=a);c.forEach(function(a){a=new EmailTemplateInputBuilder(a);f.inputBuilders.push(a);f.inputBuilderMap[a.inputTemplate]=a})}
BuilderModeEmailTemplateEditor.prototype.processTemplateURL="/sims/mmailer/customTemplate/processCustomEmailTemplate.jsp";BuilderModeEmailTemplateEditor.prototype.STATUS={INIT:1,RESTORE:2,PREVIEW:3};
BuilderModeEmailTemplateEditor.prototype.open=function(a,b,c){var d=this;a||0===a?d.templateKey=a:delete d.templateKey;var e=d.initEditor(c);b||(floatWin(null,lm.prop_loading,null,!0),b=$("floatingWinContent"));if(b){rm(b);a=node("div");a.style.maxHeight="450px";b.appendChild(a);b=a;if(d.templateDesc){a=node("div");a.style.padding="0 0 15px 8px";a.style.color="rgb(0, 134, 255)";a.style.fontWeight="bold";c=node("div");c.style.display="inline-block";c.style.paddingRight="5px";c.style.verticalAlign=
"top";var f=node("i");f.classList.add("fa");f.classList.add("fa-exclamation");c.appendChild(f);a.appendChild(c);c=node("div");c.style.display="inline-block";c.style.maxWidth="600px";c.appendChild(document.createTextNode(d.templateDesc));a.appendChild(c);b.appendChild(a)}return(new Promise(function(a,b){d.inputBuilders.forEach(function(a){a.inputType!=EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT&&a.inputType!=EmailTemplateInputBuilder.prototype.INPUT_TYPE.SELECT||a.findSelectOptionFieldsFunc().then(function(b){a.createSelectCombo(b);
a.inputType==EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT&&(a.defaultInputType&&a.defaultInputType!=EmailTemplateInputBuilder.prototype.INPUT_TYPE.SELECT?a.switchToTextMode():a.switchToSelectMode())})});a(!0)})).then(function(){return d.applyCustomTemplate(e)}).then(function(a){return d.renderInputBuilders(a,b)}).then(function(a){return new Promise(function(c,e){d.renderAttachOptions(b,a).then(function(e){e?d.renderPdfConfigOptions(b,a).then(function(){c(a)}):c(a)})})}).then(function(a){d.renderFileUploader(b,
a);return Promise.resolve(a)}).then(function(a){return new Promise(function(c,e){d.renderButtons(b);c(a)})}).then(function(a){return new Promise(function(b,c){d.inputBuilders.forEach(function(a){!a.autoFillFunc||a.getCustTemplate()||a.inputType!=EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT&&a.inputType!=EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT&&a.inputType!=EmailTemplateInputBuilder.prototype.INPUT_TYPE.SELECT||a.autoFillFunc().then(function(b){return new Promise(function(c,
d){a.setCustTemplate(b);c(!0)})}).then(function(){return d.applyCustomTemplate(d.STATUS.PREVIEW,a)}).then(function(){a.previewMode();b(!0)})});b(a)})}).catch(function(a){if(!a.error)throw a;a.isNullForm&&floatWinConfirmV3(a.message,"saveBuilder();","Yes","ctrl.outOfNUI=false;$('floatingWin').style.display='none';","No")})}};
BuilderModeEmailTemplateEditor.prototype.initEditor=function(){var a=this.initStatus||this.STATUS.INIT,b={type:this.type};this.templateKey&&(b.key=this.templateKey);var c=builder.getEmailTemplatesByAttribute(b);0<c.length?(this.inputBuilders.forEach(function(a){switch(a.inputTemplate){case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.REPLAY_TO:null!=c[0].replyTo&&a.setCustTemplate(decodeURIComponent(c[0].replyTo));break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS:null!=
c[0].receiverList&&a.setCustTemplate(decodeURIComponent(c[0].receiverList));break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CC:null!=c[0].ccList&&a.setCustTemplate(decodeURIComponent(c[0].ccList));break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT:null!=c[0].subject&&a.setCustTemplate(decodeURIComponent(c[0].subject));break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT:null!=c[0].content&&a.setCustTemplate(decodeURIComponent(c[0].content))}}),this.attachSelectCombo=
{},this.attachSelectCombo.getSelectedValues=function(){var a={};a.attLink=c[0].attLink||!1;a.attExcel=c[0].attExcel||!1;a.attPdf=c[0].attPdf||!1;a.attMagicLinkReadOnly=c[0].attMagicLinkReadOnly||!1;a.attMagicLinkEditable=c[0].attMagicLinkEditable||!1;c[0].attMM&&(a.attMM=JSON.parse(decodeURIComponent(c[0].attMM)));c[0].attField&&(a.attField=JSON.parse(decodeURIComponent(c[0].attField)));return a},this.attachSelectCombo.getPdfDownloadParams=function(){var a={};c[0].pdfDownloadParams&&""!==c[0].pdfDownloadParams.trim()&&
(a.pdfDownloadParams=JSON.parse(decodeURIComponent(c[0].pdfDownloadParams)));return a},this.attachFileUploader={},this.attachFileUploader.getUploadedFiles=function(){var a=[];c[0].attFile&&(a=JSON.parse(decodeURIComponent(c[0].attFile)));return a}):(this.inputBuilders.forEach(function(a){a.setCustTemplate("")}),this.attachFileUploader=this.attachSelectCombo=null);return a};
BuilderModeEmailTemplateEditor.prototype.findEmailDataCellAsAutoFillValue=function(){return new Promise(function(a,b){b="";for(var c in builder.cellData){var d=builder.cellData[c];if(d&&d.attr&&d.domainId&&!builder.ifAdjacent(d.x,d.y)&&(d.attr.usrref||d.attr.email)){b="{{"+d.domainId+"}}";break}}a(b)})};
BuilderModeEmailTemplateEditor.prototype.findEmailDataCellsAsSelectOption=function(){return new Promise(function(a,b){b=[];for(var c in builder.cellData){var d=builder.cellData[c];d&&d.attr&&d.domainId&&(builder.ifAdjacent(d.x,d.y)||("D"==d.IPType||d.attr.usrref)&&b.push({name:d.value,value:"{{"+d.domainId+"}}"}))}a(b)})};
BuilderModeEmailTemplateEditor.prototype.renderInputBuilders=function(a,b){var c=this;return new Promise(function(d,e){c.inputBuilders.forEach(function(a){a.previewButton.onclick=function(){c.applyCustomTemplate(c.STATUS.PREVIEW,a).then(function(){a.previewMode()})};a.restoreButton.onclick=function(){c.applyCustomTemplate(c.STATUS.RESTORE,a).then(function(){a.previewMode()})};a.previewMode();a.render(b)});d(a)})};
BuilderModeEmailTemplateEditor.prototype.renderPdfConfigOptions=function(a,b){var c=this;return new Promise(function(d,e){if(0===c.supportedAttachTypes.length)d(!1);else{e=node("div");e.style.display="table-cell";e.style.backgroundColor="#e8e8e8";var f=node("div");f.style.display="table-cell";var g=node("div");g.style.display="table-row";var k=node("div");k.style.display="table-row";var l=node("div");l.style.marginTop="10px";k.appendChild(l);var m=node("div");m.style.display="table-row";var n=node("div");
n.style.marginTop="10px";m.appendChild(n);g.appendChild(f);g.appendChild(e);a.appendChild(k);a.appendChild(g);a.appendChild(m);f=pdfDownloadUIHelper().getPDFFormPageDownloadWinText(!0,!1,!1,!1,!0);var q=(new DOMParser).parseFromString(f,"text/html").body.querySelector("#dataDlSettingPanel");q?(q.style.paddingLeft="4px",f=node("table"),g=node("tr"),k=node("td"),m=node("b"),m.innerHTML=getBundleString("pdfSettings"),k.appendChild(m),g.appendChild(k),f.appendChild(g),q.prepend(f),e.appendChild(q),c.attachSelectCombo.pdfConfigDiv=
q,c.attachSelectCombo.pdfConfigDivEmptyDivTop=l,c.attachSelectCombo.pdfConfigDivEmptyDivBottom=n,pdfDownloadUIHelper().populateFileNameRefOptions().then(function(){try{q.style.display=b.attPdf?"block":"none";l.style.display=b.attPdf?"block":"none";n.style.display=b.attPdf?"block":"none";var a=b.pdfDownloadParams;if(a&&""!==a.trim()){a=JSON.parse(decodeURIComponent(a));if(a.orientation){if("portrait"===a.orientation){var c=q.querySelector("#orientation1");null!==c&&void 0!==c&&(c.checked=!0)}if("landscape"===
a.orientation){var e=q.querySelector("#orientation2");null!==e&&void 0!==e&&(e.checked=!0)}}if(a.pdfSize){var f=q.querySelector("#pdfSizeSelect");if(null!==f&&void 0!==f&&f.options&&f.options.length)for(c=0;c<f.options.length;c++)if(f.options[c].value===a.pdfSize){f.selectedIndex=c;break}}if(a.fileNameRef){var g=q.querySelector("#fileNameRefSelect");if(null!==g&&void 0!==g&&g.options&&g.options.length)for(f=0;f<g.options.length;f++)if(g.options[f].value===a.fileNameRef){g.selectedIndex=f;break}}if(null!==
a.keepContent&&void 0!==a.keepContent){var k=q.querySelector("#dlKeepContent");null!==k&&void 0!==k&&(k.checked=!0)}if(null!==a.showDefaultBorder&&void 0!==a.showDefaultBorder){var m=q.querySelector("#dlShowDefaultBorder");null!==m&&void 0!==m&&(m.checked=!0)}if(null!==a.showApprovalInfo&&void 0!==a.showApprovalInfo){var D=q.querySelector("#dlPDFWithApproval");null!==D&&void 0!==D&&(D.checked=!0)}}}catch(A){}d(!0)})):d(!1)}})};
BuilderModeEmailTemplateEditor.prototype.renderAttachOptions=function(a,b){var c=this,d=!1;if(0==c.supportedAttachTypes.length)return Promise.resolve(d);var e=node("div");e.style.display="table-cell";var f=node("div");e.appendChild(f);var g=node("div");g.style.display="table-cell";var k=node("div");k.style.display="table-row";k.appendChild(g);k.appendChild(e);a.appendChild(k);a=node("div");f.appendChild(a);f=node("div");f.style.display="inline-block";f.style.verticalAlign="top";f.style.position="relative";
f.style.top="9px";f.style.width="110px";f.appendChild(document.createTextNode(lm.customEmail_addAttachs));e=node("a");e.classList.add("tooltipQ");e.style.float="none";e.onclick=function(){showSingleTooltip(this,"customEmail_attachFieldDesc",!0)};g=node("i");g.classList.add("fas");g.classList.add("fa-question");e.appendChild(g);f.appendChild(e);a.appendChild(f);var l=node("select");l.id="attachSelect";a.appendChild(l);l.appendChild(node("option"));-1!=c.supportedAttachTypes.indexOf(EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.RECORD_LINK)&&
(f=node("option"),f.appendChild(document.createTextNode(lm.includeLink)),f.value="attLink",l.appendChild(f));-1!=c.supportedAttachTypes.indexOf(EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.EXCEL)&&(f=node("option"),f.appendChild(document.createTextNode(lm.attachExcel)),f.value="attExcel",l.appendChild(f));-1!=c.supportedAttachTypes.indexOf(EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.PDF)&&(f=node("option"),f.appendChild(document.createTextNode(lm.attachPdf)),f.value="attPdf",
f.onclick=function(a,b){a&&b&&c.attachSelectCombo&&c.attachSelectCombo.pdfConfigDiv&&c.attachSelectCombo.pdfConfigDivEmptyDivTop&&c.attachSelectCombo.pdfConfigDivEmptyDivBottom&&(b.selected?(c.attachSelectCombo.pdfConfigDivEmptyDivTop.style.display="block",c.attachSelectCombo.pdfConfigDivEmptyDivBottom.style.display="block",c.attachSelectCombo.pdfConfigDiv.style.display="block"):(c.attachSelectCombo.pdfConfigDivEmptyDivTop.style.display="none",c.attachSelectCombo.pdfConfigDivEmptyDivBottom.style.display=
"none",c.attachSelectCombo.pdfConfigDiv.style.display="none"))},l.appendChild(f),d=!0);f=Promise.resolve();-1!=c.supportedAttachTypes.indexOf(EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAIL_MERGE)&&(f=c.getMailMergeTemplates().then(function(a){a.forEach(function(a){var b=node("option");b.appendChild(document.createTextNode(lm.attachMailMerges+":"+a.name));b.value="attMM_"+a.id;l.appendChild(b)});return Promise.resolve()}));-1!=c.supportedAttachTypes.indexOf(EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.FILE_FIELD)&&
(f=f.then(function(){return c.findFileFields()}).then(function(a){a.forEach(function(a){var b=node("option");b.appendChild(document.createTextNode(("U"==a.type?lm.customEmail_addAttachs_fileField:lm.customEmail_addAttachs_graphField)+":"+a.name));b.value=a.value;l.appendChild(b)});return Promise.resolve()}));-1!=c.supportedAttachTypes.indexOf(EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAGIC_RECORD_LINK_READONLY)&&(f=f.then(function(){var a=node("option");a.appendChild(document.createTextNode(lm.attMagicLinkReadOnly));
a.value="attMagicLinkReadOnly";l.appendChild(a);return Promise.resolve()}));"W"!==biffdata.rights||biffdata.noedit||-1==c.supportedAttachTypes.indexOf(EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAGIC_RECORD_LINK_EDITABLE)||(f=f.then(function(){var a=node("option");a.appendChild(document.createTextNode(lm.attMagicLinkEditable));a.value="attMagicLinkEditable";l.appendChild(a);return Promise.resolve()}));return f.then(function(){c.attachSelectCombo=enableMultiSelectCombo(l,!1,{customComboBoxStyles:{"max-width":"390px"}});
b.attLink&&MultiSelectComboAgent.clickOnOption("attachSelect","attLink");b.attExcel&&MultiSelectComboAgent.clickOnOption("attachSelect","attExcel");b.attPdf&&MultiSelectComboAgent.clickOnOption("attachSelect","attPdf");if(b.attMM)try{JSON.parse(decodeURIComponent(b.attMM)).forEach(function(a){MultiSelectComboAgent.clickOnOption("attachSelect","attMM_"+a)})}catch(m){}if(b.attField)try{JSON.parse(decodeURIComponent(b.attField)).forEach(function(a){MultiSelectComboAgent.clickOnOption("attachSelect",
"attField_"+a)})}catch(m){}b.attMagicLinkReadOnly&&MultiSelectComboAgent.clickOnOption("attachSelect","attMagicLinkReadOnly");b.attMagicLinkEditable&&MultiSelectComboAgent.clickOnOption("attachSelect","attMagicLinkEditable");c.attachSelectCombo.afterChangeItem=function(a){(a=c.inputBuilderMap.content)&&c.applyCustomTemplate(c.STATUS.PREVIEW,a)};c.attachSelectCombo.getSelectedValues=function(){var a={},b=[],c=[];this.getValues().forEach(function(d){0<=d.indexOf("attMM_")?b.push(d.replace("attMM_",
"")):0<=d.indexOf("attField_")?c.push(d.replace("attField_","")):a[d]=!0});a.attMM=b;a.attField=c;return a};c.attachSelectCombo.getPdfDownloadParams=function(){var a={};try{if(c.attachSelectCombo.pdfConfigDiv){var b=c.attachSelectCombo.pdfConfigDiv,d=b.querySelector("#orientation1").checked,e=b.querySelector("#pdfSizeSelect").value,f=b.querySelector("#fileNameRefSelect").value,g=b.querySelector("#dlKeepContent").checked,k=b.querySelector("#dlShowDefaultBorder").checked,l=b.querySelector("#dlPDFWithApproval").checked;
a.orientation=d?"portrait":"landscape";a.pdfSize=e?e:"A4";a.fileNameRef=f?f:"";l&&(a.showApprovalInfo="");k&&(a.showDefaultBorder="");g&&(a.keepContent="")}}catch(x){a={}}b={};b.pdfDownloadParams=a;return b};return Promise.resolve(d)})};
BuilderModeEmailTemplateEditor.prototype.renderFileUploader=function(a,b){var c=this;if(c.supportAttachFile){var d=node("div");d.style.display="table-cell";var e=node("div");d.appendChild(e);var f=node("div");f.style.display="table-cell";var g=node("div");g.style.display="table-row";g.appendChild(f);g.appendChild(d);a.appendChild(g);a=node("div");a.style.margin="10px 0";e.appendChild(a);e=new EmailTemplateFileUploader;e.render(a);c.attachFileUploader=e;if(b.attFile)try{JSON.parse(decodeURIComponent(b.attFile)).forEach(function(a){if(!(11>=
a.length||"@"!=a.charAt(10))){var b=a.substring(11);b&&c.attachFileUploader.addUploadedFile({fileName:a,displayFileName:b})}})}catch(k){}}};BuilderModeEmailTemplateEditor.prototype.findFileFields=function(){return new Promise(function(a,b){b=[];for(var c in builder.cellData){var d=builder.cellData[c];d&&d.attr&&d.domainId&&(builder.ifAdjacent(d.x,d.y)||"U"!=d.IPType&&"G"!=d.IPType||b.push({name:d.value,value:"attField_"+d.domainId,type:d.IPType}))}a(b)})};
BuilderModeEmailTemplateEditor.prototype.getMailMergeTemplates=function(){return new Promise(function(a,b){b=[];for(var c in builder.templates){var d=builder.templates[c];d&&(d.ifListingMode||b.push(d))}a(b)})};
BuilderModeEmailTemplateEditor.prototype.renderButtons=function(a){var b=this,c=node("div");c.classList.add("topButtonWhole");c.classList.add("topButtonBlue");c.style.padding="5px 35px";c.style.margin="8px 8px 8px 0px";c.innerHTML=lm.save;c.onclick=function(){b.save()};var d=node("div");d.style.display="table-cell";d.appendChild(c);c=node("div");c.style.display="table-cell";var e=node("div");e.style.display="table-row";e.appendChild(c);e.appendChild(d);a.appendChild(e)};
BuilderModeEmailTemplateEditor.prototype.applyCustomTemplate=function(a,b){var c=this,d={ap:ap,path:path,si:sheetIndex,type:c.type,nid:c.getRootNodeId()};c.templateKey&&(d.key=c.templateKey);switch(a){case c.STATUS.INIT:d.init=!0;break;case c.STATUS.RESTORE:d.restore=!0}if(b){var e=b.getCustTemplate();e&&(d[b.inputTemplate]=e)}else c.inputBuilders.forEach(function(a){var b=a.getCustTemplate();b&&(d[a.inputTemplate]=b)});if(0<c.supportedAttachTypes.length&&c.attachSelectCombo){e=c.attachSelectCombo.getSelectedValues();
for(var f in e)if("attMM"===f||"attField"===f)0!==e[f].length&&(d[f]=encodeURIComponent(JSON.stringify(e[f])));else if("attPdf"===f){d[f]=e[f];var g=c.attachSelectCombo.getPdfDownloadParams();g.pdfDownloadParams&&(d.pdfDownloadParams=encodeURIComponent(JSON.stringify(g.pdfDownloadParams)))}else d[f]=e[f]}c.supportAttachFile&&c.attachFileUploader&&(f=c.attachFileUploader.getUploadedFiles(),d.attFile=encodeURIComponent(JSON.stringify(f)));return postPromise(this.processTemplateURL,d).then(function(d){return new Promise(function(e,
f){var g=JSON.parse(d);if(g.error)throw g;if(b){f=b.inputTemplate;var k=f+"Display",l="default"+f.charAt(0).toUpperCase()+f.slice(1);(g[f]||""==g[f])&&b.setCustTemplate(decodeURIComponent(g[f]));(g[k]||""==g[k])&&b.setDisplayValue(decodeURIComponent(g[k]));(g[l]||""==g[l])&&b.setDefaultTemplate(decodeURIComponent(g[l]));if(f==EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT&&a==c.STATUS.RESTORE){f=c.attachSelectCombo.afterChangeItem;c.attachSelectCombo.afterChangeItem=null;k=c.attachSelectCombo.getSelectedValues();
(g.attLink||!1)!=(k.attLink||!1)&&MultiSelectComboAgent.clickOnOption("attachSelect","attLink");(g.attExcel||!1)!=(k.attExcel||!1)&&MultiSelectComboAgent.clickOnOption("attachSelect","attExcel");(g.attPdf||!1)!=(k.attPdf||!1)&&MultiSelectComboAgent.clickOnOption("attachSelect","attPdf");(g.attMagicLinkReadOnly||!1)!=(k.attMagicLinkReadOnly||!1)&&MultiSelectComboAgent.clickOnOption("attachSelect","attMagicLinkReadOnly");(g.attMagicLinkEditable||!1)!=(k.attMagicLinkEditable||!1)&&MultiSelectComboAgent.clickOnOption("attachSelect",
"attMagicLinkEditable");var m=g.attMM?JSON.parse(decodeURIComponent(g.attMM)):[],t=k.attMM||[];m.filter(function(a){return 0>t.indexOf(a)}).concat(t.filter(function(a){return 0>m.indexOf(a)})).forEach(function(a){MultiSelectComboAgent.clickOnOption("attachSelect","attMM_"+a)});var v=g.attField?JSON.parse(decodeURIComponent(g.attField)):[],u=k.attField||[];v.filter(function(a){return 0>u.indexOf(a)}).concat(u.filter(function(a){return 0>v.indexOf(a)})).forEach(function(a){MultiSelectComboAgent.clickOnOption("attachSelect",
"attField_"+a)});c.attachSelectCombo.afterChangeItem=f;c.attachFileUploader.reset();(g.attFile?JSON.parse(decodeURIComponent(g.attFile)):[]).forEach(function(a){if(!(11>=a.length||"@"!=a.charAt(10))){var b=a.substring(11);b&&c.attachFileUploader.addUploadedFile({fileName:a,displayFileName:b})}})}}else c.inputBuilders.forEach(function(a){var b=a.inputTemplate,c=b+"Display",d="default"+b.charAt(0).toUpperCase()+b.slice(1);if(g[b]||""==g[b]){b=decodeURIComponent(g[b]);if(a.inputType==a.INPUT_TYPE.FREESELECT&&
a.defaultInputType==a.INPUT_TYPE.SELECT)for(var e=/\{\{.+\}\}/,f=b.split(","),k=0;k<f.length;k++)if(!f[k].trim().match(e)){a.switchToTextMode();break}a.setCustTemplate(b)}(g[c]||""==g[c])&&a.setDisplayValue(decodeURIComponent(g[c]));(g[d]||""==g[d])&&a.setDefaultTemplate(decodeURIComponent(g[d]))});e(g)})})};BuilderModeEmailTemplateEditor.prototype.getRootNodeId=function(){return getRootNodeIdFromUrl()};
BuilderModeEmailTemplateEditor.prototype.save=function(){var a={type:this.type};this.templateKey&&(a.key=this.templateKey);var b=null,c=null,d=null,e=null,f=null,g=null;this.inputBuilders.forEach(function(a){var k=a.getCustTemplate();k=encodeURIComponent(k);k=k.replace(/'/g,"%27");switch(a.inputTemplate){case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.REPLAY_TO:b=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS:c=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CC:d=
k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.BCC:e=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT:f=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT:g=k}});var k=!1,l=!1,m=!1,n=[],q=[],r=[],p=!1,t=!1,v={};0<this.supportedAttachTypes.length&&this.attachSelectCombo&&(t=this.attachSelectCombo.getSelectedValues(),k=t.attLink||!1,l=t.attExcel||!1,m=t.attPdf||!1,n=t.attMM||[],q=t.attField||[],p=t.attMagicLinkReadOnly||!1,t=t.attMagicLinkEditable||
!1);if(m&&null!==this.attachSelectCombo.pdfConfigDiv&&void 0!==this.attachSelectCombo.pdfConfigDiv){var u=this.attachSelectCombo.getPdfDownloadParams();(u=u.pdfDownloadParams)&&(v=u)}this.supportAttachFile&&this.attachFileUploader&&(r=this.attachFileUploader.getUploadedFiles());u=builder.getEmailTemplatesByAttribute(a);var x=null;x=0==u.length?builder.addEmailTemplate(null,f,g,a):u[0];if(f||""==f)x.subject=f;if(g||""==g)x.content=g;if(c||""==c)x.receiverList=c;if(d||""==d)x.ccList=d;if(e||""==e)x.bccList=
e;if(b||""==b)x.replyTo=b;x.attLink=k;x.attExcel=l;x.attPdf=m;x.attMM=encodeURIComponent(JSON.stringify(n));x.attField=encodeURIComponent(JSON.stringify(q));x.attFile=encodeURIComponent(JSON.stringify(r));x.attMagicLinkReadOnly=p;x.attMagicLinkEditable=t;x.pdfDownloadParams=encodeURIComponent(JSON.stringify(v));floatWin(null,lm["customEmail_"+this.type+"_saved"],null,!1,null,!1);this.initStatus=this.STATUS.PREVIEW};var builderModeEmailTemplateEditors={};
builderModeEmailTemplateEditors.custom=new BuilderModeEmailTemplateEditor({type:"custom",inputConfigs:[{label:"CC",help:["HELP_CUSTOM_EM_TEMPLATE_PARAMS_CUSTOM_CC","HELP_CUSTOM_EM_TEMPLATE_EMAIL_SEPARATOR"],inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT,defaultInputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CC,findSelectOptionFieldsFunc:BuilderModeEmailTemplateEditor.prototype.findEmailDataCellsAsSelectOption},
{label:"BCC",help:["HELP_CUSTOM_EM_TEMPLATE_PARAMS_CUSTOM_CC","HELP_CUSTOM_EM_TEMPLATE_EMAIL_SEPARATOR"],inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT,defaultInputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.BCC,findSelectOptionFieldsFunc:BuilderModeEmailTemplateEditor.prototype.findEmailDataCellsAsSelectOption},{label:lm.mailSubject,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_CUSTOM",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,
inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT},{label:lm.content,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_CUSTOM",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.HTML,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT}],supportedAttachTypes:[EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.RECORD_LINK,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.EXCEL,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.PDF,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAIL_MERGE,
EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.FILE_FIELD],supportAttachFile:!0});
builderModeEmailTemplateEditors.reviewer=new BuilderModeEmailTemplateEditor({type:"reviewer",inputConfigs:[{label:lm.mailSubject,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_REVIEWER",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT},{label:lm.content,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_REVIEWER",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.HTML,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT}],
supportedAttachTypes:[EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.RECORD_LINK,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.EXCEL,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.PDF,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAIL_MERGE,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.FILE_FIELD],supportAttachFile:!0});
builderModeEmailTemplateEditors.reminder=new BuilderModeEmailTemplateEditor({type:"reminder",inputConfigs:[{label:lm.mailSubject,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_REMINDER",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT},{label:lm.content,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_REMINDER",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.HTML,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT}]});
builderModeEmailTemplateEditors.actionButton=new BuilderModeEmailTemplateEditor({type:"actionButton",inputConfigs:[{label:lm.customEmail_replyTo,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_ACTIONBUTTON_REPLY_TO",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT,defaultInputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.REPLAY_TO,findSelectOptionFieldsFunc:BuilderModeEmailTemplateEditor.prototype.findEmailDataCellsAsSelectOption},
{label:lm.recipients,help:["HELP_CUSTOM_EM_TEMPLATE_PARAMS_ACTIONBUTTON","HELP_CUSTOM_EM_TEMPLATE_EMAIL_SEPARATOR","HELP_CUSTOM_EM_TEMPLATE_EMAIL_RECIPIENTS_LIMIT"],inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS,autoFillFunc:BuilderModeEmailTemplateEditor.prototype.findEmailDataCellAsAutoFillValue,findSelectOptionFieldsFunc:BuilderModeEmailTemplateEditor.prototype.findEmailDataCellsAsSelectOption},{label:"CC",
help:["HELP_CUSTOM_EM_TEMPLATE_PARAMS_ACTIONBUTTON","HELP_CUSTOM_EM_TEMPLATE_EMAIL_SEPARATOR"],inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT,defaultInputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CC,findSelectOptionFieldsFunc:BuilderModeEmailTemplateEditor.prototype.findEmailDataCellsAsSelectOption},{label:"BCC",help:["HELP_CUSTOM_EM_TEMPLATE_PARAMS_ACTIONBUTTON","HELP_CUSTOM_EM_TEMPLATE_EMAIL_SEPARATOR"],
inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT,defaultInputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.BCC,findSelectOptionFieldsFunc:BuilderModeEmailTemplateEditor.prototype.findEmailDataCellsAsSelectOption},{label:lm.mailSubject,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_ACTIONBUTTON",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT},
{label:lm.content,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_ACTIONBUTTON",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.HTML,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT}],supportedAttachTypes:[EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.RECORD_LINK,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.EXCEL,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.PDF,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAIL_MERGE,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.FILE_FIELD,
EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAGIC_RECORD_LINK_READONLY,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAGIC_RECORD_LINK_EDITABLE],supportAttachFile:!0});
builderModeEmailTemplateEditors.actionButton.open=function(a,b,c){a?this.buttonSeq=a:delete this.buttonSeq;b?this.templateKey=b:delete this.templateKey;BuilderModeEmailTemplateEditor.prototype.open.call(this,b,c).then(function(){if(a){var b=builder.actionButtons[a].action.split("(")[0],c=builder.postworkflow.split("\n").some(function(a){return-1!=a.trim().indexOf(b)});$("sendCustomEmail_executeInWorkflow").checked=c;c=retrieveBetweenLines(builder.sheetScope,"function "+b+"(nodeId","//END"+b).replace(/nodeId/g,
'"${NODEID}"').split("\n").some(function(a){if(a){try{if(JSON.parse(a).asyncSend)return!0}catch(g){}return!1}});$("sendCustomEmail_asyncSend").checked=c}})};
builderModeEmailTemplateEditors.actionButton.renderButtons=function(a){var b=this,c=node("div");c.style.display="table-cell";var d=node("div");d.style.display="table-cell";var e=node("a");e.setAttribute("href","javascript:void(0)");e.style.margin="0 0 10px 0px";e.onclick=function(){"none"==$("sendCustomEmailAdvancedDiv").style.display?$("sendCustomEmailAdvancedDiv").style.display="":$("sendCustomEmailAdvancedDiv").style.display="none"};e.appendChild(document.createTextNode(lm.advancedSetting));d.appendChild(e);
d.appendChild(node("br"));e=node("div");e.style.display="none";e.style.margin="10px 0";e.setAttribute("id","sendCustomEmailAdvancedDiv");d.appendChild(e);var f=node("div");e.appendChild(f);var g=node("input");g.setAttribute("id","sendCustomEmail_executeInWorkflow");g.setAttribute("type","checkbox");f.appendChild(g);g=node("label");g.setAttribute("for","sendCustomEmail_executeInWorkflow");g.appendChild(document.createTextNode(lm.updRecExecInWorkflow));f.appendChild(g);f=node("div");e.appendChild(f);
e=node("input");e.setAttribute("id","sendCustomEmail_asyncSend");e.setAttribute("type","checkbox");f.appendChild(e);e=node("label");e.setAttribute("for","sendCustomEmail_asyncSend");e.appendChild(document.createTextNode(lm.sendCustomEmailButton_asyncSend));f.appendChild(e);var k=node("a");k.classList.add("tooltipQ");k.onclick=function(){showSingleTooltip(k,"HELP_SEND_CUSTOM_EMAIL_ASYNC_SEND",!1,!0,!1,!0)};f.appendChild(k);e=node("i");e.classList.add("fas");e.classList.add("fa-question");k.appendChild(e);
e=node("div");e.style.display="table-row";e.appendChild(c);e.appendChild(d);a.appendChild(e);d=node("div");d.style.display="table-cell";c=node("div");c.classList.add("topButtonWhole");c.classList.add("topButtonBlue");c.style.padding="5px 35px";c.style.margin="8px 8px 8px 0px";c.innerHTML=lm.save;c.onclick=function(){b.save()};d.appendChild(c);b.buttonSeq&&(c=node("div"),c.classList.add("topButtonWhole"),c.style.padding="5px 35px",c.style.margin="8px 8px 8px 0px",c.innerHTML=lm.ragicActionButton_removeButton,
c.onclick=function(){delActionButton(b.buttonSeq);floatWin(null,lm.ragicActionButton_removeButton_prompt)},d.appendChild(c));c=node("div");c.style.display="table-cell";e=node("div");e.style.display="table-row";e.appendChild(c);e.appendChild(d);a.appendChild(e)};builderModeEmailTemplateEditors.actionButton.save=function(){var a=this;actionButtonGenerator.createSendCustomEmail(a.buttonSeq,a.templateKey,a.type).then(function(b){a.templateKey||(a.templateKey=getMaxActionButtonSeq());BuilderModeEmailTemplateEditor.prototype.save.call(a)}).catch(function(a){})};
function EditModeEmailTemplateEditor(a){BuilderModeEmailTemplateEditor.call(this,a)}EditModeEmailTemplateEditor.prototype=Object.create(BuilderModeEmailTemplateEditor.prototype);EditModeEmailTemplateEditor.prototype.constructor=EditModeEmailTemplateEditor;EditModeEmailTemplateEditor.prototype.getRootNodeId=function(){return this.rootNodeId?this.rootNodeId:biffdata.rootNodeId};
EditModeEmailTemplateEditor.prototype.initEditor=function(a){this.inputBuilders.forEach(function(a){a.setCustTemplate("")});this.ap=ap;this.path=path;this.sheetIndex=sheetIndex;this.rootNodeId=a;this.attachFileUploader=this.attachSelectCombo=null;return this.STATUS.INIT};
EditModeEmailTemplateEditor.prototype.findEmailBiffAsAutoFillValue=function(){return new Promise(function(a,b){b=null;var c=/(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/,d=biffdata.biffs,e,f;var g=0;for(e=d.length;g<e;g++)if(d[g].dataType!==HEADER&&!biffdata.ifSubtableDataBiff(d[g])){if("L"==d[g].IPType&&d[g].attr&&d[g].attr.usrref&&d[g].value){b="{{"+d[g].domainId+"}}";break}if("D"==d[g].IPType&&
(f=c.exec(d[g].displayValue))){b="{{"+d[g].domainId+"}}";break}}a(b)})};EditModeEmailTemplateEditor.prototype.findEmailBiffsAsSelectOption=function(){return new Promise(function(a,b){b=[];var c=biffdata.biffs,d;var e=0;for(d=c.length;e<d;e++)c[e].dataType===HEADER&&(biffdata.ifSubtableBiff(c[e])||("D"==c[e].IPType||("L"==c[e].IPType||"M"==c[e].IPType)&&c[e].attr&&c[e].attr.usrref&&c[e].value)&&b.push({name:c[e].value,value:"{{"+c[e].domainId+"}}"}));a(b)})};
EditModeEmailTemplateEditor.prototype.getMailMergeTemplates=function(){return new Promise(function(a,b){a(biffdata.templates.filter(function(a){return!a.ifListingMode}))})};EditModeEmailTemplateEditor.prototype.findFileFields=function(){return new Promise(function(a,b){b=[];var c=biffdata.biffs,d;var e=0;for(d=c.length;e<d;e++)c[e].dataType===HEADER&&(biffdata.ifSubtableBiff(c[e])||"U"!=c[e].IPType&&"G"!=c[e].IPType||b.push({name:c[e].value,value:"attField_"+c[e].domainId,type:c[e].IPType}));a(b)})};
EditModeEmailTemplateEditor.prototype.save=function(){var a=this,b="",c="",d="",e="",f="",g="";a.inputBuilders.forEach(function(a){var k=a.getCustTemplate();k=encodeURIComponent(k);k=k.replace(/'/g,"%27");switch(a.inputTemplate){case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.REPLAY_TO:b=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS:c=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CC:d=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.BCC:e=
k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT:f=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT:g=k}});var k={content:g,subject:f,ap:ap,path:path,si:sheetIndex,type:a.type};a.templateKey&&(k.key=a.templateKey);c&&(k.receiverList=c);d&&(k.ccList=d);e&&(k.bccList=e);b&&(k.replyTo=b);if(0<a.supportedAttachTypes.length&&a.attachSelectCombo){var l=a.attachSelectCombo.getSelectedValues(),m;for(m in l)if("attMM"===m||"attField"===m)0!==l[m].length&&(k[m]=
encodeURIComponent(JSON.stringify(l[m])));else if("attPdf"===m){k[m]=l[m];var n=a.attachSelectCombo.getPdfDownloadParams();(n=n.pdfDownloadParams)&&(k.pdfDownloadParams=encodeURIComponent(JSON.stringify(n)))}else k[m]=l[m]}a.supportAttachFile&&a.attachFileUploader&&(l=a.attachFileUploader.getUploadedFiles(),k.attFile=encodeURIComponent(JSON.stringify(l)));postPromise("/sims/mmailer/customTemplate/saveCustEmailTemplateToNUI.jsp",k).then(function(){floatWin(null,lm["customEmail_"+a.type+"_saved_nui"],
null,!1,null,!1)})};EditModeEmailTemplateEditor.prototype.getUsersAsSelectOption=function(){return postPromise("/sims/getActiveUsers.jsp",{a:ap}).then(function(a){return new Promise(function(b,c){var d=[];JSON.parse(a).forEach(function(a){d.push({name:a.name,value:a.email})});b(d)})})};editModeEmailTemplateEditors={};
editModeEmailTemplateEditors.newUser=new EditModeEmailTemplateEditor({type:"new_user",inputConfigs:[{label:lm.mailSubject,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_NEW_USER",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT},{label:lm.content,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_NEW_USER",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.HTML,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT}],
supportedAttachTypes:[EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.RECORD_LINK,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.EXCEL,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.PDF,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAIL_MERGE,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.FILE_FIELD],supportAttachFile:!0});
editModeEmailTemplateEditors.newUser.renderButtons=function(a){var b=this,c=node("div");c.style.display="table-cell";var d=node("div");d.classList.add("topButtonWhole");d.classList.add("topButtonBlue");d.style.padding="5px 35px";d.style.margin="8px 8px 8px 0px";d.innerHTML=lm.customEmail_new_user_resend;d.onclick=function(){var a=getRootNodeIdFromUrl();0>a||postPromise("/sims/mmailer/customTemplate/newUser/resendInviteEmail.jsp",{a:ap,p:path,si:sheetIndex,ni:a}).then(function(a){a=JSON.parse(a);floatWin(null,
a.isSuccess?lm.customEmail_new_user_resend_success:a.message)})};c.appendChild(d);owner&&(d=node("a"),d.setAttribute("href","javascript:void(0)"),d.style.position="relative",d.style.top="19px",delete d.style.color,d.appendChild(document.createTextNode(lm.customEmail_sendEntry_save)),d.onclick=function(){b.save()},c.appendChild(d));d=node("div");d.style.display="table-cell";var e=node("div");e.style.display="table-row";e.appendChild(d);e.appendChild(c);a.appendChild(e)};
editModeEmailTemplateEditors.sendEntry=new EditModeEmailTemplateEditor({type:"sendEntry",inputConfigs:[{label:lm.customEmail_replyTo,inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT,defaultInputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.REPLAY_TO,findSelectOptionFieldsFunc:EditModeEmailTemplateEditor.prototype.findEmailBiffsAsSelectOption},{label:lm.recipients,help:["HELP_CUSTOM_EM_TEMPLATE_PARAMS_SENDENTRY",
"HELP_CUSTOM_EM_TEMPLATE_EMAIL_SEPARATOR","HELP_CUSTOM_EM_TEMPLATE_EMAIL_RECIPIENTS_LIMIT"],inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT,defaultInputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS,autoFillFunc:EditModeEmailTemplateEditor.prototype.findEmailBiffAsAutoFillValue,findSelectOptionFieldsFunc:EditModeEmailTemplateEditor.prototype.findEmailBiffsAsSelectOption},{label:"CC",help:["HELP_CUSTOM_EM_TEMPLATE_PARAMS_SENDENTRY",
"HELP_CUSTOM_EM_TEMPLATE_EMAIL_SEPARATOR"],inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT,defaultInputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CC,findSelectOptionFieldsFunc:EditModeEmailTemplateEditor.prototype.findEmailBiffsAsSelectOption},{label:"BCC",help:["HELP_CUSTOM_EM_TEMPLATE_PARAMS_SENDENTRY","HELP_CUSTOM_EM_TEMPLATE_EMAIL_SEPARATOR"],inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREESELECT,
defaultInputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.BCC,findSelectOptionFieldsFunc:EditModeEmailTemplateEditor.prototype.findEmailBiffsAsSelectOption},{label:lm.mailSubject,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_NEW_USER",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT},{label:lm.content,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_NEW_USER",
inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.HTML,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT}],supportedAttachTypes:[EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.RECORD_LINK,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.EXCEL,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.PDF,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAIL_MERGE,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.FILE_FIELD,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAGIC_RECORD_LINK_READONLY,
EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAGIC_RECORD_LINK_EDITABLE],supportAttachFile:!0});
editModeEmailTemplateEditors.sendEntry.renderButtons=function(a){var b=this,c=node("div");c.style.display="table-cell";var d=node("div");d.classList.add("topButtonWhole");d.classList.add("topButtonBlue");d.style.padding="5px 35px";d.style.margin="8px 8px 8px 0px";d.innerHTML=lm.sendMailButton;d.dataset.id=b.getRootNodeId();d.onclick=function(){var a="",c="",d="",e="",m="",n="";b.inputBuilders.forEach(function(b){var f=b.getCustTemplate();switch(b.inputTemplate){case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.REPLAY_TO:a=
f;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS:c=f;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CC:d=f;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.BCC:e=f;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT:m=f;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT:n=f}});var q={a:ap,r:c,cc:d,bcc:e,d:biffdata.rootDomainId,id:this.dataset.id,i:sheetIndex,p:path,s:m,c:n,replyTo:a},r=b.attachSelectCombo.getSelectedValues(),
p;for(p in r)if("attMM"===p||"attField"===p)0!==r[p].length&&(q[p]=JSON.stringify(r[p]));else if("attPdf"===p){q[p]=r[p];var t=b.attachSelectCombo.getPdfDownloadParams();(t=t.pdfDownloadParams)&&(q.pdfDownloadParams=JSON.stringify(t))}else q[p]=r[p];r=b.attachFileUploader.getUploadedFiles();q.attFile=JSON.stringify(r);c&&0<c.trim().length?postPromise("/sims/mmailer/customTemplate/sendEntry/sendEntryByEmail.jsp",q).then(function(a){floatWin(null,a,null,!0);$("emailWin").style.display="none";switchRightDock($("emailWin"),
$("emailWin"),loadEmailEditor,3);if(getBundleString("customEmail_sendEntry_sent")+"\n"===a.toString()||getBundleString("customEmail_sendEntry_sent")===a.toString())a=parseInt($("emailSize").innerText.replace("(","").replace(")",""))+1,$("emailSize").innerText="("+a+")"}):alert(lm.recipients+" is empty")};c.appendChild(d);owner&&(d=node("a"),d.setAttribute("href","javascript:void(0)"),d.style.position="relative",d.style.top="19px",delete d.style.color,d.appendChild(document.createTextNode(lm.customEmail_sendEntry_save)),
d.onclick=function(){b.save()},c.appendChild(d));d=node("div");d.style.display="table-cell";var e=node("div");e.style.display="table-row";e.appendChild(d);e.appendChild(c);a.appendChild(e)};
editModeEmailTemplateEditors.sendEntry.save=function(){var a=this,b="",c="",d="",e="",f="",g="";a.inputBuilders.forEach(function(a){var k=a.getCustTemplate();k=encodeURIComponent(k);k=k.replace(/'/g,"%27");switch(a.inputTemplate){case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.REPLAY_TO:b=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS:c=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CC:d=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.BCC:e=
k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT:f=k;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT:g=k}});var k={content:g,subject:f,ap:ap,path:path,si:sheetIndex,type:a.type};a.templateKey&&(k.key=a.templateKey);c&&(k.receiverList=c);d&&(k.ccList=d);e&&(k.bccList=e);b&&(k.replyTo=b);if(0<a.supportedAttachTypes.length&&a.attachSelectCombo){var l=a.attachSelectCombo.getSelectedValues(),m;for(m in l)if("attMM"==m||"attField"==m)0!=l[m].length&&(k[m]=encodeURIComponent(JSON.stringify(l[m])));
else if("attPdf"===m){k[m]=l[m];var n=a.attachSelectCombo.getPdfDownloadParams();(n=n.pdfDownloadParams)&&(k.pdfDownloadParams=encodeURIComponent(JSON.stringify(n)))}else k[m]=l[m]}a.supportAttachFile&&a.attachFileUploader&&(l=a.attachFileUploader.getUploadedFiles(),k.attFile=encodeURIComponent(JSON.stringify(l)));postPromise("/sims/mmailer/customTemplate/saveCustEmailTemplateToNUI.jsp",k).then(function(){floatWin(null,lm["customEmail_"+a.type+"_saved_nui"],null,!1,null,!1)})};
editModeEmailTemplateEditors.notifyViewInsert=new EditModeEmailTemplateEditor({type:"notify_view_insert",templateDesc:lm.customEmail_notify_view_insert_desc,inputConfigs:[{label:lm.recipients,help:["customEmail_notify_view_help_recipients"],inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.SELECT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS,findSelectOptionFieldsFunc:EditModeEmailTemplateEditor.prototype.getUsersAsSelectOption},{label:lm.mailSubject,inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,
inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT},{label:lm.content,inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.HTML,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT}]});
editModeEmailTemplateEditors.notifyViewUpdateMatch=new EditModeEmailTemplateEditor({type:"notify_view_update_match",templateDesc:lm.customEmail_notify_view_updateMatch_desc,inputConfigs:[{label:lm.recipients,help:["customEmail_notify_view_help_recipients"],inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.SELECT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS,findSelectOptionFieldsFunc:EditModeEmailTemplateEditor.prototype.getUsersAsSelectOption},{label:lm.mailSubject,
inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT},{label:lm.content,inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.HTML,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT}]});
editModeEmailTemplateEditors.notifyViewUpdateNoMatch=new EditModeEmailTemplateEditor({type:"notify_view_update_not_match",templateDesc:lm.customEmail_notify_view_updateNoMatch_desc,inputConfigs:[{label:lm.recipients,help:["customEmail_notify_view_help_recipients"],inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.SELECT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS,findSelectOptionFieldsFunc:EditModeEmailTemplateEditor.prototype.getUsersAsSelectOption},{label:lm.mailSubject,
inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT},{label:lm.content,inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.HTML,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT}]});
editModeEmailTemplateEditors.notifyViewInsert.renderButtons=function(a){var b=this,c=node("div");c.classList.add("topButtonWhole");c.classList.add("topButtonBlue");c.style.padding="5px 35px";c.style.margin="8px 8px 8px 0px";c.innerHTML=lm.save;c.onclick=function(){b.save()};var d=node("div");d.style.position="relative";d.style.top="19px";d.style.color="rgb(0, 134, 255)";d.setAttribute("id","notifyViewMessageDiv_"+b.type);var e=node("div");e.style.display="table-cell";e.appendChild(c);e.appendChild(d);
c=node("div");c.style.display="table-cell";d=node("div");d.style.display="table-row";d.appendChild(c);d.appendChild(e);a.appendChild(d)};
editModeEmailTemplateEditors.notifyViewInsert.save=function(){var a="",b="",c="",d="",e="";this.inputBuilders.forEach(function(f){var g=f.getCustTemplate();g=encodeURIComponent(g);g=g.replace(/'/g,"%27");switch(f.inputTemplate){case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.REPLAY_TO:a=g;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS:b=g;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CC:c=g;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT:d=
g;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT:e=g}});var f={setNotifyList:"",a:ap,p:path,fn:sheet,seq:this.templateKey,recipients:b},g={content:e,subject:d,ap:ap,path:path,si:sheetIndex,type:this.type};this.templateKey&&(g.key=this.templateKey);c&&(g.ccList=c);a&&(g.replyTo=a);var k=$("notifyViewMessageDiv_"+this.type);postPromise("/sims/saveDesignerQuery.jsp",f).then(function(a){return new Promise(function(b,c){var d=JSON.parse(a);d.success?(d.thisUserInNotifyList?ctrl.notifyViewTabsBuilder.triggerObj.setAttribute("notify",
!0):ctrl.notifyViewTabsBuilder.triggerObj.setAttribute("notify",!1),b(!0)):c(d.errMsg)})}).then(function(a,b){return postPromise("/sims/mmailer/customTemplate/saveCustEmailTemplateToNUI.jsp",g)}).then(function(){k&&(k.style.color="rgb(0, 134, 255)",k.innerHTML=lm.customEmail_notify_view_saved_nui)}).catch(function(a){a&&(k.style.color="red",k.innerHTML=a)})};editModeEmailTemplateEditors.notifyViewUpdateMatch.renderButtons=editModeEmailTemplateEditors.notifyViewInsert.renderButtons;
editModeEmailTemplateEditors.notifyViewUpdateMatch.save=editModeEmailTemplateEditors.notifyViewInsert.save;editModeEmailTemplateEditors.notifyViewUpdateNoMatch.renderButtons=editModeEmailTemplateEditors.notifyViewInsert.renderButtons;editModeEmailTemplateEditors.notifyViewUpdateNoMatch.save=editModeEmailTemplateEditors.notifyViewInsert.save;
editModeEmailTemplateEditors.massEmail=new EditModeEmailTemplateEditor({type:"massEmail",inputConfigs:[{label:lm.customEmail_replyTo,inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.REPLAY_TO},{label:lm.recipients,help:["HELP_CUSTOM_EM_TEMPLATE_PARAMS_SENDENTRY","HELP_CUSTOM_EM_TEMPLATE_EMAIL_SEPARATOR","HELP_CUSTOM_EM_TEMPLATE_EMAIL_RECIPIENTS_LIMIT"],inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.SELECT,
inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS,findSelectOptionFieldsFunc:function(){return postPromise("/sims/mmailer/customTemplate/mass/getRecipientFields.jsp",{a:ap,p:path,si:sheetIndex}).then(function(a){return new Promise(function(b,c){var d=JSON.parse(a);d.isSuccess?b(d.fields):c(d.errorMessage)})})}},{label:lm.mailSubject,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_NEW_USER",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.FREETEXT,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT},
{label:lm.content,help:"HELP_CUSTOM_EM_TEMPLATE_PARAMS_NEW_USER",inputType:EmailTemplateInputBuilder.prototype.INPUT_TYPE.HTML,inputTemplate:EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT}],supportedAttachTypes:[EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.RECORD_LINK,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.EXCEL,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.PDF,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAIL_MERGE,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.FILE_FIELD,
EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAGIC_RECORD_LINK_READONLY,EmailTemplateInputBuilder.prototype.ATTACH_SELECT_OPTIONS.MAGIC_RECORD_LINK_EDITABLE],supportAttachFile:!0});editModeEmailTemplateEditors.massEmail.getRootNodeId=function(){for(var a=-1,b=0;b<biffdata.biffs.length;b++){var c=biffdata.biffs[b];if(c.dataType!=HEADER&&null!=c.parentNodeId&&0<=c.parentNodeId){a=c.parentNodeId;break}}return a};
editModeEmailTemplateEditors.massEmail.findFileFields=function(){return postPromise("/sims/mmailer/customTemplate/mass/getFileFields.jsp",{a:ap,p:path,si:sheetIndex}).then(function(a){return new Promise(function(b,c){var d=JSON.parse(a);d.isSuccess?b(d.fields):c(d.errorMessage)})})};
editModeEmailTemplateEditors.massEmail.renderButtons=function(a){var b=this,c=function(a){var c="",d="",e="",f="";b.inputBuilders.forEach(function(b){var g=b.getCustTemplate();switch(b.inputTemplate){case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.REPLAY_TO:c=g;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.RECIPIENTS:d=a?g:user;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.SUBJECT:e=g;break;case EmailTemplateInputBuilder.prototype.INPUT_TEMPLATE.CONTENT:f=g}});
var g={a:ap,p:path,si:sheetIndex,replyTo:c,recipients:d,subject:e,content:f,realSend:a},r=b.attachSelectCombo.getSelectedValues(),p;for(p in r)if("attMM"==p||"attField"==p)0!=r[p].length&&(g[p]=JSON.stringify(r[p]));else if("attPdf"===p){g[p]=r[p];var t=b.attachSelectCombo.getPdfDownloadParams();(t=t.pdfDownloadParams)&&(g.pdfDownloadParams=JSON.stringify(t))}else g[p]=r[p];r=b.attachFileUploader.getUploadedFiles();g.attFile=JSON.stringify(r);d&&0<d.trim().length?postPromise("/sims/mmailer/customTemplate/mass/sendMassEmail.jsp",
g).then(function(b){b=JSON.parse(b);b.isSuccess?(a&&floatWinClose(),updateSystemTaskProgress()):console.error(b.errorMessage)}):window.alert(lm.recipients+" is empty")},d=node("div");d.style.display="table-cell";var e=node("div");e.classList.add("topButtonWhole");e.classList.add("topButtonBlue");e.style.padding="5px 35px";e.style.margin="8px 8px 8px 0px";e.innerHTML=lm.massSend;e.onclick=function(){c(!0)};d.appendChild(e);e=node("div");e.classList.add("topButtonWhole");e.style.padding="5px 35px";
e.style.margin="8px 8px 8px 0px";e.innerHTML=lm.testSend;e.onclick=function(){c(!1)};d.appendChild(e);owner&&(e=node("a"),e.setAttribute("href","javascript:void(0)"),e.style.position="relative",e.style.top="19px",delete e.style.color,e.appendChild(document.createTextNode(lm.customEmail_sendEntry_save)),e.onclick=function(){b.save()},d.appendChild(e));e=node("div");e.style.display="table-cell";var f=node("div");f.style.display="table-row";f.appendChild(e);f.appendChild(d);a.appendChild(f)};
function EmailTemplateFileUploader(){var a=this;this.container=node("div");this.uploader=this.createUploader();var b=node("div");b.style.display="inline-block";b.style.width="110px";b.style.verticalAlign="top";b.style.position="relative";b.style.top="9px";b.appendChild(document.createTextNode(lm.attachFile));var c=node("a");c.classList.add("tooltipQ");c.style.float="none";c.onclick=function(){showSingleTooltip(this,"customEmail_attachFileDesc",!0)};var d=node("i");d.classList.add("fas");d.classList.add("fa-question");
c.appendChild(d);b.appendChild(c);this.container.appendChild(b);this.uploadedFiles={};this.uploadedFiles.files={};b=node("div");b.classList.add("multiComboSelectedDiv");b.classList.add("emailTemplateUploaderFileButton");b.innerHTML="&nbsp;";this.uploadedFiles.buttonContainer=b;b.onclick=function(){a.uploadFile()};c=node("div");c.classList.add("multiComboBox");c.appendChild(b);this.container.appendChild(c)}EmailTemplateFileUploader.prototype.MAX_TOTAL_FILE_SIZE=10485760;
EmailTemplateFileUploader.prototype.render=function(a){a&&a.appendChild(this.container)};
EmailTemplateFileUploader.prototype.createUploader=function(){var a=this,b=node("input");b.setAttribute("type","file");b.setAttribute("name","att");b.onchange=function(){if(b.files&&0<b.files.length)if(a.isUploadFileDuplicated(b.files[0].name))console.warn("Duplicated file");else if(a.getTotalFileSize()+b.files[0].size>a.MAX_TOTAL_FILE_SIZE)window.alert(getBundleString("customEmail_attachFileError_totalFileSizeOverLimit",[""])),a.uploader=a.createUploader();else{var c=new FormData;c.append("a",ap);
c.append("att",b.files[0]);postFormDataPromise("/sims/mmailer/customTemplate/uploadEmailTemplateAttachment.jsp",c).then(function(b){b=JSON.parse(b);b.isSuccess?(b=b.att)&&b.fileName&&b.displayFileName&&null!=b.fileSize?a.addUploadedFile(b):(console.error("Get uploadedFile failed"),a.uploader=a.createUploader()):(window.alert(b.errorMessage),a.uploader=a.createUploader())})}};return b};
EmailTemplateFileUploader.prototype.addUploadedFile=function(a){var b=this;this.uploadedFiles.files[a.displayFileName]=a;var c=node("div");c.classList.add("multiComboValue");c.appendChild(document.createTextNode(a.displayFileName));c.onclick=function(c){cancelEventBubble(c);b.removeUploadedFile(a.displayFileName,this)};this.uploadedFiles.buttonContainer.appendChild(c)};
EmailTemplateFileUploader.prototype.removeUploadedFile=function(a,b){delete this.uploadedFiles.files[a];this.uploadedFiles.buttonContainer.removeChild(b);this.uploader.files&&0<this.uploader.files.length&&this.uploader.files[0].name==a&&(this.uploader=this.createUploader())};EmailTemplateFileUploader.prototype.getUploadedFiles=function(){var a=this,b=[];Object.keys(a.uploadedFiles.files).forEach(function(c){b.push(a.uploadedFiles.files[c].fileName)});return b};
EmailTemplateFileUploader.prototype.isUploadFileDuplicated=function(a){return null!=this.uploadedFiles.files[a]};EmailTemplateFileUploader.prototype.uploadFile=function(){this.uploader.click()};EmailTemplateFileUploader.prototype.reset=function(){this.uploadedFiles.files={};rm(this.uploadedFiles.buttonContainer);this.uploadedFiles.buttonContainer.innerHTML="&nbsp;";this.uploader=this.createUploader()};
EmailTemplateFileUploader.prototype.getTotalFileSize=function(){var a=this,b=0;Object.keys(a.uploadedFiles.files).forEach(function(c){b+=a.uploadedFiles.files[c].fileSize});return b};function getMaxActionButtonSeq(){var a=0,b;for(b in builder.actionButtons){var c=builder.actionButtons[b];c.seq>a&&(a=c.seq)}return parseInt(a)}
function copyRecordSettingEdit(a,b,c){c="_RAGIC_AUTOGEN_CR_"+c;var d=retrieveBetweenLines(builder.sheetScope,"function "+c+"(nodeId){","}//END"+c);d||alert("Your workflow script is invalid, please contact support@ragic.com to help you restore it.");c=convertWorkflowToCopyRecordJSON_v2(d);var e=c.NEW_PATH,f=null;if(e){f={result:[]};for(var g in c.COPY)f.result.push({cf:c.COPY[g],ct:g});g={result:[]};if(c.SUBTABLE_FILTERS)for(l in c.SUBTABLE_FILTERS)g.result.push({convertRec_subtableFilterDomainId:l,
convertRec_subtableFilterValues:c.SUBTABLE_FILTERS[l]});else g.result.push({convertRec_subtableFilterDomainId:"",convertRec_subtableFilterValues:""});var k={result:[]};c.SUBTABLE_GROUPING_FIELDS?c.SUBTABLE_GROUPING_FIELDS.forEach(function(a){k.result.push({convertRec_subtableGroupingFields:a})}):k.result.push({convertRec_subtableGroupingFields:""});var l=e.split("/");e={};e.checkMust=c.hasOwnProperty("CHECK_MUST_FIELDS")?JSON.parse(c.CHECK_MUST_FIELDS):!1;e.checkValidation=c.hasOwnProperty("CHECK_VALIDATION_FIELDS")?
JSON.parse(c.CHECK_VALIDATION_FIELDS):!1;e.checkAllMustFieldsMapped=c.hasOwnProperty("CHECK_ALL_MUST_FIELDS_MAPPED")?JSON.parse(c.CHECK_ALL_MUST_FIELDS_MAPPED):!1;e.silent=c.hasOwnProperty("SILENT")?JSON.parse(c.SILENT):!1;e.recalculate=c.hasOwnProperty("RECAL_ALL_FORMULAS")?JSON.parse(c.RECAL_ALL_FORMULAS):!0;e.executeWorkflow=c.hasOwnProperty("EXEC_WORKFLOW")?JSON.parse(c.EXEC_WORKFLOW):!0;e.applySubtableFilters=c.hasOwnProperty("APPLY_SUBTABLE_FILTERS")?JSON.parse(c.APPLY_SUBTABLE_FILTERS):!1;
e.applySubtableGrouping=c.hasOwnProperty("APPLY_SUBTABLE_GROUPING")?JSON.parse(c.APPLY_SUBTABLE_GROUPING):!1;e.convertEmptyGroupingValues=c.hasOwnProperty("CONVERT_EMPTY_SUBTABLE_GROUPING_VALUES")?JSON.parse(c.CONVERT_EMPTY_SUBTABLE_GROUPING_VALUES):!1;e.subtableFilterActionBuilderResult=g;e.subtableGroupingActionBuilderResult=k;e.lockSource=c.hasOwnProperty("LOCK_SOURCE")?JSON.parse(c.LOCK_SOURCE):!1;copyRecordSetting(a,"/"+l[1],l[2],f,b,"none",e)}else f=convertWorkflowToCopyRecordJSON(d),e=getAutogenWFAttribute(d,
"NEW_PATH"),l=e.split("/"),copyRecordSetting(a,"/"+l[1],l[2],f,b,"none")}function getAutogenWFAttribute(a,b){a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];d=d.trim();if(d.startsWith(b+":"))return d.substring(b.length+2,d.length-2)}return null}function convertWorkflowToCopyRecordJSON(a){a=a.split("\n");for(var b={result:[]},c=0;c<a.length;c++){var d=a[c];d=d.trim();if(d.endsWith(ctrl.RAGIC_AUTOGEN_MAPPING_HINT)){var e=d.substr(8,7);d=d.substr(0,7);b.result.push({cf:e,ct:d})}}return b}
function convertWorkflowToCopyRecordJSON_v2(a){a=a.replace(/nodeId/g,'"${NODEID}"').split("\n");var b={},c;for(c in a)try{b=JSON.parse(a[c]);break}catch(d){}return b}
function copyRecordSetting(a,b,c,d,e,f,g){a&&(a.cancelBubble=!0);clearDropWin();g=g||{};g.a=ap;g.p=path;g.si=sheetIndex;b&&c?(g.tp=b,g.tsi=c,e&&(g.bseq=e),f&&(g.advDisp=f),postPromise("/sims/copyRecordSetting.jsp",g).then(function(a){floatWin(null,a,null,!0);return Promise.resolve()}).then(function(){ctrl.copyRecordActionBuilder.config.items[0].optionPath=path;ctrl.copyRecordActionBuilder.config.items[0].optionSheetIndex=sheetIndex;ctrl.copyRecordActionBuilder.config.items[1].optionPath=b;ctrl.copyRecordActionBuilder.config.items[1].optionSheetIndex=
c;d=d||{result:[{cf:"",ct:""}]};ctrl.copyRecordActionBuilder.loadResult(d);ctrl.copyRecordActionBuilder.renderActionBuilder($("copyRecordSettingDiv"));ctrl.copyRecordSubtableFilterActionBuilder.config.items[0].optionPath=path;ctrl.copyRecordSubtableFilterActionBuilder.config.items[0].optionSheetIndex=sheetIndex;ctrl.copyRecordSubtableFilterActionBuilder.loadResult(g.subtableFilterActionBuilderResult?g.subtableFilterActionBuilderResult:{result:[{convertRec_subtableFilterDomainId:"",convertRec_subtableFilterValues:[]}]});
ctrl.copyRecordSubtableFilterActionBuilder.renderActionBuilder($("convertRec_subtableFilterActionBuilderContainer"));ctrl.copyRecordSubtableGroupingActionBuilder.config.items[0].optionPath=path;ctrl.copyRecordSubtableGroupingActionBuilder.config.items[0].optionSheetIndex=sheetIndex;ctrl.copyRecordSubtableGroupingActionBuilder.loadResult(g.subtableGroupingActionBuilderResult?g.subtableGroupingActionBuilderResult:{result:[{convertRec_subtableGroupingFields:""}]});ctrl.copyRecordSubtableGroupingActionBuilder.renderActionBuilder($("convertRec_subtableGroupingActionsContainer"))})):
postPromise("/sims/copyRecordSetting.jsp",g).then(function(a){floatWin(null,a,null,!0);return Promise.resolve()})}function chooseCopyRecordSheet(){var a=$("copyRecordSheetSelection").options[$("copyRecordSheetSelection").selectedIndex],b=a.getAttribute("path");a=a.getAttribute("sheetIndex");var c="none";try{c=$("copyRecordAdvancedSettingDiv").style.display}catch(d){}copyRecordSetting(null,b,a,null,null,c)}
function copyRecordAdvancedDivDisp(){"none"==$("copyRecordAdvancedSettingDiv").style.display?$("copyRecordAdvancedSettingDiv").style.display="":$("copyRecordAdvancedSettingDiv").style.display="none"}
function recordCopyAutoMapping(){var a=$("copyRecordSheetSelection");if(a){var b=a.options[a.selectedIndex];a=b.getAttribute("path");b=parseInt(b.getAttribute("sheetIndex"));a&&b&&ajaxget("/sims/copyRecordAutoMapping.jsp",{ap:ap,p_from:path,si_from:sheetIndex,p_to:a,si_to:b},function(a){a=JSON.parse(a);var b=[],c;for(c in a)b.push({cf:a[c],ct:c});0<b.length&&(ctrl.copyRecordActionBuilder.loadResult({result:b}),ctrl.copyRecordActionBuilder.renderActionBuilder($("copyRecordSettingDiv")))})}}
function copyRecordSubtableFilterDisp(){"none"==$("convertRec_subtableFilterContainer").style.display?$("convertRec_subtableFilterContainer").style.display="":$("convertRec_subtableFilterContainer").style.display="none"}function copyRecordSubtableGroupingDisp(){"none"==$("convertRec_subtableGroupingContainer").style.display?$("convertRec_subtableGroupingContainer").style.display="":$("convertRec_subtableGroupingContainer").style.display="none"}
function updateRecordSetting(a,b,c){a&&(a.cancelBubble=!0);clearDropWin();a="/sims/updateRecordSetting.jsp?a="+ap+"&p="+path+"&si="+sheetIndex;var d=null;b&&b.updatePath&&b.updateSheetIndex&&(a+="&tp="+b.updatePath+"&tsi="+b.updateSheetIndex,b.updRecThisNumField&&(a+="&tf="+b.updRecThisNumField),b.updRecUpdNumField&&(a+="&uf="+b.updRecUpdNumField),b.action&&(a+="&act="+b.action),b.lastUpdField&&(a+="&lupd="+b.lastUpdField),b.buttonSeq&&(a+="&bseq="+b.buttonSeq),b.ifReverse&&(a+="&reverse="+b.ifReverse),
b.ifRecal&&(a+="&recal="+b.ifRecal),b.execInWorkflow&&(a+="&execInWorkflow="+b.execInWorkflow),b.checkUserGroups&&(a+="&checkUserGroups="+b.checkUserGroups),b.checkMust&&(a+="&checkMust="+b.checkMust),b.checkValidation&&(a+="&checkValidation="+b.checkValidation),b.advDisp&&(a+="&advDisp="+b.advDisp),b.failedIfNoRecordUpdated&&(a+="&failedIfNoRecordUpdated="+b.failedIfNoRecordUpdated),b.warnedIfNoRecordUpdated&&(a+="&warnedIfNoRecordUpdated="+b.warnedIfNoRecordUpdated),b.loadDefaultValuesOnTarget&&
(a+="&loadDefaultValuesOnTarget="+b.loadDefaultValuesOnTarget),b.loadDefaultValuesOnThisSheet&&(a+="&loadDefaultValuesOnThisSheet="+b.loadDefaultValuesOnThisSheet),d=function(){var a=$("thisSheetSelection").options[$("thisSheetSelection").selectedIndex].text,d=$("updateRecordSheetSelection").options[$("updateRecordSheetSelection").selectedIndex].text;ctrl.updateRecordMatchActionBuilder.config.items[0].name=getBundleString("matchThisField",[a]);ctrl.updateRecordMatchActionBuilder.config.items[1].name=
getBundleString("matchUpdField",[d]);ctrl.updateRecordActionsActionBuilder.config.items[0].name=getBundleString("updRecThisNumField",[a]);ctrl.updateRecordActionsActionBuilder.config.items[2].name=getBundleString("updRecUpdNumField",[d]);c?(ctrl.updateRecordMatchActionBuilder.loadResult(c.match),ctrl.updateRecordActionsActionBuilder.loadResult(c.actions)):(ctrl.updateRecordMatchActionBuilder.loadResult({result:[{updField:"",thisField:""}]}),ctrl.updateRecordActionsActionBuilder.loadResult({result:[{updField:"",
actions:"",thisField:""}]}));a=null;try{a=JSON.parse(decodeURIComponent($("updateRecordInfo").value))}catch(l){console.log(l);return}if(a){d=ctrl.updateRecordMatchActionBuilder.config.items;for(var g in d){d[g].options=a[d[g].id].options;d[g].optionValues=a[d[g].id].optionValues;var k=[];d[g].optionValues.forEach(function(a){k.push(lm.externalId+": "+a)});d[g].optionTitles=k}d=ctrl.updateRecordActionsActionBuilder.config.items;for(g in d)d[g].options=a[d[g].id].options,d[g].optionValues=a[d[g].id].optionValues,
"actions"!=d[g].id&&(k=[],d[g].optionValues.forEach(function(a){k.push(lm.externalId+": "+a)}),d[g].optionTitles=k);ctrl.updateRecordActionsActionBuilder.result.result.some(function(a){return"SET"==a.actions})&&($("updateRecordCreateReverseButton").checked=!1,$("updateRecordCreateReverseButtonDiv").style.display="none")}ctrl.updateRecordMatchActionBuilder.renderActionBuilder($("updateRecordMatchDiv"));ctrl.updateRecordActionsActionBuilder.renderActionBuilder($("updateRecordActionsDiv"));b&&b.lastUpdField&&
($("lastUpdField").value=b.lastUpdField)});EUSelector.showUrl(a,d)}
function chooseUpdateRecordSheet(){var a=$("updateRecordSheetSelection"),b=$("updRecThisNumFieldSelect"),c=$("updRecUpdNumFieldSelect"),d=$("actionSelect"),e=$("lastUpdSelect"),f=$("updateRecordCreateReverseButton"),g=$("updateRecordRecal"),k=$("updRecFailedIfNoRecordUpdated"),l=$("updRecWarnedIfNoRecordUpdated"),m=$("updateRecordLoadDefaultValuesOnTarget"),n=$("updateRecordAdvancedDiv"),q=a.options[a.selectedIndex];a=q.getAttribute("path");q=q.getAttribute("sheetIndex");var r=null;b&&(r=b.options[b.selectedIndex].getAttribute("field"));
b=null;c&&(b=c.options[c.selectedIndex].getAttribute("field"));c=null;d&&(c=d.options[d.selectedIndex].getAttribute("act"));d=null;e&&(d=d.options[d.selectedIndex].getAttribute("field"));e=!0;f&&(e=f.checked);f=!1;g&&(f=g.checked);g=!1;k&&(g=k.checked);k=!0;null!=l&&(k=l.checked);l=!1;m&&(l=m.checked);m="none";n&&(m=n.style.display);updateRecordSetting(null,{updatePath:a,updateSheetIndex:q,updRecThisNumField:r,updRecUpdNumField:b,action:c,lastUpdField:d,ifReverse:e,ifRecal:f,failedIfNoRecordUpdated:g,
warnedIfNoRecordUpdated:k,loadDefaultValuesOnTarget:l,advDisp:m},null)}function updateRecordAdvancedDivDisp(){var a=$("updateRecordAdvancedDiv");a.style.display="none"==a.style.display?"":"none"}function updateRecordExecuteInWorkflowChecked(){$("updateRecordExecuteInWorkflow").checked&&($("updateRecordCreateReverseButton").checked=!0)}
function autoCreateNewCellData(a,b,c){var d=function(){function a(a,b){for(var c=0;c<a.length;c++)a[c].y>b&&(b=a[c].y);return b}var b=0;b=a(Object.values(builder.cellData),b);return b=a(Object.values(builder.freeData),b)}()+4;a||(a="RAGIC_AUTOGEN_"+(new Date).getTime());builder.setField(1,d,a);if(b)for(var e in b)builder.cellData["1,"+d].attr[e]=b[e];saveBuilder();if(c){var f=function(){builder.cellData["1,"+d].domainId?c&&c("1,"+d):window.setTimeout(f,1E3)};f()}}
function saveUpdateRecordSetting(a){$("lastUpdField").value?actionButtonGenerator.createUpdateValuesOnAnotherSheet(a):autoCreateNewCellData(null,{fmt_d:"yyyy/MM/dd HH:mm",ro:!0,utcTime:"true"},function(b){$("lastUpdField").value=builder.cellData[b].domainId;actionButtonGenerator.createUpdateValuesOnAnotherSheet(a)})}
function updateRecordSettingEdit(a,b,c){c="_RAGIC_AUTOGEN_ENTRY_UPDATER_"+c;var d=retrieveBetweenLines(builder.sheetScope,"function "+c+"(nodeId","}//END"+c);d||alert("Your workflow script is invalid, please contact support@ragic.com to help you restore it.");d=convertWorkflowToUpdateRecordJSON(d);var e=d.UPDATE_PATH.split("/"),f={match:{result:[]},actions:{result:[]}};for(k in d.MATCH)f.match.result.push({updField:k,thisField:d.MATCH[k]});if(d.MULTI_FIELDS)for(var g=0;g<d.ACTIONS.length;g++)f.actions.result.push({thisField:d.ACTIONS[g].THIS_NUMBER_FIELD,
actions:d.ACTIONS[g].UPDATE_ACTION,updField:d.ACTIONS[g].UPDATE_NUMBER_FIELD});else f.actions.result.push({thisField:d.THIS_NUMBER_FIELD,actions:d.UPDATE_ACTION,updField:d.UPDATE_NUMBER_FIELD});var k=!1;for(g in builder.actionButtons)if(builder.actionButtons[g].action.startsWith(c+"_REVERSE")){k=!0;break}var l=!1,m=builder.preworkflow.split("\n");for(g=0;g<m.length;g++)if(m[g].startsWith(c)){l=!0;break}if(!l)for(m=builder.postworkflow.split("\n"),g=0;g<m.length;g++)if(m[g].startsWith(c)){l=!0;break}updateRecordSetting(a,
{updatePath:"/"+e[1],updateSheetIndex:e[2],lastUpdField:d.LAST_UPDATE_FIELD,ifReverse:k,ifRecal:!!d.RECALCULATE,advDisp:"none",buttonSeq:b,execInWorkflow:l,checkUserGroups:!!d.CHECK_USER_GROUPS,checkMust:!!d.CHECK_MUST_FIELDS,checkValidation:!!d.CHECK_VALIDATION_FIELDS,failedIfNoRecordUpdated:!!d.FAILED_IF_NO_RECORD_UPDATED,warnedIfNoRecordUpdated:void 0===d.WARNED_IF_NO_RECORD_UPDATED?!0:!!d.WARNED_IF_NO_RECORD_UPDATED,loadDefaultValuesOnTarget:!!d.LOAD_DEFAULT_VALUES_ON_TARGET,loadDefaultValuesOnThisSheet:!!d.LOAD_DEFAULT_VALUES_ON_THIS_SHEET},
f)}function convertWorkflowToUpdateRecordJSON(a){a=a.replace(/nodeId/g,'"${NODEID}"').split("\n");var b={},c;for(c in a)try{b=JSON.parse(a[c]);break}catch(d){}return b}
function updateFieldSetting(a,b,c){a&&(a.cancelBubble=!0);clearDropWin();b=b||{};b.a=ap;b.p=path;b.si=sheetIndex;c=c||{result:[{field:"",value:""}]};postPromise("/sims/updateFieldSetting.jsp",b).then(function(a){floatWin(null,a,null,!0);return Promise.resolve()}).then(function(){ctrl.updateFieldsActionBuilder.config.items[0].optionPath=path;ctrl.updateFieldsActionBuilder.config.items[0].optionSheetIndex=sheetIndex;ctrl.updateFieldsActionBuilder.loadResult(c);ctrl.updateFieldsActionBuilder.renderActionBuilder($("updateFieldSettingDiv"));
ctrl.copyRecordSubtableFilterActionBuilder.config.items[0].optionPath=path;ctrl.copyRecordSubtableFilterActionBuilder.config.items[0].optionSheetIndex=sheetIndex;ctrl.copyRecordSubtableFilterActionBuilder.loadResult(b.subtableFilterActionBuilderResult?b.subtableFilterActionBuilderResult:{result:[{convertRec_subtableFilterDomainId:"",convertRec_subtableFilterValues:[]}]});ctrl.copyRecordSubtableFilterActionBuilder.renderActionBuilder($("fieldUpdater_subtableFilterActionBuilderContainer"))})}
function updateFieldSettingEdit(a,b,c){c="_RAGIC_AUTOGEN_FIELD_UPDATER_"+c;(c=retrieveBetweenLines(builder.sheetScope,"function "+c+"(nodeId","}//END"+c))||alert("Your workflow script is invalid, please contact support@ragic.com to help you restore it.");c=convertWorkflowToUpdateRecordJSON(c);var d={result:[]};for(e in c.UPD_FIELDS)d.result.push({field:e,value:c.UPD_FIELDS[e]});b={buttonSeq:b};b.subtableUpdatePolicy=c.hasOwnProperty("SUBTABLE_UPDATE_POLICY")?c.SUBTABLE_UPDATE_POLICY:"UPDATE_NO_CREATE";
b.recalculate=c.hasOwnProperty("RECALCULATE")?c.RECALCULATE:!1;b.checkValidation_updatedFields=c.hasOwnProperty("CHECK_VA_UPDATED_FIELDS")?c.CHECK_VA_UPDATED_FIELDS:!1;b.checkValidation_allFields=c.hasOwnProperty("CHECK_VA_ALL_FIELDS")?c.CHECK_VA_ALL_FIELDS:!1;b.checkMust=c.hasOwnProperty("CHECK_MUST_FIELDS")?c.CHECK_MUST_FIELDS:!1;var e={result:[]};if(c.SUBTABLE_FILTERS)for(var f in c.SUBTABLE_FILTERS)e.result.push({convertRec_subtableFilterDomainId:f,convertRec_subtableFilterValues:c.SUBTABLE_FILTERS[f]});
else e.result.push({convertRec_subtableFilterDomainId:"",convertRec_subtableFilterValues:""});b.subtableFilterActionBuilderResult=e;b.applySubtableFilters=c.hasOwnProperty("APPLY_SUBTABLE_FILTERS")?JSON.parse(c.APPLY_SUBTABLE_FILTERS):!1;updateFieldSetting(a,b,d)}function updateFieldAdvancedDivDisp(){var a=$("updateFieldAdvancedDiv");a&&(a.style.display="none"==a.style.display?"":"none")}
function fieldUpdaterApplySubtableFilterDisp(){$("fieldUpdater_subtableUpdatePolicy_updateNoCreate").checked?$("fieldUpdater_subtableFilters").style.display="":$("fieldUpdater_subtableFilters").style.display="none"}function fieldUpdaterSubtableFilterDisp(){"none"==$("fieldUpdater_subtableFilterContainer").style.display?$("fieldUpdater_subtableFilterContainer").style.display="":$("fieldUpdater_subtableFilterContainer").style.display="none"}
function setMergedActionButton(a){var b={a:ap,p:path,si:sheetIndex};if(a){b.buttonSeq=a;if(!builder.actionButtons[a])throw Error("builder.actionButtons["+a+"] not exists");a=builder.actionButtons[a].action.split("(")[0];a=retrieveBetweenLines(builder.sheetScope,"function "+a+"(nodeId","}//END"+a).trim().replace(/nodeId/g,'"${NODEID}"').split("\n");if(2<a.length){for(var c="",d=1;d<a.length-1;d++)try{for(var e=JSON.parse(a[d]).ACTIONS,f=0;f<e.length;f++)0<c.length&&(c+=","),c+=e[f];break}catch(g){}b.mergedActions=
c}}ajaxpost("/sims/mergedActionButtonSelector.jsp",b,function(a){floatWin(null,a,null,!0,null,!1)})}function selectMergedButtons(a){var b=$("mergedActionButton_availableButtons"),c=$("mergedActionButton_selectedButtons");if(a)for(a=0;a<c.options.length;a++){var d=c.options[a];d.selected&&(d.selected=!1,c.removeChild(d),a--,b.appendChild(d))}else for(a=0;a<b.options.length;a++)d=b.options[a],d.selected&&(d.selected=!1,b.removeChild(d),a--,c.appendChild(d))}
function moveMergedButtons(a){var b=$("mergedActionButton_selectedButtons"),c=[];if(a)for(a=b.options.length-1;0<=a;a--){var d=b.options[a];if(d.selected&&!c.includes(d)){if(a>=b.options.length-1)break;b.insertBefore(b.options[a+1],b.options[a]);c.push(d)}}else for(a=0;a<b.options.length;a++)if(d=b.options[a],d.selected&&!c.includes(d)){if(0>=a)break;b.insertBefore(b.options[a],b.options[a-1]);c.push(d)}}
function actionButtonTypeSelect(){var a=$("at_actionUrl"),b=$("at_actionType");b.value.startsWith("T")?(a.value=b.value.substr(2),a.readOnly=!0,a.classList.add("actionLock")):(a.readOnly=!1,a.classList.remove("actionLock"))}
var actionButtonGenerator=function(){var a={debugMode:!1},b=function(b,c){a.debugMode&&(c?console.log(b,c):console.log(b))},c=function(a,c,d,e,f,g,k){if(mode!=BUILDER)console.error("Cannot create button in non-builder mode.");else if(a&&c&&d&&e&&f&&g){var l={functionType:g};k&&(l.buttonSeq=k);return(new Promise(function(a,b){a(l)})).then(function(c){b("Step 1. Check action params");b("infoObj=",c);return a(c)}).then(function(a){b("Step 2. Delete old script");b("infoObj=",a);return d(a)}).then(function(a){b("Step 3. Generator 5-digit random number");
b("infoObj=",a);return new Promise(function(b,c){for(c=genRandom(5);;){var d=!1,e;for(e in builder.actionButtons){var f=builder.actionButtons[e];if(f.action&&f.action.startsWith("_RAGIC_AUTOGEN_")&&getButtonSeqAction(e).endsWith(c)){d=!0;c=genRandom(5);break}}if(!d)break}a.randomFunctionString=c;b(a)})}).then(function(a){b("Step 4. Create button");b("infoObj=",a);return c(a)}).then(function(a){b("Step 5. Generate script");b("infoObj=",a);return e(a)}).then(function(a){b("Step 6. Update sheetScope");
b("infoObj=",a);return new Promise(function(b,c){c=a.oldFuncName;var d=a.randomFunctionString;builder.sheetScope+=a.script;if(c){d="_RAGIC_AUTOGEN_"+g+"_"+d;for(var e in builder.actionButtons)try{var f=getButtonSeqAction(e);if(f.startsWith("_RAGIC_AUTOGEN_MERGED_BUTTON")){var k=retrieveBetweenLines(builder.sheetScope,"function "+f+"(nodeId","}//END"+f);k&&-1!=k.indexOf(c)&&(k=k.replace(new RegExp(c,"g"),d),builder.sheetScope=deleteBetweenLines(builder.sheetScope,"function "+f+"(nodeId","}//END"+f)+
k)}}catch(C){console.error("Update merged buttons error: "+C)}}b(a)})}).then(function(a){b("Step 7. Finishing works");b("infoObj=",a);builderHelperPanelSwitch(3);return getPromise("/sims/t_actionButtons.jsp",{a:ap}).then(function(b){$("designerInfoContent").innerHTML=b;getActionButtons();return new Promise(function(b,c){b(a)})})}).then(function(a){b("Step 8. Display finishing msg");b("infoObj=",a);return f(a)}).catch(function(a){b("Error: "+a);a&&window.alert(a);return Promise.reject(a)})}},d=function(a){return new Promise(function(b,
c){var d=a.randomFunctionString,e=a.buttonSeq,f=a.functionType;if(e)builder.actionButtons[e].action="_RAGIC_AUTOGEN_"+f+"_"+d+"({id});";else{e=getMaxActionButtonSeq()+1;for(var g;;){g=prompt(lm.updRecButtonNamePrompt);if(null==g){c(null);return}if(""!=g)break}c=getNextActionButtonId();d=new ActionButton(c,"B",e,g,"_RAGIC_AUTOGEN_"+f+"_"+d+"({id});");builder.actionButtons[e]=d}b(a)})},e=function(a){return new Promise(function(b,c){c=a.buttonSeq;var d=builder.sheetScope,e=null;c&&(e=getButtonSeqAction(c),
d=deleteBetweenLines(d,"function "+e+"(nodeId","}//END"+e));builder.sheetScope=d;a.oldFuncName=e;b(a)})},f={CR:"entryCopier",FIELD_UPDATER:"fieldUpdater",ENTRY_UPDATER:"entryUpdater",SEND_CUSTOM_MAIL:"sendCustomEmail",MERGED_BUTTON:"executeMergedActionButtons"};a.functionTypes=Object.keys(f);var g=function(a){return new Promise(function(b,c){c=a.functionType;var d=a.randomFunctionString;c="function _RAGIC_AUTOGEN_"+c+"_"+d+"(nodeId){\n  // WARNING: Please DO NOT edit auto-generated script.\n  var result = db."+
f[c]+"(JSON.stringify(\n    "+JSON.stringify(a.param).replace(/"\${NODEID}"/g,"nodeId")+"\n  ), response);\n}//END_RAGIC_AUTOGEN_"+c+"_"+d+"\n\n";a.script=c;b(a)})},k=function(a){a=a.split("\n");for(var b=0;b<a.length;b++)if(a[b].startsWith("_RAGIC_AUTOGEN_")){var c=a[b].split("(")[0],d=builder.actionButtons,e;for(e in d)if(d[e].action.startsWith(c+"({id})"))return d[e]}return null};a.createUpdateValuesOnAnotherSheet=function(a){return c(function(b){return(new Promise(function(c,d){var e={};e.THIS_PATH=
path+"/"+sheetIndex;var f=null;try{var g=$("updateRecordSheetSelection").options[$("updateRecordSheetSelection").selectedIndex].parentNode.getAttribute("data-selpath"),l=$("updateRecordSheetSelection").options[$("updateRecordSheetSelection").selectedIndex].getAttribute("sheetIndex");f=g+"/"+l}catch(z){d("Getting update target sheet failed.");return}if(null!=f){e.UPDATE_PATH=f;e.THIS_NODE_ID="${NODEID}";f={};g=0;try{for(var m in ctrl.updateRecordMatchActionBuilder.result.result){var n=ctrl.updateRecordMatchActionBuilder.result.result[m].updField,
q=ctrl.updateRecordMatchActionBuilder.result.result[m].thisField;if(n&&-1!=n&&q&&-1!=q){if(null!=f[n])if(f[n]==q)continue;else{var D=builder.newName,A=builder.findField(q).value,w=builder.findField(f[n]).value,F=$("updateRecordSheetSelection").options[$("updateRecordSheetSelection").selectedIndex].text;d(getBundleString("updRecFieldDuplication",[D,A,w,F]));return}f[n]=q;g++}}}catch(z){d("Getting update condition fields failed.");console.log(z);return}if(0<g){e.MATCH=f;D=[];A=0;try{for(m in ctrl.updateRecordActionsActionBuilder.result.result){n=
ctrl.updateRecordActionsActionBuilder.result.result[m].updField;q=ctrl.updateRecordActionsActionBuilder.result.result[m].thisField;var C=ctrl.updateRecordActionsActionBuilder.result.result[m].actions;n&&-1!=n&&q&&-1!=q&&-1!=C&&(D.push({THIS_NUMBER_FIELD:q,UPDATE_ACTION:C,UPDATE_NUMBER_FIELD:n}),A++)}}catch(z){d("Getting update actions failed.");console.log(z);return}if(0<A){e.ACTIONS=D;e.MULTI_FIELDS=!0;m=-1;try{m=$("lastUpdField").value}catch(z){d("Getting last update time field failed.");return}if(-1!=
m){e.LAST_UPDATE_FIELD=m;m=!1;try{m=$("updateRecordRecal").checked}catch(z){}e.RECALCULATE=m;m=!1;try{m=$("updateRecordCheckUserGroups").checked}catch(z){}e.CHECK_USER_GROUPS=m;m=!1;try{$("updRecCheckMust")&&"none"!=$("updRecCheckMust").style.display&&(m=$("updRecCheckMust").checked)}catch(z){}e.CHECK_MUST_FIELDS=m;m=!1;try{$("updRecCheckValidation")&&(m=$("updRecCheckValidation").checked)}catch(z){}e.CHECK_VALIDATION_FIELDS=m;m=!1;try{$("updRecFailedIfNoRecordUpdated")&&(m=$("updRecFailedIfNoRecordUpdated").checked)}catch(z){}e.FAILED_IF_NO_RECORD_UPDATED=
m;m=!0;try{$("updRecWarnedIfNoRecordUpdated")&&(m=$("updRecWarnedIfNoRecordUpdated").checked)}catch(z){}e.WARNED_IF_NO_RECORD_UPDATED=m;console.log("create:"+m);m=!1;try{$("updateRecordLoadDefaultValuesOnTarget")&&(m=$("updateRecordLoadDefaultValuesOnTarget").checked)}catch(z){}e.LOAD_DEFAULT_VALUES_ON_TARGET=m;m=!1;try{$("updateRecordLoadDefaultValuesOnThisSheet")&&(m=$("updateRecordLoadDefaultValuesOnThisSheet").checked)}catch(z){}e.LOAD_DEFAULT_VALUES_ON_THIS_SHEET=m;"none"!=$("updateRecordCreateReverseButtonDiv").style.display&&
$("updateRecordCreateReverseButton")&&$("updateRecordCreateReverseButton").checked&&(b.ifReverse=!0);m=!1;try{m=$("updateRecordExecuteInWorkflow").checked}catch(z){}if(m&&(n=k(builder.postworkflow),null==n&&(n=k(builder.preworkflow)),null!=n&&(!a||a!=n.seq))){d(getBundleString("updRecWorkflowActionExists",[n.name]));return}b.execInWorkflow=m;b.param=e;c(b)}else d("Last update time field not found.")}else d(lm.updRecActionsNotSelect)}else d(lm.updRecMatchNotSelect)}else d("The update target sheet is not selected.")})).then(function(a){return postPromise("/sims/updateRecordParamCheck.jsp",
{a:ap,param:JSON.stringify(a.param)}).then(function(b){return new Promise(function(c,d){var e=JSON.parse(b);0==JSON.parse(e.isSuccess)?d(e.msg):c(a)})})})},function(b){return new Promise(function(c,d){var e=b.ifReverse;d=b.execInWorkflow;var f=b.oldFuncName,g=b.randomFunctionString;if(a){var k=function(a){return!a.startsWith(f)};var l=builder.preworkflow.split("\n");builder.preworkflow=l.filter(k).join("\n");l=builder.postworkflow.split("\n");builder.postworkflow=l.filter(k).join("\n");l=builder.actionButtons[a].name;
builder.actionButtons[a].action="_RAGIC_AUTOGEN_ENTRY_UPDATER_"+g+"({id});";d&&(builder.postworkflow.endsWith("\n")||(builder.postworkflow+="\n"),builder.postworkflow+="_RAGIC_AUTOGEN_ENTRY_UPDATER_"+g+"(param.getNewNodeId("+builder.keyField+"));");if(e){e=-1;for(var m in builder.actionButtons)if(builder.actionButtons[m].action.startsWith(f+"_REVERSE")){e=m;builder.actionButtons[m].action="_RAGIC_AUTOGEN_ENTRY_UPDATER_"+g+"_REVERSE({id});";break}-1==e&&(e=parseInt(getMaxActionButtonSeq())+1,l=getNextActionButtonId(),
m=new ActionButton(l,"B",e,lm.updRecReverse+" "+builder.actionButtons[a].name,"_RAGIC_AUTOGEN_ENTRY_UPDATER_"+g+"_REVERSE({id});"),builder.actionButtons[e]=m);d&&(builder.preworkflow.endsWith("\n")||(builder.preworkflow+="\n"),builder.preworkflow+="_RAGIC_AUTOGEN_ENTRY_UPDATER_"+g+"_REVERSE(param.getNewNodeId("+builder.keyField+"));")}else for(m in builder.actionButtons)if(builder.actionButtons[m].action.startsWith(f+"_REVERSE")){delete builder.actionButtons[m];break}}else{m=getMaxActionButtonSeq()+
1;for(l=null;;){l=prompt(lm.updRecButtonNamePrompt);if(null==l)return!1;if(""!=l)break}k=getNextActionButtonId();k=new ActionButton(k,"B",m,l,"_RAGIC_AUTOGEN_ENTRY_UPDATER_"+g+"({id});");builder.actionButtons[m]=k;d&&(builder.postworkflow.endsWith("\n")||(builder.postworkflow+="\n"),builder.postworkflow+="_RAGIC_AUTOGEN_ENTRY_UPDATER_"+g+"(param.getNewNodeId("+builder.keyField+"));");e&&(e=parseInt(m)+1,m=lm.updRecReverse+" "+l,k=getNextActionButtonId(),m=new ActionButton(k,"B",e,m,"_RAGIC_AUTOGEN_ENTRY_UPDATER_"+
g+"_REVERSE({id});"),builder.actionButtons[e]=m,d&&(builder.preworkflow.endsWith("\n")||(builder.preworkflow+="\n"),builder.preworkflow+="_RAGIC_AUTOGEN_ENTRY_UPDATER_"+g+"_REVERSE(param.getNewNodeId("+builder.keyField+"));"));$("lastUpdField")&&(d=builder.findField($("lastUpdField").value))&&(d=nui._getcellV2(d.x,d.y))&&d.ip&&(d.ip.loadValue(getBundleString("updRecLastUpdFieldDefaultName",[l])),d.ip.render())}c(b)})},function(a){return new Promise(function(b,c){c=builder.sheetScope;var d=a.buttonSeq,
e=null;if(d){if(e=getButtonSeqAction(d))c=deleteBetweenLines(c,"function "+e+"(nodeId","}//END"+e),c=deleteBetweenLines(c,"function "+e+"_REVERSE(nodeId","}//END"+e);builder.sheetScope=c}a.oldFuncName=e;b(a)})},function(a){return new Promise(function(b,c){c=a.param;var d=a.functionType,e=a.randomFunctionString,f="function _RAGIC_AUTOGEN_"+d+"_"+e+"(nodeId){\n  // WARNING: Please DO NOT edit auto-generated script.\n  var result = db.entryUpdater(JSON.stringify(\n    "+JSON.stringify(c).replace(/"\${NODEID}"/g,
"nodeId")+"\n  ), response);\n}//END_RAGIC_AUTOGEN_"+d+"_"+e+"\n\n";if(a.ifReverse){for(var g=c.ACTIONS,k=0;k<g.length;k++)"ADD"==g[k].UPDATE_ACTION?g[k].UPDATE_ACTION="SUBSTRACT":"SUBSTRACT"==g[k].UPDATE_ACTION&&(g[k].UPDATE_ACTION="ADD");c.REVERSE=!0;f+="function _RAGIC_AUTOGEN_"+d+"_"+e+"_REVERSE(nodeId){\n  // WARNING: Please DO NOT edit auto-generated script.\n  var result = db.entryUpdater(JSON.stringify(\n\t\t"+JSON.stringify(c).replace(/"\${NODEID}"/g,"nodeId")+"\n  ), response);\n}//END_RAGIC_AUTOGEN_"+
d+"_"+e+"\n\n"}a.script=f;b(a)})},function(a){EUSelector.close();floatWin(null,lm.updRecSavePrompt);return Promise.resolve(a)},"ENTRY_UPDATER",a)};a.createUpdateValues=function(a){var b=function(a,b){a=builder.findField(a);if(!a)return!0;a=a.attr.va;if(!a)return!0;var c="[^ ]"==a;try{var d=new RegExp(a)}catch(t){return!1}return d.test(b)||""==b&&!c?!0:!1};return c(function(a){return(new Promise(function(c,d){var e={};e.THIS_PATH=path+"/"+sheetIndex;e.THIS_NODE_ID="${NODEID}";var f=$("fieldUpdater_recalculate");
f&&(e.RECALCULATE=f.checked);if(f=$("fieldUpdater_checkValidation_updatedFields"))e.CHECK_VA_UPDATED_FIELDS=f.checked;if(f=$("fieldUpdater_checkValidation_allFields"))e.CHECK_VA_ALL_FIELDS=f.checked;if(f=$("fieldUpdater_checkMust"))e.CHECK_MUST_FIELDS=f.checked;f=document.getElementsByName("fieldUpdater_subtableUpdatePolicy");for(var g=0;g<f.length;g++)if(f[g].checked){e.SUBTABLE_UPDATE_POLICY=f[g].value;break}if("UPDATE_NO_CREATE"==e.SUBTABLE_UPDATE_POLICY)if(e.APPLY_SUBTABLE_FILTERS=$("fieldUpdater_applySubtableFilters").checked,
e.APPLY_SUBTABLE_FILTERS){var k={},l=!1;ctrl.copyRecordSubtableFilterActionBuilder.result.result.forEach(function(a){var b=a.convertRec_subtableFilterDomainId;if(b&&(a=a.convertRec_subtableFilterValues)&&0!=a.length){var c=[];a.forEach(function(a){-1==c.indexOf(a)&&c.push(a);""===a&&(l=!0)});0!=c.length&&(k[b]=c)}});if(l&&!window.confirm(lm.convertRec_subtableFilterValues_haveEmptyValueWarning)){d(null);return}0==Object.keys(k).length?(e.APPLY_SUBTABLE_FILTERS=!1,delete e.SUBTABLE_FILTERS):e.SUBTABLE_FILTERS=
k}else delete e.SUBTABLE_FILTERS;else e.APPLY_SUBTABLE_FILTERS=!1,delete e.SUBTABLE_FILTERS;var m={},n=0,q=ctrl.updateFieldsActionBuilder.result.result,r=!1,F=/{{(.+?)}}/,C;for(C in q)if(f=q[C].field,-1!=f&&""!=f&&null!=f&&(g=builder.findField(f))){var z=null==q[C].value?"":q[C].value;if((e.CHECK_VA_UPDATED_FIELDS||e.CHECK_VA_ALL_FIELDS)&&!F.test(z)&&!b(f,z)){c=getBundleString("fieldUpdater_checkValidationError",[g.value]);g.attr.va_cust_msg&&(c=getCustomValidateErrorMessage(unformatHTMLEntities(g.attr.va_cust_msg),
g.value,z,g.attr.va,f,!0));d(c);return}if(""==z&&!r&&(r=window.confirm(lm.fieldUpdaterEmptyField),!r)){d(null);return}m[f]=z;n++}0==n?d(lm.fieldUpdaterNoFieldsSelected):(e.UPD_FIELDS=m,a.param=e,c(a))})).then(function(a){return postPromise("/sims/updateFieldParamCheck.jsp",{a:ap,param:JSON.stringify(a.param)}).then(function(b){return new Promise(function(c,d){var e=JSON.parse(b);0==JSON.parse(e.isSuccess)?d(e.msg):c(a)})})})},d,e,g,function(a){floatWin(null,lm.fieldUpdaterSavePrompt);return Promise.resolve(a)},
"FIELD_UPDATER",a)};a.createConvertRecords=function(a){return c(function(a){return(new Promise(function(b,c){var d={};d.THIS_PATH=path+"/"+sheetIndex;d.THIS_NODEID="${NODEID}";var e=$("copyRecordSheetSelection").options[$("copyRecordSheetSelection").selectedIndex];d.NEW_PATH=e.getAttribute("path")+"/"+e.getAttribute("sheetIndex");e=$("convertRec_checkMust").checked;d.CHECK_MUST_FIELDS=e;e=$("convertRec_checkValidation").checked;d.CHECK_VALIDATION_FIELDS=e;e=$("convertRec_checkAllMustFieldsMapped").checked;
d.CHECK_ALL_MUST_FIELDS_MAPPED=e;e=!$("convertRec_openConvertedRecord").checked;d.SILENT=e;e=$("convertRec_recalculateConvertedRecord").checked;d.RECAL_ALL_FORMULAS=e;e=$("convertRec_executeWorkflow").checked;d.EXEC_WORKFLOW=e;e=$("convertRec_lockSource").checked;d.LOCK_SOURCE=e;e={};var f=ctrl.copyRecordActionBuilder.result.result;for(g in f)e[f[g].ct]=f[g].cf;d.COPY=e;var g=$("convertRec_applySubtableFilters").checked;if(d.APPLY_SUBTABLE_FILTERS=g){var k={},l=!1;ctrl.copyRecordSubtableFilterActionBuilder.result.result.forEach(function(a){var b=
a.convertRec_subtableFilterDomainId;if(b&&(a=a.convertRec_subtableFilterValues)&&0!=a.length){var c=[];a.forEach(function(a){-1==c.indexOf(a)&&c.push(a);""===a&&(l=!0)});0!=c.length&&(k[b]=c)}});if(l&&!window.confirm(lm.convertRec_subtableFilterValues_haveEmptyValueWarning)){c(null);return}d.SUBTABLE_FILTERS=k}else delete d.SUBTABLE_FILTERS;c=$("convertRec_applySubtableGrouping").checked;if(d.APPLY_SUBTABLE_GROUPING=c){var m=[];ctrl.copyRecordSubtableGroupingActionBuilder.result.result.forEach(function(a){(a=
a.convertRec_subtableGroupingFields)&&-1==m.indexOf(a)&&m.push(a)});d.SUBTABLE_GROUPING_FIELDS=m;d.CONVERT_EMPTY_SUBTABLE_GROUPING_VALUES=$("convertRec_convertEmptyGroupingValues").checked}else delete d.SUBTABLE_GROUPING_FIELDS,delete d.CONVERT_EMPTY_SUBTABLE_GROUPING_VALUES;a.param=d;b(a)})).then(function(a){return postPromise("/sims/recordCopyParamCheck.jsp",{a:ap,param:JSON.stringify(a.param)}).then(function(b){return new Promise(function(c,d){var e=JSON.parse(b);0==JSON.parse(e.isSuccess)?d(e.msg):
c(a)})})})},d,e,function(a){return new Promise(function(b,c){c=a.functionType;var d=a.randomFunctionString;c="function _RAGIC_AUTOGEN_"+c+"_"+d+"(nodeId){\n  // WARNING: Please DO NOT edit auto-generated script.\n  var result = db.entryCopier(JSON.stringify(\n    "+JSON.stringify(a.param).replace(/"\${NODEID}"/g,"nodeId")+"\n  ), response);\n  if(result) return result;\n}//END_RAGIC_AUTOGEN_"+c+"_"+d+"\n\n";a.script=c;b(a)})},function(a){floatWin(null,lm.convertRec_savedPrompt);return Promise.resolve(a)},
"CR",a)};a.createSendCustomEmail=function(a,b,d){return c(function(c){return new Promise(function(e,f){var g={};g.THIS_PATH=path+"/"+sheetIndex;g.THIS_NODE_ID="${NODEID}";g.type=d;g.key=b?b:getMaxActionButtonSeq()+1;var l=!1;try{l=$("sendCustomEmail_executeInWorkflow").checked}catch(x){}if(l){var m=k(builder.postworkflow);null==m&&(m=k(builder.preworkflow));if(null!=m&&(!a||a!=m.seq)){f(getBundleString("updRecWorkflowActionExists",[m.name]));return}}c.execInWorkflow=l;f=!1;try{f=$("sendCustomEmail_asyncSend").checked}catch(x){}g.asyncSend=
f;c.param=g;e(c)})},function(a){return new Promise(function(b,c){var d=a.oldFuncName,e=a.randomFunctionString,f=a.buttonSeq,g=a.functionType,k=a.execInWorkflow;if(f)c=builder.postworkflow.split("\n"),builder.postworkflow=c.filter(function(a){return!a.startsWith(d)}).join("\n"),builder.actionButtons[f].action="_RAGIC_AUTOGEN_"+g+"_"+e+"({id});";else{f=getMaxActionButtonSeq()+1;for(var l=null;;){l=prompt(lm.updRecButtonNamePrompt);if(null==l){c(null);return}if(""!=l)break}c=getNextActionButtonId();
c=new ActionButton(c,"B",f,l,"_RAGIC_AUTOGEN_"+g+"_"+e+"({id});");builder.actionButtons[f]=c}k&&(builder.postworkflow.endsWith("\n")||(builder.postworkflow+="\n"),builder.postworkflow+="_RAGIC_AUTOGEN_"+g+"_"+e+"(param.getNewNodeId("+builder.keyField+"));");b(a)})},e,g,function(a){floatWin(null,lm.sendCustomEmailButton_recipients_saved,null,!1,null,!1);return Promise.resolve(a)},"SEND_CUSTOM_MAIL",a)};a.createMergedActionButton=function(a){return c(function(a){return new Promise(function(b,c){var d=
{THIS_NODE_ID:"${NODEID}",THIS_PATH:path,THIS_SHEETINDEX:sheetIndex},e=$("mergedActionButton_selectedButtons").options;if(1<e.length){c=[];for(var f=0;f<e.length;f++)c.push(e[f].value);d.ACTIONS=c;a.param=d;b(a)}else c(lm.combineButtons_noButtonSelected)})},d,e,g,function(a){floatWin(null,lm.combineButtons_savedPrompt);return Promise.resolve(a)},"MERGED_BUTTON",a)};return a}();
function isRagicAutoGeneratedActionButtonScript(a){return(new RegExp("^_RAGIC_AUTOGEN_("+actionButtonGenerator.functionTypes.join("|")+")_\\d+(_REVERSE)?$")).test(a)}
function validateAll(){for(var a=new ValidateErrors,b=0;b<biffdata.biffs.length;b++){var c=biffdata.biffs[b],d=c.ip;if(d){var e=d.cell;ifValidateChangeBG()&&(e.style.backgroundColor="");var f=c.hasAttribute("hide");if(e.classList.contains("hide")&&!f)continue}e=biffdata.ifSubtableBiff(c);c.hasAttribute("noDup")&&!c.attr.ag&&c.ip&&c.ip.validate&&e&&(a=_checkSubtable(c,a,_checkSubtableDuplicated));!biffdata.ifListingPage()&&e&&c.attr&&c.attr.subNoDup&&!c.attr.ag&&c.ip&&c.ip.validate&&(a=_checkSubtable(c,
a,_checkSubtableDuplicated));c.attr&&c.attr.must&&d&&d.validate&&(a=e?_checkSubtable(c,a,_checkEmpty):_checkEmpty(c,a));d&&d.validate&&c.attr&&c.attr.va&&(a=e?_checkSubtable(c,a,_checkFormat):_checkFormat(c,a));c.ip&&c.ip.validate&&c.attr&&c.attr.email&&(a=e?_checkSubtable(c,a,_checkEmail):_checkEmail(c,a));d&&d.validate&&(c=d.cell.dataset.backgroundColor?d.cell.dataset.backgroundColor:"",d.cell.style.backgroundColor=a.flag?"#FFCCCC":c);a.flag=!1}return a}
function ifValidateChangeBG(){return!biffdata.autoSave}function _checkSubtable(a,b,c){_isSubtableBiffNeedCheck(a)&&(b=c(a,b,!0));return b}
function _isSubtableBiffNeedCheck(a){var b=!1;try{b=JSON.parse(a.attr.must)}catch(l){}var c=a.hasAttribute("va")&&"[^ ]"===a.attr.va;if(!b&&!c&&!a.value)return!1;if((b||c)&&0<=a.parentNodeId)return!0;for(var d=biffdata.biffs,e=!1,f=0;f<d.length;f++){var g=d[f];if("F"!==g.IPType&&g.parentDomainId===a.parentDomainId&&g.y===a.y){var k=null==g.attr.dv||0>g.attr.dv.indexOf("$")&&g.value!=g.attr.dv;if(g.value&&""!=g.value&&(null==g.attr||(b||c)&&g.value!==g.attr.ag||g.attr&&k&&g.value!=g.attr.ag&&null==
g.attr.ro&&null==g.attr.f&&null==g.attr.dv&&null==g.attr.dv_f)){e=!0;break}}}return e}function _checkSubtableDuplicated(a,b){for(var c=biffdata.findBiff(a.domainId),d=0;d<c.length;d++)if(_isSubtableBiffNeedCheck(c[d])&&a.y!==c[d].y&&a.value===c[d].value){b.addErrorField(a.domainId,"subtableValueDuplication_validate_all","subtableValueDuplication_validate_all",a.value,a.x,a.y,!0);b.flag=!0;break}return b}
function _checkEmpty(a,b,c){if(a.value)return b;b.flag=!0;c?b.addErrorField(a.domainId,"subtableMustValueEmpty_validate_all","subtableMustValueEmpty_validate_all",a.ip.value,a.x,a.y):b.addErrorField(a.domainId,"mustValueEmpty_validate_all","mustValueEmpty_validate_all",a.ip.value,a.x,a.y);return b}
function _checkFormat(a,b,c){0<=a.ip.validate(!0).indexOf("FormatError")&&(b.flag=!0,ifValidateChangeBG()&&(a.ip.cell.style.backgroundColor="#FFCCCC"),a.attr.va_cust_msg?b.addErrorField(a.domainId,"valueFormatIncorrect_validate_all",a.attr.va_cust_msg,a.ip.value,a.x,a.y):c?b.addErrorField(a.domainId,"subtableValueFormatIncorrect_validate_all","subtableValueFormatIncorrect_validate_all",a.ip.value,a.x,a.y):b.addErrorField(a.domainId,"valueFormatIncorrect_validate_all","valueFormatIncorrect_validate_all",
a.ip.value,a.x,a.y));return b}function _checkEmail(a,b,c){validateEmail(a.ip.value,a.ip)||(b.flag=!0,c?b.addErrorField(a.domainId,"subtableEmailFormatIncorrect_validate_all","subtableEmailFormatIncorrect_validate_all",a.ip.value,a.x,a.y):b.addErrorField(a.domainId,"emailFormatIncorrect_validate_all","emailFormatIncorrect_validate_all",a.ip.value,a.x,a.y));return b}
function getCustomValidateErrorMessage(a,b,c,d,e,f){a=f?a:formatHTMLEntities(a);a=a.replace(/\{\{fieldName\}\}/g,f?b:" <b>"+b+"</b> ").replace(/\{\{fieldValue\}\}/g,f?c:" <b>"+c+"</b> ").replace(/\{\{fieldFormat\}\}/g,f?d:" <b>"+d+"</b> ").replace(/\{\{fieldId\}\}/g,f?e:" <b>"+e+"</b> ");a=f?a.replace(/&#10;/g,"<br/>"):a;return RagicBBCodeParser.processToHTML(a)}function ValidateErrors(){this.errorFields={};this.flag=!1}
ValidateErrors.prototype.addErrorField=function(a,b,c,d,e,f,g){null==this.errorFields[a]&&(this.errorFields[a]={});null==this.errorFields[a][b]&&(this.errorFields[a][b]=new ValidateError(c,a));this.errorFields[a][b].addErrorValue(a,e,f,d,g)};ValidateErrors.prototype.toString=function(){return Object.values(this.errorFields).reduce(function(a,b){return a.concat(Object.values(b))},[]).reduce(function(a,b){return a+b+"<br/>"},"")};
function ValidateError(a,b){this.fieldId=b;this.errBundle=a;this.errValues={}}ValidateError.prototype.addErrorValue=function(a,b,c,d,e){if(e)for(var f in this.errValues)if(f.startsWith(a+","+b)&&this.errValues[f]===d)return;this.errValues[a+","+b+","+c]=d};
ValidateError.prototype.toString=function(){var a=[];for(b in this.errValues)a.push(this.errValues[b]);var b=biffdata.findHeader(this.fieldId);var c=getBundleString(this.errBundle,[b.value,a,b.attr.va]);c==this.errBundle&&(c=getCustomValidateErrorMessage(this.errBundle,b.value,a,b.attr.va,b.domainId));return c};
var CustThemeHelper=function(){var a={PREFIX_THEME_HEADER:"_ragic_theme_header_",PREFIX_THEME_VALUE:"_ragic_theme_value_",PREFIX_THEME_LOCKED:"_ragic_theme_locked_",PREFIX_THEME_FOCUS:"_ragic_theme_focus_",PREFIX_THEME_FREETEXT:"_ragic_theme_freetext_",PREFIX_THEME_FREETEXT_TITLE:"_ragic_theme_freetext_title_",PREFIX_THEME_FREETEXT_SUB_TITLE:"_ragic_theme_freetext_sub_title_",PREFIX_THEME_SUBTABLE:"subtable_"},b={header:a.PREFIX_THEME_HEADER,value:a.PREFIX_THEME_VALUE,locked:a.PREFIX_THEME_LOCKED,
focus:a.PREFIX_THEME_FOCUS,freetext:a.PREFIX_THEME_FREETEXT,freetext_title:a.PREFIX_THEME_FREETEXT_TITLE,freetext_subtable_title:a.PREFIX_THEME_FREETEXT_SUB_TITLE};a.BORDER_STYLE_SELECTED_SAMPLE="3px solid #31f1f0";a.createCSSElement=function(a){if(a){var b=custThemes[a];if(b){var c=document.createElement("style");c.type="text/css";c.innerHTML=e(a,b);c.setAttribute("custTheme",!0);a=document.querySelectorAll("style[custTheme=true]");b=document.getElementsByTagName("head")[0];for(var d=0;d<a.length;d++)b.removeChild(a[d]);
b.appendChild(c)}}};a.applyTheme=function(b,c){if(b&&custThemes[b]&&(c||"default"!=b&&"default_builder"!=b)){if(mode==BUILDER){for(var d in builder.freeData){var e=builder.freeData[d];if(e){var f=nui._getcell(e.x,e.y);f&&a.applyThemeToFreeData(e,f,b,c)}}for(d in builder.cellData)(e=builder.cellData[d])&&(f=nui._getcell(e.x,e.y))&&a.applyThemeToCellData(e,f,b,c);builder.custTheme=b}else for(d=0;d<biffdata.biffs.length;d++)e=biffdata.biffs[d],(f=nui._getcell(e.x,e.y))&&a.applyThemeToBiffData(e,f,b,
c);CustThemeHelper.createCSSElement(b);(b=custThemes[b])&&-1!=JSON.stringify(b).indexOf("border")&&"separate"!=nui.main.nuicelltable.style["border-collapse"]&&(nui.main.nuicelltable.style["border-collapse"]="separate")}};a.applyThemeToFreeData=function(b,d,e,f){if(e&&custThemes[e]&&(f||"default"!=e&&"default_builder"!=e)&&0!=d.innerText.length){f={};for(var g in b.styling){var k=g.replace(/([A-Z])/g,"-$1").toLowerCase();f[k]=b.styling[g]}(b=builder.cellData[b.x+","+(b.y+1)])?builder.ifAdjacent(b.x,
b.y)?c(d,a.PREFIX_THEME_FREETEXT_SUB_TITLE,e,!1,f):c(d,a.PREFIX_THEME_FREETEXT_TITLE,e,!1,f):c(d,a.PREFIX_THEME_FREETEXT,e,!1,f)}};a.applyThemeToCellData=function(b,d,e,f){if(e&&custThemes[e]&&(f||"default"!=e&&"default_builder"!=e)){var g={};f={};for(var k in b.styling)k.startsWith("V")?f[k.substring(1)]=b.styling[k]:g[k]=b.styling[k];var l=builder.ifAdjacent(b.x,b.y);k=!builder.ifListingPage()&&l;c(d,a.PREFIX_THEME_HEADER,e,k,g);d=l?[nui._getcell(b.x,b.y+1),nui._getcell(b.x,b.y+2),nui._getcell(b.x,
b.y+3)]:[nui._getcell(b.x+1,b.y)];g=!1;try{g=b.attr&&b.attr.ro&&JSON.parse(b.attr.ro)}catch(p){console.error(p)}for(b=0;b<d.length;b++)g?c(d[b],a.PREFIX_THEME_LOCKED,e,k,f):c(d[b],a.PREFIX_THEME_VALUE,e,k,f)}};a.applyThemeToBiffData=function(b,d,e,f){if(e&&custThemes[e]&&(f||"default"!=e&&"default_builder"!=e)&&!b.hasAttribute("hide")&&!b.hasAttribute("imgheader")){var g=b.dataType==HEADER,k="F"==b.IPType;f=!biffdata.ifListingPage()&&biffdata.ifSubtableBiff(b);if(e)if(g)if(k){g={};for(l in b.attr)f=
l.replace(/([A-Z])/g,"-$1").toLowerCase(),g[f]=b.attr[l];b=biffdata.findBiffByLocation(b.x,b.y+1);null==b||b.IPType===FREE?c(d,a.PREFIX_THEME_FREETEXT,e,!1,g):biffdata.ifSubtableBiff(b)?c(d,a.PREFIX_THEME_FREETEXT_SUB_TITLE,e,!1,g):c(d,a.PREFIX_THEME_FREETEXT_TITLE,e,!1,g)}else{g={};for(var l in b.attr)l.startsWith("style")&&!l.startsWith("styleV")&&(g[l.substring(5)]=b.attr[l]);c(d,a.PREFIX_THEME_HEADER,e,f,g)}else{g={};for(l in b.attr)l.startsWith("styleV")&&(g[l.substring(6)]=b.attr[l]);l=!1;try{l=
"L"==biffdata.lockMode||b.attr&&b.attr.ro&&JSON.parse(b.attr.ro)}catch(p){console.error(p)}l?c(d,a.PREFIX_THEME_LOCKED,e,f,g):c(d,a.PREFIX_THEME_VALUE,e,f,g)}}};a.restoreToDefault=function(){mode!=BUILDER?a.applyTheme("default",!0):a.applyTheme("default_builder",!0)};a.displayAllThemes=function(){mode==BUILDER&&showMsg("/sims/getAvailableThemes.jsp?a="+ap,370,!0,!0)};var c=function(b,c,e,f,n){if(b){f=c+(f?a.PREFIX_THEME_SUBTABLE:"")+e;for(var g=0;g<b.classList.length;g++){var k=b.classList[g];k.startsWith("_ragic_theme_")&&
(b.classList.remove(k),g--)}b.classList.add(f);if(c=d(c))if(e=custThemes[e])if(e=e[c])for(var l in e){e=l;c=l.split("-");if(1<c.length)for(e=c[0],f=1;f<c.length;f++)0!=c[f].length&&(e+=c[f].charAt(0).toUpperCase()+c[f].substr(1));!b.style[l]||n&&(n[l]||n[e])||(b.style[l]="")}}},d=function(a){var c=null,d;for(d in b)if(b[d]===a){c=d;break}return c},e=function(c,k){var g="",m=!0,n={},q;for(q in k)if(!q.startsWith("_ragic_theme_"))if("subtable"!=q){var r=b[q];if(r){r==a.PREFIX_THEME_LOCKED&&(m=!1);var p=
{},t;for(t in k[q])p[t]=k[q][t];g+=f(q,r,c)+" {\n";for(t in p)g+="    "+t+": "+p[t]+";\n",r==a.PREFIX_THEME_VALUE&&(n[t]=p[t]);g+="}\n"}}else g+=e(a.PREFIX_THEME_SUBTABLE+c,k.subtable);if(m){g+=f(d(a.PREFIX_THEME_LOCKED,c),a.PREFIX_THEME_LOCKED,c)+" {\n";for(t in n)"background-color"==t?(m=toHSL(n[t]),c=m[0],k=m[1],m=m[2],k=.5<=k?k-.3:k+.3,c=formatHSL(c,k,m),g+="    "+t+": "+c+";\n"):g+="    "+t+": "+n[t]+";\n";g+="}\n"}return g},f=function(b,c,d){var e="#nuicelltable ";if(mode!=BUILDER)switch(b){case "header":e+=
".nuiCell.header."+c+d;break;case "focus":e+=".focus.nuiCell."+a.PREFIX_THEME_VALUE+d;break;case "value":case "locked":e+=".nuiCell."+c+d;break;case "freetext":case "freetext_title":case "freetext_subtable_title":e+=".nuiFreeCell."+c+d}else e+="."+c+d;return e};return a}(),mapSelector=function(){function a(a,d){b.marker?b.marker.setPosition(d):b.marker=new google.maps.Marker({position:d,map:a});a.setCenter(d)}var b={win:$("floatingGoogleMap"),mapContainer:$("googleMapDiv"),searchContainer:$("googleAutoCompleteDiv"),
search:$("googleAutoComplete"),getAddressButton:$("getAddressButton"),close:function(){ctrl.outOfNUI=!1;b.marker&&(b.marker=null);this.win.style.display="none";this.search.value=""},open:function(c,d){ctrl.outOfNUI=!0;var e=new google.maps.Map(this.mapContainer,{zoom:14});!c&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){e.setCenter({lat:a.coords.latitude,lng:a.coords.longitude})}):(new google.maps.Geocoder).geocode({address:c},function(c,d){"OK"==d&&c&&0<c.length&&c[0].geometry&&
c[0].geometry.location&&(a(e,c[0].geometry.location),b.search.value=c[0].formatted_address)});google.maps.event.addListener(e,"click",function(c){a(e,c.latLng);(new google.maps.Geocoder).geocode({location:c.latLng},function(a,c){"OK"==c&&a&&0<a.length&&(a=a[0].formatted_address)&&(b.search.value=a)})});var f=new google.maps.places.Autocomplete(b.search);f.bindTo("bounds",e);f.setFields(["geometry","formatted_address"]);f.addListener("place_changed",function(){var c=f.getPlace();c.geometry&&c.geometry.location&&
(a(e,c.geometry.location),b.search.value=c.formatted_address)});d&&(b.getAddressButton.onclick=function(){d(b.search.value);b.close()});this.win.style.display=""}};return b}(),mapHelper=function(){function a(a){var b=a.indexOf("\u00b0"),c=a.indexOf("'"),f=a.indexOf('"'),g=-1!=a.indexOf("N")||-1!=a.indexOf("E"),k=a.substring(0,b).trim();b=a.substring(b+1,c).trim();a=a.substring(c+1,f).trim();k=parseInt(k)+parseFloat(b)/60+parseFloat(a)/3600;g||(k*=-1);return k}function b(a){var b=-1==a.indexOf("-"),
c=a.indexOf(" "),f=a.substring(0,c).trim().replaceAll("-","").replaceAll("+","");a=a.substring(c+1).trim();f=parseInt(f)+parseFloat(a)/60;b||(f*=-1);return f}return{REGEX_DMS_1:/^\d{1,3}\u00b0\s*\d{1,2}'\s*\d{1,2}(.\d+)?"[NS]\s+\d{1,3}\u00b0\s*\d{1,2}'\s*\d{1,2}(.\d+)?"[EW]$/,REGEX_DMS_2:/^[+-]?\d{1,3}\u00b0\s*\d{1,2}'\s*\d{1,2}(.\d+)?"\s+[+-]?\d{1,3}\u00b0\s*\d{1,2}'\s*\d{1,2}(.\d+)"?$/,REGEX_DMM:/^[+-]?\d{1,3}\s+\d{1,2}(.\d+)?\s*[,]{1}\s*[+-]?\d{1,3}\s+\d{1,2}(.\d+)?$/,convertCoordinateToDecimalDegree:function(c){var d=
c.trim();try{if(this.REGEX_DMS_1.test(c)){var e=d.indexOf("N");-1==e&&(e=d.indexOf("S"));var f=d.substring(0,e+1).trim(),g=d.substring(e+1).trim();f=a(f);g=a(g);d=f+", "+g}else if(this.REGEX_DMS_2.test(c)){var k=c.indexOf('"'),l=c.substring(0,k+1).trim(),m=c.substring(k+1).trim();"-"==l.charAt(0)?(l=l.substring(1),l+="S"):("+"==l.charAt(0)&&(l=l.substring(1)),l+="N");"-"==m.charAt(0)?(m=m.substring(1),m+="W"):("+"==m.charAt(0)&&(l=l.substring(1)),m+="E");l=a(l);m=a(m);d=l+", "+m}else if(this.REGEX_DMM.test(c)){var n=
c.indexOf(","),q=c.substring(0,n).trim(),r=c.substring(n+1).trim();q=b(q);r=b(r);d=q+", "+r}}catch(p){d=c}return d}}}(),scheduleReportEditor=function(){var a={win:$("floatingWinScheduleReport"),actionSelectDiv:$("actionSelectDiv"),reportDiv:$("reportDiv"),needSave:!1,updateOnly:!1,debugMode:!1,close:function(){d("editor.close");try{ctrl.outOfNUI=!1,a.reportUpdated(!1),a.updateOnly=!1,a.win.style.display="none",a.reportDiv.style.display="none"}finally{f("editor.close")}},open:function(c,k){d("editor.open");
try{e("updateScheduleParamKey="+c);e("updateOnly="+k);k&&(a.updateOnly=!0);ctrl.outOfNUI=!0;var g=a.updateOnly||c?"UPDATE":null;e("initAction="+g);b(g,function(){for(var b=$("exportReport_action"),d=0;d<b.options.length;d++){var e=b.options[d];if("UPDATE"==e.vaue){e.selected=!0;break}}k&&b.setAttribute("disabled","");if(c)for(b=$("exportReport_updateSchedule"),d=0;d<b.options.length;d++)if(e=b.options[d],e.value==c){e.selected=!0;break}a.actionChange()})}finally{f("editor.open")}},actionChange:function(){d("editor.actionChange");
try{var g=$("exportReport_action"),k=$("exportReport_updateSchedule"),l="CREATE";try{l="none"!=g.style.display?g.options[g.selectedIndex].value:"CREATE"}catch(r){console.error(r);return}e("action="+l);if("CREATE"==l)k.style.display="none",$("exportReport_jobScheduleLink").style.display="",c();else if("UPDATE"==l){if("none"!=k.style.display){var m=k.options[k.selectedIndex],n=m.value,q=m.getAttribute("exportType");n&&q?c(q,n):a.reportDiv.style.display="none"}else b(l),a.reportDiv.style.display="none";
$("exportReport_jobScheduleLink").style.display="none"}else k.style.display="none",a.reportDiv.style.display="none",$("exportReport_jobScheduleLink").style.display="";a.reportUpdated(!1)}finally{f("editor.actionChange")}},reportUpdated:function(b){d("editor.reportUpdated");try{var c=$("restoreReportButton");b?(a.needSave=!0,c&&(c.style.display="inline")):(a.needSave=!1,c&&(c.style.display="none"));e("editor.needSave="+a.needSave)}finally{f("editor.reportUpdated")}},restoreReport:function(){d("editor.restoreReport");
try{a.actionChange(),a.reportUpdated(!1)}finally{f("editor.restoreReport")}}},b=function(b,c){d("_updateActionDiv");try{var g={a:ap};b&&(g.action=b);e("param=",g);ajaxget("/sims/schExport/report/reportActionSelect.jsp",g,function(b){actionSelectDiv.innerHTML=b;a.win.style.display="";c&&c()})}finally{f("_updateActionDiv")}},c=function(b,c){d("_updateReportDiv");try{var g={a:ap,p:path};sheet&&(g.sn=sheet);$("exportReport_updateSchedule");g.exportType=b?b:"exportView";c&&(g.scheduleParamKey=c);e("param=",
g);ajaxget("/sims/schExport/report/"+g.exportType+"/reportSetting.jsp",g,function(b){a.reportDiv.innerHTML=b;a.reportDiv.style.display=""})}finally{f("_updateReportDiv")}};a.saveReport=function(b){d("editor.saveReport");try{ajaxget("/sims/schExport/report/exportReportAction.jsp",b,function(b){b=JSON.parse(b);b.isSuccess?(floatWin(null,lm.exportReport_saveSuccess),a.open(b.scheduleParamKey,a.updateOnly)):a.handleActionError(b.errorCode,b)})}finally{f("editor.saveReport")}};a.saveCheck=function(b){d("editor.saveCheck");
try{var c=a.getMustParam(),g=$("exportReport_action"),m="CREATE";try{m="none"!=g.style.display?g.options[g.selectedIndex].value:"CREATE"}catch(t){floatWin(null,lm.exportReport_saveCheckError);return}c.action=m;var n=$("exportReport_reportName").value;if(n&&n.trim()){c.name=n;var q=$("exportReport_recipients").value;if(q&&q.trim()){var r=q.trim().split(",");r=r.filter(function(a){return""!==a.trim()&&a.includes("@")});if(50<r.length)floatWin(null,getBundleString("exportReport_email_recipient_limit",
[50]));else if(c.recipients=q,e("param=",c),"CREATE"==c.action){g={};for(var p in c)g[p]=c[p];g.action="CHECK_SCHEDULE_KEY";e("checkParam=",g);ajaxget("/sims/schExport/report/exportReportAction.jsp",g,function(d){e("checkResult="+d);d=JSON.parse(d);d.isSuccess?b&&b(c):a.handleActionError(d.errorCode,d)})}else b&&b(c)}else floatWin(null,lm.exportReport_saveCheckError)}else floatWin(null,lm.exportReport_saveCheckError)}finally{f("editor.saveCheck")}};a.getMustParam=function(){d("editor.getMustParam");
try{var a={a:ap,p:$("exportReport_path").value,sn:$("exportReport_sheet").value},b=$("exportReport_updateSchedule"),c=b.options[b.selectedIndex],e=c.getAttribute("exportType");e||(e="exportView");a.exportType=e;var n=c.value;n||(n="");a.updateScheduleParamKey=n;var q=$("reportViewSelect"),r=q.options[q.selectedIndex].value;r||(r="");a.reportId=r;var p=$("reportPeriodSelect"),t=p.options[p.selectedIndex].value;t||(t="");a.period=t;var v=$("downloadTypeSelect");a.downloadType=v.options[v.selectedIndex].value;
return a}finally{f("editor.getMustParam")}};a.forceExportReport=function(b){d("editor.forceExportReport");if(a.needSave)floatWin(null,lm.exportReport_needSave);else try{var c=a.getMustParam();c.action="FORCE_EXEC";e("param=",c);ajaxget("/sims/schExport/report/exportReportAction.jsp",c,function(c){e("result="+c);c=JSON.parse(c);c.isSuccess?(floatWin(null,lm.exportReport_forceExecSuccess),b&&(e("callback=",b),b())):a.handleActionError(c.errorCode)});setTimeout(updateSystemTaskProgress,1E3)}finally{f("editor.forceExportReport")}};
a.setReportExecutable=function(b,c){d("editor.setReportExecutable");try{if(a.needSave)floatWin(null,lm.exportReport_needSave);else{var g=a.getMustParam();g.action="SET_EXECUTABLE";g.executable=b;e("param=",g);ajaxget("/sims/schExport/report/exportReportAction.jsp",g,function(b){e("result="+b);b=JSON.parse(b);b.isSuccess?(b.executable?floatWin(null,lm.exportReport_started):floatWin(null,lm.exportReport_stopped),c&&(e("callback=",c),c())):a.handleActionError(b.errorCode)})}}finally{f("editor.setReportExecutable")}};
a.removeReport=function(b){d("editor.removeReport");try{var c=a.getMustParam();c.action="REMOVE";e("param=",c);ajaxget("/sims/schExport/report/exportReportAction.jsp",c,function(c){e("result="+c);c=JSON.parse(c);c.isSuccess?(floatWin(null,lm.exportReport_removeSuccess),b&&(e("callback=",b),b())):a.handleActionError(c.errorCode)})}finally{f("editor.removeReport")}};var d=function(b){a.debugMode&&console.group(b)},e=function(b,c){a.debugMode&&(c?console.log(b,c):console.log(b))},f=function(b){a.debugMode&&
console.groupEnd(b)};a.handleActionError=function(a,b){switch(a){case "DUPLICATED_KEY":var c=function(){floatWin(function(){return"/sims/schExport/report/duplicatedKeyError.jsp?key="+b.duplicatedKey},null,null,!0)};break;default:c=function(){floatWin(null,a)}}c()};return a}();function NotificationSettingEditor(){}NotificationSettingEditor.prototype.changeUserNotificationStatus=function(a,b){console.error("Method not implemented: changeUserNotificationStatus")};
NotificationSettingEditor.prototype.getUserTabNotificationSetting=function(a,b){console.error("Method not implemented: getUserTabNotificationSetting")};NotificationSettingEditor.prototype.getUserNotificationSetting=function(a){console.error("Method not implemented: getUserNotificationSetting")};NotificationSettingEditor.prototype.updateUserSheetNotificationSetting=function(a,b,c,d){console.error("Method not implemented: updateUserSheetNotificationSetting")};
NotificationSettingEditor.prototype.setNotifyStatus=function(a,b,c){var d=$(b+"_"+c).checked;postPromise("/sims/setNotifyStatus.jsp",{ap:ap,triggerType:b,notificationType:c,ifNotify:d,email:a})};NotificationSettingEditor.prototype.setSystemNotification=function(a){read(function(){location.reload()},"/sims/notifyAdminAction.jsp?a="+ap+"&type="+a,!0)};var adminNotificationSettingEditor=new NotificationSettingEditor(!0);
adminNotificationSettingEditor.changeUserNotificationStatus=function(a,b){postPromise("/sims/notifyAdminAction.jsp",{e:a,a:ap,act:b?"dv":""}).then(function(){return getPromise("/sims/notification/setting/notifyAdmin.jsp",{a:ap,admin:!0})}).then(function(a){$("notifyAdminDiv").innerHTML=a})};adminNotificationSettingEditor.getUserNotificationSetting=function(a){getPromise("/sims/userNotificationSetting.jsp",{a:ap,e:a,admin:!1}).then(function(a){floatWin(null,a,null,!0)})};
var personalNotificationSettingEditor=new NotificationSettingEditor;personalNotificationSettingEditor.changeUserNotificationStatus=function(a,b){postPromise("/sims/notifyAdminAction.jsp",{e:a,a:ap,act:b?"dv":""}).then(function(){return getPromise("/sims/userNotificationSetting.jsp",{a:ap,admin:!1,e:a})}).then(function(a){var b=$("personal_notificationSetting");b||(b=$("floatingWinContent"));b&&(b.innerHTML=a)})};
personalNotificationSettingEditor.getUserNotificationSetting=function(a){getPromise("/sims/userNotificationSetting.jsp",{a:ap,e:a,admin:!1}).then(function(a){var b=$("personal_notificationSetting");b||(b=$("floatingWinContent"));b&&(b.innerHTML=a)})};personalNotificationSettingEditor.getUserTabNotificationSetting=function(a,b){postPromise("/sims/notifyReg.jsp",{e:a,a:ap,p:b,sh:""}).then(function(a){var b=$("personal_notificationSetting");b||(b=$("floatingWinContent"));b&&(b.innerHTML=a)})};
personalNotificationSettingEditor.updateUserSheetNotificationSetting=function(a,b,c,d){ajaxpost("/sims/notifyReg.jsp",{e:a,a:ap,p:b,sh:c,act:d},function(a){var b=$("personal_notificationSetting");b||(b=$("floatingWinContent"));b&&(b.innerHTML=a)})};
personalNotificationSettingEditor.disableAllUserSheetNotificationCheckboxes=function(){var a=$("personal_notificationSetting");a||(a=$("floatingWinContent"));if(a){a=a.querySelectorAll("input[type=checkbox]");for(var b=0;b<a.length;b++)a[b].setAttribute("disabled",!0)}};
var Number2Word=function(){function a(a){var b=m.exec(a.toString());if(!b)return a;a=b[2];var c=b[4]||"",d=b[5]?+b[5]:0;if(0<d){var e=c.substr(0,d);e=e.length<d?e+Array(d-e.length+1).join("0"):e;c=c.substr(d);a+=e}else{d=-d;e=a.length-d;e=0>e?0:e;var f=a.substr(e,d);f=f.length<d?Array(d-f.length+1).join("0")+f:f;a=a.substring(0,e);c=f+c}""===a&&(a="0");return("-"===b[1]?"-":"")+a+(c?"."+c:"")}function b(b){var c=l.exec(b.toString());!c&&m.test(b.toString())&&(c=l.exec(a(b.toString())));return c?{intPart:c[2],
decimalPart:c[4],isNegative:"-"===c[1]}:null}function c(a,b){null===a&&(a={});return Object.assign(b,a)}function d(a,b,c){if(null===a)return"";var d="*.?+$^[](){}|\\/".includes(b)?"\\"+b:b,e=new RegExp(d+"+$");d=new RegExp(d+"{2}","g");a=a.toString();c&&"$"!==c||(a=a.replace(e,""));c||(a=a.replace(d,b));return a}function e(a,c,e){var g=b(a);if(!g)return a;var k=g.decimalPart;a=f(g.intPart,c,e);var l="";if(k){k=d(k,"0","$");for(var m=0;m<k.length;m++)l+=e.chars.charAt(+k.charAt(m));l.length&&(l=e.dotChar+
l)}c.ww&&5<e.unit.length&&(c=e.unit.charAt(4),k=e.unit.charAt(5),m=a.lastIndexOf(k),-1!==m&&(a=a.substring(0,m).replace(new RegExp(k,"g"),c+c)+a.substring(m)));return(g.isNegative?e.negativeChar:"")+a+l}function f(a,c,e){var g=b(a);g&&(a=g.intPart);var k="",l=c.tenMin,m=a.length;g=e.chars.charAt(0);if(1===m)return e.chars.charAt(+a);if(4>=m){c=0;for(var n=m;n--;){var p=parseInt(a.charAt(c));k+=l&&2===m&&0===c&&1===p?"":e.chars.charAt(p);k+=p&&n?e.unit.charAt(n):"";c++}}else{k=parseInt(m/4);for(l=
m%4;0===l||e.unit.length<=3+k;)l+=4,k--;m=a.substr(0,l);a=a.substr(l);k=f(m,c,e)+e.unit.charAt(3+k)+("0"===a.charAt(0)?g:"")+f(a,c,e)}return k=d(k,g,"")}function g(a,c,d){var e=b(a);if(!e)return a;var f=t.hasOwnProperty(c)?t[c]:t.en;a=k(e.intPart,f,d);e.decimalPart&&(c=e.decimalPart.split("").map(function(a){return f.base[a]}),a=a+" "+f.dotWord+" "+c.join(" "));return e.isNegative?f.negativeWord+" "+a:a}function k(a,b,d){var e=b.useLongScale?u:v,f=b.units,g=b.base;if(b.unitExceptions[a])return b.unitExceptions[a];
if(g[a])return g[a];a=parseInt(a);if(100>a)return e=10*Math.floor(a/10),f=a-e,a=b.base,b=0!==f?a[e]+b.baseSeparator+k(f,b,d):a[e],b;g=a%100;var l=[];g&&(d.noAnd?l.push(k(g,b,d)):l.push(b.unitSeparator+k(g,b,d)));for(var m,n=0,p=f.length;n<p;n++){var q=Math.floor(a/e[n]);q%=n===p-1?1E6:e[n+1]/e[n];m=f[n];if(0!==q){m="string"===typeof m?m:!m.plural||m.avoidInNumberPlural&&g?m.singular:m.plural;var r=b.unitExceptions[q];r=r?r:k(q,b,c({noAnd:!0},d));a-=q*e[n];l.push(r+" "+m)}}return l.reverse().join(" ")}
var l=/^([+-])?0*(\d+)(\.(\d+))?$/,m=/^([+-])?0*(\d+)(\.(\d+))?e(([+-])?(\d+))$/i,n={chars:"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",unit:"\u500b\u5341\u767e\u5343\u842c\u5104",negativeChar:"\u8ca0",dotChar:"\u9ede"},q={chars:"\u96f6\u58f9\u8cb3\u53c3\u8086\u4f0d\u9678\u67d2\u634c\u7396",unit:"\u500b\u62fe\u4f70\u4edf\u842c\u5104",negativeChar:"\u8ca0",dotChar:"\u9ede"},r={chars:"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",unit:"\u4e2a\u5341\u767e\u5343\u4e07\u4ebf",
negativeChar:"\u8d1f",dotChar:"\u70b9"},p={chars:"\u96f6\u58f9\u8d30\u53c1\u8086\u4f0d\u9646\u67d2\u634c\u7396",unit:"\u4e2a\u62fe\u4f70\u4edf\u4e07\u4ebf",negativeChar:"\u8d1f",dotChar:"\u70b9"},t={en:{useLongScale:!1,baseSeparator:"-",unitSeparator:"and ",negativeWord:"negative",dotWord:"point",base:{0:"zero",1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine",10:"ten",11:"eleven",12:"twelve",13:"thirteen",14:"fourteen",15:"fifteen",16:"sixteen",17:"seventeen",18:"eighteen",
19:"nineteen",20:"twenty",30:"thirty",40:"forty",50:"fifty",60:"sixty",70:"seventy",80:"eighty",90:"ninety"},units:"hundred thousand million billion trillion quadrillion quintillion sextillion septillion octillion nonillion decillion undecillion duodecillion tredecillion quattuordecillion quindecillion".split(" "),unitExceptions:{}},fr:{useLongScale:!1,baseSeparator:"-",unitSeparator:"",negativeWord:"moins",dotWord:"point",base:{0:"z\u00e9ro",1:"un",2:"deux",3:"trois",4:"quatre",5:"cinq",6:"six",
7:"sept",8:"huit",9:"neuf",10:"dix",11:"onze",12:"douze",13:"treize",14:"quatorze",15:"quinze",16:"seize",17:"dix-sept",18:"dix-huit",19:"dix-neuf",20:"vingt",30:"trente",40:"quarante",50:"cinquante",60:"soixante",70:"soixante-dix",80:"quatre-vingt",90:"quatre-vingt-dix"},units:[{singular:"cent",plural:"cents",avoidInNumberPlural:!0,avoidPrefixException:[1]},{singular:"mille",avoidPrefixException:[1]},{singular:"million",plural:"millions"},{singular:"milliard",plural:"milliards"},{singular:"billion",
plural:"billions"},{singular:"billiard",plural:"billiards"},{singular:"trillion",plural:"trillions"},{singular:"trilliard",plural:"trilliards"},{singular:"quadrillion",plural:"quadrillions"},{singular:"quadrilliard",plural:"quadrilliards"},{singular:"quintillion",plural:"quintillions"},{singular:"quintilliard",plural:"quintilliards"},{singular:"sextillion",plural:"sextillions"},{singular:"sextilliard",plural:"sextilliards"},{singular:"septillion",plural:"septillions"},{singular:"septilliard",plural:"septilliards"},
{singular:"octillion",plural:"octillions"}],unitExceptions:{21:"vingt et un",31:"trente et un",41:"quarante et un",51:"cinquante et un",61:"soixante et un",71:"soixante et onze",72:"soixante-douze",73:"soixante-treize",74:"soixante-quatorze",75:"soixante-quinze",76:"soixante-seize",77:"soixante-dix-sept",78:"soixante-dix-huit",79:"soixante-dix-neuf",80:"quatre-vingts",91:"quatre-vingt-onze",92:"quatre-vingt-douze",93:"quatre-vingt-treize",94:"quatre-vingt-quatorze",95:"quatre-vingt-quinze",96:"quatre-vingt-seize",
97:"quatre-vingt-dix-sept",98:"quatre-vingt-dix-huit",99:"quatre-vingt-dix-neuf"}}},v=[100,1E3,1E6,1E9,1E12,1E15,1E18,1E21,1E24,1E27,1E30,1E33,9.999999999999999E35,1.0000000000000001E39,9.999999999999999E41,1E45,1E48],u=[100,1E3,1E6,1E12,1E18,1E24,1E30,9.999999999999999E35,9.999999999999999E41,1E48,1E54,1E60,1E66,1E72,1E78,1E84,1E90];return function(a,b,d){b=b||"en";d=d||{};var f={};if("cht"===b)return f.ww=!0,d.smallCase?(b=n,f.tenMin=!0):b=q,e(a,c(d,f),b);if("chs"===b)return f.ww=!0,d.smallCase?
(b=r,f.tenMin=!0):b=p,e(a,c(d,f),b);f.noAnd=!1;return g(a,b,c(d,f))}}(),billingCtrl={};function updateCheckout(){ctrl.tempTimer&&clearTimeout(ctrl.tempTimer);ctrl.tempTimer=setTimeout(_updateCheckout,500)}
function _updateCheckout(){if($("payment-form")&&$("billingEquationContainer")){var a=$("planSel")?$("planSel").value:$("edition")?$("edition").value:"";updateEditionInfo(a);var b=$("activeUserCount")?parseInt($("activeUserCount").value)||0:0,c=billingCtrl.minPlanQty||0,d=parseInt($("quantity").value)||0;billingCtrl.minPlanQty&&d<c?($("minQtyPrompt")&&($("minQtyPrompt").style.display="none"),$("minQtyPrompt2")&&($("minQtyPrompt2").style.display=""),$("quantity").value=c,$("activeUsersPrompt")&&($("activeUsersPrompt").style.display=
"none")):!billingCtrl.concurrent&&d<b?($("minQtyPrompt")&&($("minQtyPrompt").style.display=""),$("minQtyPrompt2")&&($("minQtyPrompt2").style.display="none"),$("quantity").value=b,$("activeUsersPrompt")&&($("activeUsersPrompt").style.display="none")):($("minQtyPrompt")&&($("minQtyPrompt").style.display="none"),$("minQtyPrompt2")&&($("minQtyPrompt2").style.display="none"),$("activeUsersPrompt")&&($("activeUsersPrompt").style.display=""));d=Number($("quantity").value);b=parseInt($("months").options[$("months").selectedIndex].value);
c=parseFloat($("unitPrice").value);var e=getVolumeDiscountInfo(a,d),f=0,g=0,k=.3,l=e.volumeDiscount;"IA50"===$("coupon").value?(f=50,$("discountBlock2").style.display=""):"NPOINTL9"===reqCoupon?(g=k=.3,showNPODiscountBlock(k),l>k?("en"===window.langv5?$("volumeDiscountBetterMsg").innerHTML=lm.volumeDiscountBetter.replace("{0}",100*l):$("volumeDiscountBetterMsg").innerHTML=lm.volumeDiscountBetter.replace("{0}",10*(1-l)),$("volumeDiscountBetterMsg").style.display=""):$("volumeDiscountBetterMsg").style.display=
"none"):"NPOINTL9"===oldCoupon&&"LITE2"!==a&&k>=l?(g=k,tempCoupon="NPOINTL9",showNPODiscountBlock(k)):0<l?(g=l,tempCoupon=e.tempCoupon,showVolumeDiscountBlock(l)):(tempCoupon=e.tempCoupon,hideDiscountBlock());a=b*c*d*(1-g)-f;$("totalPriceField").innerHTML="$"+a.toFixed(2)+"<span>(USD/"+(1===b?lm.month:lm.year)+")";11!==b?($("yearlyDiscountBlock").style.display="none",$("leftParenthesis").style.display="none"):($("yearlyDiscountBlock").style.display="",$("leftParenthesis").style.display="");return a}}
function updateEditionInfo(a){"LITE2"==a?(billingCtrl.minPlanQty=null,billingCtrl.concurrent=!1,billingCtrl.onpremise=!1):"CONPROF"==a?(billingCtrl.minPlanQty=10,billingCtrl.concurrent=!0,billingCtrl.onpremise=!1):"CONENTP"==a?(billingCtrl.minPlanQty=10,billingCtrl.concurrent=!0,billingCtrl.onpremise=!1):"OP"==a?(billingCtrl.minPlanQty=10,billingCtrl.concurrent=!1,billingCtrl.onpremise=!0):"ENT"==a?(billingCtrl.minPlanQty=10,billingCtrl.concurrent=!1,billingCtrl.onpremise=!1):"CONOP"==a?(billingCtrl.minPlanQty=
10,billingCtrl.concurrent=!0,billingCtrl.onpremise=!0):"CONENTPOP"==a?(billingCtrl.minPlanQty=10,billingCtrl.concurrent=!0,billingCtrl.onpremise=!0):(billingCtrl.minPlanQty=null,billingCtrl.concurrent=!1,billingCtrl.onpremise=!1)}function showVolumeDiscountBlock(a){$("discountField").textContent=(100*(1-a)).toFixed(0)+"%";$("volumeDiscountText").style.display="";$("npoDiscountText").style.display="none";$("discountBlock").style.display=""}
function showNPODiscountBlock(a){$("discountField").textContent=(100*(1-a)).toFixed(0)+"%";$("npoDiscountText").style.display="";$("volumeDiscountText").style.display="none";$("discountBlock").style.display=""}function hideDiscountBlock(){$("volumeDiscountText").style.display="none";$("npoDiscountText").style.display="none";$("discountBlock").style.display="none"}
function getVolumeDiscountInfo(a,b){var c={};"LITE2"===a?2800<=b?(c.tempCoupon="VD55INTL4",c.volumeDiscount=.55):2E3<=b?(c.tempCoupon="VD50INTL0",c.volumeDiscount=.5):1200<=b?(c.tempCoupon="VD45INTL1",c.volumeDiscount=.45):800<=b?(c.tempCoupon="VD40INTL3",c.volumeDiscount=.4):400<=b?(c.tempCoupon="VD35INTL7",c.volumeDiscount=.35):200<=b?(c.tempCoupon="VD25INTL9",c.volumeDiscount=.25):80<=b?(c.tempCoupon="VD15INTL8",c.volumeDiscount=.15):(c.tempCoupon="",c.volumeDiscount=0):1E3<=b?(c.tempCoupon="VD60INTL6",
c.volumeDiscount=.6):750<=b?(c.tempCoupon="VD55INTL4",c.volumeDiscount=.55):500<=b?(c.tempCoupon="VD50INTL0",c.volumeDiscount=.5):300<=b?(c.tempCoupon="VD45INTL1",c.volumeDiscount=.45):200<=b?(c.tempCoupon="VD40INTL3",c.volumeDiscount=.4):100<=b?(c.tempCoupon="VD35INTL7",c.volumeDiscount=.35):50<=b?(c.tempCoupon="VD25INTL9",c.volumeDiscount=.25):20<=b?(c.tempCoupon="VD15INTL8",c.volumeDiscount=.15):(c.tempCoupon="",c.volumeDiscount=0);return c}
function modifyPlanStep1(){$("modifyPlan_stepList").querySelectorAll("li").forEach(function(a,b){a.classList.remove("active");0===b&&a.classList.add("active")});$("modify_plan_step1").style.display="";$("modify_plan_step2").style.display="none";$("agreeModifyPlanTerm1")&&($("agreeModifyPlanTerm1").checked=!1);$("agreeModifyPlanTerm2")&&($("agreeModifyPlanTerm2").checked=!1);$("agreeModifyPlanTerm3")&&($("agreeModifyPlanTerm3").checked=!1);document.body.scrollTop=0}
function modifyPlanStep2(){$("billingEquationContainer")&&($("billingEquationContainer").querySelector("#errorMsg")||($("card-element")?window.stripe&&window.card?stripe.createToken(card,{name:$("nameOnCard").value}).then(function(a){a.error?document.getElementById("card-errors").textContent=a.error.message:generateOrderInfo(a.token)}):alert("Something went wrong. Please contact support@ragic.com."):generateOrderInfo()))}
function generateOrderInfo(a){if($("agreeModifyPlanTerm1")&&$("agreeModifyPlanTerm2")&&$("agreeModifyPlanTerm3")&&(!$("agreeModifyPlanTerm1").checked||!$("agreeModifyPlanTerm2").checked||!$("agreeModifyPlanTerm3").checked))return floatWin(null,lm.billingTermsPrompt),!1;if(isNaN(parseInt($("quantity").value)))return floatWin(null,lm.wrongQuantity,""),!1;var b="";$("planSel")?($("planSel"),b=$("planSel").selectedOptions[0].textContent):$("editionName")&&(b=editionName.textContent,$("edition")&&$("edition"));
b.startsWith("Ragic")||(b="Ragic "+b);var c=parseInt($("quantity").value),d=$("activeUserCount")?parseInt($("activeUserCount").value)||0:0;c=checkIfQuantityValid(c,d);if(!c.valid)return floatWin(null,c.msg,""),!1;$("modifyPlan_stepList").querySelectorAll("li").forEach(function(a,b){a.classList.remove("active");1===b&&a.classList.add("active")});$("modify_plan_step1").style.display="none";$("modify_plan_step2").style.display="";document.body.scrollTop=0;if(a){var e=a.card.last4;var f=a.card.exp_year;
var g=a.card.exp_month;c=$("payment-form");d=document.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","stripeToken");d.setAttribute("value",a.id);c.appendChild(d)}$("modifyPlanPreview_plan").textContent=b;$("modifyPlanPreview_quantity").textContent=$("quantity").value;$("modifyPlanPreview_months").textContent=$("months").selectedOptions[0].textContent;$("modifyPlanPreview_unitPrice").textContent=$("unitPrice").value;$("modifyPlanPreview_total").textContent=$("totalPriceField").textContent;
$("nameOnCard")&&$("modifyPlanPreview_nameOnCard").textContent!==$("nameOnCard").value&&($("modifyPlanPreview_nameOnCard").textContent=$("nameOnCard").value);e&&$("modifyPlanPreview_ccNumber").textContent!==e&&($("modifyPlanPreview_ccNumber").textContent="****-****-****-"+e);f&&g&&$("modifyPlanPreview_ccExp").textContent!==g+"/"+f&&($("modifyPlanPreview_ccExp").textContent=g+"/"+f);$("email")&&$("modifyPlanPreview_email").textContent!==$("email").value&&($("modifyPlanPreview_email").textContent=$("email").value)}
function modifyPlanConfirm(){$("coupon").value=reqCoupon?reqCoupon:tempCoupon?tempCoupon:"";$("payment-form").submit()}function checkIfQuantityValid(a,b){var c=billingCtrl.minPlanQty||0;return billingCtrl.minPlanQty&&a<c?{valid:!1,msg:lm.minUsers2}:!billingCtrl.concurrent&&a<b?{valid:!1,msg:lm.minUsers.replace(/\{0\}/g,b)}:{valid:!0}}function toggleCancelSubscription(){$("agree")&&$("agree").checked?$("bCheckout").classList.remove("buttonDisabled"):$("bCheckout").classList.add("buttonDisabled")}
function submitCancelSubscription(a){a.preventDefault();if(!$("agree").checked)return floatWin(null,lm.checkConfirmation,""),!1;floatWinConfirmV3(lm.cancelSubscriptionDblCheck,function(){$("paymentForm").submit()});return!1}
function showInvoice(a){var b=getBodyScrolltop(),c=a.getBoundingClientRect(),d=Math.min(document.body.clientHeight,document.documentElement.clientHeight),e=$("invoiceWrapper"),f=c.top+b-e.offsetHeight/2+a.offsetHeight/2;for(f<b&&(f=b);f+e.offsetHeight>d+b;)if(f-=10,f<b){f=b;break}e.style.top=f+"px";e.style.left=c.left+a.offsetWidth+5+"px";e.classList.remove("hide");e.classList.add("show")}function hideInvoice(){var a=$("invoiceWrapper");a.classList.remove("show");a.classList.add("hide")}
function addSMSStep2(){$("modifyPlan_stepList").querySelectorAll("li").forEach(function(a,c){a.classList.remove("active");1===c&&a.classList.add("active")});var a=$("smsPackages").value||"";$("smscredits").textContent="$"+a;$("addSMS_step1").style.display="none";$("addSMS_step2").style.display=""}
function addSMSStep1(){$("modifyPlan_stepList").querySelectorAll("li").forEach(function(a,b){a.classList.remove("active");0===b&&a.classList.add("active")});$("addSMS_step1").style.display="";$("addSMS_step2").style.display="none"}function addSMSConfirm(){$("paymentForm").submit()}function bodyScrollTo(a){window.scrollTo?scrollTo({top:a}):(document.documentElement.scrollTop&&(document.documentElement.scrollTop=a),document.body.scrollTop=a)}
function checkInputIntOnly(a){a.value=parseInt(a.value)||""}function modifyManual(a){getPromise("/billing/s/manualModifyLayout.jsp",{a:ap,action:a}).then(function(a){$("modifyManual").innerHTML=a})}
function submitManual(){function a(a){rm($("modifyManual"));var b=node("I",null,"fas fa-spinner-third quick-spin");$("modifyManual").appendChild(b);postPromise("/billing/s/manualModify.jsp",a).then(function(a){a&&($("modifyManual").innerHTML=a)})}if($("edition")&&$("qty")){var b=$("qty").value;if(!b||isNaN(parseInt(b)))$("qty").value="";else{var c=$("edition").selectedOptions[0].value,d=lm.manualPayment_modifyPlan2+$("edition").selectedOptions[0].textContent+"<br>"+lm.manualPayment_moreUsers2+b+"<br><br>"+
lm.manualPayment_submitConfirm;floatWinConfirmV3(d,a.bind(null,{a:ap,e:c,qty:b}),lm.yes,null,lm.no)}}else $("sms")&&(b=$("sms").value,!b||isNaN(parseInt(b))?$("sms").value="":floatWinConfirmV3(lm.manualPayment_addSMS2+"$"+b+" (USD)<br><br>"+lm.manualPayment_submitConfirm,a.bind(null,{a:ap,sms:b}),lm.yes,null,lm.no))}
var CustAppSeqHelper=function(){function a(){getPromise("/sims/custAppLayout.jsp",{a:ap,p:path,si:sheetIndex}).then(function(a){floatWin(null,a,lm.custAppSeqItems_title,!0)})}function b(){if(mode!=BUILDER)throw Error("Non-embeded custAppSeqHelper can only be opened in builder mode.");getPromise("/sims/custSeqItemSelector.jsp",{a:ap,p:path,si:sheetIndex,ifDesc:!0,displayType:!0}).then(function(a){floatWin(null,a,lm.custAppSeqItems_title,!0);return Promise.resolve(!0)}).then(function(){$("custAppSeqItemSelectorSaveButton").onclick=
c;$("resetCustAppSeqItemsButton").onclick=d})}function c(){for(var a=[],b=$("custSeqItems"),c=0;c<b.options.length;c++){var d=JSON.parse(decodeURIComponent(b.options[c].value));a.push(d)}builder.custAppSeqItems=a;floatWin(null,lm.custAppSeqItems_saveSuccess,lm.custAppSeqItems_title,!0)}function d(){builder.custAppSeqItems=[];floatWin(null,lm.custAppSeqItems_resetSuccess,lm.custAppSeqItems_title,!0)}function e(){return postPromise("/sims/custSeqItemSelector.jsp",{a:ap,p:path,si:sheetIndex,ifDesc:!0,
ifSubtable:!0,displayType:!0,webEmbed:!0,hideDesc:!0}).then(function(a){$("embedBannerLibraryMain").innerHTML=a;return Promise.resolve(!0)}).then(function(){$("custAppSeqItemSelectorSaveButton").onclick=function(){f()};$("resetCustAppSeqItemsButton").onclick=g})}function f(a){var b=[];if(!a)for(var c=$("custSeqItems"),d=0;d<c.options.length;d++){var e=JSON.parse(decodeURIComponent(c.options[d].value));b.push(e)}if(!window.confirm(a?lm.custWebFormSeq_msg_confirm_reset:lm.custWebFormSeq_msg_confirm_save))return Promise.reject("Reject by user");
b={a:ap,p:path,si:sheetIndex,custSeqItems:JSON.stringify(b)};return postPromise("/sims/saveCustWebFormSeqItems.jsp",b).then(function(a){a=JSON.parse(a);return a.isSuccess?($("ragic_iframe").src=$("ragic_iframe").src,Promise.resolve(!0)):Promise.reject(a.errorMessage)}).then(function(){a||k(!1);return Promise.resolve(!0)})}function g(){f(!0).then(function(){return e()}).then(function(){k(!1)})}function k(a){var b=$("seqSaveMessageDiv");b&&(b.innerHTML=a?lm.custWebFormSeq_msg_reset_success:lm.custWebFormSeq_msg_save_success,
b.classList.add("notransition"),b.style.opacity=1,window.setTimeout(function(){b.classList.remove("notransition");b.style.opacity=0},2E3))}return{open:function(c){(c?e:builder.ifListingPage()?a:b)()},moveUpDown:function(a){var b=$("custSeqItems"),c=[];if(a)for(a=b.options.length-1;0<=a;a--){var d=b.options[a];if(d.selected&&!c.includes(d)){if(a>=b.options.length-1)break;b.insertBefore(b.options[a+1],b.options[a]);c.push(d)}}else for(a=0;a<b.options.length;a++)if(d=b.options[a],d.selected&&!c.includes(d)){if(0>=
a)break;b.insertBefore(b.options[a],b.options[a-1]);c.push(d)}},search:function(a,b){if("Shift"!=a.key){a=$("custSeqItems");var c=1;if(a.lastKeyword&&b&&b==a.lastKeyword){for(var d=b=null,e=0;e<a.options.length;e++){var f=a.options[e];if(f.matchesKeyword){if(d){b=f;break}f.currentOption&&(d=f);c++}}d&&b&&(d.currentOption=!1,d.style.backgroundColor="yellow",b.currentOption=!0,b.style.backgroundColor="orange",b.scrollIntoView(),$("custSeqItemSearchCount").innerHTML=c+"/"+a.lastMatchCount)}else{c=!0;
for(e=d=0;e<a.options.length;e++)f=a.options[e],b&&b.trim()&&-1!=f.innerHTML.indexOf(b)?(c?(f.style.backgroundColor="orange",c=!1,f.scrollIntoView(),f.currentOption=!0):f.style.backgroundColor="yellow",f.matchesKeyword=!0,d++):(f.style.backgroundColor="",f.matchesKeyword=!1);a.lastKeyword=b;a.lastMatchCount=d;0<d?($("custSeqItemSearchCount").textContent="1/"+d,$("custSeqItemSearchCount").style.visibility="visible"):b?($("custSeqItemSearchCount").textContent="0/0",$("custSeqItemSearchCount").style.visibility=
"visible"):$("custSeqItemSearchCount").style.visibility="hidden"}}}}}();function FieldSelector(){this.availableFields=[];this.selectedFields=[];this.actionName=this.type="";this.keyField;this.parentAlias;this.noClose=!1;this.callback=function(){};this.actionCallback=function(){}}
FieldSelector.prototype.loadData=function(a){a.availableFields&&(this.availableFields=a.availableFields);a.selectedFields&&(this.selectedFields=a.selectedFields);a.actionName&&(this.actionName=a.actionName);a.callback&&(this.callback=a.callback);a.actionCallback&&(this.actionCallback=a.actionCallback);a.keyField&&(this.keyField=a.keyField);a.parentAlias&&(this.parentAlias=a.parentAlias)};
FieldSelector.prototype.render=function(){var a=this;var b=node("table","listingFieldSelectorTable");var c=node("tr");var d=node("td");d.style.fontWeight="400";d.style.fontSize="13px";d.style.color="#222";d.style.padding="0 0 0 10px";d.style.verticalAlign="top";d.textContent=lm.availableFields;c.appendChild(d);var e=node("td");c.appendChild(e);e=d.cloneNode(!0);e.textContent=lm.selectedFields;c.appendChild(e);b.appendChild(c);c=node("tr");e=node("td");e.style.verticalAlign="top";d=createFieldFilterBar(!0);
e.appendChild(d);var f=node("select","formFieldOptions");f.multiple="multiple";f.style.height="100%";f.size="10";a.availableFields.forEach(function(b){var c=node("option");c.value=b.domainId;0>b.domainId&&(c.style.backgroundColor="#ffe7e7");c.setAttribute("attr",b.attr);c.setAttribute("it",b.it);b.lov&&c.setAttribute("lov",decodeEntities(b.lov));b.cascaded&&c.setAttribute("cascaded",b.cascaded);c.textContent=b.displayedFieldName;c.addEventListener("dblclick",function(){"formFieldOptions"===this.closest("select").id?
listingFieldSelector():listingFieldSelector(!0);a.callback&&a.callback()});f.appendChild(c)});e.appendChild(f);c.appendChild(e);e=node("td");d=node("div");d.classList.add("topButtonWhole");d.classList.add("topButtonWholeLight");d.style.padding="3px 10px";d.innerHTML='<i class="fa fa-caret-right" style="font-size:15px;"></i>';d.addEventListener("click",function(){listingFieldSelector();a.callback&&a.callback()});var g=d.cloneNode();g.style.clear="left";g.innerHTML='<i class="fa fa-caret-left" style="font-size:15px;"></i>';
g.addEventListener("click",function(){listingFieldSelector(!0);a.callback&&a.callback()});e.appendChild(d);e.appendChild(g);c.appendChild(e);e=node("td");e.style.verticalAlign="top";d=createFieldFilterBar();e.appendChild(d);var k=node("select","listingFieldOptions");k.multiple="multiple";k.style.height="100%";k.size="10";a.selectedFields.forEach(function(b){var c=node("option");c.value=b.domainId;c.setAttribute("attr",b.attr);c.setAttribute("it",b.it);b.lov&&c.setAttribute("lov",decodeEntities(b.lov));
b.cascaded&&c.setAttribute("cascaded",b.cascaded);c.textContent=b.displayedFieldName;c.addEventListener("dblclick",function(){"formFieldOptions"===this.closest("select").id?listingFieldSelector():listingFieldSelector(!0);a.callback&&a.callback()});k.appendChild(c)});e.appendChild(k);c.appendChild(e);e=node("td");d=node("div");d.classList.add("topButtonWhole");d.classList.add("topButtonWholeLight");d.style.padding="3px 8px";d.innerHTML='<i class="fa fa-caret-up" style="font-size:15px;"></i>';d.addEventListener("click",
function(){listingFieldSelectorMove();a.callback&&a.callback()});g=d.cloneNode();g.style.clear="left";g.innerHTML='<i class="fa fa-caret-down" style="font-size:15px;"></i>';g.addEventListener("click",function(){listingFieldSelectorMove(!0);a.callback&&a.callback()});e.appendChild(d);e.appendChild(g);c.appendChild(e);b.appendChild(c);a.noClose||(c=node("tr"),e=node("td"),d=node("input","insertListingFields"),d.type="button",d.style.marginRight="7px",d.value=a.actionName,d.addEventListener("click",
function(){a.callback&&a.callback();a.actionCallback&&a.actionCallback();$("floatingWin").style.display="none";ctrl.outOfNUI=!1}),e.appendChild(d),d=node("input"),d.type="button",d.value=lm.cancel,d.addEventListener("click",function(){$("floatingWin").style.display="none";ctrl.outOfNUI=!1}),e.appendChild(d),c.appendChild(e),b.appendChild(c));c=node("tr");e=node("td");d=node("input","parentAlias");d.type="hidden";d.value=a.parentAlias;e.appendChild(d);d=node("input","keyField");d.type="hidden";d.value=
a.keyField;e.appendChild(d);c.appendChild(e);b.appendChild(c);floatWin(null,b,"",!0)};
FieldSelector.prototype.balanceOptions=function(a){if(a){var b=$("listingFieldOptions"),c=$("formFieldOptions"),d=b.options,e=c.options,f;for(f=0;f<d.length;f++){var g=d[f];builder.findFieldInSubtable(g.value,a)||(b.removeChild(g),c.appendChild(g),f--)}for(f=0;f<e.length;f++)g=e[f],builder.findFieldInSubtable(g.value,a)&&(c.removeChild(g),b.appendChild(g),f--);c=Array.from(b.options);c.sort(function(b,c){return builder.findFieldInSubtable(b.value,a).x-builder.findFieldInSubtable(c.value,a).x});c.forEach(function(a){b.appendChild(a)})}};
function createFieldFilterBar(a){var b=node("div"),c=node("input");c.type="text";c.style.width="100%";c.style.borderRadius="5px";c.style.border="1px solid #ccc";a?c.addEventListener("keyup",function(){fieldFilter(this.value,$("formFieldOptions"))}):c.addEventListener("keyup",function(){fieldFilter(this.value,$("listingFieldOptions"))});c.addEventListener("focus",function(){});c.addEventListener("blur",function(){});a=node("i");a.classList.add("fas");a.classList.add("fa-search");a.style.margin="0 0 12px -20px";
a.style.color="#aaa";b.appendChild(c);b.appendChild(a);return b}
var saveAs=saveAs||"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){if("undefined"===typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=a.URL||a.webkitURL||a,d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e=!a.externalHost&&"download"in d,f=a.webkitRequestFileSystem,g=a.requestFileSystem||f||a.mozRequestFileSystem,k=function(b){(a.setImmediate||a.setTimeout)(function(){throw b;},0)},l=0,m=[],n=
function(){for(var a=m.length;a--;){var b=m[a];"string"===typeof b?c.revokeObjectURL(b):b.remove()}m.length=0},q=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"===typeof e)try{e.call(a,c||a)}catch(A){k(A)}}},r=function(c,k){var n=this,p=c.type,r=!1,t=function(){var b=(a.URL||a.webkitURL||a).createObjectURL(c);m.push(b);return b},w=function(){q(n,["writestart","progress","write","writeend"])},u=function(){if(r||!J)J=t(c);B?B.location.href=J:window.open(J,"_blank");
n.readyState=n.DONE;w()},v=function(a){return function(){if(n.readyState!==n.DONE)return a.apply(this,arguments)}},z={create:!0,exclusive:!1};n.readyState=n.INIT;k||(k="download");if(e){var J=t(c);b=a.document;d=b.createElementNS("http://www.w3.org/1999/xhtml","a");d.href=J;d.download=k;p=b.createEvent("MouseEvents");p.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null);d.dispatchEvent(p);n.readyState=n.DONE;w()}else{if(a.chrome&&p&&"application/octet-stream"!==p){var L=c.slice||c.webkitSlice;
c=L.call(c,0,c.size,"application/octet-stream");r=!0}f&&"download"!==k&&(k+=".download");if("application/octet-stream"===p||f)var B=a;g?(l+=c.size,g(a.TEMPORARY,l,v(function(a){a.root.getDirectory("saved",z,v(function(a){var b=function(){a.getFile(k,z,v(function(a){a.createWriter(v(function(b){b.onwriteend=function(b){B.location.href=a.toURL();m.push(a);n.readyState=n.DONE;q(n,"writeend",b)};b.onerror=function(){var a=b.error;a.code!==a.ABORT_ERR&&u()};["writestart","progress","write","abort"].forEach(function(a){b["on"+
a]=n["on"+a]});b.write(c);n.abort=function(){b.abort();n.readyState=n.DONE};n.readyState=n.WRITING}),u)}),u)};a.getFile(k,{create:!1},v(function(a){a.remove();b()}),v(function(a){a.code===a.NOT_FOUND_ERR?b():u()}))}),u)}),u)):u()}},p=r.prototype,t=function(a,b){return new r(a,b)};p.abort=function(){this.readyState=this.DONE;q(this,"abort")};p.readyState=p.INIT=0;p.WRITING=1;p.DONE=2;p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null;a.addEventListener("unload",n,!1);
t.unload=function(){n();a.removeEventListener("unload",n,!1)};return t}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content);"undefined"!==typeof module&&(module.exports=saveAs);
!function(a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=a()}(function(){return function e(b,c,d){function f(k,m){if(!c[k]){if(!b[k]){var l="function"==typeof require&&require;if(!m&&l)return l(k,!0);if(g)return g(k,!0);m=Error("Cannot find module '"+k+"'");throw m.code="MODULE_NOT_FOUND",m;}m=c[k]={exports:{}};
b[k][0].call(m.exports,function(c){return f(b[k][1][c]||c)},m,m.exports,e,b,c,d)}return c[k].exports}for(var g="function"==typeof require&&require,k=0;k<d.length;k++)f(d[k]);return f}({1:[function(b,c,d){var e=b("./utils"),f=b("./support");d.encode=function(b){for(var c,d,f,g,q,r,p=[],t=0,v=b.length,u,x="string"!==e.getTypeOf(b);t<b.length;)u=v-t,f=x?(c=b[t++],d=t<v?b[t++]:0,t<v?b[t++]:0):(c=b.charCodeAt(t++),d=t<v?b.charCodeAt(t++):0,t<v?b.charCodeAt(t++):0),g=c>>2,q=(3&c)<<4|d>>4,r=1<u?(15&d)<<
2|f>>6:64,f=2<u?63&f:64,p.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(q)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f));return p.join("")};d.decode=function(b){var c,d,e,g=0,q=0;if("data:"===b.substr(0,5))throw Error("Invalid base64 input, it looks like a data url.");var r;var p=
3*(b=b.replace(/[^A-Za-z0-9\+\/=]/g,"")).length/4;if("="===b.charAt(b.length-1)&&p--,"="===b.charAt(b.length-2)&&p--,0!=p%1)throw Error("Invalid base64 input, bad content length.");for(r=f.uint8array?new Uint8Array(0|p):Array(0|p);g<b.length;){p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(g++))<<2|(c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(g++)))>>4;c=(15&c)<<4|(d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(g++)))>>
2;var t=(3&d)<<6|(e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(g++)));r[q++]=p;64!==d&&(r[q++]=c);64!==e&&(r[q++]=t)}return r}},{"./support":30,"./utils":32}],2:[function(b,c,d){function e(b,c,d,e,f){this.compressedSize=b;this.uncompressedSize=c;this.crc32=d;this.compression=e;this.compressedContent=f}var f=b("./external"),g=b("./stream/DataWorker"),k=b("./stream/DataLengthProbe"),l=b("./stream/Crc32Probe");k=b("./stream/DataLengthProbe");e.prototype={getContentWorker:function(){var b=
(new g(f.Promise.resolve(this.compressedContent))).pipe(this.compression.uncompressWorker()).pipe(new k("data_length")),c=this;return b.on("end",function(){if(this.streamInfo.data_length!==c.uncompressedSize)throw Error("Bug : uncompressed data size mismatch");}),b},getCompressedWorker:function(){return(new g(f.Promise.resolve(this.compressedContent))).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",
this.compression)}};e.createWorkerFrom=function(b,c,d){return b.pipe(new l).pipe(new k("uncompressedSize")).pipe(c.compressWorker(d)).pipe(new k("compressedSize")).withStreamInfo("compression",c)};c.exports=e},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(b,c,d){var e=b("./stream/GenericWorker");d.STORE={magic:"\x00\x00",compressWorker:function(b){return new e("STORE compression")},uncompressWorker:function(){return new e("STORE decompression")}};
d.DEFLATE=b("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(b,c,d){var e=b("./utils"),f=function(){for(var b,c=[],d=0;256>d;d++){b=d;for(var e=0;8>e;e++)b=1&b?3988292384^b>>>1:b>>>1;c[d]=b}return c}();c.exports=function(b,c){return void 0!==b&&b.length?"string"!==e.getTypeOf(b)?function(b,c,d,e){d=e+d;for(b^=-1;e<d;e++)b=b>>>8^f[255&(b^c[e])];return-1^b}(0|c,b,b.length,0):function(b,c,d,e){d=e+d;for(b^=-1;e<d;e++)b=b>>>8^f[255&(b^c.charCodeAt(e))];return-1^b}(0|c,b,b.length,0):
0}},{"./utils":32}],5:[function(b,c,d){d.base64=!1;d.binary=!1;d.dir=!1;d.createFolders=!0;d.date=null;d.compression=null;d.compressionOptions=null;d.comment=null;d.unixPermissions=null;d.dosPermissions=null},{}],6:[function(b,c,d){b="undefined"!=typeof Promise?Promise:b("lie");c.exports={Promise:b}},{lie:37}],7:[function(b,c,d){function e(b,c){k.call(this,"FlateWorker/"+b);this._pako=null;this._pakoAction=b;this._pakoOptions=c;this.meta={}}c="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&
"undefined"!=typeof Uint32Array;var f=b("pako"),g=b("./utils"),k=b("./stream/GenericWorker"),l=c?"uint8array":"array";d.magic="\b\x00";g.inherits(e,k);e.prototype.processChunk=function(b){this.meta=b.meta;null===this._pako&&this._createPako();this._pako.push(g.transformTo(l,b.data),!1)};e.prototype.flush=function(){k.prototype.flush.call(this);null===this._pako&&this._createPako();this._pako.push([],!0)};e.prototype.cleanUp=function(){k.prototype.cleanUp.call(this);this._pako=null};e.prototype._createPako=
function(){this._pako=new f[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var b=this;this._pako.onData=function(c){b.push({data:c,meta:b.meta})}};d.compressWorker=function(b){return new e("Deflate",b)};d.uncompressWorker=function(){return new e("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(b,c,d){function e(b,c){var d,e="";for(d=0;d<c;d++)e+=String.fromCharCode(255&b),b>>>=8;return e}function f(b,c,d,f,g,l){var p=b.file;var r=b.compression,t=l!==m.utf8encode,
w=k.transformTo("string",l(p.name)),u=k.transformTo("string",m.utf8encode(p.name)),v=p.comment;l=k.transformTo("string",l(v));var x=k.transformTo("string",m.utf8encode(v)),J=u.length!==p.name.length,L=x.length!==v.length,B=v="",y="";var O=p.dir;var K=p.date,M=0,Q=0,P=0;c&&!d||(M=b.crc32,Q=b.compressedSize,P=b.uncompressedSize);b=0;c&&(b|=8);t||!J&&!L||(b|=2048);c=0;O&&(c|=16);"UNIX"===g?(g=798,p=t=p.unixPermissions,O=(t||(p=O?16893:33204),(65535&p)<<16),c|=O):(g=20,c|=63&(p.dosPermissions||0));p=
K.getUTCHours();p=p<<6|K.getUTCMinutes();p=p<<5|K.getUTCSeconds()/2;O=K.getUTCFullYear()-1980;O=O<<4|K.getUTCMonth()+1;O=O<<5|K.getUTCDate();J&&(B=e(1,1)+e(n(w),4)+u,v+="up"+e(B.length,2)+B);L&&(y=e(1,1)+e(n(l),4)+x,v+="uc"+e(y.length,2)+y);u="";return u+="\n\x00",u+=e(b,2),u+=r.magic,u+=e(p,2),u+=e(O,2),u+=e(M,4),u+=e(Q,4),u+=e(P,4),u+=e(w.length,2),u+=e(v.length,2),{fileRecord:q.LOCAL_FILE_HEADER+u+w+v,dirRecord:q.CENTRAL_FILE_HEADER+e(g,2)+u+e(l.length,2)+"\x00\x00\x00\x00"+e(c,4)+e(f,4)+w+v+l}}
function g(b,c,d,e){l.call(this,"ZipFileWorker");this.bytesWritten=0;this.zipComment=c;this.zipPlatform=d;this.encodeFileName=e;this.streamFiles=b;this.accumulate=!1;this.contentBuffer=[];this.dirRecords=[];this.entriesCount=this.currentSourceOffset=0;this.currentFile=null;this._sources=[]}var k=b("../utils"),l=b("../stream/GenericWorker"),m=b("../utf8"),n=b("../crc32"),q=b("../signature");k.inherits(g,l);g.prototype.push=function(b){var c=b.meta.percent||0,d=this.entriesCount,e=this._sources.length;
this.accumulate?this.contentBuffer.push(b):(this.bytesWritten+=b.data.length,l.prototype.push.call(this,{data:b.data,meta:{currentFile:this.currentFile,percent:d?(c+100*(d-e-1))/d:100}}))};g.prototype.openedSource=function(b){this.currentSourceOffset=this.bytesWritten;this.currentFile=b.file.name;var c=this.streamFiles&&!b.file.dir;c?(b=f(b,c,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:b.fileRecord,meta:{percent:0}})):this.accumulate=!0};g.prototype.closedSource=
function(b){this.accumulate=!1;var c=this.streamFiles&&!b.file.dir,d=f(b,c,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(d.dirRecord),c)this.push({data:function(b){return q.DATA_DESCRIPTOR+e(b.crc32,4)+e(b.compressedSize,4)+e(b.uncompressedSize,4)}(b),meta:{percent:100}});else for(this.push({data:d.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null};g.prototype.flush=function(){for(var b=
this.bytesWritten,c=0;c<this.dirRecords.length;c++)this.push({data:this.dirRecords[c],meta:{percent:100}});c=this.dirRecords.length;var d=this.bytesWritten-b,f=k.transformTo("string",(0,this.encodeFileName)(this.zipComment));b=q.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+e(c,2)+e(c,2)+e(d,4)+e(b,4)+e(f.length,2)+f;this.push({data:b,meta:{percent:100}})};g.prototype.prepareNextSource=function(){this.previous=this._sources.shift();this.openedSource(this.previous.streamInfo);this.isPaused?this.previous.pause():
this.previous.resume()};g.prototype.registerPrevious=function(b){this._sources.push(b);var c=this;return b.on("data",function(b){c.processChunk(b)}),b.on("end",function(){c.closedSource(c.previous.streamInfo);c._sources.length?c.prepareNextSource():c.end()}),b.on("error",function(b){c.error(b)}),this};g.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:
(this.end(),!0))};g.prototype.error=function(b){var c=this._sources;if(!l.prototype.error.call(this,b))return!1;for(var d=0;d<c.length;d++)try{c[d].error(b)}catch(v){}return!0};g.prototype.lock=function(){l.prototype.lock.call(this);for(var b=this._sources,c=0;c<b.length;c++)b[c].lock()};c.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(b,c,d){var e=b("../compressions"),f=b("./ZipFileWorker");d.generateWorker=function(b,c,d){var g=new f(c.streamFiles,
d,c.platform,c.encodeFileName),k=0;try{b.forEach(function(b,d){k++;var f=d.options.compression||c.compression,l=e[f];if(!l)throw Error(f+" is not a valid compression method !");f=d.dir;var m=d.date;d._compressWorker(l,d.options.compressionOptions||c.compressionOptions||{}).withStreamInfo("file",{name:b,dir:f,date:m,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(g)}),g.entriesCount=k}catch(q){g.error(q)}return g}},{"../compressions":3,"./ZipFileWorker":8}],
10:[function(b,c,d){function e(){if(!(this instanceof e))return new e;if(arguments.length)throw Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={};this.comment=null;this.root="";this.clone=function(){var b=new e,c;for(c in this)"function"!=typeof this[c]&&(b[c]=this[c]);return b}}(e.prototype=b("./object")).loadAsync=b("./load");e.support=b("./support");e.defaults=b("./defaults");e.version="3.5.0";e.loadAsync=function(b,c){return(new e).loadAsync(b,
c)};e.external=b("./external");c.exports=e},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(b,c,d){function e(b){return new g.Promise(function(c,d){var e=b.decompressed.getContentWorker().pipe(new m);e.on("error",function(b){d(b)}).on("end",function(){e.streamInfo.crc32!==b.decompressed.crc32?d(Error("Corrupted zip : CRC32 mismatch")):c()}).resume()})}var f=b("./utils"),g=b("./external"),k=b("./utf8"),l=(f=b("./utils"),b("./zipEntries")),m=b("./stream/Crc32Probe"),
n=b("./nodejsUtils");c.exports=function(b,c){var d=this;return c=f.extend(c||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:k.utf8decode}),n.isNode&&n.isStream(b)?g.Promise.reject(Error("JSZip can't accept a stream when loading a zip file.")):f.prepareContent("the loaded zip file",b,!0,c.optimizedBinaryString,c.base64).then(function(b){var d=new l(c);return d.load(b),d}).then(function(b){var d=[g.Promise.resolve(b)];b=b.files;if(c.checkCRC32)for(var f=0;f<b.length;f++)d.push(e(b[f]));
return g.Promise.all(d)}).then(function(b){b=b.shift();for(var e=b.files,f=0;f<e.length;f++){var g=e[f];d.file(g.fileNameStr,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:c.createFolders})}return b.zipComment.length&&(d.comment=b.zipComment),d})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],
12:[function(b,c,d){function e(b,c){f.call(this,"Nodejs stream input adapter for "+b);this._upstreamEnded=!1;this._bindStream(c)}d=b("../utils");var f=b("../stream/GenericWorker");d.inherits(e,f);e.prototype._bindStream=function(b){var c=this;(this._stream=b).pause();b.on("data",function(b){c.push({data:b,meta:{percent:0}})}).on("error",function(b){c.isPaused?this.generatedError=b:c.error(b)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})};e.prototype.pause=function(){return!!f.prototype.pause.call(this)&&
(this._stream.pause(),!0)};e.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)};c.exports=e},{"../stream/GenericWorker":28,"../utils":32}],13:[function(b,c,d){function e(b,c,d){f.call(this,c);this._helper=b;var e=this;b.on("data",function(b,c){e.push(b)||e._helper.pause();d&&d(c)}).on("error",function(b){e.emit("error",b)}).on("end",function(){e.push(null)})}var f=b("readable-stream").Readable;b("../utils").inherits(e,f);e.prototype._read=
function(){this._helper.resume()};c.exports=e},{"../utils":32,"readable-stream":16}],14:[function(b,c,d){c.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(b,c){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(b,c);if("number"==typeof b)throw Error('The "data" argument must not be a number');return new Buffer(b,c)},allocBuffer:function(b){if(Buffer.alloc)return Buffer.alloc(b);b=new Buffer(b);return b.fill(0),b},isBuffer:function(b){return Buffer.isBuffer(b)},isStream:function(b){return b&&
"function"==typeof b.on&&"function"==typeof b.pause&&"function"==typeof b.resume}}},{}],15:[function(b,c,d){function e(b,c,d){var e=g.getTypeOf(c),f=g.extend(d||{},m);f.date=f.date||new Date;null!==f.compression&&(f.compression=f.compression.toUpperCase());"string"==typeof f.unixPermissions&&(f.unixPermissions=parseInt(f.unixPermissions,8));f.unixPermissions&&16384&f.unixPermissions&&(f.dir=!0);f.dosPermissions&&16&f.dosPermissions&&(f.dir=!0);f.dir&&(b=v(b));var l;if(l=f.createFolders){var r=b;"/"===
r.slice(-1)&&(r=r.substring(0,r.length-1));l=r.lastIndexOf("/");l=r=0<l?r.substring(0,l):""}l&&u.call(this,r,!0);e="string"===e&&!1===f.binary&&!1===f.base64;d&&void 0!==d.binary||(f.binary=!e);(c instanceof n&&0===c.uncompressedSize||f.dir||!c||0===c.length)&&(f.base64=!1,f.binary=!0,c="",f.compression="STORE");c=c instanceof n||c instanceof k?c:p.isNode&&p.isStream(c)?new t(b,c):g.prepareContent(b,c,f.binary,f.optimizedBinaryString,f.base64);f=new q(b,c,f);this.files[b]=f}var f=b("./utf8"),g=b("./utils"),
k=b("./stream/GenericWorker"),l=b("./stream/StreamHelper"),m=b("./defaults"),n=b("./compressedObject"),q=b("./zipObject"),r=b("./generate"),p=b("./nodejsUtils"),t=b("./nodejs/NodejsStreamInputAdapter"),v=function(b){return"/"!==b.slice(-1)&&(b+="/"),b},u=function(b,c){return c=void 0!==c?c:m.createFolders,b=v(b),this.files[b]||e.call(this,b,null,{dir:!0,createFolders:c}),this.files[b]};c.exports={load:function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");
},forEach:function(b){var c,d,e;for(c in this.files)this.files.hasOwnProperty(c)&&(e=this.files[c],(d=c.slice(this.root.length,c.length))&&c.slice(0,this.root.length)===this.root&&b(d,e))},filter:function(b){var c=[];return this.forEach(function(d,e){b(d,e)&&c.push(e)}),c},file:function(b,c,d){if(1!==arguments.length)return b=this.root+b,e.call(this,b,c,d),this;if("[object RegExp]"===Object.prototype.toString.call(b)){var f=b;return this.filter(function(b,c){return!c.dir&&f.test(b)})}var g=this.files[this.root+
b];return g&&!g.dir?g:null},folder:function(b){if(!b)return this;if("[object RegExp]"===Object.prototype.toString.call(b))return this.filter(function(c,d){return d.dir&&b.test(c)});var c=u.call(this,this.root+b),d=this.clone();return d.root=c.name,d},remove:function(b){b=this.root+b;var c=this.files[b];if(c||("/"!==b.slice(-1)&&(b+="/"),c=this.files[b]),c&&!c.dir)delete this.files[b];else{c=this.filter(function(c,d){return d.name.slice(0,b.length)===b});for(var d=0;d<c.length;d++)delete this.files[c[d].name]}return this},
generate:function(b){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},generateInternalStream:function(b){var c={};try{if((c=g.extend(b||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:f.utf8encode})).type=c.type.toLowerCase(),c.compression=c.compression.toUpperCase(),"binarystring"===c.type&&(c.type="string"),!c.type)throw Error("No output type specified.");g.checkSupport(c.type);
"darwin"!==c.platform&&"freebsd"!==c.platform&&"linux"!==c.platform&&"sunos"!==c.platform||(c.platform="UNIX");"win32"===c.platform&&(c.platform="DOS");var d=r.generateWorker(this,c,c.comment||this.comment||"")}catch(A){(d=new k("error")).error(A)}return new l(d,c.type||"string",c.mimeType)},generateAsync:function(b,c){return this.generateInternalStream(b).accumulate(c)},generateNodeStream:function(b,c){return(b=b||{}).type||(b.type="nodebuffer"),this.generateInternalStream(b).toNodejsStream(c)}}},
{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(b,c,d){c.exports=b("stream")},{stream:void 0}],17:[function(b,c,d){function e(b){f.call(this,b);for(var c=0;c<this.data.length;c++)b[c]&=255}var f=b("./DataReader");b("../utils").inherits(e,f);e.prototype.byteAt=function(b){return this.data[this.zero+b]};e.prototype.lastIndexOfSignature=
function(b){var c=b.charCodeAt(0),d=b.charCodeAt(1),e=b.charCodeAt(2);b=b.charCodeAt(3);for(var f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===d&&this.data[f+2]===e&&this.data[f+3]===b)return f-this.zero;return-1};e.prototype.readAndCheckSignature=function(b){var c=b.charCodeAt(0),d=b.charCodeAt(1),e=b.charCodeAt(2);b=b.charCodeAt(3);var f=this.readData(4);return c===f[0]&&d===f[1]&&e===f[2]&&b===f[3]};e.prototype.readData=function(b){if(this.checkOffset(b),0===b)return[];var c=this.data.slice(this.zero+
this.index,this.zero+this.index+b);return this.index+=b,c};c.exports=e},{"../utils":32,"./DataReader":18}],18:[function(b,c,d){function e(b){this.data=b;this.length=b.length;this.zero=this.index=0}var f=b("../utils");e.prototype={checkOffset:function(b){this.checkIndex(this.index+b)},checkIndex:function(b){if(this.length<this.zero+b||0>b)throw Error("End of data reached (data length = "+this.length+", asked index = "+b+"). Corrupted zip ?");},setIndex:function(b){this.checkIndex(b);this.index=b},
skip:function(b){this.setIndex(this.index+b)},byteAt:function(b){},readInt:function(b){var c,d=0;this.checkOffset(b);for(c=this.index+b-1;c>=this.index;c--)d=(d<<8)+this.byteAt(c);return this.index+=b,d},readString:function(b){return f.transformTo("string",this.readData(b))},readData:function(b){},lastIndexOfSignature:function(b){},readAndCheckSignature:function(b){},readDate:function(){var b=this.readInt(4);return new Date(Date.UTC(1980+(b>>25&127),(b>>21&15)-1,b>>16&31,b>>11&31,b>>5&63,(31&b)<<
1))}};c.exports=e},{"../utils":32}],19:[function(b,c,d){function e(b){f.call(this,b)}var f=b("./Uint8ArrayReader");b("../utils").inherits(e,f);e.prototype.readData=function(b){this.checkOffset(b);var c=this.data.slice(this.zero+this.index,this.zero+this.index+b);return this.index+=b,c};c.exports=e},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(b,c,d){function e(b){f.call(this,b)}var f=b("./DataReader");b("../utils").inherits(e,f);e.prototype.byteAt=function(b){return this.data.charCodeAt(this.zero+
b)};e.prototype.lastIndexOfSignature=function(b){return this.data.lastIndexOf(b)-this.zero};e.prototype.readAndCheckSignature=function(b){return b===this.readData(4)};e.prototype.readData=function(b){this.checkOffset(b);var c=this.data.slice(this.zero+this.index,this.zero+this.index+b);return this.index+=b,c};c.exports=e},{"../utils":32,"./DataReader":18}],21:[function(b,c,d){function e(b){f.call(this,b)}var f=b("./ArrayReader");b("../utils").inherits(e,f);e.prototype.readData=function(b){if(this.checkOffset(b),
0===b)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+b);return this.index+=b,c};c.exports=e},{"../utils":32,"./ArrayReader":17}],22:[function(b,c,d){var e=b("../utils"),f=b("../support"),g=b("./ArrayReader"),k=b("./StringReader"),l=b("./NodeBufferReader"),m=b("./Uint8ArrayReader");c.exports=function(b){var c=e.getTypeOf(b);return e.checkSupport(c),"string"!==c||f.uint8array?"nodebuffer"===c?new l(b):f.uint8array?new m(e.transformTo("uint8array",b)):new g(e.transformTo("array",
b)):new k(b)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(b,c,d){d.LOCAL_FILE_HEADER="PK\u0003\u0004";d.CENTRAL_FILE_HEADER="PK\u0001\u0002";d.CENTRAL_DIRECTORY_END="PK\u0005\u0006";d.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\u0006\u0007";d.ZIP64_CENTRAL_DIRECTORY_END="PK\u0006\u0006";d.DATA_DESCRIPTOR="PK\u0007\b"},{}],24:[function(b,c,d){function e(b){f.call(this,"ConvertWorker to "+b);this.destType=b}var f=b("./GenericWorker"),
g=b("../utils");g.inherits(e,f);e.prototype.processChunk=function(b){this.push({data:g.transformTo(this.destType,b.data),meta:b.meta})};c.exports=e},{"../utils":32,"./GenericWorker":28}],25:[function(b,c,d){function e(){f.call(this,"Crc32Probe");this.withStreamInfo("crc32",0)}var f=b("./GenericWorker"),g=b("../crc32");b("../utils").inherits(e,f);e.prototype.processChunk=function(b){this.streamInfo.crc32=g(b.data,this.streamInfo.crc32||0);this.push(b)};c.exports=e},{"../crc32":4,"../utils":32,"./GenericWorker":28}],
26:[function(b,c,d){function e(b){f.call(this,"DataLengthProbe for "+b);this.propName=b;this.withStreamInfo(b,0)}d=b("../utils");var f=b("./GenericWorker");d.inherits(e,f);e.prototype.processChunk=function(b){b&&(this.streamInfo[this.propName]=(this.streamInfo[this.propName]||0)+b.data.length);f.prototype.processChunk.call(this,b)};c.exports=e},{"../utils":32,"./GenericWorker":28}],27:[function(b,c,d){function e(b){g.call(this,"DataWorker");var c=this;this.dataIsReady=!1;this.max=this.index=0;this.data=
null;this.type="";this._tickScheduled=!1;b.then(function(b){c.dataIsReady=!0;c.data=b;c.max=b&&b.length||0;c.type=f.getTypeOf(b);c.isPaused||c._tickAndRepeat()},function(b){c.error(b)})}var f=b("../utils"),g=b("./GenericWorker");f.inherits(e,g);e.prototype.cleanUp=function(){g.prototype.cleanUp.call(this);this.data=null};e.prototype.resume=function(){return!!g.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,f.delay(this._tickAndRepeat,[],this)),!0)};e.prototype._tickAndRepeat=
function(){this._tickScheduled=!1;this.isPaused||this.isFinished||(this._tick(),this.isFinished||(f.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))};e.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var b=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case "string":b=this.data.substring(this.index,c);break;case "uint8array":b=this.data.subarray(this.index,c);break;case "array":case "nodebuffer":b=this.data.slice(this.index,
c)}return this.index=c,this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})};c.exports=e},{"../utils":32,"./GenericWorker":28}],28:[function(b,c,d){function e(b){this.name=b||"default";this.streamInfo={};this.generatedError=null;this.extraStreamInfo={};this.isPaused=!0;this.isLocked=this.isFinished=!1;this._listeners={data:[],end:[],error:[]};this.previous=null}e.prototype={push:function(b){this.emit("data",b)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),
this.cleanUp(),this.isFinished=!0}catch(f){this.emit("error",f)}return!0},error:function(b){return!this.isFinished&&(this.isPaused?this.generatedError=b:(this.isFinished=!0,this.emit("error",b),this.previous&&this.previous.error(b),this.cleanUp()),!0)},on:function(b,c){return this._listeners[b].push(c),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null;this._listeners=[]},emit:function(b,c){if(this._listeners[b])for(var d=0;d<this._listeners[b].length;d++)this._listeners[b][d].call(this,
c)},pipe:function(b){return b.registerPrevious(this)},registerPrevious:function(b){if(this.isLocked)throw Error("The stream '"+this+"' has already been used.");this.streamInfo=b.streamInfo;this.mergeStreamInfo();this.previous=b;var c=this;return b.on("data",function(b){c.processChunk(b)}),b.on("end",function(){c.end()}),b.on("error",function(b){c.error(b)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||
this.isFinished)return!1;var b=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),b=!0),this.previous&&this.previous.resume(),!b},flush:function(){},processChunk:function(b){this.push(b)},withStreamInfo:function(b,c){return this.extraStreamInfo[b]=c,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var b in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(b)&&(this.streamInfo[b]=this.extraStreamInfo[b])},lock:function(){if(this.isLocked)throw Error("The stream '"+
this+"' has already been used.");this.isLocked=!0;this.previous&&this.previous.lock()},toString:function(){var b="Worker "+this.name;return this.previous?this.previous+" -> "+b:b}};c.exports=e},{}],29:[function(b,c,d){function e(b,c){return new n.Promise(function(d,e){var f=[],k=b._internalType,l=b._outputType,n=b._mimeType;b.on("data",function(b,d){f.push(b);c&&c(d)}).on("error",function(b){f=[];e(b)}).on("end",function(){try{var b=function(b,c,d){switch(b){case "blob":return g.newBlob(g.transformTo("arraybuffer",
c),d);case "base64":return m.encode(c);default:return g.transformTo(b,c)}}(l,function(b,c){var d,e=0,f=0;for(d=0;d<c.length;d++)f+=c[d].length;switch(b){case "string":return c.join("");case "array":return Array.prototype.concat.apply([],c);case "uint8array":b=new Uint8Array(f);for(d=0;d<c.length;d++)b.set(c[d],e),e+=c[d].length;return b;case "nodebuffer":return Buffer.concat(c);default:throw Error("concat : unsupported type '"+b+"'");}}(k,f),n);d(b)}catch(w){e(w)}f=[]}).resume()})}function f(b,c,
d){var e=c;switch(c){case "blob":case "arraybuffer":e="uint8array";break;case "base64":e="string"}try{this._internalType=e,this._outputType=c,this._mimeType=d,g.checkSupport(e),this._worker=b.pipe(new k(e)),b.lock()}catch(u){this._worker=new l("error"),this._worker.error(u)}}var g=b("../utils"),k=b("./ConvertWorker"),l=b("./GenericWorker"),m=b("../base64");d=b("../support");var n=b("../external"),q=null;if(d.nodestream)try{q=b("../nodejs/NodejsStreamOutputAdapter")}catch(r){}f.prototype={accumulate:function(b){return e(this,
b)},on:function(b,c){var d=this;return"data"===b?this._worker.on(b,function(b){c.call(d,b.data,b.meta)}):this._worker.on(b,function(){g.delay(c,arguments,d)}),this},resume:function(){return g.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(g.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw Error(this._outputType+" is not supported by this method");return new q(this,{objectMode:"nodebuffer"!==this._outputType},
b)}};c.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(b,c,d){if(d.base64=!0,d.array=!0,d.string=!0,d.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,d.nodebuffer="undefined"!=typeof Buffer,d.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)d.blob=!1;else{c=new ArrayBuffer(0);try{d.blob=0===(new Blob([c],{type:"application/zip"})).size}catch(f){try{var e=
new (self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);e.append(c);d.blob=0===e.getBlob("application/zip").size}catch(g){d.blob=!1}}}try{d.nodestream=!!b("readable-stream").Readable}catch(f){d.nodestream=!1}},{"readable-stream":16}],31:[function(b,c,d){function e(){m.call(this,"utf-8 decode");this.leftOver=null}function f(){m.call(this,"utf-8 encode")}var g=b("./utils"),k=b("./support"),l=b("./nodejsUtils"),m=b("./stream/GenericWorker"),n=Array(256);for(b=0;256>b;b++)n[b]=
252<=b?6:248<=b?5:240<=b?4:224<=b?3:192<=b?2:1;n[254]=n[254]=1;d.utf8encode=function(b){if(k.nodebuffer)b=l.newBufferFrom(b,"utf-8");else{var c,d,e,f,g=b.length,m=0;for(e=0;e<g;e++)55296==(64512&(c=b.charCodeAt(e)))&&e+1<g&&56320==(64512&(d=b.charCodeAt(e+1)))&&(c=65536+(c-55296<<10)+(d-56320),e++),m+=128>c?1:2048>c?2:65536>c?3:4;var n=k.uint8array?new Uint8Array(m):Array(m);for(e=f=0;f<m;e++)55296==(64512&(c=b.charCodeAt(e)))&&e+1<g&&56320==(64512&(d=b.charCodeAt(e+1)))&&(c=65536+(c-55296<<10)+(d-
56320),e++),128>c?n[f++]=c:(2048>c?n[f++]=192|c>>>6:(65536>c?n[f++]=224|c>>>12:(n[f++]=240|c>>>18,n[f++]=128|c>>>12&63),n[f++]=128|c>>>6&63),n[f++]=128|63&c);b=n}return b};d.utf8decode=function(b){if(k.nodebuffer)var c=g.transformTo("nodebuffer",b).toString("utf-8");else{c=g.transformTo(k.uint8array?"uint8array":"array",b);var d,e,f,l,m=c.length;b=Array(2*m);for(d=e=0;d<m;)if(128>(f=c[d++]))b[e++]=f;else if(4<(l=n[f]))b[e++]=65533,d+=l-1;else{for(f&=2===l?31:3===l?15:7;1<l&&d<m;)f=f<<6|63&c[d++],
l--;1<l?b[e++]=65533:65536>f?b[e++]=f:(f-=65536,b[e++]=55296|f>>10&1023,b[e++]=56320|1023&f)}c=(b.length!==e&&(b.subarray?b=b.subarray(0,e):b.length=e),g.applyFromCharCode(b))}return c};g.inherits(e,m);e.prototype.processChunk=function(b){var c=g.transformTo(k.uint8array?"uint8array":"array",b.data);if(this.leftOver&&this.leftOver.length){if(k.uint8array){var e=c;(c=new Uint8Array(e.length+this.leftOver.length)).set(this.leftOver,0);c.set(e,this.leftOver.length)}else c=this.leftOver.concat(c);this.leftOver=
null}e=void 0;var f;(e=e||c.length)>c.length&&(e=c.length);for(f=e-1;0<=f&&128==(192&c[f]);)f--;e=0>f?e:0===f?e:f+n[c[f]]>e?f:e;f=c;e!==c.length&&(k.uint8array?(f=c.subarray(0,e),this.leftOver=c.subarray(e,c.length)):(f=c.slice(0,e),this.leftOver=c.slice(e,c.length)));this.push({data:d.utf8decode(f),meta:b.meta})};e.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:d.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)};d.Utf8DecodeWorker=e;g.inherits(f,m);f.prototype.processChunk=
function(b){this.push({data:d.utf8encode(b.data),meta:b.meta})};d.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(b,c,d){function e(b){return b}function f(b,c){for(var d=0;d<b.length;++d)c[d]=255&b.charCodeAt(d);return c}function g(b){var c=65536,e=d.getTypeOf(b),f=!0;if("uint8array"===e?f=v.applyCanBeUsed.uint8array:"nodebuffer"===e&&(f=v.applyCanBeUsed.nodebuffer),f)for(;1<c;)try{return v.stringifyByChunk(b,e,c)}catch(w){c=Math.floor(c/
2)}return v.stringifyByChar(b)}function k(b,c){for(var d=0;d<b.length;d++)c[d]=b[d];return c}var l=b("./support"),m=b("./base64"),n=b("./nodejsUtils"),q=b("set-immediate-shim"),r=b("./external");d.newBlob=function(b,c){d.checkSupport("blob");try{return new Blob([b],{type:c})}catch(A){try{var e=new (self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return e.append(b),e.getBlob(c)}catch(w){throw Error("Bug : can't construct the Blob.");}}};try{var p=l.uint8array&&1===
String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(x){p=!1}b=p;try{var t=l.nodebuffer&&1===String.fromCharCode.apply(null,n.allocBuffer(1)).length}catch(x){t=!1}var v={stringifyByChunk:function(b,c,d){var e=[],f=0,g=b.length;if(g<=d)return String.fromCharCode.apply(null,b);for(;f<g;)"array"===c||"nodebuffer"===c?e.push(String.fromCharCode.apply(null,b.slice(f,Math.min(f+d,g)))):e.push(String.fromCharCode.apply(null,b.subarray(f,Math.min(f+d,g)))),f+=d;return e.join("")},stringifyByChar:function(b){for(var c=
"",d=0;d<b.length;d++)c+=String.fromCharCode(b[d]);return c},applyCanBeUsed:{uint8array:b,nodebuffer:t}};d.applyFromCharCode=g;var u={};u.string={string:e,array:function(b){return f(b,Array(b.length))},arraybuffer:function(b){return u.string.uint8array(b).buffer},uint8array:function(b){return f(b,new Uint8Array(b.length))},nodebuffer:function(b){return f(b,n.allocBuffer(b.length))}};u.array={string:g,array:e,arraybuffer:function(b){return(new Uint8Array(b)).buffer},uint8array:function(b){return new Uint8Array(b)},
nodebuffer:function(b){return n.newBufferFrom(b)}};u.arraybuffer={string:function(b){return g(new Uint8Array(b))},array:function(b){return k(new Uint8Array(b),Array(b.byteLength))},arraybuffer:e,uint8array:function(b){return new Uint8Array(b)},nodebuffer:function(b){return n.newBufferFrom(new Uint8Array(b))}};u.uint8array={string:g,array:function(b){return k(b,Array(b.length))},arraybuffer:function(b){return b.buffer},uint8array:e,nodebuffer:function(b){return n.newBufferFrom(b)}};u.nodebuffer={string:g,
array:function(b){return k(b,Array(b.length))},arraybuffer:function(b){return u.nodebuffer.uint8array(b).buffer},uint8array:function(b){return k(b,new Uint8Array(b.length))},nodebuffer:e};d.transformTo=function(b,c){if(c=c||"",!b)return c;d.checkSupport(b);var e=d.getTypeOf(c);return u[e][b](c)};d.getTypeOf=function(b){return"string"==typeof b?"string":"[object Array]"===Object.prototype.toString.call(b)?"array":l.nodebuffer&&n.isBuffer(b)?"nodebuffer":l.uint8array&&b instanceof Uint8Array?"uint8array":
l.arraybuffer&&b instanceof ArrayBuffer?"arraybuffer":void 0};d.checkSupport=function(b){if(!l[b.toLowerCase()])throw Error(b+" is not supported by this platform");};d.MAX_VALUE_16BITS=65535;d.MAX_VALUE_32BITS=-1;d.pretty=function(b){var c,d,e="";for(d=0;d<(b||"").length;d++)e+="\\x"+(16>(c=b.charCodeAt(d))?"0":"")+c.toString(16).toUpperCase();return e};d.delay=function(b,c,d){q(function(){b.apply(d||null,c||[])})};d.inherits=function(b,c){function d(){}d.prototype=c.prototype;b.prototype=new d};
d.extend=function(){var b,c,d={};for(b=0;b<arguments.length;b++)for(c in arguments[b])arguments[b].hasOwnProperty(c)&&void 0===d[c]&&(d[c]=arguments[b][c]);return d};d.prepareContent=function(b,c,e,g,k){return r.Promise.resolve(c).then(function(b){return l.blob&&(b instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(b)))&&"undefined"!=typeof FileReader?new r.Promise(function(c,d){var e=new FileReader;e.onload=function(b){c(b.target.result)};e.onerror=function(b){d(b.target.error)};
e.readAsArrayBuffer(b)}):b}).then(function(c){var n=d.getTypeOf(c);n?"arraybuffer"===n?c=d.transformTo("uint8array",c):"string"===n&&(k?c=m.decode(c):e&&!0!==g&&(c=f(c,l.uint8array?new Uint8Array(c.length):Array(c.length)))):c=r.Promise.reject(Error("Can't read the data of '"+b+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"));return c})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(b,c,d){function e(b){this.files=
[];this.loadOptions=b}var f=b("./reader/readerFor"),g=b("./utils"),k=b("./signature"),l=b("./zipEntry"),m=(b("./utf8"),b("./support"));e.prototype={checkSignature:function(b){if(!this.reader.readAndCheckSignature(b)){this.reader.index-=4;var c=this.reader.readString(4);throw Error("Corrupted zip or bug: unexpected signature ("+g.pretty(c)+", expected "+g.pretty(b)+")");}},isSignature:function(b,c){var d=this.reader.index;this.reader.setIndex(b);b=this.reader.readString(4)===c;return this.reader.setIndex(d),
b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);var b=this.reader.readData(this.zipCommentLength);b=g.transformTo(m.uint8array?"uint8array":"array",b);this.zipComment=this.loadOptions.decodeFileName(b)},
readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.reader.skip(4);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};for(var b,c,d,e=this.zip64EndOfCentralSize-44;0<e;)b=this.reader.readInt(2),c=this.reader.readInt(4),
d=this.reader.readData(c),this.zip64ExtensibleData[b]={id:b,length:c,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw Error("Multi-volumes zip are not supported");},readLocalFiles:function(){var b;for(b=0;b<this.files.length;b++){var c=this.files[b];this.reader.setIndex(c.localHeaderOffset);this.checkSignature(k.LOCAL_FILE_HEADER);
c.readLocalPart(this.reader);c.handleUTF8();c.processAttributes()}},readCentralDir:function(){var b;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(k.CENTRAL_FILE_HEADER);)(b=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(b);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length);
},readEndOfCentral:function(){var b=this.reader.lastIndexOfSignature(k.CENTRAL_DIRECTORY_END);if(0>b)throw this.isSignature(0,k.LOCAL_FILE_HEADER)?Error("Corrupted zip: can't find end of central directory"):Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(b);var c=b;if(this.checkSignature(k.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===g.MAX_VALUE_16BITS||this.diskWithCentralDirStart===
g.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===g.MAX_VALUE_16BITS||this.centralDirRecords===g.MAX_VALUE_16BITS||this.centralDirSize===g.MAX_VALUE_32BITS||this.centralDirOffset===g.MAX_VALUE_32BITS){if(this.zip64=!0,0>(b=this.reader.lastIndexOfSignature(k.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(b),this.checkSignature(k.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),
!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,k.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(k.ZIP64_CENTRAL_DIRECTORY_END),0>this.relativeOffsetEndOfZip64CentralDir))throw Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(k.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}b=this.centralDirOffset+this.centralDirSize;
this.zip64&&(b+=20,b+=12+this.zip64EndOfCentralSize);b=c-b;if(0<b)this.isSignature(c,k.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(0>b)throw Error("Corrupted zip: missing "+Math.abs(b)+" bytes.");},prepareReader:function(b){this.reader=f(b)},load:function(b){this.prepareReader(b);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};c.exports=e},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(b,c,d){function e(b,
c){this.options=b;this.loadOptions=c}var f=b("./reader/readerFor"),g=b("./utils"),k=b("./compressedObject"),l=b("./crc32"),m=b("./utf8"),n=b("./compressions"),q=b("./support");e.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(b){var c;if(b.skip(22),this.fileNameLength=b.readInt(2),c=b.readInt(2),this.fileName=b.readData(this.fileNameLength),b.skip(c),-1===this.compressedSize||-1===this.uncompressedSize)throw Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");
a:{c=this.compressionMethod;for(d in n)if(n.hasOwnProperty(d)&&n[d].magic===c){var d=n[d];break a}d=null}if(null===d)throw Error("Corrupted zip : compression "+g.pretty(this.compressionMethod)+" unknown (inner file : "+g.transformTo("string",this.fileName)+")");this.decompressed=new k(this.compressedSize,this.uncompressedSize,this.crc32,d,b.readData(this.compressedSize))},readCentralPart:function(b){this.versionMadeBy=b.readInt(2);b.skip(2);this.bitFlag=b.readInt(2);this.compressionMethod=b.readString(2);
this.date=b.readDate();this.crc32=b.readInt(4);this.compressedSize=b.readInt(4);this.uncompressedSize=b.readInt(4);var c=b.readInt(2);if(this.extraFieldsLength=b.readInt(2),this.fileCommentLength=b.readInt(2),this.diskNumberStart=b.readInt(2),this.internalFileAttributes=b.readInt(2),this.externalFileAttributes=b.readInt(4),this.localHeaderOffset=b.readInt(4),this.isEncrypted())throw Error("Encrypted zip are not supported");b.skip(c);this.readExtraFields(b);this.parseZIP64ExtraField(b);this.fileComment=
b.readData(this.fileCommentLength)},processAttributes:function(){this.dosPermissions=this.unixPermissions=null;var b=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes);0==b&&(this.dosPermissions=63&this.externalFileAttributes);3==b&&(this.unixPermissions=this.externalFileAttributes>>16&65535);this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(b){this.extraFields[1]&&(b=f(this.extraFields[1].value),this.uncompressedSize===g.MAX_VALUE_32BITS&&(this.uncompressedSize=
b.readInt(8)),this.compressedSize===g.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===g.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===g.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4)))},readExtraFields:function(b){var c=b.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});b.index+4<c;){var d=b.readInt(2);var e=b.readInt(2);var f=b.readData(e);this.extraFields[d]={id:d,length:e,value:f}}b.setIndex(c)},handleUTF8:function(){var b=
q.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=m.utf8decode(this.fileName),this.fileCommentStr=m.utf8decode(this.fileComment);else{var c=this.findExtraFieldUnicodePath();null!==c?this.fileNameStr=c:(c=g.transformTo(b,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(c));c=this.findExtraFieldUnicodeComment();null!==c?this.fileCommentStr=c:(b=g.transformTo(b,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(b))}},findExtraFieldUnicodePath:function(){var b=
this.extraFields[28789];if(b){var c=f(b.value);return 1!==c.readInt(1)?null:l(this.fileName)!==c.readInt(4)?null:m.utf8decode(c.readData(b.length-5))}return null},findExtraFieldUnicodeComment:function(){var b=this.extraFields[25461];if(b){var c=f(b.value);return 1!==c.readInt(1)?null:l(this.fileComment)!==c.readInt(4)?null:m.utf8decode(c.readData(b.length-5))}return null}};c.exports=e},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],
35:[function(b,c,d){function e(b,c,d){this.name=b;this.dir=d.dir;this.date=d.date;this.comment=d.comment;this.unixPermissions=d.unixPermissions;this.dosPermissions=d.dosPermissions;this._data=c;this._dataBinary=d.binary;this.options={compression:d.compression,compressionOptions:d.compressionOptions}}var f=b("./stream/StreamHelper"),g=b("./stream/DataWorker"),k=b("./utf8"),l=b("./compressedObject"),m=b("./stream/GenericWorker");e.prototype={internalStream:function(b){var c=null,d="string";try{if(!b)throw Error("No output type specified.");
var e="string"===(d=b.toLowerCase())||"text"===d;"binarystring"!==d&&"text"!==d||(d="string");c=this._decompressWorker();var g=!this._dataBinary;g&&!e&&(c=c.pipe(new k.Utf8EncodeWorker));!g&&e&&(c=c.pipe(new k.Utf8DecodeWorker))}catch(u){(c=new m("error")).error(u)}return new f(c,d,"")},async:function(b,c){return this.internalStream(b).accumulate(c)},nodeStream:function(b,c){return this.internalStream(b||"nodebuffer").toNodejsStream(c)},_compressWorker:function(b,c){if(this._data instanceof l&&this._data.compression.magic===
b.magic)return this._data.getCompressedWorker();var d=this._decompressWorker();return this._dataBinary||(d=d.pipe(new k.Utf8EncodeWorker)),l.createWorkerFrom(d,b,c)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof m?this._data:new g(this._data)}};b=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"];d=function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");};for(var n=0;n<b.length;n++)e.prototype[b[n]]=
d;c.exports=e},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(b,c,d){(function(b){function d(){var b;e=!0;for(var c=r.length;c;){var d=r;r=[];for(b=-1;++b<c;)d[b]();c=r.length}e=!1}var e,k=b.MutationObserver||b.WebKitMutationObserver;if(k){var l=0;k=new k(d);var m=b.document.createTextNode("");k.observe(m,{characterData:!0});var n=function(){m.data=l=++l%2}}else if(b.setImmediate||void 0===b.MessageChannel)n="document"in
b&&"onreadystatechange"in b.document.createElement("script")?function(){var c=b.document.createElement("script");c.onreadystatechange=function(){d();c.onreadystatechange=null;c.parentNode.removeChild(c);c=null};b.document.documentElement.appendChild(c)}:function(){setTimeout(d,0)};else{var q=new b.MessageChannel;q.port1.onmessage=d;n=function(){q.port2.postMessage(0)}}var r=[];c.exports=function(b){1!==r.push(b)||e||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:
"undefined"!=typeof window?window:{})},{}],37:[function(b,c,d){function e(){}function f(b){if("function"!=typeof b)throw new TypeError("resolver must be a function");this.state=v;this.queue=[];this.outcome=void 0;b!==e&&m(this,b)}function g(b,c,d){this.promise=b;"function"==typeof c&&(this.onFulfilled=c,this.callFulfilled=this.otherCallFulfilled);"function"==typeof d&&(this.onRejected=d,this.callRejected=this.otherCallRejected)}function k(b,c,d){q(function(){try{var e=c(d)}catch(A){return r.reject(b,
A)}e===b?r.reject(b,new TypeError("Cannot resolve promise with itself")):r.resolve(b,e)})}function l(b){var c=b&&b.then;if(b&&("object"==typeof b||"function"==typeof b)&&"function"==typeof c)return function(){c.apply(b,arguments)}}function m(b,c){function d(c){f||(f=!0,r.reject(b,c))}function e(c){f||(f=!0,r.resolve(b,c))}var f=!1,g=n(function(){c(e,d)});"error"===g.status&&d(g.value)}function n(b,c){var d={};try{d.value=b(c),d.status="success"}catch(D){d.status="error",d.value=D}return d}var q=b("immediate"),
r={},p=["REJECTED"],t=["FULFILLED"],v=["PENDING"];(c.exports=f).prototype.finally=function(b){if("function"!=typeof b)return this;var c=this.constructor;return this.then(function(d){return c.resolve(b()).then(function(){return d})},function(d){return c.resolve(b()).then(function(){throw d;})})};f.prototype.catch=function(b){return this.then(null,b)};f.prototype.then=function(b,c){if("function"!=typeof b&&this.state===t||"function"!=typeof c&&this.state===p)return this;var d=new this.constructor(e);
this.state!==v?k(d,this.state===t?b:c,this.outcome):this.queue.push(new g(d,b,c));return d};g.prototype.callFulfilled=function(b){r.resolve(this.promise,b)};g.prototype.otherCallFulfilled=function(b){k(this.promise,this.onFulfilled,b)};g.prototype.callRejected=function(b){r.reject(this.promise,b)};g.prototype.otherCallRejected=function(b){k(this.promise,this.onRejected,b)};r.resolve=function(b,c){var d=n(l,c);if("error"===d.status)return r.reject(b,d.value);if(d=d.value)m(b,d);else{b.state=t;b.outcome=
c;d=-1;for(var e=b.queue.length;++d<e;)b.queue[d].callFulfilled(c)}return b};r.reject=function(b,c){b.state=p;b.outcome=c;for(var d=-1,e=b.queue.length;++d<e;)b.queue[d].callRejected(c);return b};f.resolve=function(b){return b instanceof this?b:r.resolve(new this(e),b)};f.reject=function(b){var c=new this(e);return r.reject(c,b)};f.all=function(b){function c(b,c){d.resolve(b).then(function(b){k[c]=b;++l!==f||g||(g=!0,r.resolve(n,k))},function(b){g||(g=!0,r.reject(n,b))})}var d=this;if("[object Array]"!==
Object.prototype.toString.call(b))return this.reject(new TypeError("must be an array"));var f=b.length,g=!1;if(!f)return this.resolve([]);for(var k=Array(f),l=0,m=-1,n=new this(e);++m<f;)c(b[m],m);return n};f.race=function(b){if("[object Array]"!==Object.prototype.toString.call(b))return this.reject(new TypeError("must be an array"));var c=b.length,d=!1;if(!c)return this.resolve([]);for(var f=-1,g=new this(e);++f<c;){var k=b[f];this.resolve(k).then(function(b){d||(d=!0,r.resolve(g,b))},function(b){d||
(d=!0,r.reject(g,b))})}return g}},{immediate:36}],38:[function(b,c,d){d={};(0,b("./lib/utils/common").assign)(d,b("./lib/deflate"),b("./lib/inflate"),b("./lib/zlib/constants"));c.exports=d},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(b,c,d){function e(b){if(!(this instanceof e))return new e(b);b=this.options=k.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},b||{});b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:
b.gzip&&0<b.windowBits&&16>b.windowBits&&(b.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new n;this.strm.avail_out=0;var c=g.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(0!==c)throw Error(m[c]);if(b.header&&g.deflateSetHeader(this.strm,b.header),b.dictionary){var d;if(d="string"==typeof b.dictionary?l.string2buf(b.dictionary):"[object ArrayBuffer]"===q.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,0!==(c=g.deflateSetDictionary(this.strm,
d)))throw Error(m[c]);this._dict_set=!0}}function f(b,c){c=new e(c);if(c.push(b,!0),c.err)throw c.msg||m[c.err];return c.result}var g=b("./zlib/deflate"),k=b("./utils/common"),l=b("./utils/strings"),m=b("./zlib/messages"),n=b("./zlib/zstream"),q=Object.prototype.toString;e.prototype.push=function(b,c){var d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;c=c===~~c?c:!0===c?4:0;"string"==typeof b?e.input=l.string2buf(b):"[object ArrayBuffer]"===q.call(b)?e.input=new Uint8Array(b):e.input=
b;e.next_in=0;e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new k.Buf8(f),e.next_out=0,e.avail_out=f),1!==(d=g.deflate(e,c))&&0!==d)return this.onEnd(d),!(this.ended=!0);0!==e.avail_out&&(0!==e.avail_in||4!==c&&2!==c)||("string"===this.options.to?this.onData(l.buf2binstring(k.shrinkBuf(e.output,e.next_out))):this.onData(k.shrinkBuf(e.output,e.next_out)))}while((0<e.avail_in||0===e.avail_out)&&1!==d);return 4===c?(d=g.deflateEnd(this.strm),this.onEnd(d),this.ended=!0,0===d):2!==c||(this.onEnd(0),
!(e.avail_out=0))};e.prototype.onData=function(b){this.chunks.push(b)};e.prototype.onEnd=function(b){0===b&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=k.flattenChunks(this.chunks));this.chunks=[];this.err=b;this.msg=this.strm.msg};d.Deflate=e;d.deflate=f;d.deflateRaw=function(b,c){return(c=c||{}).raw=!0,f(b,c)};d.gzip=function(b,c){return(c=c||{}).gzip=!0,f(b,c)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],
40:[function(b,c,d){function e(b){if(!(this instanceof e))return new e(b);var c=this.options=k.assign({chunkSize:16384,windowBits:0,to:""},b||{});c.raw&&0<=c.windowBits&&16>c.windowBits&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15));!(0<=c.windowBits&&16>c.windowBits)||b&&b.windowBits||(c.windowBits+=32);15<c.windowBits&&48>c.windowBits&&0==(15&c.windowBits)&&(c.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new q;this.strm.avail_out=0;b=g.inflateInit2(this.strm,
c.windowBits);if(b!==m.Z_OK)throw Error(n[b]);this.header=new r;g.inflateGetHeader(this.strm,this.header)}function f(b,c){c=new e(c);if(c.push(b,!0),c.err)throw c.msg||n[c.err];return c.result}var g=b("./zlib/inflate"),k=b("./utils/common"),l=b("./utils/strings"),m=b("./zlib/constants"),n=b("./zlib/messages"),q=b("./zlib/zstream"),r=b("./zlib/gzheader"),p=Object.prototype.toString;e.prototype.push=function(b,c){var d,e,f,n,q,r=this.strm,t=this.options.chunkSize,v=this.options.dictionary,z=!1;if(this.ended)return!1;
c=c===~~c?c:!0===c?m.Z_FINISH:m.Z_NO_FLUSH;"string"==typeof b?r.input=l.binstring2buf(b):"[object ArrayBuffer]"===p.call(b)?r.input=new Uint8Array(b):r.input=b;r.next_in=0;r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new k.Buf8(t),r.next_out=0,r.avail_out=t),(d=g.inflate(r,m.Z_NO_FLUSH))===m.Z_NEED_DICT&&v&&(q="string"==typeof v?l.string2buf(v):"[object ArrayBuffer]"===p.call(v)?new Uint8Array(v):v,d=g.inflateSetDictionary(this.strm,q)),d===m.Z_BUF_ERROR&&!0===z&&(d=m.Z_OK,z=!1),d!==
m.Z_STREAM_END&&d!==m.Z_OK)return this.onEnd(d),!(this.ended=!0);r.next_out&&(0!==r.avail_out&&d!==m.Z_STREAM_END&&(0!==r.avail_in||c!==m.Z_FINISH&&c!==m.Z_SYNC_FLUSH)||("string"===this.options.to?(e=l.utf8border(r.output,r.next_out),f=r.next_out-e,n=l.buf2string(r.output,e),r.next_out=f,r.avail_out=t-f,f&&k.arraySet(r.output,r.output,e,f,0),this.onData(n)):this.onData(k.shrinkBuf(r.output,r.next_out))));0===r.avail_in&&0===r.avail_out&&(z=!0)}while((0<r.avail_in||0===r.avail_out)&&d!==m.Z_STREAM_END);
return d===m.Z_STREAM_END&&(c=m.Z_FINISH),c===m.Z_FINISH?(d=g.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===m.Z_OK):c!==m.Z_SYNC_FLUSH||(this.onEnd(m.Z_OK),!(r.avail_out=0))};e.prototype.onData=function(b){this.chunks.push(b)};e.prototype.onEnd=function(b){b===m.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=k.flattenChunks(this.chunks));this.chunks=[];this.err=b;this.msg=this.strm.msg};d.Inflate=e;d.inflate=f;d.inflateRaw=function(b,c){return(c=c||{}).raw=
!0,f(b,c)};d.ungzip=f},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(b,c,d){b="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;d.assign=function(b){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var d=c.shift();if(d){if("object"!=typeof d)throw new TypeError(d+"must be non-object");for(var e in d)d.hasOwnProperty(e)&&(b[e]=
d[e])}}return b};d.shrinkBuf=function(b,c){return b.length===c?b:b.subarray?b.subarray(0,c):(b.length=c,b)};var e={arraySet:function(b,c,d,e,f){if(c.subarray&&b.subarray)b.set(c.subarray(d,d+e),f);else for(var g=0;g<e;g++)b[f+g]=c[d+g]},flattenChunks:function(b){var c,d;var e=d=0;for(c=b.length;e<c;e++)d+=b[e].length;var f=new Uint8Array(d);e=d=0;for(c=b.length;e<c;e++){var g=b[e];f.set(g,d);d+=g.length}return f}},f={arraySet:function(b,c,d,e,f){for(var g=0;g<e;g++)b[f+g]=c[d+g]},flattenChunks:function(b){return[].concat.apply([],
b)}};d.setTyped=function(b){b?(d.Buf8=Uint8Array,d.Buf16=Uint16Array,d.Buf32=Int32Array,d.assign(d,e)):(d.Buf8=Array,d.Buf16=Array,d.Buf32=Array,d.assign(d,f))};d.setTyped(b)},{}],42:[function(b,c,d){function e(b,c){if(65537>c&&(b.subarray&&k||!b.subarray&&g))return String.fromCharCode.apply(null,f.shrinkBuf(b,c));for(var d="",e=0;e<c;e++)d+=String.fromCharCode(b[e]);return d}var f=b("./common"),g=!0,k=!0;try{String.fromCharCode.apply(null,[0])}catch(m){g=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(m){k=
!1}var l=new f.Buf8(256);for(b=0;256>b;b++)l[b]=252<=b?6:248<=b?5:240<=b?4:224<=b?3:192<=b?2:1;l[254]=l[254]=1;d.string2buf=function(b){var c,d,e,g,k=b.length,l=0;for(e=0;e<k;e++)55296==(64512&(c=b.charCodeAt(e)))&&e+1<k&&56320==(64512&(d=b.charCodeAt(e+1)))&&(c=65536+(c-55296<<10)+(d-56320),e++),l+=128>c?1:2048>c?2:65536>c?3:4;var m=new f.Buf8(l);for(e=g=0;g<l;e++)55296==(64512&(c=b.charCodeAt(e)))&&e+1<k&&56320==(64512&(d=b.charCodeAt(e+1)))&&(c=65536+(c-55296<<10)+(d-56320),e++),128>c?m[g++]=c:
(2048>c?m[g++]=192|c>>>6:(65536>c?m[g++]=224|c>>>12:(m[g++]=240|c>>>18,m[g++]=128|c>>>12&63),m[g++]=128|c>>>6&63),m[g++]=128|63&c);return m};d.buf2binstring=function(b){return e(b,b.length)};d.binstring2buf=function(b){for(var c=new f.Buf8(b.length),d=0,e=c.length;d<e;d++)c[d]=b.charCodeAt(d);return c};d.buf2string=function(b,c){var d,f,g,k=c||b.length,m=Array(2*k);for(c=d=0;c<k;)if(128>(f=b[c++]))m[d++]=f;else if(4<(g=l[f]))m[d++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;1<g&&c<k;)f=f<<6|63&
b[c++],g--;1<g?m[d++]=65533:65536>f?m[d++]=f:(f-=65536,m[d++]=55296|f>>10&1023,m[d++]=56320|1023&f)}return e(m,d)};d.utf8border=function(b,c){var d;(c=c||b.length)>b.length&&(c=b.length);for(d=c-1;0<=d&&128==(192&b[d]);)d--;return 0>d?c:0===d?c:d+l[b[d]]>c?d:c}},{"./common":41}],43:[function(b,c,d){c.exports=function(b,c,d,k){var e=65535&b|0;b=b>>>16&65535|0;for(var f;0!==d;){for(d-=f=2E3<d?2E3:d;b=b+(e=e+c[k++]|0)|0,--f;);e%=65521;b%=65521}return e|b<<16|0}},{}],44:[function(b,c,d){c.exports={Z_NO_FLUSH:0,
Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(b,c,d){var e=function(){for(var b,c=[],d=0;256>d;d++){b=d;for(var e=0;8>e;e++)b=1&b?3988292384^b>>>1:b>>>1;c[d]=b}return c}();
c.exports=function(b,c,d,l){d=l+d;for(b^=-1;l<d;l++)b=b>>>8^e[255&(b^c[l])];return-1^b}},{}],46:[function(b,c,d){function e(b,c){return b.msg=C[c],c}function f(b){for(var c=b.length;0<=--c;)b[c]=0}function g(b){var c=b.state,d=c.pending;d>b.avail_out&&(d=b.avail_out);0!==d&&(D.arraySet(b.output,c.pending_buf,c.pending_out,d,b.next_out),b.next_out+=d,c.pending_out+=d,b.total_out+=d,b.avail_out-=d,c.pending-=d,0===c.pending&&(c.pending_out=0))}function k(b,c){A._tr_flush_block(b,0<=b.block_start?b.block_start:
-1,b.strstart-b.block_start,c);b.block_start=b.strstart;g(b.strm)}function l(b,c){b.pending_buf[b.pending++]=c}function m(b,c){b.pending_buf[b.pending++]=c>>>8&255;b.pending_buf[b.pending++]=255&c}function n(b,c){var d,e,f=b.max_chain_length,g=b.strstart,k=b.prev_length,l=b.nice_match,m=b.strstart>b.w_size-262?b.strstart-(b.w_size-262):0,n=b.window,q=b.w_mask,p=b.prev,r=b.strstart+258,t=n[g+k-1],w=n[g+k];b.prev_length>=b.good_match&&(f>>=2);l>b.lookahead&&(l=b.lookahead);do if(n[(d=c)+k]===w&&n[d+
k-1]===t&&n[d]===n[g]&&n[++d]===n[g+1]){g+=2;for(d++;n[++g]===n[++d]&&n[++g]===n[++d]&&n[++g]===n[++d]&&n[++g]===n[++d]&&n[++g]===n[++d]&&n[++g]===n[++d]&&n[++g]===n[++d]&&n[++g]===n[++d]&&g<r;);if(e=258-(r-g),g=r-258,k<e){if(b.match_start=c,l<=(k=e))break;t=n[g+k-1];w=n[g+k]}}while((c=p[c&q])>m&&0!=--f);return k<=b.lookahead?k:b.lookahead}function q(b){var c,d,e,f,g,k,l,m,n,q=b.w_size;do{if(f=b.window_size-b.lookahead-b.strstart,b.strstart>=q+(q-262)){D.arraySet(b.window,b.window,q,q,0);b.match_start-=
q;b.strstart-=q;b.block_start-=q;for(c=d=b.hash_size;e=b.head[--c],b.head[c]=q<=e?e-q:0,--d;);for(c=d=q;e=b.prev[--c],b.prev[c]=q<=e?e-q:0,--d;);f+=q}if(0===b.strm.avail_in)break;if(g=b.strm,k=b.window,l=b.strstart+b.lookahead,m=f,n=void 0,n=g.avail_in,m<n&&(n=m),d=0===n?0:(g.avail_in-=n,D.arraySet(k,g.input,g.next_in,n,l),1===g.state.wrap?g.adler=w(g.adler,k,n,l):2===g.state.wrap&&(g.adler=F(g.adler,k,n,l)),g.next_in+=n,g.total_in+=n,n),b.lookahead+=d,3<=b.lookahead+b.insert)for(c=b.strstart-b.insert,
b.ins_h=b.window[c],b.ins_h=(b.ins_h<<b.hash_shift^b.window[c+1])&b.hash_mask;b.insert&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[c+3-1])&b.hash_mask,b.prev[c&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=c,c++,b.insert--,!(3>b.lookahead+b.insert)););}while(262>b.lookahead&&0!==b.strm.avail_in)}function r(b,c){for(var d,e;;){if(262>b.lookahead){if(q(b),262>b.lookahead&&0===c)return 1;if(0===b.lookahead)break}if(d=0,3<=b.lookahead&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+3-1])&b.hash_mask,d=
b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),0!==d&&b.strstart-d<=b.w_size-262&&(b.match_length=n(b,d)),3<=b.match_length)if(e=A._tr_tally(b,b.strstart-b.match_start,b.match_length-3),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&3<=b.lookahead){for(b.match_length--;b.strstart++,b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+3-1])&b.hash_mask,d=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart,0!=--b.match_length;);b.strstart++}else b.strstart+=
b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+1])&b.hash_mask;else e=A._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(e&&(k(b,!1),0===b.strm.avail_out))return 1}return b.insert=2>b.strstart?b.strstart:2,4===c?(k(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(k(b,!1),0===b.strm.avail_out)?1:2}function p(b,c){for(var d,e,f;;){if(262>b.lookahead){if(q(b),262>b.lookahead&&0===c)return 1;if(0===b.lookahead)break}if(d=0,
3<=b.lookahead&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+3-1])&b.hash_mask,d=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=2,0!==d&&b.prev_length<b.max_lazy_match&&b.strstart-d<=b.w_size-262&&(b.match_length=n(b,d),5>=b.match_length&&(1===b.strategy||3===b.match_length&&4096<b.strstart-b.match_start)&&(b.match_length=2)),3<=b.prev_length&&b.match_length<=b.prev_length){f=b.strstart+b.lookahead-
3;e=A._tr_tally(b,b.strstart-1-b.prev_match,b.prev_length-3);b.lookahead-=b.prev_length-1;for(b.prev_length-=2;++b.strstart<=f&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+3-1])&b.hash_mask,d=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),0!=--b.prev_length;);if(b.match_available=0,b.match_length=2,b.strstart++,e&&(k(b,!1),0===b.strm.avail_out))return 1}else if(b.match_available){if(A._tr_tally(b,0,b.window[b.strstart-1])&&k(b,!1),b.strstart++,b.lookahead--,0===b.strm.avail_out)return 1}else b.match_available=
1,b.strstart++,b.lookahead--}return b.match_available&&(A._tr_tally(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=2>b.strstart?b.strstart:2,4===c?(k(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(k(b,!1),0===b.strm.avail_out)?1:2}function t(b,c,d,e,f){this.good_length=b;this.max_lazy=c;this.nice_length=d;this.max_chain=e;this.func=f}function v(){this.strm=null;this.status=0;this.pending_buf=null;this.wrap=this.pending=this.pending_out=this.pending_buf_size=0;this.gzhead=null;this.gzindex=
0;this.method=8;this.last_flush=-1;this.w_mask=this.w_bits=this.w_size=0;this.window=null;this.window_size=0;this.head=this.prev=null;this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0;this.dyn_ltree=new D.Buf16(1146);this.dyn_dtree=new D.Buf16(122);
this.bl_tree=new D.Buf16(78);f(this.dyn_ltree);f(this.dyn_dtree);f(this.bl_tree);this.bl_desc=this.d_desc=this.l_desc=null;this.bl_count=new D.Buf16(16);this.heap=new D.Buf16(573);f(this.heap);this.heap_max=this.heap_len=0;this.depth=new D.Buf16(573);f(this.depth);this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function u(b){var c;return b&&b.state?(b.total_in=b.total_out=0,b.data_type=2,(c=b.state).pending=0,c.pending_out=
0,0>c.wrap&&(c.wrap=-c.wrap),c.status=c.wrap?42:113,b.adler=2===c.wrap?0:1,c.last_flush=0,A._tr_init(c),0):e(b,-2)}function x(b){var c=u(b);0===c&&(b=b.state,b.window_size=2*b.w_size,f(b.head),b.max_lazy_match=z[b.level].max_lazy,b.good_match=z[b.level].good_length,b.nice_match=z[b.level].nice_length,b.max_chain_length=z[b.level].max_chain,b.strstart=0,b.block_start=0,b.lookahead=0,b.insert=0,b.match_length=b.prev_length=2,b.match_available=0,b.ins_h=0);return c}function E(b,c,d,f,g,k){if(!b)return-2;
var l=1;if(-1===c&&(c=6),0>f?(l=0,f=-f):15<f&&(l=2,f-=16),1>g||9<g||8!==d||8>f||15<f||0>c||9<c||0>k||4<k)return e(b,-2);8===f&&(f=9);var m=new v;return(b.state=m).strm=b,m.wrap=l,m.gzhead=null,m.w_bits=f,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=g+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new D.Buf8(2*m.w_size),m.head=new D.Buf16(m.hash_size),m.prev=new D.Buf16(m.w_size),m.lit_bufsize=1<<g+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=
new D.Buf8(m.pending_buf_size),m.d_buf=1*m.lit_bufsize,m.l_buf=3*m.lit_bufsize,m.level=c,m.strategy=k,m.method=d,x(b)}var D=b("../utils/common"),A=b("./trees"),w=b("./adler32"),F=b("./crc32"),C=b("./messages");var z=[new t(0,0,0,0,function(b,c){var d=65535;for(d>b.pending_buf_size-5&&(d=b.pending_buf_size-5);;){if(1>=b.lookahead){if(q(b),0===b.lookahead&&0===c)return 1;if(0===b.lookahead)break}b.strstart+=b.lookahead;b.lookahead=0;var e=b.block_start+d;if((0===b.strstart||b.strstart>=e)&&(b.lookahead=
b.strstart-e,b.strstart=e,k(b,!1),0===b.strm.avail_out)||b.strstart-b.block_start>=b.w_size-262&&(k(b,!1),0===b.strm.avail_out))return 1}return b.insert=0,4===c?(k(b,!0),0===b.strm.avail_out?3:4):(b.strstart>b.block_start&&(k(b,!1),b.strm.avail_out),1)}),new t(4,4,8,4,r),new t(4,5,16,8,r),new t(4,6,32,32,r),new t(4,4,16,16,p),new t(8,16,32,32,p),new t(8,16,128,128,p),new t(8,32,128,256,p),new t(32,128,258,1024,p),new t(32,258,258,4096,p)];d.deflateInit=function(b,c){return E(b,c,8,15,8,0)};d.deflateInit2=
E;d.deflateReset=x;d.deflateResetKeep=u;d.deflateSetHeader=function(b,c){return b&&b.state?2!==b.state.wrap?-2:(b.state.gzhead=c,0):-2};d.deflate=function(b,c){var d,n;if(!b||!b.state||5<c||0>c)return b?e(b,-2):-2;if(n=b.state,!b.output||!b.input&&0!==b.avail_in||666===n.status&&4!==c)return e(b,0===b.avail_out?-5:-2);if(n.strm=b,d=n.last_flush,n.last_flush=c,42===n.status)if(2===n.wrap)b.adler=0,l(n,31),l(n,139),l(n,8),n.gzhead?(l(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?
8:0)+(n.gzhead.comment?16:0)),l(n,255&n.gzhead.time),l(n,n.gzhead.time>>8&255),l(n,n.gzhead.time>>16&255),l(n,n.gzhead.time>>24&255),l(n,9===n.level?2:2<=n.strategy||2>n.level?4:0),l(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(l(n,255&n.gzhead.extra.length),l(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(b.adler=F(b.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(l(n,0),l(n,0),l(n,0),l(n,0),l(n,0),l(n,9===n.level?2:2<=n.strategy||2>n.level?4:0),l(n,3),n.status=113);else{var p=
8+(n.w_bits-8<<4)<<8;p|=(2<=n.strategy||2>n.level?0:6>n.level?1:6===n.level?2:3)<<6;0!==n.strstart&&(p|=32);n.status=113;m(n,p+(31-p%31));0!==n.strstart&&(m(n,b.adler>>>16),m(n,65535&b.adler));b.adler=1}if(69===n.status)if(n.gzhead.extra){for(p=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>p&&(b.adler=F(b.adler,n.pending_buf,n.pending-p,p)),g(b),p=n.pending,n.pending!==n.pending_buf_size));)l(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;
n.gzhead.hcrc&&n.pending>p&&(b.adler=F(b.adler,n.pending_buf,n.pending-p,p));n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){p=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>p&&(b.adler=F(b.adler,n.pending_buf,n.pending-p,p)),g(b),p=n.pending,n.pending===n.pending_buf_size)){var r=1;break}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0;l(n,r)}while(0!==r);n.gzhead.hcrc&&n.pending>
p&&(b.adler=F(b.adler,n.pending_buf,n.pending-p,p));0===r&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){p=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>p&&(b.adler=F(b.adler,n.pending_buf,n.pending-p,p)),g(b),p=n.pending,n.pending===n.pending_buf_size)){r=1;break}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0;l(n,r)}while(0!==r);n.gzhead.hcrc&&n.pending>p&&(b.adler=F(b.adler,n.pending_buf,n.pending-
p,p));0===r&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&g(b),n.pending+2<=n.pending_buf_size&&(l(n,255&b.adler),l(n,b.adler>>8&255),b.adler=0,n.status=113)):n.status=113),0!==n.pending){if(g(b),0===b.avail_out)return n.last_flush=-1,0}else if(0===b.avail_in&&(c<<1)-(4<c?9:0)<=(d<<1)-(4<d?9:0)&&4!==c)return e(b,-5);if(666===n.status&&0!==b.avail_in)return e(b,-5);if(0!==b.avail_in||0!==n.lookahead||0!==c&&666!==n.status){d=2===n.strategy?function(b,
c){for(var d;;){if(0===b.lookahead&&(q(b),0===b.lookahead)){if(0===c)return 1;break}if(b.match_length=0,d=A._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++,d&&(k(b,!1),0===b.strm.avail_out))return 1}return b.insert=0,4===c?(k(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(k(b,!1),0===b.strm.avail_out)?1:2}(n,c):3===n.strategy?function(b,c){for(var d,e,f,g,l=b.window;;){if(258>=b.lookahead){if(q(b),258>=b.lookahead&&0===c)return 1;if(0===b.lookahead)break}if(b.match_length=0,3<=b.lookahead&&
0<b.strstart&&(e=l[f=b.strstart-1])===l[++f]&&e===l[++f]&&e===l[++f]){for(g=b.strstart+258;e===l[++f]&&e===l[++f]&&e===l[++f]&&e===l[++f]&&e===l[++f]&&e===l[++f]&&e===l[++f]&&e===l[++f]&&f<g;);b.match_length=258-(g-f);b.match_length>b.lookahead&&(b.match_length=b.lookahead)}if(3<=b.match_length?(d=A._tr_tally(b,1,b.match_length-3),b.lookahead-=b.match_length,b.strstart+=b.match_length,b.match_length=0):(d=A._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++),d&&(k(b,!1),0===b.strm.avail_out))return 1}return b.insert=
0,4===c?(k(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(k(b,!1),0===b.strm.avail_out)?1:2}(n,c):z[n.level].func(n,c);if(3!==d&&4!==d||(n.status=666),1===d||3===d)return 0===b.avail_out&&(n.last_flush=-1),0;if(2===d&&(1===c?A._tr_align(n):5!==c&&(A._tr_stored_block(n,0,0,!1),3===c&&(f(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),g(b),0===b.avail_out))return n.last_flush=-1,0}return 4!==c?0:0>=n.wrap?1:(2===n.wrap?(l(n,255&b.adler),l(n,b.adler>>8&255),l(n,b.adler>>16&255),l(n,
b.adler>>24&255),l(n,255&b.total_in),l(n,b.total_in>>8&255),l(n,b.total_in>>16&255),l(n,b.total_in>>24&255)):(m(n,b.adler>>>16),m(n,65535&b.adler)),g(b),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?0:1)};d.deflateEnd=function(b){var c;return b&&b.state?42!==(c=b.state.status)&&69!==c&&73!==c&&91!==c&&103!==c&&113!==c&&666!==c?e(b,-2):(b.state=null,113===c?e(b,-3):0):-2};d.deflateSetDictionary=function(b,c){var d,e,g;var k=c.length;if(!b||!b.state||2===(e=(d=b.state).wrap)||1===e&&42!==d.status||d.lookahead)return-2;
1===e&&(b.adler=w(b.adler,c,k,0));d.wrap=0;k>=d.w_size&&(0===e&&(f(d.head),d.strstart=0,d.block_start=0,d.insert=0),g=new D.Buf8(d.w_size),D.arraySet(g,c,k-d.w_size,d.w_size,0),c=g,k=d.w_size);g=b.avail_in;var l=b.next_in;var m=b.input;b.avail_in=k;b.next_in=0;b.input=c;for(q(d);3<=d.lookahead;){c=d.strstart;for(k=d.lookahead-2;d.ins_h=(d.ins_h<<d.hash_shift^d.window[c+3-1])&d.hash_mask,d.prev[c&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=c,c++,--k;);d.strstart=c;d.lookahead=2;q(d)}return d.strstart+=
d.lookahead,d.block_start=d.strstart,d.insert=d.lookahead,d.lookahead=0,d.match_length=d.prev_length=2,d.match_available=0,b.next_in=l,b.input=m,b.avail_in=g,d.wrap=e,0};d.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(b,c,d){c.exports=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1}},{}],48:[function(b,c,d){c.exports=
function(b,c){var d,e,f;var m=b.state;var n=b.next_in;var q=b.input;var r=n+(b.avail_in-5);var p=b.next_out;var t=b.output;c=p-(c-b.avail_out);var v=p+(b.avail_out-257);var u=m.dmax;var x=m.wsize;var E=m.whave;var D=m.wnext;var A=m.window;var w=m.hold;var F=m.bits;var C=m.lencode;var z=m.distcode;var J=(1<<m.lenbits)-1;var L=(1<<m.distbits)-1;a:do{15>F&&(w+=q[n++]<<F,F+=8,w+=q[n++]<<F,F+=8);var B=C[w&J];b:for(;;){if(w>>>=d=B>>>24,F-=d,0===(d=B>>>16&255))t[p++]=65535&B;else{if(!(16&d)){if(0==(64&d)){B=
C[(65535&B)+(w&(1<<d)-1)];continue b}if(32&d){m.mode=12;break a}b.msg="invalid literal/length code";m.mode=30;break a}var y=65535&B;(d&=15)&&(F<d&&(w+=q[n++]<<F,F+=8),y+=w&(1<<d)-1,w>>>=d,F-=d);15>F&&(w+=q[n++]<<F,F+=8,w+=q[n++]<<F,F+=8);B=z[w&L];c:for(;;){if(w>>>=d=B>>>24,F-=d,!(16&(d=B>>>16&255))){if(0==(64&d)){B=z[(65535&B)+(w&(1<<d)-1)];continue c}b.msg="invalid distance code";m.mode=30;break a}if(e=65535&B,F<(d&=15)&&(w+=q[n++]<<F,(F+=8)<d&&(w+=q[n++]<<F,F+=8)),u<(e+=w&(1<<d)-1)){b.msg="invalid distance too far back";
m.mode=30;break a}if(w>>>=d,F-=d,(d=p-c)<e){if(E<(d=e-d)&&m.sane){b.msg="invalid distance too far back";m.mode=30;break a}if(f=A,(B=0)===D){if(B+=x-d,d<y){for(y-=d;t[p++]=A[B++],--d;);B=p-e;f=t}}else if(D<d){if(B+=x+D-d,(d-=D)<y){for(y-=d;t[p++]=A[B++],--d;);if(B=0,D<y){for(y-=d=D;t[p++]=A[B++],--d;);B=p-e;f=t}}}else if(B+=D-d,d<y){for(y-=d;t[p++]=A[B++],--d;);B=p-e;f=t}for(;2<y;)t[p++]=f[B++],t[p++]=f[B++],t[p++]=f[B++],y-=3;y&&(t[p++]=f[B++],1<y&&(t[p++]=f[B++]))}else{for(B=p-e;t[p++]=t[B++],t[p++]=
t[B++],t[p++]=t[B++],2<(y-=3););y&&(t[p++]=t[B++],1<y&&(t[p++]=t[B++]))}break}}break}}while(n<r&&p<v);n-=y=F>>3;w&=(1<<(F-=y<<3))-1;b.next_in=n;b.next_out=p;b.avail_in=n<r?r-n+5:5-(n-r);b.avail_out=p<v?v-p+257:257-(p-v);m.hold=w;m.bits=F}},{}],49:[function(b,c,d){function e(b){return(b>>>24&255)+(b>>>8&65280)+((65280&b)<<8)+((255&b)<<24)}function f(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=
0;this.window=null;this.extra=this.offset=this.length=this.bits=this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new q.Buf16(320);this.work=new q.Buf16(288);this.distdyn=this.lendyn=null;this.was=this.back=this.sane=0}function g(b){var c;return b&&b.state?(c=b.state,b.total_in=b.total_out=c.total=0,b.msg="",c.wrap&&(b.adler=1&c.wrap),c.mode=1,c.last=0,c.havedict=0,c.dmax=32768,c.head=null,c.hold=0,c.bits=0,
c.lencode=c.lendyn=new q.Buf32(852),c.distcode=c.distdyn=new q.Buf32(592),c.sane=1,c.back=-1,0):-2}function k(b){var c;return b&&b.state?((c=b.state).wsize=0,c.whave=0,c.wnext=0,g(b)):-2}function l(b,c){var d,e;return b&&b.state?(e=b.state,0>c?(d=0,c=-c):(d=1+(c>>4),48>c&&(c&=15)),c&&(8>c||15<c)?-2:(null!==e.window&&e.wbits!==c&&(e.window=null),e.wrap=d,e.wbits=c,k(b))):-2}function m(b,c){var d,e;return b?(e=new f,(b.state=e).window=null,0!==(d=l(b,c))&&(b.state=null),d):-2}function n(b,c,d,e){var f;
b=b.state;return null===b.window&&(b.wsize=1<<b.wbits,b.wnext=0,b.whave=0,b.window=new q.Buf8(b.wsize)),e>=b.wsize?(q.arraySet(b.window,c,d-b.wsize,b.wsize,0),b.wnext=0,b.whave=b.wsize):(e<(f=b.wsize-b.wnext)&&(f=e),q.arraySet(b.window,c,d-e,f,b.wnext),(e-=f)?(q.arraySet(b.window,c,d-e,e,0),b.wnext=e,b.whave=b.wsize):(b.wnext+=f,b.wnext===b.wsize&&(b.wnext=0),b.whave<b.wsize&&(b.whave+=f))),0}var q=b("../utils/common"),r=b("./adler32"),p=b("./crc32"),t=b("./inffast"),v=b("./inftrees"),u,x,E=!0;d.inflateReset=
k;d.inflateReset2=l;d.inflateResetKeep=g;d.inflateInit=function(b){return m(b,15)};d.inflateInit2=m;d.inflate=function(b,c){var d,f,g,k,l,m,D,y=0,A=new q.Buf8(4),K=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!b||!b.state||!b.output||!b.input&&0!==b.avail_in)return-2;12===(d=b.state).mode&&(d.mode=13);var M=b.next_out;var Q=b.output;var P=b.avail_out;var G=b.next_in;var R=b.input;var N=b.avail_in;var H=d.hold;var I=d.bits;var U=N;var T=P;var V=0;a:for(;;)switch(d.mode){case 1:if(0===d.wrap){d.mode=
13;break}for(;16>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}if(2&d.wrap&&35615===H){A[d.check=0]=255&H;A[1]=H>>>8&255;d.check=p(d.check,A,2,0);I=H=0;d.mode=2;break}if(d.flags=0,d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&H)<<8)+(H>>8))%31){b.msg="incorrect header check";d.mode=30;break}if(8!=(15&H)){b.msg="unknown compression method";d.mode=30;break}if(I-=4,m=8+(15&(H>>>=4)),0===d.wbits)d.wbits=m;else if(m>d.wbits){b.msg="invalid window size";d.mode=30;break}d.dmax=1<<m;b.adler=d.check=1;d.mode=
512&H?10:12;I=H=0;break;case 2:for(;16>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}if(d.flags=H,8!=(255&d.flags)){b.msg="unknown compression method";d.mode=30;break}if(57344&d.flags){b.msg="unknown header flags set";d.mode=30;break}d.head&&(d.head.text=H>>8&1);512&d.flags&&(A[0]=255&H,A[1]=H>>>8&255,d.check=p(d.check,A,2,0));I=H=0;d.mode=3;case 3:for(;32>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}d.head&&(d.head.time=H);512&d.flags&&(A[0]=255&H,A[1]=H>>>8&255,A[2]=H>>>16&255,A[3]=H>>>24&255,d.check=
p(d.check,A,4,0));I=H=0;d.mode=4;case 4:for(;16>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}d.head&&(d.head.xflags=255&H,d.head.os=H>>8);512&d.flags&&(A[0]=255&H,A[1]=H>>>8&255,d.check=p(d.check,A,2,0));I=H=0;d.mode=5;case 5:if(1024&d.flags){for(;16>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}d.length=H;d.head&&(d.head.extra_len=H);512&d.flags&&(A[0]=255&H,A[1]=H>>>8&255,d.check=p(d.check,A,2,0));I=H=0}else d.head&&(d.head.extra=null);d.mode=6;case 6:if(1024&d.flags&&(N<(f=d.length)&&(f=N),f&&(d.head&&
(m=d.head.extra_len-d.length,d.head.extra||(d.head.extra=Array(d.head.extra_len)),q.arraySet(d.head.extra,R,G,f,m)),512&d.flags&&(d.check=p(d.check,R,f,G)),N-=f,G+=f,d.length-=f),d.length))break a;d.length=0;d.mode=7;case 7:if(2048&d.flags){if(0===N)break a;for(f=0;m=R[G+f++],d.head&&m&&65536>d.length&&(d.head.name+=String.fromCharCode(m)),m&&f<N;);if(512&d.flags&&(d.check=p(d.check,R,f,G)),N-=f,G+=f,m)break a}else d.head&&(d.head.name=null);d.length=0;d.mode=8;case 8:if(4096&d.flags){if(0===N)break a;
for(f=0;m=R[G+f++],d.head&&m&&65536>d.length&&(d.head.comment+=String.fromCharCode(m)),m&&f<N;);if(512&d.flags&&(d.check=p(d.check,R,f,G)),N-=f,G+=f,m)break a}else d.head&&(d.head.comment=null);d.mode=9;case 9:if(512&d.flags){for(;16>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}if(H!==(65535&d.check)){b.msg="header crc mismatch";d.mode=30;break}I=H=0}d.head&&(d.head.hcrc=d.flags>>9&1,d.head.done=!0);b.adler=d.check=0;d.mode=12;break;case 10:for(;32>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}b.adler=
d.check=e(H);I=H=0;d.mode=11;case 11:if(0===d.havedict)return b.next_out=M,b.avail_out=P,b.next_in=G,b.avail_in=N,d.hold=H,d.bits=I,2;b.adler=d.check=1;d.mode=12;case 12:if(5===c||6===c)break a;case 13:if(d.last){H>>>=7&I;I-=7&I;d.mode=27;break}for(;3>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}switch(d.last=1&H,--I,3&(H>>>=1)){case 0:d.mode=14;break;case 1:var S=d;if(E){u=new q.Buf32(512);x=new q.Buf32(32);for(g=0;144>g;)S.lens[g++]=8;for(;256>g;)S.lens[g++]=9;for(;280>g;)S.lens[g++]=7;for(;288>g;)S.lens[g++]=
8;v(1,S.lens,0,288,u,0,S.work,{bits:9});for(g=0;32>g;)S.lens[g++]=5;v(2,S.lens,0,32,x,0,S.work,{bits:5});E=!1}S.lencode=u;S.lenbits=9;S.distcode=x;S.distbits=5;if(d.mode=20,6!==c)break;H>>>=2;I-=2;break a;case 2:d.mode=17;break;case 3:b.msg="invalid block type",d.mode=30}H>>>=2;I-=2;break;case 14:H>>>=7&I;for(I-=7&I;32>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}if((65535&H)!=(H>>>16^65535)){b.msg="invalid stored block lengths";d.mode=30;break}if(d.length=65535&H,I=H=0,d.mode=15,6===c)break a;case 15:d.mode=
16;case 16:if(f=d.length){if(N<f&&(f=N),P<f&&(f=P),0===f)break a;q.arraySet(Q,R,G,f,M);N-=f;G+=f;P-=f;M+=f;d.length-=f;break}d.mode=12;break;case 17:for(;14>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}if(d.nlen=257+(31&H),H>>>=5,I-=5,d.ndist=1+(31&H),H>>>=5,I-=5,d.ncode=4+(15&H),H>>>=4,I-=4,286<d.nlen||30<d.ndist){b.msg="too many length or distance symbols";d.mode=30;break}d.have=0;d.mode=18;case 18:for(;d.have<d.ncode;){for(;3>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}d.lens[K[d.have++]]=7&H;H>>>=
3;I-=3}for(;19>d.have;)d.lens[K[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,D={bits:d.lenbits},V=v(0,d.lens,0,19,d.lencode,0,d.work,D),d.lenbits=D.bits,V){b.msg="invalid code lengths set";d.mode=30;break}d.have=0;d.mode=19;case 19:for(;d.have<d.nlen+d.ndist;){for(;y=d.lencode[H&(1<<d.lenbits)-1],k=65535&y,!((g=y>>>24)<=I);){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}if(16>k)H>>>=g,I-=g,d.lens[d.have++]=k;else{if(16===k){for(S=g+2;I<S;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}if(H>>>=g,I-=g,0===d.have){b.msg=
"invalid bit length repeat";d.mode=30;break}m=d.lens[d.have-1];f=3+(3&H);H>>>=2;I-=2}else if(17===k){for(S=g+3;I<S;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}I-=g;m=0;f=3+(7&(H>>>=g));H>>>=3;I-=3}else{for(S=g+7;I<S;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}I-=g;m=0;f=11+(127&(H>>>=g));H>>>=7;I-=7}if(d.have+f>d.nlen+d.ndist){b.msg="invalid bit length repeat";d.mode=30;break}for(;f--;)d.lens[d.have++]=m}}if(30===d.mode)break;if(0===d.lens[256]){b.msg="invalid code -- missing end-of-block";d.mode=30;break}if(d.lenbits=
9,D={bits:d.lenbits},V=v(1,d.lens,0,d.nlen,d.lencode,0,d.work,D),d.lenbits=D.bits,V){b.msg="invalid literal/lengths set";d.mode=30;break}if(d.distbits=6,d.distcode=d.distdyn,D={bits:d.distbits},V=v(2,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,D),d.distbits=D.bits,V){b.msg="invalid distances set";d.mode=30;break}if(d.mode=20,6===c)break a;case 20:d.mode=21;case 21:if(6<=N&&258<=P){b.next_out=M;b.avail_out=P;b.next_in=G;b.avail_in=N;d.hold=H;d.bits=I;t(b,T);M=b.next_out;Q=b.output;P=b.avail_out;G=b.next_in;
R=b.input;N=b.avail_in;H=d.hold;I=d.bits;12===d.mode&&(d.back=-1);break}for(d.back=0;S=(y=d.lencode[H&(1<<d.lenbits)-1])>>>16&255,k=65535&y,!((g=y>>>24)<=I);){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}if(S&&0==(240&S)){var W=g;var X=S;for(l=k;S=(y=d.lencode[l+((H&(1<<W+X)-1)>>W)])>>>16&255,k=65535&y,!(W+(g=y>>>24)<=I);){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}H>>>=W;I-=W;d.back+=W}if(H>>>=g,I-=g,d.back+=g,d.length=k,0===S){d.mode=26;break}if(32&S){d.back=-1;d.mode=12;break}if(64&S){b.msg="invalid literal/length code";
d.mode=30;break}d.extra=15&S;d.mode=22;case 22:if(d.extra){for(S=d.extra;I<S;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}d.length+=H&(1<<d.extra)-1;H>>>=d.extra;I-=d.extra;d.back+=d.extra}d.was=d.length;d.mode=23;case 23:for(;S=(y=d.distcode[H&(1<<d.distbits)-1])>>>16&255,k=65535&y,!((g=y>>>24)<=I);){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}if(0==(240&S)){W=g;X=S;for(l=k;S=(y=d.distcode[l+((H&(1<<W+X)-1)>>W)])>>>16&255,k=65535&y,!(W+(g=y>>>24)<=I);){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}H>>>=W;I-=W;d.back+=
W}if(H>>>=g,I-=g,d.back+=g,64&S){b.msg="invalid distance code";d.mode=30;break}d.offset=k;d.extra=15&S;d.mode=24;case 24:if(d.extra){for(S=d.extra;I<S;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}d.offset+=H&(1<<d.extra)-1;H>>>=d.extra;I-=d.extra;d.back+=d.extra}if(d.offset>d.dmax){b.msg="invalid distance too far back";d.mode=30;break}d.mode=25;case 25:if(0===P)break a;if(f=T-P,d.offset>f){if((f=d.offset-f)>d.whave&&d.sane){b.msg="invalid distance too far back";d.mode=30;break}g=f>d.wnext?(f-=d.wnext,
d.wsize-f):d.wnext-f;f>d.length&&(f=d.length);S=d.window}else S=Q,g=M-d.offset,f=d.length;P<f&&(f=P);P-=f;for(d.length-=f;Q[M++]=S[g++],--f;);0===d.length&&(d.mode=21);break;case 26:if(0===P)break a;Q[M++]=d.length;P--;d.mode=21;break;case 27:if(d.wrap){for(;32>I;){if(0===N)break a;N--;H|=R[G++]<<I;I+=8}if(T-=P,b.total_out+=T,d.total+=T,T&&(b.adler=d.check=d.flags?p(d.check,Q,T,M-T):r(d.check,Q,T,M-T)),T=P,(d.flags?H:e(H))!==d.check){b.msg="incorrect data check";d.mode=30;break}I=H=0}d.mode=28;case 28:if(d.wrap&&
d.flags){for(;32>I;){if(0===N)break a;N--;H+=R[G++]<<I;I+=8}if(H!==(4294967295&d.total)){b.msg="incorrect length check";d.mode=30;break}I=H=0}d.mode=29;case 29:V=1;break a;case 30:V=-3;break a;case 31:return-4;default:return-2}return b.next_out=M,b.avail_out=P,b.next_in=G,b.avail_in=N,d.hold=H,d.bits=I,(d.wsize||T!==b.avail_out&&30>d.mode&&(27>d.mode||4!==c))&&n(b,b.output,b.next_out,T-b.avail_out)?(d.mode=31,-4):(U-=b.avail_in,T-=b.avail_out,b.total_in+=U,b.total_out+=T,d.total+=T,d.wrap&&T&&(b.adler=
d.check=d.flags?p(d.check,Q,T,b.next_out-T):r(d.check,Q,T,b.next_out-T)),b.data_type=d.bits+(d.last?64:0)+(12===d.mode?128:0)+(20===d.mode||15===d.mode?256:0),(0==U&&0===T||4===c)&&0===V&&(V=-5),V)};d.inflateEnd=function(b){if(!b||!b.state)return-2;var c=b.state;return c.window&&(c.window=null),b.state=null,0};d.inflateGetHeader=function(b,c){var d;return b&&b.state?0==(2&(d=b.state).wrap)?-2:((d.head=c).done=!1,0):-2};d.inflateSetDictionary=function(b,c){var d,e=c.length;return b&&b.state?0!==(d=
b.state).wrap&&11!==d.mode?-2:11===d.mode&&r(1,c,e,0)!==d.check?-3:n(b,c,e,e)?(d.mode=31,-4):(d.havedict=1,0):-2};d.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(b,c,d){var e=b("../utils/common"),f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],g=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],k=[1,2,3,4,5,7,
9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];c.exports=function(b,c,d,r,p,t,v,u){var m,n,q,A,w,F=u.bits,C,z,J,L,B,y=0,O,K=null,M=0,Q=new e.Buf16(16);var P=new e.Buf16(16);var G=null,R=0;for(C=0;15>=C;C++)Q[C]=0;for(z=0;z<r;z++)Q[c[d+z]]++;var N=F;for(J=15;1<=J&&0===Q[J];J--);if(J<N&&(N=J),0===J)return p[t++]=20971520,p[t++]=20971520,u.bits=
1,0;for(F=1;F<J&&0===Q[F];F++);N<F&&(N=F);for(C=m=1;15>=C;C++)if(m<<=1,0>(m-=Q[C]))return-1;if(0<m&&(0===b||1!==J))return-1;P[1]=0;for(C=1;15>C;C++)P[C+1]=P[C]+Q[C];for(z=0;z<r;z++)0!==c[d+z]&&(v[P[c[d+z]]++]=z);if(A=0===b?(K=G=v,19):1===b?(K=f,M-=257,G=g,R-=257,256):(K=k,G=l,-1),C=F,P=t,B=z=O=0,q=-1,r=(y=1<<(L=N))-1,1===b&&852<y||2===b&&592<y)return 1;for(;;){var H=C-B;var I=v[z]<A?(w=0,v[z]):v[z]>A?(w=G[R+v[z]],K[M+v[z]]):(w=96,0);m=1<<C-B;for(F=n=1<<L;p[P+(O>>B)+(n-=m)]=H<<24|w<<16|I|0,0!==n;);
for(m=1<<C-1;O&m;)m>>=1;if(0!==m?(O&=m-1,O+=m):O=0,z++,0==--Q[C]){if(C===J)break;C=c[d+v[z]]}if(N<C&&(O&r)!==q){0===B&&(B=N);P+=F;for(m=1<<(L=C-B);L+B<J&&!(0>=(m-=Q[L+B]));)L++,m<<=1;if(y+=1<<L,1===b&&852<y||2===b&&592<y)return 1;p[q=O&r]=N<<24|L<<16|P-t|0}}return 0!==O&&(p[P+O]=C-B<<24|4194304),u.bits=N,0}},{"../utils/common":41}],51:[function(b,c,d){c.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error",
"-6":"incompatible version"}},{}],52:[function(b,c,d){function e(b){for(var c=b.length;0<=--c;)b[c]=0}function f(b,c,d,e,f){this.static_tree=b;this.extra_bits=c;this.extra_base=d;this.elems=e;this.max_length=f;this.has_stree=b&&b.length}function g(b,c){this.dyn_tree=b;this.max_code=0;this.stat_desc=c}function k(b){return 256>b?O[b]:O[256+(b>>>7)]}function l(b,c){b.pending_buf[b.pending++]=255&c;b.pending_buf[b.pending++]=c>>>8&255}function m(b,c,d){b.bi_valid>16-d?(b.bi_buf|=c<<b.bi_valid&65535,l(b,
b.bi_buf),b.bi_buf=c>>16-b.bi_valid,b.bi_valid+=d-16):(b.bi_buf|=c<<b.bi_valid&65535,b.bi_valid+=d)}function n(b,c,d){m(b,d[2*c],d[2*c+1])}function q(b,c){for(var d=0;d|=1&b,b>>>=1,d<<=1,0<--c;);return d>>>1}function r(b,c,d){var e,f=Array(16),g=0;for(e=1;15>=e;e++)f[e]=g=g+d[e-1]<<1;for(d=0;d<=c;d++)e=b[2*d+1],0!==e&&(b[2*d]=q(f[e]++,e))}function p(b){var c;for(c=0;286>c;c++)b.dyn_ltree[2*c]=0;for(c=0;30>c;c++)b.dyn_dtree[2*c]=0;for(c=0;19>c;c++)b.bl_tree[2*c]=0;b.dyn_ltree[512]=1;b.opt_len=b.static_len=
0;b.last_lit=b.matches=0}function t(b){8<b.bi_valid?l(b,b.bi_buf):0<b.bi_valid&&(b.pending_buf[b.pending++]=b.bi_buf);b.bi_buf=0;b.bi_valid=0}function v(b,c,d,e){var f=2*c,g=2*d;return b[f]<b[g]||b[f]===b[g]&&e[c]<=e[d]}function u(b,c,d){for(var e=b.heap[d],f=d<<1;f<=b.heap_len&&(f<b.heap_len&&v(c,b.heap[f+1],b.heap[f],b.depth)&&f++,!v(c,e,b.heap[f],b.depth));)b.heap[d]=b.heap[f],d=f,f<<=1;b.heap[d]=e}function x(b,c,d){var e,f,g,l,p=0;if(0!==b.last_lit)for(;e=b.pending_buf[b.d_buf+2*p]<<8|b.pending_buf[b.d_buf+
2*p+1],f=b.pending_buf[b.l_buf+p],p++,0===e?n(b,f,c):(n(b,(g=K[f])+256+1,c),0!==(l=C[g])&&m(b,f-=M[g],l),n(b,g=k(--e),d),0!==(l=z[g])&&m(b,e-=R[g],l)),p<b.last_lit;);n(b,256,c)}function E(b,c){var d,e,f,g=c.dyn_tree,k=c.stat_desc.static_tree,l=c.stat_desc.has_stree,m=c.stat_desc.elems,n=-1;b.heap_len=0;b.heap_max=573;for(d=0;d<m;d++)0!==g[2*d]?(b.heap[++b.heap_len]=n=d,b.depth[d]=0):g[2*d+1]=0;for(;2>b.heap_len;)g[2*(f=b.heap[++b.heap_len]=2>n?++n:0)]=1,b.depth[f]=0,b.opt_len--,l&&(b.static_len-=
k[2*f+1]);c.max_code=n;for(d=b.heap_len>>1;1<=d;d--)u(b,g,d);for(f=m;d=b.heap[1],b.heap[1]=b.heap[b.heap_len--],u(b,g,1),e=b.heap[1],b.heap[--b.heap_max]=d,b.heap[--b.heap_max]=e,g[2*f]=g[2*d]+g[2*e],b.depth[f]=(b.depth[d]>=b.depth[e]?b.depth[d]:b.depth[e])+1,g[2*d+1]=g[2*e+1]=f,b.heap[1]=f++,u(b,g,1),2<=b.heap_len;);b.heap[--b.heap_max]=b.heap[1];var p,q,t,v,w;d=c.dyn_tree;e=c.max_code;f=c.stat_desc.static_tree;k=c.stat_desc.has_stree;l=c.stat_desc.extra_bits;m=c.stat_desc.extra_base;var x=c.stat_desc.max_length,
H=0;for(t=0;15>=t;t++)b.bl_count[t]=0;d[2*b.heap[b.heap_max]+1]=0;for(c=b.heap_max+1;573>c;c++)x<(t=d[2*d[2*(p=b.heap[c])+1]+1]+1)&&(t=x,H++),d[2*p+1]=t,e<p||(b.bl_count[t]++,v=0,m<=p&&(v=l[p-m]),w=d[2*p],b.opt_len+=w*(t+v),k&&(b.static_len+=w*(f[2*p+1]+v)));if(0!==H){do{for(t=x-1;0===b.bl_count[t];)t--;b.bl_count[t]--;b.bl_count[t+1]+=2;b.bl_count[x]--;H-=2}while(0<H);for(t=x;0!==t;t--)for(p=b.bl_count[t];0!==p;)e<(q=b.heap[--c])||(d[2*q+1]!==t&&(b.opt_len+=(t-d[2*q+1])*d[2*q],d[2*q+1]=t),p--)}r(g,
n,b.bl_count)}function D(b,c,d){var e,f=-1,g=c[1],k=0,l=7,m=4;0===g&&(l=138,m=3);c[2*(d+1)+1]=65535;for(e=0;e<=d;e++){var n=g;g=c[2*(e+1)+1];++k<l&&n===g||(k<m?b.bl_tree[2*n]+=k:0!==n?(n!==f&&b.bl_tree[2*n]++,b.bl_tree[32]++):10>=k?b.bl_tree[34]++:b.bl_tree[36]++,f=n,m=(k=0)===g?(l=138,3):n===g?(l=6,3):(l=7,4))}}function A(b,c,d){var e,f,g=-1,k=c[1],l=0,p=7,q=4;0===k&&(p=138,q=3);for(e=0;e<=d;e++)if(f=k,k=c[2*(e+1)+1],!(++l<p&&f===k)){if(l<q)for(;n(b,f,b.bl_tree),0!=--l;);else 0!==f?(f!==g&&(n(b,
f,b.bl_tree),l--),n(b,16,b.bl_tree),m(b,l-3,2)):10>=l?(n(b,17,b.bl_tree),m(b,l-3,3)):(n(b,18,b.bl_tree),m(b,l-11,7));g=f;q=(l=0)===k?(p=138,3):f===k?(p=6,3):(p=7,4)}}function w(b,c,d,e){m(b,e?1:0,3);t(b);l(b,d);l(b,~d);F.arraySet(b.pending_buf,b.window,c,d,b.pending);b.pending+=d}var F=b("../utils/common"),C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],J=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,
9,6,10,5,11,4,12,3,13,2,14,1,15],B=Array(576);e(B);var y=Array(60);e(y);var O=Array(512);e(O);var K=Array(256);e(K);var M=Array(29);e(M);var Q,P,G,R=Array(30);e(R);var N=!1;d._tr_init=function(b){if(!N){var c,d,e,k=Array(16);for(e=d=0;28>e;e++)for(M[e]=d,c=0;c<1<<C[e];c++)K[d++]=e;K[d-1]=e;for(e=d=0;16>e;e++)for(R[e]=d,c=0;c<1<<z[e];c++)O[d++]=e;for(d>>=7;30>e;e++)for(R[e]=d<<7,c=0;c<1<<z[e]-7;c++)O[256+d++]=e;for(c=0;15>=c;c++)k[c]=0;for(c=0;143>=c;)B[2*c+1]=8,c++,k[8]++;for(;255>=c;)B[2*c+1]=9,
c++,k[9]++;for(;279>=c;)B[2*c+1]=7,c++,k[7]++;for(;287>=c;)B[2*c+1]=8,c++,k[8]++;r(B,287,k);for(c=0;30>c;c++)y[2*c+1]=5,y[2*c]=q(c,5);Q=new f(B,C,257,286,15);P=new f(y,z,0,30,15);G=new f([],J,0,19,7);N=!0}b.l_desc=new g(b.dyn_ltree,Q);b.d_desc=new g(b.dyn_dtree,P);b.bl_desc=new g(b.bl_tree,G);b.bi_buf=0;b.bi_valid=0;p(b)};d._tr_stored_block=w;d._tr_flush_block=function(b,c,d,e){var f,g,k=0;0<b.level?(2===b.strm.data_type&&(b.strm.data_type=function(b){var c,d=4093624447;for(c=0;31>=c;c++,d>>>=1)if(1&
d&&0!==b.dyn_ltree[2*c])return 0;if(0!==b.dyn_ltree[18]||0!==b.dyn_ltree[20]||0!==b.dyn_ltree[26])return 1;for(c=32;256>c;c++)if(0!==b.dyn_ltree[2*c])return 1;return 0}(b)),E(b,b.l_desc),E(b,b.d_desc),k=function(b){var c;D(b,b.dyn_ltree,b.l_desc.max_code);D(b,b.dyn_dtree,b.d_desc.max_code);E(b,b.bl_desc);for(c=18;3<=c&&0===b.bl_tree[2*L[c]+1];c--);return b.opt_len+=3*(c+1)+14,c}(b),f=b.opt_len+3+7>>>3,(g=b.static_len+3+7>>>3)<=f&&(f=g)):f=g=d+5;d+4<=f&&-1!==c?w(b,c,d,e):4===b.strategy||g===f?(m(b,
2+(e?1:0),3),x(b,B,y)):(m(b,4+(e?1:0),3),function(b,c,d,e){var f;m(b,c-257,5);m(b,d-1,5);m(b,e-4,4);for(f=0;f<e;f++)m(b,b.bl_tree[2*L[f]+1],3);A(b,b.dyn_ltree,c-1);A(b,b.dyn_dtree,d-1)}(b,b.l_desc.max_code+1,b.d_desc.max_code+1,k+1),x(b,b.dyn_ltree,b.dyn_dtree));p(b);e&&t(b)};d._tr_tally=function(b,c,d){return b.pending_buf[b.d_buf+2*b.last_lit]=c>>>8&255,b.pending_buf[b.d_buf+2*b.last_lit+1]=255&c,b.pending_buf[b.l_buf+b.last_lit]=255&d,b.last_lit++,0===c?b.dyn_ltree[2*d]++:(b.matches++,c--,b.dyn_ltree[2*
(K[d]+256+1)]++,b.dyn_dtree[2*k(c)]++),b.last_lit===b.lit_bufsize-1};d._tr_align=function(b){m(b,2,3);n(b,256,B);16===b.bi_valid?(l(b,b.bi_buf),b.bi_buf=0,b.bi_valid=0):8<=b.bi_valid&&(b.pending_buf[b.pending++]=255&b.bi_buf,b.bi_buf>>=8,b.bi_valid-=8)}},{"../utils/common":41}],53:[function(b,c,d){c.exports=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=this.avail_out=this.next_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}},
{}],54:[function(b,c,d){c.exports="function"==typeof setImmediate?setImmediate:function(){var b=[].slice.apply(arguments);b.splice(1,0,0);setTimeout.apply(null,b)}},{}]},{},[10])(10)});
var Mailcheck={domainThreshold:2,secondLevelThreshold:2,topLevelThreshold:2,defaultDomains:"msn.com bellsouth.net telus.net comcast.net optusnet.com.au earthlink.net qq.com sky.com icloud.com mac.com sympatico.ca googlemail.com att.net xtra.co.nz web.de cox.net gmail.com ymail.com aim.com rogers.com verizon.net rocketmail.com google.com optonline.net sbcglobal.net aol.com me.com btinternet.com charter.net shaw.ca".split(" "),defaultSecondLevelDomains:"yahoo hotmail mail live outlook gmx".split(" "),
defaultTopLevelDomains:"com com.au com.tw ca co.nz co.uk de fr it ru net org edu gov jp nl kr se eu ie co.il us at be dk hk es gr ch no cz in net net.au info biz mil co.jp sg hu uk".split(" "),run:function(a){a.domains=a.domains||Mailcheck.defaultDomains;a.secondLevelDomains=a.secondLevelDomains||Mailcheck.defaultSecondLevelDomains;a.topLevelDomains=a.topLevelDomains||Mailcheck.defaultTopLevelDomains;a.distanceFunction=a.distanceFunction||Mailcheck.sift4Distance;var b=function(a){return a},c=a.suggested||
b;b=a.empty||b;return(a=Mailcheck.suggest(Mailcheck.encodeEmail(a.email),a.domains,a.secondLevelDomains,a.topLevelDomains,a.distanceFunction))?c(a):b()},suggest:function(a,b,c,d,e){a=a.toLowerCase();a=this.splitEmail(a);if(c&&d&&-1!==c.indexOf(a.secondLevelDomain)&&-1!==d.indexOf(a.topLevelDomain))return!1;if(b=this.findClosestDomain(a.domain,b,e,this.domainThreshold))return b==a.domain?!1:{address:a.address,domain:b,full:a.address+"@"+b};c=this.findClosestDomain(a.secondLevelDomain,c,e,this.secondLevelThreshold);
d=this.findClosestDomain(a.topLevelDomain,d,e,this.topLevelThreshold);return a.domain&&(b=a.domain,e=!1,c&&c!=a.secondLevelDomain&&(b=b.replace(a.secondLevelDomain,c),e=!0),d&&d!=a.topLevelDomain&&""!==a.secondLevelDomain&&(b=b.replace(new RegExp(a.topLevelDomain+"$"),d),e=!0),e)?{address:a.address,domain:b,full:a.address+"@"+b}:!1},findClosestDomain:function(a,b,c,d){d=d||this.topLevelThreshold;var e=1/0,f=null;if(!a||!b)return!1;c||(c=this.sift4Distance);for(var g=0;g<b.length;g++){if(a===b[g])return a;
var k=c(a,b[g]);e>k&&(e=k,f=b[g])}return d>=e&&null!==f?f:!1},sift4Distance:function(a,b,c){if(void 0===c&&(c=5),!a||!a.length)return b?b.length:0;if(!b||!b.length)return a.length;for(var d=a.length,e=b.length,f=0,g=0,k=0,l=0,m=0,n=[];d>f&&e>g;){if(a.charAt(f)==b.charAt(g)){l++;for(var q=!1,r=0;r<n.length;){var p=n[r];if(f<=p.c1||g<=p.c2){(q=Math.abs(g-f)>=Math.abs(p.c2-p.c1))?m++:p.trans||(p.trans=!0,m++);break}f>p.c2&&g>p.c1?n.splice(r,1):r++}n.push({c1:f,c2:g,trans:q})}else for(k+=l,l=0,f!=g&&
(f=g=Math.min(f,g)),q=0;c>q&&(d>f+q||e>g+q);q++){if(d>f+q&&a.charAt(f+q)==b.charAt(g)){f+=q-1;g--;break}if(e>g+q&&a.charAt(f)==b.charAt(g+q)){f--;g+=q-1;break}}f++;g++;(f>=d||g>=e)&&(k+=l,l=0,f=g=Math.min(f,g))}return k+=l,Math.round(Math.max(d,e)-k+m)},splitEmail:function(a){a=null!==a?a.replace(/^\s*/,"").replace(/\s*$/,""):null;a=a.split("@");if(2>a.length)return!1;for(var b=0;b<a.length;b++)if(""===a[b])return!1;b=a.pop();var c=b.split("."),d="",e="";if(0===c.length)return!1;if(1==c.length)e=
c[0];else{d=c[0];for(var f=1;f<c.length;f++)e+=c[f]+".";e=e.substring(0,e.length-1)}return{topLevelDomain:e,secondLevelDomain:d,domain:b,address:a.join("@")}},encodeEmail:function(a){return encodeURI(a).replace("%20"," ").replace("%25","%").replace("%5E","^").replace("%60","`").replace("%7B","{").replace("%7C","|").replace("%7D","}")}};"undefined"!=typeof module&&module.exports&&(module.exports=Mailcheck);"function"==typeof define&&define.amd&&define("mailcheck",[],function(){return Mailcheck});
"undefined"!=typeof window&&window.jQuery&&!function(a){a.fn.mailcheck=function(a){var b=this;if(a.suggested){var d=a.suggested;a.suggested=function(a){d(b,a)}}if(a.empty){var e=a.empty;a.empty=function(){e.call(null,b)}}a.email=this.val();Mailcheck.run(a)}}(jQuery);
function BookmarkUnit(a,b,c,d){if("string"!==typeof a)throw new TypeError("name must be a string");this.name=a;if("string"!==typeof b)throw new TypeError("type must be a string");this.type=b;if("number"!==typeof c)throw new TypeError("order must be a number");this.order=c;if("boolean"!==typeof d)throw TypeError("orderChanged must be a boolean");this.orderChanged=d}function Tab(a,b,c,d){BookmarkUnit.apply(this,[a,b,c,d]);this.content=[]}Tab.prototype=Object.create(BookmarkUnit.prototype);
Tab.prototype.setContent=function(a){if(!(a instanceof BookmarkUnit))throw new TypeError("content must be a Tab or Sheet");this.content.push(a)};function Sheet(a,b,c,d){BookmarkUnit.apply(this,[a,b,c,d])}Sheet.prototype=Object.create(BookmarkUnit.prototype);
function ReportWidget(a){"API"===a.dataSource.type&&(a.dataSource.a=window.ap,a.dataSource.p||(a.dataSource.p=window.path),a.dataSource.si||(a.dataSource.si=window.sheetIndex));mode==BUILDER?(this.x=parseInt(a.layout.x),this.y=parseInt(a.layout.y)):(a.layout.filterDays||(a.layout.filterDays=30),this.now=new Date((new Date).getTime()));a.layout.components||(a.layout.components={});a.id==ctrl.widgetTempId&&ctrl.widgetTempId++;a.id||(a.id=ctrl.widgetTempId,ctrl.widgetTempId++);this.config=a;am4core.addLicense("CH258354907")}
ReportWidget.prototype.removeSelf=function(){this.callback.removeSelfCallback&&this.callback.removeSelfCallback()};
ReportWidget.prototype.renderConfigUI=function(){var a=this,b=this.config,c=b.id;ctrl.widgetFilterActionBuilderObj[c]||(ctrl.widgetFilterActionBuilderObj[c]=ctrl.createWidgetFilterActionBuilder(c));ctrl.widgetFilterActionBuilder=ctrl.widgetFilterActionBuilderObj[c];c=0;a.div&&(c=a.div.scrollTop,a.removeSelf());var d=node("div",null,"widgetBuilder");d.widget=this;a.div=d;d.onclick=function(a){a&&(a.cancelBubble=!0)};d.onmousedown=this.callback.mouseDownCallback;d.onmouseup=this.callback.mouseUpCallback;
var e=node("div",null,"deleteWidget");e.innerHTML='<i class="far fa-times"></i>';e.onclick=function(){a.callback.deleteCallback();ctrl.widgetFilterActionBuilderObj[a.config.id]=null};d.appendChild(e);e=a.getWidgetTopConfig();d.appendChild(e);e=a.getSelectSheetConfig();d.appendChild(e);e=a.getTotalComponentConfig();d.appendChild(e);e=a.getSparklineComponentConfig();d.appendChild(e);e=a.getSplitComponentConfig();d.appendChild(e);b=loadMiniReportFilterAction(d,b);ctrl.currentWidgetFilterDiv=b;ctrl.currentReportWidget=
a;this.callback.positionCallback&&this.callback.positionCallback(d);0<c&&(d.scrollTop=c)};
ReportWidget.prototype.positionInBuilder=function(){var a=this.config;ctrl.nuiAreaTop||(ctrl.nuiAreaTop=$("_1_1").offsetTop);ctrl.nuiAreaLeft||(ctrl.nuiAreaLeft=$("_1_1").offsetLeft);var b=ctrl.nuiAreaLeft,c=this.div;c.style.top=ctrl.nuiAreaTop+nui.nuiPageHeader.offsetHeight+a.layout.y+"px";c.style.left=b+a.layout.x+"px";a=parseInt(this.config.layout.width);b=parseInt(this.config.layout.height);a||(a=ctrl.widgetDefaultWidth+"px");b||(b=ctrl.widgetDefaultHeight+"px");this.w=a;this.h=b;c.style.width=
a;c.style.height=b;nui.main.appendChild(c)};
function loadMiniReportFilterAction(a,b){var c=node("div",null,"componentConfig"),d=node("div","selectFilterFieldPrompt");d.innerHTML=lm.widgetSelectFilterFieldPrompt;d.style.fontSize="11px";a.appendChild(c);mode!=BUILDER||builder.ifListingPage()?(ctrl.widgetFilterActionBuilder.config.items[2].name=lm.widgetThisValue,ctrl.widgetFilterActionBuilder.config.items[2].type="free"):(ctrl.widgetFilterActionBuilder.config.items[2].name=lm.dynamicFilterField3,ctrl.widgetFilterActionBuilder.config.items[2].type="selectFree");
ctrl.widgetFilterActionBuilder.config.items[0].optionPath=b.dataSource.p;ctrl.widgetFilterActionBuilder.config.items[0].optionSheetIndex=b.dataSource.si;ctrl.widgetFilterActionBuilder.config.items[0].optionSheetNoSubtable=!0;ctrl.widgetFilterActionBuilder.config.items[2].optionPath=window.path;ctrl.widgetFilterActionBuilder.config.items[2].optionSheetIndex=window.sheetIndex;b.dataSource.filters||generateDefaultWidgetFilter(b);ctrl.widgetFilterActionBuilder.loadResult(b.dataSource.filters,ctrl.widgetFilterActionBuilder);
ctrl.widgetFilterActionBuilder.renderActionBuilder(c);a=c.querySelector("div");c.insertBefore(d,a);return c}function generateDefaultWidgetFilter(a){if(mode!=BUILDER||builder.ifListingPage()||a.dataSource.p==window.path&&a.dataSource.si==window.sheetIndex)return null;ajaxgetAllowCache("/sims/listLinkedFields.jsp",{a:ap,p:a.dataSource.p,si:a.dataSource.si,sp:window.path,ssi:window.sheetIndex},function(b){(b=JSON.parse(b))&&b.d&&b.stf&&(a.dataSource.filters=b.d+"|1|$"+b.stf)},!0)}
function createSelectASheetElement(a,b){var c=node("select"),d;for(d in accountProfile){var e=accountProfile[d].realName,f=accountProfile[d].nuiFiles,g=node("optgroup");g.label=e;c.appendChild(g);for(var k in f){e=f[k];var l=parseInt(k.split("_")[0]),m=node("option");m.setAttribute("path",d);m.value=l;m.innerHTML=e;g.appendChild(m);a==d&&b==l&&(m.selected=!0)}}return c}ReportWidget.prototype.disposeCharts=function(){this.splitChart&&this.splitChart.dispose();this.sparklineChart&&this.sparklineChart.dispose()};
ReportWidget.prototype.positionInDiv=function(a,b){this.div=this.widgetWrapper=a;a.widget=this;a.innerHTML="";a.appendChild(b);parseInt(this.config.layout.width);parseInt(this.config.layout.height);a.style.overflow="hidden";b.style.position="static";b.style.width="100%";b.style.height="100%"};
ReportWidget.prototype.render=function(a){var b=this;a=[];var c=this.config.dataSource.filters;if(c&&-1!==c.indexOf("$")){c=c.split("&");for(var d=0;d<c.length;d++){var e=c[d].split("|");"$"===e[2].charAt(0)&&biffdata&&(e[2]=biffdata.getFieldValue(parseInt(e[2].substring(1))));a.push(e.join("|"))}}if((c=biffdata?biffdata.filterStatus.getFilterv2String():null)&&0<c.length)for(c=c.split("&"),d=0;d<c.length;d++)a.push(c[d]);0<a.length&&(this.config.dataSource.filters=a.join("&"));postPromise("/sims/report/widget.jsp",
{config:JSON.stringify(this.config)}).then(function(a){a=JSON.parse(a);b.disposeCharts();var c=node("div",null,"widgetContainer");c.onmousedown=function(a){a.cancelBubble=!0};b.callback.positionCallback(c);var d=b.getWidgetTop(a);c.appendChild(d);var e=a.name,f=b.config.layout.components.total,n=b.config.layout.components.sparkline,q=b.config.layout.components.splits;e||(d.style.display="none");if(f){var r=b.getTotalComponent(a);c.appendChild(r)}d=b.getWidgetConfigMenu();c.appendChild(d);if(n){var p=
b.getSparklineComponent(a.data,a.dataPrev);c.appendChild(p)}if(q){var t=b.getSplitComponent(a.splitTotal,a.total);c.appendChild(t)}f?n&&!q?p.style.height="60%":!n&&q?t.style.height=e?"60%":"70%":n||q?e||(t.style.height="45%"):r.style.height="auto":n&&q?(p.style.height="30%",t.style.height=e?"47%":"57%"):n&&!q?p.style.height="75%":!n&&q?t.style.height=e?"75%":"85%":n||q||(r.style.height="auto")})};
ReportWidget.prototype.getSelectSheetConfig=function(){var a=this,b=this.config,c=node("div",null,"componentConfig"),d=node("div",null,"selectWrapper");c.appendChild(d);var e=node("div","selectSheetPrompt","widgetPrompt");e.innerHTML=lm.widgetSelectSheetPrompt;d.appendChild(e);e=createSelectASheetElement(b.dataSource.p,b.dataSource.si);e.id="miniReportSheet";e.onchange=function(){var c=this.options[this.selectedIndex];b.dataSource.p=c.getAttribute("path");b.dataSource.si=c.value;delete b.dataSource.filters;
a.renderConfigUI()};d.appendChild(e);var f=node("div",null,"selectWrapper");c.appendChild(f);var g=node("select","selectFactField");g.onchange=function(){b.dataSource.factField=this.options[this.selectedIndex].value};ajaxgetAllowCache("/sims/listFields.jsp",{a:ap,p:b.dataSource.p,si:b.dataSource.si,prefix:"",nosubtable:!0,numberOnly:!0,df:lm.numOfEntries,dv:-1},function(a){var c=node("div","selectFactFieldPrompt","widgetPrompt");c.innerHTML=lm.widgetSelectFactFieldPrompt;f.appendChild(c);g.innerHTML=
a;a=g.options;c=b.dataSource.factField;for(var d=0;d<a.length;d++){var e=a[d];e.value==c&&(e.selected=!0)}f.appendChild(g)});return c};
ReportWidget.prototype.getWidgetTopConfig=function(){var a=this.config,b=node("div",null,"componentConfig"),c=node("input",null,"miniReportName");c.type="text";c.placeholder=lm.widgetTitle;c.value=a.layout.reportName;c.onmousedown=function(a){a.cancelBubble=!0};c.onfocus=function(){ctrl.outOfNUI=!0};c.onblur=function(){ctrl.outOfNUI=!1;a.layout.reportName=this.value};b.appendChild(c);return b};
ReportWidget.prototype.getWidgetTop=function(a){var b=node("div",null,"widgetTop"),c=node("div",null,"widgetName");c.textContent=a.name;b.appendChild(c);return b};
ReportWidget.prototype.getTotalComponentConfig=function(){var a=node("div",null,"componentConfig"),b=this.getCheckbox(lm.widgetTotal,"total");b.style.height="40px";a.appendChild(b);b=this.getCheckbox(lm.widgetChangeFromPrev,"total","changeFrom",b.firstChild);a.appendChild(b);b=this.getCheckbox(lm.widgetChangePFromPrev,"total","changePFrom",b.firstChild);a.appendChild(b);return a};
ReportWidget.prototype.getWidgetFormatPickerString=function(a,b,c){for(var d=node("select"),e=this.config,f=e.layout.components[a]?e.layout.components[a].format:null,g=0;g<b.length;g++){var k=node("option");f==b[g]&&(k.selected=!0);k.value=b[g];k.innerHTML=c[g];d.appendChild(k)}d.onchange=function(){e.layout.components[a]&&(e.layout.components[a].format=this.options[this.selectedIndex].value)};return d};
ReportWidget.prototype.getSparklineComponentConfig=function(){var a=this,b=this.config,c=node("div",null,"componentConfig"),d=this.getCheckbox(this.getWidgetFormatPickerString("sparkline",["sparkline","bars","bars3d"],[lm.widgetSparkline,lm.widgetBars,lm.widgetBars3D]),"sparkline",null,null,lm.widgetTrend);d.style.height="40px";c.appendChild(d);var e=node("div",null,"selectWrapper");c.appendChild(e);e.style.display=d.firstChild&&!d.firstChild.checked?"none":"";var f=node("select","selectDateField");
f.onchange=function(){b.dataSource.dateField=this.options[this.selectedIndex].value};ajaxgetAllowCache("/sims/listFields.jsp",{a:ap,p:b.dataSource.p,si:b.dataSource.si,prefix:"",nosubtable:!0,dateOnly:!0},function(g){var k=node("div","selectDateFieldPrompt","widgetPrompt");k.innerHTML=lm.widgetSelectDateFieldPrompt;e.appendChild(k);f.innerHTML=g;g=f.options;k=b.dataSource.dateField;for(var l=0;l<g.length;l++){var m=g[l];m.value==k&&(m.selected=!0)}e.appendChild(f);g=a.getCheckbox(lm.widgetCompareWithPrev,
"sparkline","withPrevious",d.firstChild);c.appendChild(g)});return c};
ReportWidget.prototype.getSplitComponentConfig=function(){var a=this.config,b=node("div",null,"componentConfig"),c=this.getCheckbox(this.getWidgetFormatPickerString("splits",["bars","pie","treemap","radar"],[lm.widgetBars,lm.widgetPie,lm.widgetTreemap,lm.widgetRadar]),"splits",null,null,lm.widgetRanking);b.appendChild(c);var d=node("div",null,"selectWrapper");b.appendChild(d);d.style.display=c.firstChild&&!c.firstChild.checked?"none":"";var e=node("select","selectSplitField");e.onchange=function(){a.dataSource.splitField=
this.options[this.selectedIndex].value};ajaxgetAllowCache("/sims/listFields.jsp",{a:ap,p:a.dataSource.p,si:a.dataSource.si,prefix:"",nosubtable:!0,selectOnly:!0},function(b){var c=node("div","selectSplitFieldPrompt","widgetPrompt");c.innerHTML=lm.widgetSelectSplitFieldPrompt;d.appendChild(c);e.innerHTML=b;b=e.options;c=a.dataSource.splitField;for(var f=0;f<b.length;f++){var l=b[f];l.value==c&&(l.selected=!0)}d.appendChild(e)});return b};
ReportWidget.prototype.getWidgetConfigMenu=function(){var a=this,b=this.widgetWrapper,c=node("div",null,"widgetConfig");c.style.fontSize=.04*this.config.layout.width;for(var d=[1,5],e=[1,6],f=[1,5],g={},k=0;k<d.length;g={$jscomp$loop$prop$days$478$665:g.$jscomp$loop$prop$days$478$665},k++){var l=node("span",null,"widgetConfigOption");g.$jscomp$loop$prop$days$478$665=d[k];l.innerHTML=d[k]+lm.dayShort;l.setAttribute("filterDays",g.$jscomp$loop$prop$days$478$665);l.onclick=function(c){return function(){a.config.layout.filterDays=
c.$jscomp$loop$prop$days$478$665;a.render(b)}}(g);c.appendChild(l)}g={};for(k=0;k<e.length;g={$jscomp$loop$prop$days$481$667:g.$jscomp$loop$prop$days$481$667},k++)l=node("span",null,"widgetConfigOption"),g.$jscomp$loop$prop$days$481$667=30*d[k],l.setAttribute("filterDays",g.$jscomp$loop$prop$days$481$667),l.innerHTML=e[k]+lm.monthShort,l.onclick=function(c){return function(){a.config.layout.filterDays=c.$jscomp$loop$prop$days$481$667;a.render(b)}}(g),c.appendChild(l);e=node("span",null,"widgetConfigOption");
var m=dayOfYear();e.setAttribute("filterDays",m);e.innerHTML=lm.yearToDateShort;e.onclick=function(){a.config.layout.filterDays=m;a.render(b)};c.appendChild(e);e={};for(g=0;g<f.length;e={$jscomp$loop$prop$days$484$669:e.$jscomp$loop$prop$days$484$669},g++)k=node("span",null,"widgetConfigOption"),e.$jscomp$loop$prop$days$484$669=365*d[g],k.setAttribute("filterDays",e.$jscomp$loop$prop$days$484$669),k.innerHTML=f[g]+lm.yearShort,k.onclick=function(c){return function(){a.config.layout.filterDays=c.$jscomp$loop$prop$days$484$669;
a.render(b)}}(e),c.appendChild(k);d=node("span",null,"widgetConfigOption");d.innerHTML=lm.maxShort;d.onclick=function(){a.config.layout.filterDays=null;a.render(b)};c.appendChild(d);for(d=0;d<c.childNodes.length;d++)f=c.childNodes[d],f.getAttribute("filterDays")==a.config.layout.filterDays?f.classList.add("widgetConfigOptionSelected"):f.classList.remove("widgetConfigOptionSelected");return c};
function dayOfYear(){var a=new Date,b=new Date(a.getFullYear(),0,0);a=a-b+6E4*(b.getTimezoneOffset()-a.getTimezoneOffset());return Math.floor(a/864E5)}
ReportWidget.prototype.getCheckbox=function(a,b,c,d,e){var f=this,g=this.config,k=node("div",null,"checkboxWrapper"),l=b+"_"+(c||"")+"_ComponentCheckbox",m=node("input",l);m.type="checkbox";var n=g.layout.components[b];k.style.display=d&&!d.checked?"none":"";m.checked=c?n&&n[c]:n;m.onchange=function(){this.checked?c?n[c]=!0:g.layout.components[b]={}:c?delete n[c]:delete g.layout.components[b];f.renderConfigUI()};k.appendChild(m);"string"==typeof a?(e=node("label"),e.htmlFor=l,e.innerHTML=a,k.appendChild(e)):
(e&&(d=node("label"),d.htmlFor=l,d.innerHTML=e,k.appendChild(d)),k.appendChild(a));return k};ReportWidget.prototype.getTotalComponent=function(a){return"gauge"===this.config.layout.components.total.format?this.getTotalGaugeComponent(a):this.getTotalNumberComponent(a)};
ReportWidget.prototype.getTotalNumberComponent=function(a){var b=node("div",null,"widgetTotalDiv"),c=node("div",null,"bigNumber");c.textContent=a.total;c.style.fontSize=.1*this.config.layout.height;b.appendChild(c);var d=a.totalChange.startsWith("-");c=node("div",null,"changes");var e=node("div",null,"totalChange"+(d?" negative":""));e.style.fontSize=.04*this.config.layout.height;e.textContent=a.totalChange;d=node("div",null,"totalChangePercent"+(d?" negative":""));a.totalChangePercent&&(d.textContent=
"("+a.totalChangePercent+")",d.style.fontSize=.04*this.config.layout.height);c.appendChild(e);c.appendChild(d);b.appendChild(c);return b};
ReportWidget.prototype.getSparklineComponent=function(a,b){var c=node("div",null,"widgetSparklineDiv"),d=this.config.layout.components.sparkline.format,e=am4core.create(c,am4charts.XYChart);this.sparklineChart=e;e.padding(0,0,0,0);e.height=am4core.percent(100);var f=e.xAxes.push(new am4charts.DateAxis);f.renderer.grid.template.disabled=!0;f.renderer.labels.template.disabled=!0;f.cursorTooltipEnabled=!1;f=e.xAxes.push(new am4charts.DateAxis);f.renderer.grid.template.disabled=!0;f.renderer.labels.template.disabled=
!0;f.cursorTooltipEnabled=!1;var g=e.yAxes.push(new am4charts.ValueAxis);g.renderer.grid.template.disabled=!0;g.renderer.baseGrid.disabled=!0;g.renderer.labels.template.disabled=!0;g.cursorTooltipEnabled=!1;e.cursor=new am4charts.XYCursor;e.cursor.lineY.disabled=!0;"bars"===d?(d=e.series.push(new am4charts.ColumnSeries),e=e.series.push(new am4charts.ColumnSeries),d.fill=am4core.color("#1a73e8"),d.zIndex=100,d.fillOpacity=.8,e.fill=am4core.color("#DDD"),e.stroke=am4core.color("#DDD"),e.fillOpacity=
.1):"bars3d"===d?(d=e.series.push(new am4charts.ColumnSeries3D),e=e.series.push(new am4charts.ColumnSeries3D),d.fill=am4core.color("#1a73e8"),d.stroke=am4core.color("#1a73e8"),d.zIndex=100,d.fillOpacity=.8,e.fill=am4core.color("#DDD"),e.stroke=am4core.color("#DDD"),e.fillOpacity=.2):(d=e.series.push(new am4charts.LineSeries),d.strokeWidth=2,d.tensionX=.8,d.fillOpacity=.2,e=e.series.push(new am4charts.LineSeries),e.stroke=am4core.color("#AAA"),e.strokeDasharray="3,4",e.strokeWidth=2,e.fillOpacity=
0,e.tensionX=.8);d.tooltip.fontSize="12px";d.tooltipText="{date}: [bold]{value}";d.dataFields.dateX="date";d.dataFields.valueY="value";d.data=a;e.tooltip.fontSize="12px";e.tooltipText="{date}: [bold]{value}";e.dataFields.dateX="date";e.dataFields.valueY="value";e.xAxis=f;e.data=b;a=d.bullets.push(new am4charts.CircleBullet);a.circle.opacity=0;a.circle.propertyFields.opacity="opacity";a.circle.radius=3;return c};
ReportWidget.prototype.getSplitComponent=function(a,b){if("0"===b)return node("div",null,"widgetSplitDiv");var c=this.config.layout.components.splits.format,d=structuredClone(a);"0"!==b&&void 0!==b&&null!==b&&d.forEach(function(a){a.percentageValue=a.value/b*100});var e=structuredClone(a),f=a.reduce(function(a,b){return a+parseInt(b.value)},0);b>f&&e.push({name:getBundleString("other"),value:b-f});return"pie"===c?this.getSplitPieComponent(e):"radar"===c?this.getSplitRadarComponent(a):"treemap"===
c?this.getSplitTreemapComponent(a):this.getSplitBarComponent(d)};ReportWidget.prototype.getSplitTreemapComponent=function(a){var b=node("div",null,"widgetSplitDiv"),c=am4core.create(b,am4charts.TreeMap);c.padding(0,0,0,0);c.height=am4core.percent(100);this.splitChart=c;var d=c.seriesTemplates.create("0").bullets.push(new am4charts.LabelBullet);d.locationY=.5;d.locationX=.5;d.label.text="{name}";d.label.fill=am4core.color("#fff");c.dataFields.value="value";c.dataFields.name="name";c.data=a;return b};
ReportWidget.prototype.getSplitRadarComponent=function(a){var b=node("div",null,"widgetSplitDiv"),c=am4core.create(b,am4charts.RadarChart);c.padding(0,0,0,0);c.height=am4core.percent(100);this.splitChart=c;var d=c.xAxes.push(new am4charts.CategoryAxis);d.renderer.grid.template.location=0;d.dataFields.category="name";d.fontSize=.05*this.config.layout.height;d=c.yAxes.push(new am4charts.ValueAxis);d.fill=am4core.color("#cccccc");d.stroke=null;d.fontSize=.03*this.config.layout.height;d=c.series.push(new am4charts.RadarSeries);
d.dataFields.valueY="value";d.dataFields.categoryX="name";d.strokeWidth=1;d.fillOpacity=.3;d.zIndex=2;c.data=a;return b};
ReportWidget.prototype.getSplitPieComponent=function(a){var b=node("div",null,"widgetSplitDiv"),c=am4core.create(b,am4charts.PieChart);this.splitChart=c;c.height=am4core.percent(100);var d=c.series.push(new am4charts.PieSeries);d.dataFields.category="name";d.dataFields.value="value";d.calculatePercent=!0;d.labels.template.fontSize=.04*this.config.layout.height;d.labels.template.maxWidth=90;d.labels.template.wrap=!0;c.data=a;return b};
ReportWidget.prototype.getSplitBarComponent=function(a){var b=node("div",null,"widgetSplitDiv"),c=am4core.create(b,am4charts.XYChart);this.splitChart=c;c.padding(0,0,0,0);c.height=am4core.percent(100);var d=c.yAxes.push(new am4charts.CategoryAxis);d.renderer.grid.template.location=0;d.dataFields.category="name";d.renderer.minGridDistance=1;d.hidden=!0;d.width=0;d.renderer.inversed=!0;d.renderer.grid.template.disabled=!0;var e=c.xAxes.push(new am4charts.ValueAxis);e.min=0;e.height=0;e.hide();e=c.series.push(new am4charts.ColumnSeries);
e.dataFields.categoryY="name";e.dataFields.valueX="value";e.tooltipText="{valueX.value}";e.columns.template.strokeOpacity=0;e.columns.template.column.cornerRadiusBottomRight=2;e.columns.template.column.cornerRadiusTopRight=2;e.calculatePercent=!0;e.columns.template.adapter.add("fill",function(a,b){return am4core.color("#E1F1F8")});var f=e.bullets.push(new am4charts.LabelBullet);f.label.horizontalCenter="left";f.label.dx=.02*this.config.layout.width;f.label.fontSize=.05*this.config.layout.height;f.label.truncate=
!1;f.label.text="{name}";f.locationX=1;f=e.bullets.push(new am4charts.LabelBullet);f.label.horizontalCenter="right";f.label.dx=.85*this.config.layout.width;f.label.fontSize=.05*this.config.layout.height;f.label.truncate=!1;f.label.text=a[0].percentageValue?"{percentageValue.formatNumber('#.#as')}%":"{values.valueX.percent.formatNumber('#.#as')}%";f.locationX=1;d.sortBySeries=e;c.data=a;return b};ctrl.DAY_MILLI=864E5;
ReportWidget.prototype.getCurrentPeriodMin=function(){return(new Date(this.now.getTime()-ctrl.DAY_MILLI*(this.config.layout.filterDays+1))).getTime()};ReportWidget.prototype.getCurrentPeriodMax=function(){return this.now.getTime()};ReportWidget.prototype.getPrevPeriodMin=function(){return(new Date(this.now.getTime()-ctrl.DAY_MILLI*this.config.layout.filterDays)).getTime()};
ReportWidget.prototype.getPrevPeriodMax=function(){return(new Date(this.now.getTime()-(ctrl.DAY_MILLI*this.config.layout.filterDays*2+1))).getTime()};function loadChartingLibrary(a){window.am4core?a():loadScript("/sims/resources/amcharts4/core.js",function(){loadScript("/sims/resources/amcharts4/charts.js",function(){loadScript("/sims/resources/amcharts4/animated.js",function(){a()})})})}function processWidgets(){0<biffdata.widgetsCount&&loadChartingLibrary(_processWidgets)}
function _processWidgets(){if(mode!==UPDATE){resetWidgetsBrowser();for(var a=biffdata.widgets,b={},c=0;c<a.length;b={$jscomp$loop$prop$widget$671:b.$jscomp$loop$prop$widget$671},c++){var d=a[c],e=parseInt(d.layout.x),f=parseInt(d.layout.y),g=parseInt(d.layout.width),k=parseInt(d.layout.height);g||(g=ctrl.widgetDefaultWidth);k||(k=ctrl.widgetDefaultHeight);var l=node("div",null,"widgetDivEmbed");l.innerHTML='<div style="margin:50px;font-size:18px;"><i class="fa fa-spin fa-spinner"></i></div>';var m=
$("_1_1"),n=m.offsetLeft;l.style.top=m.offsetTop+nui.main.nuicelltable.offsetTop+f+"px";l.style.left=n+e+"px";nui.main.appendChild(l);l.style.width=g+"px";l.style.height=k+"px";biffdata.ifListingPage();b.$jscomp$loop$prop$widget$671=biffdata.widgetObjs[c];b.$jscomp$loop$prop$widget$671||(b.$jscomp$loop$prop$widget$671=new ReportWidget(d),b.$jscomp$loop$prop$widget$671.callback={positionCallback:b.$jscomp$loop$prop$widget$671.positionInDiv.bind(b.$jscomp$loop$prop$widget$671,l),removeSelf:function(a){return function(){a.$jscomp$loop$prop$widget$671.disposeCharts();
l.innerHTML=""}}(b)},biffdata.widgetObjs[c]=b.$jscomp$loop$prop$widget$671);b.$jscomp$loop$prop$widget$671.render(l)}}}function resetWidgetsBuilder(){for(var a=document.getElementsByClassName("widgetBuilder"),b=0;b<a.length;b++)a[b].parentElement===nui.main&&nui.main.removeChild(a[b--])}function resetWidgetsBrowser(){for(var a=0;a<biffdata.widgetObjs.length;a++)biffdata.widgetObjs[a].removeSelf()}
function getDefaultWidgetConfig(){if(mode===BUILDER){var a=ctrl.builderRightKeyEvent;ctrl.nuiAreaTop||(ctrl.nuiAreaTop=$("_1_1").offsetTop);ctrl.nuiAreaLeft||(ctrl.nuiAreaLeft=$("_1_1").offsetLeft);return{dataSource:{type:"API",format:"NumberDateSeries",p:window.path,si:window.sheetIndex},layout:{reportName:"",reportDesc:"",components:{total:{}},x:a.srcElement.cell.offsetLeft+a.layerX-ctrl.nuiAreaLeft,y:a.srcElement.cell.offsetTop+a.layerY-ctrl.nuiAreaTop,width:ctrl.widgetDefaultWidth,height:ctrl.widgetDefaultHeight}}}return{dataSource:{type:"API",
format:"NumberDateSeries"},layout:{reportName:"",reportDesc:"",components:{total:{}}}}}function loadHomeWidgets(){loadChartingLibrary(_loadHomeWidgets)}function _loadHomeWidgets(){var a=new ReportWidget(getDefaultWidgetConfig());a.callback={positionCallback:a.positionInDiv.bind(a,$("homeWidget")),removeSelf:function(){a.disposeCharts();widgetDiv.innerHTML=""}};a.renderConfigUI()}
function HSLCalculator(a,b,c){this.R=a/255;this.B=c/255;this.G=b/255;a=[this.R,this.G,this.B];a=a.sort(function(a,b){return a-b});this.min_RGB=a[0];this.max_RGB=a[2]}HSLCalculator.prototype.getLuminosity=function(){return(this.min_RGB+this.max_RGB)/2};
HSLCalculator.prototype.getHue=function(){var a=this.R,b=this.B,c=this.G,d;a>=c&&c>=b?d=(c-b)/(a-b)*60:c>a&&a>=b?d=60*(2-(a-b)/(c-b)):c>=b&&b>a?d=60*(2+(b-a)/(c-a)):b>c&&c>a?d=60*(4-(c-a)/(b-a)):b>a&&a>=c?d=60*(4+(a-c)/(b-c)):a>=b&&b>c&&(d=60*(6-(b-c)/(a-c)));return isNaN(d)?0:d};HSLCalculator.prototype.getSaturation=function(a){return 1>a?(this.max_RGB-this.min_RGB)/(1-Math.abs(2*a-1)):0};
function toHSL(a){if(null==a)return null;var b=[];try{var c=a.toLowerCase(),d=/[0-9a-f]{6}/g;if(0==c.indexOf("rgb(")){var e=c.replace("rgb","").replace("(","").replace(")","").replaceAll(" ","").split(",");var f=parseInt(e[0]);var g=parseInt(e[1]);var k=parseInt(e[2])}else if(0==c.indexOf("#")&&d.test(c.substring(1)))c=c.substring(1),f=parseInt(c.substring(0,2),16),g=parseInt(c.substring(2,4),16),k=parseInt(c.substring(4,6),16);else if(d.test(c))f=parseInt(c.substring(0,2),16),g=parseInt(c.substring(2,
4),16),k=parseInt(c.substring(4,6),16);else return b;var l=new HSLCalculator(f,g,k),m=l.getHue(),n=l.getLuminosity(),q=l.getSaturation(n);b.push(m);b.push(q);b.push(n)}catch(r){console.warn("Convert "+a+" to HSL failed")}return b}function formatHSL(a,b,c){return"hsl("+a+", "+100*b+"%, "+100*c+"%)"}__doc=document;function $(a){return __doc.getElementById(a)}function $_$(a){return window.parent.document.getElementById(a)}
function toggleLoadingSlider(a){$_$("slider").style.visibility=a?"visible":"hidden";a?$_$("inc").classList.add("inc-animation"):$_$("inc").classList.remove("inc-animation")}function changeLoginMessageDiv(a){$_$("loginMessageDiv").style.backgroundImage='url("'+a+'")'}function goCourse(a){a&&(cancelEventBubble(a),a=a.target.dataset.url)&&(window.location.href=a)}
function finishCourse(a,b){a=b.dataset.courseid;var c={};c.action=b.checked?"add":"remove";c.ni=a;postPromise("/sims/saveCourseProperties.jsp",c)}function toggleContent(a,b){var c=parseInt(window.getComputedStyle(b,null).getPropertyValue("max-height"))||0,d=a.querySelector(".plusIcon");a=a.querySelector(".minusIcon");0<c?(b.style.maxHeight="0",b.style.padding="0",d.style.display="",a.style.display="none"):(b.style.maxHeight=null,b.style.padding=null,d.style.display="none",a.style.display="")}
function toggleTutorialList(a){var b=a.querySelector(".plusIcon");a=a.querySelector(".minusIcon");var c=$("start_tutorialList");"none"===c.style.display?(c.style.display="",b.style.display="none",a.style.display=""):(c.style.display="none",b.style.display="",a.style.display="none")}
function scrollToCoursesTable(a){1==a&&$("required").scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});2==a&&$("elective").scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});3==a&&$("useCases").scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}
function createTocOfArticle(){function a(a){if("DIV"===a.tagName&&"x"!==a.textContent&&!a.querySelector(".fa-times")){var b=node("LI");b.classList.add("tocGroupTitle");b.textContent=a.textContent;c.appendChild(b);a=node("HR");c.appendChild(a)}else if("A"===a.tagName){b=node("li");var d=node("A");d.textContent=a.textContent;d.style.color="#aaa";d.setAttribute("href",a.getAttribute("href"));d.addEventListener("click",function(){$("kbArticleToc").querySelectorAll("a").forEach(function(a){a.style.color=
"#aaa"});this.style.color="#06c"});b.appendChild(d);b.classList.add("sectionName");c.appendChild(b)}}var b=document.querySelector(".docSidebar"),c=$("kbArticleToc");b&&kbArticleToc&&b.childNodes.forEach(function(b){"P"===b.tagName&&b.firstElementChild?a(b.firstElementChild):a(b)})}function showKbSidebar(){$("kbSidebar").style.display="block";$("showKbSidebarIcon").style.display="none";$("hideKbSidebarIcon").style.display=""}
function hideKbSidebar(){$("kbSidebar").style.display="none";$("showKbSidebarIcon").style.display="";$("hideKbSidebarIcon").style.display="none"}function toggleDocSearchAll(a){a.checked?localStorage.setItem("RAGIC_docSearchAll",!0):localStorage.removeItem("RAGIC_docSearchAll")}var timezoneOffset=6E4*dayjs().utcOffset();APPROVAL.CURRENTSTEPINDEX=0;function Workflow(){}
Workflow.prototype.init=function(a){this.resetWorkflow();if(a){a=JSON.parse(a);a.hasOwnProperty("wfId")&&(this.wfId=a.wfId);a.hasOwnProperty("status")&&(this.status=a.status);a.hasOwnProperty("response")&&(this.response=a.response);a.hasOwnProperty("workflowHistory")&&(this.steps=a.workflowHistory.map(function(a){return new WorkflowStep(a)}));a.hasOwnProperty("currentStepIndex")&&(this.currentStepIndex=a.currentStepIndex,APPROVAL.CURRENTSTEPINDEX=this.currentStepIndex+1,this.steps&&0<=this.currentStepIndex&&
(this.currentStep=this.steps[this.currentStepIndex]));a.hasOwnProperty("submitter")&&(this.submitter=a.submitter);a.hasOwnProperty("submitterName")&&(this.submitterName=a.submitterName);if(a.hasOwnProperty("submitDate")){var b=a.submitDate;b&&(this.submitDate=LocalDateTimeToDayjs(b))}a.hasOwnProperty("finishDate")&&(b=a.finishDate)&&(this.finishDate=LocalDateTimeToDayjs(b));a.hasOwnProperty("stepsStatus")&&(this.stepsStatus=a.stepsStatus);a.hasOwnProperty("stepsResponse")&&(this.stepsResponse=a.stepsResponse)}};
Workflow.prototype.resetWorkflow=function(){this.wfId=null;this.response=this.status="N";this.steps=[];this.currentStepIndex=-1;APPROVAL.CURRENTSTEPINDEX=0;this.submitterName=this.submitter=this.currentStep=null;this.finishDate=this.submitDate=NaN;this.stepsResponse=this.stepsStatus=null};
Workflow.prototype.submitValidation=function(a,b){for(var c=this,d=$("wfCreateForm"),e=5<d.elements.length,f=!d.querySelector("#dockbarApproval tbody tr"),g=d.querySelectorAll("select"),k=g.length,l=d.querySelectorAll(".wfSignerDatalistInput"),m=!0;k--;){var n=g[k];if(!n.classList.contains("multiSingers")&&""===n.value){e=!1;break}}var q=[];Array.from(l).forEach(function(a,b){var c=a.value;(a=Array.from(a.list.options).find(function(a){c=c.trim();return a.dataset.value.split("|")[1].trim()===c||a.textContent.trim()===
c}))?q.push(a.dataset.value):m=!1});f&&!b?(floatWinConfirmV2(null,function(){c.submitValidation(a,!0)},function(){},lm.approvalNoStep,"",lm.yes,lm.no,!0),cancelEventBubble(a)):e||b?m?(Array.from(l).forEach(function(a,b){a.value=q[b]}),d.submit()):(floatWin(null,lm.approvalValNotMatched),cancelEventBubble(a)):(floatWin(null,lm.approvalValPrompt),cancelEventBubble(a))};
Workflow.prototype.getWorkflowStep=function(a){var b=a.stepIndex;a=a.stepIndexIsZero;if(isNumeric(b)){if(a)throw new ApprovalError("argumentEqualsToZero","stepIndex");if((b>=this.steps.length||0>b)&&mode!==BUILDER)throw new ApprovalError("notIncludeThisStep");}else return{};return this.steps[b]};var wf=new Workflow;
function WorkflowStep(a){if(a){a.hasOwnProperty("wfsId")&&(this.wfsId=a.wfsId);a.hasOwnProperty("emails")&&(this.emails=a.emails);a.hasOwnProperty("userNames")&&(this.userNames=a.userNames);a.hasOwnProperty("response")&&(this.response=a.response);a.hasOwnProperty("status")&&(this.status=a.status);a.hasOwnProperty("stepName")&&(this.stepName=a.stepName);a.hasOwnProperty("threshold")&&(this.threshold=a.threshold);if(a.hasOwnProperty("actionDate")){var b=a.actionDate;b&&(this.actionDate=LocalDateTimeToDayjs(b))}a.hasOwnProperty("multiApprovers")&&
(this.multiApprovers=a.multiApprovers);a.hasOwnProperty("comment")&&a.hasOwnProperty("comments")&&(this.multiApprovers?this.comments=a.comments:(this.comments={},this.comments[this.emails[0]]=a.comment));a.hasOwnProperty("sig")&&a.hasOwnProperty("sigs")&&(this.multiApprovers?this.sigs=a.sigs:(this.sigs={},this.sigs[this.emails[0]]=a.sig));if(a.hasOwnProperty("signingDateTimes")){var c=a.signingDateTimes;this.signingDateTimes=Object.keys(c).reduce(function(a,b){a[b]=LocalDateTimeToDayjs(c[b]);return a},
{})}a.hasOwnProperty("emailsSigningState")&&(this.emailsSigningState=a.emailsSigningState);a.hasOwnProperty("userNamesSigningState")&&(this.userNamesSigningState=a.userNamesSigningState)}}
function loadWorkflow(){rm($("wfMain"));wf.init(biffdata.wfInfo);var a={a:ap,p:path,fn:sheet,n:biffdata.rootNodeId};biffdata.wfId&&(a.wfId=biffdata.wfId);getPromise("/sims/wf_index.jsp",a).then(function(a){var b=$("wfMain");a?(b.innerHTML=a,b.querySelector("#dockbarApproval")?("true"!==RagicStorage.localStorage.getItem("hide_wfWin")&&($("wfWin").style.display=""),$("wfButton").style.display="",Array.from(document.querySelectorAll("select[name='wfSigner']")).forEach(function(a){var b=BarSelectAgent.modifiedSelector(a.id,
a,a.parentNode,{});b.setAfterSelectOption(function(b){a.value=b.value});if("none"===a.style.display){if(b=document.getElementById(b.id))b.style.display="none"}else a.style.display="none"})):($("wfWin").style.display="none",$("wfButton").style.display="none")):($("wfWin").style.display="none",$("wfButton").style.display="none");Array.from(b.querySelectorAll("i.approvalPlus")).forEach(function(a){initApprovalPlus(a)})})}
function workflowCancel(){wf=new Workflow;biffdata.wfInfo=null;biffdata.wfId&&postPromise("/sims/wf_index.jsp",{act:"cancel",a:ap,p:path,fn:sheet,n:biffdata.rootNodeId,wfId:biffdata.wfId}).then(eval)}function workflowResendNotification(a){if(biffdata.wfId){var b={act:"resend",a:ap,p:path,fn:sheet,n:biffdata.rootNodeId,wfId:biffdata.wfId};a&&(b.resendMail=a);getPromise("/sims/wf_index.jsp",b).then(alert.call(window,"Sent"))}}
function LocalDateTimeToLong(a,b){switch(b?Workflow.TIMEZONE_MODE.utc:""){case Workflow.TIMEZONE_MODE.company:b=companyTimeZoneOffset;break;case Workflow.TIMEZONE_MODE.utc:b=0;break;default:b=companyTimeZoneOffset}return a.add(b,"ms").toDate().getTime()}function LocalDateTimeToDayjs(a){return dayjs().year(a.year).month(a.monthValue-1).date(a.dayOfMonth).hour(a.hour).minute(a.minute).second(a.second)}Workflow.TIMEZONE_MODE={company:1,utc:2};function RagicMainMenu(a){this.sideNavJson=a}
RagicMainMenu.prototype.renderSideNav=function(){$("sidenavMain")&&document.body.removeChild($("sidenavMain"));var a=node("div","sidenavMain","sidenavMain");a.style.left="-500px";document.body.appendChild(a);a.appendChild(getMenuSetDiv());var b=node("ul");a.appendChild(b);for(var c=this.sideNavJson.items,d=0;d<c.length;d++)renderSidenavItem(b,c[d]);setTimeout("$('sidenavMain').style.left=0;",100);b=node("div");b.id="sidenavOverlay";b.className="overlay";b.onclick=ragicMainMenu.hideSideNav;document.body.appendChild(b);
c=node("div","closeSidenavButton","closeSidenavButton");c.style.left=Math.ceil(a.getBoundingClientRect().width)+20+"px";c.innerHTML='<i class="fal fa-times"></i>';b.appendChild(c);setTimeout("$('sidenavOverlay').style.opacity='.75';",100)};RagicMainMenu.prototype.hideSideNav=function(){$("sidenavOverlay")&&($("sidenavMain").style.left="-500px",setTimeout("$('sidenavMain').style.display='none';",1E3),$("sidenavOverlay").style.opacity=0,setTimeout("document.body.removeChild($('sidenavOverlay'));",1E3))};
function renderSidenavLink(a){var b=node("li",null,"sidenavItem"),c;a.icon&&(c=node("i",null,"sidenavIcon "+a.icon));var d=node("a");d.href=a.url;var e=node("div");e.innerText=a.name;d.appendChild(e);c&&b.appendChild(c);b.appendChild(d);c=location.pathname+location.search;e=ap.length+2;a.url&&a.url>e&&-1!=c.indexOf(a.url)&&(d.style.color="#cc0000");return b}
function renderSidenavJs(a){var b=node("li",null,"sidenavItem"),c;a.icon&&(c=node("i",null,"sidenavIcon "+a.icon));var d=node("div");d.innerText=a.name;d.onclick=function(){ragicMainMenu.hideSideNav();eval(a.js)};c&&b.appendChild(c);b.appendChild(d);return b}
function renderSidenavCategory(a){if(a){var b=[],c=node("li",null,"sidenavSeparator");b.push(c);c=node("li",null,"lv1");var d=node("div",null,"sidenavHeader"),e=node("div",null,"sidenavCaret");e.innerHTML='<i id="catIcon_'+a.id+'" class="fas fa-caret-down transitionIt"></i>';e.onclick=function(){toggleSidenavCat(a.id)};c.appendChild(e);d.innerText=a.name;c.appendChild(d);b.push(c);c=node("li","catChildren_"+a.id,"lv1");e.catChildren="catChildren_"+a.id;e=node("ul");c.appendChild(e);d=a.items;for(var f=
0;f<d.length;f++){var g=d[f],k=g.type;"link"===k?e.appendChild(renderSidenavLink(g)):"js"===k&&e.appendChild(renderSidenavJs(g))}b.push(c);return b}}
function toggleSidenavCat(a){var b=$("catChildren_"+a);b&&(10>b.offsetHeight?(b.style.height=b.normalHeight+"px",$("catIcon_"+a).style.transform="rotate(0)",-1!==ctrl.closedSidenavCats.indexOf(a)&&ctrl.closedSidenavCats.splice(a,1)):(b.normalHeight=b.offsetHeight,b.style.height=0,$("catIcon_"+a).style.transform="rotate(-90deg)",-1===ctrl.closedSidenavCats.indexOf(a)&&ctrl.closedSidenavCats.push(a)),ajaxpost("/sims/sharedProperties.jsp",{closedCats:JSON.stringify(ctrl.closedSidenavCats)}))}
function renderSidenavItem(a,b){if(a&&b){var c=b.type;if("category"===c){b=renderSidenavCategory(b);for(c=0;c<b.length;c++)a.appendChild(b[c]),b[c].style.height=b[c].offsetHeight+"px";a=ctrl.closedSidenavCats;0===a.length&&userProperties.closedCats&&(a=JSON.parse(userProperties.closedCats),ctrl.closedSidenavCats=a);if(a)for(b=0;b<a.length;b++)toggleSidenavCat(a[b])}else"link"===c?a.appendChild(renderSidenavLink(b)):"js"===c&&a.appendChild(renderSidenavJs(b))}}
function createNewMenuSet(){var a=prompt("New menu name:");a&&""!==a&&ajaxget("/sims/menu/menuSetUpdate.jsp",{newMenuSetName:a,a:ap},function(a){if(a=JSON.parse(a))if(a.msg&&alert(a.msg),a.updateMenuSetId||0===a.updateMenuSetId)window.editingMenuSetIndex=a.updateMenuSetId;showMenuSetEditor()})}function getMenuSetDiv(){var a=node("div","menuSetDiv","menuSetDiv"),b=node("div","menuSetEditDiv","menuSetEditDiv");b.innerHTML="";b.onclick=showMenuSetEditor;a.appendChild(b);return a}
function showMenuSetEditor(){ragicMainMenu.hideSideNav();floatWin(null,lm.prop_loading,lm.subfunc_newMenuSet,!0);$("floatingWin").style.top="120px";$("floatingWin").style.left="280px";window.editingMenuSetIndex||0===window.editingMenuSetIndex||(window.editingMenuSetIndex=menuSetIndex);getPromise("/sims/menu/menuSetEditor.jsp",{a:ap,msi:window.editingMenuSetIndex}).then(function(a){$("floatingWinContent").innerHTML=a;a=$("orderIcons");var b=$("deleteMenuSet"),c=$("updateMenuSetName"),d=decodeURIComponent($("selectedMenuSetName").value),
e=[];a&&e.push({name:'<i class="fas fa-sort-size-down fa-fw" style="margin-right:8px;"></i>'+a.value,func:function(){updateMenuSetOrder()}});b&&e.push({name:'<i class="fa fa-fw fa-times" style="margin-right:8px;"></i>'+b.value,func:function(){deleteMenuSet()}});c&&e.push({name:'<i class="fas fa-fw fa-edit" style="margin-right:8px;"></i>'+c.value,func:function(){updateMenuSetName(d)}});(new DMenu(e)).attach($("faCog"),3,{scrollableParentId:"floatingWinOuterContent"})})}
function menuSetEditorSelectChange(){window.editingMenuSetIndex=$("menuSetEditorSelect").selectedIndex;showMenuSetEditor()}
function menuSheetChangeTab(a,b){a=$("menuTabEditor"+a);for(var c=$("menuTabEditor"+b),d="true"===$("ifRagicSupport").value,e=["standardzhtw","standard"],f=0;f<a.options.length;f++){var g=a.options[f];if(g&&g.selected){g=g.value.split("_");var k="sheet"===g[0];if(9999<parseInt(g[1])&&(!d||!e.includes(ap))){tooltipV2(a,lm.moveSheetHintModule,3,100);return}if(k&&"Report"===b){tooltipV2(a,lm.moveSheetHintDataSheetNoReport,3,100);return}}}for(b=0;b<a.options.length;b++)d=a.options[b],d.selected&&(a.removeChild(d),
b--,c.appendChild(d))}
function rearrangeTabMenu(a){if(ifFreePack())quickBillChangePlan();else{var b=!0,c=[];a&&(a=JSON.parse(decodeURIComponent(a)),a.groupUnionTabs&&0<a.groupUnionTabs.split(",").length&&(c=a.groupUnionTabs.split(",")),b=a.ifOwner);floatWin(null,lm.prop_loading,lm.subfunc_rearrangeSheets,!0);$("floatingWin").style.top="50px";$("floatingWin").style.left="80px";window.editingMenuSetIndex||0===window.editingMenuSetIndex||(window.editingMenuSetIndex=menuSetIndex);getPromise("/sims/menu/menuEditor.jsp",{a:ap,
msi:window.editingMenuSetIndex}).then(function(a){$("floatingWinContent").innerHTML=a;a={};for(var d in window.accountProfile){a.$jscomp$loop$prop$pathFrom$673=d;var f=$("menuSheetMoveLeftRight"+a.$jscomp$loop$prop$pathFrom$673);if(f){var g=[],k={},l;for(l in window.accountProfile){k.$jscomp$loop$prop$pathTo$675=l;if(a.$jscomp$loop$prop$pathFrom$673!==k.$jscomp$loop$prop$pathTo$675&&"/ragic-setup"!==k.$jscomp$loop$prop$pathTo$675){var m="Report"===k.$jscomp$loop$prop$pathTo$675;if(b||isGroupManagedPath(c,
k.$jscomp$loop$prop$pathTo$675)&&!m){var n=window.accountProfile[k.$jscomp$loop$prop$pathTo$675];g.push({name:m?lm.report:n.realName,func:function(a,b){return function(){menuSheetChangeTab(a.$jscomp$loop$prop$pathFrom$673,b.$jscomp$loop$prop$pathTo$675)}}(a,k)})}}k={$jscomp$loop$prop$pathTo$675:k.$jscomp$loop$prop$pathTo$675}}(new DMenu(g)).attach(f,3,{scrollableParentId:"floatingWinOuterContent"})}a={$jscomp$loop$prop$pathFrom$673:a.$jscomp$loop$prop$pathFrom$673}}})}}
function menuSheetMoveDown(a,b){a=$("menuTabEditor"+a);var c=[];if(b)for(b=a.options.length-1;0<=b;b--){var d=a.options[b];if(d.selected&&!c.includes(d)){if(b>=a.options.length-1)break;a.insertBefore(a.options[b+1],a.options[b]);c.push(d)}}else for(b=0;b<a.options.length;b++)if(d=a.options[b],d.selected&&!c.includes(d)){if(0>=b)break;a.insertBefore(a.options[b],a.options[b-1]);c.push(d)}}
function menuSetMoveDown(a){var b=$("menuSetOrderEditor"),c=[];if(a)for(a=b.options.length-1;0<=a;a--){var d=b.options[a];if(d.selected&&!c.includes(d)){if(a>=b.options.length-1)break;if("/1"===b.options[a+1].getAttribute("path"))break;b.insertBefore(b.options[a+1],b.options[a]);c.push(d)}}else for(a=0;a<b.options.length;a++)if(d=b.options[a],d.selected&&!c.includes(d)){if(0>=a)break;if("/1"===b.options[a-1].getAttribute("path"))break;b.insertBefore(b.options[a],b.options[a-1]);c.push(d)}}
function menuSetTabUpdate(a){var b=$("allAvailableTabs"),c=$("selectedTabs");if(a)for(a=0;a<c.options.length;a++){var d=c.options[a];if(d.selected){if("Report"===d.value){tooltipV2(c,lm.moveAvailableTabsNoReport,3,100);break}d.selected=!1;c.removeChild(d);a--;b.appendChild(d)}}else for(a=0;a<b.options.length;a++)d=b.options[a],d.selected&&(d.selected=!1,b.removeChild(d),a--,c.appendChild(d))}
function menuSetTabMove(a){var b=$("selectedTabs"),c=[];if(a)for(a=b.options.length-1;0<=a;a--){var d=b.options[a];if(d.selected&&!c.includes(d)){if(a>=b.options.length-1)break;b.insertBefore(b.options[a+1],b.options[a]);c.push(d)}}else for(a=0;a<b.options.length;a++)if(d=b.options[a],d.selected&&!c.includes(d)){if(0>=a)break;b.insertBefore(b.options[a],b.options[a-1]);c.push(d)}}
function menuTabEditorSelect(a){for(var b=document.getElementsByName("menuTabEditor"),c=0;c<b.length;c++)if(b[c]!==a)for(var d=0;d<b[c].options.length;d++)b[c].options[d].selected&&(b[c].options[d].selected=!1);b=document.getElementsByName("menuTabButtons");for(c=0;c<b.length;c++)b[c].style.visibility="hidden";a=a.getAttribute("path");$("menuTabButtons"+a).style.visibility=""}function menuSetEditorSelect(){$("menuSetButtons").style.visibility=""}
function saveMenuConfig(a,b){a&&(a.disabled=!0);a={id:$("saveMenuSetId").value,name:$("saveMenuSetName").value,web:!0,mobile:!0};var c=[];a.tabs=c;var d=window.accountProfileForAllPath,e;for(e in d){var f=$("menuTabEditor"+e);if(f){var g={name:d[e].realName,path:e,type:"tab",ragicSetupTab:"/ragic-setup"===e};"Report"===e&&(g.name="$tab_report",g.reportTab=!0);f=f.options;var k=[];g.items=k;for(var l=0;l<f.length;l++){var m=f[l],n=htmlDecode(m.innerHTML),q=m.value.split("_"),r=q[0];"sheet"===r?(m=
m.getAttribute("path"),n={name:n,type:"sheet",path:m,si:parseInt(q[1])},k.push(n)):"report"===r?(n={name:n,type:"report",reportId:parseInt(q[1])},k.push(n)):"url"===r&&(r=m.getAttribute("url"),m=m.dataset.groupsName,n={id:parseInt(q[1]),name:n,type:"url",url:r,groupsName:m},k.push(n))}c.push(g)}}b={a:window.ap,msi:parseInt($("saveMenuSetIndex").value),c:JSON.stringify(a),menuSaveEditTime:b};postPromise("/sims/menu/menuSave.jsp",b).then(function(a){"success"!==a&&a?floatWinWarning("<div>"+a+"</div>",
!1,!0):location.reload()});setTimeout(updateSystemTaskProgress,500)}
function saveMenuSetConfigWithOrder(a,b){a&&(a.disabled=!0);a=[];var c={};c.menuSet=a;var d=$("menuSetOrderEditor");if(d){for(var e=0;e<d.options.length;e++){var f=d.options[e].getAttribute("path");a.push(f)}b={data:JSON.stringify(c),menuSetOrderEditTime:b,a:window.ap};postPromise("/sims/menu/menuSetOrderSave.jsp",b).then(function(a){"success"!==a&&a?floatWinWarning("<div>"+a+"</div>",!1,!0):location.reload()});setTimeout(updateSystemTaskProgress,500)}}
function saveMenuItem(){var a=[],b=$("menuItemPath").value,c="",d=$("menuItemURLName").value,e=$("menuItemURLID").value,f=$("menuItemURLType").value;if("actionButtonURL"===f){var g=JSON.parse($("menuActionButton").value);c=g.buttonURL;g=g.allowGroup.replace("[","").replace("]","").split(",");for(var k=0;k<g.length;k++)a.push(g[k])}else"webURL"===f&&(c=$("menuItemURL").value,g=document.querySelector(".barSelect.barSelect-multiple "),null!=g&&BarSelectAgent.getSelector(g.id).getOption().forEach(function(b){a.push(b.value)}));
ajaxget("/sims/menu/menuItemSave.jsp",{a:ap,msi:window.menuSetIndex,path:b,name:d,url:c,urlId:e,urlType:f,groupsName:a.join()},function(){location.reload()})}
function saveMenuSetConfig(a){a&&(a.disabled=!0);$("menuSetIcons").style.display="none";a=$("selectedTabs").options;for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);a={a:ap,umsi:window.editingMenuSetIndex,paths:JSON.stringify(b)};getPromise("/sims/menu/menuSetUpdate.jsp",a).then(function(a){var b=JSON.parse(a);a="";var c=b.movetoDefault,d=b.movetoUpdate,k='<div style="margin-bottom:8px;">'+lm.reportMoveConfirm+"</div>",l=isArrayNotEmpty(c),m=isArrayNotEmpty(d);if(l||m){a=a+k+"<ul>";if(l){for(k=
0;k<c.length;k++)a+='<li style="margin-bottom: 2px;">'+c[k].reportName+"</li>";b.movetoDefault=JSON.stringify(b.movetoDefault)}if(m){for(c=0;c<d.length;c++)a+='<li style="margin-bottom: 2px;">'+d[c].reportName+"</li>";b.movetoUpdate=JSON.stringify(b.movetoUpdate)}a+="</ul>"}a.length?floatWinWarningWithConfirm(a,function(){updateReportMenuSetIndex(b)},lm.confirm_ok,function(){setTimeout(function(){location.href="/"+ap+"/home/"+b.updateMenuSetId},1E3)},lm.confirm_cancel):(tooltipV2($("v6SidebarShortcut"),
lm.menuSetCreatePrompt,3,1),setTimeout(function(){location.href="/"+ap+"/home/"+b.updateMenuSetId},3E3))})}function isArrayNotEmpty(a){return a&&a.length}function updateReportMenuSetIndex(a){a.a=ap;postPromise("/sims/menu/menuSetReportCheck.jsp",a).then(function(b){tooltipV2($("v6SidebarShortcut"),lm.menuSetCreatePrompt,3,1);setTimeout(function(){location.href="/"+ap+"/home/"+a.updateMenuSetId},3E3)})}
function updateMenuSetName(a){a&&(a=decodeURIComponent(a));(a=prompt("New menu name:",a))&&a.trim()&&getPromise("/sims/menu/menuSetUpdate.jsp",{a:ap,umsi:window.editingMenuSetIndex,editMenuSetName:a}).then(function(a){a=JSON.parse(a);tooltipV2($("v6SidebarShortcut"),lm.menuSetCreatePrompt,3,1);location.href="/"+ap+"/home/"+a.updateMenuSetId})}
function deleteMenuSet(){var a=decodeURIComponent($("deleteWarning").value);floatWinConfirmV3(a,function(){getPromise("/sims/menu/menuSetUpdate.jsp",{a:ap,dmsi:window.editingMenuSetIndex}).then(function(a){location.href="/"+ap})},lm.confirm_ok,function(){setTimeout(function(){location.href="/"+ap},1E3)},lm.confirm_cancel)}
function menuItemClick(a,b,c,d,e,f,g){if(owner){b||(b=window.event);var k;g||(b.which?k=3==b.which:b.button&&(k=2==b.button));if(k||g)k=function(a){a||(a=window.event);cancelEventBubble(a);$("reportDropdown").style.display="none";$("urlDropdown").style.display="none";$("actionButtonUrlDropdown").style.display="none";$("sheetDropdown").style.display="none";var b="report"===f?$("reportDropdown"):"url"===f||"webURL"===f?$("urlDropdown"):"actionButtonURL"===f?$("actionButtonUrlDropdown"):$("sheetDropdown");
b.style.display="";floatingPanels.push(b);var g=b.getBoundingClientRect(),k=a.clientY+getBodyScrolltop()+1;b.style.top=k+g.height>window.innerHeight?k-g.height+"px":k+"px";k=a.clientX+document.documentElement.scrollLeft+1;b.style.left=k+g.width>window.innerWidth?k-g.width+"px":k+"px";b.setAttribute("path",c);b.setAttribute("oldName",e);b.setAttribute("itemId",d);a=a.target;for(g=0;!(a instanceof HTMLDivElement)&&4>g;)a=a.parentNode,g++;"report"===f&&a instanceof HTMLDivElement&&checkDomHaveAttributeValue(a,
"id")&&b.setAttribute("tabPath","/"+a.getAttribute("id").split("/")[1]);ctrl.dropmenuoutDisabled=$("pathDrop"+c)},g?k(b):a.oncontextmenu=k}}function checkDomHaveAttributeValue(a,b){return a.getAttribute(b)&&1<a.getAttribute("id").split("/").length}
function v6TabClick(a,b,c,d,e){if(owner){clearDropWin();b||(b=window.event);var f;e||(b.which?f=3==b.which:b.button&&(f=2==b.button));if(f||e){if("/ragic-setup"==c||"/start"==c||"Report"==c)return!1;f=function(a){a||(a=window.event);cancelEventBubble(a);var b=$("dbDropdown");floatingPanels.push(b);b.style.top=a.clientY+getBodyScrolltop()+1+"px";b.style.left=a.clientX+getBodyScrollleft()+1+"px";b.style.display="";b.setAttribute("path",c);b.setAttribute("oldName",d);b.removeAttribute("itemId")};e?f(b):
a.oncontextmenu=f}}}var lastObj;function goToSheet(){var a=$("sheetDropdown");location.href="/"+ap+a.getAttribute("path")+"/"+a.getAttribute("itemId")}function goToSheetNewWin(){var a=$("sheetDropdown");window.open("/"+ap+a.getAttribute("path")+"/"+a.getAttribute("itemId"),"_blank")}function goToReport(){var a=$("reportDropdown");console.log(a);location.href="/"+ap+"/report/display?id="+a.getAttribute("itemId")+"&tabPath="+a.getAttribute("tabpath")}
function goToReportWin(){var a=$("reportDropdown");window.open("/"+ap+"/report/display?id="+a.getAttribute("itemId")+"&tabPath="+a.getAttribute("tabpath"))}function renameTab(){var a=$("dbDropdown");a=decodeURIComponent(a.getAttribute("oldName"));floatWinPrompt("_renameTab",lm.sheetNewName,lm.rename,a)}
function _renameTab(){var a=$("dbDropdown").getAttribute("path"),b=$("floatWinPromptInput").value.trim();b.length?postPromise("/sims/appUpdate.jsp",{a:ap,nn:b,p:a,update:"",msi:menuSetIndex}).then(eval):$("floatWinPromptInput").value=""}function renameSheet(){var a=$("sheetDropdown");a.getAttribute("path");a.getAttribute("itemId");a=decodeURIComponent(a.getAttribute("oldName"));floatWinPrompt("_renameSheet",lm.sheetNewName,lm.rename,a)}
function _renameSheet(){var a=$("sheetDropdown"),b=a.getAttribute("path"),c=a.getAttribute("itemId");decodeURIComponent(a.getAttribute("oldName"));if(a=$("floatWinPromptInput").value)-1!==a.indexOf("_")||-1!==a.indexOf("/")||-1!==a.indexOf("\\")||-1!==a.indexOf("..")?floatWin(null,lm.sheetInvalidCharacter):a&&""!==a&&(getPromise("/sims/sheet.jsp",{act:"mv",a:ap,p:b,fn:c,n:a}).then(standardJSONResponseProcessor),floatWinClose())}
function createMenuAction(){var a=$("dbDropdown").getAttribute("path");getPromise("/sims/menu/menuActionEditor.jsp",{a:ap,msi:window.menuSetIndex,path:a,urlId:-1,mode:"create"}).then(function(a){floatWin(null,a,lm.subfunc_newAction,!0);$("menuItemURLName")&&$("menuItemURLName").focus()})}
function editMenuAction(){var a=$("actionButtonUrlDropdown"),b=a.getAttribute("path");a=a.getAttribute("itemId");ajaxget("/sims/menu/menuActionEditor.jsp",{a:ap,msi:window.menuSetIndex,path:b,urlId:a,mode:"edit"},function(a){floatWin(null,a,"",!0);$("menuItemURLName")&&$("menuItemURLName").select()})}
function createURL(){var a=$("dbDropdown").getAttribute("path");getPromise("/sims/menu/menuItemEditor.jsp",{a:ap,msi:window.menuSetIndex,path:a,urlId:-1}).then(function(a){floatWin(null,a,lm.subfunc_newURL,!0);$("menuItemURLName")&&$("menuItemURLName").focus();a=$("barSelectContainer");var b=$("bSelect");BarSelectAgent.modifiedSelector("",b,a,{barSelectStyles:{"font-size":"16px",height:"27.33px"}})})}
function editURL(){var a=$("urlDropdown"),b=a.getAttribute("path");a=a.getAttribute("itemId");ajaxget("/sims/menu/menuItemEditor.jsp",{a:ap,msi:window.menuSetIndex,path:b,urlId:a},function(a){floatWin(null,a,"",!0);$("menuItemURLName")&&$("menuItemURLName").select();a=$("barSelectContainer");var b=$("bSelect"),c=$("selectedGroupsName").value,f=BarSelectAgent.modifiedSelector("",b,a,{barSelectStyles:{"font-size":"16px"}});f.options.forEach(function(a){c&&c.includes(a.value)&&f.setOption(a)})})}
function deleteURL(a){var b="actionButtonURL"===a?$("actionButtonUrlDropdown"):$("urlDropdown");a=b.getAttribute("path");b=b.getAttribute("itemId");confirm("Are you sure you want to delete this link?")&&ajaxget("/sims/menu/menuItemSave.jsp",{a:ap,msi:window.menuSetIndex,path:a,durlId:b},function(){location.reload()})}
function deleteReport(a){var b=$("reportDropdown"),c=b.getAttribute("itemId");b=b.getAttribute("tabPath");confirm("Are you sure you want to delete this report?")&&ajaxget("/sims/report/templates/editCommand.jsp",{a:ap,id:c,"delete":"true",menuSetIndex:a,tabPath:b},function(a){location.href="/"+ap+"/home/"+a})}
function renameReport(a){var b=$("reportDropdown"),c=b.getAttribute("itemId"),d=b.getAttribute("tabPath");(b=prompt("Please enter a new name for this report:",decodeURIComponent(b.getAttribute("oldName"))))&&ajaxget("/sims/report/templates/editCommand.jsp",{a:ap,id:c,newName:b,menuSetIndex:a,tabPath:d?d:""},function(){location.reload()})}
function deleteSheet(){if(ifFreePack())quickBillChangePlan();else{var a=$("sheetDropdown"),b=a.getAttribute("path"),c=a.getAttribute("itemId");a=a.getAttribute("oldName")||"";"/ragic-setup"===b?alert(lm.deleteSetup):confirmPromise(lm.deleteSheet.replace("{0}",decHTML(decodeURIComponent(a)))).then(function(){return postPromise("/sims/sheet.jsp",{act:"rm",a:ap,p:b,fn:c,t:(new Date).getTime()})}).then(standardJSONResponseProcessor).catch(emptyFunction)}}
function standardJSONResponseProcessor(a){if(a=JSON.parse(a))a.url?location.href=a.url:a.reload?a.menuIndex||0===a.menuIndex?location.href="/"+ap+"/home/"+a.menuIndex:location.reload():a.msg&&floatWinWarning(a.msg)}
function deleteTab(){if(ifFreePack())quickBillChangePlan();else{var a=$("dbDropdown"),b=a.getAttribute("path");a.getAttribute("oldName");"/ragic-setup"===b?alert(lm.deleteSetup):confirmPromise(lm.deleteApp).then(function(){return postPromise("/sims/editAp.jsp",{a:ap,d:b,menuSetIndex:menuSetIndex,t:(new Date).getTime()})}).then(function(){accountProfile[b].realName===tutorial.getTuDbName()&&RagicStorage.localStorage.removeItem("tuDbName");window.location.href="/"+ap+"/home"}).catch(emptyFunction)}}
function htmlDecode(a){var b=document.createElement("textarea");b.innerHTML=a;return 0===b.childNodes.length?"":b.childNodes[0].nodeValue}function isGroupManagedPath(a,b){return a.length&&-1<a.indexOf(b)}
function updateMenuSetOrder(){ifFreePack()?quickBillChangePlan():(floatWin(null,lm.prop_loading,lm.subfunc_newMenuSet,!0),$("floatingWin").style.top="50px",$("floatingWin").style.left="80px",getPromise("/sims/menu/menuSetEditorOrder.jsp",{a:ap}).then(function(a){$("floatingWinContent").innerHTML=a}))}
var ragicMainMenu=new RagicMainMenu(window.ragicMainMenuDef),BarSelectAgent=function(){function a(a,b,c,d,e){this.id=a;this.options=b;this.parent=c;this.customProperties=d;this.spread=!1;this.filterValue="";this.multiple=e;this.renderOptionLimit=1E4;this.searchMode=!0;this.render()}function b(a,b){var c=!!a&&!b;a=a||{disabled:!1,label:"",dataset:{}};b=b||{value:"",text:"",selected:!1,disabled:!1,dataset:{}};return{value:b.value,text:b.text,selected:b.selected,disabled:a.disabled||b.disabled,title:b.title,
optionGroup:a.label,isOptionGroup:c,groupDataset:a.dataset,optionDataset:b.dataset,display:"show"}}function c(a){var c=[];a instanceof HTMLSelectElement?Array.from(a.children).forEach(function(a){"OPTGROUP"===a.tagName?(c.push(b(a,null)),Array.from(a.children).forEach(function(d){c.push(b(a,d))})):c.push(b(null,a))}):console.error(TypeError("Argument is not a select."));return c}function d(a){cancelEventBubble(a);var b=a.target;if("option"===b.dataset.role&&b.classList.contains("barSelect-option")&&
"true"!==b.dataset.disabled){a=f.getSelector(k);var c=a.options.filter(function(a){return!a.isOptionGroup}).find(function(a){var c=void 0!==b.dataset.issubtable?a.optionDataset.issubtable===b.dataset.issubtable+"":!0;return a.value===b.dataset.value&&c});c?a.multiple?(a.toggleOption(c),a.processFilter(),a.renderOptions()):(a.setOption(c),a.filterValue="",a.processFilter(),a.toggle()):console.error(ReferenceError("Non-existent option"))}}function e(a){Object.keys(g).forEach(function(b){a.hasOwnProperty(b)||
(a[b]="object"===typeof g[b]?Object.assign({},g[b]):g[b])})}var f={selectors:{}},g={value:"",text:"",selected:!1,disabled:!1,display:"show",title:"",optionGroup:"",isOptionGroup:!1,groupDataset:[],optionDataset:[],customProperties:{}},k="",l=0;f.createSelector=function(b,c,d,g,k){b||(b="barSelect"+l++);c.forEach(e);c=new a(b,c,d,g,k);return f.selectors[b]=c};f.modifiedSelector=function(a,b,d,e){var g=c(b);return f.createSelector(a,g,d,e,b.multiple)};f.hasSelector=function(a){return f.selectors.hasOwnProperty(a)};
f.getSelector=function(a){a=f.selectors[a];return a?a:(console.error(ReferenceError("Selector does not exist.")),null)};f.removeSelector=function(a){var b=f.selectors[a];b?(b.dispose(),f.selectors[a]=null,delete f.selectors[a],k===a&&(k="")):console.error(ReferenceError("Selector does not exist."))};f.addNewOption=function(a,b){(a=f.selectors[a])?a.addNewOption(b):console.error(ReferenceError("Selector does not exist."))};document.addEventListener("click",function(a){a.target.classList.contains("barSelect-search")||
k&&f.getSelector(k).toggle()});a.prototype.setOption=function(a){if(!this.beforeSelectOption||this.beforeSelectOption(a)){var b=this.getOption();b&&(b.selected=!1);a.selected=!0;this.updateDisplayValue();this.afterSelectOption&&this.afterSelectOption(a)}};a.prototype.toggleOption=function(a){if(!this.beforeSelectOption||this.beforeSelectOption(a))a.selected=!a.selected,this.updateDisplayValue(),this.afterSelectOption&&this.afterSelectOption(a)};a.prototype.getOption=function(){return this.multiple?
this.options.filter(function(a){return a.selected}):this.options.find(function(a){return a.selected})};a.prototype.getSelectedOptionLength=function(){var a=this.getOption();return Array.isArray(a)?a.length:a?1:0};a.prototype.updateDisplayValue=function(){var a=this.element.querySelector(".barSelect-selection-value");if(this.multiple){var b=this;a.textContent="";this.getOption().forEach(function(c){var d=document.createElement("span");d.classList.add("barSelect-selection-value-span");d.textContent=
c.text;a.appendChild(d);d.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();k&&f.getSelector(k).toggle();b.toggleOption(c);b.spread&&b.renderOptions()})})}else a.textContent=(this.getOption()||{text:""}).text};a.prototype.updateOptionsBySelect=function(a){this.options=c(a);this.updateDisplayValue()};a.prototype.dispose=function(){this.id="";this.onAddNewOption=this.onFilter=this.afterSelectOption=this.beforeSelectOption=this.onToggleDropdown=this.spread=this.customProperties=
this.parent=this.element=this.options=null};a.prototype.render=function(){this.element=document.createElement("div");this.element.id=this.id;this.element.classList.add("barSelect");this.multiple&&this.element.classList.add("barSelect-multiple");this.element.addEventListener("click",cancelEventBubble);var a=document.createElement("div");a.classList.add("barSelect-selection");a.addEventListener("click",this.toggle.bind(this));var b=document.createElement("div");b.classList.add("barSelect-selection-value");
var c=document.createElement("span");c.classList.add("selection-icon");this.parent.appendChild(this.element);this.element.appendChild(a);a.appendChild(b);a.appendChild(c);this.updateDisplayValue();if(this.customProperties.hasOwnProperty("barSelectStyles"))for(var d in this.customProperties.barSelectStyles)this.element.style[d]=this.customProperties.barSelectStyles[d];this.customProperties.hasOwnProperty("barSelectClasses")&&this.customProperties.barSelectClasses.forEach(function(a){this.element.classList.add(a)}.bind(this))};
a.prototype.renderDropdown=function(){var a=this;document.querySelector(".barSelect-dropDown")&&document.body.removeChild(document.querySelector(".barSelect-dropDown"));var b=document.createElement("div");b.classList.add("barSelect-dropDown");this.multiple&&b.classList.add("barSelect-multiple");var c=document.createElement("div"),e=document.createElement("input");c.classList.add("barSelect-search-wrapper");c.appendChild(e);e.placeholder="Search...";e.classList.add("barSelect-search");e.title="Please key something to search option.";
e.onfocus=function(){outNUI()};e.onblur=function(){inNUI()};e.addEventListener("input",function(){a.filterValue=e.value;a.processFilter();a.renderOptions()});e.addEventListener("keydown",function(a){function b(b){a.preventDefault();a.stopPropagation();var c=document.querySelector(".barSelect-dropDown"),d=c.querySelectorAll('.barSelect-option[data-role="option"][data-disabled="false"]');if(d.length){var e=Array.from(d).findIndex(function(a){return a.classList.contains("focus")});b?(d[e].classList.remove("focus"),
b=e+b,b>d.length-1?b=0:0>b&&(b=d.length-1),d[b].classList.add("focus"),d[b].scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})):(c.scrollTop=0,triggerEvent(d[e],"click"))}}switch(a.key){case "Enter":b(0);break;case "ArrowUp":b(-1);break;case "ArrowDown":b(1)}});var f=document.createElement("ul");f.classList.add("barSelect-options");f.addEventListener("click",d);f.addEventListener("mouseover",function(a){a=a.target;if("option"===a.dataset.role&&"false"===a.dataset.disabled){var b=
f.querySelector(".focus");b&&b.classList.remove("focus");a.classList.add("focus")}});document.body.appendChild(b);this.searchMode&&b.appendChild(c);b.appendChild(f);this.renderOptions()};a.prototype.renderOptions=function(){var a=document.querySelector(".barSelect-dropDown").querySelector(".barSelect-options");a.textContent="";var b=0,c=this.getRenderOptionLimit();this.options.filter(function(a){return"hide"!==a.display}).some(function(d){var e=document.createElement("li");e.classList.add("barSelect-option");
if(d.isOptionGroup){var f=document.createElement("strong"),g=document.createElement("ul");e.dataset.label=d.optionGroup;e.dataset.role="group";e.dataset.disabled=d.disabled;f.classList.add("barSelect-group");f.textContent=d.optionGroup;f.title=d.title;g.classList.add("barSelect-group-wrapper");a.appendChild(e);e.appendChild(f);e.appendChild(g)}else{f=a.querySelector('.barSelect-option[data-label="'+d.optionGroup+'"]')||{dataset:{disabled:"false"}};g=a.querySelector('.barSelect-option[data-label="'+
d.optionGroup+'"]>.barSelect-group-wrapper')||a;d.optionDataset&&Object.keys(d.optionDataset).forEach(function(a){e.dataset[a]=d.optionDataset[a]});if(d.customProperties){if(d.customProperties.hasOwnProperty("barSelectOptionStyles"))for(var k in d.customProperties.barSelectOptionStyles)e.style[k]=d.customProperties.barSelectOptionStyles[k];d.customProperties.hasOwnProperty("barSelectOptionClasses")&&d.customProperties.barSelectOptionClasses.forEach(function(a){e.classList.add(a)})}e.dataset.role=
"option";e.dataset.disabled=d.disabled||f.dataset.disabled;e.dataset.selected=d.selected;e.dataset.value=d.value;e.title=d.title;e.textContent=d.text;g.appendChild(e);++b}return b>c});!a.querySelector(".focus")&&a.querySelector('.barSelect-option[data-role="option"][data-disabled="false"]')&&a.querySelector('.barSelect-option[data-role="option"][data-disabled="false"]').classList.add("focus");this.measureDropDownPosition()};a.prototype.toggle=function(){if(!this.element.classList.contains("load")){this.spread=
!this.spread;if(this.onToggleDropdown)this.onToggleDropdown(this.spread);this.spread?(k&&k!==this.id&&f.getSelector(k).spread&&f.getSelector(k).toggle(),k=this.id,this.renderDropdown()):(k&&k===this.id&&(k=""),document.body.removeChild(document.querySelector(".barSelect-dropDown")),this.filterValue&&(this.filterValue="",this.processFilter()));this.element.classList.toggle("show",this.spread)}};a.prototype.processFilter=function(){this.options.filter(function(a){return!a.isOptionGroup}).forEach(function(a){var b=
a.text.toUpperCase().includes(this.filterValue.toUpperCase())||!this.filterValue;a.display=b?"show":"hide"}.bind(this));this.options.filter(function(a){return a.isOptionGroup}).forEach(function(a){var b=this.options.filter(function(b){return!b.isOptionGroup&&b.optionGroup===a.optionGroup}).some(function(a){return"show"===a.display});a.display=b?"show":"hide"}.bind(this));if(this.onFilter)this.onFilter(this.filterValue)};a.prototype.measureDropDownPosition=function(){var a=this.element.querySelector(".barSelect-selection").getBoundingClientRect(),
b=document.querySelector(".barSelect-dropDown");b.style.minWidth=a.width+"px";b.style.left=a.left+"px";b.style.top=b.offsetHeight>window.innerHeight-a.bottom?a.top-b.offsetHeight+window.scrollY+"px":a.bottom+window.scrollY+"px"};a.prototype.setRenderOptionLimit=function(a){this.renderOptionLimit=a};a.prototype.getRenderOptionLimit=function(){return this.renderOptionLimit};a.prototype.addNewOption=function(a){if(a instanceof Object){e(a);if(this.onAddNewOption)this.onAddNewOption(a);this.options.push(a)}else console.error(TypeError("Argument: option is not a Object"))};
a.prototype.setOnToggleDropdown=function(a){this.onToggleDropdown=a};a.prototype.setBeforeSelectOption=function(a){this.beforeSelectOption=a};a.prototype.setAfterSelectOption=function(a){this.afterSelectOption=a};a.prototype.setOnFilter=function(a){this.onFilter=a};a.prototype.setOnAddNewOption=function(a){this.onAddNewOption=a};a.prototype.setSearchMode=function(a){this.searchMode=a};return f}();function Observer(a){this.self=a}Observer.prototype.update=function(){console.log("Please inherit the prototype chain to adjust the method(update).")};
function Subject(a){this.self=a;this.observers=[]}Subject.prototype.registerObservers=function(a){this.observers.push(a)};Subject.prototype.removeObservers=function(a){this.observers=this.observers.filter(function(b){return b!==a})};Subject.prototype.notifyObserver=function(){this.observers.forEach(function(a){a.update()})};var FormRuleActionType={};
Object.defineProperties(FormRuleActionType,{Show:{value:"show",enumerable:!0},Hide:{value:"hide",enumerable:!0},ShowFreeData:{value:"showFreeData",enumerable:!0},HideFreeData:{value:"hideFreeData",enumerable:!0},ShowSection:{value:"showSection",enumerable:!0},HideSection:{value:"hideSection",enumerable:!0},Message:{value:"message",enumerable:!0},HeaderBGColor:{value:"headerBGColor",enumerable:!0},HeaderColor:{value:"headerColor",enumerable:!0},ValueBGColor:{value:"valueBGColor",enumerable:!0},ValueColor:{value:"valueColor",
enumerable:!0},ShowActionButton:{value:"showActionButton",enumerable:!0},HideActionButton:{value:"hideActionButton",enumerable:!0},LockActionButton:{value:"lockActionButton",enumerable:!0},Readonly:{value:"readonly",enumerable:!0}});var selectTemplateProvider={};
window.webForm||Object.defineProperties(selectTemplateProvider,{getAvailableActions:{value:function(a,b){var c=document.createElement("SELECT");a=a||[];Object.values(FormRuleActionType).filter(function(c){return c===b||!a.includes(c)}).forEach(function(a){if(a!==FormRuleActionType.ShowSection&&a!==FormRuleActionType.HideSection){switch(a){case FormRuleActionType.Show:var d=lm.show;break;case FormRuleActionType.Hide:d=lm.hide;break;case FormRuleActionType.ShowFreeData:d=lm.showFreeData;break;case FormRuleActionType.HideFreeData:d=
lm.hideFreeData;break;case FormRuleActionType.ShowSection:d=lm.showSection;break;case FormRuleActionType.HideSection:d=lm.hideSection;break;case FormRuleActionType.Message:d=lm.showMessage;break;case FormRuleActionType.HeaderBGColor:d=lm.setHeaderBGColor;break;case FormRuleActionType.HeaderColor:d=lm.setHeaderColor;break;case FormRuleActionType.ValueBGColor:d=lm.setValueBGColor;break;case FormRuleActionType.ValueColor:d=lm.setValueColor;break;case FormRuleActionType.ShowActionButton:d=lm.showActionButton;
break;case FormRuleActionType.HideActionButton:d=lm.hideActionButton;break;case FormRuleActionType.LockActionButton:d=lm.lockActionButton;break;case FormRuleActionType.Readonly:d=lm.readonly;break;default:d=a=""}c.add(new Option(d,a,!1,a===b))}});c.dataset.setAction=b;c.dataset.mapping="action_select";return c}},getSelectableDomainSelect:{value:function(a,b){b=b||{};var c=document.createElement("SELECT"),d={};Object.keys(builder.subtableKeys).forEach(function(a){var b=builder.subtableKeys[a],c=builder.cellData[a],
e=document.createElement("optgroup"),f=builder.freeData[c.x+","+(c.y-1)];e.label=lm.subtable+": "+(f?f.value:c.value);e.title=lm.externalId+b;d[a]=e});a.reduce(function(a,b){if(320!==parseInt(b.domainId)){var c=new Option(b.value,b.domainId),e=builder.findSubtableHeadField(b.x,b.y);c.dataset.issubtable=builder.isSubtable(b);c.title=lm.externalId+": "+b.domainId;!builder.ifListingPage()&&e?(b=d[e.x+","+e.y],b.appendChild(c),b.closest("select")||a.appendChild(b)):a.appendChild(c)}return a},c);c.multiple=
b.multiple;if(b.isStyleAction)if(builder.ifListingPage())a=new Option(lm.wholeRow,builder.rootDomainId),a.dataset.issubtable="true",c.appendChild(a);else{var e=[];a.forEach(function(a){if((a=builder.findSubtableHeadField(a.x,a.y))&&!e.includes(a.x+","+a.y)){e.push(a.x+","+a.y);var b=a.x+","+(a.y-1);b=builder.freeData.hasOwnProperty(b)?lm.subtable+lm.space+builder.freeData[b].value:lm.subtable+lm.space+a.value;a=new Option(b,builder.subtableKeys[a.x+","+a.y]);a.dataset.issubtable="true";c.appendChild(a)}})}c.style.display=
"none";return c}},getFieldOptions:{value:function(a){return a.reduce(function(a,c){a.push({value:c.domainId,text:c.value,selected:!1,disabled:!1,optionGroup:"",isOptionGroup:!1,groupDataset:{},optionDataset:{issubtable:builder.isSubtable(c)},display:"show"});return a},[])}}});var ruleActionHelper=function(){var a={};if(window.webForm)return a;Object.defineProperties(a,{createDefaultActionJSON:{value:function(){return{domainId:-1,action:FormRuleActionType.Show,actionValue:""}}}});return a}();
function generateColorCode(){for(var a="#",b=0;6>b;++b)a+=Math.floor(16*Math.random()).toString(16);return a}function AutoGenGuessRefListener(a){this.affectedAutoGenKey=a;this.listeningIPs={}}
var autoGenGuessRefValueBuilder={listenMapping:{},add:function(a,b){this._add(a,this._findRefDomainId(b))},_add:function(a,b){var c=a.biff,d=c.getSubtableKey(!0),e=(-1!==d?d+"_":"")+c.domainId;d=this.listenMapping[b];d||(d=[],this.listenMapping[b]=d);b=d.find(function(a){return a.affectedAutoGenKey===e});b||(b=new AutoGenGuessRefListener(e),d.push(b));b.listeningIPs[c.y]=a},_findRefDomainId:function(a){a=a.match(/\{2,reference,(\d+)\}/);return Array.isArray(a)&&a[1]?parseInt(a[1]):-1},update:function(a){var b=
this.listenMapping[a.domainId];if(b)for(var c=a.y,d=biffdata.ifSubtableDataBiff(a),e=0;e<b.length;e++){var f=b[e],g=f.listeningIPs,k=void 0;g&&0!==Object.keys(g).length&&(d?(f=f.affectedAutoGenKey.split("_"),f.pop(),f=f.join("_"),g.hasOwnProperty(c)&&f===a.getSubtableKey(!0,!0)&&(k=g[c])):k=Object.values(g)[0],k&&this.updateFieldInChain(k))}},updateField:function(a){var b=this,c,d,e,f,g,k,l,m,n,q,r,p,t,v,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(x){switch(x.nextAddress){case 1:x.setCatchFinallyBlocks(2);
c=a.biff;d=c.attr;g=ctrl.guessSubtableSeqsPatchSize;k=biffdataTemp||biffdata;if(!c.isRefToOtherFieldAutoGen())return x.return();f=b._findRefDomainId(c.attr.ag);if(!k.ifSubtableDataBiff(c)){-1!==f&&(e=k.autoGenGuessRefMap[f]);if(void 0===e)return x.return();e!==c._cache.autoGenRefValue&&getAutogenGuess({a:ap,d:c.domainId,p:path,si:sheetIndex,ag:d.ag,rv:e}).then(function(a){updateGuessSeq(c,a);c._cache.autoGenRefValue=e});x.jumpTo(4);break}-1!==f&&(e=k.autoGenGuessRefMap[c.getSubtableKey(!0,!0)+","+
f],isPlainObject(e)&&(e=e[c.y]));if(void 0===e)return x.return();l=c.getSubtableKey(!1,!0)+","+c.domainId;isPlainObject(ctrl.subtableAutoGenMaxSeq[l])&&(m=ctrl.subtableAutoGenMaxSeq[l][e]+1);ctrl.subtableAutoGenSeqs.hasOwnProperty(l)||(ctrl.subtableAutoGenSeqs[l]={});if(ctrl.subtableAutoGenSeqs[l].hasOwnProperty(e)){x.jumpTo(5);break}ctrl.subtableAutoGenSeqs[l][e]=[];n=parseInt;return x.yield(getSeq({a:ap,d:c.domainId,p:path,si:sheetIndex,ag:d.ag,rv:e,stdid:c.parentDomainId}),6);case 6:m=n(x.yieldResult);
case 5:q=findAllSubtableDataBiffsToReguessAutogen(c);if(!(0===ctrl.subtableAutoGenSeqs[l][e].length||ctrl.subtableAutoGenSeqs[l][e].length<q.length)){x.jumpTo(7);break}r=[];p=m||0===m?m-1:0;for(t=1;t<=g;t++)r.push(p+t),t===g&&(ctrl.subtableAutoGenMaxSeq.hasOwnProperty(l)||(ctrl.subtableAutoGenMaxSeq[l]={}),ctrl.subtableAutoGenMaxSeq[l][e]=p+t);return x.yield(getAutogenGuess({a:ap,d:c.domainId,p:path,si:sheetIndex,ag:d.ag,rv:e,seqs:r.toString()}),8);case 8:v=x.yieldResult.split(","),ctrl.subtableAutoGenSeqs[l][e]=
ctrl.subtableAutoGenSeqs[l][e].concat(v);case 7:reguessSubtableSameDomainBiffsRefSeqs(q,e,c);case 4:x.leaveTryBlock(0);break;case 2:return u=x.enterCatchBlock(),processJSExceptionObj(u),x.return(Promise.reject(u))}})},updateFieldInChain:function(a){chainAutoGenGuessPromise(this.updateField.bind(this,a))}};function resetAutoGenGuessSeq(){ctrl.subtableAutoGenSeqs={};ctrl.subtableAutoGenMaxSeq={};ctrl.autoGenGuessingPromise=Promise.resolve();autoGenGuessRefValueBuilder.listenMapping={}}
function reguessSubtableSameDomainBiffsSeqs(a,b,c){if(a)try{if(b=b||a.getSubtableKey(!1,!0)+","+a.domainId,c=c||findAllSubtableDataBiffsToReguessAutogen(a),Array.isArray(ctrl.subtableAutoGenSeqs[b])){a=0;for(var d=c.length;a<d;a++){var e=c[a],f=ctrl.subtableAutoGenSeqs[b][a];f&&f!==e.updateDisplayValue&&updateGuessSeq(e,f)}}}catch(g){processJSExceptionObj(g)}}
function reguessSubtableSameDomainBiffsRefSeqs(a,b,c){if(a&&Array.isArray(a)){var d={};try{for(var e=0,f=a.length;e<f;e++){var g=a[e],k=b,l=void 0;g!==c&&void 0!==g._cache.autoGenRefValue&&(k=g._cache.autoGenRefValue);l=g.getSubtableKey(!1,!0)+","+g.domainId;d.hasOwnProperty(l)||(d[l]={});d[l].hasOwnProperty(k)||(d[l][k]=0);if((k||""===k)&&Array.isArray(ctrl.subtableAutoGenSeqs[l][k])){var m=ctrl.subtableAutoGenSeqs[l][k][d[l][k]];!m||m===g.updateDisplayValue||g!==c&&void 0===g._cache.autoGenRefValue||
(updateGuessSeq(g,m),g._cache.autoGenRefValue=k);d[l][k]++}}}catch(n){processJSExceptionObj(n)}}}function updateGuessSeq(a,b){if(a){var c=a.ip;a.updateDisplayValue=b;c&&c.updateFormulaEngine&&(c.needFormulaRecalc=!0,c.updateFormulaEngine(!1),a=mode,mode===BROWSE&&(mode=UPDATE),c.render(),mode=a)}}
function resetAutoGenGuessRefValueMapping(a){if(a&&a.isAutoGenRefType()){var b=a.getSubtableKey(!0);if(-1===b)biffdata.autoGenGuessRefMap[a.domainId]=_autoGenGuessGetRefValue(a);else{var c=biffdata.autoGenGuessRefMap[b+","+a.domainId];c||(c=biffdata.autoGenGuessRefMap[b+","+a.domainId]={});c[a.y]=_autoGenGuessGetRefValue(a)}}}function _autoGenGuessGetRefValue(a){if(a&&a.isAutoGenRefType())return a.IPType===TYPER&&a.hasAttribute("fmt_d")?a.displayValue:a.value}
function chainAutoGenGuessPromise(a){ctrl.autoGenGuessingPromise=ctrl.autoGenGuessingPromise.then(a)}function findAllSubtableDataBiffsToReguessAutogen(a){return(biffdataTemp||biffdata).findSubtableDataBiffsV2(a,!0).filter(function(a){return 0>a.nodeId&&!a.isEmptyRow})}
var ContextMenu=function(){function a(a,b,c){this.id=a;this.data=b||[];this.parent=c||document.body;this.style={};this.openSubmenu=this.htmlElement=null}var b={menus:{},DIVIDER:"divider"},c=b.DIVIDER;b.createMenu=function(b,c,f,g){this.removeMenu(b);c=new a(b,c,document.body);c.setStyle({top:f,left:g});c.render();return this.menus[b]=c};b.removeMenu=function(a){if(this.menus.hasOwnProperty(a)){var b=this.menus[a];b.unrender();b.dispose();this.menus[a]=null;delete this.menus[a]}};a.prototype.load=
function(a){this.data=a};a.prototype.setStyle=function(a){this.style=a};a.prototype.dispose=function(){this.id="";this.openSubmenu=this.htmlElement=this.style=this.parent=this.data=null};a.prototype.unrender=function(){var a=this.htmlElement;a||(a=document.getElementById(this.id));a&&(this.openSubmenu&&(this.openSubmenu.unrender(),this.openSubmenu=null),a.parentNode.removeChild(a))};a.prototype.render=function(){function b(b){if(b&&"object"===typeof b){var c=Array.isArray(b.sub),d=node("DIV",b.id?
b.id:"","menuItem labelContainer");b.hide&&(d.style.display="none");if("object"===typeof b.events){var g=b.events,k;for(k in g)g.hasOwnProperty(k)&&d.addEventListener(k,g[k])}g=node("DIV","","label",b.text);if(c){var l=node("I","","far fa-angle-right");l=node("DIV","","iconContainer",l)}d.appendChild(g);l&&d.appendChild(l);var m;c&&(m=node("DIV","","submenuContainer",d));d.addEventListener("mouseenter",function(){e();if(c){var d=new a("",b.sub,m);d.render();f.openSubmenu=d}});d.addEventListener("click",
function(){f.hide()});return c?m:d}}function e(){if(f.openSubmenu){var a=f.openSubmenu;a.unrender();a.dispose();f.openSubmenu=null}}var f=this,g=this.parent!==document.body,k=[];this.data.forEach(function(a){a.role===c?k.push(node("HR")):k.push(b(a))});var l=node("DIV","","menu",k),m;g&&(m=node("DIV","","submenuPaddingContainer",l));l=node("DIV",this.id,"contextMenu",g?m:l);m=this.style;for(var n in m)m.hasOwnProperty(n)&&(l.style[n]=m[n]);l.addEventListener("mouseleave",e);l.addEventListener("contextmenu",
function(a){a.preventDefault()});this.parent.appendChild(l);this.htmlElement=l;n=document.documentElement.clientWidth;m=document.documentElement.clientHeight;if(g){g=this.parent.closest(".menu").getBoundingClientRect();var q=this.parent.getBoundingClientRect();l.style.position="fixed";l.style.top=q.top+"px";l.style.left=g.right-2-1+"px";q=l.querySelector(".menu").getBoundingClientRect();q.right>n&&(l.style.left=g.left+1-q.width+"px");q.bottom>m&&(l.style.top=q.top-(q.bottom-m)-10+"px")}else g=l.querySelector(".menu").getBoundingClientRect(),
g.right>n&&(l.style.left=g.left-g.width+"px"),g.bottom>m&&(l.style.top=g.top-(g.bottom-m)-10+"px")};a.prototype.hide=function(){this.htmlElement&&(this.htmlElement.style.display="none")};return b}();function ContextMenuDataHelper(a){this.data=a}ContextMenuDataHelper.prototype.getItem=function(a){return this.data.find(function(b){return b.id===a})};
ContextMenu.builderRKeyMenuData=[{text:lm.insertField,id:"bInsertField",events:{click:insertField}},{text:lm.insertDescription,id:"bInsertDesc",events:{click:insertDesc}},{text:lm.insertWidget,id:"bInsertReport",events:{click:function(){builder.insertWidget()}}},{text:lm.insertImage,id:"bInsertImage",events:{click:function(){insertImageBBCode()}}},{text:lm.insertActionButton,id:"bInsertActionButton",sub:[]},{role:ContextMenu.DIVIDER},{text:lm.cut,id:"bCutCell",events:{click:cutCell}},{text:lm.copy,
id:"bCopyCell",events:{click:copyCell}},{text:lm.paste,id:"bPasteCell",events:{click:pasteCell}},{text:lm["delete"],id:"bDeleteCell",events:{click:clearCell}},{role:ContextMenu.DIVIDER},{text:lm.insertRow,id:"bInsertRow",events:{click:function(){shiftData(ctrl.rightClickRow-1,1,!1);builder.renderAll()}}},{text:lm.insertColumnForThisRow,id:"bInsertLocalCol",events:{click:function(){shiftData(ctrl.rightClickCol-1,1,!0,ctrl.rightClickRow);builder.renderAll()}}},{text:lm.insertColumn,id:"bInsertCol",
events:{click:function(){shiftData(ctrl.rightClickCol-1,1,!0);builder.renderAll()}}},{text:lm.deleteRow,id:"bDeleteRow",events:{click:function(){shiftData(ctrl.rightClickRow,-1,!1);builder.renderAll()}}},{text:lm.deleteColumn,id:"bDeleteCol",events:{click:function(){shiftData(ctrl.rightClickCol,-1,!0);builder.renderAll()}}},{text:lm.hideColumn,id:"bHideCol",events:{click:function(){hideColumn(ctrl.rightClickCol)}}},{text:lm.setColWidth,id:"bSetColWidth",events:{click:setNUIColWidth}},{text:lm.setRowHeight,
id:"bSetRowHeight",events:{click:setNUIRowHeight}},{text:lm.fieldAnalyzer,id:"bFieldAnalyzer",events:{click:fieldAnalyze}},{text:lm.nuiSectionCreate,id:"bNUISectionCreate",events:{click:nuiSectionCreateBySelect}}];function ErrorRecorder(){this.errorRecords=[]}ErrorRecorder.prototype.setHeader=function(a){this.header=a;return this};ErrorRecorder.prototype.setCallBack=function(a){this.callback=a;return this};ErrorRecorder.prototype.addRecord=function(a){return this.errorRecords.push(a)-1};
ErrorRecorder.prototype.removeRecord=function(a){delete this.errorRecords[a];return this};ErrorRecorder.prototype.getRecord=function(a){return this.errorRecords[a]};ErrorRecorder.prototype.getRecords=function(a){for(var b=!1,c=0;c<this.errorRecords.length;c++)void 0!==this.getRecord(c)&&(b=!0);return b?this.errorRecords[a]:void 0};ErrorRecorder.prototype.showRecord=function(a){a=this.getRecord(a);void 0!==a&&this._show(a)};
ErrorRecorder.prototype.showRecords=function(){var a=this.getRecords();void 0!==a&&this._show(a)};ErrorRecorder.prototype._show=function(a){floatWinAlert(a,this.callback,null,this.header)};ErrorRecorder.prototype.isEmpty=function(){for(var a=0;a<this.errorRecords.length;a++)if(void 0!==this.errorRecords[a])return!1;return!0};function ErrorReasonRecorder(){this.errorRecorder=new ErrorRecorder;this.description=this.msgTitle="";this.errorReasonRecords=[]}
ErrorReasonRecorder.prototype.setHeader=function(a){this.errorRecorder.setHeader(a);return this};ErrorReasonRecorder.prototype.setCallBack=function(a){this.errorRecorder.setCallBack(a);return this};ErrorReasonRecorder.prototype.setMsgTitle=function(a){this.msgTitle=a;return this};ErrorReasonRecorder.prototype.setDescription=function(a){this.description=a;return this};
ErrorReasonRecorder.prototype.addErrorReason=function(a,b){this.errorReasonRecords.push({errorMessage:a,errorReason:b});return this.errorReasonRecords.length-1};ErrorReasonRecorder.prototype.removeErrorReason=function(a){delete this.errorReasonRecords[a];return this};ErrorReasonRecorder.prototype.getErrorReason=function(a){return this.errorReasonRecords[a]};
ErrorReasonRecorder.prototype.showErrorReasonRecord=function(a){a=this.errorReasonRecords[a];void 0!==a&&(a=this.createMsgStyle(a.errorMessage,a.errorReason),this._show(a))};ErrorReasonRecorder.prototype.showErrorReasonRecords=function(){for(var a="",b=!1,c=0;c<this.errorReasonRecords.length;c++){var d=this.errorReasonRecords[c];void 0!==d&&(b=!0,a+=this.createMsgStyle(d.errorMessage,d.errorReason))}b&&this._show(a)};
ErrorReasonRecorder.prototype._show=function(a){void 0!==a&&this.errorRecorder._show("<div class='errorReasonMsgTitle'>"+this.msgTitle+"</div>"+a+("<div class='errorReasonDescription'>"+this.description+"</div>"))};ErrorReasonRecorder.prototype.isEmpty=function(){for(var a=0;a<this.errorReasonRecords.length;a++)if(void 0!==this.errorReasonRecords[a])return!1;return!0};ErrorReasonRecorder.prototype.length=function(){return this.errorReasonRecords.length};
ErrorReasonRecorder.prototype.createMsgStyle=function(a,b){return"<div class='errorReasonMsg'><div style='flex:1;text-align: left;'>"+(a+"</div><div style='flex:1;text-align: right;'>"+b+"</div></div>")};
var FileManagerRender={fileManagerObj:void 0,DIRECTORY_NAME_MAX_WORD_COUNT:50,FILE_NAME_MAX_WORD_COUNT:50,ExtensionMapToIcon:{},init:function(a){this.fileManagerObj=this.jsonToFileManagerObj(a);this.initExtensionMapToIcon();return this},jsonToFileManagerObj:function(a){function b(a,b){b.groups=[];for(var d=0;d<a.groupDirectories.length;d++){for(var e=new RagicGroup,f=a.groupDirectories[d],g=e,k=Object.keys(f),p=0;p<k.length;p++){var t=k[p];"directories"!=t?g[t]=f[t]:c(f[t],g)}b.groups.push(e)}}function c(a,
b){b.directories=[];for(var c=0;c<a.length;c++){for(var d=new RagicDirector,e=a[c],f=d,g=Object.keys(e),k=0;k<g.length;k++){var t=g[k];f[t]=e[t]}b.directories.push(d)}}function d(a,b){b.groups=[];for(var c=0;c<a.groupFiles.length;c++){for(var d=new RagicGroup,f=a.groupFiles[c],g=d,k=Object.keys(f),p=0;p<k.length;p++){var t=k[p];"files"!=t?g[t]=f[t]:e(f[t],g)}b.groups.push(d)}}function e(a,b){b.files=[];for(var c=0;c<a.length;c++){for(var d=new RagicFile,e=a[c],f=d,g=Object.keys(e),k=0;k<g.length;k++){var t=
g[k];f[t]=e[t]}FileManagerController.ragicFileList.push(f);b.files.push(d)}}a=JSON.parse(a);var f={};if(a)return a.groupDirectories?b(a,f):a.groupFiles?d(a,f):a.directories?c(a.directories,f):a.files&&e(a.files,f),f},initExtensionMapToIcon:function(){var a=this.ExtensionMapToIcon;a.doc=a.dochtml=a.docm=a.docx=a.docxml=a.dot=a.dothtml=a.dotm=a.dotx="fal fa-file-word";a.pdf="fal fa-file-pdf";a.bmp=a.cr2=a.gif=a.ico=a.ithmb=a.jpeg=a.jpg=a.nef=a.png=a.raw=a.svg=a.tif=a.tiff=a.wbmp=a.webp=a.jfif="image";
a.txt=a.log="fal fa-text";a.zip=a.rar=a.tar=a["7z"]="fal fa-file-archive";a["3g2"]=a["3gp"]=a["3gpp"]=a["3gpp2"]=a.asf=a.avi=a.dv=a.dvi=a.flv=a.m2t=a.m4v=a.mkv=a.mov=a.mp4=a.mpeg=a.mpg=a.mts=a.ogv=a.ogx=a.rm=a.rmvb=a.ts=a.vob=a.webm=a.wmv="fal fa-file-video";a.aac=a.aif=a.aifc=a.aiff=a.au=a.flac=a.m4a=a.m4b=a.m4p=a.m4r=a.mid=a.mp3=a.oga=a.ogg=a.opus=a.ra=a.ram=a.spx=a.wav=a.wma="fal fa-file-audio";a.xls=a.xlsx=a.csv=a.tsv="fal fa-file-excel";a.pot=a.pothtml=a.potm=a.potx=a.ppa=a.ppam=a.pps=a.ppsm=
a.ppsx=a.ppt=a.ppthtml=a.pptm=a.pptx=a.pptxml="fal fa-file-powerpoint";a.applescript=a.as=a.as3=a.c=a.cc=a.clisp=a.coffee=a.cpp=a.cs=a.css=a.cxx=a.def=a.diff=a.erl=a.fountain=a.ft=a.h=a.hpp=a.htm=a.html=a.hxx=a.inc=a.ini=a.java=a.js=a.json=a.less=a.lua=a.m=a.markdown=a.mat=a.md=a.mdown=a.mkdn=a.mm=a.mustache=a.mxml=a.patch=a.php=a.phtml=a.pl=a.plist=a.properties=a.py=a.rb=a.sass=a.scss=a.sh=a.shtml=a.sql=a.tab=a.taskpaper=a.tex=a.text=a.tmpl=a.url=a.vb=a.xhtml=a.xml=a.yaml=a.yml="fal fa-file-code";
a.emptyfile="far fa-paperclip";a.emptyimg="far fa-image";a.other="fal fa-file"},renderContent:function(a){var b=document.createDocumentFragment(),c=this.fileManagerObj;c&&(c.groups?this.groupsRender(b,c.groups):c.directories?this.directoriesRender(b,c.directories):c.files&&(this.filesRender(b,c.files),this.descriptionRender()));a.append(b)},groupsRender:function(a,b){for(var c=0;c<b.length;c++){var d=createNode("div","group"+c,"groupDiv");d.groupObj=b[c];if(d,b[c].directories)this.groupDirectoryRender(d,
b[c]);else if(d,b[c].files)this.groupFileRender(d,b[c]),this.descriptionRender();a.appendChild(d)}},groupDirectoryRender:function(a,b){if(0===b.directories.length)a.style.display="none";else{var c=a.id?a.id+"_":"",d=c+"midLine",e=c+"content";c=createNode("div",c+"title","groupTitleDiv");c.append(b.groupDirectoryDisplayName);d=createNode("div",d,"groupMidLineDiv");e=createNode("div",e,"groupContentDiv");this.directoriesRender(e,b.directories);a.appendChild(c);a.appendChild(d);a.appendChild(e)}},directoriesRender:function(a,
b){var c=a.id?a.id+"_":"",d=c+"directoryContainer";c+="directory";for(var e={},f=0;f<b.length;e={$jscomp$loop$prop$directoryObj$678:e.$jscomp$loop$prop$directoryObj$678},f++){e.$jscomp$loop$prop$directoryObj$678=b[f];var g=createNode("div",d+f,"directoryContainerDiv");g.onclick=function(a){return function(){a.$jscomp$loop$prop$directoryObj$678.click()}}(e);g.onmouseout=function(a){return function(){a.$jscomp$loop$prop$directoryObj$678.mouseout()}}(e);var k=createNode("div",c+f,"directoryDiv");k.directoryObj=
e.$jscomp$loop$prop$directoryObj$678;k.directoryObj.DOMObject=k;this.directoryRender(k,e.$jscomp$loop$prop$directoryObj$678);g.appendChild(k);a.appendChild(g)}},directoryRender:function(a,b){var c=a.id?a.id+"_":"",d=c+"directoryName",e=c+"directoryInfo";c=createNode("div",c+"directoryIcon","directoryIconDiv");b.isSubtableField?c.classList.add("far","fa-folder"):c.classList.add("fas","fa-folder");d=createNode("div",d,"directoryNameDiv");var f=b.displayName.length>this.DIRECTORY_NAME_MAX_WORD_COUNT?
utf16_substring(b.displayName,0,this.DIRECTORY_NAME_MAX_WORD_COUNT)+"...":b.displayName;d.append(f);d.setAttribute("title",b.displayName);e=createNode("div",e,"directoryInfoDiv");f="";b.fileCount!=MAX_DATAS_FLAG&&(f=b.fileCount!=MAX_FILES_FLAG?b.fileCount+" "+language.fileManager_FileCount:language.fileManager_MoreThan+MAX_FILES_COUNT+" "+language.fileManager_FileCount);e.append(f);d.appendChild(e);a.appendChild(c);a.appendChild(d)},groupFileRender:function(a,b){var c=a.id?a.id+"_":"",d=c+"midLine",
e=c+"uploadInputFile",f=c+"content";c=createNode("div",c+"title","groupTitleDiv");c.append(b.groupFileDisplayName);d=createNode("div",d,"groupMidLineDiv");var g=createNode("input",e,"groupUploadInputFile");g.setAttribute("type","file");e=createNode("span",null,"groupUploadButton");b.upLoader=e;if(b.fileUploadType===GRAPHIC_TYPE){g.setAttribute("accept","image/*");e.append(language.fileManager_uploadImage);var k=createNode("span",null,"far fa-image");e.appendChild(k)}else e.append(language.fileManager_uploadFile),
k=createNode("span",null,"far fa-paperclip"),e.appendChild(k);!0===b.isMultiFilesUpload&&g.setAttribute("multiple","true");g.onchange=function(a){FileUploadManager.uploadFilesStart(this.files,b)};e.addEventListener("click",function(a){if(sheetLoadMode===loadModeField&&b.isSubtableField){if(confirm(language.fileManager_subtableFieldJumpPageTip)){a=[];var c=queryString().displayName;a.push("apName="+b.apName);a.push("path="+b.path);a.push("sheetIndex="+b.sheetIndex);a.push("rootNodeId="+b.rootNodeId);
a.push("ragicValue="+b.ragicValue);a.push("sheetLoadMode="+loadModeData);a.push("directoryType=DATA");a.push("displayName="+c.split(displayNameSepSymbol)[0]+displayNameSepSymbol+b.ragicValue);window.location="fileManager?"+a.join("&")}}else g.click()});d.appendChild(e);f=createNode("div",f,"groupContentDiv");this.filesRender(f,b.files,b);f.count=0;f.addEventListener("dragenter",function(a){this.dragCount||(this.dragCount=0);this.dragCount++;a.stopPropagation();a.preventDefault();this.classList.add("groupContentDivDropEnter");
this.childNodes.forEach(function(a){a.style.pointerEvents="none"})});f.addEventListener("dragleave",function(a){this.dragCount--;if(0!=this.dragCount)return!1;a.stopPropagation();a.preventDefault();this.classList.remove("groupContentDivDropEnter");this.childNodes.forEach(function(a){a.style.pointerEvents="auto"})});f.addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();this.classList.remove("groupContentDivDropEnter");this.childNodes.forEach(function(a){a.style.pointerEvents=
"auto"});FileUploadManager.uploadFilesStart(a.dataTransfer.files,b)});f.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();this.classList.add("groupContentDivDropEnter")});a.appendChild(c);a.appendChild(d);a.appendChild(f)},filesRender:function(a,b,c){var d=a.id?a.id+"_":"",e=d+"fileContainer";d+="file";var f=!1;0===b.length&&(f=!0,b={},b.apName=c.apName,c.fileUploadType===GRAPHIC_TYPE?(b.ragicValue="empty.emptyImg",b.displayName=language.fileManager_uploadImage):(b.ragicValue=
"empty.emptyFile",b.displayName=language.fileManager_uploadFile),b=Array(b));for(var g=0;g<b.length;g++){var k=b[g],l=void 0;l=f?createNode("div",null,"fileEmptyContainerDiv"):createNode("div",e+g,"fileContainerDiv");var m=createNode("div",d+g,"fileDiv");f&&m.classList.add("emptyFileDiv");m.fileObj=k;k.DOMObject=m;k.fileContainerDiv=l;this.fileRender(m,k,f);f?m.addEventListener("click",function(){c.upLoader.click()}):(m.addEventListener("click",k.click),m.addEventListener("mousedown",k.mousedown));
l.appendChild(m);a.appendChild(l)}},fileRender:function(a,b,c){var d=a.id?a.id+"_":"",e=d+"fileIcon";d+="fileName";var f=createNode("div",null,"fileIconContainerDiv");e=createNode("div",e,"fileIconDiv");var g=b.ragicValue.substring(b.ragicValue.lastIndexOf(".")+1);g=this.getFileIconSrc(g);var k="/sims/file.jsp?a="+b.apName+"&f="+encodeURIComponent(b.ragicValue)+"&imageResize=100,100&fresize&forceResize";if("image"==g){var l=createNode("img");l.style.display="none";l.src=k;l.onload=function(){100<
l.width&&100<l.height?l.width>l.height?l.style.maxWidth="100px":l.style.maxHeight="100px":100<l.width?l.style.maxWidth="100px":100<l.height&&(l.style.maxHeight="100px");l.style.display="";100>l.height&&(f.style.height="102px")};e.style.position="static";g=createNode("table");g.style.borderCollapse="separate";f.style.display="table-cell";f.style.verticalAlign="middle";e.appendChild(l);f.appendChild(e);g.appendChild(f);a.appendChild(g)}else k=createNode("div"),k.className=g,e.appendChild(k),f.appendChild(e),
a.appendChild(f);d=createNode("div",d,"fileNameDiv");g=b.displayName.length>this.FILE_NAME_MAX_WORD_COUNT?utf16_substring(b.displayName,0,this.FILE_NAME_MAX_WORD_COUNT)+"...":b.displayName;var m=g.indexOf("[");k=g.indexOf("]");e=!1;if(0==m&&-1!=k){e=!0;var n=createNode("div",null,"fileNameBracketDiv");m=g.substring(m,k+1);n.append(m);g=g.substring(k+1);d.appendChild(n)}k=createNode("div",null,"fileMidName");k.append(g);c&&(k.classList.add("emptyFileMidName"),d.classList.add("emptyFileNameDiv"));d.appendChild(k);
d.setAttribute("title",b.displayName);c=createNode("div",null,"fileInfoDiv");g="";b.fileSize&&(k=parseInt(b.fileSize),1024>k&&(g=k+" Bytes"),1024<k&&(k/=1024,g=parseInt(k)+" KB"),1024<k&&(g=parseInt(k/1024)+" MB"));c.append(g);d.appendChild(c);e&&b.fileContainerDiv.classList.add("haveBracketDiv");a.fileObj.iconContainer=f;a.appendChild(d)},descriptionRender:function(){document.getElementById("description").style.display="block"},getFileIconSrc:function(a){var b=this.ExtensionMapToIcon;a=a.toLowerCase();
return void 0!==b[a]?b[a]:b.other}},FileManagerController={ragicFileList:[],selectedRagicFileList:[],init:function(a){if(0<this.ragicFileList.length){DragObj.init(a,this.startDraging.bind(this),function(){},this.detectDragCollision.bind(this));var b=[];b.push({menuTitle:language.fileManager_SelectAllFiles,menuCallBack:this.selectAllFile.bind(this)});b.push({menuTitle:language.fileManager_downloadFile,menuCallBack:this.downloadSelectedFiles.bind(this)});b.push({menuTitle:language.fileManager_removeFile,
menuCallBack:this.removeSelectedFiles.bind(this)});ContextMenuObj.init(a,b,function(){})}},startDraging:function(a){a.ctrlKey||a.metaKey||a.shiftKey||this.unSelectAllFile()},detectDragCollision:function(a,b){for(var c=0;c<this.ragicFileList.length;c++)if(this.isCollision(b,this.ragicFileList[c].DOMObject)){if(!this.ragicFileList[c].isSelected()){this.selectFile(this.ragicFileList[c]);break}}else!this.ragicFileList[c].isSelected()||a.ctrlKey||a.metaKey||this.unSelectFile(this.ragicFileList[c])},isCollision:function(a,
b){var c=a.getBoundingClientRect();a=c.left;var d=a+c.width,e=c.top;c=e+c.height;var f=b.getBoundingClientRect();b=f.left;var g=b+f.width,k=f.top;f=k+f.height;return d>b&&a<g&&c>k&&e<f},selectFile:function(a){a.select();this.selectedRagicFileList.push(a)},unSelectFile:function(a){a.unSelect();for(var b=0;b<this.selectedRagicFileList.length;b++)if(a==this.selectedRagicFileList[b]){this.selectedRagicFileList.splice(b,1);break}},selectAllFile:function(){for(var a=0;a<this.ragicFileList.length;a++)this.selectFile(this.ragicFileList[a])},
unSelectAllFile:function(){for(var a=0;a<this.selectedRagicFileList.length;a++)this.selectedRagicFileList[a].unSelect();this.selectedRagicFileList=[]},ragicFileClick:function(a,b){if(a.shiftKey){var c=-1;a=-1;for(var d=0;d<this.ragicFileList.length;d++){if(this.ragicFileList[d]==b){a=d;break}this.ragicFileList[d].isSelected()&&-1==c&&(c=d)}if(-1!=c)for(this.unSelectAllFile();c<a;c++)this.selectFile(this.ragicFileList[c]);else{for(d=this.ragicFileList.length-1;d>a;d--)this.ragicFileList[d].isSelected()&&
(c=d);if(-1!=c)for(this.unSelectAllFile();c>a;c--)this.selectFile(this.ragicFileList[c])}this.selectFile(b)}else a.ctrlKey||a.metaKey?b.isSelected()?this.unSelectFile(b):this.selectFile(b):(this.unSelectAllFile(),this.selectFile(b))},ragicFileMouseDown:function(a,b){2!=a.button||b.isSelected()||(this.unSelectAllFile(),this.selectFile(b))},downloadSelectedFiles:function(){downloadFiles(this.selectedRagicFileList)},removeSelectedFiles:function(){var a=this.selectedRagicFileList;if(!(1>a.length)){for(var b=
[],c=0;c<a.length;c++)b.push({apName:a[c].apName,path:a[c].path,sheetIndex:a[c].sheetIndex,rootNodeId:a[c].rootNodeId,domainId:a[c].domainId,isSubtableField:a[c].isSubtableField,subtableRootNodeId:a[c].subtableRootNodeId,subtableRootDomainId:a[c].subtableRootDomainId,subtableEntryIndex:a[c].subtableEntryIndex,ragicValue:a[c].ragicValue,displayName:a[c].displayName});postPromise("/sims/fileManagerRemover.jsp",{selectedFilesArray:JSON.stringify(b)}).then(function(a){a=JSON.parse(a);var b=a.failureCount,
c=getBundleString("fileManager_removeSuccess",[a.successCount])+"<br>"+getBundleString("fileManager_removeFailure",[b]);0===b?floatWinAlert(c,function(){window.location.reload()},null):floatWinAlert(c+"<br>"+a.errorMsg,function(){window.location.reload()},null,"delete error")})}}};function RagicDirector(){}
RagicDirector.prototype.click=function(){var a=[];a.push("directoryType="+this.directoryType);var b=queryString(),c=b.displayName;b=b.sheetLoadMode;c=void 0!==c&&""!==c?c+displayNameSepSymbol:"";void 0===b&&(b=loadModeField);a.push("displayName="+c+this.displayName);a.push("sheetLoadMode="+b);a.push("ragicValue="+this.ragicValue);a.push("apName="+this.apName);a.push("path="+this.path);a.push("sheetIndex="+this.sheetIndex);a.push("page=1");void 0!==this.domainId&&a.push("domainId="+this.domainId);
void 0!==this.rootNodeId&&a.push("rootNodeId="+this.rootNodeId);void 0!==this.isSubtableField&&a.push("isSubtableField="+this.isSubtableField);void 0!==this.subtableRootDomainId&&a.push("subtableRootDomainId="+this.subtableRootDomainId);void 0!==this.fileUploadType&&a.push("fileUploadType="+this.fileUploadType);void 0!==this.isMultiFilesUpload&&a.push("isMultiFilesUpload="+this.isMultiFilesUpload);void 0!==this.fieldHeader&&a.push("fieldHeader="+this.fieldHeader);window.location="fileManager?"+a.join("&")};
RagicDirector.prototype.mouseover=function(){};RagicDirector.prototype.mouseout=function(){};function RagicFile(){this.selected=!1;this.click=this.click.bind(this);this.mousedown=this.mousedown.bind(this)}RagicFile.prototype.click=function(a){FileManagerController.ragicFileClick(a,this)};RagicFile.prototype.mousedown=function(a){FileManagerController.ragicFileMouseDown(a,this)};RagicFile.prototype.select=function(){this.DOMObject.classList.add("selected");this.selected=!0};
RagicFile.prototype.unSelect=function(){this.DOMObject.classList.remove("selected");this.selected=!1};RagicFile.prototype.isSelected=function(){return this.selected};function RagicGroup(){}
var DragObj={dragTargetDiv:document.documentElement,startX:0,startY:0,mouseDownCallback:void 0,mouseUpCallback:void 0,mouseMoveCallBack:void 0,timeOutId:null,init:function(a,b,c,d){this.mousedown=this.mousedown.bind(this);this.mouseup=this.mouseup.bind(this);this.mousemove=this.mousemove.bind(this);this.dragTargetDiv=a;this.mouseDownCallback=b;this.mouseUpCallback=c;this.mouseMoveCallBack=d;this.addEventListener(a,"mousedown",this.mousedown);this.addEventListener(a,"mouseup",this.mouseup)},mousedown:function(a){if(0==
a.button){"sheetLoadMode"!=a.target.name&&a.preventDefault();this.startX=a.pageX?a.pageX:a.clientX+document.documentElement.scrollLeft||document.body.scrollLeft;this.startY=a.pageY?a.pageY:a.clientY+document.documentElement.scrollTop+document.body.scrollTop;var b=this;this.timeOutId=setTimeout(function(){b.showRect(!0);b.addEventListener(b.dragTargetDiv,"mousemove",b.mousemove)},130);this.mouseDownCallback(a)}},mouseup:function(a){0==a.button&&(this.showRect(!1),this.removeEventListener(this.dragTargetDiv,
"mousemove",this.mousemove),clearTimeout(this.timeOutId),this.mouseUpCallback(a))},mousemove:function(a){if(this.dragBox){var b=a.pageX?a.pageX:a.clientX+document.documentElement.scrollLeft,c=a.pageY?a.pageY:a.clientY+document.documentElement.scrollTop;this.dragBox.style.width=Math.abs(b-this.startX)+"px";this.dragBox.style.height=Math.abs(c-this.startY)+"px";0>b-this.startX&&(this.dragBox.style.left=b+"px");0>c-this.startY&&(this.dragBox.style.top=c+"px");this.mouseMoveCallBack(a,this.dragBox)}},
showRect:function(a){a?(this.dragBox||(this.dragBox=document.createElement("div"),this.dragBox.id="dragBox",this.dragTargetDiv.appendChild(this.dragBox)),this.dragBox.style.display="block",this.dragBox.style.left=this.startX+"px",this.dragBox.style.top=this.startY+"px"):this.dragBox&&(this.dragBox.style.width="0px",this.dragBox.style.height="0px",this.dragBox.style.display="none")},addEventListener:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})},
removeEventListener:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,function(){c(window.event)})}},ContextMenuObj={menuTargetDiv:void 0,fileManagerMenu:void 0,menuContent:[],init:function(a,b,c){this.menuTargetDiv=a;this.menuContent=b;this.mouseDownCallback=c;this.addEventListener(a,"mousedown",this.mousedown.bind(this));this.addEventListener(a,"contextmenu",function(a){a.preventDefault();return!1})},mousedown:function(a){0==a.button&&this.clearMenuContent();
2==a.button&&this.menuContentRender(a)},menuContentRender:function(a){void 0===this.fileManagerMenu?this.fileManagerMenu=createNode("div","fileManagerMenu","fileManagerMenu"):this.clearMenuContent();this.fileManagerMenu.style.display="block";for(var b=0;b<this.menuContent.length;b++){var c=createNode("div","fileManagerMenuList"+b,"fileManagerMenuList");c.append(this.menuContent[b].menuTitle);c.menuCallBack=this.menuContent[b].menuCallBack;c.addEventListener("mousedown",this.menuClick);this.fileManagerMenu.appendChild(c)}b=
a.pageY?a.pageY:a.clientY+document.documentElement.scrollTop+document.body.scrollTop;this.fileManagerMenu.style.left=a.pageX?a.pageX:a.clientX+document.documentElement.scrollLeft||document.body.scrollLeft;this.fileManagerMenu.style.top=b;this.menuTargetDiv.appendChild(this.fileManagerMenu)},clearMenuContent:function(){if(void 0!==this.fileManagerMenu)for(this.fileManagerMenu.style.display="none";this.fileManagerMenu.firstChild;)this.fileManagerMenu.removeChild(this.fileManagerMenu.lastChild)},menuClick:function(a){this.menuCallBack();
ContextMenuObj.clearMenuContent();a.stopPropagation()},addEventListener:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})},removeEventListener:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,function(){c(window.event)})}};
FileUploadManager={missionIdFlag:-1,totalUploadSuccessCount:0,totalUploadFailureCount:0,tipBoxShowTime:6E3,errorRecords:new ErrorReasonRecorder,missionList:new Map,uploadFilesStart:function(a,b){this.missionIdFlag++;a=new FileUploadMission(this.missionIdFlag,a,b);this.missionList.set(this.missionIdFlag,a);this.createTipBox(a);a.start()},missionDone:function(a,b){this.totalUploadSuccessCount+=a.uploadSuccessCount;this.totalUploadFailureCount+=a.uploadFailureCount;this.missionList.delete(a.getMissionID());
this.refreshTipBox(a,b);0===this.missionList.size&&this.allMissionDone()},allMissionDone:function(){this.closeTipBox();this.showSummary();this.resetFileUploadManager()},resetFileUploadManager:function(){this.missionIdFlag=-1;this.totalUploadFailureCount=this.totalUploadSuccessCount=0;this.errorRecords=new ErrorReasonRecorder;this.missionList=new Map},addErrorRecord:function(a,b){this.errorRecords.addErrorReason(a,b)},createTipBox:function(a){var b=$("floatingUploadAll");b.style.opacity="1";b.style.bottom=
"50px";b=$("floatingWinUploadAllOuterContent");for(var c=a.getUploadFiles(),d=[],e=0;e<c.length;e++)d.push(c[e].name);d=d.join("\n");b.innerHTML+='<div id="ulAll'+a.getMissionID()+'" style="display:flex" >\n            <div class="ulAllStatus">\n                <img src=\'/sims/img/working.gif\' style="width: 15px; height: 15px;" />\n            </div>\n            <div class="uploadAllContent" style="padding:10px;" title="'+d+'">\n'+getBundleString("fileManager_uploading",[c.length])+"            </div>\n        </div>"},
refreshTipBox:function(a,b){a=$("ulAll"+a.getMissionID());a.querySelector(".ulAllStatus").innerHTML="<i class='fa fa-check' style='color:#29c529'></i>";b?a.querySelector(".uploadAllContent").innerHTML=b:a.querySelector(".uploadAllContent").innerHTML=lm.fileManager_uploadFinished},closeTipBox:function(){setTimeout(function(){var a=$("floatingUploadAll");a.style.opacity="0";a.style.bottom="-1000px";$("floatingWinUploadAllOuterContent").innerHTML=""},FileUploadManager.tipBoxShowTime)},showSummary:function(){if(this.errorRecords.isEmpty())floatWinAlert(lm.fileManager_uploadAllFinished,
function(){window.location.reload()},null);else{var a=this.totalUploadSuccessCount,b=getBundleString("fileManager_summaryMsgTitle",[this.totalUploadSuccessCount+this.totalUploadFailureCount,this.totalUploadSuccessCount,this.totalUploadFailureCount]);b+=lm.fileManager_summaryFailureFile;this.errorRecords.setMsgTitle(b);this.errorRecords.setCallBack(function(){0<a&&window.location.reload()});this.errorRecords.showErrorReasonRecords()}}};
function FileUploadMission(a,b,c){this.missionID=a;this.uploadFailureCount=this.uploadSuccessCount=0;this.uploadFiles=this.selectedFiles=b;this.fieldInfo=c}FileUploadMission.prototype.getMissionID=function(){return this.missionID};FileUploadMission.prototype.getUploadFiles=function(){return this.uploadFiles};FileUploadMission.prototype.start=function(){this.preCheck();this.upload()};
FileUploadMission.prototype.upload=function(){for(var a=this,b=this.uploadFiles.length,c=new FormData,d=0;d<b;d++)c.append("uf",this.uploadFiles[d],this.uploadFiles[d].name);b="/sims/fileManagerUploader.jsp?a="+this.fieldInfo.apName+"&p="+this.fieldInfo.path+"&si="+this.fieldInfo.sheetIndex+"&ud="+this.fieldInfo.domainId+"&n="+this.fieldInfo.rootNodeId+"&fc="+b;this.fieldInfo.isSubtableField&&(b+="&isSub="+this.fieldInfo.isSubtableField+"&subtableRootNodeId="+this.fieldInfo.subtableRootNodeId);fetch(b,
{method:"POST",body:c}).then(function(a){return a.text()}).then(function(b){b=b.replaceAll("\r\n","").replaceAll("\n","");b=b.substring(b.indexOf("fM_Uploader:")+12);""!==b?a.upLoadFailure(b):a.selectedFiles.length!=a.uploadFiles.length?a.upLoadSuccess(getBundleString("fileManager_tipBoxExceedError",[a.fieldInfo.limitSize||("DISTR"===licenseType?"10":"1"),a.fieldInfo.limitUnit||"GB"])):a.upLoadSuccess()}).catch(function(a){console.log(a);alert("upload failure!")})};
FileUploadMission.prototype.preCheck=function(){this.removeFilesWhichExceedMaxSize()};FileUploadMission.prototype.upLoadSuccess=function(a){this.uploadSuccessCount=this.uploadFiles.length;this.uploadFailureCount=this.selectedFiles.length-this.uploadFiles.length;this.done(a)};
FileUploadMission.prototype.upLoadFailure=function(a){this.uploadSuccessCount=0;this.uploadFailureCount=this.selectedFiles.length;for(var b,c=0;c<this.uploadFiles.length;c++)b=this.uploadFiles[c],this.addErrorRecord(b.name,"<h4>"+a+"</h4>");this.done(a)};FileUploadMission.prototype.done=function(a){FileUploadManager.missionDone(this,a)};FileUploadMission.prototype.addErrorRecord=function(a,b){FileUploadManager.addErrorRecord(a,b)};
FileUploadMission.prototype.removeFilesWhichExceedMaxSize=function(){var a=this.selectedFiles,b=this.fieldInfo,c=parseInt(b.limitBytes||("DISTR"===licenseType?10737418240:1073741824)),d=b.limitSize||("DISTR"===licenseType?"10":"1");b=b.limitUnit||"GB";for(var e=[],f=[],g=0;g<a.length;g++)a[g].size<=c?e.push(a[g]):f.push(a[g]);a=f.length;if(0<a)for(c=0;c<a;c++){g=f[c];g=g.name+"("+this.unitizeFile(g.size)+")";var k=getBundleString("fileManager_exceedReason",[d,b]);this.addErrorRecord(g,k)}this.uploadFiles=
e};FileUploadMission.prototype.unitizeFile=function(a){for(var b="KB MB GB TB PB EB".split(" "),c="Bytes",d=0;1024<=a;)a/=1024,c=b[d++];return formatNumber(a,"#,###.#")+" "+c};function createNode(a,b,c,d){a=document.createElement(a);b&&(a.id=b);c&&(a.className=c);void 0!==d&&("string"===typeof d&&(d=document.createTextNode(d)),d instanceof Node&&a.appendChild(d));return a}
function utf16_substring(a,b,c){var d=0,e,f=a.length;void 0===c&&(c=a.length);for(e=0;d<f&&e<b;++e)d+=65535<a.codePointAt(d)?2:1;for(b=d;b<f&&e<c;++e)b+=65535<a.codePointAt(b)?2:1;return a.substring(d,b)}function queryString(){for(var a={},b=window.location.search.substring(1).split("&"),c=0;c<b.length;c++){var d=b[c].split("=");"undefined"===typeof a[d[0]]?a[d[0]]=d[1]:"string"===typeof a[d[0]]?a[d[0]]=[a[d[0]],d[1]]:a[d[0]].push(d[1])}return a}
function changeSheetLoadMode(a){var b=queryString();b.sheetLoadMode=a;b.page="1";a=Object.keys(b);for(var c="",d=0;d<a.length;d++)0!=d&&(c+="&"),c+=a[d]+"="+b[a[d]];window.location="fileManager?"+c}function changePage(a){var b=queryString();b.page=a;a=Object.keys(b);for(var c="",d=0;d<a.length;d++)0!=d&&(c+="&"),c+=a[d]+"="+b[a[d]];window.location="fileManager?"+c}function getFile(a){return new Promise(function(b,c){fetch(a).then(function(a){return a.arrayBuffer()}).then(function(a){b(a)})})}
function downloadFiles(a){function b(a){return new Promise(function(b,c){fetch(a).then(function(a){return a.arrayBuffer()}).then(function(a){b(a)})})}function c(a,c,d){var f=new JSZip,k=[],l=[];a.forEach(function(a){var d=b(a).then(function(b){for(var d=decodeURIComponent(a.substring(a.lastIndexOf("&f=")+3)).split("@")[1],e=1,g=d.substring(0,d.lastIndexOf(".")),k=d.substring(d.lastIndexOf("."));l.includes(d);)d=g+"("+e++ +")"+k;l.push(d);f.file(c+d,b,{binary:!0})});k.push(d)});Promise.all(k).then(function(){f.generateAsync({type:"blob",
compression:"DEFLATE",compressionOptions:{level:1}}).then(function(a){saveAs(a,"fileManager.zip");e(d,g)})})}function d(a,b,c){(function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="blob";c.onload=function(){200===c.status&&b(c.response)};c.send()})(a,function(a){saveAs(a,b);e(c,g)})}function e(a,b){var c=$("dlAll"+a);c.querySelector(".dlAllStatus").innerHTML="<i class='fa fa-check' style='color:#29c529'></i>";c.querySelector(".downloadAllContent").innerHTML=getBundleString("fileManager_downloadFinished",
[b]);ctrl.downloadingFiles.delete(a);setTimeout(function(){0===ctrl.downloadingFiles.size&&(m.style.opacity="0",m.style.bottom="-1000px")},2E3)}function f(a,b){return a&&a.startsWith("data:image")?a:cdn+"/sims/file.jsp?a="+apName+"&f="+encodeURIComponent(a)+(b?"&force":"")}var g=a.length;FileManagerController.downloadDivNum?FileManagerController.downloadDivNum++:FileManagerController.downloadDivNum=1;if(1==g){var k=f(a[0].ragicValue,!0);d(k,a[0].displayName,FileManagerController.downloadDivNum)}else if(2<=
g){var l=[];a.forEach(function(a){l.push(f(a.ragicValue))});c(l,"["+a[0].fieldHeader+"]",FileManagerController.downloadDivNum)}else return;var m=$("floatingDownloadAll");m.style.opacity="1";m.style.bottom="50px";$("floatingWinDownloadAllOuterContent").innerHTML="";a=a.map(function(a){return a.displayName}).join("\n");ctrl.downloadingFiles.set(FileManagerController.downloadDivNum,{filesCount:g,fileNamesList:a});ctrl.downloadingFiles.forEach(function(a,b){$("floatingWinDownloadAllOuterContent").innerHTML+=
'<div id="dlAll'+b+'" style="display:flex" >\n            <div class="dlAllStatus">\n                <img src=\'/sims/img/working.gif\' style="width: 15px; height: 15px;" />\n            </div>\n            <div class="downloadAllContent" style="padding:10px;" title="'+a.fileNamesList+'">\n'+getBundleString("fileManager_downloading",[a.filesCount])+"            </div>\n        </div>"})}
function MultiRangeSlider(a){var b=deepCopy(MultiRangeSlider.defaults);if(b){if(!isPlainObject(b))throw new TypeError("defaults must be a object");for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])}if(a){if(!isPlainObject(a))throw new TypeError("argument config must be a object");for(var d in a)a.hasOwnProperty(d)&&(this[d]=a[d])}Array.isArray(this.rawData)||(this.rawData=this._parse(this.rawData));this.ranges=this.rawData.length?this.createRanges(this.rawData):this.createRanges(this.defaultRawData);
this.scopedCSSFlag=genScopedCSSFlag();this.style=this.genScopedCSS()}
MultiRangeSlider.prototype.genScopedCSS=function(){return".card-shadow["+this.scopedCSSFlag+"] {\n   box-shadow: rgb(0 0 0 / 20%) 0px 3px 1px -2px, rgb(0 0 0 / 14%) 0px 2px 2px 0px, rgb(0 0 0 / 12%) 0px 1px 5px 0px !important;\n}\n.multi-range-slider-btn__grab["+this.scopedCSSFlag+"] {\n   cursor: grab;\n}\n.multi-range-slider-btn__grabbing["+this.scopedCSSFlag+"] {\n   cursor: grabbing;\n}\n.multi-range-slider-main["+this.scopedCSSFlag+"] {\n   width: "+this.bar.width+"px;\n}\n.multi-range-slider["+
this.scopedCSSFlag+"] > div {\n   position: relative;\n}\n.multi-range-slider-btn["+this.scopedCSSFlag+"] * {\n   display: none;\n   user-select: none;\n}\n.multi-range-slider-btn["+this.scopedCSSFlag+"]:not(.multi-range-slider-btn__typing) {\n   width: "+this.btn.size+"px;\n   height: "+this.btn.size+"px;\n   font-size: "+this.btn.fontSize+"px;\n   font-weight: bold;\n   background-color: #ffffff;\n   border-radius: 100%;\n   position: absolute;\n   display: flex;\n   justify-content: center;\n   align-items: center;\n   z-index: 10;\n   touch-action: none;\n   transform: rotate(-45deg);\n   transform-origin: center;\n   right: -"+
this.btn.size/2+"px;\n   top: "+-this.btn.size+"px;\n   border-bottom-left-radius: 0px;\n}\n.multi-range-slider-btn["+this.scopedCSSFlag+']:not(.multi-range-slider-btn__typing) > .multi-range-slider-btn-close {\n   content: "+";\n   display: none;\n   position: absolute;\n   top: 0;\n   right: -25px;\n   font-size: 24px;\n   width: 20px;\n   height: 20px;\n   cursor: pointer !important;\n   border-radius: 100%;\n   background-color: #FFFFFF;\n   justify-content: center;\n   align-items: center;\n   padding: 5px;\n   border: 2px solid #b0b0b0;\n   color: #414040;\n}\n.multi-range-slider-btn['+
this.scopedCSSFlag+"]:not(.multi-range-slider-btn__typing) > span {\n   transform: rotate(45deg);\n   pointer-events: none;\n   display: inline !important;\n}\n.multi-range-slider-btn["+this.scopedCSSFlag+"]:not(.multi-range-slider-btn__typing):hover {\n   transition: transform 0.1s ease-out;\n   transform: translateY(-5px) rotate(-45deg); \n}\n.multi-range-slider-btn["+this.scopedCSSFlag+"]:not(.multi-range-slider-btn__typing):hover > .multi-range-slider-btn-close {\n  display: flex;\n}\n.multi-range-slider-btn["+
this.scopedCSSFlag+"]:not(.multi-range-slider-btn__typing):hover > span {\n   transform: rotate(45deg);\n}\n.multi-range-slider-btn["+this.scopedCSSFlag+"].multi-range-slider-btn__typing > .multi-range-slider-btn-edit-arrow {\n   display: block !important;\n   background-color: #ffebc6;\n   width: 10px;\n   height: 10px;\n   transform: rotate(45deg);\n   position: absolute;\n   top: -6px;\n   right: -5px;\n   z-index: 105;\n}\n.multi-range-slider-btn["+this.scopedCSSFlag+"].multi-range-slider-btn__typing > .multi-range-slider-btn-edit-block {\n   position: absolute;\n   bottom: "+
this.bar.height+"px;\n   right: -75px;\n   width: 150px;\n   box-sizing: border-box;\n   background-color: #ffebc6;\n   z-index: 100;\n   display: flex;\n   justify-content: center;\n   align-items: center;\n   flex-direction: column;\n   padding: 10px 20px;\n   border-radius: 5px;\n   cursor: pointer;\n}\n.multi-range-slider-btn["+this.scopedCSSFlag+"].multi-range-slider-btn__typing > .multi-range-slider-btn-edit-block input {\n   width: 70%;\n   height: 30px;\n   border: none;\n   border-bottom: 2px solid #ababff;\n   padding-left: 7px;\n   font-weight: 650;\n   color: #646464;\n   display: block;\n}\n.multi-range-slider-btn["+
this.scopedCSSFlag+"].multi-range-slider-btn__typing > .multi-range-slider-btn-edit-block .multi-range-slider-btn-edit-ok {\n   background-color: #fc9393;\n   padding: 0 7px;\n   color: white;\n   border-radius: 5px;\n   font-size: 12px;\n   height: 30px;\n   display: flex;\n   justify-content: center;\n   align-items: center;\n   margin-left: 10px;\n   user-select: none;\n}\n.multi-range-slider-btn["+this.scopedCSSFlag+"].multi-range-slider-btn__typing > .multi-range-slider-btn-edit-block .multi-range-slider-btn-edit-ok:hover {\n   background-color: #f18181;\n}\n.multi-range-slider-btn-edit-block__error["+
this.scopedCSSFlag+"] input {\n   color: #fc2727 !important;\n   border-color: #fc2727 !important;\n}\n.multi-range-slider-btn-edit-block__error["+this.scopedCSSFlag+"] .multi-range-slider-btn-edit-error {\n   display: block;\n}\n.multi-range-slider-btn-edit-error["+this.scopedCSSFlag+"] {\n   display: none;\n   color: #fc2727;\n   border-color: #fc2727;\n   font-weight: 600;\n   font-size: 12px;\n   margin-top: 5px;\n   text-align: left;\n   width: 100%;\n}\n.multi-range-slider-scale["+this.scopedCSSFlag+
"] {\n   display: flex;\n   width: 100%;\n   height: 5px;\n}\n.multi-range-slider-scale["+this.scopedCSSFlag+"] > div:first-child {\n   border-left: 3px solid grey;\n}\n.multi-range-slider-scale["+this.scopedCSSFlag+"] > div {\n   flex: 1;\n   height: 100%;\n   margin-right: -1px;\n   border-left: 2px solid grey;\n   border-right: 2px solid grey;\n   color: #878787;\n}\n.multi-range-slider-scale["+this.scopedCSSFlag+"] > div::before {\n   margin-left: -10px;\n   font-size: "+this.scale.fontSize+"px;\n   margin-top: 10px;\n   display: inline-block;\n}\n.multi-range-slider-scale["+
this.scopedCSSFlag+"] > div:last-child::before {\n   margin-left: -15px;\n}\n.multi-range-slider-scale-0["+this.scopedCSSFlag+"]::before {\n   content: '0"+this.unit+"';\n}\n.multi-range-slider-scale-1["+this.scopedCSSFlag+"]::before {\n   content: '10"+this.unit+"';\n}\n.multi-range-slider-scale-2["+this.scopedCSSFlag+"]::before {\n   content: '20"+this.unit+"';\n}\n.multi-range-slider-scale-3["+this.scopedCSSFlag+"]::before {\n   content: '30"+this.unit+"';\n}\n.multi-range-slider-scale-4["+this.scopedCSSFlag+
"]::before {\n   content: '40"+this.unit+"';\n}\n.multi-range-slider-scale-5["+this.scopedCSSFlag+"]::before {\n   content: '50"+this.unit+"';\n}\n.multi-range-slider-scale-6["+this.scopedCSSFlag+"]::before {\n   content: '60"+this.unit+"';\n}\n.multi-range-slider-scale-7["+this.scopedCSSFlag+"]::before {\n   content: '70"+this.unit+"';\n}\n.multi-range-slider-scale-8["+this.scopedCSSFlag+"]::before {\n   content: '80"+this.unit+"';\n}\n.multi-range-slider-scale-9["+this.scopedCSSFlag+"]::before {\n   content: '90"+
this.unit+"';\n}\n.multi-range-slider-scale-10["+this.scopedCSSFlag+"]::before {\n   content: '100"+this.unit+"';\n}\n"};MultiRangeSlider.prototype._parse=function(a){a=a||"";if("string"===typeof a){a=a.splitIgnoreEmpty("|");for(var b=[],c=0,d,e=a.length;c<e;c++){d=a[c];var f=d.split(":");d=f[0].split("-");f=f[1].split(",");b.push({range:d,style:{backgroundColor:f[0],color:f[1]}})}return b}};MultiRangeSlider.prototype.createRanges=function(a){return a.map(function(a){return new SliderRange(a)})};
MultiRangeSlider.prototype._h=function(a,b,c){var d={};d[this.scopedCSSFlag]=!0;2!==arguments.length||isPlainObject(b)||(c=b,b={});var e={},f;for(f in b)e[f]="attrs"===f?Object.assign({},b[f],d):b[f];"attrs"in e||(e.attrs=d);return h(a,e,c)};
MultiRangeSlider.prototype.render=function(){var a=this._h.bind(this);this.registerListener();var b=a("div",{class:["multi-range-slider","card-shadow"]});b.appendChild(this._renderRanges());this.slider=b;for(var c=[],d=0;11>d;d++)c.push(a("div",{class:"multi-range-slider-scale-"+d,style:10===d?{width:0,flex:0,borderRight:"none"}:{}}));c=a("div",{class:"multi-range-slider-scale"},c);this.style+=".multi-range-slider["+this.scopedCSSFlag+"] {\n   height: "+this.bar.height+"px;\n   display: grid;\n   display: -ms-grid;\n   grid-template-columns: "+
this.gridRangeWidths.join(" ")+";\n   -ms-grid-columns: "+this.gridRangeWidths.join(" ")+";\n   margin-bottom: 5px;\n   cursor: crosshair;\n}\n";d=a("style",this.style);return a("div",{class:"multi-range-slider-main"},[d,b,c])};MultiRangeSlider.prototype.registerListener=function(){window.addEventListener("pointermove",this.resizeRange.bind(this));window.addEventListener("pointerup",this.endResizeRange.bind(this));window.addEventListener("pointerdown",this.exitTyping.bind(this))};
MultiRangeSlider.prototype.showSliderDropWin=function(){var a=event.currentTarget;if(!ifRightClick(event)&&event.target===a){clearDropWin();var b=event.targetTouches&&event.targetTouches[0]?event.targetTouches[0].clientX:event.clientX;this.dropWinListStartX=b;this.currentRangeDiv=a;this.currentRangeIndex=parseInt(a.dataset.rangeIndex);this.currentRange=this.ranges[this.currentRangeIndex];var c=this.currentRange.style.color,d=this.currentRange.style.backgroundColor;this.removePrevRangeColor=this.currentRangeIndexs=
null;dropWinList.call(null,a,[{text:lm.addSliderDelimeter,callback:this.addDelimeterPoint.bind(this,b)},{text:'<div id="dropWinTextColorOpt" style="background-color: '+c+'"></div>'+lm.setSliderRangeTextColor,callback:this.showTextColorPicker.bind(this)},{text:'<div id="dropWinBgColorOpt" style="background-color: '+d+'"></div>'+lm.setSliderRangeBackgroundColor,callback:this.showBackgroundColorPicker.bind(this)}],!0)}};
MultiRangeSlider.prototype.removeDelimeterPoint=function(){var a=event.currentTarget.parentNode;!ifRightClick(event)&&a&&(a=parseInt(a.dataset.rangeIndex),a===this.currentRangeIndex-1&&(this.removePrevRangeColor=[this.ranges[a].style.backgroundColor,this.ranges[a].style.color]),a<this.currentRangeIndex&&--this.currentRangeIndex,this.ranges[a].max=this.ranges[a+1].max,this.ranges.splice(a+1,1),this.reRenderRanges())};
MultiRangeSlider.prototype.addDelimeterPoint=function(a){cancelEventBubble(event);var b=this.currentRangeDiv.getBoundingClientRect(),c=parseFloat(((a-b.left)/this.bar.width*100).toFixed(this.digit));a=this.currentRange;b=a.max;a.max=a.min+c;c={};c.range=[a.max,b];c.style=deepCopy(a.style);this.ranges.splice(this.currentRangeIndex,1,[a,new SliderRange(c)]);this.ranges=this.ranges.flat();this.reRenderRanges();this.currentRangeIndexs=[this.currentRangeIndex,this.currentRangeIndex+1]};
MultiRangeSlider.prototype._showColorPicker=function(a){MultiRangeSliderColorPicker.setCallback(null);MultiRangeSliderColorPicker.setHex(a);MultiRangeSliderColorPicker.setOriginHex(a);dropWin(event.currentTarget,$("multiRangeSliderColorPicker"),!1,!0)};
MultiRangeSlider.prototype.showTextColorPicker=function(){var a=this;a._showColorPicker(a.currentRange.style.color);MultiRangeSliderColorPicker.setCallback(function(b){var c=0;Array.isArray(a.removePrevRangeColor)&&2===a.removePrevRangeColor.length&&(b=a.removePrevRangeColor[1]);Array.isArray(a.currentRangeIndexs)&&2===a.currentRangeIndexs.length&&(c=1);if(a.excludeMax)switch(c){case 0:a.ranges[a.currentRangeIndex]&&(a.ranges[a.currentRangeIndex].style.color=b);break;case 1:a.ranges[a.currentRangeIndexs[0]]&&
(a.ranges[a.currentRangeIndexs[0]].style.color=b),a.ranges[a.currentRangeIndexs[1]]&&(a.ranges[a.currentRangeIndexs[1]].style.color=b)}a.currentRangeIndexs=null;a.removePrevRangeColor=null;$("dropWinTextColorOpt").style.backgroundColor=b})};
MultiRangeSlider.prototype.showBackgroundColorPicker=function(a){var b=this;b._showColorPicker(b.currentRange.style.backgroundColor);MultiRangeSliderColorPicker.setCallback(function(a){var c=0;Array.isArray(b.removePrevRangeColor)&&2===b.removePrevRangeColor.length&&(a=b.removePrevRangeColor[0]);if(Array.isArray(b.currentRangeIndexs)&&2===b.currentRangeIndexs.length){var e=b.slider.querySelector("[data-range-index='"+b.currentRangeIndexs[0]+"']");var f=b.slider.querySelector("[data-range-index='"+
b.currentRangeIndexs[1]+"']");c=1}else var g=b.slider.querySelector("[data-range-index='"+b.currentRangeIndex+"']");if(b.excludeMax)switch(c){case 0:b.ranges[b.currentRangeIndex]&&g&&(b.ranges[b.currentRangeIndex].style.backgroundColor=a,g.style.backgroundColor=a,b.excludeMax&&g.previousElementSibling&&(g.previousElementSibling.querySelector(".multi-range-slider-btn").style.color=a));break;case 1:b.ranges[b.currentRangeIndexs[0]]&&e&&(b.ranges[b.currentRangeIndexs[0]].style.backgroundColor=a,e.style.backgroundColor=
a,e.querySelector(".multi-range-slider-btn").style.color=a,e.previousElementSibling&&(e.previousElementSibling.querySelector(".multi-range-slider-btn").style.color=a)),b.ranges[b.currentRangeIndexs[1]]&&f&&(b.ranges[b.currentRangeIndexs[1]].style.backgroundColor=a,f.style.backgroundColor=a)}b.currentRangeIndexs=null;b.removePrevRangeColor=null;$("dropWinBgColorOpt").style.backgroundColor=a})};
MultiRangeSlider.prototype._renderRanges=function(){var a=this,b=a._h.bind(a);a.gridRangeWidths=[];for(var c=document.createDocumentFragment(),d=0,e=a.ranges.length;d<e;d++)a.gridRangeWidths.push(a.ranges[d].widthPercent+"%"),c.appendChild(b("div",{attrs:{"data-range-index":d},style:a.ranges[d].style,callback:function(b){b.addEventListener("pointerdown",a.showSliderDropWin.bind(a))}},d!==e-1?b("div",{attrs:{"data-range-index":d},class:["multi-range-slider-btn","card-shadow","multi-range-slider-btn__grab"],
style:{color:a.excludeMax&&0!==a.ranges[d+1].widthPercent?a.ranges[d+1].style.backgroundColor:a.ranges[d].style.backgroundColor},callback:function(b){b.addEventListener("pointerdown",a.startResizeRange.bind(a));b.addEventListener("dblclick",a.inTyping.bind(a))}},[b("span",a.ranges[d].max+""),b("div",{class:"multi-range-slider-btn-close",callback:function(b){b.addEventListener("click",a.removeDelimeterPoint.bind(a))}},"+"),b("div",{class:["multi-range-slider-btn-edit-block","card-shadow"]},[b("div",
{style:"display: flex; justify-content: space-between; width: 100%;"},[b("input",{attrs:{type:"text"},callback:function(b){b.addEventListener("input",a.typingProcessing.bind(a,b));b.addEventListener("keyup",a.typingKeyup.bind(a))}}),b("div",{class:"multi-range-slider-btn-edit-ok",callback:function(b){b.addEventListener("click",a.submitTypingResult.bind(a))}},"OK")]),b("div",{class:"multi-range-slider-btn-edit-error"})]),b("div",{class:["multi-range-slider-btn-edit-arrow"]})]):""));return c};
MultiRangeSlider.prototype.reRenderRanges=function(){this.slider.innerHTML="";this.slider.appendChild(this._renderRanges());this.slider.style.gridTemplateColumns=this.slider.style.msGridColumns=this.gridRangeWidths.join(" ")};
MultiRangeSlider.prototype.startResizeRange=function(a){if(!this.typing){this.dragging={};this.dragging.startDragX=a.pageX;this.dragging.btn=a.currentTarget;this.dragging.btn.classList.remove("multi-range-slider-btn__grab");this.dragging.btn.classList.add("multi-range-slider-btn__grabbing");a=parseInt(this.dragging.btn.dataset.rangeIndex);var b=this.dragging.prevRange=this.ranges[a],c=this.dragging.nextRange=this.ranges[a+1];this.dragging.prevRangeIndex=a;this.dragging.nextRangeIndex=a+1;this.dragging.prevRangeOriWidthPercent=
b.widthPercent;this.dragging.nextRangeOriWidthPercent=c.widthPercent;this.dragging.maxPercent=b.widthPercent+c.widthPercent;"none"!==$("dropWinList").style.display&&this.dropWinListStartX&&(b=this.slider.getBoundingClientRect(),b=parseFloat((this.dropWinListStartX-b.left)/this.bar.width*100),this.currentRangeIndex===a?this.dragging.restrictVal=Math.ceil(b):this.currentRangeIndex===a+1&&(this.dragging.restrictVal=Math.floor(b)))}};
MultiRangeSlider.prototype.resizeRange=function(a){if(!this.typing&&this.dragging){var b=this.dragging,c=b.btn,d=b.startDragX,e=b.maxPercent,f=b.prevRange,g=b.nextRange,k=b.prevRangeIndex,l=b.nextRangeIndex,m=b.restrictVal;b=parseInt(c.dataset.rangeIndex);d=parseFloat(((a.pageX-d)/this.bar.width*100).toFixed(this.digit));a=limitNumberWithinRange(this.dragging.prevRangeOriWidthPercent+d,0,e);f.max=parseFloat((f.min+a).toFixed(this.digit));m&&(this.currentRangeIndex===k&&f.max<m||this.currentRangeIndex===
l&&f.max>m)&&(f.max=m,a=limitNumberWithinRange(f.max-f.min,0,e),d=a-this.dragging.prevRangeOriWidthPercent);e=limitNumberWithinRange(this.dragging.nextRangeOriWidthPercent-d,0,e);g.min=parseFloat((g.max-e).toFixed(this.digit));k=this.gridRangeWidths.length=0;for(l=this.ranges.length;k<l;k++)k===b?this.gridRangeWidths.push(a+"%"):k===b+1?this.gridRangeWidths.push(e+"%"):this.gridRangeWidths.push(this.ranges[k].widthPercent+"%");2===this.ranges.length&&(c.style.color=0===a?g.style.backgroundColor:0===
e?f.style.backgroundColor:this.excludeMax?g.style.backgroundColor:f.style.backgroundColor);this.slider.style.gridTemplateColumns=this.slider.style.msGridColumns=this.gridRangeWidths.join(" ");c.children[0].innerHTML=f.max}};
MultiRangeSlider.prototype.endResizeRange=function(a){if(!this.typing&&this.dragging){this.dragging.btn.classList.remove("multi-range-slider-btn__grabbing");this.dragging.btn.classList.add("multi-range-slider-btn__grab");var b;0===this.dragging.prevRange.widthPercent&&(b=this.ranges.indexOf(this.dragging.prevRange));0===this.dragging.nextRange.widthPercent&&(b=this.ranges.indexOf(this.dragging.nextRange));void 0!==b&&(this.ranges.splice(b,1),this.reRenderRanges());delete this.dragging}};
MultiRangeSlider.prototype.inTyping=function(){this.typing={};this.typing.btn&&this.typing.btn.classList.remove("multi-range-slider-btn__typing");var a=this.typing.btn=event.currentTarget;a.classList.add("multi-range-slider-btn__typing");a.classList.remove("multi-range-slider-btn__grab");this.typing.input=a.querySelector("input");var b=parseInt(a.dataset.rangeIndex);this.typing.input.value=this.ranges[b].max;a=a.querySelector(".multi-range-slider-btn-edit-error");this.typing.prevRangeMin=this.ranges[b].min;
this.typing.nextRangeMax=this.ranges[b+1].max;this.typing.errorType=this.constructor.typingErrorType.RANGE;a.innerHTML=getBundleString("rangeError",[this.typing.prevRangeMin,this.typing.nextRangeMax])};MultiRangeSlider.prototype.exitTyping=function(a){a&&a.target.closest(".multi-range-slider-btn")||!this.typing||(this.typing.btn&&(this.typing.btn.classList.remove("multi-range-slider-btn__typing"),this.typing.btn.classList.add("multi-range-slider-btn__grab")),delete this.typing)};
MultiRangeSlider.prototype.typingProcessing=function(a){var b=parseFloat(a.value),c=this.typing.btn,d=c.querySelector(".multi-range-slider-btn-edit-error");isNumeric(a.value)?b<this.typing.prevRangeMin||b>this.typing.nextRangeMax?(this.typing.errorType!==this.constructor.typingErrorType.RANGE&&(this.typing.errorType=this.constructor.typingErrorType.RANGE,d.innerHTML=getBundleString("rangeError",[this.typing.prevRangeMin,this.typing.nextRangeMax])),c.classList.add("multi-range-slider-btn-edit-block__error"),
this.typing.hasError=!0):(c.classList.remove("multi-range-slider-btn-edit-block__error"),this.typing.hasError=!1):(this.typing.errorType!==this.constructor.typingErrorType.TYPE&&(this.typing.errorType=this.constructor.typingErrorType.TYPE,d.innerHTML=lm.typeError),c.classList.add("multi-range-slider-btn-edit-block__error"),this.typing.hasError=!0,""===a.value&&c.classList.remove("multi-range-slider-btn-edit-block__error"))};
MultiRangeSlider.prototype.typingKeyup=function(a){a.keyCode===KEYCODE.ENTER&&this.submitTypingResult()};
MultiRangeSlider.prototype.submitTypingResult=function(a){a&&cancelEventBubble(a);if(this.typing&&!this.typing.hasError){var b=this.typing.btn,c=parseFloat(this.typing.input.value);a=parseInt(b.dataset.rangeIndex);var d=this.ranges[a],e=this.ranges[a+1],f;if(d.max!==c||c!==e.min){b.children[0].innerHTML=d.max=e.min=c;b=this.gridRangeWidths.length=0;for(c=this.ranges.length;b<c;b++)b===a?0===d.widthPercent?f=b:this.gridRangeWidths.push(d.widthPercent+"%"):b===a+1?0===e.widthPercent?f=b:this.gridRangeWidths.push(e.widthPercent+
"%"):this.gridRangeWidths.push(this.ranges[b].widthPercent+"%");this.slider.style.gridTemplateColumns=this.slider.style.msGridColumns=this.gridRangeWidths.join(" ");void 0!==f&&(this.ranges.splice(f,1),this.reRenderRanges());this.exitTyping()}}};MultiRangeSlider.prototype.reset=function(){this.toString()!==this.defaultRawDataString&&(this.ranges=this.createRanges(this.defaultRawData),this.reRenderRanges())};MultiRangeSlider.prototype.toString=function(){return this.ranges.map(function(a){return a.toString()}).join("|")};
MultiRangeSlider.defaults={bar:{width:800,height:17},btn:{size:30,fontSize:12},scale:{fontSize:12},unit:"%",excludeMax:!0,digit:0,rawData:[],defaultRawData:[{range:[0,25],style:{backgroundColor:"#FDD9D9",color:"#000000"}},{range:[25,50],style:{backgroundColor:"#FFC0C2",color:"#000000"}},{range:[50,75],style:{backgroundColor:"#F27079",color:"#FFFFFF"}},{range:[75,100],style:{backgroundColor:"#D50E0E",color:"#FFFFFF"}}],defaultRawDataString:"0-25:#FDD9D9,#000000|25-50:#FFC0C2,#000000|50-75:#F27079,#FFFFFF|75-100:#D50E0E,#FFFFFF"};
MultiRangeSlider.typingErrorType={RANGE:0,TYPE:1};function SliderRange(a){if(!isPlainObject(a))throw new SyntaxError("Invalid config format for SliderRange");this.min=parseFloat(a.range[0]);this.max=parseFloat(a.range[1]);this.style=a.style}SliderRange.prototype={get widthPercent(){return this.max-this.min},toString:function(){for(var a=[],b=Object.keys(this.style),c=0,d=b.length;c<d;c++)"backgroundColor"!==b[c]&&"color"!==b[c]||a.push(this.style[b[c]]);return this.min+"-"+this.max+":"+a.join(",")}};
function genScopedCSSFlag(){return"data-ragic-multi-range-slider-"+genRandom(7,!0)}function limitNumberWithinRange(a,b,c){return Math.min(Math.max(a,b),c)}function PercentageProgressBar(a){if(!a)throw Error("Invalid format for PercentageProgressBar");this.ranges=[];a=a.split("|");for(var b=0,c=a.length;b<c;b++)this.ranges.push(new PercentageRange(a[b]))}
PercentageProgressBar.prototype.outputBarHTML=function(a,b,c){var d=parseFloat((c+"").replaceAll("%","")),e=this.getBackgroundColor(d);d=this.getTextColor(d);if(e&&d)return"<div class='percentage-progress' style='height: "+b+"px;'><div class='percentage-progress-bar' style='width: "+c+"; line-height: "+b+"px; background-color: "+e+"; color: "+d+";"+("underline"===a.attr.styleVtextDecoration?"text-decoration: underline":"")+"'>"+c+"</div></div>"};
PercentageProgressBar.prototype._getBelongRange=function(a){if(a)for(var b=this.ranges,c=0,d,e=b.length;c<e;c++)if(d=b[c],a>=d.min&&(a<d.max||100===d.max&&100===a))return d};PercentageProgressBar.prototype.getBackgroundColor=function(a){if(a=this._getBelongRange(a))return a.backgroundColor};PercentageProgressBar.prototype.getTextColor=function(a){if(a=this._getBelongRange(a))return a.textColor};
function PercentageRange(a){if(!a)throw Error("Invalid format for PercentageRange");var b=a.split(":");a=b[0].split("-");b=b[1].split(",");this.min=parseFloat(a[0]);this.max=parseFloat(a[1]);this.backgroundColor=b[0];this.textColor=b[1];if(!(isNumeric(this.min)&&isNumeric(this.max)&&this.backgroundColor.startsWith("#")&&this.textColor.startsWith("#")))throw Error("Invalid format for PercentageRange");}
function ImageCarousel(a,b){if(!Array.isArray(a))throw Error("imgUrls should be an array");var c=this,d=deepCopy(ImageCarousel.defaults);if(d){if(!isPlainObject(d))throw new TypeError("defaults must be a object");for(var e in d)d.hasOwnProperty(e)&&(c[e]=d[e])}if(b){if(!isPlainObject(b))throw new TypeError("argument config must be a object");for(var f in b)b.hasOwnProperty(f)&&(c[f]=b[f])}c.imgsArr=[];c.dotsArr=[];c.galleryImgsArr=[];c.render=function(){c.gallery.enabled&&(c.gallerySlider=h("div",
{class:"image-carousel-footer-gallery-slider",style:{width:100*c.percent+"%"}},c.galleryImgsArr),c.gallerySlider.style.left=-100*Math.floor(c.currentIndex/c.gallery.groupSize)+"%");return h("div",{class:"image-carousel"},[h("div",{class:["image-carousel-container","flex-center-center"]},[c.imgsArr,c.leftArrow,c.rightArrow].flat()),h("div",{class:"image-carousel-footer",style:c.gallery.enabled?"flex: 1 0 20%":""},[h("div",{class:["image-carousel-footer-dots","flex-center-center"]},c.dotsArr),c.gallery.enabled?
h("div",{class:"image-carousel-footer-gallery"},c.gallerySlider):null])])};c.leftIn=function(a){a&&cancelEventBubble(a);a=c.currentIndex;c.currentIndex--;if(0>c.currentIndex)if(c.loop)c.currentIndex=c.imgsArr.length-1;else if(c.currentIndex=0,c.auto.enabled){c.rightIn();c.refreshAutoSlide();return}c.leave(a,"left");c.enter(c.currentIndex,"left")};c.rightIn=function(a){a&&cancelEventBubble(a);a=c.currentIndex;c.currentIndex++;if(c.currentIndex>c.imgsArr.length-1)if(c.loop)c.currentIndex=0;else if(c.currentIndex=
c.imgsArr.length-1,c.auto.enabled){c.leftIn();c.refreshAutoSlide("left");return}c.leave(a,"right");c.enter(c.currentIndex,"right")};c.leave=function(a,b){var d=c.imgsArr[a],e=c.dotsArr[a],f=c.galleryImgsArr[a];a="image-carousel-"+b+"-in-leave-";var g=a+"from",k=a+"active",p=a+"to";d.classList.add(g,k);c.leaveTransitionTimeout=setTimeout(function(){d.classList.add(p);e.classList.remove("image-carousel-footer-dots--active");f.classList.remove("image-carousel-footer-gallery-slider--active");c.leaveTransitionTimeout=
setTimeout(function(){d.classList.remove(g,k,p);d.style.display="none"},700)},30)};c.enter=function(a,b){var d=c.imgsArr[a],e=c.dotsArr[a],f=c.galleryImgsArr[a],g="image-carousel-"+b+"-in-enter-",k=g+"from",p=g+"active",t=g+"to";d.classList.add(k,p);d.style.display="";c.enterTransitionTimeout=setTimeout(function(){d.classList.add(t);e.classList.add("image-carousel-footer-dots--active");f.classList.add("image-carousel-footer-gallery-slider--active");c.gallerySlider&&(c.gallerySlider.style.left=-100*
Math.floor(a/c.gallery.groupSize)+"%");c.loop||("right"===b?(c.leftArrow.style.display="",a===c.imgsArr.length-1&&(c.rightArrow.style.display="none")):"left"===b&&(c.rightArrow.style.display="",0===a&&(c.leftArrow.style.display="none")));c.enterTransitionTimeout=setTimeout(function(){d.classList.remove(k,p,t)},700)},30)};c.showImg=function(a){var b=c.currentIndex;a!==b&&(c.refreshAutoSlide(),c.currentIndex=a,a>b?(c.leave(b,"right"),c.enter(c.currentIndex,"right")):(c.leave(b,"left"),c.enter(c.currentIndex,
"left")))};c.refreshAutoSlide=function(a){c.auto.enabled&&(clearInterval(c.carouselInterval),a=a||"right",a="left"===a?c.leftIn.bind(c):"right"===a?c.rightIn.bind(c):null)&&(c.carouselInterval=setInterval(a,c.auto.time))};c.close=function(){clearInterval(c.carouselInterval);clearTimeout(c.enterTransitionTimeout);clearTimeout(c.leaveTransitionTimeout)};b=0;d=!1;for(e=a.length;b<e;b++,d=!1)c.dotsArr.push(h("div",{class:c.dotsMode})),c.galleryImgsArr.push(h("div",h("img",{attrs:{src:a[b]}}))),b===c.currentIndex&&
(d=!0,c.dotsArr[b].classList.add("image-carousel-footer-dots--active"),c.galleryImgsArr[b].classList.add("image-carousel-footer-gallery-slider--active")),c.imgsArr.push(h("div",{class:"image-carousel-img",style:{display:d?"":"none"}},h("img",{attrs:{src:a[b]}})));c.percent=Math.ceil(c.imgsArr.length/c.gallery.groupSize);a=100/c.percent/c.gallery.groupSize+"%";b=0;e=d=void 0;for(f=c.galleryImgsArr.length;b<f;b++)d=c.galleryImgsArr[b],e=c.dotsArr[b],d.style.flex="0 0 "+a,d.addEventListener("click",
c.showImg.bind(c,b)),e.addEventListener("click",c.showImg.bind(c,b));c.leftArrow=h("div",{class:["image-carousel-left-arrow","flex-center-center"]},[h("i",{class:["far","fa-chevron-left"],callback:function(a){a.addEventListener("click",function(a){c.refreshAutoSlide();c.leftIn(a)})}})]);c.rightArrow=h("div",{class:["image-carousel-right-arrow","flex-center-center"]},[h("i",{class:["far","fa-chevron-right"],callback:function(a){a.addEventListener("click",function(a){c.refreshAutoSlide();c.rightIn(a)})}})]);
c.loop||(0===c.currentIndex?c.leftArrow.style.display="none":c.currentIndex===c.imgsArr.length-1&&(c.rightArrow.style.display="none"));c.refreshAutoSlide()}ImageCarousel.defaults={currentIndex:0,dotsMode:"circle",loop:!0,gallery:{enabled:!0,groupSize:5},auto:{enabled:!1,time:3E3}};
var NO_CHANGE_SIGNAL={t:"No_Change"},formulaBuilder={listenMapping:{},lastExecute:(new Date).getTime(),getFormulaVariables:_get_formula_variables,updateLastExecute:function(){formulaBuilder.lastExecute=(new Date).getTime()},getIdle:function(){var a=(new Date).getTime();return a===this.lastExecute?1:a-this.lastExecute},updateField:function(a,b){var c=formulaMode.STRING,d=a.biff,e=biffdata.ifSubtableDataBiff(d),f=parseInt(d.nodeId),g=parseInt(d.parentNodeId);if(d.attr.dv_f&&isNumeric(g)&&0<=g)if(d.IPType===
SELECTOR||d.IPType===MSELECTOR){if(isNumeric(f)&&0<=f)return}else if(0<=f)return;this.updateLastExecute();d.attr&&(d.attr.fmt_d?c=formulaMode.DATE:d.attr.fmt_n&&(c=formulaMode.NUMBER));e=resolveFormula(b,e?d.y:0,c);e!==NO_CHANGE_SIGNAL&&(c===formulaMode.DATE&&isNumeric(e)&&(e=correctFormulaDateResult(e,d.attr.fmt_d)),c=/OR\(.*\)/.test(b),f=/AND\(.*\)/.test(b),g=/ISBLANK\(.*\)/.test(b),b=/APPROVAL.STEP\(.*\).ISMULTI\(\)/.test(b),e||!1===e&&(c||f||g||b)||0===e?(b=e.toString(),a.value!==b&&a.userInput!==
b&&(a.type===SELECTOR?d.hasAttribute("mvp")?(a.reloadNotify=!0,a._write(b,!0),b=a._getSuggest(!0),a.nodeIdSpecified&&d.value===b||((e=a.userInput+"")&&0<e.length?a.loadValue(b,!1,0,!0):a.loadValue("",!1,0,!0))):a.loadValue(b,!1,null,!0):a.loadValue(b,!1,null,!0),d.valueChangedByFormula=!0)):a.loadValue("",!1,null,!0),a.render(!1,!0),nui._updateFocus());this.updateLastExecute()},updateAll:function(){for(var a=Object.keys(this.listenMapping),b=0;b<a.length;b++)this.update(a[b])},update:function(a,b,
c){if(canSaveData()&&a){var d=b instanceof Biff?b.y:void 0;if(a=this.listenMapping[a]){for(var e=0;e<a.length;e++){var f=a[e],g=f.listeningIPs,k=[];g.hasOwnProperty(d)&&biffdata.ifSubtableDataBiff(b)&&biffdata.ifSubtableDataBiff(g[d].biff)?g[d].biff.y===d&&k.push(g[d]):k=Object.values(g);if(0!==k.length)for(var l=k.length;l--;)if(g=k[l],!g.biff.isEmptyRow||biffdata.ifListingPage())ctrl.cloneAction&&(""!==g.biff.value||!g.biff.attr.noclone)||ctrl.draftLoading||c&&biffdata.ifSubtableDataBiff(g.biff)&&
g.biff.y===d&&biffdata.isSameSubtable(g.biff,b)||formulaBuilder.updateField(g,f.formula)}ctrl.formulaResultCache={}}}},_translateToDomainRef:function(a){if(!a)return"";"="===a.substr(0,1)&&(a=a.substr(1));var b=Object.values(builder.cellData).filter(function(a){return!!a}).map(function(a){return[getCellName(a.x,a.y),"_RD"+a.hash+"RD_"]});return this.applyFormulaTextChange(a,function(a){return b.reduceRight(function(a,b){return a.replace(new RegExp(b[0],"gim"),b[1])},a)})},_translateToSpreadsheetRef:function(a){if(!a)return"";
"="===a.substr(0,1)&&(a=a.substr(1));a=Object.values(builder.cellData).filter(function(a){return!!a}).map(function(a){return[getCellName(a.x,a.y),"_RD"+a.hash+"RD_"]}).reduceRight(function(a,c){return a.replace(new RegExp(c[1],"gim"),c[0])},a);return a.includes("_RD")&&a.includes("RD_")?"":a},_findChangeCellNames:function(a){function b(a,b){a=a.match(/[A-Z]+\d+/g);Array.isArray(a)&&a.forEach(function(a){var c=a.replace(/[0-9]/g,"");colNames.includes(c)&&!b.includes(a)&&b.push(a)})}a=a||"";"="===a.substr(0,
1)&&(a=a.substr(1));var c=[],d=[];if(a.includes('"')||a.includes("'")){var e="";a=a.split("");for(var f="",g=0,k=a.length;g<k;g++){var l=a[g];e+=l;f?l===f&&(0<d.length&&/^(SUMIF(S)?|MAXIFS|MINIFS|COUNTIF(S)?)$/i.test(d[d.length-1])&&b(e,c),e=f=""):'"'===l||"'"===l?(f=l,b(e,c),e=""):"("===l?(l=e.match(/[a-zA-Z]+(?=\()/g),Array.isArray(l)&&0<l.length?d.push(l[l.length-1]):d.push("")):")"===l&&0<d.length&&d.pop()}e.length&&b(e,c)}else b(a,c);return c},_findChangeCellNamesInfo:function(a){function b(a,
b,c){var d=!c;a=a.match(/[A-Z]+\d+/g);Array.isArray(a)&&a.forEach(function(a){var c=a.replace(/[0-9]/g,"");colNames.includes(c)&&!b.includes(a)&&b.push({cellName:a,shouldCheckExists:d})})}a=a||"";"="===a.substr(0,1)&&(a=a.substr(1));var c=[],d=[];if(a.includes('"')||a.includes("'")){var e="";a=a.split("");for(var f="",g=0,k=a.length;g<k;g++){var l=a[g];e+=l;f?l===f&&(0<d.length&&/^(SUMIF(S)?|MAXIFS|MINIFS|COUNTIF(S)?)$/i.test(d[d.length-1])&&b(e,c,!0),e=f=""):'"'===l||"'"===l?(f=l,b(e,c),e=""):"("===
l?(l=e.match(/[a-zA-Z]+(?=\()/g),Array.isArray(l)&&0<l.length?d.push(l[l.length-1]):d.push("")):")"===l&&0<d.length&&d.pop()}e.length&&b(e,c)}else b(a,c);return c},_basicCalHasDifferentDateFormatCells:function(a,b){a=a||"";if(""===a)return!1;"="===a.substr(0,1)&&(a=a.substr(1));a=a.matchAll(/([A-Z]+\d+)[+-\\*/%]([A-Z]+\d+)/g);var c,d=!1;for(c=a.next();!c.done;){var e=c.value;c=e[1];e=e[2];if(Array.isArray(b[c])&&Array.isArray(b[e])){var f=builder.cellData[b[c].join(",")];var g=builder.cellData[b[e].join(",")]}if(f instanceof
BuilderObject&&g instanceof BuilderObject&&f.hasAttribute("fmt_d")&&g.hasAttribute("fmt_d")&&ifTimeOnly(f.attr.fmt_d)!==ifTimeOnly(g.attr.fmt_d)){d=!0;break}c=a.next()}return d},add:function(a,b,c){for(var d=this._findChangeCellNames(c),e=0;e<d.length;e++)this._add(d[e],a,b,c)},_add:function(a,b,c,d){var e=this.listenMapping[a];e||(e=[],this.listenMapping[a]=e);a=e.find(function(a){return a.affectedCellName===b});a||(a=new FormulaListener(b,d),e.push(a));d=!biffdata.ifSubtableDataBiff(c.biff);a.listeningIPs[d?
0:c.biff.y]=c},remove:function(a,b,c){c=this._findChangeCellNames(c);for(var d=0;d<c.length;d++)this._remove(c[d],a,b)},_remove:function(a,b,c){var d=this.listenMapping[a];d||(d=[],this.listenMapping[a]=d);if(a=d.find(function(a){return a.affectedCellName===b}))d=!biffdata.ifSubtableDataBiff(c.biff),delete a.listeningIPs[d?0:c.biff.y]},applyFormulaTextChange:function(a,b){if(a.includes('"')||a.includes("'")){var c="",d="";a=a.split("");for(var e="",f=0,g=a.length;f<g;f++){var k=a[f];d+=k;if(e)k===
e&&(e="",c+=d,d="");else if('"'===k||"'"===k)e=k,c+=b(d),d=""}d.length&&(c+=b(d));return c}return b(a)}};function FormulaListener(a,b){this.affectedCellName=a;this.formula=b;this.listeningIPs={}}var formulaMode={STRING:1,DATE:2,NUMBER:3},fieldType={STRING:"S",DATE:"D",NUMBER:"N"};function resolveFormula(a,b,c){var d;c||(c=formulaMode.NUMBER);return(d=_resolveFormula_vmode(a,b,c))||0===d&&"0"!==d||c!==formulaMode.STRING?d:_resolveFormula_vmode(a,b,formulaMode.STRING)}
function _get_formula_variables(a,b,c){var d={},e=biffdata.formulaMap,f=a,g=!1,k=!1,l=!1,m=!1,n=!1;b=parseInt(b);try{g=/IF([S])*\(.*\)/.test(c),k=/MIN\(.*\)/.test(c),l=/MAX\(.*\)/.test(c),m=/AND\(.*\)/.test(c),n=/OR\(.*\)/.test(c)}catch(K){}c={};for(var q in e){if(q){var r=void 0,p="",t=NaN,v=NaN,u="",x="",E="",D="",A=0,w=void 0,F=!1;a=f;var C=Object.values(e[q]),z=e[q][b]||C.filter(function(a){return!!a})[0];z&&((g||m||n)&&"N"===z.type&&(a=formulaMode.NUMBER),z.isSubtableObj?(F=!0,r=[],a===formulaMode.STRING&&
("N"===z.type&&z.strValue===z.numValue+""?a=formulaMode.NUMBER:"S"===z.type&&!b&&C.some(function(a){return a&&"N"===a.type&&a.strValue===a.numValue+""})&&(a=formulaMode.NUMBER))):r=a===formulaMode.STRING?"":0,w=z.fieldType);c.$jscomp$loop$prop$isMultiImagesFiles$680=!1;for(var J in e[q])if(C=e[q][J]){var L=void 0;z="";var B=parseInt(J);c.$jscomp$loop$prop$isMultiImagesFiles$680=C.isMultiImagesFiles;if(a===formulaMode.DATE)if(z=C.strValue,L=C.dateValue,isNaN(L))continue;else L=C.numValue;else if(a===
formulaMode.STRING)L=z=C.strValue;else if(z=C.strValue,L=C.numValue,"D"===C.type)isNaN(L)&&0===A&&(Array.isArray(r)&&b!==B||(r=NaN));else if((l||k)&&"S"===C.type&&""===C.strValue)L="";else if(!isNumeric(L)||biffdata.keyField&&C.isSubtableObj&&C.isEmptyRow)continue;if(!b||!C.isSubtableObj||b===B){var y=isNumeric(L);y&&!Array.isArray(r)&&isNaN(r)&&(r=0);Array.isArray(r)?!C.isSubtableObj||biffdata.keyField&&C.isEmptyRow||(L="N"===C.type||/^\d+(\.\d+)?%$/.test(C.strValue)?C.numValue:"D"===C.type?C.dateValue||
(b===B?C.numValue:""):C.strValue,r.push({y:B,value:L,raw:z,subtableRowNum:C.subtableRowNum}),y=isNumeric(L)):r+=L;p+=z;y&&(isNaN(v)||L<v)&&(v=L);y&&(isNaN(t)||L>t)&&(t=L);C.isSubtableObj?C.isEmptyRow||A++:(L||0===L&&""!==z)&&A++}}F&&(F=C=void 0,C=Object.values(e[q]).filter(function(a){return a&&!a.isEmptyRow}),1===C.length?u=E=x=D=a===formulaMode.NUMBER&&isNumeric(C[0].strValue)?C[0].numValue:C[0].strValue:1<C.length&&(F=C.filter(function(a){return isNumeric(a.parentNodeId)&&0<=a.parentNodeId}),C=
C.filter(function(a){return isNumeric(a.parentNodeId)&&0>a.parentNodeId}),F.sort(function(a,b){return a.parentNodeId-b.parentNodeId}),C=F.concat(C),F=C.filter(function(a){return a&&""!==a.strValue}),0<C.length&&(u=C[0],x=C[C.length-1],u=a===formulaMode.NUMBER&&u.fieldType===fieldType.NUMBER?u.numValue:u.strValue,x=a===formulaMode.NUMBER&&x.fieldType===fieldType.NUMBER?x.numValue:x.strValue),0<F.length&&(E=F[0],D=F[F.length-1],E=a===formulaMode.NUMBER&&E.fieldType===fieldType.NUMBER?E.numValue:E.strValue,
D=a===formulaMode.NUMBER&&D.fieldType===fieldType.NUMBER?D.numValue:D.strValue)));d[q]={KEY:q,SUM:r,COUNT:A,MIN:v,MAX:t,FIRST:u,LAST:x,FIRSTA:E,LASTA:D,RAW:p,FMODE:a,FTYPE:w,toString:function(c){return function(){if(!Array.isArray(this.SUM))return this.SUM;if(this.FMODE===formulaMode.STRING&&1>=this.SUM.length)return this.RAW;var d="",e=this.SUM,f=b&&1===this.SUM.length;this.FMODE!==formulaMode.STRING&&(d=0,e=this.SUM.filter(function(b){return"string"!==typeof b.value&&(f&&a===formulaMode.DATE||!isNaN(b.value))}));
return e.reduce(function(a,b){return c.$jscomp$loop$prop$isMultiImagesFiles$680&&""!==a?a+"|"+b.value:a+b.value},d)}}(c)}}c={$jscomp$loop$prop$isMultiImagesFiles$680:c.$jscomp$loop$prop$isMultiImagesFiles$680}}if(biffdata.globalConst)for(var O in biffdata.globalConst)d[O]=biffdata.globalConst[O];return d}function executeFormula(a){return Function('"use strict";return ('+getStandardFormula(a)+")")()}
function _resolveFormula_vmode(a,b,c){var d=formulaBuilder.getFormulaVariables(c,b,a);b=/AV([ERA]*)G([E]*)\(.*\)/.test(a);var e=/OR\(.*\)/.test(a),f=/AND\(.*\)/.test(a),g=/HOUR\(.*\)/.test(a),k=/MINUTE\(.*\)/.test(a),l=/SECOND\(.*\)/.test(a),m=/ISBLANK\(.*\)/.test(a),n=/APPROVAL.STEP\(.*\).ISMULTI\(\)/.test(a);for(q in d)this[q]=d[q];var q="";try{q=executeFormula(a)}catch(r){if(r instanceof SyntaxError)return NO_CHANGE_SIGNAL}if(c===formulaMode.STRING&&!(e||f||m||n||g||k||l))return q?q:"";if(0===
q||isNaN(q)&&b)q="0";if(!isNumeric(q))return q;if(void 0===q||""===q)return null;c!==formulaMode.DATE&&(q+"").includes(".")&&(q=Math.round(1E7*q)/1E7);return q}
function correctFormulaDateResult(a,b){b=getStandardFormat(b);if("HH:mm:ss"===b){var c=new Date;c.setHours(0,0,0,0);c=c.getTime()/MINUTE_MILLI;for(var d=c+7200,e=c-7200,f=a;a>d;)a-=c;for(;a<e;)a+=c;a>d||a<e?(a=parseInt((f*DAY_MILLI).toFixed(0)),a=formatDate(new Date(a),b)):(a=parseInt((a*MINUTE_MILLI).toFixed(0)),a=formatDate(new Date(a),b))}else a=parseInt((a*DAY_MILLI).toFixed(0)),a=formatDate(new Date(a),b);return a}
function FormulaMapObject(a){var b=a.value;a.hasAttribute("ag")&&(a.updateDisplayValue||""===a.updateDisplayValue)&&(b=a.updateDisplayValue);b||(b="");this.y=a.y;this.isSubtableObj=biffdata.keyField&&void 0!==a.isSubtableObj?a.isSubtableObj:biffdata.ifSubtableDataBiff(a);this.strValue=b+"";this.parentNodeId=parseInt(a.parentNodeId);this.isMultiImagesFiles=a.hasAttribute("multipleImages")||a.hasAttribute("multipleFiles");if(canSaveData())if(void 0===a.isEmptyRow){var c=parseInt(a.nodeId);this.isEmptyRow=
0>c||!c&&0!==c}else this.isEmptyRow=a.isEmptyRow;else c=parseInt(a.nodeId),this.isEmptyRow=0>c||!c&&0!==c;this.isSubtableObj&&(this.subtableRowNum=this.y-biffdata.findHeaderFromBiff(a).y);a.hasAttribute("fmt_d")?(this.dateValue=parseDateLong(b,a.attr.fmt_d),this.dateValue||(this.dateValue=parseDateLong(b,"yyyy/MM/dd")),this.dateValue||(this.dateValue=parseDateLong(b,"yyyy/MM/dd HH:mm:ss")),this.dateValue||(this.dateValue=parseDateLong(b,"HH:mm:ss")),this.numValue=this.dateValue?this.dateValue:NaN,
this.type="D"):!isNumeric(b)||a.hasAttribute("phone")||a.hasAttribute("ag")||14<this.strValue.length&&!this.strValue.includes(".")?(this.numValue=this.dateValue=0,this.type="S",/^\d+(\.\d+)?%$/.test(b)&&(this.numValue=parseFloat(b)/100)):(this.dateValue=0,this.numValue=parseFloat(b),this.type="N");a.hasAttribute("fmt_d")?this.fieldType=fieldType.DATE:a.hasAttribute("fmt_n")?this.fieldType=fieldType.NUMBER:this.fieldType=fieldType.STRING}
function parseDateLong(a,b){if(!a)return null;if(b){var c=getDateFromFormat(a,getStandardFormat(b));isNaN(c)&&(c=getDateFromFormat(a,b))}else c=smartParseDate(a,b).getTime();return 0===c?isNumeric(a)?parseInt(a):null:ifTimeOnly(b)?c/MINUTE_MILLI:c/DAY_MILLI}function ifTimeOnly(a){return a?!a.includes("y")&&!a.includes("M")&&!a.includes("d")&&!a.includes("E"):!1}
function getPositionFromCellName(a){var b=a.replace(/[0-9]/g,"");a=a.replace(/[A-Z]/g,"");var c=colNames.indexOf(b)+","+a;return(b=Object.entries(builder.absolutePositions).find(function(a){return a[1]===c}))?b[0].split(",").map(Number):[-1,-1]}
function getCellNameFromDataCache(a){if(!a||a.IPType===FREE)return"";var b=a.domainId;return biffdata.domainIdCellMapping.hasOwnProperty(b)?biffdata.isDomainIdUnique(b)?biffdata.domainIdCellMapping[b]:biffdata.findHeaderFromBiff(a)?biffdata.domainIdCellMapping[b][biffdata.findHeaderFromBiff(a).unique]:"":""}
function getStandardFormula(a){return formulaBuilder.applyFormulaTextChange(a.toString(),function(a){return a.replace(/([^=><:!+\-*/%])=(?!=)/ig,"$1==").replace(/^(?![.])([a-z_{1}][a-z0-9_]+)(?=\()/g,TOUPPERCASE).replace(/([A-Z]{0,2}\d+(?:\.\d+)?)\^([A-Z]{0,2}\d+(?:\.\d+)?)/g,"Math.pow($1, $2)").replace(/([^<:])<>(?!>)/g,"$1!=")})}function getPrecisedFloat(a){return parseFloat(parseFloat(a).toFixed(7))}
function getDateFromFormulaObject(a){a=a.toString();return isNumeric(a)?new Date(parseInt((a*DAY_MILLI).toFixed(0))):new Date(a)}
function getDateTimeFromFormulaObject(a){var b=a.toString();a=a.RAW;if(isNumeric(b)&&a)return 18<a.length?new Date(parseInt((b*DAY_MILLI).toFixed(0))):(new Date(a)).isValid()?new Date(parseInt((b*DAY_MILLI).toFixed(0))):new Date(parseInt((b*MINUTE_MILLI).toFixed(0)));a=new Date(b);a.isValid()||(a=new Date(getDateFromFormat(b,"HH:mm:ss")));a.isValid()||(a=new Date(getDateFromFormat(b,"HH:mm")));return a}
function retrieveFormulaFromDesc(a){return(a=/\[formula\][\s]*(.+)\[\/formula\]/gim.exec(a))&&1<a.length?a[1]:null}
function FormulaRel(){function a(a){this._id=a;this.previous=[];this.next=[]}function b(a,c){c=c||f;if(c._id===a)return c;c=c.next;var d;if(!c.length)return null;for(var e=c.length;e--&&!(d=b(a,c[e])););return d}function c(a,b){if(a===b)return!0;b||(b=a);b=b.previous;var d;if(0===b.length)return!1;for(var e=b.length;e--&&!(d=c(a,b[e])););return d}function d(){f=new a("");f.isInited=!1}var e={},f;this.getFormulaCellMap=function(){return e};this.addFCellRec=function(a,b){e[a]=b.toUpperCase()};this.delFCellRec=
function(a){delete e[a]};this.clearFCellRec=function(){e={}};this.getOrder=function(){var a=0,b={},c={},d={},f;for(f in e)if(e.hasOwnProperty(f)){var q=f.split(",");q=getCellName(parseInt(q[0]),parseInt(q[1]));b[q]=formulaBuilder._findChangeCellNames(e[f]);c[q]=0;d[q]=!1;a++}for(var r in c)if(c.hasOwnProperty(r))for(f=b[r].length-1;0<=f;f--)b.hasOwnProperty(b[r][f])&&c[r]++;r=Array(a);for(f=0;f<a;f++)for(var p in b)if(b.hasOwnProperty(p)&&!d[p]&&0===c[p]){r[f]=p;for(var t in b)b.hasOwnProperty(t)&&
b[t].includes(p)&&c[t]--;d[p]=!0;break}var v={};r.forEach(function(a){var b=getPositionFromCellName(a);v[a]=builder.cellData[b[0]+","+b[1]].domainId});return v};this.check=function(g,k,l){d();var m={};l=l||$("formula__hint");for(var n in builder.cellData)if(n){var q=n.split(",");var r=parseInt(q[0]);q=parseInt(q[1]);m[getCellName(r,q)]=[r,q]}for(var p in e){q=p.split(",");r=parseInt(q[0]);q=parseInt(q[1]);var t=e[p];if(builder.cellData[p]){n=getCellName(r,q);var v=builder.cellData[p].value,u=formulaBuilder._findChangeCellNames(t),
x;a:{var E=n;if((x=u)&&x.length){var D=b(E);D||(D=new a(E),D.previous.push(f),f.next.push(D),f.isInited=!0);for(E=x.length;E--;){var A=b(x[E]);A||(A=new a(x[E]));A.previous.includes(f)&&(A.previous.pop(),f.next.splice(f.next.indexOf(A),1));A.previous.push(D);if(c(A)||D===A){A.previous.pop();x=!1;break a}else D.next.includes(A)||D.next.push(A)}}else if(D=b(E)){E=D.next;A=D.previous;for(x=E.length;x--;)E[x].previous.splice(E[x].previous.indexOf(D),1),0===E[x].previous.length&&E[x].previous.push(f);
for(x=A.length;x--;)A[x].next.splice(A[x].next.indexOf(D),1)}x=!0}E=(D=builder.ifAdjacent(r,q))?builder.findSubtableHeadField(r,q):null;t=formulaBuilder._basicCalHasDifferentDateFormatCells(t,m);for(A=u.length;A--;){var w=m[u[A]];if(w){var F=w[0];w=w[1];if(D&&builder.ifAdjacent(F,w)){if(q===w&&builder.findSubtableHeadField(F,w)===E)continue;g=lm.formulaMultiSubErr.replace("{0}","("+n+')"'+v+'"').replace("{1}","("+getCellName(F,w)+')"'+builder.cellData[F+","+w].value+'"');l&&"none"!==l.style.display?
l.textContent=g:floatWinWarning(g);d();return!1}F=builder.cellData[F+","+w];if("M"===F.IPType&&g===r&&k===q)return l&&"none"!==l.style.display?l.textContent=lm.formulaRefToMultiSelectorErr.replace("{0}","("+u[A]+')"'+F.value+'"'):floatWinWarning(message),d(),!0}}if(!x)return l&&"none"!==l.style.display&&(l.textContent=lm.formulaCircularRef.replace("{0}","("+n+')"'+v+'"')),d(),!1;if(t&&g===r&&k===q){g=lm.formulaDateFormatConsistErr.replace("{0}","("+n+')"'+v+'"');l&&"none"!==l.style.display?l.textContent=
g:floatWinWarning(g);d();break}}}return!0}}function toRaw(a){return a.RAW?a.RAW:a+""}function isInitLoadingFormula(a){a=a.toUpperCase();return/NOW(TZ)?\(\)/.test(a)||/TODAY(TZ)?\(\)/.test(a)||a.includes("CHAR(")}function APPROVAL(){}APPROVAL.COUNT=function(){return wf.steps.length};APPROVAL.STATUS=function(){return wf.status};APPROVAL.RESP=function(){return wf.response};APPROVAL.SUBMITDATE=function(a){return LocalDateTimeToLong(wf.submitDate,a)/DAY_MILLI};
APPROVAL.SUBMITTER=function(){return wf.submitter||""};APPROVAL.SUBMITTERNAME=function(){return wf.submitterName||""};APPROVAL.FINISHDATE=function(a){return LocalDateTimeToLong(wf.finishDate,a)/DAY_MILLI};APPROVAL._middlewares=[function(){if(biffdata&&biffdata.ifListingPage())throw Error("Approval Formula should be executed only in form page!");}];var approvalStep=new APPROVALSTEP;APPROVAL.STEP=function(a){try{var b=wf.getWorkflowStep(fallbackStepIndex(a));return approvalStep._setWS(b)}catch(c){return approvalStep._setWS(null)}};
function APPROVALSTEP(a){this.ws=a;this._middlewares=[function(){var a=this.ws;if(!(a&&a instanceof WorkflowStep))throw new ApprovalError("notIncludeThisStep");}.bind(this)];this._setWS=function(a){this.ws=a;return this};this.NAME=function(){return this.ws.stepName};this.STATUS=function(){return this.ws.status};this.RESP=function(a){var b=this.ws;if(this.ISMULTI()&&a){a=toRaw(a);if(b.emails.includes(a))return b.emailsSigningState[a];if(b.userNames.includes(a))return b.userNamesSigningState[a]}return this.ws.response};
this.ISMULTI=function(){return this.ws.multiApprovers};this.THRESHOLD=function(){return this.ws.threshold};this.userNames=function(){return this.ws.userNames};this.USERS=function(){return this.userNames().join("|")};this.ACTIONDATE=function(a,b){var c=this.ws,d;this.ISMULTI()?a&&c.signingDateTimes?(a=toRaw(a),(d=c.signingDateTimes[a])||(d=c.signingDateTimes[c.emails[c.userNames.indexOf(a)]]),d=LocalDateTimeToLong(d,b)):d=LocalDateTimeToLong(c.actionDate,b):d=LocalDateTimeToLong(c.actionDate,b);return d/
DAY_MILLI};this.UNSIGNEDUSERS=function(){var a=this.ws,b=this.userNames();return this.ISMULTI()?Object.entries(a.userNamesSigningState).filter(function(a){return"unSigned"===a[1]}).map(function(a){return a[0]}).join("|"):"N"===this.RESP()?b[0]:""};this.SIGNEDUSERS=function(){var a=this.ws,b=this.userNames();return this.ISMULTI()?Object.entries(a.userNamesSigningState).filter(function(a){return"signed"===a[1]||"signed_by_deputy"===a[1]}).map(function(a){return a[0]}).join("|"):(a=this.RESP(),"A"===
a||"A_D"===a?b[0]:"")};this.SIGNEDCOUNT=function(){return this.SIGNEDUSERS().splitIgnoreEmpty("|").length};this.SIG=function(a){var b=this.ws,c;if(this.ISMULTI()){if(0===arguments.length&&mode!==BUILDER)throw new ApprovalError("isMultiApprovers","email");(c=b.sigs[toRaw(a)])||(c=b.sigs[b.emails[b.userNames.indexOf(toRaw(a))]])}else c=Object.values(b.sigs)[0];return c||""};this.SIGIMG=function(a,b,e){var c=[];a&&c.push(a);return(a=this.SIG.apply(this,c))?isNumeric(b)&&0<b&&isNumeric(e)&&0<e?"[img="+
b+"X"+e+"]"+a+"[/img]":"[img=300X150]"+a+"[/img]":""};this.COMMENT=function(a){var b=this.ws,c;if(this.ISMULTI()){if(0===arguments.length&&mode!==BUILDER)throw new ApprovalError("isMultiApprovers","email");(c=b.comments[toRaw(a)])||(c=b.comments[b.emails[b.userNames.indexOf(toRaw(a))]])}else c=Object.values(b.comments)[0];return c||""};this.COMMENTDATE=function(a,b){var c=this.ws,d;if(this.ISMULTI()){if(0===arguments.length&&mode!==BUILDER)throw new ApprovalError("isMultiApprovers","email");if(a&&
c.signingDateTimes){a=toRaw(a);if(!this.COMMENT(a))return"";(d=c.signingDateTimes[a])||(d=c.signingDateTimes[c.emails[c.userNames.indexOf(a)]]);d=LocalDateTimeToLong(d,b)}}else this.COMMENT()&&(d=LocalDateTimeToLong(c.actionDate,b));return d/DAY_MILLI};for(var b in this)"function"!==typeof this[b]||b.startsWith("_")||(this[b]=addMiddlewareForApprovalFormula(this[b],this,this._middlewares))}
function ApprovalError(){this.name="ApprovalError";this.message=getBundleString(arguments[0],Array.from(arguments).slice(1))}ApprovalError.prototype=Object.create(Error.prototype);ApprovalError.prototype.constructor=ApprovalError;function isApprovalFormula(a){a=a.toUpperCase();var b=Object.keys(APPROVAL).join("|");return(new RegExp("APPROVAL\\.("+b+")\\(?.*\\)?")).test(a)}
function fallbackStepIndex(a){a=parseInt(a);return{stepIndex:(isNumeric(a)?0>a?APPROVAL.CURRENTSTEPINDEX+a:a:APPROVAL.CURRENTSTEPINDEX)-1,stepIndexIsZero:0===a}}function bindV2(a,b,c){return function(){try{for(var d=0;d<c.length;d++)c[d]();var e=Array(arguments.length);for(d=0;d<e.length;d++)e[d]=arguments[d];return a.apply(b,e)}catch(f){return""}}}function addMiddlewareForApprovalFormula(a,b,c){return bindV2(a,b,c)}
(function(){for(var a in APPROVAL)"function"!==typeof APPROVAL[a]||a.startsWith("_")||(APPROVAL[a]=addMiddlewareForApprovalFormula(APPROVAL[a],null,APPROVAL._middlewares))})();function YEAR(a){return getDateFromFormulaObject(a).getFullYear()}function MONTH(a){return getDateFromFormulaObject(a).getMonth()+1}function DAY(a){return getDateFromFormulaObject(a).getDate()}function WEEKDAY(a){return getDateFromFormulaObject(a).getDay()+1}
function DATE(a,b,c){b=parseInt(b)-1;return(new Date(a,b,c)).getTime()/DAY_MILLI}function HOUR(a){if("number"==typeof a){if(0<=a&&1>=a)return 24*a%24;throw new SyntaxError("If the argument is a nubmer, you' should enter 0 ~ 1.");}return getDateTimeFromFormulaObject(a).getHours()}function MINUTE(a){if("number"==typeof a){if(0<=a&&1>=a)return 60*a%60;throw new SyntaxError("If the argument is a nubmer, you' should enter 0 ~ 1.");}return getDateTimeFromFormulaObject(a).getMinutes()}
function SECOND(a){if("number"==typeof a){if(0<=a&&1>=a)return 60*a%60;throw new SyntaxError("If the argument is a nubmer, you' should enter 0 ~ 1.");}return getDateTimeFromFormulaObject(a).getSeconds()}function TODAY(){var a=new Date;a.setHours(0,0,0,0);return a.getTime()/DAY_MILLI}function NOW(){return(new Date).getTime()/DAY_MILLI}function TODAYTZ(){return TODAY.apply(this,arguments)}function NOWTZ(){return NOW.apply(this,arguments)}
function SUM(){for(var a=0,b=0;b<arguments.length;b++){var c=parseFloat(arguments[b].toString());isNaN(c)||(a+=c)}return a}function AVERAGE(){for(var a=0,b=0,c=0;c<arguments.length;c++){var d=arguments[c],e=parseFloat(d.toString());!isNaN(e)&&(a+=e,Array.isArray(d.SUM)||""!==d.RAW)&&(b+=parseFloat(COUNTA(d)))}return a/b}function AVG(){return AVERAGE.apply(this,arguments)}function MODE(){return MODE.SNGL.apply(this,arguments)}
MODE.SNGL=function(){var a=MODE.MULT.apply(this,arguments);return a.length?a[0]:NaN};
MODE.MULT=function(){var a=[],b;for(b=0;b<arguments.length;b++){var c=arguments[b];Array.isArray(c)?a=a.concat(c):c.SUM&&Array.isArray(c.SUM)?a=a.concat(c.SUM.filter(function(a){return""!==a.value}).map(function(a){return a.value})):a.push(c+"")}b=a.reduce(function(a,b){a[b]=a[b]?a[b]+1:1;return a},{});a=[];for(var d in b)a.push({value:d,count:b[d]});if(!a.length)return[];a.sort(function(a,b){return b.count-a.count});d=[];c=a[0].count;for(b=0;b<a.length&&a[b].count===c;b++)d.push(a[b].value);return d};
function COUNT(){for(var a=0,b=0;b<arguments.length;b++)a+=parseFloat(arguments[b].COUNT);return a}function LEFT(a,b){if(!a||0>=b)return"";b=b||1;a=a.RAW||a+"";return newlineTranslate(a).substring(0,b)}function RIGHT(a,b){if(!a||0>=b)return"";b=b||1;a=a.RAW||a+"";a=newlineTranslate(a);return a.substring(a.length-b,a.length)}function MID(a,b,c){if(!a||!a.toString()&&0!==a.toString()||0>b||0>c)return"";a=a.RAW||a+"";return newlineTranslate(a).substr(b,c)}
function LEN(a){if(!a)return 0;a=a.RAW||a+"";return newlineTranslate(a).length}function LENB(a){return a?newlineTranslate(a.RAW||a+"").replace(/[^\x00-\xff]/g,"**").length:0}function MIN(){for(var a=[],b,c=0;c<arguments.length;c++)b=parseFloat(void 0===arguments[c].MIN?arguments[c]:arguments[c].MIN),isNaN(b)||a.push(b);return a.length?Math.min.apply(null,a):NaN}
function MAX(){for(var a=[],b,c=0;c<arguments.length;c++)b=parseFloat(void 0===arguments[c].MAX?arguments[c]:arguments[c].MAX),isNaN(b)||a.push(b);return a.length?Math.max.apply(null,a):NaN}function FIRST(a){return a.FIRST}function FIRSTA(a){return a.FIRSTA}function LAST(a){return a.LAST}function LASTA(a){return a.LASTA}function SUBTABLEROW(a,b){b=parseInt(b);return Array.isArray(a.SUM)&&(a=a.SUM.find(function(a){return a.subtableRowNum===b}))?a.value:""}
function COUNTA(a){return Array.isArray(a.SUM)?a.SUM.filter(function(a){return""!==a.raw}).length:1}function MOD(a,b){return a%b}function GCD(){var a=arguments.length;try{if(0===a)return NaN;if(1===a)return arguments[0];if(2===a)return 0===arguments[1]?arguments[0]:GCD(arguments[1],arguments[0]%arguments[1]);if(2<a){for(var b=arguments[0],c=1;c<a;c++)b=GCD(b,arguments[c]);return b}}catch(d){return NaN}}
function LCM(){var a=arguments.length;try{if(0===a)return NaN;if(1===a)return arguments[0];for(var b=arguments[0],c=1;c<a;c++){var d=GCD(b,arguments[c]);b=b/d*arguments[c]}return b}catch(e){return NaN}}function IF(a,b,c){var d=arguments.length;return 2>d?NO_CHANGE_SIGNAL:3>d?UPDATEIF(a,b):a?b:c}function UPDATEIF(a,b){return IF(a,b,NO_CHANGE_SIGNAL)}
function IFS(){var a=arguments.length;if(0===a||0!==a%2)throw new SyntaxError("You've entered too few arguments for this function");for(var b=0;b<a;b+=2)if(arguments[b])return arguments[b+1];return NO_CHANGE_SIGNAL}
function LARGE(a,b,c){if(!a||!Array.isArray(a.SUM))return a;if(!Number.isInteger(b)||"undefined"===typeof a.SUM[b-1])return a.RAW;var d=a.SUM.map(function(a,b){return{value:a.value,i:b}});d.sort(function(a,b){return""===a?1:""===b?-1:b.value-a.value});d=d.map(function(a){return a.i});return c&&Array.isArray(c.SUM)?c.SUM[d[b-1]].raw:a.SUM[d[b-1]].raw}
function LOOKUP(a,b,c){if(""===a)return"";for(var d=0;d<b.length;d++)if(b[d]==a)return c[d];for(d=0;d<b.length;d++)if(b[d]>a)return 0===d?NaN:c[0<d?d-1:0];return c[c.length-1]}
function VLOOKUP(a,b,c,d,e){if(3>arguments.length)throw new SyntaxError("Required arguments: value, queryField, returnField");a=toRaw(a);void 0===d&&(d=!0);d&&(a=a.trim());e=!!e;var f=b.FTYPE===fieldType.STRING,g=b.FTYPE===fieldType.DATE,k=b.FTYPE===fieldType.NUMBER,l=c.FMODE===formulaMode.NUMBER,m=b.SUM.filter(function(b){return f||g&&(isNaN(a)||1E4>a)?d?b.raw.includes(a):b.raw===a:k&&d?b.raw.includes(a):b.value===parseFloat(a)}).map(function(a){var b=c.SUM.find(function(b){return a.y===b.y});return l?
b.value:b.raw});return e?m:0===m.length?"":m[0]}function TOUPPERCASE(a){return a.toString().toUpperCase()}function UPPER(){return TOUPPERCASE.apply(this,arguments)}function TOLOWERCASE(a){return a.toString().toLowerCase()}function LOWER(){return TOLOWERCASE.apply(this,arguments)}function PROPER(a){return(a+"").replace(/[A-Za-z_]\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}function CHAR(a){return Number.isInteger(a)?String.fromCharCode(a):a}
function ABS(a){return Math.abs(a)}function CEILING(a,b){if(0===b)return 0;void 0===b&&(b=1);a=getPrecisedFloat(a);var c=-Math.floor(Math.log(b)/Math.log(10));return 0<=a?ROUND(Math.ceil(a/b)*b,c):-ROUND(Math.floor(Math.abs(a)/b)*b,c)}function FLOOR(a,b){b=void 0===b?1:Math.abs(b);if(0===b)return 0;a=getPrecisedFloat(a);var c=-Math.floor(Math.log(b)/Math.log(10));return 0<=a?ROUND(Math.floor(a/b)*b,c):-ROUND(Math.ceil(Math.abs(a)/b),c)}function PI(){return Math.PI}
function POWER(a,b){return Math.pow(a,b)}function RAND(){return Math.random()}function ROUND(a,b){b=b||0;a="number"==typeof a.toString()?a.toString():parseFloat(a);if(isNaN(a)||isNaN(b))return NaN;var c=Math.round(getPrecisedFloat(a*Math.pow(10,b)))/Math.pow(10,b);/^-[0-9]+(\.5)$/.test(a)&&0===b&&(c=parseFloat(a.toFixed()));return c}function ROUNDDOWN(a,b){return isNaN(a)||isNaN(b)?NaN:(0<a?1:-1)*Math.floor(getPrecisedFloat(Math.abs(a)*Math.pow(10,b)))/Math.pow(10,b)}
function ROUNDUP(a,b){return isNaN(a)||isNaN(b)?NaN:(0<a?1:-1)*Math.ceil(getPrecisedFloat(Math.abs(a)*Math.pow(10,b)))/Math.pow(10,b)}function MROUND(a,b){return isNaN(a)||isNaN(b)||0>a*b?NaN:Math.round(getPrecisedFloat(a/b))*b}function SQRT(a){return Math.sqrt(a)}function REPT(a,b){return a?(a+"").repeat(b):""}function ISOWEEKNUM(a){a=getDateFromFormulaObject(a);a.setHours(0,0,0);a.setDate(a.getDate()+4-(a.getDay()||7));var b=new Date(a.getFullYear(),0,1);return Math.ceil(((a-b)/864E5+1)/7)}
function WEEKNUM(a,b){a=getDateFromFormulaObject(a);void 0===b&&(b=1);if(21===b)return this.ISOWEEKNUM(a);var c=0;11===a.getMonth()&&25<a.getDate()&&(a.setDate(a.getDate()-7),c+=1);b=[void 0,0,1,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,1,2,3,4,5,6,0][b];var d=new Date(a.getFullYear(),0,1);d.getDay()<b&&a.getDay()>=b&&(c+=1);d-=864E5*Math.abs(d.getDay()-b);return Math.floor((a-d)/864E5/7+1)+c}
function EDATE(a,b){a=getDateFromFormulaObject(a);var c=a.getDate();a.setDate(1);a.setMonth(a.getMonth()+b);b=new Date(a.getFullYear(),a.getMonth()+1,0);b.getDate()<c?a.setDate(b.getDate()):a.setDate(c);return a.getTime()/DAY_MILLI}function EOMONTH(a,b){a=getDateFromFormulaObject(a);a.setDate(1);a.setMonth(a.getMonth()+b);return(new Date(a.getFullYear(),a.getMonth()+1,0)).getTime()/DAY_MILLI}function NETWORKDAYS(a,b,c,d){return NETWORKDAYS.INTL(a,b,1,c,d)}
NETWORKDAYS.INTL=function(a,b,c,d,e){var f=getDateFromFormulaObject(a),g=getDateFromFormulaObject(b),k=[[],[6,0],[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],void 0,void 0,void 0,[0,0],[1,1],[2,2],[3,3],[4,4],[5,5],[6,6]];if(isNaN(f.getTime())||isNaN(g.getTime()))return 0;c=void 0===c?k[1]:k[c];if(!(c instanceof Array))return NaN;d||(d=[]);d=d.map(function(a){return new Date(a)});e||(e=[]);e=e.map(function(a){return new Date(a)});b=a=Math.floor(b-a+1);for(g=0;g<a;g++){k=f.getDay();var l=!1;if(k===c[0]||k===
c[1])l=!0,e.length&&(l=e.every(function(a){return a.getDate()!==f.getDate()||a.getMonth()!==f.getMonth()||a.getFullYear()!==f.getFullYear()}));(l=l||d.some(function(a){return a.getDate()===f.getDate()&&a.getMonth()===f.getMonth()&&a.getFullYear()===f.getFullYear()}))&&b--;f.setDate(f.getDate()+1)}return b};function WORKDAY(a,b,c,d){return WORKDAY.INTL(a,b,1,c,d)}
WORKDAY.INTL=function(a,b,c,d,e){var f=getDateFromFormulaObject(a),g=[[],[6,0],[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],void 0,void 0,void 0,[0,0],[1,1],[2,2],[3,3],[4,4],[5,5],[6,6]];if(isNaN(f.getTime()))return a;c=void 0===c?g[1]:g[c];if(!(c instanceof Array))return a;d||(d=[]);d=d.map(function(a){return new Date(a)});e||(e=[]);e=e.map(function(a){return new Date(a)});a=1;0>b&&(b*=-1,a=-1);for(g=0;g<b;){f.setDate(f.getDate()+a);var k=f.getDay(),l=!1;if(k===c[0]||k===c[1])l=!0,e.length&&(l=e.every(function(a){return a.getDate()!==
f.getDate()||a.getMonth()!==f.getMonth()||a.getFullYear()!==f.getFullYear()}));l||(d.some(function(a){return a.getDate()===f.getDate()&&a.getMonth()===f.getMonth()&&a.getFullYear()===f.getFullYear()})&&g--,g++)}return f.getTime()/DAY_MILLI};function AND(){for(var a=0;a<arguments.length;a++)if(!arguments[a])return!1;return!0}function OR(){for(var a=0;a<arguments.length;a++)if(arguments[a])return!0;return!1}
function MATCHSUBTABLE(){var a=arguments,b=a.length;if(3>b||0!==(b-1)%2)throw new SyntaxError("You've entered too few arguments for this function");return arguments[0].SUM.filter(function(c,d){c=!0;for(var e=1;e<b;e+=2){var f=a[e],g=a[e+1];if(!f||!Array.isArray(f.SUM))return!1;var k=!1;f=f.SUM[d];try{k=executeFormula(f.value+g)}catch(l){try{k=executeFormula("'"+f.raw+"'"+g)}catch(m){k=-1}}"boolean"!==typeof k&&(g=g.RAW?g.RAW:g,k=("string"===typeof g?f.raw:f.value)==g);if(!k){c=!1;break}}return c})}
function SUMIF(a,b,c){if(a&&(b||""===b)&&Array.isArray(a.SUM))return SUMIFS(c||a,a,b)}function SUMIFS(){var a=MATCHSUBTABLE.apply(this,arguments),b=arguments[0].FMODE===formulaMode.STRING,c=b?"":0;return a.filter(function(a){return!(!b&&(isNaN(a.value)||"string"===typeof a.value))}).reduce(function(a,b){return a+b.value},c)}function COUNTIF(a,b){return COUNTIFS(a,b)}
function COUNTIFS(){var a=arguments.length,b=arguments;if(2>a||0!==a%2)throw new SyntaxError("You've entered too few arguments for this function");return arguments[0].SUM.filter(function(c,d){c=!0;for(var e=0;e<a;e+=2){var f=b[e],g=b[e+1];if(!f||!g||!Array.isArray(f.SUM))return!1;var k=!1;f=f.SUM[d];try{k=executeFormula(f.value+g)}catch(l){try{k=executeFormula("'"+f.raw+"'"+g)}catch(m){k=-1}}"boolean"!==typeof k&&(g=g.RAW?g.RAW:g,k=("string"===typeof g?f.raw:f.value)==g);if(!k){c=!1;break}}return c}).length}
function MAXIFS(){var a=MATCHSUBTABLE.apply(this,arguments).filter(function(a){return isNumeric(a.value)}).map(function(a){return parseFloat(a.value)});return 0===a.length?NaN:Math.max.apply(Math,a)}function MINIFS(){var a=MATCHSUBTABLE.apply(this,arguments).filter(function(a){return isNumeric(a.value)}).map(function(a){return parseFloat(a.value)});return 0===a.length?NaN:Math.min.apply(Math,a)}
function FIND(a,b,c){c=void 0===c?0:c;if(!b)return NaN;a=a.RAW?a.RAW:a+"";return(b.RAW?b.RAW:b+"").replace(/\r/gm,"").indexOf(a,c-1)+1}function TEXT(a,b){if(!a||!b)return a;a=a.toString();b=b.toString();var c;(c=ragic_date_format(a,b))&&c!==b||(c=ragic_number_format(a,b));return c}
function UNIQUE(){for(var a=[],b=",",c=0;c<arguments.length;c++){var d=arguments[c];Array.isArray(d.SUM)?a=a.concat(d.SUM.map(function(a){return a.raw})):d.RAW?a.push(d.RAW):c===arguments.length-1&&"string"==typeof d&&-1===d.search(/\w/g)?b=d:a.push(d+"")}a=a.filter(function(a,b,c){return a.length&&c.indexOf(a)===b});a.toString=function(){return this.join(b)};return a}
function SUBSTITUTE(a,b,c,d){if(void 0!==d&&(!Number.isInteger(d)||0>=d))throw new SyntaxError("Instance_num should be a positive number");if(void 0===a||void 0===b||void 0===c)return a;a=a.toString();b=b.toString();c=c.toString();if(void 0===d)return a.replace(new RegExp(RegExp.quote(b),"g"),c);for(var e=0,f=0;0<a.indexOf(b,e);)if(e=a.indexOf(b,e+1),f++,f===d)return a.substring(0,e)+c+a.substring(e+b.length)}
function DATEVALUE(a,b){a=a||"";a=a.RAW?a.RAW:""+a;b=b||"yyyy/MM/dd";a=getDateFromFormat(a,b);return Number.isNaN(a)?NaN:/^[^yMd]+$/.test(b)?a/MINUTE_MILLI:a/DAY_MILLI}function SPELLNUMBER(a,b,c){return Number2Word(a,b,c)}function PREVIOUSROW(a){if(Array.isArray(a.SUM)){var b=a.KEY,c=a.SUM[0],d=c.value||0,e=c.subtableRowNum;for(c=c.y;1<e;){var f=formulaBuilder.getFormulaVariables(a.FMODE,--c);f[b].SUM.length&&(d=(f[b].SUM[0].value||0)+d);e--}return d}return""}
function RUNNINGBALANCE(a){return PREVIOUSROW(a)}function PMT(a,b,c,d,e){if(3>arguments.length)throw new SyntaxError("You've entered too few arguments for this function");d=d||0;e=e||0;a=parseFloat(a.toString());b=parseInt(b.toString());c=parseFloat(c.toString());var f=Math.pow(1+a,b);f=c*a*(f+d)/(f-1);1===e&&(f/=1+a);return f}
function TIME(a,b,c){a=parseInt(a.toString());b=parseInt(b.toString());c=parseInt(c.toString());if(3!==arguments.length)throw new SyntaxError("You should enter three arguments for this function");if(!isNumeric(a)||!isNumeric(b)||!isNumeric(c))throw new SyntaxError("Arguments should be number!");if(0>a||32767<a)throw new SyntaxError("The hour's range is 0 ~ 32767");if(0>b||32767<b)throw new SyntaxError("The minute's range is 0 ~ 32767");if(0>c||32767<c)throw new SyntaxError("The second's range is 0 ~ 32767");
var d=1/86400;return 23<a?TIME(a%24,b,c):59<b?TIME(a+Math.floor(b/60),b%60,c):59<c?TIME(a,b+Math.floor(c/60),c%60):(3600*a+60*b+c)*d}function ISBLANK(a){return""===a||""===a.RAW}
function PRODUCT(){if(0===arguments.length)throw new SyntaxError("You should enter at least one argument for this function");for(var a=1,b,c=!1,d=0,e=arguments.length;d<e;d++)if(b=arguments[d],void 0===b.SUM){b=parseInt(b);if(Number.isNaN(b)&&mode!==BUILDER)throw new SyntaxError("The argument should be a number");c=!0;a*=b}else Array.isArray(b.SUM)?a*=b.SUM.reduce(function(a,b){return isNumeric(b.value)?(c||(c=!0),a*b.value):a},1):(b=parseInt(b.RAW),Number.isNaN(b)||(c=!0,a*=b));c||(a=0);return a}
function TRIM(a){a=a.toString();a=a.replace(/^([\u0020\u3000])*|([\u0020\u3000])*$/g,"");a=a.replace(/(\u0020)+(\u3000)*/g,"$1");return a=a.replace(/(\u3000)+(\u0020)*/g,"$1")};
